{"timestamp":1529903626310,"iteration":1,"tags":{"StandardRun":"true"},"configuration":{"sparkVersion":"2.3.0","sqlConf":{"spark.driver.host":"llvm.c.starcloud-200604.internal","spark.driver.port":"46023","spark.repl.class.uri":"spark://llvm.c.starcloud-200604.internal:46023/classes","spark.jars":"file:///home/ycx/sparkimprovement/benchmark/tpcds/spark-sql-perf/target/scala-2.11/spark-sql-perf_2.11-0.5.0-SNAPSHOT.jar,file:///home/ycx/.ivy2/jars/com.typesafe.scala-logging_scala-logging-slf4j_2.10-2.1.2.jar,file:///home/ycx/.ivy2/jars/com.typesafe.scala-logging_scala-logging-api_2.10-2.1.2.jar,file:///home/ycx/.ivy2/jars/org.scala-lang_scala-reflect-2.10.4.jar,file:///home/ycx/.ivy2/jars/org.slf4j_slf4j-api-1.7.7.jar","spark.repl.class.outputDir":"/tmp/spark-de397c30-a23a-4893-b089-0a88c01bb106/repl-70871cea-ce01-4b1c-afab-a76a1069013b","spark.app.name":"Spark shell","spark.driver.memory":"10G","spark.ui.showConsoleProgress":"true","spark.executor.id":"driver","spark.submit.deployMode":"client","spark.master":"local[*]","spark.home":"/home/ycx/pkgs/spark-2.3.0-bin-hadoop2.7","spark.sql.catalogImplementation":"hive","spark.repl.local.jars":"file:///home/ycx/sparkimprovement/benchmark/tpcds/spark-sql-perf/target/scala-2.11/spark-sql-perf_2.11-0.5.0-SNAPSHOT.jar,file:///home/ycx/.ivy2/jars/com.typesafe.scala-logging_scala-logging-slf4j_2.10-2.1.2.jar,file:///home/ycx/.ivy2/jars/com.typesafe.scala-logging_scala-logging-api_2.10-2.1.2.jar,file:///home/ycx/.ivy2/jars/org.scala-lang_scala-reflect-2.10.4.jar,file:///home/ycx/.ivy2/jars/org.slf4j_slf4j-api-1.7.7.jar","spark.app.id":"local-1529903435427"},"sparkConf":{"spark.driver.host":"llvm.c.starcloud-200604.internal","spark.driver.port":"46023","spark.repl.class.uri":"spark://llvm.c.starcloud-200604.internal:46023/classes","spark.jars":"file:///home/ycx/sparkimprovement/benchmark/tpcds/spark-sql-perf/target/scala-2.11/spark-sql-perf_2.11-0.5.0-SNAPSHOT.jar,file:///home/ycx/.ivy2/jars/com.typesafe.scala-logging_scala-logging-slf4j_2.10-2.1.2.jar,file:///home/ycx/.ivy2/jars/com.typesafe.scala-logging_scala-logging-api_2.10-2.1.2.jar,file:///home/ycx/.ivy2/jars/org.scala-lang_scala-reflect-2.10.4.jar,file:///home/ycx/.ivy2/jars/org.slf4j_slf4j-api-1.7.7.jar","spark.repl.class.outputDir":"/tmp/spark-de397c30-a23a-4893-b089-0a88c01bb106/repl-70871cea-ce01-4b1c-afab-a76a1069013b","spark.app.name":"Spark shell","spark.driver.memory":"10G","spark.ui.showConsoleProgress":"true","spark.executor.id":"driver","spark.submit.deployMode":"client","spark.master":"local[*]","spark.home":"/home/ycx/pkgs/spark-2.3.0-bin-hadoop2.7","spark.sql.catalogImplementation":"hive","spark.repl.local.jars":"file:///home/ycx/sparkimprovement/benchmark/tpcds/spark-sql-perf/target/scala-2.11/spark-sql-perf_2.11-0.5.0-SNAPSHOT.jar,file:///home/ycx/.ivy2/jars/com.typesafe.scala-logging_scala-logging-slf4j_2.10-2.1.2.jar,file:///home/ycx/.ivy2/jars/com.typesafe.scala-logging_scala-logging-api_2.10-2.1.2.jar,file:///home/ycx/.ivy2/jars/org.scala-lang_scala-reflect-2.10.4.jar,file:///home/ycx/.ivy2/jars/org.slf4j_slf4j-api-1.7.7.jar","spark.app.id":"local-1529903435427"},"defaultParallelism":4,"buildInfo":{}},"results":[{"name":"q1-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["customer_total_return","store","customer"],"parsingTime":0.014155,"analysisTime":0.006448,"optimizationTime":654.218268,"planningTime":61.006155,"executionTime":15208.11248,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [customer_total_return]\n:  +- 'SubqueryAlias customer_total_return\n:     +- 'Aggregate ['sr_customer_sk, 'sr_store_sk], ['sr_customer_sk AS ctr_customer_sk#9623, 'sr_store_sk AS ctr_store_sk#9624, 'sum('sr_return_amt) AS ctr_total_return#9625]\n:        +- 'Filter (('sr_returned_date_sk = 'd_date_sk) && ('d_year = 2000))\n:           +- 'Join Inner\n:              :- 'UnresolvedRelation `store_returns`\n:              +- 'UnresolvedRelation `date_dim`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['c_customer_id ASC NULLS FIRST], true\n         +- 'Project ['c_customer_id]\n            +- 'Filter ((('ctr1.ctr_total_return > scalar-subquery#9622 []) && ('s_store_sk = 'ctr1.ctr_store_sk)) && (('s_state = TN) && ('ctr1.ctr_customer_sk = 'c_customer_sk)))\n               :  +- 'Project [unresolvedalias(('avg('ctr_total_return) * 1.2), None)]\n               :     +- 'Filter ('ctr1.ctr_store_sk = 'ctr2.ctr_store_sk)\n               :        +- 'SubqueryAlias ctr2\n               :           +- 'UnresolvedRelation `customer_total_return`\n               +- 'Join Inner\n                  :- 'Join Inner\n                  :  :- 'SubqueryAlias ctr1\n                  :  :  +- 'UnresolvedRelation `customer_total_return`\n                  :  +- 'UnresolvedRelation `store`\n                  +- 'UnresolvedRelation `customer`\n\n== Analyzed Logical Plan ==\nc_customer_id: string\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [c_customer_id#861 ASC NULLS FIRST], true\n      +- Project [c_customer_id#861]\n         +- Filter (((cast(ctr_total_return#9625 as decimal(24,7)) > cast(scalar-subquery#9622 [ctr_store_sk#9624] as decimal(24,7))) && (s_store_sk#1386 = ctr_store_sk#9624)) && ((s_state#1410 = TN) && (ctr_customer_sk#9623 = c_customer_sk#860)))\n            :  +- Aggregate [CheckOverflow((promote_precision(cast(avg(ctr_total_return#9625) as decimal(21,6))) * promote_precision(cast(1.2 as decimal(21,6)))), DecimalType(24,7)) AS (CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#9628]\n            :     +- Filter (outer(ctr_store_sk#9624) = ctr_store_sk#9624)\n            :        +- SubqueryAlias ctr2\n            :           +- SubqueryAlias customer_total_return\n            :              +- Aggregate [sr_customer_sk#1706, sr_store_sk#1710], [sr_customer_sk#1706 AS ctr_customer_sk#9623, sr_store_sk#1710 AS ctr_store_sk#9624, sum(sr_return_amt#1714) AS ctr_total_return#9625]\n            :                 +- Filter ((sr_returned_date_sk#1723 = d_date_sk#1040) && (d_year#1046 = 2000))\n            :                    +- Join Inner\n            :                       :- SubqueryAlias store_returns\n            :                       :  +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n            :                       +- SubqueryAlias date_dim\n            :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias ctr1\n               :  :  +- SubqueryAlias customer_total_return\n               :  :     +- Aggregate [sr_customer_sk#1706, sr_store_sk#1710], [sr_customer_sk#1706 AS ctr_customer_sk#9623, sr_store_sk#1710 AS ctr_store_sk#9624, sum(sr_return_amt#1714) AS ctr_total_return#9625]\n               :  :        +- Filter ((sr_returned_date_sk#1723 = d_date_sk#1040) && (d_year#1046 = 2000))\n               :  :           +- Join Inner\n               :  :              :- SubqueryAlias store_returns\n               :  :              :  +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :  :              +- SubqueryAlias date_dim\n               :  :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  +- SubqueryAlias store\n               :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               +- SubqueryAlias customer\n                  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [c_customer_id#861 ASC NULLS FIRST], true\n      +- Project [c_customer_id#861]\n         +- Join Inner, (ctr_customer_sk#9623 = c_customer_sk#860)\n            :- Project [ctr_customer_sk#9623]\n            :  +- Join Inner, (s_store_sk#1386 = ctr_store_sk#9624)\n            :     :- Project [ctr_customer_sk#9623, ctr_store_sk#9624]\n            :     :  +- Join Inner, ((cast(ctr_total_return#9625 as decimal(24,7)) > (CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#9628) && (ctr_store_sk#9624 = ctr_store_sk#9624#9630))\n            :     :     :- Filter isnotnull(ctr_total_return#9625)\n            :     :     :  +- Aggregate [sr_customer_sk#1706, sr_store_sk#1710], [sr_customer_sk#1706 AS ctr_customer_sk#9623, sr_store_sk#1710 AS ctr_store_sk#9624, MakeDecimal(sum(UnscaledValue(sr_return_amt#1714)),17,2) AS ctr_total_return#9625]\n            :     :     :     +- Project [sr_customer_sk#1706, sr_store_sk#1710, sr_return_amt#1714]\n            :     :     :        +- Join Inner, (sr_returned_date_sk#1723 = d_date_sk#1040)\n            :     :     :           :- Project [sr_customer_sk#1706, sr_store_sk#1710, sr_return_amt#1714, sr_returned_date_sk#1723]\n            :     :     :           :  +- Filter ((isnotnull(sr_returned_date_sk#1723) && isnotnull(sr_store_sk#1710)) && isnotnull(sr_customer_sk#1706))\n            :     :     :           :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n            :     :     :           +- Project [d_date_sk#1040]\n            :     :     :              +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n            :     :     :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :     +- Filter isnotnull((CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#9628)\n            :     :        +- Aggregate [ctr_store_sk#9624], [CheckOverflow((promote_precision(avg(ctr_total_return#9625)) * 1.200000), DecimalType(24,7)) AS (CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#9628, ctr_store_sk#9624 AS ctr_store_sk#9624#9630]\n            :     :           +- Aggregate [sr_customer_sk#1706, sr_store_sk#1710], [sr_store_sk#1710 AS ctr_store_sk#9624, MakeDecimal(sum(UnscaledValue(sr_return_amt#1714)),17,2) AS ctr_total_return#9625]\n            :     :              +- Project [sr_customer_sk#1706, sr_store_sk#1710, sr_return_amt#1714]\n            :     :                 +- Join Inner, (sr_returned_date_sk#1723 = d_date_sk#1040)\n            :     :                    :- Project [sr_customer_sk#1706, sr_store_sk#1710, sr_return_amt#1714, sr_returned_date_sk#1723]\n            :     :                    :  +- Filter (isnotnull(sr_returned_date_sk#1723) && isnotnull(sr_store_sk#1710))\n            :     :                    :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n            :     :                    +- Project [d_date_sk#1040]\n            :     :                       +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n            :     :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     +- Project [s_store_sk#1386]\n            :        +- Filter ((isnotnull(s_state#1410) && (s_state#1410 = TN)) && isnotnull(s_store_sk#1386))\n            :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n            +- Project [c_customer_sk#860, c_customer_id#861]\n               +- Filter isnotnull(c_customer_sk#860)\n                  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[c_customer_id#861 ASC NULLS FIRST], output=[c_customer_id#861])\n+- *(12) Project [c_customer_id#861]\n   +- *(12) BroadcastHashJoin [ctr_customer_sk#9623], [c_customer_sk#860], Inner, BuildRight\n      :- *(12) Project [ctr_customer_sk#9623]\n      :  +- *(12) BroadcastHashJoin [ctr_store_sk#9624], [s_store_sk#1386], Inner, BuildRight\n      :     :- *(12) Project [ctr_customer_sk#9623, ctr_store_sk#9624]\n      :     :  +- *(12) SortMergeJoin [ctr_store_sk#9624], [ctr_store_sk#9624#9630], Inner, (cast(ctr_total_return#9625 as decimal(24,7)) > (CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#9628)\n      :     :     :- *(4) Sort [ctr_store_sk#9624 ASC NULLS FIRST], false, 0\n      :     :     :  +- Exchange hashpartitioning(ctr_store_sk#9624, 200)\n      :     :     :     +- *(3) Filter isnotnull(ctr_total_return#9625)\n      :     :     :        +- *(3) HashAggregate(keys=[sr_customer_sk#1706, sr_store_sk#1710], functions=[sum(UnscaledValue(sr_return_amt#1714))], output=[ctr_customer_sk#9623, ctr_store_sk#9624, ctr_total_return#9625])\n      :     :     :           +- Exchange hashpartitioning(sr_customer_sk#1706, sr_store_sk#1710, 200)\n      :     :     :              +- *(2) HashAggregate(keys=[sr_customer_sk#1706, sr_store_sk#1710], functions=[partial_sum(UnscaledValue(sr_return_amt#1714))], output=[sr_customer_sk#1706, sr_store_sk#1710, sum#9632L])\n      :     :     :                 +- *(2) Project [sr_customer_sk#1706, sr_store_sk#1710, sr_return_amt#1714]\n      :     :     :                    +- *(2) BroadcastHashJoin [sr_returned_date_sk#1723], [d_date_sk#1040], Inner, BuildRight\n      :     :     :                       :- *(2) Project [sr_customer_sk#1706, sr_store_sk#1710, sr_return_amt#1714, sr_returned_date_sk#1723]\n      :     :     :                       :  +- *(2) Filter (isnotnull(sr_store_sk#1710) && isnotnull(sr_customer_sk#1706))\n      :     :     :                       :     +- *(2) FileScan parquet db_tpcds.store_returns[sr_customer_sk#1706,sr_store_sk#1710,sr_return_amt#1714,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns/sr_..., PartitionCount: 2001, PartitionFilters: [isnotnull(sr_returned_date_sk#1723)], PushedFilters: [IsNotNull(sr_store_sk), IsNotNull(sr_customer_sk)], ReadSchema: struct<sr_customer_sk:int,sr_store_sk:int,sr_return_amt:decimal(7,2)>\n      :     :     :                       +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :     :                          +- *(1) Project [d_date_sk#1040]\n      :     :     :                             +- *(1) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n      :     :     :                                +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n      :     :     +- *(9) Sort [ctr_store_sk#9624#9630 ASC NULLS FIRST], false, 0\n      :     :        +- Exchange hashpartitioning(ctr_store_sk#9624#9630, 200)\n      :     :           +- *(8) Filter isnotnull((CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#9628)\n      :     :              +- *(8) HashAggregate(keys=[ctr_store_sk#9624], functions=[avg(ctr_total_return#9625)], output=[(CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#9628, ctr_store_sk#9624#9630])\n      :     :                 +- Exchange hashpartitioning(ctr_store_sk#9624, 200)\n      :     :                    +- *(7) HashAggregate(keys=[ctr_store_sk#9624], functions=[partial_avg(ctr_total_return#9625)], output=[ctr_store_sk#9624, sum#9635, count#9636L])\n      :     :                       +- *(7) HashAggregate(keys=[sr_customer_sk#1706, sr_store_sk#1710], functions=[sum(UnscaledValue(sr_return_amt#1714))], output=[ctr_store_sk#9624, ctr_total_return#9625])\n      :     :                          +- Exchange hashpartitioning(sr_customer_sk#1706, sr_store_sk#1710, 200)\n      :     :                             +- *(6) HashAggregate(keys=[sr_customer_sk#1706, sr_store_sk#1710], functions=[partial_sum(UnscaledValue(sr_return_amt#1714))], output=[sr_customer_sk#1706, sr_store_sk#1710, sum#9638L])\n      :     :                                +- *(6) Project [sr_customer_sk#1706, sr_store_sk#1710, sr_return_amt#1714]\n      :     :                                   +- *(6) BroadcastHashJoin [sr_returned_date_sk#1723], [d_date_sk#1040], Inner, BuildRight\n      :     :                                      :- *(6) Project [sr_customer_sk#1706, sr_store_sk#1710, sr_return_amt#1714, sr_returned_date_sk#1723]\n      :     :                                      :  +- *(6) Filter isnotnull(sr_store_sk#1710)\n      :     :                                      :     +- *(6) FileScan parquet db_tpcds.store_returns[sr_customer_sk#1706,sr_store_sk#1710,sr_return_amt#1714,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns/sr_..., PartitionCount: 2001, PartitionFilters: [isnotnull(sr_returned_date_sk#1723)], PushedFilters: [IsNotNull(sr_store_sk)], ReadSchema: struct<sr_customer_sk:int,sr_store_sk:int,sr_return_amt:decimal(7,2)>\n      :     :                                      +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :        +- *(10) Project [s_store_sk#1386]\n      :           +- *(10) Filter ((isnotnull(s_state#1410) && (s_state#1410 = TN)) && isnotnull(s_store_sk#1386))\n      :              +- *(10) FileScan parquet db_tpcds.store[s_store_sk#1386,s_state#1410] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_state), EqualTo(s_state,TN), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_state:string>\n      +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         +- *(11) Project [c_customer_sk#860, c_customer_id#861]\n            +- *(11) Filter isnotnull(c_customer_sk#860)\n               +- *(11) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_customer_id#861] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string>"},{"name":"q2-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["wswscs","date_dim","wswscs","date_dim"],"parsingTime":0.001796,"analysisTime":8.32E-4,"optimizationTime":997.412733,"planningTime":99.568465,"executionTime":7545.574598,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [wscs, wswscs]\n:  :- 'SubqueryAlias wscs\n:  :  +- 'Project ['sold_date_sk, 'sales_price]\n:  :     +- 'SubqueryAlias x\n:  :        +- 'Union\n:  :           :- 'Project ['ws_sold_date_sk AS sold_date_sk#9813, 'ws_ext_sales_price AS sales_price#9814]\n:  :           :  +- 'UnresolvedRelation `web_sales`\n:  :           +- 'Project ['cs_sold_date_sk AS sold_date_sk#9815, 'cs_ext_sales_price AS sales_price#9816]\n:  :              +- 'UnresolvedRelation `catalog_sales`\n:  +- 'SubqueryAlias wswscs\n:     +- 'Aggregate ['d_week_seq], ['d_week_seq, 'sum(CASE WHEN ('d_day_name = Sunday) THEN 'sales_price ELSE null END) AS sun_sales#9817, 'sum(CASE WHEN ('d_day_name = Monday) THEN 'sales_price ELSE null END) AS mon_sales#9818, 'sum(CASE WHEN ('d_day_name = Tuesday) THEN 'sales_price ELSE null END) AS tue_sales#9819, 'sum(CASE WHEN ('d_day_name = Wednesday) THEN 'sales_price ELSE null END) AS wed_sales#9820, 'sum(CASE WHEN ('d_day_name = Thursday) THEN 'sales_price ELSE null END) AS thu_sales#9821, 'sum(CASE WHEN ('d_day_name = Friday) THEN 'sales_price ELSE null END) AS fri_sales#9822, 'sum(CASE WHEN ('d_day_name = Saturday) THEN 'sales_price ELSE null END) AS sat_sales#9823]\n:        +- 'Filter ('d_date_sk = 'sold_date_sk)\n:           +- 'Join Inner\n:              :- 'UnresolvedRelation `wscs`\n:              +- 'UnresolvedRelation `date_dim`\n+- 'Sort ['d_week_seq1 ASC NULLS FIRST], true\n   +- 'Project ['d_week_seq1, unresolvedalias('round(('sun_sales1 / 'sun_sales2), 2), None), unresolvedalias('round(('mon_sales1 / 'mon_sales2), 2), None), unresolvedalias('round(('tue_sales1 / 'tue_sales2), 2), None), unresolvedalias('round(('wed_sales1 / 'wed_sales2), 2), None), unresolvedalias('round(('thu_sales1 / 'thu_sales2), 2), None), unresolvedalias('round(('fri_sales1 / 'fri_sales2), 2), None), unresolvedalias('round(('sat_sales1 / 'sat_sales2), 2), None)]\n      +- 'Filter ('d_week_seq1 = ('d_week_seq2 - 53))\n         +- 'Join Inner\n            :- 'SubqueryAlias y\n            :  +- 'Project ['wswscs.d_week_seq AS d_week_seq1#9797, 'sun_sales AS sun_sales1#9798, 'mon_sales AS mon_sales1#9799, 'tue_sales AS tue_sales1#9800, 'wed_sales AS wed_sales1#9801, 'thu_sales AS thu_sales1#9802, 'fri_sales AS fri_sales1#9803, 'sat_sales AS sat_sales1#9804]\n            :     +- 'Filter (('date_dim.d_week_seq = 'wswscs.d_week_seq) && ('d_year = 2001))\n            :        +- 'Join Inner\n            :           :- 'UnresolvedRelation `wswscs`\n            :           +- 'UnresolvedRelation `date_dim`\n            +- 'SubqueryAlias z\n               +- 'Project ['wswscs.d_week_seq AS d_week_seq2#9805, 'sun_sales AS sun_sales2#9806, 'mon_sales AS mon_sales2#9807, 'tue_sales AS tue_sales2#9808, 'wed_sales AS wed_sales2#9809, 'thu_sales AS thu_sales2#9810, 'fri_sales AS fri_sales2#9811, 'sat_sales AS sat_sales2#9812]\n                  +- 'Filter (('date_dim.d_week_seq = 'wswscs.d_week_seq) && ('d_year = (2001 + 1)))\n                     +- 'Join Inner\n                        :- 'UnresolvedRelation `wswscs`\n                        +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nd_week_seq1: int, round((sun_sales1 / sun_sales2), 2): decimal(37,2), round((mon_sales1 / mon_sales2), 2): decimal(37,2), round((tue_sales1 / tue_sales2), 2): decimal(37,2), round((wed_sales1 / wed_sales2), 2): decimal(37,2), round((thu_sales1 / thu_sales2), 2): decimal(37,2), round((fri_sales1 / fri_sales2), 2): decimal(37,2), round((sat_sales1 / sat_sales2), 2): decimal(37,2)\nSort [d_week_seq1#9797 ASC NULLS FIRST], true\n+- Project [d_week_seq1#9797, round(CheckOverflow((promote_precision(cast(sun_sales1#9798 as decimal(17,2))) / promote_precision(cast(sun_sales2#9806 as decimal(17,2)))), DecimalType(37,20)), 2) AS round((sun_sales1 / sun_sales2), 2)#9887, round(CheckOverflow((promote_precision(cast(mon_sales1#9799 as decimal(17,2))) / promote_precision(cast(mon_sales2#9807 as decimal(17,2)))), DecimalType(37,20)), 2) AS round((mon_sales1 / mon_sales2), 2)#9888, round(CheckOverflow((promote_precision(cast(tue_sales1#9800 as decimal(17,2))) / promote_precision(cast(tue_sales2#9808 as decimal(17,2)))), DecimalType(37,20)), 2) AS round((tue_sales1 / tue_sales2), 2)#9889, round(CheckOverflow((promote_precision(cast(wed_sales1#9801 as decimal(17,2))) / promote_precision(cast(wed_sales2#9809 as decimal(17,2)))), DecimalType(37,20)), 2) AS round((wed_sales1 / wed_sales2), 2)#9890, round(CheckOverflow((promote_precision(cast(thu_sales1#9802 as decimal(17,2))) / promote_precision(cast(thu_sales2#9810 as decimal(17,2)))), DecimalType(37,20)), 2) AS round((thu_sales1 / thu_sales2), 2)#9891, round(CheckOverflow((promote_precision(cast(fri_sales1#9803 as decimal(17,2))) / promote_precision(cast(fri_sales2#9811 as decimal(17,2)))), DecimalType(37,20)), 2) AS round((fri_sales1 / fri_sales2), 2)#9892, round(CheckOverflow((promote_precision(cast(sat_sales1#9804 as decimal(17,2))) / promote_precision(cast(sat_sales2#9812 as decimal(17,2)))), DecimalType(37,20)), 2) AS round((sat_sales1 / sat_sales2), 2)#9893]\n   +- Filter (d_week_seq1#9797 = (d_week_seq2#9805 - 53))\n      +- Join Inner\n         :- SubqueryAlias y\n         :  +- Project [d_week_seq#1044 AS d_week_seq1#9797, sun_sales#9817 AS sun_sales1#9798, mon_sales#9818 AS mon_sales1#9799, tue_sales#9819 AS tue_sales1#9800, wed_sales#9820 AS wed_sales1#9801, thu_sales#9821 AS thu_sales1#9802, fri_sales#9822 AS fri_sales1#9803, sat_sales#9823 AS sat_sales1#9804]\n         :     +- Filter ((d_week_seq#9835 = d_week_seq#1044) && (d_year#9837 = 2001))\n         :        +- Join Inner\n         :           :- SubqueryAlias wswscs\n         :           :  +- Aggregate [d_week_seq#1044], [d_week_seq#1044, sum(CASE WHEN (d_day_name#1054 = Sunday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS sun_sales#9817, sum(CASE WHEN (d_day_name#1054 = Monday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS mon_sales#9818, sum(CASE WHEN (d_day_name#1054 = Tuesday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS tue_sales#9819, sum(CASE WHEN (d_day_name#1054 = Wednesday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS wed_sales#9820, sum(CASE WHEN (d_day_name#1054 = Thursday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS thu_sales#9821, sum(CASE WHEN (d_day_name#1054 = Friday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS fri_sales#9822, sum(CASE WHEN (d_day_name#1054 = Saturday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS sat_sales#9823]\n         :           :     +- Filter (d_date_sk#1040 = sold_date_sk#9813)\n         :           :        +- Join Inner\n         :           :           :- SubqueryAlias wscs\n         :           :           :  +- Project [sold_date_sk#9813, sales_price#9814]\n         :           :           :     +- SubqueryAlias x\n         :           :           :        +- Union\n         :           :           :           :- Project [ws_sold_date_sk#1788 AS sold_date_sk#9813, ws_ext_sales_price#1777 AS sales_price#9814]\n         :           :           :           :  +- SubqueryAlias web_sales\n         :           :           :           :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n         :           :           :           +- Project [cs_sold_date_sk#1822 AS sold_date_sk#9815, cs_ext_sales_price#1811 AS sales_price#9816]\n         :           :           :              +- SubqueryAlias catalog_sales\n         :           :           :                 +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n         :           :           +- SubqueryAlias date_dim\n         :           :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :           +- SubqueryAlias date_dim\n         :              +- Relation[d_date_sk#9831,d_date_id#9832,d_date#9833,d_month_seq#9834,d_week_seq#9835,d_quarter_seq#9836,d_year#9837,d_dow#9838,d_moy#9839,d_dom#9840,d_qoy#9841,d_fy_year#9842,d_fy_quarter_seq#9843,d_fy_week_seq#9844,d_day_name#9845,d_quarter_name#9846,d_holiday#9847,d_weekend#9848,d_following_holiday#9849,d_first_dom#9850,d_last_dom#9851,d_same_day_ly#9852,d_same_day_lq#9853,d_current_day#9854,... 4 more fields] parquet\n         +- SubqueryAlias z\n            +- Project [d_week_seq#1044 AS d_week_seq2#9805, sun_sales#9817 AS sun_sales2#9806, mon_sales#9818 AS mon_sales2#9807, tue_sales#9819 AS tue_sales2#9808, wed_sales#9820 AS wed_sales2#9809, thu_sales#9821 AS thu_sales2#9810, fri_sales#9822 AS fri_sales2#9811, sat_sales#9823 AS sat_sales2#9812]\n               +- Filter ((d_week_seq#9863 = d_week_seq#1044) && (d_year#9865 = (2001 + 1)))\n                  +- Join Inner\n                     :- SubqueryAlias wswscs\n                     :  +- Aggregate [d_week_seq#1044], [d_week_seq#1044, sum(CASE WHEN (d_day_name#1054 = Sunday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS sun_sales#9817, sum(CASE WHEN (d_day_name#1054 = Monday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS mon_sales#9818, sum(CASE WHEN (d_day_name#1054 = Tuesday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS tue_sales#9819, sum(CASE WHEN (d_day_name#1054 = Wednesday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS wed_sales#9820, sum(CASE WHEN (d_day_name#1054 = Thursday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS thu_sales#9821, sum(CASE WHEN (d_day_name#1054 = Friday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS fri_sales#9822, sum(CASE WHEN (d_day_name#1054 = Saturday) THEN sales_price#9814 ELSE cast(null as decimal(7,2)) END) AS sat_sales#9823]\n                     :     +- Filter (d_date_sk#1040 = sold_date_sk#9813)\n                     :        +- Join Inner\n                     :           :- SubqueryAlias wscs\n                     :           :  +- Project [sold_date_sk#9813, sales_price#9814]\n                     :           :     +- SubqueryAlias x\n                     :           :        +- Union\n                     :           :           :- Project [ws_sold_date_sk#1788 AS sold_date_sk#9813, ws_ext_sales_price#1777 AS sales_price#9814]\n                     :           :           :  +- SubqueryAlias web_sales\n                     :           :           :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :           :           +- Project [cs_sold_date_sk#1822 AS sold_date_sk#9815, cs_ext_sales_price#1811 AS sales_price#9816]\n                     :           :              +- SubqueryAlias catalog_sales\n                     :           :                 +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :           +- SubqueryAlias date_dim\n                     :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     +- SubqueryAlias date_dim\n                        +- Relation[d_date_sk#9859,d_date_id#9860,d_date#9861,d_month_seq#9862,d_week_seq#9863,d_quarter_seq#9864,d_year#9865,d_dow#9866,d_moy#9867,d_dom#9868,d_qoy#9869,d_fy_year#9870,d_fy_quarter_seq#9871,d_fy_week_seq#9872,d_day_name#9873,d_quarter_name#9874,d_holiday#9875,d_weekend#9876,d_following_holiday#9877,d_first_dom#9878,d_last_dom#9879,d_same_day_ly#9880,d_same_day_lq#9881,d_current_day#9882,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nSort [d_week_seq1#9797 ASC NULLS FIRST], true\n+- Project [d_week_seq1#9797, round(CheckOverflow((promote_precision(sun_sales1#9798) / promote_precision(sun_sales2#9806)), DecimalType(37,20)), 2) AS round((sun_sales1 / sun_sales2), 2)#9887, round(CheckOverflow((promote_precision(mon_sales1#9799) / promote_precision(mon_sales2#9807)), DecimalType(37,20)), 2) AS round((mon_sales1 / mon_sales2), 2)#9888, round(CheckOverflow((promote_precision(tue_sales1#9800) / promote_precision(tue_sales2#9808)), DecimalType(37,20)), 2) AS round((tue_sales1 / tue_sales2), 2)#9889, round(CheckOverflow((promote_precision(wed_sales1#9801) / promote_precision(wed_sales2#9809)), DecimalType(37,20)), 2) AS round((wed_sales1 / wed_sales2), 2)#9890, round(CheckOverflow((promote_precision(thu_sales1#9802) / promote_precision(thu_sales2#9810)), DecimalType(37,20)), 2) AS round((thu_sales1 / thu_sales2), 2)#9891, round(CheckOverflow((promote_precision(fri_sales1#9803) / promote_precision(fri_sales2#9811)), DecimalType(37,20)), 2) AS round((fri_sales1 / fri_sales2), 2)#9892, round(CheckOverflow((promote_precision(sat_sales1#9804) / promote_precision(sat_sales2#9812)), DecimalType(37,20)), 2) AS round((sat_sales1 / sat_sales2), 2)#9893]\n   +- Join Inner, (d_week_seq1#9797 = (d_week_seq2#9805 - 53))\n      :- Project [d_week_seq#1044 AS d_week_seq1#9797, sun_sales#9817 AS sun_sales1#9798, mon_sales#9818 AS mon_sales1#9799, tue_sales#9819 AS tue_sales1#9800, wed_sales#9820 AS wed_sales1#9801, thu_sales#9821 AS thu_sales1#9802, fri_sales#9822 AS fri_sales1#9803, sat_sales#9823 AS sat_sales1#9804]\n      :  +- Join Inner, (d_week_seq#9835 = d_week_seq#1044)\n      :     :- Aggregate [d_week_seq#1044], [d_week_seq#1044, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN sales_price#9814 ELSE null END)),17,2) AS sun_sales#9817, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN sales_price#9814 ELSE null END)),17,2) AS mon_sales#9818, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN sales_price#9814 ELSE null END)),17,2) AS tue_sales#9819, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN sales_price#9814 ELSE null END)),17,2) AS wed_sales#9820, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN sales_price#9814 ELSE null END)),17,2) AS thu_sales#9821, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN sales_price#9814 ELSE null END)),17,2) AS fri_sales#9822, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN sales_price#9814 ELSE null END)),17,2) AS sat_sales#9823]\n      :     :  +- Project [sales_price#9814, d_week_seq#1044, d_day_name#1054]\n      :     :     +- Join Inner, (d_date_sk#1040 = sold_date_sk#9813)\n      :     :        :- Union\n      :     :        :  :- Project [ws_sold_date_sk#1788 AS sold_date_sk#9813, ws_ext_sales_price#1777 AS sales_price#9814]\n      :     :        :  :  +- Filter isnotnull(ws_sold_date_sk#1788)\n      :     :        :  :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n      :     :        :  +- Project [cs_sold_date_sk#1822 AS sold_date_sk#9815, cs_ext_sales_price#1811 AS sales_price#9816]\n      :     :        :     +- Filter isnotnull(cs_sold_date_sk#1822)\n      :     :        :        +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n      :     :        +- Project [d_date_sk#1040, d_week_seq#1044, d_day_name#1054]\n      :     :           +- Filter (isnotnull(d_date_sk#1040) && isnotnull(d_week_seq#1044))\n      :     :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n      :     +- Project [d_week_seq#9835]\n      :        +- Filter ((isnotnull(d_year#9837) && (d_year#9837 = 2001)) && isnotnull(d_week_seq#9835))\n      :           +- Relation[d_date_sk#9831,d_date_id#9832,d_date#9833,d_month_seq#9834,d_week_seq#9835,d_quarter_seq#9836,d_year#9837,d_dow#9838,d_moy#9839,d_dom#9840,d_qoy#9841,d_fy_year#9842,d_fy_quarter_seq#9843,d_fy_week_seq#9844,d_day_name#9845,d_quarter_name#9846,d_holiday#9847,d_weekend#9848,d_following_holiday#9849,d_first_dom#9850,d_last_dom#9851,d_same_day_ly#9852,d_same_day_lq#9853,d_current_day#9854,... 4 more fields] parquet\n      +- Project [d_week_seq#1044 AS d_week_seq2#9805, sun_sales#9817 AS sun_sales2#9806, mon_sales#9818 AS mon_sales2#9807, tue_sales#9819 AS tue_sales2#9808, wed_sales#9820 AS wed_sales2#9809, thu_sales#9821 AS thu_sales2#9810, fri_sales#9822 AS fri_sales2#9811, sat_sales#9823 AS sat_sales2#9812]\n         +- Join Inner, (d_week_seq#9863 = d_week_seq#1044)\n            :- Aggregate [d_week_seq#1044], [d_week_seq#1044, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN sales_price#9814 ELSE null END)),17,2) AS sun_sales#9817, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN sales_price#9814 ELSE null END)),17,2) AS mon_sales#9818, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN sales_price#9814 ELSE null END)),17,2) AS tue_sales#9819, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN sales_price#9814 ELSE null END)),17,2) AS wed_sales#9820, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN sales_price#9814 ELSE null END)),17,2) AS thu_sales#9821, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN sales_price#9814 ELSE null END)),17,2) AS fri_sales#9822, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN sales_price#9814 ELSE null END)),17,2) AS sat_sales#9823]\n            :  +- Project [sales_price#9814, d_week_seq#1044, d_day_name#1054]\n            :     +- Join Inner, (d_date_sk#1040 = sold_date_sk#9813)\n            :        :- Union\n            :        :  :- Project [ws_sold_date_sk#1788 AS sold_date_sk#9813, ws_ext_sales_price#1777 AS sales_price#9814]\n            :        :  :  +- Filter isnotnull(ws_sold_date_sk#1788)\n            :        :  :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :        :  +- Project [cs_sold_date_sk#1822 AS sold_date_sk#9815, cs_ext_sales_price#1811 AS sales_price#9816]\n            :        :     +- Filter isnotnull(cs_sold_date_sk#1822)\n            :        :        +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :        +- Project [d_date_sk#1040, d_week_seq#1044, d_day_name#1054]\n            :           +- Filter (isnotnull(d_date_sk#1040) && isnotnull(d_week_seq#1044))\n            :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Project [d_week_seq#9863]\n               +- Filter ((isnotnull(d_year#9865) && (d_year#9865 = 2002)) && isnotnull(d_week_seq#9863))\n                  +- Relation[d_date_sk#9859,d_date_id#9860,d_date#9861,d_month_seq#9862,d_week_seq#9863,d_quarter_seq#9864,d_year#9865,d_dow#9866,d_moy#9867,d_dom#9868,d_qoy#9869,d_fy_year#9870,d_fy_quarter_seq#9871,d_fy_week_seq#9872,d_day_name#9873,d_quarter_name#9874,d_holiday#9875,d_weekend#9876,d_following_holiday#9877,d_first_dom#9878,d_last_dom#9879,d_same_day_ly#9880,d_same_day_lq#9881,d_current_day#9882,... 4 more fields] parquet\n\n== Physical Plan ==\n*(16) Sort [d_week_seq1#9797 ASC NULLS FIRST], true, 0\n+- Exchange rangepartitioning(d_week_seq1#9797 ASC NULLS FIRST, 200)\n   +- *(15) Project [d_week_seq1#9797, round(CheckOverflow((promote_precision(sun_sales1#9798) / promote_precision(sun_sales2#9806)), DecimalType(37,20)), 2) AS round((sun_sales1 / sun_sales2), 2)#9887, round(CheckOverflow((promote_precision(mon_sales1#9799) / promote_precision(mon_sales2#9807)), DecimalType(37,20)), 2) AS round((mon_sales1 / mon_sales2), 2)#9888, round(CheckOverflow((promote_precision(tue_sales1#9800) / promote_precision(tue_sales2#9808)), DecimalType(37,20)), 2) AS round((tue_sales1 / tue_sales2), 2)#9889, round(CheckOverflow((promote_precision(wed_sales1#9801) / promote_precision(wed_sales2#9809)), DecimalType(37,20)), 2) AS round((wed_sales1 / wed_sales2), 2)#9890, round(CheckOverflow((promote_precision(thu_sales1#9802) / promote_precision(thu_sales2#9810)), DecimalType(37,20)), 2) AS round((thu_sales1 / thu_sales2), 2)#9891, round(CheckOverflow((promote_precision(fri_sales1#9803) / promote_precision(fri_sales2#9811)), DecimalType(37,20)), 2) AS round((fri_sales1 / fri_sales2), 2)#9892, round(CheckOverflow((promote_precision(sat_sales1#9804) / promote_precision(sat_sales2#9812)), DecimalType(37,20)), 2) AS round((sat_sales1 / sat_sales2), 2)#9893]\n      +- *(15) SortMergeJoin [d_week_seq1#9797], [(d_week_seq2#9805 - 53)], Inner\n         :- *(7) Sort [d_week_seq1#9797 ASC NULLS FIRST], false, 0\n         :  +- Exchange hashpartitioning(d_week_seq1#9797, 200)\n         :     +- *(6) Project [d_week_seq#1044 AS d_week_seq1#9797, sun_sales#9817 AS sun_sales1#9798, mon_sales#9818 AS mon_sales1#9799, tue_sales#9819 AS tue_sales1#9800, wed_sales#9820 AS wed_sales1#9801, thu_sales#9821 AS thu_sales1#9802, fri_sales#9822 AS fri_sales1#9803, sat_sales#9823 AS sat_sales1#9804]\n         :        +- *(6) BroadcastHashJoin [d_week_seq#1044], [d_week_seq#9835], Inner, BuildRight\n         :           :- *(6) HashAggregate(keys=[d_week_seq#1044], functions=[sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN sales_price#9814 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN sales_price#9814 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN sales_price#9814 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN sales_price#9814 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN sales_price#9814 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN sales_price#9814 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN sales_price#9814 ELSE null END))], output=[d_week_seq#1044, sun_sales#9817, mon_sales#9818, tue_sales#9819, wed_sales#9820, thu_sales#9821, fri_sales#9822, sat_sales#9823])\n         :           :  +- Exchange hashpartitioning(d_week_seq#1044, 200)\n         :           :     +- *(4) HashAggregate(keys=[d_week_seq#1044], functions=[partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN sales_price#9814 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN sales_price#9814 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN sales_price#9814 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN sales_price#9814 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN sales_price#9814 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN sales_price#9814 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN sales_price#9814 ELSE null END))], output=[d_week_seq#1044, sum#9909L, sum#9910L, sum#9911L, sum#9912L, sum#9913L, sum#9914L, sum#9915L])\n         :           :        +- *(4) Project [sales_price#9814, d_week_seq#1044, d_day_name#1054]\n         :           :           +- *(4) BroadcastHashJoin [sold_date_sk#9813], [d_date_sk#1040], Inner, BuildRight\n         :           :              :- Union\n         :           :              :  :- *(1) Project [ws_sold_date_sk#1788 AS sold_date_sk#9813, ws_ext_sales_price#1777 AS sales_price#9814]\n         :           :              :  :  +- *(1) FileScan parquet db_tpcds.web_sales[ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [], ReadSchema: struct<ws_ext_sales_price:decimal(7,2)>\n         :           :              :  +- *(2) Project [cs_sold_date_sk#1822 AS sold_date_sk#9815, cs_ext_sales_price#1811 AS sales_price#9816]\n         :           :              :     +- *(2) FileScan parquet db_tpcds.catalog_sales[cs_ext_sales_price#1811,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_ext_sales_price:decimal(7,2)>\n         :           :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :           :                 +- *(3) Project [d_date_sk#1040, d_week_seq#1044, d_day_name#1054]\n         :           :                    +- *(3) Filter (isnotnull(d_date_sk#1040) && isnotnull(d_week_seq#1044))\n         :           :                       +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_week_seq#1044,d_day_name#1054] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), IsNotNull(d_week_seq)], ReadSchema: struct<d_date_sk:int,d_week_seq:int,d_day_name:string>\n         :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :              +- *(5) Project [d_week_seq#9835]\n         :                 +- *(5) Filter ((isnotnull(d_year#9837) && (d_year#9837 = 2001)) && isnotnull(d_week_seq#9835))\n         :                    +- *(5) FileScan parquet db_tpcds.date_dim[d_week_seq#9835,d_year#9837] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_week_seq)], ReadSchema: struct<d_week_seq:int,d_year:int>\n         +- *(14) Sort [(d_week_seq2#9805 - 53) ASC NULLS FIRST], false, 0\n            +- Exchange hashpartitioning((d_week_seq2#9805 - 53), 200)\n               +- *(13) Project [d_week_seq#1044 AS d_week_seq2#9805, sun_sales#9817 AS sun_sales2#9806, mon_sales#9818 AS mon_sales2#9807, tue_sales#9819 AS tue_sales2#9808, wed_sales#9820 AS wed_sales2#9809, thu_sales#9821 AS thu_sales2#9810, fri_sales#9822 AS fri_sales2#9811, sat_sales#9823 AS sat_sales2#9812]\n                  +- *(13) BroadcastHashJoin [d_week_seq#1044], [d_week_seq#9863], Inner, BuildRight\n                     :- *(13) HashAggregate(keys=[d_week_seq#1044], functions=[sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN sales_price#9814 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN sales_price#9814 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN sales_price#9814 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN sales_price#9814 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN sales_price#9814 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN sales_price#9814 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN sales_price#9814 ELSE null END))], output=[d_week_seq#1044, sun_sales#9817, mon_sales#9818, tue_sales#9819, wed_sales#9820, thu_sales#9821, fri_sales#9822, sat_sales#9823])\n                     :  +- ReusedExchange [d_week_seq#1044, sum#9923L, sum#9924L, sum#9925L, sum#9926L, sum#9927L, sum#9928L, sum#9929L], Exchange hashpartitioning(d_week_seq#1044, 200)\n                     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        +- *(12) Project [d_week_seq#9863]\n                           +- *(12) Filter ((isnotnull(d_year#9865) && (d_year#9865 = 2002)) && isnotnull(d_week_seq#9863))\n                              +- *(12) FileScan parquet db_tpcds.date_dim[d_week_seq#9863,d_year#9865] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_week_seq)], ReadSchema: struct<d_week_seq:int,d_year:int>"},{"name":"q3-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin"],"tables":["date_dim","store_sales","item"],"parsingTime":0.001843,"analysisTime":5.89E-4,"optimizationTime":250.740896,"planningTime":15.414375,"executionTime":2756.483357,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['dt.d_year ASC NULLS FIRST, 'sum_agg DESC NULLS LAST, 'brand_id ASC NULLS FIRST], true\n      +- 'Aggregate ['dt.d_year, 'item.i_brand, 'item.i_brand_id], ['dt.d_year, 'item.i_brand_id AS brand_id#10063, 'item.i_brand AS brand#10064, 'SUM('ss_ext_sales_price) AS sum_agg#10065]\n         +- 'Filter ((('dt.d_date_sk = 'store_sales.ss_sold_date_sk) && ('store_sales.ss_item_sk = 'item.i_item_sk)) && (('item.i_manufact_id = 128) && ('dt.d_moy = 11)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'SubqueryAlias dt\n               :  :  +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `store_sales`\n               +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\nd_year: int, brand_id: int, brand: string, sum_agg: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [d_year#1046 ASC NULLS FIRST, sum_agg#10065 DESC NULLS LAST, brand_id#10063 ASC NULLS FIRST], true\n      +- Aggregate [d_year#1046, i_brand#1180, i_brand_id#1179], [d_year#1046, i_brand_id#1179 AS brand_id#10063, i_brand#1180 AS brand#10064, sum(ss_ext_sales_price#1918) AS sum_agg#10065]\n         +- Filter (((d_date_sk#1040 = ss_sold_date_sk#1926) && (ss_item_sk#1905 = i_item_sk#1172)) && ((i_manufact_id#1185 = 128) && (d_moy#1048 = 11)))\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias dt\n               :  :  +- SubqueryAlias date_dim\n               :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  +- SubqueryAlias store_sales\n               :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               +- SubqueryAlias item\n                  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [d_year#1046 ASC NULLS FIRST, sum_agg#10065 DESC NULLS LAST, brand_id#10063 ASC NULLS FIRST], true\n      +- Aggregate [d_year#1046, i_brand#1180, i_brand_id#1179], [d_year#1046, i_brand_id#1179 AS brand_id#10063, i_brand#1180 AS brand#10064, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS sum_agg#10065]\n         +- Project [d_year#1046, ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180]\n            +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :- Project [d_year#1046, ss_item_sk#1905, ss_ext_sales_price#1918]\n               :  +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n               :     :- Project [d_date_sk#1040, d_year#1046]\n               :     :  +- Filter ((isnotnull(d_moy#1048) && (d_moy#1048 = 11)) && isnotnull(d_date_sk#1040))\n               :     :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n               :        +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_item_sk#1905))\n               :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               +- Project [i_item_sk#1172, i_brand_id#1179, i_brand#1180]\n                  +- Filter ((isnotnull(i_manufact_id#1185) && (i_manufact_id#1185 = 128)) && isnotnull(i_item_sk#1172))\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[d_year#1046 ASC NULLS FIRST,sum_agg#10065 DESC NULLS LAST,brand_id#10063 ASC NULLS FIRST], output=[d_year#1046,brand_id#10063,brand#10064,sum_agg#10065])\n+- *(4) HashAggregate(keys=[d_year#1046, i_brand#1180, i_brand_id#1179], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[d_year#1046, brand_id#10063, brand#10064, sum_agg#10065])\n   +- Exchange hashpartitioning(d_year#1046, i_brand#1180, i_brand_id#1179, 200)\n      +- *(3) HashAggregate(keys=[d_year#1046, i_brand#1180, i_brand_id#1179], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[d_year#1046, i_brand#1180, i_brand_id#1179, sum#10075L])\n         +- *(3) Project [d_year#1046, ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180]\n            +- *(3) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :- *(3) Project [d_year#1046, ss_item_sk#1905, ss_ext_sales_price#1918]\n               :  +- *(3) BroadcastHashJoin [d_date_sk#1040], [ss_sold_date_sk#1926], Inner, BuildLeft\n               :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :  +- *(1) Project [d_date_sk#1040, d_year#1046]\n               :     :     +- *(1) Filter ((isnotnull(d_moy#1048) && (d_moy#1048 = 11)) && isnotnull(d_date_sk#1040))\n               :     :        +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               :     +- *(3) Project [ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n               :        +- *(3) Filter isnotnull(ss_item_sk#1905)\n               :           +- *(3) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_ext_sales_price:decimal(7,2)>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(2) Project [i_item_sk#1172, i_brand_id#1179, i_brand#1180]\n                     +- *(2) Filter ((isnotnull(i_manufact_id#1185) && (i_manufact_id#1185 = 128)) && isnotnull(i_item_sk#1172))\n                        +- *(2) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_brand#1180,i_manufact_id#1185] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_manufact_id), EqualTo(i_manufact_id,128), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_brand:string,i_manufact_id:int>"},{"name":"q4-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","SortMergeJoin","SortMergeJoin","SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["year_total","year_total","year_total","year_total","year_total","year_total"],"parsingTime":0.002499,"analysisTime":8.65E-4,"optimizationTime":1695.840328,"planningTime":183.489929,"executionTime":34061.071733,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [year_total]\n:  +- 'SubqueryAlias year_total\n:     +- 'Union\n:        :- 'Union\n:        :  :- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#10198, 'c_first_name AS customer_first_name#10199, 'c_last_name AS customer_last_name#10200, 'c_preferred_cust_flag AS customer_preferred_cust_flag#10201, 'c_birth_country AS customer_birth_country#10202, 'c_login AS customer_login#10203, 'c_email_address AS customer_email_address#10204, 'd_year AS dyear#10205, 'sum((((('ss_ext_list_price - 'ss_ext_wholesale_cost) - 'ss_ext_discount_amt) + 'ss_ext_sales_price) / 2)) AS year_total#10206, s AS sale_type#10207]\n:        :  :  +- 'Filter (('c_customer_sk = 'ss_customer_sk) && ('ss_sold_date_sk = 'd_date_sk))\n:        :  :     +- 'Join Inner\n:        :  :        :- 'Join Inner\n:        :  :        :  :- 'UnresolvedRelation `customer`\n:        :  :        :  +- 'UnresolvedRelation `store_sales`\n:        :  :        +- 'UnresolvedRelation `date_dim`\n:        :  +- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#10208, 'c_first_name AS customer_first_name#10209, 'c_last_name AS customer_last_name#10210, 'c_preferred_cust_flag AS customer_preferred_cust_flag#10211, 'c_birth_country AS customer_birth_country#10212, 'c_login AS customer_login#10213, 'c_email_address AS customer_email_address#10214, 'd_year AS dyear#10215, 'sum((((('cs_ext_list_price - 'cs_ext_wholesale_cost) - 'cs_ext_discount_amt) + 'cs_ext_sales_price) / 2)) AS year_total#10216, c AS sale_type#10217]\n:        :     +- 'Filter (('c_customer_sk = 'cs_bill_customer_sk) && ('cs_sold_date_sk = 'd_date_sk))\n:        :        +- 'Join Inner\n:        :           :- 'Join Inner\n:        :           :  :- 'UnresolvedRelation `customer`\n:        :           :  +- 'UnresolvedRelation `catalog_sales`\n:        :           +- 'UnresolvedRelation `date_dim`\n:        +- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#10218, 'c_first_name AS customer_first_name#10219, 'c_last_name AS customer_last_name#10220, 'c_preferred_cust_flag AS customer_preferred_cust_flag#10221, 'c_birth_country AS customer_birth_country#10222, 'c_login AS customer_login#10223, 'c_email_address AS customer_email_address#10224, 'd_year AS dyear#10225, 'sum((((('ws_ext_list_price - 'ws_ext_wholesale_cost) - 'ws_ext_discount_amt) + 'ws_ext_sales_price) / 2)) AS year_total#10226, w AS sale_type#10227]\n:           +- 'Filter (('c_customer_sk = 'ws_bill_customer_sk) && ('ws_sold_date_sk = 'd_date_sk))\n:              +- 'Join Inner\n:                 :- 'Join Inner\n:                 :  :- 'UnresolvedRelation `customer`\n:                 :  +- 'UnresolvedRelation `web_sales`\n:                 +- 'UnresolvedRelation `date_dim`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['t_s_secyear.customer_id ASC NULLS FIRST, 't_s_secyear.customer_first_name ASC NULLS FIRST, 't_s_secyear.customer_last_name ASC NULLS FIRST, 't_s_secyear.customer_preferred_cust_flag ASC NULLS FIRST], true\n         +- 'Project ['t_s_secyear.customer_id, 't_s_secyear.customer_first_name, 't_s_secyear.customer_last_name, 't_s_secyear.customer_preferred_cust_flag]\n            +- 'Filter (((((('t_s_secyear.customer_id = 't_s_firstyear.customer_id) && ('t_s_firstyear.customer_id = 't_c_secyear.customer_id)) && ('t_s_firstyear.customer_id = 't_c_firstyear.customer_id)) && ((('t_s_firstyear.customer_id = 't_w_firstyear.customer_id) && ('t_s_firstyear.customer_id = 't_w_secyear.customer_id)) && ('t_s_firstyear.sale_type = s))) && (((('t_c_firstyear.sale_type = c) && ('t_w_firstyear.sale_type = w)) && ('t_s_secyear.sale_type = s)) && (('t_c_secyear.sale_type = c) && ('t_w_secyear.sale_type = w)))) && ((((('t_s_firstyear.dyear = 2001) && ('t_s_secyear.dyear = (2001 + 1))) && ('t_c_firstyear.dyear = 2001)) && ((('t_c_secyear.dyear = (2001 + 1)) && ('t_w_firstyear.dyear = 2001)) && ('t_w_secyear.dyear = (2001 + 1)))) && (((('t_s_firstyear.year_total > 0) && ('t_c_firstyear.year_total > 0)) && ('t_w_firstyear.year_total > 0)) && ((CASE WHEN ('t_c_firstyear.year_total > 0) THEN ('t_c_secyear.year_total / 't_c_firstyear.year_total) ELSE null END > CASE WHEN ('t_s_firstyear.year_total > 0) THEN ('t_s_secyear.year_total / 't_s_firstyear.year_total) ELSE null END) && (CASE WHEN ('t_c_firstyear.year_total > 0) THEN ('t_c_secyear.year_total / 't_c_firstyear.year_total) ELSE null END > CASE WHEN ('t_w_firstyear.year_total > 0) THEN ('t_w_secyear.year_total / 't_w_firstyear.year_total) ELSE null END)))))\n               +- 'Join Inner\n                  :- 'Join Inner\n                  :  :- 'Join Inner\n                  :  :  :- 'Join Inner\n                  :  :  :  :- 'Join Inner\n                  :  :  :  :  :- 'SubqueryAlias t_s_firstyear\n                  :  :  :  :  :  +- 'UnresolvedRelation `year_total`\n                  :  :  :  :  +- 'SubqueryAlias t_s_secyear\n                  :  :  :  :     +- 'UnresolvedRelation `year_total`\n                  :  :  :  +- 'SubqueryAlias t_c_firstyear\n                  :  :  :     +- 'UnresolvedRelation `year_total`\n                  :  :  +- 'SubqueryAlias t_c_secyear\n                  :  :     +- 'UnresolvedRelation `year_total`\n                  :  +- 'SubqueryAlias t_w_firstyear\n                  :     +- 'UnresolvedRelation `year_total`\n                  +- 'SubqueryAlias t_w_secyear\n                     +- 'UnresolvedRelation `year_total`\n\n== Analyzed Logical Plan ==\ncustomer_id: string, customer_first_name: string, customer_last_name: string, customer_preferred_cust_flag: string\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [customer_id#10231 ASC NULLS FIRST, customer_first_name#10232 ASC NULLS FIRST, customer_last_name#10233 ASC NULLS FIRST, customer_preferred_cust_flag#10234 ASC NULLS FIRST], true\n      +- Project [customer_id#10231, customer_first_name#10232, customer_last_name#10233, customer_preferred_cust_flag#10234]\n         +- Filter ((((((customer_id#10231 = customer_id#10198) && (customer_id#10198 = customer_id#10251)) && (customer_id#10198 = customer_id#10241)) && (((customer_id#10198 = customer_id#10261) && (customer_id#10198 = customer_id#10271)) && (sale_type#10207 = s))) && ((((sale_type#10250 = c) && (sale_type#10270 = w)) && (sale_type#10240 = s)) && ((sale_type#10260 = c) && (sale_type#10280 = w)))) && (((((dyear#10205 = 2001) && (dyear#10238 = (2001 + 1))) && (dyear#10248 = 2001)) && (((dyear#10258 = (2001 + 1)) && (dyear#10268 = 2001)) && (dyear#10278 = (2001 + 1)))) && ((((cast(year_total#10206 as decimal(24,6)) > cast(cast(0 as decimal(1,0)) as decimal(24,6))) && (cast(year_total#10249 as decimal(24,6)) > cast(cast(0 as decimal(1,0)) as decimal(24,6)))) && (cast(year_total#10269 as decimal(24,6)) > cast(cast(0 as decimal(1,0)) as decimal(24,6)))) && ((CASE WHEN (cast(year_total#10249 as decimal(24,6)) > cast(cast(0 as decimal(1,0)) as decimal(24,6))) THEN CheckOverflow((promote_precision(cast(year_total#10259 as decimal(24,6))) / promote_precision(cast(year_total#10249 as decimal(24,6)))), DecimalType(38,14)) ELSE cast(null as decimal(38,14)) END > CASE WHEN (cast(year_total#10206 as decimal(24,6)) > cast(cast(0 as decimal(1,0)) as decimal(24,6))) THEN CheckOverflow((promote_precision(cast(year_total#10239 as decimal(24,6))) / promote_precision(cast(year_total#10206 as decimal(24,6)))), DecimalType(38,14)) ELSE cast(null as decimal(38,14)) END) && (CASE WHEN (cast(year_total#10249 as decimal(24,6)) > cast(cast(0 as decimal(1,0)) as decimal(24,6))) THEN CheckOverflow((promote_precision(cast(year_total#10259 as decimal(24,6))) / promote_precision(cast(year_total#10249 as decimal(24,6)))), DecimalType(38,14)) ELSE cast(null as decimal(38,14)) END > CASE WHEN (cast(year_total#10269 as decimal(24,6)) > cast(cast(0 as decimal(1,0)) as decimal(24,6))) THEN CheckOverflow((promote_precision(cast(year_total#10279 as decimal(24,6))) / promote_precision(cast(year_total#10269 as decimal(24,6)))), DecimalType(38,14)) ELSE cast(null as decimal(38,14)) END)))))\n            +- Join Inner\n               :- Join Inner\n               :  :- Join Inner\n               :  :  :- Join Inner\n               :  :  :  :- Join Inner\n               :  :  :  :  :- SubqueryAlias t_s_firstyear\n               :  :  :  :  :  +- SubqueryAlias year_total\n               :  :  :  :  :     +- Union\n               :  :  :  :  :        :- Union\n               :  :  :  :  :        :  :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10198, c_first_name#868 AS customer_first_name#10199, c_last_name#869 AS customer_last_name#10200, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10201, c_birth_country#874 AS customer_birth_country#10202, c_login#875 AS customer_login#10203, c_email_address#876 AS customer_email_address#10204, d_year#1046 AS dyear#10205, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_wholesale_cost#1919 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ss_ext_sales_price#1918 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10206, s AS sale_type#10207]\n               :  :  :  :  :        :  :  +- Filter ((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040))\n               :  :  :  :  :        :  :     +- Join Inner\n               :  :  :  :  :        :  :        :- Join Inner\n               :  :  :  :  :        :  :        :  :- SubqueryAlias customer\n               :  :  :  :  :        :  :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :  :  :        :  :        :  +- SubqueryAlias store_sales\n               :  :  :  :  :        :  :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :  :  :  :        :  :        +- SubqueryAlias date_dim\n               :  :  :  :  :        :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :  :  :        :  +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10208, c_first_name#868 AS customer_first_name#10209, c_last_name#869 AS customer_last_name#10210, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10211, c_birth_country#874 AS customer_birth_country#10212, c_login#875 AS customer_login#10213, c_email_address#876 AS customer_email_address#10214, d_year#1046 AS dyear#10215, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_ext_list_price#1813 as decimal(8,2))) - promote_precision(cast(cs_ext_wholesale_cost#1812 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(cs_ext_discount_amt#1810 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(cs_ext_sales_price#1811 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10216, c AS sale_type#10217]\n               :  :  :  :  :        :     +- Filter ((c_customer_sk#860 = cs_bill_customer_sk#1791) && (cs_sold_date_sk#1822 = d_date_sk#1040))\n               :  :  :  :  :        :        +- Join Inner\n               :  :  :  :  :        :           :- Join Inner\n               :  :  :  :  :        :           :  :- SubqueryAlias customer\n               :  :  :  :  :        :           :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :  :  :        :           :  +- SubqueryAlias catalog_sales\n               :  :  :  :  :        :           :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :  :  :  :  :        :           +- SubqueryAlias date_dim\n               :  :  :  :  :        :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :  :  :        +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10218, c_first_name#868 AS customer_first_name#10219, c_last_name#869 AS customer_last_name#10220, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10221, c_birth_country#874 AS customer_birth_country#10222, c_login#875 AS customer_login#10223, c_email_address#876 AS customer_email_address#10224, d_year#1046 AS dyear#10225, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_wholesale_cost#1778 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ws_ext_sales_price#1777 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10226, w AS sale_type#10227]\n               :  :  :  :  :           +- Filter ((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040))\n               :  :  :  :  :              +- Join Inner\n               :  :  :  :  :                 :- Join Inner\n               :  :  :  :  :                 :  :- SubqueryAlias customer\n               :  :  :  :  :                 :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :  :  :                 :  +- SubqueryAlias web_sales\n               :  :  :  :  :                 :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :  :  :  :  :                 +- SubqueryAlias date_dim\n               :  :  :  :  :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :  :  +- SubqueryAlias t_s_secyear\n               :  :  :  :     +- SubqueryAlias year_total\n               :  :  :  :        +- Union\n               :  :  :  :           :- Union\n               :  :  :  :           :  :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10231, c_first_name#868 AS customer_first_name#10232, c_last_name#869 AS customer_last_name#10233, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10234, c_birth_country#874 AS customer_birth_country#10235, c_login#875 AS customer_login#10236, c_email_address#876 AS customer_email_address#10237, d_year#1046 AS dyear#10238, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_wholesale_cost#1919 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ss_ext_sales_price#1918 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10239, s AS sale_type#10240]\n               :  :  :  :           :  :  +- Filter ((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040))\n               :  :  :  :           :  :     +- Join Inner\n               :  :  :  :           :  :        :- Join Inner\n               :  :  :  :           :  :        :  :- SubqueryAlias customer\n               :  :  :  :           :  :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :  :           :  :        :  +- SubqueryAlias store_sales\n               :  :  :  :           :  :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :  :  :           :  :        +- SubqueryAlias date_dim\n               :  :  :  :           :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :  :           :  +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10208, c_first_name#868 AS customer_first_name#10209, c_last_name#869 AS customer_last_name#10210, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10211, c_birth_country#874 AS customer_birth_country#10212, c_login#875 AS customer_login#10213, c_email_address#876 AS customer_email_address#10214, d_year#1046 AS dyear#10215, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_ext_list_price#1813 as decimal(8,2))) - promote_precision(cast(cs_ext_wholesale_cost#1812 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(cs_ext_discount_amt#1810 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(cs_ext_sales_price#1811 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10216, c AS sale_type#10217]\n               :  :  :  :           :     +- Filter ((c_customer_sk#860 = cs_bill_customer_sk#1791) && (cs_sold_date_sk#1822 = d_date_sk#1040))\n               :  :  :  :           :        +- Join Inner\n               :  :  :  :           :           :- Join Inner\n               :  :  :  :           :           :  :- SubqueryAlias customer\n               :  :  :  :           :           :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :  :           :           :  +- SubqueryAlias catalog_sales\n               :  :  :  :           :           :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :  :  :  :           :           +- SubqueryAlias date_dim\n               :  :  :  :           :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :  :           +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10218, c_first_name#868 AS customer_first_name#10219, c_last_name#869 AS customer_last_name#10220, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10221, c_birth_country#874 AS customer_birth_country#10222, c_login#875 AS customer_login#10223, c_email_address#876 AS customer_email_address#10224, d_year#1046 AS dyear#10225, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_wholesale_cost#1778 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ws_ext_sales_price#1777 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10226, w AS sale_type#10227]\n               :  :  :  :              +- Filter ((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040))\n               :  :  :  :                 +- Join Inner\n               :  :  :  :                    :- Join Inner\n               :  :  :  :                    :  :- SubqueryAlias customer\n               :  :  :  :                    :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :  :                    :  +- SubqueryAlias web_sales\n               :  :  :  :                    :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :  :  :  :                    +- SubqueryAlias date_dim\n               :  :  :  :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :  +- SubqueryAlias t_c_firstyear\n               :  :  :     +- SubqueryAlias year_total\n               :  :  :        +- Union\n               :  :  :           :- Union\n               :  :  :           :  :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10241, c_first_name#868 AS customer_first_name#10242, c_last_name#869 AS customer_last_name#10243, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10244, c_birth_country#874 AS customer_birth_country#10245, c_login#875 AS customer_login#10246, c_email_address#876 AS customer_email_address#10247, d_year#1046 AS dyear#10248, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_wholesale_cost#1919 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ss_ext_sales_price#1918 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10249, s AS sale_type#10250]\n               :  :  :           :  :  +- Filter ((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040))\n               :  :  :           :  :     +- Join Inner\n               :  :  :           :  :        :- Join Inner\n               :  :  :           :  :        :  :- SubqueryAlias customer\n               :  :  :           :  :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :           :  :        :  +- SubqueryAlias store_sales\n               :  :  :           :  :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :  :           :  :        +- SubqueryAlias date_dim\n               :  :  :           :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :           :  +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10208, c_first_name#868 AS customer_first_name#10209, c_last_name#869 AS customer_last_name#10210, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10211, c_birth_country#874 AS customer_birth_country#10212, c_login#875 AS customer_login#10213, c_email_address#876 AS customer_email_address#10214, d_year#1046 AS dyear#10215, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_ext_list_price#1813 as decimal(8,2))) - promote_precision(cast(cs_ext_wholesale_cost#1812 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(cs_ext_discount_amt#1810 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(cs_ext_sales_price#1811 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10216, c AS sale_type#10217]\n               :  :  :           :     +- Filter ((c_customer_sk#860 = cs_bill_customer_sk#1791) && (cs_sold_date_sk#1822 = d_date_sk#1040))\n               :  :  :           :        +- Join Inner\n               :  :  :           :           :- Join Inner\n               :  :  :           :           :  :- SubqueryAlias customer\n               :  :  :           :           :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :           :           :  +- SubqueryAlias catalog_sales\n               :  :  :           :           :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :  :  :           :           +- SubqueryAlias date_dim\n               :  :  :           :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :           +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10218, c_first_name#868 AS customer_first_name#10219, c_last_name#869 AS customer_last_name#10220, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10221, c_birth_country#874 AS customer_birth_country#10222, c_login#875 AS customer_login#10223, c_email_address#876 AS customer_email_address#10224, d_year#1046 AS dyear#10225, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_wholesale_cost#1778 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ws_ext_sales_price#1777 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10226, w AS sale_type#10227]\n               :  :  :              +- Filter ((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040))\n               :  :  :                 +- Join Inner\n               :  :  :                    :- Join Inner\n               :  :  :                    :  :- SubqueryAlias customer\n               :  :  :                    :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :                    :  +- SubqueryAlias web_sales\n               :  :  :                    :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :  :  :                    +- SubqueryAlias date_dim\n               :  :  :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  +- SubqueryAlias t_c_secyear\n               :  :     +- SubqueryAlias year_total\n               :  :        +- Union\n               :  :           :- Union\n               :  :           :  :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10251, c_first_name#868 AS customer_first_name#10252, c_last_name#869 AS customer_last_name#10253, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10254, c_birth_country#874 AS customer_birth_country#10255, c_login#875 AS customer_login#10256, c_email_address#876 AS customer_email_address#10257, d_year#1046 AS dyear#10258, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_wholesale_cost#1919 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ss_ext_sales_price#1918 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10259, s AS sale_type#10260]\n               :  :           :  :  +- Filter ((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040))\n               :  :           :  :     +- Join Inner\n               :  :           :  :        :- Join Inner\n               :  :           :  :        :  :- SubqueryAlias customer\n               :  :           :  :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :           :  :        :  +- SubqueryAlias store_sales\n               :  :           :  :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :           :  :        +- SubqueryAlias date_dim\n               :  :           :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :           :  +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10208, c_first_name#868 AS customer_first_name#10209, c_last_name#869 AS customer_last_name#10210, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10211, c_birth_country#874 AS customer_birth_country#10212, c_login#875 AS customer_login#10213, c_email_address#876 AS customer_email_address#10214, d_year#1046 AS dyear#10215, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_ext_list_price#1813 as decimal(8,2))) - promote_precision(cast(cs_ext_wholesale_cost#1812 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(cs_ext_discount_amt#1810 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(cs_ext_sales_price#1811 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10216, c AS sale_type#10217]\n               :  :           :     +- Filter ((c_customer_sk#860 = cs_bill_customer_sk#1791) && (cs_sold_date_sk#1822 = d_date_sk#1040))\n               :  :           :        +- Join Inner\n               :  :           :           :- Join Inner\n               :  :           :           :  :- SubqueryAlias customer\n               :  :           :           :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :           :           :  +- SubqueryAlias catalog_sales\n               :  :           :           :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :  :           :           +- SubqueryAlias date_dim\n               :  :           :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :           +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10218, c_first_name#868 AS customer_first_name#10219, c_last_name#869 AS customer_last_name#10220, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10221, c_birth_country#874 AS customer_birth_country#10222, c_login#875 AS customer_login#10223, c_email_address#876 AS customer_email_address#10224, d_year#1046 AS dyear#10225, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_wholesale_cost#1778 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ws_ext_sales_price#1777 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10226, w AS sale_type#10227]\n               :  :              +- Filter ((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040))\n               :  :                 +- Join Inner\n               :  :                    :- Join Inner\n               :  :                    :  :- SubqueryAlias customer\n               :  :                    :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :                    :  +- SubqueryAlias web_sales\n               :  :                    :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :  :                    +- SubqueryAlias date_dim\n               :  :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  +- SubqueryAlias t_w_firstyear\n               :     +- SubqueryAlias year_total\n               :        +- Union\n               :           :- Union\n               :           :  :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10261, c_first_name#868 AS customer_first_name#10262, c_last_name#869 AS customer_last_name#10263, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10264, c_birth_country#874 AS customer_birth_country#10265, c_login#875 AS customer_login#10266, c_email_address#876 AS customer_email_address#10267, d_year#1046 AS dyear#10268, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_wholesale_cost#1919 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ss_ext_sales_price#1918 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10269, s AS sale_type#10270]\n               :           :  :  +- Filter ((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040))\n               :           :  :     +- Join Inner\n               :           :  :        :- Join Inner\n               :           :  :        :  :- SubqueryAlias customer\n               :           :  :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :           :  :        :  +- SubqueryAlias store_sales\n               :           :  :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :           :  :        +- SubqueryAlias date_dim\n               :           :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :           :  +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10208, c_first_name#868 AS customer_first_name#10209, c_last_name#869 AS customer_last_name#10210, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10211, c_birth_country#874 AS customer_birth_country#10212, c_login#875 AS customer_login#10213, c_email_address#876 AS customer_email_address#10214, d_year#1046 AS dyear#10215, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_ext_list_price#1813 as decimal(8,2))) - promote_precision(cast(cs_ext_wholesale_cost#1812 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(cs_ext_discount_amt#1810 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(cs_ext_sales_price#1811 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10216, c AS sale_type#10217]\n               :           :     +- Filter ((c_customer_sk#860 = cs_bill_customer_sk#1791) && (cs_sold_date_sk#1822 = d_date_sk#1040))\n               :           :        +- Join Inner\n               :           :           :- Join Inner\n               :           :           :  :- SubqueryAlias customer\n               :           :           :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :           :           :  +- SubqueryAlias catalog_sales\n               :           :           :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :           :           +- SubqueryAlias date_dim\n               :           :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :           +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10218, c_first_name#868 AS customer_first_name#10219, c_last_name#869 AS customer_last_name#10220, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10221, c_birth_country#874 AS customer_birth_country#10222, c_login#875 AS customer_login#10223, c_email_address#876 AS customer_email_address#10224, d_year#1046 AS dyear#10225, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_wholesale_cost#1778 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ws_ext_sales_price#1777 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10226, w AS sale_type#10227]\n               :              +- Filter ((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040))\n               :                 +- Join Inner\n               :                    :- Join Inner\n               :                    :  :- SubqueryAlias customer\n               :                    :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :                    :  +- SubqueryAlias web_sales\n               :                    :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :                    +- SubqueryAlias date_dim\n               :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- SubqueryAlias t_w_secyear\n                  +- SubqueryAlias year_total\n                     +- Union\n                        :- Union\n                        :  :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10271, c_first_name#868 AS customer_first_name#10272, c_last_name#869 AS customer_last_name#10273, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10274, c_birth_country#874 AS customer_birth_country#10275, c_login#875 AS customer_login#10276, c_email_address#876 AS customer_email_address#10277, d_year#1046 AS dyear#10278, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_wholesale_cost#1919 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ss_ext_sales_price#1918 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10279, s AS sale_type#10280]\n                        :  :  +- Filter ((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040))\n                        :  :     +- Join Inner\n                        :  :        :- Join Inner\n                        :  :        :  :- SubqueryAlias customer\n                        :  :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                        :  :        :  +- SubqueryAlias store_sales\n                        :  :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :  :        +- SubqueryAlias date_dim\n                        :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :  +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10208, c_first_name#868 AS customer_first_name#10209, c_last_name#869 AS customer_last_name#10210, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10211, c_birth_country#874 AS customer_birth_country#10212, c_login#875 AS customer_login#10213, c_email_address#876 AS customer_email_address#10214, d_year#1046 AS dyear#10215, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_ext_list_price#1813 as decimal(8,2))) - promote_precision(cast(cs_ext_wholesale_cost#1812 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(cs_ext_discount_amt#1810 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(cs_ext_sales_price#1811 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10216, c AS sale_type#10217]\n                        :     +- Filter ((c_customer_sk#860 = cs_bill_customer_sk#1791) && (cs_sold_date_sk#1822 = d_date_sk#1040))\n                        :        +- Join Inner\n                        :           :- Join Inner\n                        :           :  :- SubqueryAlias customer\n                        :           :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                        :           :  +- SubqueryAlias catalog_sales\n                        :           :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                        :           +- SubqueryAlias date_dim\n                        :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10218, c_first_name#868 AS customer_first_name#10219, c_last_name#869 AS customer_last_name#10220, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10221, c_birth_country#874 AS customer_birth_country#10222, c_login#875 AS customer_login#10223, c_email_address#876 AS customer_email_address#10224, d_year#1046 AS dyear#10225, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_wholesale_cost#1778 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ws_ext_sales_price#1777 as decimal(10,2)))), DecimalType(10,2)) as decimal(10,2))) / promote_precision(cast(cast(2 as decimal(1,0)) as decimal(10,2)))), DecimalType(14,6))) AS year_total#10226, w AS sale_type#10227]\n                           +- Filter ((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040))\n                              +- Join Inner\n                                 :- Join Inner\n                                 :  :- SubqueryAlias customer\n                                 :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                                 :  +- SubqueryAlias web_sales\n                                 :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                                 +- SubqueryAlias date_dim\n                                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [customer_id#10231 ASC NULLS FIRST, customer_first_name#10232 ASC NULLS FIRST, customer_last_name#10233 ASC NULLS FIRST, customer_preferred_cust_flag#10234 ASC NULLS FIRST], true\n      +- Project [customer_id#10231, customer_first_name#10232, customer_last_name#10233, customer_preferred_cust_flag#10234]\n         +- Join Inner, ((customer_id#10198 = customer_id#10271) && (CASE WHEN (year_total#10249 > 0.000000) THEN CheckOverflow((promote_precision(year_total#10259) / promote_precision(year_total#10249)), DecimalType(38,14)) ELSE null END > CASE WHEN (year_total#10269 > 0.000000) THEN CheckOverflow((promote_precision(year_total#10279) / promote_precision(year_total#10269)), DecimalType(38,14)) ELSE null END))\n            :- Project [customer_id#10198, customer_id#10231, customer_first_name#10232, customer_last_name#10233, customer_preferred_cust_flag#10234, year_total#10249, year_total#10259, year_total#10269]\n            :  +- Join Inner, (customer_id#10198 = customer_id#10261)\n            :     :- Project [customer_id#10198, customer_id#10231, customer_first_name#10232, customer_last_name#10233, customer_preferred_cust_flag#10234, year_total#10249, year_total#10259]\n            :     :  +- Join Inner, ((customer_id#10198 = customer_id#10251) && (CASE WHEN (year_total#10249 > 0.000000) THEN CheckOverflow((promote_precision(year_total#10259) / promote_precision(year_total#10249)), DecimalType(38,14)) ELSE null END > CASE WHEN (year_total#10206 > 0.000000) THEN CheckOverflow((promote_precision(year_total#10239) / promote_precision(year_total#10206)), DecimalType(38,14)) ELSE null END))\n            :     :     :- Project [customer_id#10198, year_total#10206, customer_id#10231, customer_first_name#10232, customer_last_name#10233, customer_preferred_cust_flag#10234, year_total#10239, year_total#10249]\n            :     :     :  +- Join Inner, (customer_id#10198 = customer_id#10241)\n            :     :     :     :- Join Inner, (customer_id#10231 = customer_id#10198)\n            :     :     :     :  :- Union\n            :     :     :     :  :  :- Filter (isnotnull(year_total#10206) && (year_total#10206 > 0.000000))\n            :     :     :     :  :  :  +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10198, sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_wholesale_cost#1919 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ss_ext_sales_price#1918 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6))) AS year_total#10206]\n            :     :     :     :  :  :     +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, d_year#1046]\n            :     :     :     :  :  :        +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :     :     :     :  :  :           :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n            :     :     :     :  :  :           :  +- Join Inner, (c_customer_sk#860 = ss_customer_sk#1906)\n            :     :     :     :  :  :           :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876]\n            :     :     :     :  :  :           :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n            :     :     :     :  :  :           :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :     :     :     :  :  :           :     +- Project [ss_customer_sk#1906, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n            :     :     :     :  :  :           :        +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n            :     :     :     :  :  :           :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :     :     :  :  :           +- Project [d_date_sk#1040, d_year#1046]\n            :     :     :     :  :  :              +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n            :     :     :     :  :  :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :     :     :  :  :- LocalRelation <empty>, [customer_id#10208, year_total#10216]\n            :     :     :     :  :  +- LocalRelation <empty>, [customer_id#10218, year_total#10226]\n            :     :     :     :  +- Union\n            :     :     :     :     :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10231, c_first_name#868 AS customer_first_name#10232, c_last_name#869 AS customer_last_name#10233, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#10234, sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_wholesale_cost#1919 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ss_ext_sales_price#1918 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6))) AS year_total#10239]\n            :     :     :     :     :  +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, d_year#1046]\n            :     :     :     :     :     +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :     :     :     :     :        :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n            :     :     :     :     :        :  +- Join Inner, (c_customer_sk#860 = ss_customer_sk#1906)\n            :     :     :     :     :        :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876]\n            :     :     :     :     :        :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n            :     :     :     :     :        :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :     :     :     :     :        :     +- Project [ss_customer_sk#1906, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n            :     :     :     :     :        :        +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n            :     :     :     :     :        :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :     :     :     :        +- Project [d_date_sk#1040, d_year#1046]\n            :     :     :     :     :           +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n            :     :     :     :     :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :     :     :     :- LocalRelation <empty>, [customer_id#10208, customer_first_name#10209, customer_last_name#10210, customer_preferred_cust_flag#10211, year_total#10216]\n            :     :     :     :     +- LocalRelation <empty>, [customer_id#10218, customer_first_name#10219, customer_last_name#10220, customer_preferred_cust_flag#10221, year_total#10226]\n            :     :     :     +- Union\n            :     :     :        :- LocalRelation <empty>, [customer_id#10241, year_total#10249]\n            :     :     :        :- Filter (isnotnull(year_total#10216) && (year_total#10216 > 0.000000))\n            :     :     :        :  +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10208, sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_ext_list_price#1813 as decimal(8,2))) - promote_precision(cast(cs_ext_wholesale_cost#1812 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(cs_ext_discount_amt#1810 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(cs_ext_sales_price#1811 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6))) AS year_total#10216]\n            :     :     :        :     +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, d_year#1046]\n            :     :     :        :        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n            :     :     :        :           :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_sold_date_sk#1822]\n            :     :     :        :           :  +- Join Inner, (c_customer_sk#860 = cs_bill_customer_sk#1791)\n            :     :     :        :           :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876]\n            :     :     :        :           :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n            :     :     :        :           :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :     :     :        :           :     +- Project [cs_bill_customer_sk#1791, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_sold_date_sk#1822]\n            :     :     :        :           :        +- Filter (isnotnull(cs_bill_customer_sk#1791) && isnotnull(cs_sold_date_sk#1822))\n            :     :     :        :           :           +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :     :     :        :           +- Project [d_date_sk#1040, d_year#1046]\n            :     :     :        :              +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n            :     :     :        :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :     :        +- LocalRelation <empty>, [customer_id#10218, year_total#10226]\n            :     :     +- Union\n            :     :        :- LocalRelation <empty>, [customer_id#10251, year_total#10259]\n            :     :        :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10208, sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_ext_list_price#1813 as decimal(8,2))) - promote_precision(cast(cs_ext_wholesale_cost#1812 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(cs_ext_discount_amt#1810 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(cs_ext_sales_price#1811 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6))) AS year_total#10216]\n            :     :        :  +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, d_year#1046]\n            :     :        :     +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n            :     :        :        :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_sold_date_sk#1822]\n            :     :        :        :  +- Join Inner, (c_customer_sk#860 = cs_bill_customer_sk#1791)\n            :     :        :        :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876]\n            :     :        :        :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n            :     :        :        :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :     :        :        :     +- Project [cs_bill_customer_sk#1791, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_sold_date_sk#1822]\n            :     :        :        :        +- Filter (isnotnull(cs_bill_customer_sk#1791) && isnotnull(cs_sold_date_sk#1822))\n            :     :        :        :           +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :     :        :        +- Project [d_date_sk#1040, d_year#1046]\n            :     :        :           +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n            :     :        :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :        +- LocalRelation <empty>, [customer_id#10218, year_total#10226]\n            :     +- Union\n            :        :- LocalRelation <empty>, [customer_id#10261, year_total#10269]\n            :        :- LocalRelation <empty>, [customer_id#10208, year_total#10216]\n            :        +- Filter (isnotnull(year_total#10226) && (year_total#10226 > 0.000000))\n            :           +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10218, sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_wholesale_cost#1778 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ws_ext_sales_price#1777 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6))) AS year_total#10226]\n            :              +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, d_year#1046]\n            :                 +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n            :                    :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n            :                    :  +- Join Inner, (c_customer_sk#860 = ws_bill_customer_sk#1758)\n            :                    :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876]\n            :                    :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n            :                    :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :                    :     +- Project [ws_bill_customer_sk#1758, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n            :                    :        +- Filter (isnotnull(ws_bill_customer_sk#1758) && isnotnull(ws_sold_date_sk#1788))\n            :                    :           +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :                    +- Project [d_date_sk#1040, d_year#1046]\n            :                       +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n            :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Union\n               :- LocalRelation <empty>, [customer_id#10271, year_total#10279]\n               :- LocalRelation <empty>, [customer_id#10208, year_total#10216]\n               +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#10218, sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_wholesale_cost#1778 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ws_ext_sales_price#1777 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6))) AS year_total#10226]\n                  +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, d_year#1046]\n                     +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                        :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n                        :  +- Join Inner, (c_customer_sk#860 = ws_bill_customer_sk#1758)\n                        :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876]\n                        :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n                        :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                        :     +- Project [ws_bill_customer_sk#1758, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n                        :        +- Filter (isnotnull(ws_bill_customer_sk#1758) && isnotnull(ws_sold_date_sk#1788))\n                        :           +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        +- Project [d_date_sk#1040, d_year#1046]\n                           +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n                              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[customer_id#10231 ASC NULLS FIRST,customer_first_name#10232 ASC NULLS FIRST,customer_last_name#10233 ASC NULLS FIRST,customer_preferred_cust_flag#10234 ASC NULLS FIRST], output=[customer_id#10231,customer_first_name#10232,customer_last_name#10233,customer_preferred_cust_flag#10234])\n+- *(35) Project [customer_id#10231, customer_first_name#10232, customer_last_name#10233, customer_preferred_cust_flag#10234]\n   +- *(35) SortMergeJoin [customer_id#10198], [customer_id#10271], Inner, (CASE WHEN (year_total#10249 > 0.000000) THEN CheckOverflow((promote_precision(year_total#10259) / promote_precision(year_total#10249)), DecimalType(38,14)) ELSE null END > CASE WHEN (year_total#10269 > 0.000000) THEN CheckOverflow((promote_precision(year_total#10279) / promote_precision(year_total#10269)), DecimalType(38,14)) ELSE null END)\n      :- *(29) Project [customer_id#10198, customer_id#10231, customer_first_name#10232, customer_last_name#10233, customer_preferred_cust_flag#10234, year_total#10249, year_total#10259, year_total#10269]\n      :  +- *(29) SortMergeJoin [customer_id#10198], [customer_id#10261], Inner\n      :     :- *(23) Project [customer_id#10198, customer_id#10231, customer_first_name#10232, customer_last_name#10233, customer_preferred_cust_flag#10234, year_total#10249, year_total#10259]\n      :     :  +- *(23) SortMergeJoin [customer_id#10198], [customer_id#10251], Inner, (CASE WHEN (year_total#10249 > 0.000000) THEN CheckOverflow((promote_precision(year_total#10259) / promote_precision(year_total#10249)), DecimalType(38,14)) ELSE null END > CASE WHEN (year_total#10206 > 0.000000) THEN CheckOverflow((promote_precision(year_total#10239) / promote_precision(year_total#10206)), DecimalType(38,14)) ELSE null END)\n      :     :     :- *(17) Project [customer_id#10198, year_total#10206, customer_id#10231, customer_first_name#10232, customer_last_name#10233, customer_preferred_cust_flag#10234, year_total#10239, year_total#10249]\n      :     :     :  +- *(17) SortMergeJoin [customer_id#10198], [customer_id#10241], Inner\n      :     :     :     :- *(11) SortMergeJoin [customer_id#10198], [customer_id#10231], Inner\n      :     :     :     :  :- *(5) Sort [customer_id#10198 ASC NULLS FIRST], false, 0\n      :     :     :     :  :  +- Exchange hashpartitioning(customer_id#10198, 200)\n      :     :     :     :  :     +- Union\n      :     :     :     :  :        :- *(4) Filter (isnotnull(year_total#10206) && (year_total#10206 > 0.000000))\n      :     :     :     :  :        :  +- *(4) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_wholesale_cost#1919 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ss_ext_sales_price#1918 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6)))], output=[customer_id#10198, year_total#10206])\n      :     :     :     :  :        :     +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, 200)\n      :     :     :     :  :        :        +- *(3) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[partial_sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_wholesale_cost#1919 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ss_ext_sales_price#1918 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6)))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, sum#10286])\n      :     :     :     :  :        :           +- *(3) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, d_year#1046]\n      :     :     :     :  :        :              +- *(3) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :     :     :     :  :        :                 :- *(3) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n      :     :     :     :  :        :                 :  +- *(3) BroadcastHashJoin [c_customer_sk#860], [ss_customer_sk#1906], Inner, BuildLeft\n      :     :     :     :  :        :                 :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :     :     :  :        :                 :     :  +- *(1) Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876]\n      :     :     :     :  :        :                 :     :     +- *(1) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n      :     :     :     :  :        :                 :     :        +- *(1) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_customer_id#861,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_country#874,c_login#875,c_email_address#876] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_...\n      :     :     :     :  :        :                 :     +- *(3) Project [ss_customer_sk#1906, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n      :     :     :     :  :        :                 :        +- *(3) Filter isnotnull(ss_customer_sk#1906)\n      :     :     :     :  :        :                 :           +- *(3) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_ext_discount_amt:decimal(7,2),ss_ext_sales_price:decimal(7,2),ss_ext...\n      :     :     :     :  :        :                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :     :     :  :        :                    +- *(2) Project [d_date_sk#1040, d_year#1046]\n      :     :     :     :  :        :                       +- *(2) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n      :     :     :     :  :        :                          +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n      :     :     :     :  :        :- LocalTableScan <empty>, [customer_id#10208, year_total#10216]\n      :     :     :     :  :        +- LocalTableScan <empty>, [customer_id#10218, year_total#10226]\n      :     :     :     :  +- *(10) Sort [customer_id#10231 ASC NULLS FIRST], false, 0\n      :     :     :     :     +- Exchange hashpartitioning(customer_id#10231, 200)\n      :     :     :     :        +- Union\n      :     :     :     :           :- *(9) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_wholesale_cost#1919 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ss_ext_sales_price#1918 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6)))], output=[customer_id#10231, customer_first_name#10232, customer_last_name#10233, customer_preferred_cust_flag#10234, year_total#10239])\n      :     :     :     :           :  +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, 200)\n      :     :     :     :           :     +- *(8) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[partial_sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_wholesale_cost#1919 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ss_ext_sales_price#1918 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6)))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, sum#10288])\n      :     :     :     :           :        +- *(8) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, d_year#1046]\n      :     :     :     :           :           +- *(8) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :     :     :     :           :              :- *(8) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n      :     :     :     :           :              :  +- *(8) BroadcastHashJoin [c_customer_sk#860], [ss_customer_sk#1906], Inner, BuildLeft\n      :     :     :     :           :              :     :- ReusedExchange [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :     :     :           :              :     +- *(8) Project [ss_customer_sk#1906, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n      :     :     :     :           :              :        +- *(8) Filter isnotnull(ss_customer_sk#1906)\n      :     :     :     :           :              :           +- *(8) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_ext_discount_amt:decimal(7,2),ss_ext_sales_price:decimal(7,2),ss_ext...\n      :     :     :     :           :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :     :     :           :                 +- *(7) Project [d_date_sk#1040, d_year#1046]\n      :     :     :     :           :                    +- *(7) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n      :     :     :     :           :                       +- *(7) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n      :     :     :     :           :- LocalTableScan <empty>, [customer_id#10208, customer_first_name#10209, customer_last_name#10210, customer_preferred_cust_flag#10211, year_total#10216]\n      :     :     :     :           +- LocalTableScan <empty>, [customer_id#10218, customer_first_name#10219, customer_last_name#10220, customer_preferred_cust_flag#10221, year_total#10226]\n      :     :     :     +- *(16) Sort [customer_id#10241 ASC NULLS FIRST], false, 0\n      :     :     :        +- Exchange hashpartitioning(customer_id#10241, 200)\n      :     :     :           +- Union\n      :     :     :              :- LocalTableScan <empty>, [customer_id#10241, year_total#10249]\n      :     :     :              :- *(15) Filter (isnotnull(year_total#10216) && (year_total#10216 > 0.000000))\n      :     :     :              :  +- *(15) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_ext_list_price#1813 as decimal(8,2))) - promote_precision(cast(cs_ext_wholesale_cost#1812 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(cs_ext_discount_amt#1810 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(cs_ext_sales_price#1811 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6)))], output=[customer_id#10208, year_total#10216])\n      :     :     :              :     +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, 200)\n      :     :     :              :        +- *(14) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[partial_sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_ext_list_price#1813 as decimal(8,2))) - promote_precision(cast(cs_ext_wholesale_cost#1812 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(cs_ext_discount_amt#1810 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(cs_ext_sales_price#1811 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6)))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, sum#10290])\n      :     :     :              :           +- *(14) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, d_year#1046]\n      :     :     :              :              +- *(14) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n      :     :     :              :                 :- *(14) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_sold_date_sk#1822]\n      :     :     :              :                 :  +- *(14) BroadcastHashJoin [c_customer_sk#860], [cs_bill_customer_sk#1791], Inner, BuildLeft\n      :     :     :              :                 :     :- ReusedExchange [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :     :              :                 :     +- *(14) Project [cs_bill_customer_sk#1791, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_sold_date_sk#1822]\n      :     :     :              :                 :        +- *(14) Filter isnotnull(cs_bill_customer_sk#1791)\n      :     :     :              :                 :           +- *(14) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,cs_ext_list_price#1813,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:int,cs_ext_discount_amt:decimal(7,2),cs_ext_sales_price:decimal(7,2),c...\n      :     :     :              :                 +- ReusedExchange [d_date_sk#1040, d_year#1046], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :     :              +- LocalTableScan <empty>, [customer_id#10218, year_total#10226]\n      :     :     +- *(22) Sort [customer_id#10251 ASC NULLS FIRST], false, 0\n      :     :        +- Exchange hashpartitioning(customer_id#10251, 200)\n      :     :           +- Union\n      :     :              :- LocalTableScan <empty>, [customer_id#10251, year_total#10259]\n      :     :              :- *(21) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_ext_list_price#1813 as decimal(8,2))) - promote_precision(cast(cs_ext_wholesale_cost#1812 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(cs_ext_discount_amt#1810 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(cs_ext_sales_price#1811 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6)))], output=[customer_id#10208, year_total#10216])\n      :     :              :  +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, 200)\n      :     :              :     +- *(20) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[partial_sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_ext_list_price#1813 as decimal(8,2))) - promote_precision(cast(cs_ext_wholesale_cost#1812 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(cs_ext_discount_amt#1810 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(cs_ext_sales_price#1811 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6)))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, sum#10292])\n      :     :              :        +- *(20) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, d_year#1046]\n      :     :              :           +- *(20) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n      :     :              :              :- *(20) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_sold_date_sk#1822]\n      :     :              :              :  +- *(20) BroadcastHashJoin [c_customer_sk#860], [cs_bill_customer_sk#1791], Inner, BuildLeft\n      :     :              :              :     :- ReusedExchange [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :              :              :     +- *(20) Project [cs_bill_customer_sk#1791, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_sold_date_sk#1822]\n      :     :              :              :        +- *(20) Filter isnotnull(cs_bill_customer_sk#1791)\n      :     :              :              :           +- *(20) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,cs_ext_list_price#1813,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:int,cs_ext_discount_amt:decimal(7,2),cs_ext_sales_price:decimal(7,2),c...\n      :     :              :              +- ReusedExchange [d_date_sk#1040, d_year#1046], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :              +- LocalTableScan <empty>, [customer_id#10218, year_total#10226]\n      :     +- *(28) Sort [customer_id#10261 ASC NULLS FIRST], false, 0\n      :        +- Exchange hashpartitioning(customer_id#10261, 200)\n      :           +- Union\n      :              :- LocalTableScan <empty>, [customer_id#10261, year_total#10269]\n      :              :- LocalTableScan <empty>, [customer_id#10208, year_total#10216]\n      :              +- *(27) Filter (isnotnull(year_total#10226) && (year_total#10226 > 0.000000))\n      :                 +- *(27) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_wholesale_cost#1778 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ws_ext_sales_price#1777 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6)))], output=[customer_id#10218, year_total#10226])\n      :                    +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, 200)\n      :                       +- *(26) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[partial_sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_wholesale_cost#1778 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ws_ext_sales_price#1777 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6)))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, sum#10294])\n      :                          +- *(26) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, d_year#1046]\n      :                             +- *(26) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n      :                                :- *(26) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n      :                                :  +- *(26) BroadcastHashJoin [c_customer_sk#860], [ws_bill_customer_sk#1758], Inner, BuildLeft\n      :                                :     :- ReusedExchange [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                                :     +- *(26) Project [ws_bill_customer_sk#1758, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n      :                                :        +- *(26) Filter isnotnull(ws_bill_customer_sk#1758)\n      :                                :           +- *(26) FileScan parquet db_tpcds.web_sales[ws_bill_customer_sk#1758,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,ws_ext_list_price#1779,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:int,ws_ext_discount_amt:decimal(7,2),ws_ext_sales_price:decimal(7,2),w...\n      :                                +- ReusedExchange [d_date_sk#1040, d_year#1046], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      +- *(34) Sort [customer_id#10271 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(customer_id#10271, 200)\n            +- Union\n               :- LocalTableScan <empty>, [customer_id#10271, year_total#10279]\n               :- LocalTableScan <empty>, [customer_id#10208, year_total#10216]\n               +- *(33) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_wholesale_cost#1778 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ws_ext_sales_price#1777 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6)))], output=[customer_id#10218, year_total#10226])\n                  +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, 200)\n                     +- *(32) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[partial_sum(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_wholesale_cost#1778 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(9,2)))), DecimalType(9,2)) as decimal(10,2))) + promote_precision(cast(ws_ext_sales_price#1777 as decimal(10,2)))), DecimalType(10,2))) / 2.00), DecimalType(14,6)))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, sum#10296])\n                        +- *(32) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, d_year#1046]\n                           +- *(32) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                              :- *(32) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n                              :  +- *(32) BroadcastHashJoin [c_customer_sk#860], [ws_bill_customer_sk#1758], Inner, BuildLeft\n                              :     :- ReusedExchange [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     +- *(32) Project [ws_bill_customer_sk#1758, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n                              :        +- *(32) Filter isnotnull(ws_bill_customer_sk#1758)\n                              :           +- *(32) FileScan parquet db_tpcds.web_sales[ws_bill_customer_sk#1758,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,ws_ext_list_price#1779,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:int,ws_ext_discount_amt:decimal(7,2),ws_ext_sales_price:decimal(7,2),w...\n                              +- ReusedExchange [d_date_sk#1040, d_year#1046], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q5-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["ssr","csr","wsr"],"parsingTime":0.002472,"analysisTime":6.79E-4,"optimizationTime":1490.064635,"planningTime":302.644929,"executionTime":14292.974508,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ssr, csr, wsr]\n:  :- 'SubqueryAlias ssr\n:  :  +- 'Aggregate ['s_store_id], ['s_store_id, 'sum('sales_price) AS sales#10537, 'sum('profit) AS profit#10538, 'sum('return_amt) AS returns#10539, 'sum('net_loss) AS profit_loss#10540]\n:  :     +- 'Filter ((('date_sk = 'd_date_sk) && (('d_date >= cast(2000-08-23 as date)) && ('d_date <= (cast(2000-08-23 as date) + interval 2 weeks)))) && ('store_sk = 's_store_sk))\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'SubqueryAlias salesreturns\n:  :           :  :  +- 'Union\n:  :           :  :     :- 'Project ['ss_store_sk AS store_sk#10525, 'ss_sold_date_sk AS date_sk#10526, 'ss_ext_sales_price AS sales_price#10527, 'ss_net_profit AS profit#10528, cast(0 as decimal(7,2)) AS return_amt#10529, cast(0 as decimal(7,2)) AS net_loss#10530]\n:  :           :  :     :  +- 'UnresolvedRelation `store_sales`\n:  :           :  :     +- 'Project ['sr_store_sk AS store_sk#10531, 'sr_returned_date_sk AS date_sk#10532, cast(0 as decimal(7,2)) AS sales_price#10533, cast(0 as decimal(7,2)) AS profit#10534, 'sr_return_amt AS return_amt#10535, 'sr_net_loss AS net_loss#10536]\n:  :           :  :        +- 'UnresolvedRelation `store_returns`\n:  :           :  +- 'UnresolvedRelation `date_dim`\n:  :           +- 'UnresolvedRelation `store`\n:  :- 'SubqueryAlias csr\n:  :  +- 'Aggregate ['cp_catalog_page_id], ['cp_catalog_page_id, 'sum('sales_price) AS sales#10553, 'sum('profit) AS profit#10554, 'sum('return_amt) AS returns#10555, 'sum('net_loss) AS profit_loss#10556]\n:  :     +- 'Filter ((('date_sk = 'd_date_sk) && (('d_date >= cast(2000-08-23 as date)) && ('d_date <= (cast(2000-08-23 as date) + interval 2 weeks)))) && ('page_sk = 'cp_catalog_page_sk))\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'SubqueryAlias salesreturns\n:  :           :  :  +- 'Union\n:  :           :  :     :- 'Project ['cs_catalog_page_sk AS page_sk#10541, 'cs_sold_date_sk AS date_sk#10542, 'cs_ext_sales_price AS sales_price#10543, 'cs_net_profit AS profit#10544, cast(0 as decimal(7,2)) AS return_amt#10545, cast(0 as decimal(7,2)) AS net_loss#10546]\n:  :           :  :     :  +- 'UnresolvedRelation `catalog_sales`\n:  :           :  :     +- 'Project ['cr_catalog_page_sk AS page_sk#10547, 'cr_returned_date_sk AS date_sk#10548, cast(0 as decimal(7,2)) AS sales_price#10549, cast(0 as decimal(7,2)) AS profit#10550, 'cr_return_amount AS return_amt#10551, 'cr_net_loss AS net_loss#10552]\n:  :           :  :        +- 'UnresolvedRelation `catalog_returns`\n:  :           :  +- 'UnresolvedRelation `date_dim`\n:  :           +- 'UnresolvedRelation `catalog_page`\n:  +- 'SubqueryAlias wsr\n:     +- 'Aggregate ['web_site_id], ['web_site_id, 'sum('sales_price) AS sales#10569, 'sum('profit) AS profit#10570, 'sum('return_amt) AS returns#10571, 'sum('net_loss) AS profit_loss#10572]\n:        +- 'Filter ((('date_sk = 'd_date_sk) && (('d_date >= cast(2000-08-23 as date)) && ('d_date <= (cast(2000-08-23 as date) + interval 2 weeks)))) && ('wsr_web_site_sk = 'web_site_sk))\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'SubqueryAlias salesreturns\n:              :  :  +- 'Union\n:              :  :     :- 'Project ['ws_web_site_sk AS wsr_web_site_sk#10557, 'ws_sold_date_sk AS date_sk#10558, 'ws_ext_sales_price AS sales_price#10559, 'ws_net_profit AS profit#10560, cast(0 as decimal(7,2)) AS return_amt#10561, cast(0 as decimal(7,2)) AS net_loss#10562]\n:              :  :     :  +- 'UnresolvedRelation `web_sales`\n:              :  :     +- 'Project ['ws_web_site_sk AS wsr_web_site_sk#10563, 'wr_returned_date_sk AS date_sk#10564, cast(0 as decimal(7,2)) AS sales_price#10565, cast(0 as decimal(7,2)) AS profit#10566, 'wr_return_amt AS return_amt#10567, 'wr_net_loss AS net_loss#10568]\n:              :  :        +- 'Join LeftOuter, (('wr_item_sk = 'ws_item_sk) && ('wr_order_number = 'ws_order_number))\n:              :  :           :- 'UnresolvedRelation `web_returns`\n:              :  :           +- 'UnresolvedRelation `web_sales`\n:              :  +- 'UnresolvedRelation `date_dim`\n:              +- 'UnresolvedRelation `web_site`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['channel ASC NULLS FIRST, 'id ASC NULLS FIRST], true\n         +- 'Aggregate ['ROLLUP('channel, 'id)], ['channel, 'id, 'sum('sales) AS sales#10522, 'sum('returns) AS returns#10523, 'sum('profit) AS profit#10524]\n            +- 'SubqueryAlias x\n               +- 'Union\n                  :- 'Union\n                  :  :- 'Project [store channel AS channel#10513, 'concat(store, 's_store_id) AS id#10514, 'sales, 'returns, ('profit - 'profit_loss) AS profit#10515]\n                  :  :  +- 'UnresolvedRelation `ssr`\n                  :  +- 'Project [catalog channel AS channel#10516, 'concat(catalog_page, 'cp_catalog_page_id) AS id#10517, 'sales, 'returns, ('profit - 'profit_loss) AS profit#10518]\n                  :     +- 'UnresolvedRelation `csr`\n                  +- 'Project [web channel AS channel#10519, 'concat(web_site, 'web_site_id) AS id#10520, 'sales, 'returns, ('profit - 'profit_loss) AS profit#10521]\n                     +- 'UnresolvedRelation `wsr`\n\n== Analyzed Logical Plan ==\nchannel: string, id: string, sales: decimal(27,2), returns: decimal(27,2), profit: decimal(28,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#10591 ASC NULLS FIRST, id#10592 ASC NULLS FIRST], true\n      +- Aggregate [channel#10591, id#10592, spark_grouping_id#10588], [channel#10591, id#10592, sum(sales#10537) AS sales#10522, sum(returns#10539) AS returns#10523, sum(profit#10515) AS profit#10524]\n         +- Expand [List(channel#10513, id#10514, sales#10537, returns#10539, profit#10515, channel#10589, id#10590, 0), List(channel#10513, id#10514, sales#10537, returns#10539, profit#10515, channel#10589, null, 1), List(channel#10513, id#10514, sales#10537, returns#10539, profit#10515, null, null, 3)], [channel#10513, id#10514, sales#10537, returns#10539, profit#10515, channel#10591, id#10592, spark_grouping_id#10588]\n            +- Project [channel#10513, id#10514, sales#10537, returns#10539, profit#10515, channel#10513 AS channel#10589, id#10514 AS id#10590]\n               +- SubqueryAlias x\n                  +- Union\n                     :- Union\n                     :  :- Project [store channel AS channel#10513, concat(store, s_store_id#1387) AS id#10514, sales#10537, returns#10539, CheckOverflow((promote_precision(cast(profit#10538 as decimal(18,2))) - promote_precision(cast(profit_loss#10540 as decimal(18,2)))), DecimalType(18,2)) AS profit#10515]\n                     :  :  +- SubqueryAlias ssr\n                     :  :     +- Aggregate [s_store_id#1387], [s_store_id#1387, sum(sales_price#10527) AS sales#10537, sum(profit#10528) AS profit#10538, sum(return_amt#10529) AS returns#10539, sum(net_loss#10530) AS profit_loss#10540]\n                     :  :        +- Filter (((date_sk#10526 = d_date_sk#1040) && ((d_date#1042 >= cast(2000-08-23 as date)) && (d_date#1042 <= cast(cast(cast(2000-08-23 as date) as timestamp) + interval 2 weeks as date)))) && (store_sk#10525 = s_store_sk#1386))\n                     :  :           +- Join Inner\n                     :  :              :- Join Inner\n                     :  :              :  :- SubqueryAlias salesreturns\n                     :  :              :  :  +- Union\n                     :  :              :  :     :- Project [ss_store_sk#1910 AS store_sk#10525, ss_sold_date_sk#1926 AS date_sk#10526, ss_ext_sales_price#1918 AS sales_price#10527, ss_net_profit#1925 AS profit#10528, cast(0 as decimal(7,2)) AS return_amt#10529, cast(0 as decimal(7,2)) AS net_loss#10530]\n                     :  :              :  :     :  +- SubqueryAlias store_sales\n                     :  :              :  :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :  :              :  :     +- Project [sr_store_sk#1710 AS store_sk#10531, sr_returned_date_sk#1723 AS date_sk#10532, cast(0 as decimal(7,2)) AS sales_price#10533, cast(0 as decimal(7,2)) AS profit#10534, sr_return_amt#1714 AS return_amt#10535, sr_net_loss#1722 AS net_loss#10536]\n                     :  :              :  :        +- SubqueryAlias store_returns\n                     :  :              :  :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                     :  :              :  +- SubqueryAlias date_dim\n                     :  :              :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  :              +- SubqueryAlias store\n                     :  :                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                     :  +- Project [catalog channel AS channel#10516, concat(catalog_page, cp_catalog_page_id#807) AS id#10517, sales#10553, returns#10555, CheckOverflow((promote_precision(cast(profit#10554 as decimal(18,2))) - promote_precision(cast(profit_loss#10556 as decimal(18,2)))), DecimalType(18,2)) AS profit#10518]\n                     :     +- SubqueryAlias csr\n                     :        +- Aggregate [cp_catalog_page_id#807], [cp_catalog_page_id#807, sum(sales_price#10543) AS sales#10553, sum(profit#10544) AS profit#10554, sum(return_amt#10545) AS returns#10555, sum(net_loss#10546) AS profit_loss#10556]\n                     :           +- Filter (((date_sk#10542 = d_date_sk#1040) && ((d_date#1042 >= cast(2000-08-23 as date)) && (d_date#1042 <= cast(cast(cast(2000-08-23 as date) as timestamp) + interval 2 weeks as date)))) && (page_sk#10541 = cp_catalog_page_sk#806))\n                     :              +- Join Inner\n                     :                 :- Join Inner\n                     :                 :  :- SubqueryAlias salesreturns\n                     :                 :  :  +- Union\n                     :                 :  :     :- Project [cs_catalog_page_sk#1800 AS page_sk#10541, cs_sold_date_sk#1822 AS date_sk#10542, cs_ext_sales_price#1811 AS sales_price#10543, cs_net_profit#1821 AS profit#10544, cast(0 as decimal(7,2)) AS return_amt#10545, cast(0 as decimal(7,2)) AS net_loss#10546]\n                     :                 :  :     :  +- SubqueryAlias catalog_sales\n                     :                 :  :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :                 :  :     +- Project [cr_catalog_page_sk#2097 AS page_sk#10547, cr_returned_date_sk#2112 AS date_sk#10548, cast(0 as decimal(7,2)) AS sales_price#10549, cast(0 as decimal(7,2)) AS profit#10550, cr_return_amount#2103 AS return_amt#10551, cr_net_loss#2111 AS net_loss#10552]\n                     :                 :  :        +- SubqueryAlias catalog_returns\n                     :                 :  :           +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n                     :                 :  +- SubqueryAlias date_dim\n                     :                 :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :                 +- SubqueryAlias catalog_page\n                     :                    +- Relation[cp_catalog_page_sk#806,cp_catalog_page_id#807,cp_start_date_sk#808,cp_end_date_sk#809,cp_department#810,cp_catalog_number#811,cp_catalog_page_number#812,cp_description#813,cp_type#814] parquet\n                     +- Project [web channel AS channel#10519, concat(web_site, web_site_id#1649) AS id#10520, sales#10569, returns#10571, CheckOverflow((promote_precision(cast(profit#10570 as decimal(18,2))) - promote_precision(cast(profit_loss#10572 as decimal(18,2)))), DecimalType(18,2)) AS profit#10521]\n                        +- SubqueryAlias wsr\n                           +- Aggregate [web_site_id#1649], [web_site_id#1649, sum(sales_price#10559) AS sales#10569, sum(profit#10560) AS profit#10570, sum(return_amt#10561) AS returns#10571, sum(net_loss#10562) AS profit_loss#10572]\n                              +- Filter (((date_sk#10558 = d_date_sk#1040) && ((d_date#1042 >= cast(2000-08-23 as date)) && (d_date#1042 <= cast(cast(cast(2000-08-23 as date) as timestamp) + interval 2 weeks as date)))) && (wsr_web_site_sk#10557 = web_site_sk#1648))\n                                 +- Join Inner\n                                    :- Join Inner\n                                    :  :- SubqueryAlias salesreturns\n                                    :  :  +- Union\n                                    :  :     :- Project [ws_web_site_sk#1767 AS wsr_web_site_sk#10557, ws_sold_date_sk#1788 AS date_sk#10558, ws_ext_sales_price#1777 AS sales_price#10559, ws_net_profit#1787 AS profit#10560, cast(0 as decimal(7,2)) AS return_amt#10561, cast(0 as decimal(7,2)) AS net_loss#10562]\n                                    :  :     :  +- SubqueryAlias web_sales\n                                    :  :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                                    :  :     +- Project [ws_web_site_sk#1767 AS wsr_web_site_sk#10563, wr_returned_date_sk#2140 AS date_sk#10564, cast(0 as decimal(7,2)) AS sales_price#10565, cast(0 as decimal(7,2)) AS profit#10566, wr_return_amt#2131 AS return_amt#10567, wr_net_loss#2139 AS net_loss#10568]\n                                    :  :        +- Join LeftOuter, ((wr_item_sk#2118 = ws_item_sk#1757) && (wr_order_number#2129L = ws_order_number#1771L))\n                                    :  :           :- SubqueryAlias web_returns\n                                    :  :           :  +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n                                    :  :           +- SubqueryAlias web_sales\n                                    :  :              +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                                    :  +- SubqueryAlias date_dim\n                                    :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                    +- SubqueryAlias web_site\n                                       +- Relation[web_site_sk#1648,web_site_id#1649,web_rec_start_date#1650,web_rec_end_date#1651,web_name#1652,web_open_date_sk#1653,web_close_date_sk#1654,web_class#1655,web_manager#1656,web_mkt_id#1657,web_mkt_class#1658,web_mkt_desc#1659,web_market_manager#1660,web_company_id#1661,web_company_name#1662,web_street_number#1663,web_street_name#1664,web_street_type#1665,web_suite_number#1666,web_city#1667,web_county#1668,web_state#1669,web_zip#1670,web_country#1671,... 2 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#10591 ASC NULLS FIRST, id#10592 ASC NULLS FIRST], true\n      +- Aggregate [channel#10591, id#10592, spark_grouping_id#10588], [channel#10591, id#10592, sum(sales#10537) AS sales#10522, sum(returns#10539) AS returns#10523, sum(profit#10515) AS profit#10524]\n         +- Expand [List(sales#10537, returns#10539, profit#10515, channel#10589, id#10590, 0), List(sales#10537, returns#10539, profit#10515, channel#10589, null, 1), List(sales#10537, returns#10539, profit#10515, null, null, 3)], [sales#10537, returns#10539, profit#10515, channel#10591, id#10592, spark_grouping_id#10588]\n            +- Union\n               :- Aggregate [s_store_id#1387], [MakeDecimal(sum(UnscaledValue(sales_price#10527)),17,2) AS sales#10537, MakeDecimal(sum(UnscaledValue(return_amt#10529)),17,2) AS returns#10539, CheckOverflow((promote_precision(cast(MakeDecimal(sum(UnscaledValue(profit#10528)),17,2) as decimal(18,2))) - promote_precision(cast(MakeDecimal(sum(UnscaledValue(net_loss#10530)),17,2) as decimal(18,2)))), DecimalType(18,2)) AS profit#10515, store channel AS channel#10589, concat(store, s_store_id#1387) AS id#10590]\n               :  +- Project [sales_price#10527, profit#10528, return_amt#10529, net_loss#10530, s_store_id#1387]\n               :     +- Join Inner, (store_sk#10525 = s_store_sk#1386)\n               :        :- Project [store_sk#10525, sales_price#10527, profit#10528, return_amt#10529, net_loss#10530]\n               :        :  +- Join Inner, (date_sk#10526 = d_date_sk#1040)\n               :        :     :- Union\n               :        :     :  :- Project [ss_store_sk#1910 AS store_sk#10525, ss_sold_date_sk#1926 AS date_sk#10526, ss_ext_sales_price#1918 AS sales_price#10527, ss_net_profit#1925 AS profit#10528, 0.00 AS return_amt#10529, 0.00 AS net_loss#10530]\n               :        :     :  :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910))\n               :        :     :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :        :     :  +- Project [sr_store_sk#1710 AS store_sk#10531, sr_returned_date_sk#1723 AS date_sk#10532, 0.00 AS sales_price#10533, 0.00 AS profit#10534, sr_return_amt#1714 AS return_amt#10535, sr_net_loss#1722 AS net_loss#10536]\n               :        :     :     +- Filter (isnotnull(sr_returned_date_sk#1723) && isnotnull(sr_store_sk#1710))\n               :        :     :        +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :        :     +- Project [d_date_sk#1040]\n               :        :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11206)) && isnotnull(d_date_sk#1040))\n               :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :        +- Project [s_store_sk#1386, s_store_id#1387]\n               :           +- Filter isnotnull(s_store_sk#1386)\n               :              +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               :- Aggregate [cp_catalog_page_id#807], [MakeDecimal(sum(UnscaledValue(sales_price#10543)),17,2) AS sales#10553, MakeDecimal(sum(UnscaledValue(return_amt#10545)),17,2) AS returns#10555, CheckOverflow((promote_precision(cast(MakeDecimal(sum(UnscaledValue(profit#10544)),17,2) as decimal(18,2))) - promote_precision(cast(MakeDecimal(sum(UnscaledValue(net_loss#10546)),17,2) as decimal(18,2)))), DecimalType(18,2)) AS profit#10518, catalog channel AS channel#10589, concat(catalog_page, cp_catalog_page_id#807) AS id#10590]\n               :  +- Project [sales_price#10543, profit#10544, return_amt#10545, net_loss#10546, cp_catalog_page_id#807]\n               :     +- Join Inner, (page_sk#10541 = cp_catalog_page_sk#806)\n               :        :- Project [page_sk#10541, sales_price#10543, profit#10544, return_amt#10545, net_loss#10546]\n               :        :  +- Join Inner, (date_sk#10542 = d_date_sk#1040)\n               :        :     :- Union\n               :        :     :  :- Project [cs_catalog_page_sk#1800 AS page_sk#10541, cs_sold_date_sk#1822 AS date_sk#10542, cs_ext_sales_price#1811 AS sales_price#10543, cs_net_profit#1821 AS profit#10544, 0.00 AS return_amt#10545, 0.00 AS net_loss#10546]\n               :        :     :  :  +- Filter (isnotnull(cs_sold_date_sk#1822) && isnotnull(cs_catalog_page_sk#1800))\n               :        :     :  :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :        :     :  +- Project [cr_catalog_page_sk#2097 AS page_sk#10547, cr_returned_date_sk#2112 AS date_sk#10548, 0.00 AS sales_price#10549, 0.00 AS profit#10550, cr_return_amount#2103 AS return_amt#10551, cr_net_loss#2111 AS net_loss#10552]\n               :        :     :     +- Filter (isnotnull(cr_returned_date_sk#2112) && isnotnull(cr_catalog_page_sk#2097))\n               :        :     :        +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n               :        :     +- Project [d_date_sk#1040]\n               :        :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11206)) && isnotnull(d_date_sk#1040))\n               :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :        +- Project [cp_catalog_page_sk#806, cp_catalog_page_id#807]\n               :           +- Filter isnotnull(cp_catalog_page_sk#806)\n               :              +- Relation[cp_catalog_page_sk#806,cp_catalog_page_id#807,cp_start_date_sk#808,cp_end_date_sk#809,cp_department#810,cp_catalog_number#811,cp_catalog_page_number#812,cp_description#813,cp_type#814] parquet\n               +- Aggregate [web_site_id#1649], [MakeDecimal(sum(UnscaledValue(sales_price#10559)),17,2) AS sales#10569, MakeDecimal(sum(UnscaledValue(return_amt#10561)),17,2) AS returns#10571, CheckOverflow((promote_precision(cast(MakeDecimal(sum(UnscaledValue(profit#10560)),17,2) as decimal(18,2))) - promote_precision(cast(MakeDecimal(sum(UnscaledValue(net_loss#10562)),17,2) as decimal(18,2)))), DecimalType(18,2)) AS profit#10521, web channel AS channel#10589, concat(web_site, web_site_id#1649) AS id#10590]\n                  +- Project [sales_price#10559, profit#10560, return_amt#10561, net_loss#10562, web_site_id#1649]\n                     +- Join Inner, (wsr_web_site_sk#10557 = web_site_sk#1648)\n                        :- Project [wsr_web_site_sk#10557, sales_price#10559, profit#10560, return_amt#10561, net_loss#10562]\n                        :  +- Join Inner, (date_sk#10558 = d_date_sk#1040)\n                        :     :- Union\n                        :     :  :- Project [ws_web_site_sk#1767 AS wsr_web_site_sk#10557, ws_sold_date_sk#1788 AS date_sk#10558, ws_ext_sales_price#1777 AS sales_price#10559, ws_net_profit#1787 AS profit#10560, 0.00 AS return_amt#10561, 0.00 AS net_loss#10562]\n                        :     :  :  +- Filter (isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_web_site_sk#1767))\n                        :     :  :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        :     :  +- Project [ws_web_site_sk#1767 AS wsr_web_site_sk#10563, wr_returned_date_sk#2140 AS date_sk#10564, 0.00 AS sales_price#10565, 0.00 AS profit#10566, wr_return_amt#2131 AS return_amt#10567, wr_net_loss#2139 AS net_loss#10568]\n                        :     :     +- Join Inner, ((wr_item_sk#2118 = ws_item_sk#1757) && (wr_order_number#2129L = ws_order_number#1771L))\n                        :     :        :- Project [wr_item_sk#2118, wr_order_number#2129L, wr_return_amt#2131, wr_net_loss#2139, wr_returned_date_sk#2140]\n                        :     :        :  +- Filter isnotnull(wr_returned_date_sk#2140)\n                        :     :        :     +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n                        :     :        +- Project [ws_item_sk#1757, ws_web_site_sk#1767, ws_order_number#1771L]\n                        :     :           +- Filter isnotnull(ws_web_site_sk#1767)\n                        :     :              +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        :     +- Project [d_date_sk#1040]\n                        :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11206)) && isnotnull(d_date_sk#1040))\n                        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Project [web_site_sk#1648, web_site_id#1649]\n                           +- Filter isnotnull(web_site_sk#1648)\n                              +- Relation[web_site_sk#1648,web_site_id#1649,web_rec_start_date#1650,web_rec_end_date#1651,web_name#1652,web_open_date_sk#1653,web_close_date_sk#1654,web_class#1655,web_manager#1656,web_mkt_id#1657,web_mkt_class#1658,web_mkt_desc#1659,web_market_manager#1660,web_company_id#1661,web_company_name#1662,web_street_number#1663,web_street_name#1664,web_street_type#1665,web_suite_number#1666,web_city#1667,web_county#1668,web_state#1669,web_zip#1670,web_country#1671,... 2 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[channel#10591 ASC NULLS FIRST,id#10592 ASC NULLS FIRST], output=[channel#10591,id#10592,sales#10522,returns#10523,profit#10524])\n+- *(21) HashAggregate(keys=[channel#10591, id#10592, spark_grouping_id#10588], functions=[sum(sales#10537), sum(returns#10539), sum(profit#10515)], output=[channel#10591, id#10592, sales#10522, returns#10523, profit#10524])\n   +- Exchange hashpartitioning(channel#10591, id#10592, spark_grouping_id#10588, 200)\n      +- *(20) HashAggregate(keys=[channel#10591, id#10592, spark_grouping_id#10588], functions=[partial_sum(sales#10537), partial_sum(returns#10539), partial_sum(profit#10515)], output=[channel#10591, id#10592, spark_grouping_id#10588, sum#10603, sum#10604, sum#10605])\n         +- *(20) Expand [List(sales#10537, returns#10539, profit#10515, channel#10589, id#10590, 0), List(sales#10537, returns#10539, profit#10515, channel#10589, null, 1), List(sales#10537, returns#10539, profit#10515, null, null, 3)], [sales#10537, returns#10539, profit#10515, channel#10591, id#10592, spark_grouping_id#10588]\n            +- Union\n               :- *(6) HashAggregate(keys=[s_store_id#1387], functions=[sum(UnscaledValue(sales_price#10527)), sum(UnscaledValue(return_amt#10529)), sum(UnscaledValue(profit#10528)), sum(UnscaledValue(net_loss#10530))], output=[sales#10537, returns#10539, profit#10515, channel#10589, id#10590])\n               :  +- Exchange hashpartitioning(s_store_id#1387, 200)\n               :     +- *(5) HashAggregate(keys=[s_store_id#1387], functions=[partial_sum(UnscaledValue(sales_price#10527)), partial_sum(UnscaledValue(return_amt#10529)), partial_sum(UnscaledValue(profit#10528)), partial_sum(UnscaledValue(net_loss#10530))], output=[s_store_id#1387, sum#10610L, sum#10611L, sum#10612L, sum#10613L])\n               :        +- *(5) Project [sales_price#10527, profit#10528, return_amt#10529, net_loss#10530, s_store_id#1387]\n               :           +- *(5) BroadcastHashJoin [store_sk#10525], [s_store_sk#1386], Inner, BuildRight\n               :              :- *(5) Project [store_sk#10525, sales_price#10527, profit#10528, return_amt#10529, net_loss#10530]\n               :              :  +- *(5) BroadcastHashJoin [date_sk#10526], [d_date_sk#1040], Inner, BuildRight\n               :              :     :- Union\n               :              :     :  :- *(1) Project [ss_store_sk#1910 AS store_sk#10525, ss_sold_date_sk#1926 AS date_sk#10526, ss_ext_sales_price#1918 AS sales_price#10527, ss_net_profit#1925 AS profit#10528, 0.00 AS return_amt#10529, 0.00 AS net_loss#10530]\n               :              :     :  :  +- *(1) Filter isnotnull(ss_store_sk#1910)\n               :              :     :  :     +- *(1) FileScan parquet db_tpcds.store_sales[ss_store_sk#1910,ss_ext_sales_price#1918,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:int,ss_ext_sales_price:decimal(7,2),ss_net_profit:decimal(7,2)>\n               :              :     :  +- *(2) Project [sr_store_sk#1710 AS store_sk#10531, sr_returned_date_sk#1723 AS date_sk#10532, 0.00 AS sales_price#10533, 0.00 AS profit#10534, sr_return_amt#1714 AS return_amt#10535, sr_net_loss#1722 AS net_loss#10536]\n               :              :     :     +- *(2) Filter isnotnull(sr_store_sk#1710)\n               :              :     :        +- *(2) FileScan parquet db_tpcds.store_returns[sr_store_sk#1710,sr_return_amt#1714,sr_net_loss#1722,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns/sr_..., PartitionCount: 2001, PartitionFilters: [isnotnull(sr_returned_date_sk#1723)], PushedFilters: [IsNotNull(sr_store_sk)], ReadSchema: struct<sr_store_sk:int,sr_return_amt:decimal(7,2),sr_net_loss:decimal(7,2)>\n               :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :              :        +- *(3) Project [d_date_sk#1040]\n               :              :           +- *(3) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11206)) && isnotnull(d_date_sk#1040))\n               :              :              +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2000-08-23), LessThanOrEqual(d_date,2000-09-06), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>\n               :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                 +- *(4) Project [s_store_sk#1386, s_store_id#1387]\n               :                    +- *(4) Filter isnotnull(s_store_sk#1386)\n               :                       +- *(4) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_id#1387] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_store_id:string>\n               :- *(12) HashAggregate(keys=[cp_catalog_page_id#807], functions=[sum(UnscaledValue(sales_price#10543)), sum(UnscaledValue(return_amt#10545)), sum(UnscaledValue(profit#10544)), sum(UnscaledValue(net_loss#10546))], output=[sales#10553, returns#10555, profit#10518, channel#10589, id#10590])\n               :  +- Exchange hashpartitioning(cp_catalog_page_id#807, 200)\n               :     +- *(11) HashAggregate(keys=[cp_catalog_page_id#807], functions=[partial_sum(UnscaledValue(sales_price#10543)), partial_sum(UnscaledValue(return_amt#10545)), partial_sum(UnscaledValue(profit#10544)), partial_sum(UnscaledValue(net_loss#10546))], output=[cp_catalog_page_id#807, sum#10618L, sum#10619L, sum#10620L, sum#10621L])\n               :        +- *(11) Project [sales_price#10543, profit#10544, return_amt#10545, net_loss#10546, cp_catalog_page_id#807]\n               :           +- *(11) BroadcastHashJoin [page_sk#10541], [cp_catalog_page_sk#806], Inner, BuildRight\n               :              :- *(11) Project [page_sk#10541, sales_price#10543, profit#10544, return_amt#10545, net_loss#10546]\n               :              :  +- *(11) BroadcastHashJoin [date_sk#10542], [d_date_sk#1040], Inner, BuildRight\n               :              :     :- Union\n               :              :     :  :- *(7) Project [cs_catalog_page_sk#1800 AS page_sk#10541, cs_sold_date_sk#1822 AS date_sk#10542, cs_ext_sales_price#1811 AS sales_price#10543, cs_net_profit#1821 AS profit#10544, 0.00 AS return_amt#10545, 0.00 AS net_loss#10546]\n               :              :     :  :  +- *(7) Filter isnotnull(cs_catalog_page_sk#1800)\n               :              :     :  :     +- *(7) FileScan parquet db_tpcds.catalog_sales[cs_catalog_page_sk#1800,cs_ext_sales_price#1811,cs_net_profit#1821,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_catalog_page_sk)], ReadSchema: struct<cs_catalog_page_sk:int,cs_ext_sales_price:decimal(7,2),cs_net_profit:decimal(7,2)>\n               :              :     :  +- *(8) Project [cr_catalog_page_sk#2097 AS page_sk#10547, cr_returned_date_sk#2112 AS date_sk#10548, 0.00 AS sales_price#10549, 0.00 AS profit#10550, cr_return_amount#2103 AS return_amt#10551, cr_net_loss#2111 AS net_loss#10552]\n               :              :     :     +- *(8) Filter isnotnull(cr_catalog_page_sk#2097)\n               :              :     :        +- *(8) FileScan parquet db_tpcds.catalog_returns[cr_catalog_page_sk#2097,cr_return_amount#2103,cr_net_loss#2111,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns/c..., PartitionCount: 2066, PartitionFilters: [isnotnull(cr_returned_date_sk#2112)], PushedFilters: [IsNotNull(cr_catalog_page_sk)], ReadSchema: struct<cr_catalog_page_sk:int,cr_return_amount:decimal(7,2),cr_net_loss:decimal(7,2)>\n               :              :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                 +- *(10) Project [cp_catalog_page_sk#806, cp_catalog_page_id#807]\n               :                    +- *(10) Filter isnotnull(cp_catalog_page_sk#806)\n               :                       +- *(10) FileScan parquet db_tpcds.catalog_page[cp_catalog_page_sk#806,cp_catalog_page_id#807] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_page], PartitionFilters: [], PushedFilters: [IsNotNull(cp_catalog_page_sk)], ReadSchema: struct<cp_catalog_page_sk:int,cp_catalog_page_id:string>\n               +- *(19) HashAggregate(keys=[web_site_id#1649], functions=[sum(UnscaledValue(sales_price#10559)), sum(UnscaledValue(return_amt#10561)), sum(UnscaledValue(profit#10560)), sum(UnscaledValue(net_loss#10562))], output=[sales#10569, returns#10571, profit#10521, channel#10589, id#10590])\n                  +- Exchange hashpartitioning(web_site_id#1649, 200)\n                     +- *(18) HashAggregate(keys=[web_site_id#1649], functions=[partial_sum(UnscaledValue(sales_price#10559)), partial_sum(UnscaledValue(return_amt#10561)), partial_sum(UnscaledValue(profit#10560)), partial_sum(UnscaledValue(net_loss#10562))], output=[web_site_id#1649, sum#10626L, sum#10627L, sum#10628L, sum#10629L])\n                        +- *(18) Project [sales_price#10559, profit#10560, return_amt#10561, net_loss#10562, web_site_id#1649]\n                           +- *(18) BroadcastHashJoin [wsr_web_site_sk#10557], [web_site_sk#1648], Inner, BuildRight\n                              :- *(18) Project [wsr_web_site_sk#10557, sales_price#10559, profit#10560, return_amt#10561, net_loss#10562]\n                              :  +- *(18) BroadcastHashJoin [date_sk#10558], [d_date_sk#1040], Inner, BuildRight\n                              :     :- Union\n                              :     :  :- *(13) Project [ws_web_site_sk#1767 AS wsr_web_site_sk#10557, ws_sold_date_sk#1788 AS date_sk#10558, ws_ext_sales_price#1777 AS sales_price#10559, ws_net_profit#1787 AS profit#10560, 0.00 AS return_amt#10561, 0.00 AS net_loss#10562]\n                              :     :  :  +- *(13) Filter isnotnull(ws_web_site_sk#1767)\n                              :     :  :     +- *(13) FileScan parquet db_tpcds.web_sales[ws_web_site_sk#1767,ws_ext_sales_price#1777,ws_net_profit#1787,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_web_site_sk)], ReadSchema: struct<ws_web_site_sk:int,ws_ext_sales_price:decimal(7,2),ws_net_profit:decimal(7,2)>\n                              :     :  +- *(15) Project [ws_web_site_sk#1767 AS wsr_web_site_sk#10563, wr_returned_date_sk#2140 AS date_sk#10564, 0.00 AS sales_price#10565, 0.00 AS profit#10566, wr_return_amt#2131 AS return_amt#10567, wr_net_loss#2139 AS net_loss#10568]\n                              :     :     +- *(15) BroadcastHashJoin [wr_item_sk#2118, wr_order_number#2129L], [ws_item_sk#1757, ws_order_number#1771L], Inner, BuildLeft\n                              :     :        :- BroadcastExchange HashedRelationBroadcastMode(List(input[0, int, true], input[1, bigint, true]))\n                              :     :        :  +- *(14) FileScan parquet db_tpcds.web_returns[wr_item_sk#2118,wr_order_number#2129L,wr_return_amt#2131,wr_net_loss#2139,wr_returned_date_sk#2140] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_returns/wr_re..., PartitionCount: 2109, PartitionFilters: [isnotnull(wr_returned_date_sk#2140)], PushedFilters: [], ReadSchema: struct<wr_item_sk:int,wr_order_number:bigint,wr_return_amt:decimal(7,2),wr_net_loss:decimal(7,2)>\n                              :     :        +- *(15) Project [ws_item_sk#1757, ws_web_site_sk#1767, ws_order_number#1771L]\n                              :     :           +- *(15) Filter isnotnull(ws_web_site_sk#1767)\n                              :     :              +- *(15) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_web_site_sk#1767,ws_order_number#1771L,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ws_web_site_sk)], ReadSchema: struct<ws_item_sk:int,ws_web_site_sk:int,ws_order_number:bigint>\n                              :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 +- *(17) Project [web_site_sk#1648, web_site_id#1649]\n                                    +- *(17) Filter isnotnull(web_site_sk#1648)\n                                       +- *(17) FileScan parquet db_tpcds.web_site[web_site_sk#1648,web_site_id#1649] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_site], PartitionFilters: [], PushedFilters: [IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:int,web_site_id:string>"},{"name":"q6-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["customer_address","customer","store_sales","date_dim","item"],"parsingTime":0.001832,"analysisTime":7.14E-4,"optimizationTime":283.317054,"planningTime":36.222771,"executionTime":7842.887939,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['cnt ASC NULLS FIRST], true\n      +- 'Project ['state, 'cnt]\n         +- 'Filter ('cnt >= 10)\n            +- 'SubqueryAlias x\n               +- 'Aggregate ['a.ca_state], ['a.ca_state AS state#10734, 'count(1) AS cnt#10735]\n                  +- 'Filter (((('a.ca_address_sk = 'c.c_current_addr_sk) && ('c.c_customer_sk = 's.ss_customer_sk)) && ('s.ss_sold_date_sk = 'd.d_date_sk)) && ((('s.ss_item_sk = 'i.i_item_sk) && ('d.d_month_seq = scalar-subquery#10736 [])) && ('i.i_current_price > (1.2 * scalar-subquery#10737 []))))\n                     :  :- 'Distinct\n                     :  :  +- 'Project ['d_month_seq]\n                     :  :     +- 'Filter (('d_year = 2001) && ('d_moy = 1))\n                     :  :        +- 'UnresolvedRelation `date_dim`\n                     :  +- 'Project [unresolvedalias('avg('j.i_current_price), None)]\n                     :     +- 'Filter ('j.i_category = 'i.i_category)\n                     :        +- 'SubqueryAlias j\n                     :           +- 'UnresolvedRelation `item`\n                     +- 'Join Inner\n                        :- 'Join Inner\n                        :  :- 'Join Inner\n                        :  :  :- 'Join Inner\n                        :  :  :  :- 'SubqueryAlias a\n                        :  :  :  :  +- 'UnresolvedRelation `customer_address`\n                        :  :  :  +- 'SubqueryAlias c\n                        :  :  :     +- 'UnresolvedRelation `customer`\n                        :  :  +- 'SubqueryAlias s\n                        :  :     +- 'UnresolvedRelation `store_sales`\n                        :  +- 'SubqueryAlias d\n                        :     +- 'UnresolvedRelation `date_dim`\n                        +- 'SubqueryAlias i\n                           +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\nstate: string, cnt: bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [cnt#10735L ASC NULLS FIRST], true\n      +- Project [state#10734, cnt#10735L]\n         +- Filter (cnt#10735L >= cast(10 as bigint))\n            +- SubqueryAlias x\n               +- Aggregate [ca_state#930], [ca_state#930 AS state#10734, count(1) AS cnt#10735L]\n                  +- Filter ((((ca_address_sk#922 = c_current_addr_sk#864) && (c_customer_sk#860 = ss_customer_sk#1906)) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && (((ss_item_sk#1905 = i_item_sk#1172) && (d_month_seq#1043 = scalar-subquery#10736 [])) && (cast(i_current_price#1177 as decimal(14,7)) > cast(CheckOverflow((promote_precision(cast(1.2 as decimal(11,6))) * promote_precision(cast(scalar-subquery#10737 [i_category#1184] as decimal(11,6)))), DecimalType(14,7)) as decimal(14,7)))))\n                     :  :- Distinct\n                     :  :  +- Project [d_month_seq#1043]\n                     :  :     +- Filter ((d_year#1046 = 2001) && (d_moy#1048 = 1))\n                     :  :        +- SubqueryAlias date_dim\n                     :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  +- Aggregate [avg(i_current_price#1177) AS avg(i_current_price)#10740]\n                     :     +- Filter (i_category#1184 = outer(i_category#1184))\n                     :        +- SubqueryAlias j\n                     :           +- SubqueryAlias item\n                     :              +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     +- Join Inner\n                        :- Join Inner\n                        :  :- Join Inner\n                        :  :  :- Join Inner\n                        :  :  :  :- SubqueryAlias a\n                        :  :  :  :  +- SubqueryAlias customer_address\n                        :  :  :  :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                        :  :  :  +- SubqueryAlias c\n                        :  :  :     +- SubqueryAlias customer\n                        :  :  :        +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                        :  :  +- SubqueryAlias s\n                        :  :     +- SubqueryAlias store_sales\n                        :  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :  +- SubqueryAlias d\n                        :     +- SubqueryAlias date_dim\n                        :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- SubqueryAlias i\n                           +- SubqueryAlias item\n                              +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [cnt#10735L ASC NULLS FIRST], true\n      +- Filter (cnt#10735L >= 10)\n         +- Aggregate [ca_state#930], [ca_state#930 AS state#10734, count(1) AS cnt#10735L]\n            +- Project [ca_state#930]\n               +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                  :- Project [ca_state#930, ss_item_sk#1905]\n                  :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                  :     :- Project [ca_state#930, ss_item_sk#1905, ss_sold_date_sk#1926]\n                  :     :  +- Join Inner, (c_customer_sk#860 = ss_customer_sk#1906)\n                  :     :     :- Project [ca_state#930, c_customer_sk#860]\n                  :     :     :  +- Join Inner, (ca_address_sk#922 = c_current_addr_sk#864)\n                  :     :     :     :- Project [ca_address_sk#922, ca_state#930]\n                  :     :     :     :  +- Filter isnotnull(ca_address_sk#922)\n                  :     :     :     :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  :     :     :     +- Project [c_customer_sk#860, c_current_addr_sk#864]\n                  :     :     :        +- Filter (isnotnull(c_current_addr_sk#864) && isnotnull(c_customer_sk#860))\n                  :     :     :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :     :     +- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_sold_date_sk#1926]\n                  :     :        +- Filter ((isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_item_sk#1905))\n                  :     :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :     +- Project [d_date_sk#1040]\n                  :        +- Filter ((isnotnull(d_month_seq#1043) && (d_month_seq#1043 = scalar-subquery#10736 [])) && isnotnull(d_date_sk#1040))\n                  :           :  +- Aggregate [d_month_seq#1043], [d_month_seq#1043]\n                  :           :     +- Project [d_month_seq#1043]\n                  :           :        +- Filter (((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 1))\n                  :           :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  +- Project [i_item_sk#1172]\n                     +- Filter (cast(i_current_price#1177 as decimal(14,7)) > CheckOverflow((1.200000 * promote_precision(avg(i_current_price)#10740)), DecimalType(14,7)))\n                        +- Join LeftOuter, (i_category#1184#10743 = i_category#1184)\n                           :- Project [i_item_sk#1172, i_current_price#1177, i_category#1184]\n                           :  +- Filter (isnotnull(i_current_price#1177) && isnotnull(i_item_sk#1172))\n                           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                           +- Aggregate [i_category#1184], [cast((avg(UnscaledValue(i_current_price#1177)) / 100.0) as decimal(11,6)) AS avg(i_current_price)#10740, i_category#1184 AS i_category#1184#10743]\n                              +- Project [i_current_price#1177, i_category#1184]\n                                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[cnt#10735L ASC NULLS FIRST], output=[state#10734,cnt#10735L])\n+- *(14) Filter (cnt#10735L >= 10)\n   +- *(14) HashAggregate(keys=[ca_state#930], functions=[count(1)], output=[state#10734, cnt#10735L])\n      +- Exchange hashpartitioning(ca_state#930, 200)\n         +- *(13) HashAggregate(keys=[ca_state#930], functions=[partial_count(1)], output=[ca_state#930, count#10745L])\n            +- *(13) Project [ca_state#930]\n               +- *(13) SortMergeJoin [ss_item_sk#1905], [i_item_sk#1172], Inner\n                  :- *(8) Sort [ss_item_sk#1905 ASC NULLS FIRST], false, 0\n                  :  +- Exchange hashpartitioning(ss_item_sk#1905, 200)\n                  :     +- *(7) Project [ca_state#930, ss_item_sk#1905]\n                  :        +- *(7) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                  :           :- *(7) Project [ca_state#930, ss_item_sk#1905, ss_sold_date_sk#1926]\n                  :           :  +- *(7) SortMergeJoin [c_customer_sk#860], [ss_customer_sk#1906], Inner\n                  :           :     :- *(3) Sort [c_customer_sk#860 ASC NULLS FIRST], false, 0\n                  :           :     :  +- Exchange hashpartitioning(c_customer_sk#860, 200)\n                  :           :     :     +- *(2) Project [ca_state#930, c_customer_sk#860]\n                  :           :     :        +- *(2) BroadcastHashJoin [ca_address_sk#922], [c_current_addr_sk#864], Inner, BuildLeft\n                  :           :     :           :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :           :     :           :  +- *(1) Project [ca_address_sk#922, ca_state#930]\n                  :           :     :           :     +- *(1) Filter isnotnull(ca_address_sk#922)\n                  :           :     :           :        +- *(1) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string>\n                  :           :     :           +- *(2) Project [c_customer_sk#860, c_current_addr_sk#864]\n                  :           :     :              +- *(2) Filter (isnotnull(c_current_addr_sk#864) && isnotnull(c_customer_sk#860))\n                  :           :     :                 +- *(2) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_addr_sk#864] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_current_addr_sk), IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int,c_current_addr_sk:int>\n                  :           :     +- *(5) Sort [ss_customer_sk#1906 ASC NULLS FIRST], false, 0\n                  :           :        +- Exchange hashpartitioning(ss_customer_sk#1906, 200)\n                  :           :           +- *(4) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_sold_date_sk#1926]\n                  :           :              +- *(4) Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_item_sk#1905))\n                  :           :                 +- *(4) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int>\n                  :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :              +- *(6) Project [d_date_sk#1040]\n                  :                 +- *(6) Filter ((isnotnull(d_month_seq#1043) && (d_month_seq#1043 = Subquery subquery10736)) && isnotnull(d_date_sk#1040))\n                  :                    :  +- Subquery subquery10736\n                  :                    :     +- *(2) HashAggregate(keys=[d_month_seq#1043], functions=[], output=[d_month_seq#1043])\n                  :                    :        +- Exchange hashpartitioning(d_month_seq#1043, 200)\n                  :                    :           +- *(1) HashAggregate(keys=[d_month_seq#1043], functions=[], output=[d_month_seq#1043])\n                  :                    :              +- *(1) Project [d_month_seq#1043]\n                  :                    :                 +- *(1) Filter (((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 1))\n                  :                    :                    +- *(1) FileScan parquet db_tpcds.date_dim[d_month_seq#1043,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), EqualTo(d_moy,1)], ReadSchema: struct<d_month_seq:int,d_year:int,d_moy:int>\n                  :                    +- *(6) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_month_seq#1043] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_month_seq:int>\n                  :                          +- Subquery subquery10736\n                  :                             +- *(2) HashAggregate(keys=[d_month_seq#1043], functions=[], output=[d_month_seq#1043])\n                  :                                +- Exchange hashpartitioning(d_month_seq#1043, 200)\n                  :                                   +- *(1) HashAggregate(keys=[d_month_seq#1043], functions=[], output=[d_month_seq#1043])\n                  :                                      +- *(1) Project [d_month_seq#1043]\n                  :                                         +- *(1) Filter (((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 1))\n                  :                                            +- *(1) FileScan parquet db_tpcds.date_dim[d_month_seq#1043,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), EqualTo(d_moy,1)], ReadSchema: struct<d_month_seq:int,d_year:int,d_moy:int>\n                  +- *(12) Sort [i_item_sk#1172 ASC NULLS FIRST], false, 0\n                     +- Exchange hashpartitioning(i_item_sk#1172, 200)\n                        +- *(11) Project [i_item_sk#1172]\n                           +- *(11) Filter (cast(i_current_price#1177 as decimal(14,7)) > CheckOverflow((1.200000 * promote_precision(avg(i_current_price)#10740)), DecimalType(14,7)))\n                              +- *(11) BroadcastHashJoin [i_category#1184], [i_category#1184#10743], LeftOuter, BuildRight\n                                 :- *(11) Project [i_item_sk#1172, i_current_price#1177, i_category#1184]\n                                 :  +- *(11) Filter (isnotnull(i_current_price#1177) && isnotnull(i_item_sk#1172))\n                                 :     +- *(11) FileScan parquet db_tpcds.item[i_item_sk#1172,i_current_price#1177,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_current_price:decimal(7,2),i_category:string>\n                                 +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, string, true]))\n                                    +- *(10) HashAggregate(keys=[i_category#1184], functions=[avg(UnscaledValue(i_current_price#1177))], output=[avg(i_current_price)#10740, i_category#1184#10743])\n                                       +- Exchange hashpartitioning(i_category#1184, 200)\n                                          +- *(9) HashAggregate(keys=[i_category#1184], functions=[partial_avg(UnscaledValue(i_current_price#1177))], output=[i_category#1184, sum#10748, count#10749L])\n                                             +- *(9) FileScan parquet db_tpcds.item[i_current_price#1177,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [], ReadSchema: struct<i_current_price:decimal(7,2),i_category:string>"},{"name":"q7-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","customer_demographics","date_dim","item","promotion"],"parsingTime":0.002894,"analysisTime":0.001116,"optimizationTime":273.277491,"planningTime":13.314738,"executionTime":3252.717254,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_item_id ASC NULLS FIRST], true\n      +- 'Aggregate ['i_item_id], ['i_item_id, 'avg('ss_quantity) AS agg1#10790, 'avg('ss_list_price) AS agg2#10791, 'avg('ss_coupon_amt) AS agg3#10792, 'avg('ss_sales_price) AS agg4#10793]\n         +- 'Filter ((((('ss_sold_date_sk = 'd_date_sk) && ('ss_item_sk = 'i_item_sk)) && ('ss_cdemo_sk = 'cd_demo_sk)) && (('ss_promo_sk = 'p_promo_sk) && ('cd_gender = M))) && ((('cd_marital_status = S) && ('cd_education_status = College)) && ((('p_channel_email = N) || ('p_channel_event = N)) && ('d_year = 2000))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'UnresolvedRelation `store_sales`\n               :  :  :  +- 'UnresolvedRelation `customer_demographics`\n               :  :  +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `item`\n               +- 'UnresolvedRelation `promotion`\n\n== Analyzed Logical Plan ==\ni_item_id: string, agg1: double, agg2: decimal(11,6), agg3: decimal(11,6), agg4: decimal(11,6)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [i_item_id#1173, agg1#10790, agg2#10791, agg3#10792, agg4#10793]\n      +- Sort [i_item_id#1173 ASC NULLS FIRST], true\n         +- Aggregate [i_item_id#1173], [i_item_id#1173, avg(cast(ss_quantity#1913 as bigint)) AS agg1#10790, avg(ss_list_price#1915) AS agg2#10791, avg(ss_coupon_amt#1922) AS agg3#10792, avg(ss_sales_price#1916) AS agg4#10793]\n            +- Filter (((((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_item_sk#1905 = i_item_sk#1172)) && (ss_cdemo_sk#1907 = cd_demo_sk#966)) && ((ss_promo_sk#1911 = p_promo_sk#1254) && (cd_gender#967 = M))) && (((cd_marital_status#968 = S) && (cd_education_status#969 = College)) && (((p_channel_email#1263 = N) || (p_channel_event#1268 = N)) && (d_year#1046 = 2000))))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- Join Inner\n                  :  :  :  :- SubqueryAlias store_sales\n                  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :  :  :  +- SubqueryAlias customer_demographics\n                  :  :  :     +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n                  :  :  +- SubqueryAlias date_dim\n                  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :  +- SubqueryAlias item\n                  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  +- SubqueryAlias promotion\n                     +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#1173 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173], [i_item_id#1173, avg(cast(ss_quantity#1913 as bigint)) AS agg1#10790, cast((avg(UnscaledValue(ss_list_price#1915)) / 100.0) as decimal(11,6)) AS agg2#10791, cast((avg(UnscaledValue(ss_coupon_amt#1922)) / 100.0) as decimal(11,6)) AS agg3#10792, cast((avg(UnscaledValue(ss_sales_price#1916)) / 100.0) as decimal(11,6)) AS agg4#10793]\n         +- Project [ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, i_item_id#1173]\n            +- Join Inner, (ss_promo_sk#1911 = p_promo_sk#1254)\n               :- Project [ss_promo_sk#1911, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, i_item_id#1173]\n               :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :     :- Project [ss_item_sk#1905, ss_promo_sk#1911, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922]\n               :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :     :     :- Project [ss_item_sk#1905, ss_promo_sk#1911, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n               :     :     :  +- Join Inner, (ss_cdemo_sk#1907 = cd_demo_sk#966)\n               :     :     :     :- Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_promo_sk#1911, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n               :     :     :     :  +- Filter (((isnotnull(ss_cdemo_sk#1907) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_item_sk#1905)) && isnotnull(ss_promo_sk#1911))\n               :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :     :     +- Project [cd_demo_sk#966]\n               :     :     :        +- Filter ((((((isnotnull(cd_gender#967) && isnotnull(cd_education_status#969)) && isnotnull(cd_marital_status#968)) && (cd_gender#967 = M)) && (cd_marital_status#968 = S)) && (cd_education_status#969 = College)) && isnotnull(cd_demo_sk#966))\n               :     :     :           +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n               :     :     +- Project [d_date_sk#1040]\n               :     :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n               :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [i_item_sk#1172, i_item_id#1173]\n               :        +- Filter isnotnull(i_item_sk#1172)\n               :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               +- Project [p_promo_sk#1254]\n                  +- Filter (((p_channel_email#1263 = N) || (p_channel_event#1268 = N)) && isnotnull(p_promo_sk#1254))\n                     +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_item_id#1173 ASC NULLS FIRST], output=[i_item_id#1173,agg1#10790,agg2#10791,agg3#10792,agg4#10793])\n+- *(6) HashAggregate(keys=[i_item_id#1173], functions=[avg(cast(ss_quantity#1913 as bigint)), avg(UnscaledValue(ss_list_price#1915)), avg(UnscaledValue(ss_coupon_amt#1922)), avg(UnscaledValue(ss_sales_price#1916))], output=[i_item_id#1173, agg1#10790, agg2#10791, agg3#10792, agg4#10793])\n   +- Exchange hashpartitioning(i_item_id#1173, 200)\n      +- *(5) HashAggregate(keys=[i_item_id#1173], functions=[partial_avg(cast(ss_quantity#1913 as bigint)), partial_avg(UnscaledValue(ss_list_price#1915)), partial_avg(UnscaledValue(ss_coupon_amt#1922)), partial_avg(UnscaledValue(ss_sales_price#1916))], output=[i_item_id#1173, sum#10812, count#10813L, sum#10814, count#10815L, sum#10816, count#10817L, sum#10818, count#10819L])\n         +- *(5) Project [ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, i_item_id#1173]\n            +- *(5) BroadcastHashJoin [ss_promo_sk#1911], [p_promo_sk#1254], Inner, BuildRight\n               :- *(5) Project [ss_promo_sk#1911, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, i_item_id#1173]\n               :  +- *(5) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :     :- *(5) Project [ss_item_sk#1905, ss_promo_sk#1911, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922]\n               :     :  +- *(5) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :     :- *(5) Project [ss_item_sk#1905, ss_promo_sk#1911, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n               :     :     :  +- *(5) BroadcastHashJoin [ss_cdemo_sk#1907], [cd_demo_sk#966], Inner, BuildRight\n               :     :     :     :- *(5) Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_promo_sk#1911, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n               :     :     :     :  +- *(5) Filter ((isnotnull(ss_cdemo_sk#1907) && isnotnull(ss_item_sk#1905)) && isnotnull(ss_promo_sk#1911))\n               :     :     :     :     +- *(5) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_cdemo_sk#1907,ss_promo_sk#1911,ss_quantity#1913,ss_list_price#1915,ss_sales_price#1916,ss_coupon_amt#1922,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_cdemo_sk), IsNotNull(ss_item_sk), IsNotNull(ss_promo_sk)], ReadSchema: struct<ss_item_sk:int,ss_cdemo_sk:int,ss_promo_sk:int,ss_quantity:int,ss_list_price:decimal(7,2),...\n               :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :        +- *(1) Project [cd_demo_sk#966]\n               :     :     :           +- *(1) Filter ((((((isnotnull(cd_gender#967) && isnotnull(cd_education_status#969)) && isnotnull(cd_marital_status#968)) && (cd_gender#967 = M)) && (cd_marital_status#968 = S)) && (cd_education_status#969 = College)) && isnotnull(cd_demo_sk#966))\n               :     :     :              +- *(1) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_gender), IsNotNull(cd_education_status), IsNotNull(cd_marital_status), EqualTo(cd_g..., ReadSchema: struct<cd_demo_sk:int,cd_gender:string,cd_marital_status:string,cd_education_status:string>\n               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(2) Project [d_date_sk#1040]\n               :     :           +- *(2) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n               :     :              +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(3) Project [i_item_sk#1172, i_item_id#1173]\n               :           +- *(3) Filter isnotnull(i_item_sk#1172)\n               :              +- *(3) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(4) Project [p_promo_sk#1254]\n                     +- *(4) Filter (((p_channel_email#1263 = N) || (p_channel_event#1268 = N)) && isnotnull(p_promo_sk#1254))\n                        +- *(4) FileScan parquet db_tpcds.promotion[p_promo_sk#1254,p_channel_email#1263,p_channel_event#1268] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/promotion], PartitionFilters: [], PushedFilters: [Or(EqualTo(p_channel_email,N),EqualTo(p_channel_event,N)), IsNotNull(p_promo_sk)], ReadSchema: struct<p_promo_sk:int,p_channel_email:string,p_channel_event:string>"},{"name":"q8-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin"],"tables":["store_sales","date_dim","store","customer_address","customer_address","customer"],"parsingTime":0.002184,"analysisTime":6.57E-4,"optimizationTime":256.473363,"planningTime":21.174619,"executionTime":4005.059433,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['s_store_name ASC NULLS FIRST], true\n      +- 'Aggregate ['s_store_name], ['s_store_name, unresolvedalias('sum('ss_net_profit), None)]\n         +- 'Filter (((('ss_store_sk = 's_store_sk) && ('ss_sold_date_sk = 'd_date_sk)) && ('d_qoy = 2)) && (('d_year = 1998) && ('substr('s_zip, 1, 2) = 'substr('V1.ca_zip, 1, 2))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'UnresolvedRelation `store_sales`\n               :  :  +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `store`\n               +- 'SubqueryAlias V1\n                  +- 'Project ['ca_zip]\n                     +- 'SubqueryAlias A2\n                        +- 'Intersect\n                           :- 'Project ['substr('ca_zip, 1, 5) AS ca_zip#10858]\n                           :  +- 'Filter 'substr('ca_zip, 1, 5) IN (24128,76232,65084,87816,83926,77556,20548,26231,43848,15126,91137,61265,98294,25782,17920,18426,98235,40081,84093,28577,55565,17183,54601,67897,22752,86284,18376,38607,45200,21756,29741,96765,23932,89360,29839,25989,28898,91068,72550,10390,18845,47770,82636,41367,76638,86198,81312,37126,39192,88424,72175,81426,53672,10445,42666,66864,66708,41248,48583,82276,18842,78890,49448,14089,38122,34425,79077,19849,43285,39861,66162,77610,13695,99543,83444,83041,12305,57665,68341,25003,57834,62878,49130,81096,18840,27700,23470,50412,21195,16021,76107,71954,68309,18119,98359,64544,10336,86379,27068,39736,98569,28915,24206,56529,57647,54917,42961,91110,63981,14922,36420,23006,67467,32754,30903,20260,31671,51798,72325,85816,68621,13955,36446,41766,68806,16725,15146,22744,35850,88086,51649,18270,52867,39972,96976,63792,11376,94898,13595,10516,90225,58943,39371,94945,28587,96576,57855,28488,26105,83933,25858,34322,44438,73171,30122,34102,22685,71256,78451,54364,13354,45375,40558,56458,28286,45266,47305,69399,83921,26233,11101,15371,69913,35942,15882,25631,24610,44165,99076,33786,70738,26653,14328,72305,62496,22152,10144,64147,48425,14663,21076,18799,30450,63089,81019,68893,24996,51200,51211,45692,92712,70466,79994,22437,25280,38935,71791,73134,56571,14060,19505,72425,56575,74351,68786,51650,20004,18383,76614,11634,18906,15765,41368,73241,76698,78567,97189,28545,76231,75691,22246,51061,90578,56691,68014,51103,94167,57047,14867,73520,15734,63435,25733,35474,24676,94627,53535,17879,15559,53268,59166,11928,59402,33282,45721,43933,68101,33515,36634,71286,19736,58058,55253,67473,41918,19515,36495,19430,22351,77191,91393,49156,50298,87501,18652,53179,18767,63193,23968,65164,68880,21286,72823,58470,67301,13394,31016,70372,67030,40604,24317,45748,39127,26065,77721,31029,31880,60576,24671,45549,13376,50016,33123,19769,22927,97789,46081,72151,15723,46136,51949,68100,96888,64528,14171,79777,28709,11489,25103,32213,78668,22245,15798,27156,37930,62971,21337,51622,67853,10567,38415,15455,58263,42029,60279,37125,56240,88190,50308,26859,64457,89091,82136,62377,36233,63837,58078,17043,30010,60099,28810,98025,29178,87343,73273,30469,64034,39516,86057,21309,90257,67875,40162,11356,73650,61810,72013,30431,22461,19512,13375,55307,30625,83849,68908,26689,96451,38193,46820,88885,84935,69035,83144,47537,56616,94983,48033,69952,25486,61547,27385,61860,58048,56910,16807,17871,35258,31387,35458,35576)\n                           :     +- 'UnresolvedRelation `customer_address`\n                           +- 'Project ['ca_zip]\n                              +- 'SubqueryAlias A1\n                                 +- 'Filter ('count(1) > 10)\n                                    +- 'Aggregate ['ca_zip], ['substr('ca_zip, 1, 5) AS ca_zip#10859, 'count(1) AS cnt#10860]\n                                       +- 'Filter (('ca_address_sk = 'c_current_addr_sk) && ('c_preferred_cust_flag = Y))\n                                          +- 'Join Inner\n                                             :- 'UnresolvedRelation `customer_address`\n                                             +- 'UnresolvedRelation `customer`\n\n== Analyzed Logical Plan ==\ns_store_name: string, sum(ss_net_profit): decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [s_store_name#1391, sum(ss_net_profit)#10868]\n      +- Sort [s_store_name#1391 ASC NULLS FIRST], true\n         +- Aggregate [s_store_name#1391], [s_store_name#1391, sum(ss_net_profit#1925) AS sum(ss_net_profit)#10868]\n            +- Filter ((((ss_store_sk#1910 = s_store_sk#1386) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && (d_qoy#1050 = 2)) && ((d_year#1046 = 1998) && (substring(s_zip#1411, 1, 2) = substring(ca_zip#10858, 1, 2))))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- SubqueryAlias store_sales\n                  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :  :  +- SubqueryAlias date_dim\n                  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :  +- SubqueryAlias store\n                  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                  +- SubqueryAlias V1\n                     +- Project [ca_zip#10858]\n                        +- SubqueryAlias A2\n                           +- Intersect\n                              :- Project [substring(ca_zip#931, 1, 5) AS ca_zip#10858]\n                              :  +- Filter substring(ca_zip#931, 1, 5) IN (24128,76232,65084,87816,83926,77556,20548,26231,43848,15126,91137,61265,98294,25782,17920,18426,98235,40081,84093,28577,55565,17183,54601,67897,22752,86284,18376,38607,45200,21756,29741,96765,23932,89360,29839,25989,28898,91068,72550,10390,18845,47770,82636,41367,76638,86198,81312,37126,39192,88424,72175,81426,53672,10445,42666,66864,66708,41248,48583,82276,18842,78890,49448,14089,38122,34425,79077,19849,43285,39861,66162,77610,13695,99543,83444,83041,12305,57665,68341,25003,57834,62878,49130,81096,18840,27700,23470,50412,21195,16021,76107,71954,68309,18119,98359,64544,10336,86379,27068,39736,98569,28915,24206,56529,57647,54917,42961,91110,63981,14922,36420,23006,67467,32754,30903,20260,31671,51798,72325,85816,68621,13955,36446,41766,68806,16725,15146,22744,35850,88086,51649,18270,52867,39972,96976,63792,11376,94898,13595,10516,90225,58943,39371,94945,28587,96576,57855,28488,26105,83933,25858,34322,44438,73171,30122,34102,22685,71256,78451,54364,13354,45375,40558,56458,28286,45266,47305,69399,83921,26233,11101,15371,69913,35942,15882,25631,24610,44165,99076,33786,70738,26653,14328,72305,62496,22152,10144,64147,48425,14663,21076,18799,30450,63089,81019,68893,24996,51200,51211,45692,92712,70466,79994,22437,25280,38935,71791,73134,56571,14060,19505,72425,56575,74351,68786,51650,20004,18383,76614,11634,18906,15765,41368,73241,76698,78567,97189,28545,76231,75691,22246,51061,90578,56691,68014,51103,94167,57047,14867,73520,15734,63435,25733,35474,24676,94627,53535,17879,15559,53268,59166,11928,59402,33282,45721,43933,68101,33515,36634,71286,19736,58058,55253,67473,41918,19515,36495,19430,22351,77191,91393,49156,50298,87501,18652,53179,18767,63193,23968,65164,68880,21286,72823,58470,67301,13394,31016,70372,67030,40604,24317,45748,39127,26065,77721,31029,31880,60576,24671,45549,13376,50016,33123,19769,22927,97789,46081,72151,15723,46136,51949,68100,96888,64528,14171,79777,28709,11489,25103,32213,78668,22245,15798,27156,37930,62971,21337,51622,67853,10567,38415,15455,58263,42029,60279,37125,56240,88190,50308,26859,64457,89091,82136,62377,36233,63837,58078,17043,30010,60099,28810,98025,29178,87343,73273,30469,64034,39516,86057,21309,90257,67875,40162,11356,73650,61810,72013,30431,22461,19512,13375,55307,30625,83849,68908,26689,96451,38193,46820,88885,84935,69035,83144,47537,56616,94983,48033,69952,25486,61547,27385,61860,58048,56910,16807,17871,35258,31387,35458,35576)\n                              :     +- SubqueryAlias customer_address\n                              :        +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                              +- Project [ca_zip#10859]\n                                 +- SubqueryAlias A1\n                                    +- Project [ca_zip#10859, cnt#10860L]\n                                       +- Filter (count(1)#10864L > cast(10 as bigint))\n                                          +- Aggregate [ca_zip#931], [substring(ca_zip#931, 1, 5) AS ca_zip#10859, count(1) AS cnt#10860L, count(1) AS count(1)#10864L]\n                                             +- Filter ((ca_address_sk#922 = c_current_addr_sk#864) && (c_preferred_cust_flag#870 = Y))\n                                                +- Join Inner\n                                                   :- SubqueryAlias customer_address\n                                                   :  +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                                                   +- SubqueryAlias customer\n                                                      +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [s_store_name#1391 ASC NULLS FIRST], true\n      +- Aggregate [s_store_name#1391], [s_store_name#1391, MakeDecimal(sum(UnscaledValue(ss_net_profit#1925)),17,2) AS sum(ss_net_profit)#10868]\n         +- Project [ss_net_profit#1925, s_store_name#1391]\n            +- Join Inner, (substring(s_zip#1411, 1, 2) = substring(ca_zip#10858, 1, 2))\n               :- Project [ss_net_profit#1925, s_store_name#1391, s_zip#1411]\n               :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n               :     :- Project [ss_store_sk#1910, ss_net_profit#1925]\n               :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :     :     :- Project [ss_store_sk#1910, ss_net_profit#1925, ss_sold_date_sk#1926]\n               :     :     :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910))\n               :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :     +- Project [d_date_sk#1040]\n               :     :        +- Filter ((((isnotnull(d_qoy#1050) && isnotnull(d_year#1046)) && (d_qoy#1050 = 2)) && (d_year#1046 = 1998)) && isnotnull(d_date_sk#1040))\n               :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [s_store_sk#1386, s_store_name#1391, s_zip#1411]\n               :        +- Filter (isnotnull(s_store_sk#1386) && isnotnull(s_zip#1411))\n               :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               +- Aggregate [ca_zip#10858], [ca_zip#10858]\n                  +- Join LeftSemi, (ca_zip#10858 <=> ca_zip#10859)\n                     :- Project [substring(ca_zip#931, 1, 5) AS ca_zip#10858]\n                     :  +- Filter (substring(ca_zip#931, 1, 5) INSET (56910,69952,63792,39371,74351,11101,25003,97189,57834,73134,62377,51200,32754,22752,86379,14171,91110,40162,98569,28709,13394,66162,25733,25782,26065,18383,51949,87343,50298,83849,33786,64528,23470,67030,46136,25280,46820,77721,99076,18426,31880,17871,98235,45748,49156,18652,72013,51622,43848,78567,41248,13695,44165,67853,54917,53179,64034,10567,71791,68908,55565,59402,64147,85816,57855,61547,27700,68100,28810,58263,15723,83933,51103,58058,90578,82276,81096,81426,96451,77556,38607,76638,18906,62971,57047,48425,35576,11928,30625,83444,73520,51650,57647,60099,30122,94983,24128,10445,41368,26233,26859,21756,24676,19849,36420,38193,58470,39127,13595,87501,24317,15455,69399,98025,81019,48033,11376,39516,67875,92712,14867,38122,29741,42961,30469,51211,56458,15559,16021,33123,33282,33515,72823,54601,76698,56240,72175,60279,20004,68806,72325,28488,43933,50412,45200,22246,78668,79777,96765,67301,73273,49448,82636,23932,47305,29839,39192,18799,61265,37125,58943,64457,88424,24610,84935,89360,68893,30431,28898,10336,90257,59166,46081,26105,96888,36634,86284,35258,39972,22927,73241,53268,24206,27385,99543,31671,14663,30903,39861,24996,63089,88086,83921,21076,67897,66708,45721,60576,25103,52867,30450,36233,30010,96576,73171,56571,56575,64544,13955,78451,43285,18119,16725,83041,76107,79994,54364,35942,56691,19769,63435,34102,18845,22744,13354,75691,45549,23968,31387,83144,13375,15765,28577,88190,19736,73650,37930,25989,83926,94898,51798,39736,22437,55253,38415,71256,18376,42029,25858,44438,19515,38935,51649,71954,15882,18767,63193,25486,49130,37126,40604,34425,17043,12305,11634,26653,94167,36446,10516,67473,66864,72425,63981,18842,22461,42666,47770,69035,70372,28587,45266,15371,15798,45375,90225,16807,31016,68014,21337,19505,50016,10144,84093,21286,19430,34322,91068,94945,72305,24671,58048,65084,28545,21195,20548,22245,77191,96976,48583,76231,15734,61810,11356,68621,68786,98359,41367,26689,69913,76614,68101,88885,50308,79077,18270,28915,29178,53672,62878,10390,14922,68341,56529,41766,68309,56616,15126,61860,97789,11489,45692,41918,72151,72550,27156,36495,70738,17879,53535,17920,68880,78890,35850,14089,58078,65164,27068,26231,13376,57665,32213,77610,87816,21309,15146,86198,91137,55307,67467,40558,94627,82136,22351,89091,20260,23006,91393,47537,62496,98294,18840,71286,81312,31029,70466,35458,14060,22685,28286,25631,19512,40081,63837,14328,35474,22152,76232,51061,86057,17183) && isnotnull(substring(ca_zip#931, 1, 5)))\n                     :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                     +- Project [ca_zip#10859]\n                        +- Filter (count(1)#10864L > 10)\n                           +- Aggregate [ca_zip#931], [substring(ca_zip#931, 1, 5) AS ca_zip#10859, count(1) AS count(1)#10864L]\n                              +- Project [ca_zip#931]\n                                 +- Join Inner, (ca_address_sk#922 = c_current_addr_sk#864)\n                                    :- Project [ca_address_sk#922, ca_zip#931]\n                                    :  +- Filter isnotnull(ca_address_sk#922)\n                                    :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                                    +- Project [c_current_addr_sk#864]\n                                       +- Filter ((isnotnull(c_preferred_cust_flag#870) && (c_preferred_cust_flag#870 = Y)) && isnotnull(c_current_addr_sk#864))\n                                          +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[s_store_name#1391 ASC NULLS FIRST], output=[s_store_name#1391,sum(ss_net_profit)#10868])\n+- *(12) HashAggregate(keys=[s_store_name#1391], functions=[sum(UnscaledValue(ss_net_profit#1925))], output=[s_store_name#1391, sum(ss_net_profit)#10868])\n   +- Exchange hashpartitioning(s_store_name#1391, 200)\n      +- *(11) HashAggregate(keys=[s_store_name#1391], functions=[partial_sum(UnscaledValue(ss_net_profit#1925))], output=[s_store_name#1391, sum#10878L])\n         +- *(11) Project [ss_net_profit#1925, s_store_name#1391]\n            +- *(11) BroadcastHashJoin [substring(s_zip#1411, 1, 2)], [substring(ca_zip#10858, 1, 2)], Inner, BuildRight\n               :- *(11) Project [ss_net_profit#1925, s_store_name#1391, s_zip#1411]\n               :  +- *(11) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n               :     :- *(11) Project [ss_store_sk#1910, ss_net_profit#1925]\n               :     :  +- *(11) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :     :- *(11) Project [ss_store_sk#1910, ss_net_profit#1925, ss_sold_date_sk#1926]\n               :     :     :  +- *(11) Filter isnotnull(ss_store_sk#1910)\n               :     :     :     +- *(11) FileScan parquet db_tpcds.store_sales[ss_store_sk#1910,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:int,ss_net_profit:decimal(7,2)>\n               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(1) Project [d_date_sk#1040]\n               :     :           +- *(1) Filter ((((isnotnull(d_qoy#1050) && isnotnull(d_year#1046)) && (d_qoy#1050 = 2)) && (d_year#1046 = 1998)) && isnotnull(d_date_sk#1040))\n               :     :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_qoy#1050] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(2) Project [s_store_sk#1386, s_store_name#1391, s_zip#1411]\n               :           +- *(2) Filter (isnotnull(s_store_sk#1386) && isnotnull(s_zip#1411))\n               :              +- *(2) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_name#1391,s_zip#1411] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_zip)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_zip:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(substring(input[0, string, true], 1, 2)))\n                  +- *(10) HashAggregate(keys=[ca_zip#10858], functions=[], output=[ca_zip#10858])\n                     +- Exchange hashpartitioning(ca_zip#10858, 200)\n                        +- *(9) HashAggregate(keys=[ca_zip#10858], functions=[], output=[ca_zip#10858])\n                           +- SortMergeJoin [coalesce(ca_zip#10858, )], [coalesce(ca_zip#10859, )], LeftSemi, (ca_zip#10858 <=> ca_zip#10859)\n                              :- *(4) Sort [coalesce(ca_zip#10858, ) ASC NULLS FIRST], false, 0\n                              :  +- Exchange hashpartitioning(coalesce(ca_zip#10858, ), 200)\n                              :     +- *(3) Project [substring(ca_zip#931, 1, 5) AS ca_zip#10858]\n                              :        +- *(3) Filter (substring(ca_zip#931, 1, 5) INSET (56910,69952,63792,39371,74351,11101,25003,97189,57834,73134,62377,51200,32754,22752,86379,14171,91110,40162,98569,28709,13394,66162,25733,25782,26065,18383,51949,87343,50298,83849,33786,64528,23470,67030,46136,25280,46820,77721,99076,18426,31880,17871,98235,45748,49156,18652,72013,51622,43848,78567,41248,13695,44165,67853,54917,53179,64034,10567,71791,68908,55565,59402,64147,85816,57855,61547,27700,68100,28810,58263,15723,83933,51103,58058,90578,82276,81096,81426,96451,77556,38607,76638,18906,62971,57047,48425,35576,11928,30625,83444,73520,51650,57647,60099,30122,94983,24128,10445,41368,26233,26859,21756,24676,19849,36420,38193,58470,39127,13595,87501,24317,15455,69399,98025,81019,48033,11376,39516,67875,92712,14867,38122,29741,42961,30469,51211,56458,15559,16021,33123,33282,33515,72823,54601,76698,56240,72175,60279,20004,68806,72325,28488,43933,50412,45200,22246,78668,79777,96765,67301,73273,49448,82636,23932,47305,29839,39192,18799,61265,37125,58943,64457,88424,24610,84935,89360,68893,30431,28898,10336,90257,59166,46081,26105,96888,36634,86284,35258,39972,22927,73241,53268,24206,27385,99543,31671,14663,30903,39861,24996,63089,88086,83921,21076,67897,66708,45721,60576,25103,52867,30450,36233,30010,96576,73171,56571,56575,64544,13955,78451,43285,18119,16725,83041,76107,79994,54364,35942,56691,19769,63435,34102,18845,22744,13354,75691,45549,23968,31387,83144,13375,15765,28577,88190,19736,73650,37930,25989,83926,94898,51798,39736,22437,55253,38415,71256,18376,42029,25858,44438,19515,38935,51649,71954,15882,18767,63193,25486,49130,37126,40604,34425,17043,12305,11634,26653,94167,36446,10516,67473,66864,72425,63981,18842,22461,42666,47770,69035,70372,28587,45266,15371,15798,45375,90225,16807,31016,68014,21337,19505,50016,10144,84093,21286,19430,34322,91068,94945,72305,24671,58048,65084,28545,21195,20548,22245,77191,96976,48583,76231,15734,61810,11356,68621,68786,98359,41367,26689,69913,76614,68101,88885,50308,79077,18270,28915,29178,53672,62878,10390,14922,68341,56529,41766,68309,56616,15126,61860,97789,11489,45692,41918,72151,72550,27156,36495,70738,17879,53535,17920,68880,78890,35850,14089,58078,65164,27068,26231,13376,57665,32213,77610,87816,21309,15146,86198,91137,55307,67467,40558,94627,82136,22351,89091,20260,23006,91393,47537,62496,98294,18840,71286,81312,31029,70466,35458,14060,22685,28286,25631,19512,40081,63837,14328,35474,22152,76232,51061,86057,17183) && isnotnull(substring(ca_zip#931, 1, 5)))\n                              :           +- *(3) FileScan parquet db_tpcds.customer_address[ca_zip#931] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [], ReadSchema: struct<ca_zip:string>\n                              +- *(8) Sort [coalesce(ca_zip#10859, ) ASC NULLS FIRST], false, 0\n                                 +- Exchange hashpartitioning(coalesce(ca_zip#10859, ), 200)\n                                    +- *(7) Project [ca_zip#10859]\n                                       +- *(7) Filter (count(1)#10864L > 10)\n                                          +- *(7) HashAggregate(keys=[ca_zip#931], functions=[count(1)], output=[ca_zip#10859, count(1)#10864L])\n                                             +- Exchange hashpartitioning(ca_zip#931, 200)\n                                                +- *(6) HashAggregate(keys=[ca_zip#931], functions=[partial_count(1)], output=[ca_zip#931, count#10880L])\n                                                   +- *(6) Project [ca_zip#931]\n                                                      +- *(6) BroadcastHashJoin [ca_address_sk#922], [c_current_addr_sk#864], Inner, BuildLeft\n                                                         :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                                         :  +- *(5) Project [ca_address_sk#922, ca_zip#931]\n                                                         :     +- *(5) Filter isnotnull(ca_address_sk#922)\n                                                         :        +- *(5) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_zip#931] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_zip:string>\n                                                         +- *(6) Project [c_current_addr_sk#864]\n                                                            +- *(6) Filter ((isnotnull(c_preferred_cust_flag#870) && (c_preferred_cust_flag#870 = Y)) && isnotnull(c_current_addr_sk#864))\n                                                               +- *(6) FileScan parquet db_tpcds.customer[c_current_addr_sk#864,c_preferred_cust_flag#870] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_preferred_cust_flag), EqualTo(c_preferred_cust_flag,Y), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_current_addr_sk:int,c_preferred_cust_flag:string>"},{"name":"q9-v2.4","mode":"collect","parameters":{},"joinTypes":[],"tables":["reason"],"parsingTime":0.00239,"analysisTime":0.001213,"optimizationTime":92.979369,"planningTime":7553.436005,"executionTime":12963.20695,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'Project [CASE WHEN (scalar-subquery#11046 [] > 74129) THEN scalar-subquery#11047 [] ELSE scalar-subquery#11048 [] END AS bucket1#11049, CASE WHEN (scalar-subquery#11050 [] > 122840) THEN scalar-subquery#11051 [] ELSE scalar-subquery#11052 [] END AS bucket2#11053, CASE WHEN (scalar-subquery#11054 [] > 56580) THEN scalar-subquery#11055 [] ELSE scalar-subquery#11056 [] END AS bucket3#11057, CASE WHEN (scalar-subquery#11058 [] > 10097) THEN scalar-subquery#11059 [] ELSE scalar-subquery#11060 [] END AS bucket4#11061, CASE WHEN (scalar-subquery#11062 [] > 165306) THEN scalar-subquery#11063 [] ELSE scalar-subquery#11064 [] END AS bucket5#11065]\n:  :- 'Project [unresolvedalias('count(1), None)]\n:  :  +- 'Filter (('ss_quantity >= 1) && ('ss_quantity <= 20))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('avg('ss_ext_discount_amt), None)]\n:  :  +- 'Filter (('ss_quantity >= 1) && ('ss_quantity <= 20))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('avg('ss_net_paid), None)]\n:  :  +- 'Filter (('ss_quantity >= 1) && ('ss_quantity <= 20))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('count(1), None)]\n:  :  +- 'Filter (('ss_quantity >= 21) && ('ss_quantity <= 40))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('avg('ss_ext_discount_amt), None)]\n:  :  +- 'Filter (('ss_quantity >= 21) && ('ss_quantity <= 40))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('avg('ss_net_paid), None)]\n:  :  +- 'Filter (('ss_quantity >= 21) && ('ss_quantity <= 40))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('count(1), None)]\n:  :  +- 'Filter (('ss_quantity >= 41) && ('ss_quantity <= 60))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('avg('ss_ext_discount_amt), None)]\n:  :  +- 'Filter (('ss_quantity >= 41) && ('ss_quantity <= 60))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('avg('ss_net_paid), None)]\n:  :  +- 'Filter (('ss_quantity >= 41) && ('ss_quantity <= 60))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('count(1), None)]\n:  :  +- 'Filter (('ss_quantity >= 61) && ('ss_quantity <= 80))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('avg('ss_ext_discount_amt), None)]\n:  :  +- 'Filter (('ss_quantity >= 61) && ('ss_quantity <= 80))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('avg('ss_net_paid), None)]\n:  :  +- 'Filter (('ss_quantity >= 61) && ('ss_quantity <= 80))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('count(1), None)]\n:  :  +- 'Filter (('ss_quantity >= 81) && ('ss_quantity <= 100))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  :- 'Project [unresolvedalias('avg('ss_ext_discount_amt), None)]\n:  :  +- 'Filter (('ss_quantity >= 81) && ('ss_quantity <= 100))\n:  :     +- 'UnresolvedRelation `store_sales`\n:  +- 'Project [unresolvedalias('avg('ss_net_paid), None)]\n:     +- 'Filter (('ss_quantity >= 81) && ('ss_quantity <= 100))\n:        +- 'UnresolvedRelation `store_sales`\n+- 'Filter ('r_reason_sk = 1)\n   +- 'UnresolvedRelation `reason`\n\n== Analyzed Logical Plan ==\nbucket1: decimal(11,6), bucket2: decimal(11,6), bucket3: decimal(11,6), bucket4: decimal(11,6), bucket5: decimal(11,6)\nProject [CASE WHEN (scalar-subquery#11046 [] > cast(74129 as bigint)) THEN scalar-subquery#11047 [] ELSE scalar-subquery#11048 [] END AS bucket1#11049, CASE WHEN (scalar-subquery#11050 [] > cast(122840 as bigint)) THEN scalar-subquery#11051 [] ELSE scalar-subquery#11052 [] END AS bucket2#11053, CASE WHEN (scalar-subquery#11054 [] > cast(56580 as bigint)) THEN scalar-subquery#11055 [] ELSE scalar-subquery#11056 [] END AS bucket3#11057, CASE WHEN (scalar-subquery#11058 [] > cast(10097 as bigint)) THEN scalar-subquery#11059 [] ELSE scalar-subquery#11060 [] END AS bucket4#11061, CASE WHEN (scalar-subquery#11062 [] > cast(165306 as bigint)) THEN scalar-subquery#11063 [] ELSE scalar-subquery#11064 [] END AS bucket5#11065]\n:  :- Aggregate [count(1) AS count(1)#11067L]\n:  :  +- Filter ((ss_quantity#1913 >= 1) && (ss_quantity#1913 <= 20))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [avg(ss_ext_discount_amt#1917) AS avg(ss_ext_discount_amt)#11069]\n:  :  +- Filter ((ss_quantity#1913 >= 1) && (ss_quantity#1913 <= 20))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [avg(ss_net_paid#1923) AS avg(ss_net_paid)#11071]\n:  :  +- Filter ((ss_quantity#1913 >= 1) && (ss_quantity#1913 <= 20))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [count(1) AS count(1)#11073L]\n:  :  +- Filter ((ss_quantity#1913 >= 21) && (ss_quantity#1913 <= 40))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [avg(ss_ext_discount_amt#1917) AS avg(ss_ext_discount_amt)#11075]\n:  :  +- Filter ((ss_quantity#1913 >= 21) && (ss_quantity#1913 <= 40))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [avg(ss_net_paid#1923) AS avg(ss_net_paid)#11077]\n:  :  +- Filter ((ss_quantity#1913 >= 21) && (ss_quantity#1913 <= 40))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [count(1) AS count(1)#11079L]\n:  :  +- Filter ((ss_quantity#1913 >= 41) && (ss_quantity#1913 <= 60))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [avg(ss_ext_discount_amt#1917) AS avg(ss_ext_discount_amt)#11081]\n:  :  +- Filter ((ss_quantity#1913 >= 41) && (ss_quantity#1913 <= 60))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [avg(ss_net_paid#1923) AS avg(ss_net_paid)#11083]\n:  :  +- Filter ((ss_quantity#1913 >= 41) && (ss_quantity#1913 <= 60))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [count(1) AS count(1)#11085L]\n:  :  +- Filter ((ss_quantity#1913 >= 61) && (ss_quantity#1913 <= 80))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [avg(ss_ext_discount_amt#1917) AS avg(ss_ext_discount_amt)#11087]\n:  :  +- Filter ((ss_quantity#1913 >= 61) && (ss_quantity#1913 <= 80))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [avg(ss_net_paid#1923) AS avg(ss_net_paid)#11089]\n:  :  +- Filter ((ss_quantity#1913 >= 61) && (ss_quantity#1913 <= 80))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [count(1) AS count(1)#11091L]\n:  :  +- Filter ((ss_quantity#1913 >= 81) && (ss_quantity#1913 <= 100))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [avg(ss_ext_discount_amt#1917) AS avg(ss_ext_discount_amt)#11093]\n:  :  +- Filter ((ss_quantity#1913 >= 81) && (ss_quantity#1913 <= 100))\n:  :     +- SubqueryAlias store_sales\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  +- Aggregate [avg(ss_net_paid#1923) AS avg(ss_net_paid)#11095]\n:     +- Filter ((ss_quantity#1913 >= 81) && (ss_quantity#1913 <= 100))\n:        +- SubqueryAlias store_sales\n:           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n+- Filter (r_reason_sk#1298 = 1)\n   +- SubqueryAlias reason\n      +- Relation[r_reason_sk#1298,r_reason_id#1299,r_reason_desc#1300] parquet\n\n== Optimized Logical Plan ==\nProject [CASE WHEN (scalar-subquery#11046 [] > 74129) THEN scalar-subquery#11047 [] ELSE scalar-subquery#11048 [] END AS bucket1#11049, CASE WHEN (scalar-subquery#11050 [] > 122840) THEN scalar-subquery#11051 [] ELSE scalar-subquery#11052 [] END AS bucket2#11053, CASE WHEN (scalar-subquery#11054 [] > 56580) THEN scalar-subquery#11055 [] ELSE scalar-subquery#11056 [] END AS bucket3#11057, CASE WHEN (scalar-subquery#11058 [] > 10097) THEN scalar-subquery#11059 [] ELSE scalar-subquery#11060 [] END AS bucket4#11061, CASE WHEN (scalar-subquery#11062 [] > 165306) THEN scalar-subquery#11063 [] ELSE scalar-subquery#11064 [] END AS bucket5#11065]\n:  :- Aggregate [count(1) AS count(1)#11067L]\n:  :  +- Project\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 1)) && (ss_quantity#1913 <= 20))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [cast((avg(UnscaledValue(ss_ext_discount_amt#1917)) / 100.0) as decimal(11,6)) AS avg(ss_ext_discount_amt)#11069]\n:  :  +- Project [ss_ext_discount_amt#1917]\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 1)) && (ss_quantity#1913 <= 20))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [cast((avg(UnscaledValue(ss_net_paid#1923)) / 100.0) as decimal(11,6)) AS avg(ss_net_paid)#11071]\n:  :  +- Project [ss_net_paid#1923]\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 1)) && (ss_quantity#1913 <= 20))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [count(1) AS count(1)#11073L]\n:  :  +- Project\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 21)) && (ss_quantity#1913 <= 40))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [cast((avg(UnscaledValue(ss_ext_discount_amt#1917)) / 100.0) as decimal(11,6)) AS avg(ss_ext_discount_amt)#11075]\n:  :  +- Project [ss_ext_discount_amt#1917]\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 21)) && (ss_quantity#1913 <= 40))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [cast((avg(UnscaledValue(ss_net_paid#1923)) / 100.0) as decimal(11,6)) AS avg(ss_net_paid)#11077]\n:  :  +- Project [ss_net_paid#1923]\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 21)) && (ss_quantity#1913 <= 40))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [count(1) AS count(1)#11079L]\n:  :  +- Project\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 41)) && (ss_quantity#1913 <= 60))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [cast((avg(UnscaledValue(ss_ext_discount_amt#1917)) / 100.0) as decimal(11,6)) AS avg(ss_ext_discount_amt)#11081]\n:  :  +- Project [ss_ext_discount_amt#1917]\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 41)) && (ss_quantity#1913 <= 60))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [cast((avg(UnscaledValue(ss_net_paid#1923)) / 100.0) as decimal(11,6)) AS avg(ss_net_paid)#11083]\n:  :  +- Project [ss_net_paid#1923]\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 41)) && (ss_quantity#1913 <= 60))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [count(1) AS count(1)#11085L]\n:  :  +- Project\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 61)) && (ss_quantity#1913 <= 80))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [cast((avg(UnscaledValue(ss_ext_discount_amt#1917)) / 100.0) as decimal(11,6)) AS avg(ss_ext_discount_amt)#11087]\n:  :  +- Project [ss_ext_discount_amt#1917]\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 61)) && (ss_quantity#1913 <= 80))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [cast((avg(UnscaledValue(ss_net_paid#1923)) / 100.0) as decimal(11,6)) AS avg(ss_net_paid)#11089]\n:  :  +- Project [ss_net_paid#1923]\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 61)) && (ss_quantity#1913 <= 80))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [count(1) AS count(1)#11091L]\n:  :  +- Project\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 81)) && (ss_quantity#1913 <= 100))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :- Aggregate [cast((avg(UnscaledValue(ss_ext_discount_amt#1917)) / 100.0) as decimal(11,6)) AS avg(ss_ext_discount_amt)#11093]\n:  :  +- Project [ss_ext_discount_amt#1917]\n:  :     +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 81)) && (ss_quantity#1913 <= 100))\n:  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  +- Aggregate [cast((avg(UnscaledValue(ss_net_paid#1923)) / 100.0) as decimal(11,6)) AS avg(ss_net_paid)#11095]\n:     +- Project [ss_net_paid#1923]\n:        +- Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 81)) && (ss_quantity#1913 <= 100))\n:           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n+- Filter (isnotnull(r_reason_sk#1298) && (r_reason_sk#1298 = 1))\n   +- Relation[r_reason_sk#1298,r_reason_id#1299,r_reason_desc#1300] parquet\n\n== Physical Plan ==\n*(1) Project [CASE WHEN (Subquery subquery11046 > 74129) THEN Subquery subquery11047 ELSE Subquery subquery11048 END AS bucket1#11049, CASE WHEN (Subquery subquery11050 > 122840) THEN Subquery subquery11051 ELSE Subquery subquery11052 END AS bucket2#11053, CASE WHEN (Subquery subquery11054 > 56580) THEN Subquery subquery11055 ELSE Subquery subquery11056 END AS bucket3#11057, CASE WHEN (Subquery subquery11058 > 10097) THEN Subquery subquery11059 ELSE Subquery subquery11060 END AS bucket4#11061, CASE WHEN (Subquery subquery11062 > 165306) THEN Subquery subquery11063 ELSE Subquery subquery11064 END AS bucket5#11065]\n:  :- Subquery subquery11046\n:  :  +- *(2) HashAggregate(keys=[], functions=[count(1)], output=[count(1)#11067L])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#11102L])\n:  :           +- *(1) Project\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 1)) && (ss_quantity#1913 <= 20))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,1), LessThanOrEqual(ss_quantity,20)], ReadSchema: struct<ss_quantity:int>\n:  :- Subquery subquery11047\n:  :  +- *(2) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_ext_discount_amt#1917))], output=[avg(ss_ext_discount_amt)#11069])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_avg(UnscaledValue(ss_ext_discount_amt#1917))], output=[sum#11105, count#11106L])\n:  :           +- *(1) Project [ss_ext_discount_amt#1917]\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 1)) && (ss_quantity#1913 <= 20))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_ext_discount_amt#1917,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,1), LessThanOrEqual(ss_quantity,20)], ReadSchema: struct<ss_quantity:int,ss_ext_discount_amt:decimal(7,2)>\n:  :- Subquery subquery11048\n:  :  +- *(2) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_net_paid#1923))], output=[avg(ss_net_paid)#11071])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_avg(UnscaledValue(ss_net_paid#1923))], output=[sum#11109, count#11110L])\n:  :           +- *(1) Project [ss_net_paid#1923]\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 1)) && (ss_quantity#1913 <= 20))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_net_paid#1923,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,1), LessThanOrEqual(ss_quantity,20)], ReadSchema: struct<ss_quantity:int,ss_net_paid:decimal(7,2)>\n:  :- Subquery subquery11050\n:  :  +- *(2) HashAggregate(keys=[], functions=[count(1)], output=[count(1)#11073L])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#11112L])\n:  :           +- *(1) Project\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 21)) && (ss_quantity#1913 <= 40))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,21), LessThanOrEqual(ss_quantity,40)], ReadSchema: struct<ss_quantity:int>\n:  :- Subquery subquery11051\n:  :  +- *(2) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_ext_discount_amt#1917))], output=[avg(ss_ext_discount_amt)#11075])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_avg(UnscaledValue(ss_ext_discount_amt#1917))], output=[sum#11115, count#11116L])\n:  :           +- *(1) Project [ss_ext_discount_amt#1917]\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 21)) && (ss_quantity#1913 <= 40))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_ext_discount_amt#1917,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,21), LessThanOrEqual(ss_quantity,40)], ReadSchema: struct<ss_quantity:int,ss_ext_discount_amt:decimal(7,2)>\n:  :- Subquery subquery11052\n:  :  +- *(2) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_net_paid#1923))], output=[avg(ss_net_paid)#11077])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_avg(UnscaledValue(ss_net_paid#1923))], output=[sum#11119, count#11120L])\n:  :           +- *(1) Project [ss_net_paid#1923]\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 21)) && (ss_quantity#1913 <= 40))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_net_paid#1923,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,21), LessThanOrEqual(ss_quantity,40)], ReadSchema: struct<ss_quantity:int,ss_net_paid:decimal(7,2)>\n:  :- Subquery subquery11054\n:  :  +- *(2) HashAggregate(keys=[], functions=[count(1)], output=[count(1)#11079L])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#11122L])\n:  :           +- *(1) Project\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 41)) && (ss_quantity#1913 <= 60))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,41), LessThanOrEqual(ss_quantity,60)], ReadSchema: struct<ss_quantity:int>\n:  :- Subquery subquery11055\n:  :  +- *(2) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_ext_discount_amt#1917))], output=[avg(ss_ext_discount_amt)#11081])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_avg(UnscaledValue(ss_ext_discount_amt#1917))], output=[sum#11125, count#11126L])\n:  :           +- *(1) Project [ss_ext_discount_amt#1917]\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 41)) && (ss_quantity#1913 <= 60))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_ext_discount_amt#1917,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,41), LessThanOrEqual(ss_quantity,60)], ReadSchema: struct<ss_quantity:int,ss_ext_discount_amt:decimal(7,2)>\n:  :- Subquery subquery11056\n:  :  +- *(2) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_net_paid#1923))], output=[avg(ss_net_paid)#11083])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_avg(UnscaledValue(ss_net_paid#1923))], output=[sum#11129, count#11130L])\n:  :           +- *(1) Project [ss_net_paid#1923]\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 41)) && (ss_quantity#1913 <= 60))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_net_paid#1923,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,41), LessThanOrEqual(ss_quantity,60)], ReadSchema: struct<ss_quantity:int,ss_net_paid:decimal(7,2)>\n:  :- Subquery subquery11058\n:  :  +- *(2) HashAggregate(keys=[], functions=[count(1)], output=[count(1)#11085L])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#11132L])\n:  :           +- *(1) Project\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 61)) && (ss_quantity#1913 <= 80))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,61), LessThanOrEqual(ss_quantity,80)], ReadSchema: struct<ss_quantity:int>\n:  :- Subquery subquery11059\n:  :  +- *(2) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_ext_discount_amt#1917))], output=[avg(ss_ext_discount_amt)#11087])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_avg(UnscaledValue(ss_ext_discount_amt#1917))], output=[sum#11135, count#11136L])\n:  :           +- *(1) Project [ss_ext_discount_amt#1917]\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 61)) && (ss_quantity#1913 <= 80))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_ext_discount_amt#1917,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,61), LessThanOrEqual(ss_quantity,80)], ReadSchema: struct<ss_quantity:int,ss_ext_discount_amt:decimal(7,2)>\n:  :- Subquery subquery11060\n:  :  +- *(2) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_net_paid#1923))], output=[avg(ss_net_paid)#11089])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_avg(UnscaledValue(ss_net_paid#1923))], output=[sum#11139, count#11140L])\n:  :           +- *(1) Project [ss_net_paid#1923]\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 61)) && (ss_quantity#1913 <= 80))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_net_paid#1923,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,61), LessThanOrEqual(ss_quantity,80)], ReadSchema: struct<ss_quantity:int,ss_net_paid:decimal(7,2)>\n:  :- Subquery subquery11062\n:  :  +- *(2) HashAggregate(keys=[], functions=[count(1)], output=[count(1)#11091L])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#11142L])\n:  :           +- *(1) Project\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 81)) && (ss_quantity#1913 <= 100))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,81), LessThanOrEqual(ss_quantity,100)], ReadSchema: struct<ss_quantity:int>\n:  :- Subquery subquery11063\n:  :  +- *(2) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_ext_discount_amt#1917))], output=[avg(ss_ext_discount_amt)#11093])\n:  :     +- Exchange SinglePartition\n:  :        +- *(1) HashAggregate(keys=[], functions=[partial_avg(UnscaledValue(ss_ext_discount_amt#1917))], output=[sum#11145, count#11146L])\n:  :           +- *(1) Project [ss_ext_discount_amt#1917]\n:  :              +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 81)) && (ss_quantity#1913 <= 100))\n:  :                 +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_ext_discount_amt#1917,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,81), LessThanOrEqual(ss_quantity,100)], ReadSchema: struct<ss_quantity:int,ss_ext_discount_amt:decimal(7,2)>\n:  +- Subquery subquery11064\n:     +- *(2) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_net_paid#1923))], output=[avg(ss_net_paid)#11095])\n:        +- Exchange SinglePartition\n:           +- *(1) HashAggregate(keys=[], functions=[partial_avg(UnscaledValue(ss_net_paid#1923))], output=[sum#11149, count#11150L])\n:              +- *(1) Project [ss_net_paid#1923]\n:                 +- *(1) Filter ((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 81)) && (ss_quantity#1913 <= 100))\n:                    +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_net_paid#1923,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,81), LessThanOrEqual(ss_quantity,100)], ReadSchema: struct<ss_quantity:int,ss_net_paid:decimal(7,2)>\n+- *(1) Filter (isnotnull(r_reason_sk#1298) && (r_reason_sk#1298 = 1))\n   +- *(1) FileScan parquet db_tpcds.reason[r_reason_sk#1298] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/reason], PartitionFilters: [], PushedFilters: [IsNotNull(r_reason_sk), EqualTo(r_reason_sk,1)], ReadSchema: struct<r_reason_sk:int>"},{"name":"q10-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["customer","customer_address","customer_demographics"],"parsingTime":0.002479,"analysisTime":8.31E-4,"optimizationTime":982.152526,"planningTime":38.213819,"executionTime":8758.74323,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['cd_gender ASC NULLS FIRST, 'cd_marital_status ASC NULLS FIRST, 'cd_education_status ASC NULLS FIRST, 'cd_purchase_estimate ASC NULLS FIRST, 'cd_credit_rating ASC NULLS FIRST, 'cd_dep_count ASC NULLS FIRST, 'cd_dep_employed_count ASC NULLS FIRST, 'cd_dep_college_count ASC NULLS FIRST], true\n      +- 'Aggregate ['cd_gender, 'cd_marital_status, 'cd_education_status, 'cd_purchase_estimate, 'cd_credit_rating, 'cd_dep_count, 'cd_dep_employed_count, 'cd_dep_college_count], ['cd_gender, 'cd_marital_status, 'cd_education_status, 'count(1) AS cnt1#11280, 'cd_purchase_estimate, 'count(1) AS cnt2#11281, 'cd_credit_rating, 'count(1) AS cnt3#11282, 'cd_dep_count, 'count(1) AS cnt4#11283, 'cd_dep_employed_count, 'count(1) AS cnt5#11284, 'cd_dep_college_count, 'count(1) AS cnt6#11285]\n         +- 'Filter (((('c.c_current_addr_sk = 'ca.ca_address_sk) && 'ca_county IN (Rush County,Toole County,Jefferson County,Dona Ana County,La Porte County)) && ('cd_demo_sk = 'c.c_current_cdemo_sk)) && (exists#11286 [] && (exists#11287 [] || exists#11288 [])))\n            :  :- 'Project [*]\n            :  :  +- 'Filter ((('c.c_customer_sk = 'ss_customer_sk) && ('ss_sold_date_sk = 'd_date_sk)) && (('d_year = 2002) && (('d_moy >= 1) && ('d_moy <= (1 + 3)))))\n            :  :     +- 'Join Inner\n            :  :        :- 'UnresolvedRelation `store_sales`\n            :  :        +- 'UnresolvedRelation `date_dim`\n            :  :- 'Project [*]\n            :  :  +- 'Filter ((('c.c_customer_sk = 'ws_bill_customer_sk) && ('ws_sold_date_sk = 'd_date_sk)) && (('d_year = 2002) && (('d_moy >= 1) && ('d_moy <= (1 + 3)))))\n            :  :     +- 'Join Inner\n            :  :        :- 'UnresolvedRelation `web_sales`\n            :  :        +- 'UnresolvedRelation `date_dim`\n            :  +- 'Project [*]\n            :     +- 'Filter ((('c.c_customer_sk = 'cs_ship_customer_sk) && ('cs_sold_date_sk = 'd_date_sk)) && (('d_year = 2002) && (('d_moy >= 1) && ('d_moy <= (1 + 3)))))\n            :        +- 'Join Inner\n            :           :- 'UnresolvedRelation `catalog_sales`\n            :           +- 'UnresolvedRelation `date_dim`\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'SubqueryAlias c\n               :  :  +- 'UnresolvedRelation `customer`\n               :  +- 'SubqueryAlias ca\n               :     +- 'UnresolvedRelation `customer_address`\n               +- 'UnresolvedRelation `customer_demographics`\n\n== Analyzed Logical Plan ==\ncd_gender: string, cd_marital_status: string, cd_education_status: string, cnt1: bigint, cd_purchase_estimate: int, cnt2: bigint, cd_credit_rating: string, cnt3: bigint, cd_dep_count: int, cnt4: bigint, cd_dep_employed_count: int, cnt5: bigint, cd_dep_college_count: int, cnt6: bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [cd_gender#967 ASC NULLS FIRST, cd_marital_status#968 ASC NULLS FIRST, cd_education_status#969 ASC NULLS FIRST, cd_purchase_estimate#970 ASC NULLS FIRST, cd_credit_rating#971 ASC NULLS FIRST, cd_dep_count#972 ASC NULLS FIRST, cd_dep_employed_count#973 ASC NULLS FIRST, cd_dep_college_count#974 ASC NULLS FIRST], true\n      +- Aggregate [cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974], [cd_gender#967, cd_marital_status#968, cd_education_status#969, count(1) AS cnt1#11280L, cd_purchase_estimate#970, count(1) AS cnt2#11281L, cd_credit_rating#971, count(1) AS cnt3#11282L, cd_dep_count#972, count(1) AS cnt4#11283L, cd_dep_employed_count#973, count(1) AS cnt5#11284L, cd_dep_college_count#974, count(1) AS cnt6#11285L]\n         +- Filter ((((c_current_addr_sk#864 = ca_address_sk#922) && ca_county#929 IN (Rush County,Toole County,Jefferson County,Dona Ana County,La Porte County)) && (cd_demo_sk#966 = c_current_cdemo_sk#862)) && (exists#11286 [c_customer_sk#860] && (exists#11287 [c_customer_sk#860] || exists#11288 [c_customer_sk#860])))\n            :  :- Project [ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, ... 27 more fields]\n            :  :  +- Filter (((outer(c_customer_sk#860) = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && ((d_year#1046 = 2002) && ((d_moy#1048 >= 1) && (d_moy#1048 <= (1 + 3)))))\n            :  :     +- Join Inner\n            :  :        :- SubqueryAlias store_sales\n            :  :        :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :  :        +- SubqueryAlias date_dim\n            :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :  :- Project [ws_sold_time_sk#1755, ws_ship_date_sk#1756, ws_item_sk#1757, ws_bill_customer_sk#1758, ws_bill_cdemo_sk#1759, ws_bill_hdemo_sk#1760, ws_bill_addr_sk#1761, ws_ship_customer_sk#1762, ws_ship_cdemo_sk#1763, ws_ship_hdemo_sk#1764, ws_ship_addr_sk#1765, ws_web_page_sk#1766, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_promo_sk#1770, ws_order_number#1771L, ws_quantity#1772, ws_wholesale_cost#1773, ws_list_price#1774, ws_sales_price#1775, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ... 38 more fields]\n            :  :  +- Filter (((outer(c_customer_sk#860) = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && ((d_year#1046 = 2002) && ((d_moy#1048 >= 1) && (d_moy#1048 <= (1 + 3)))))\n            :  :     +- Join Inner\n            :  :        :- SubqueryAlias web_sales\n            :  :        :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :  :        +- SubqueryAlias date_dim\n            :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :  +- Project [cs_sold_time_sk#1789, cs_ship_date_sk#1790, cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_bill_addr_sk#1794, cs_ship_customer_sk#1795, cs_ship_cdemo_sk#1796, cs_ship_hdemo_sk#1797, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_catalog_page_sk#1800, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_wholesale_cost#1807, cs_list_price#1808, cs_sales_price#1809, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, ... 38 more fields]\n            :     +- Filter (((outer(c_customer_sk#860) = cs_ship_customer_sk#1795) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && ((d_year#1046 = 2002) && ((d_moy#1048 >= 1) && (d_moy#1048 <= (1 + 3)))))\n            :        +- Join Inner\n            :           :- SubqueryAlias catalog_sales\n            :           :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :           +- SubqueryAlias date_dim\n            :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias c\n               :  :  +- SubqueryAlias customer\n               :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  +- SubqueryAlias ca\n               :     +- SubqueryAlias customer_address\n               :        +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- SubqueryAlias customer_demographics\n                  +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [cd_gender#967 ASC NULLS FIRST, cd_marital_status#968 ASC NULLS FIRST, cd_education_status#969 ASC NULLS FIRST, cd_purchase_estimate#970 ASC NULLS FIRST, cd_credit_rating#971 ASC NULLS FIRST, cd_dep_count#972 ASC NULLS FIRST, cd_dep_employed_count#973 ASC NULLS FIRST, cd_dep_college_count#974 ASC NULLS FIRST], true\n      +- Aggregate [cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974], [cd_gender#967, cd_marital_status#968, cd_education_status#969, count(1) AS cnt1#11280L, cd_purchase_estimate#970, count(1) AS cnt2#11281L, cd_credit_rating#971, count(1) AS cnt3#11282L, cd_dep_count#972, count(1) AS cnt4#11283L, cd_dep_employed_count#973, count(1) AS cnt5#11284L, cd_dep_college_count#974, count(1) AS cnt6#11285L]\n         +- Project [cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974]\n            +- Join Inner, (cd_demo_sk#966 = c_current_cdemo_sk#862)\n               :- Project [c_current_cdemo_sk#862]\n               :  +- Join Inner, (c_current_addr_sk#864 = ca_address_sk#922)\n               :     :- Project [c_current_cdemo_sk#862, c_current_addr_sk#864]\n               :     :  +- Filter (exists#11309 || exists#11310)\n               :     :     +- Join ExistenceJoin(exists#11310), (c_customer_sk#860 = cs_ship_customer_sk#1795)\n               :     :        :- Join ExistenceJoin(exists#11309), (c_customer_sk#860 = ws_bill_customer_sk#1758)\n               :     :        :  :- Join LeftSemi, (c_customer_sk#860 = ss_customer_sk#1906)\n               :     :        :  :  :- Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_addr_sk#864]\n               :     :        :  :  :  +- Filter (isnotnull(c_current_addr_sk#864) && isnotnull(c_current_cdemo_sk#862))\n               :     :        :  :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :     :        :  :  +- Project [ss_customer_sk#1906]\n               :     :        :  :     +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :     :        :  :        :- Project [ss_customer_sk#1906, ss_sold_date_sk#1926]\n               :     :        :  :        :  +- Filter isnotnull(ss_sold_date_sk#1926)\n               :     :        :  :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :        :  :        +- Project [d_date_sk#1040]\n               :     :        :  :           +- Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2002)) && (d_moy#1048 >= 1)) && (d_moy#1048 <= 4)) && isnotnull(d_date_sk#1040))\n               :     :        :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :        :  +- Project [ws_bill_customer_sk#1758]\n               :     :        :     +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n               :     :        :        :- Project [ws_bill_customer_sk#1758, ws_sold_date_sk#1788]\n               :     :        :        :  +- Filter isnotnull(ws_sold_date_sk#1788)\n               :     :        :        :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :        :        +- Project [d_date_sk#1040]\n               :     :        :           +- Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2002)) && (d_moy#1048 >= 1)) && (d_moy#1048 <= 4)) && isnotnull(d_date_sk#1040))\n               :     :        :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :        +- Project [cs_ship_customer_sk#1795]\n               :     :           +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :     :              :- Project [cs_ship_customer_sk#1795, cs_sold_date_sk#1822]\n               :     :              :  +- Filter isnotnull(cs_sold_date_sk#1822)\n               :     :              :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :              +- Project [d_date_sk#1040]\n               :     :                 +- Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2002)) && (d_moy#1048 >= 1)) && (d_moy#1048 <= 4)) && isnotnull(d_date_sk#1040))\n               :     :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [ca_address_sk#922]\n               :        +- Filter (ca_county#929 IN (Rush County,Toole County,Jefferson County,Dona Ana County,La Porte County) && isnotnull(ca_address_sk#922))\n               :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- Filter isnotnull(cd_demo_sk#966)\n                  +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[cd_gender#967 ASC NULLS FIRST,cd_marital_status#968 ASC NULLS FIRST,cd_education_status#969 ASC NULLS FIRST,cd_purchase_estimate#970 ASC NULLS FIRST,cd_credit_rating#971 ASC NULLS FIRST,cd_dep_count#972 ASC NULLS FIRST,cd_dep_employed_count#973 ASC NULLS FIRST,cd_dep_college_count#974 ASC NULLS FIRST], output=[cd_gender#967,cd_marital_status#968,cd_education_status#969,cnt1#11280L,cd_purchase_estimate#970,cnt2#11281L,cd_credit_rating#971,cnt3#11282L,cd_dep_count#972,cnt4#11283L,cd_dep_employed_count#973,cnt5#11284L,cd_dep_college_count#974,cnt6#11285L])\n+- *(15) HashAggregate(keys=[cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974], functions=[count(1)], output=[cd_gender#967, cd_marital_status#968, cd_education_status#969, cnt1#11280L, cd_purchase_estimate#970, cnt2#11281L, cd_credit_rating#971, cnt3#11282L, cd_dep_count#972, cnt4#11283L, cd_dep_employed_count#973, cnt5#11284L, cd_dep_college_count#974, cnt6#11285L])\n   +- Exchange hashpartitioning(cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974, 200)\n      +- *(14) HashAggregate(keys=[cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974], functions=[partial_count(1)], output=[cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974, count#11312L])\n         +- *(14) Project [cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974]\n            +- *(14) BroadcastHashJoin [c_current_cdemo_sk#862], [cd_demo_sk#966], Inner, BuildRight\n               :- *(14) Project [c_current_cdemo_sk#862]\n               :  +- *(14) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n               :     :- *(14) Project [c_current_cdemo_sk#862, c_current_addr_sk#864]\n               :     :  +- *(14) Filter (exists#11309 || exists#11310)\n               :     :     +- SortMergeJoin [c_customer_sk#860], [cs_ship_customer_sk#1795], ExistenceJoin(exists#11310)\n               :     :        :- SortMergeJoin [c_customer_sk#860], [ws_bill_customer_sk#1758], ExistenceJoin(exists#11309)\n               :     :        :  :- SortMergeJoin [c_customer_sk#860], [ss_customer_sk#1906], LeftSemi\n               :     :        :  :  :- *(2) Sort [c_customer_sk#860 ASC NULLS FIRST], false, 0\n               :     :        :  :  :  +- Exchange hashpartitioning(c_customer_sk#860, 200)\n               :     :        :  :  :     +- *(1) Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_addr_sk#864]\n               :     :        :  :  :        +- *(1) Filter (isnotnull(c_current_addr_sk#864) && isnotnull(c_current_cdemo_sk#862))\n               :     :        :  :  :           +- *(1) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_cdemo_sk#862,c_current_addr_sk#864] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_current_addr_sk), IsNotNull(c_current_cdemo_sk)], ReadSchema: struct<c_customer_sk:int,c_current_cdemo_sk:int,c_current_addr_sk:int>\n               :     :        :  :  +- *(5) Sort [ss_customer_sk#1906 ASC NULLS FIRST], false, 0\n               :     :        :  :     +- Exchange hashpartitioning(ss_customer_sk#1906, 200)\n               :     :        :  :        +- *(4) Project [ss_customer_sk#1906]\n               :     :        :  :           +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :        :  :              :- *(4) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [], ReadSchema: struct<ss_customer_sk:int>\n               :     :        :  :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        :  :                 +- *(3) Project [d_date_sk#1040]\n               :     :        :  :                    +- *(3) Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2002)) && (d_moy#1048 >= 1)) && (d_moy#1048 <= 4)) && isnotnull(d_date_sk#1040))\n               :     :        :  :                       +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2002), GreaterThanOrEqual(d_moy,1), LessThan..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               :     :        :  +- *(8) Sort [ws_bill_customer_sk#1758 ASC NULLS FIRST], false, 0\n               :     :        :     +- Exchange hashpartitioning(ws_bill_customer_sk#1758, 200)\n               :     :        :        +- *(7) Project [ws_bill_customer_sk#1758]\n               :     :        :           +- *(7) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n               :     :        :              :- *(7) FileScan parquet db_tpcds.web_sales[ws_bill_customer_sk#1758,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [], ReadSchema: struct<ws_bill_customer_sk:int>\n               :     :        :              +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(11) Sort [cs_ship_customer_sk#1795 ASC NULLS FIRST], false, 0\n               :     :           +- Exchange hashpartitioning(cs_ship_customer_sk#1795, 200)\n               :     :              +- *(10) Project [cs_ship_customer_sk#1795]\n               :     :                 +- *(10) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :     :                    :- *(10) FileScan parquet db_tpcds.catalog_sales[cs_ship_customer_sk#1795,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_ship_customer_sk:int>\n               :     :                    +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(12) Project [ca_address_sk#922]\n               :           +- *(12) Filter (ca_county#929 IN (Rush County,Toole County,Jefferson County,Dona Ana County,La Porte County) && isnotnull(ca_address_sk#922))\n               :              +- *(12) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_county#929] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [In(ca_county, [Rush County,Toole County,Jefferson County,Dona Ana County,La Porte County]), IsNo..., ReadSchema: struct<ca_address_sk:int,ca_county:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(13) Project [cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974]\n                     +- *(13) Filter isnotnull(cd_demo_sk#966)\n                        +- *(13) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:int,cd_gender:string,cd_marital_status:string,cd_education_status:string,cd_pur..."},{"name":"q11-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["year_total","year_total","year_total","year_total"],"parsingTime":0.002552,"analysisTime":5.9E-4,"optimizationTime":1029.891819,"planningTime":95.560359,"executionTime":17576.171652,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [year_total]\n:  +- 'SubqueryAlias year_total\n:     +- 'Union\n:        :- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#11414, 'c_first_name AS customer_first_name#11415, 'c_last_name AS customer_last_name#11416, 'c_preferred_cust_flag AS customer_preferred_cust_flag#11417, 'c_birth_country AS customer_birth_country#11418, 'c_login AS customer_login#11419, 'c_email_address AS customer_email_address#11420, 'd_year AS dyear#11421, 'sum(('ss_ext_list_price - 'ss_ext_discount_amt)) AS year_total#11422, s AS sale_type#11423]\n:        :  +- 'Filter (('c_customer_sk = 'ss_customer_sk) && ('ss_sold_date_sk = 'd_date_sk))\n:        :     +- 'Join Inner\n:        :        :- 'Join Inner\n:        :        :  :- 'UnresolvedRelation `customer`\n:        :        :  +- 'UnresolvedRelation `store_sales`\n:        :        +- 'UnresolvedRelation `date_dim`\n:        +- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_country, 'c_login, 'c_email_address, 'd_year], ['c_customer_id AS customer_id#11424, 'c_first_name AS customer_first_name#11425, 'c_last_name AS customer_last_name#11426, 'c_preferred_cust_flag AS customer_preferred_cust_flag#11427, 'c_birth_country AS customer_birth_country#11428, 'c_login AS customer_login#11429, 'c_email_address AS customer_email_address#11430, 'd_year AS dyear#11431, 'sum(('ws_ext_list_price - 'ws_ext_discount_amt)) AS year_total#11432, w AS sale_type#11433]\n:           +- 'Filter (('c_customer_sk = 'ws_bill_customer_sk) && ('ws_sold_date_sk = 'd_date_sk))\n:              +- 'Join Inner\n:                 :- 'Join Inner\n:                 :  :- 'UnresolvedRelation `customer`\n:                 :  +- 'UnresolvedRelation `web_sales`\n:                 +- 'UnresolvedRelation `date_dim`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['t_s_secyear.customer_id ASC NULLS FIRST, 't_s_secyear.customer_first_name ASC NULLS FIRST, 't_s_secyear.customer_last_name ASC NULLS FIRST, 't_s_secyear.customer_preferred_cust_flag ASC NULLS FIRST], true\n         +- 'Project ['t_s_secyear.customer_id, 't_s_secyear.customer_first_name, 't_s_secyear.customer_last_name, 't_s_secyear.customer_preferred_cust_flag]\n            +- 'Filter ((((('t_s_secyear.customer_id = 't_s_firstyear.customer_id) && ('t_s_firstyear.customer_id = 't_w_secyear.customer_id)) && (('t_s_firstyear.customer_id = 't_w_firstyear.customer_id) && ('t_s_firstyear.sale_type = s))) && ((('t_w_firstyear.sale_type = w) && ('t_s_secyear.sale_type = s)) && ('t_w_secyear.sale_type = w))) && (((('t_s_firstyear.dyear = 2001) && ('t_s_secyear.dyear = (2001 + 1))) && (('t_w_firstyear.dyear = 2001) && ('t_w_secyear.dyear = (2001 + 1)))) && ((('t_s_firstyear.year_total > 0) && ('t_w_firstyear.year_total > 0)) && (CASE WHEN ('t_w_firstyear.year_total > 0) THEN ('t_w_secyear.year_total / 't_w_firstyear.year_total) ELSE 0.0 END > CASE WHEN ('t_s_firstyear.year_total > 0) THEN ('t_s_secyear.year_total / 't_s_firstyear.year_total) ELSE 0.0 END))))\n               +- 'Join Inner\n                  :- 'Join Inner\n                  :  :- 'Join Inner\n                  :  :  :- 'SubqueryAlias t_s_firstyear\n                  :  :  :  +- 'UnresolvedRelation `year_total`\n                  :  :  +- 'SubqueryAlias t_s_secyear\n                  :  :     +- 'UnresolvedRelation `year_total`\n                  :  +- 'SubqueryAlias t_w_firstyear\n                  :     +- 'UnresolvedRelation `year_total`\n                  +- 'SubqueryAlias t_w_secyear\n                     +- 'UnresolvedRelation `year_total`\n\n== Analyzed Logical Plan ==\ncustomer_id: string, customer_first_name: string, customer_last_name: string, customer_preferred_cust_flag: string\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [customer_id#11436 ASC NULLS FIRST, customer_first_name#11437 ASC NULLS FIRST, customer_last_name#11438 ASC NULLS FIRST, customer_preferred_cust_flag#11439 ASC NULLS FIRST], true\n      +- Project [customer_id#11436, customer_first_name#11437, customer_last_name#11438, customer_preferred_cust_flag#11439]\n         +- Filter (((((customer_id#11436 = customer_id#11414) && (customer_id#11414 = customer_id#11456)) && ((customer_id#11414 = customer_id#11446) && (sale_type#11423 = s))) && (((sale_type#11455 = w) && (sale_type#11445 = s)) && (sale_type#11465 = w))) && ((((dyear#11421 = 2001) && (dyear#11443 = (2001 + 1))) && ((dyear#11453 = 2001) && (dyear#11463 = (2001 + 1)))) && (((cast(year_total#11422 as decimal(18,2)) > cast(cast(0 as decimal(1,0)) as decimal(18,2))) && (cast(year_total#11454 as decimal(18,2)) > cast(cast(0 as decimal(1,0)) as decimal(18,2)))) && (CASE WHEN (cast(year_total#11454 as decimal(18,2)) > cast(cast(0 as decimal(1,0)) as decimal(18,2))) THEN CheckOverflow((promote_precision(cast(year_total#11464 as decimal(18,2))) / promote_precision(cast(year_total#11454 as decimal(18,2)))), DecimalType(38,20)) ELSE cast(0.0 as decimal(38,20)) END > CASE WHEN (cast(year_total#11422 as decimal(18,2)) > cast(cast(0 as decimal(1,0)) as decimal(18,2))) THEN CheckOverflow((promote_precision(cast(year_total#11444 as decimal(18,2))) / promote_precision(cast(year_total#11422 as decimal(18,2)))), DecimalType(38,20)) ELSE cast(0.0 as decimal(38,20)) END))))\n            +- Join Inner\n               :- Join Inner\n               :  :- Join Inner\n               :  :  :- SubqueryAlias t_s_firstyear\n               :  :  :  +- SubqueryAlias year_total\n               :  :  :     +- Union\n               :  :  :        :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#11414, c_first_name#868 AS customer_first_name#11415, c_last_name#869 AS customer_last_name#11416, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#11417, c_birth_country#874 AS customer_birth_country#11418, c_login#875 AS customer_login#11419, c_email_address#876 AS customer_email_address#11420, d_year#1046 AS dyear#11421, sum(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(8,2)))), DecimalType(8,2))) AS year_total#11422, s AS sale_type#11423]\n               :  :  :        :  +- Filter ((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040))\n               :  :  :        :     +- Join Inner\n               :  :  :        :        :- Join Inner\n               :  :  :        :        :  :- SubqueryAlias customer\n               :  :  :        :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :        :        :  +- SubqueryAlias store_sales\n               :  :  :        :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :  :        :        +- SubqueryAlias date_dim\n               :  :  :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :        +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#11424, c_first_name#868 AS customer_first_name#11425, c_last_name#869 AS customer_last_name#11426, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#11427, c_birth_country#874 AS customer_birth_country#11428, c_login#875 AS customer_login#11429, c_email_address#876 AS customer_email_address#11430, d_year#1046 AS dyear#11431, sum(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(8,2)))), DecimalType(8,2))) AS year_total#11432, w AS sale_type#11433]\n               :  :  :           +- Filter ((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040))\n               :  :  :              +- Join Inner\n               :  :  :                 :- Join Inner\n               :  :  :                 :  :- SubqueryAlias customer\n               :  :  :                 :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :                 :  +- SubqueryAlias web_sales\n               :  :  :                 :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :  :  :                 +- SubqueryAlias date_dim\n               :  :  :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  +- SubqueryAlias t_s_secyear\n               :  :     +- SubqueryAlias year_total\n               :  :        +- Union\n               :  :           :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#11436, c_first_name#868 AS customer_first_name#11437, c_last_name#869 AS customer_last_name#11438, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#11439, c_birth_country#874 AS customer_birth_country#11440, c_login#875 AS customer_login#11441, c_email_address#876 AS customer_email_address#11442, d_year#1046 AS dyear#11443, sum(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(8,2)))), DecimalType(8,2))) AS year_total#11444, s AS sale_type#11445]\n               :  :           :  +- Filter ((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040))\n               :  :           :     +- Join Inner\n               :  :           :        :- Join Inner\n               :  :           :        :  :- SubqueryAlias customer\n               :  :           :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :           :        :  +- SubqueryAlias store_sales\n               :  :           :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :           :        +- SubqueryAlias date_dim\n               :  :           :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :           +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#11424, c_first_name#868 AS customer_first_name#11425, c_last_name#869 AS customer_last_name#11426, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#11427, c_birth_country#874 AS customer_birth_country#11428, c_login#875 AS customer_login#11429, c_email_address#876 AS customer_email_address#11430, d_year#1046 AS dyear#11431, sum(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(8,2)))), DecimalType(8,2))) AS year_total#11432, w AS sale_type#11433]\n               :  :              +- Filter ((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040))\n               :  :                 +- Join Inner\n               :  :                    :- Join Inner\n               :  :                    :  :- SubqueryAlias customer\n               :  :                    :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :                    :  +- SubqueryAlias web_sales\n               :  :                    :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :  :                    +- SubqueryAlias date_dim\n               :  :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  +- SubqueryAlias t_w_firstyear\n               :     +- SubqueryAlias year_total\n               :        +- Union\n               :           :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#11446, c_first_name#868 AS customer_first_name#11447, c_last_name#869 AS customer_last_name#11448, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#11449, c_birth_country#874 AS customer_birth_country#11450, c_login#875 AS customer_login#11451, c_email_address#876 AS customer_email_address#11452, d_year#1046 AS dyear#11453, sum(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(8,2)))), DecimalType(8,2))) AS year_total#11454, s AS sale_type#11455]\n               :           :  +- Filter ((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040))\n               :           :     +- Join Inner\n               :           :        :- Join Inner\n               :           :        :  :- SubqueryAlias customer\n               :           :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :           :        :  +- SubqueryAlias store_sales\n               :           :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :           :        +- SubqueryAlias date_dim\n               :           :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :           +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#11424, c_first_name#868 AS customer_first_name#11425, c_last_name#869 AS customer_last_name#11426, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#11427, c_birth_country#874 AS customer_birth_country#11428, c_login#875 AS customer_login#11429, c_email_address#876 AS customer_email_address#11430, d_year#1046 AS dyear#11431, sum(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(8,2)))), DecimalType(8,2))) AS year_total#11432, w AS sale_type#11433]\n               :              +- Filter ((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040))\n               :                 +- Join Inner\n               :                    :- Join Inner\n               :                    :  :- SubqueryAlias customer\n               :                    :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :                    :  +- SubqueryAlias web_sales\n               :                    :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :                    +- SubqueryAlias date_dim\n               :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- SubqueryAlias t_w_secyear\n                  +- SubqueryAlias year_total\n                     +- Union\n                        :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#11456, c_first_name#868 AS customer_first_name#11457, c_last_name#869 AS customer_last_name#11458, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#11459, c_birth_country#874 AS customer_birth_country#11460, c_login#875 AS customer_login#11461, c_email_address#876 AS customer_email_address#11462, d_year#1046 AS dyear#11463, sum(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(8,2)))), DecimalType(8,2))) AS year_total#11464, s AS sale_type#11465]\n                        :  +- Filter ((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040))\n                        :     +- Join Inner\n                        :        :- Join Inner\n                        :        :  :- SubqueryAlias customer\n                        :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                        :        :  +- SubqueryAlias store_sales\n                        :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :        +- SubqueryAlias date_dim\n                        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#11424, c_first_name#868 AS customer_first_name#11425, c_last_name#869 AS customer_last_name#11426, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#11427, c_birth_country#874 AS customer_birth_country#11428, c_login#875 AS customer_login#11429, c_email_address#876 AS customer_email_address#11430, d_year#1046 AS dyear#11431, sum(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(8,2)))), DecimalType(8,2))) AS year_total#11432, w AS sale_type#11433]\n                           +- Filter ((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040))\n                              +- Join Inner\n                                 :- Join Inner\n                                 :  :- SubqueryAlias customer\n                                 :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                                 :  +- SubqueryAlias web_sales\n                                 :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                                 +- SubqueryAlias date_dim\n                                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [customer_id#11436 ASC NULLS FIRST, customer_first_name#11437 ASC NULLS FIRST, customer_last_name#11438 ASC NULLS FIRST, customer_preferred_cust_flag#11439 ASC NULLS FIRST], true\n      +- Project [customer_id#11436, customer_first_name#11437, customer_last_name#11438, customer_preferred_cust_flag#11439]\n         +- Join Inner, ((customer_id#11414 = customer_id#11456) && (CASE WHEN (year_total#11454 > 0.00) THEN CheckOverflow((promote_precision(year_total#11464) / promote_precision(year_total#11454)), DecimalType(38,20)) ELSE 0E-20 END > CASE WHEN (year_total#11422 > 0.00) THEN CheckOverflow((promote_precision(year_total#11444) / promote_precision(year_total#11422)), DecimalType(38,20)) ELSE 0E-20 END))\n            :- Project [customer_id#11414, year_total#11422, customer_id#11436, customer_first_name#11437, customer_last_name#11438, customer_preferred_cust_flag#11439, year_total#11444, year_total#11454]\n            :  +- Join Inner, (customer_id#11414 = customer_id#11446)\n            :     :- Join Inner, (customer_id#11436 = customer_id#11414)\n            :     :  :- Union\n            :     :  :  :- Filter (isnotnull(year_total#11422) && (year_total#11422 > 0.00))\n            :     :  :  :  +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#11414, MakeDecimal(sum(UnscaledValue(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(8,2)))), DecimalType(8,2)))),18,2) AS year_total#11422]\n            :     :  :  :     +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_list_price#1920, d_year#1046]\n            :     :  :  :        +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :     :  :  :           :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n            :     :  :  :           :  +- Join Inner, (c_customer_sk#860 = ss_customer_sk#1906)\n            :     :  :  :           :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876]\n            :     :  :  :           :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n            :     :  :  :           :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :     :  :  :           :     +- Project [ss_customer_sk#1906, ss_ext_discount_amt#1917, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n            :     :  :  :           :        +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n            :     :  :  :           :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :  :  :           +- Project [d_date_sk#1040, d_year#1046]\n            :     :  :  :              +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n            :     :  :  :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :  :  +- LocalRelation <empty>, [customer_id#11424, year_total#11432]\n            :     :  +- Union\n            :     :     :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#11436, c_first_name#868 AS customer_first_name#11437, c_last_name#869 AS customer_last_name#11438, c_preferred_cust_flag#870 AS customer_preferred_cust_flag#11439, MakeDecimal(sum(UnscaledValue(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(8,2)))), DecimalType(8,2)))),18,2) AS year_total#11444]\n            :     :     :  +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_list_price#1920, d_year#1046]\n            :     :     :     +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :     :     :        :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n            :     :     :        :  +- Join Inner, (c_customer_sk#860 = ss_customer_sk#1906)\n            :     :     :        :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876]\n            :     :     :        :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n            :     :     :        :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :     :     :        :     +- Project [ss_customer_sk#1906, ss_ext_discount_amt#1917, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n            :     :     :        :        +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n            :     :     :        :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :     :        +- Project [d_date_sk#1040, d_year#1046]\n            :     :     :           +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n            :     :     :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :     +- LocalRelation <empty>, [customer_id#11424, customer_first_name#11425, customer_last_name#11426, customer_preferred_cust_flag#11427, year_total#11432]\n            :     +- Union\n            :        :- LocalRelation <empty>, [customer_id#11446, year_total#11454]\n            :        +- Filter (isnotnull(year_total#11432) && (year_total#11432 > 0.00))\n            :           +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#11424, MakeDecimal(sum(UnscaledValue(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(8,2)))), DecimalType(8,2)))),18,2) AS year_total#11432]\n            :              +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_list_price#1779, d_year#1046]\n            :                 +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n            :                    :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n            :                    :  +- Join Inner, (c_customer_sk#860 = ws_bill_customer_sk#1758)\n            :                    :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876]\n            :                    :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n            :                    :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :                    :     +- Project [ws_bill_customer_sk#1758, ws_ext_discount_amt#1776, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n            :                    :        +- Filter (isnotnull(ws_bill_customer_sk#1758) && isnotnull(ws_sold_date_sk#1788))\n            :                    :           +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :                    +- Project [d_date_sk#1040, d_year#1046]\n            :                       +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n            :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Union\n               :- LocalRelation <empty>, [customer_id#11456, year_total#11464]\n               +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], [c_customer_id#861 AS customer_id#11424, MakeDecimal(sum(UnscaledValue(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(8,2)))), DecimalType(8,2)))),18,2) AS year_total#11432]\n                  +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_list_price#1779, d_year#1046]\n                     +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                        :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n                        :  +- Join Inner, (c_customer_sk#860 = ws_bill_customer_sk#1758)\n                        :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876]\n                        :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n                        :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                        :     +- Project [ws_bill_customer_sk#1758, ws_ext_discount_amt#1776, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n                        :        +- Filter (isnotnull(ws_bill_customer_sk#1758) && isnotnull(ws_sold_date_sk#1788))\n                        :           +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        +- Project [d_date_sk#1040, d_year#1046]\n                           +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n                              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[customer_id#11436 ASC NULLS FIRST,customer_first_name#11437 ASC NULLS FIRST,customer_last_name#11438 ASC NULLS FIRST,customer_preferred_cust_flag#11439 ASC NULLS FIRST], output=[customer_id#11436,customer_first_name#11437,customer_last_name#11438,customer_preferred_cust_flag#11439])\n+- *(23) Project [customer_id#11436, customer_first_name#11437, customer_last_name#11438, customer_preferred_cust_flag#11439]\n   +- *(23) SortMergeJoin [customer_id#11414], [customer_id#11456], Inner, (CASE WHEN (year_total#11454 > 0.00) THEN CheckOverflow((promote_precision(year_total#11464) / promote_precision(year_total#11454)), DecimalType(38,20)) ELSE 0E-20 END > CASE WHEN (year_total#11422 > 0.00) THEN CheckOverflow((promote_precision(year_total#11444) / promote_precision(year_total#11422)), DecimalType(38,20)) ELSE 0E-20 END)\n      :- *(17) Project [customer_id#11414, year_total#11422, customer_id#11436, customer_first_name#11437, customer_last_name#11438, customer_preferred_cust_flag#11439, year_total#11444, year_total#11454]\n      :  +- *(17) SortMergeJoin [customer_id#11414], [customer_id#11446], Inner\n      :     :- *(11) SortMergeJoin [customer_id#11414], [customer_id#11436], Inner\n      :     :  :- *(5) Sort [customer_id#11414 ASC NULLS FIRST], false, 0\n      :     :  :  +- Exchange hashpartitioning(customer_id#11414, 200)\n      :     :  :     +- Union\n      :     :  :        :- *(4) Filter (isnotnull(year_total#11422) && (year_total#11422 > 0.00))\n      :     :  :        :  +- *(4) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[sum(UnscaledValue(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(8,2)))), DecimalType(8,2))))], output=[customer_id#11414, year_total#11422])\n      :     :  :        :     +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, 200)\n      :     :  :        :        +- *(3) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[partial_sum(UnscaledValue(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(8,2)))), DecimalType(8,2))))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, sum#11471L])\n      :     :  :        :           +- *(3) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_list_price#1920, d_year#1046]\n      :     :  :        :              +- *(3) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :     :  :        :                 :- *(3) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n      :     :  :        :                 :  +- *(3) BroadcastHashJoin [c_customer_sk#860], [ss_customer_sk#1906], Inner, BuildLeft\n      :     :  :        :                 :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :  :        :                 :     :  +- *(1) Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876]\n      :     :  :        :                 :     :     +- *(1) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n      :     :  :        :                 :     :        +- *(1) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_customer_id#861,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_country#874,c_login#875,c_email_address#876] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_...\n      :     :  :        :                 :     +- *(3) Project [ss_customer_sk#1906, ss_ext_discount_amt#1917, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n      :     :  :        :                 :        +- *(3) Filter isnotnull(ss_customer_sk#1906)\n      :     :  :        :                 :           +- *(3) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_ext_discount_amt#1917,ss_ext_list_price#1920,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_ext_discount_amt:decimal(7,2),ss_ext_list_price:decimal(7,2)>\n      :     :  :        :                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :  :        :                    +- *(2) Project [d_date_sk#1040, d_year#1046]\n      :     :  :        :                       +- *(2) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n      :     :  :        :                          +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n      :     :  :        +- LocalTableScan <empty>, [customer_id#11424, year_total#11432]\n      :     :  +- *(10) Sort [customer_id#11436 ASC NULLS FIRST], false, 0\n      :     :     +- Exchange hashpartitioning(customer_id#11436, 200)\n      :     :        +- Union\n      :     :           :- *(9) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[sum(UnscaledValue(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(8,2)))), DecimalType(8,2))))], output=[customer_id#11436, customer_first_name#11437, customer_last_name#11438, customer_preferred_cust_flag#11439, year_total#11444])\n      :     :           :  +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, 200)\n      :     :           :     +- *(8) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[partial_sum(UnscaledValue(CheckOverflow((promote_precision(cast(ss_ext_list_price#1920 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#1917 as decimal(8,2)))), DecimalType(8,2))))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, sum#11473L])\n      :     :           :        +- *(8) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_list_price#1920, d_year#1046]\n      :     :           :           +- *(8) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :     :           :              :- *(8) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ss_ext_discount_amt#1917, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n      :     :           :              :  +- *(8) BroadcastHashJoin [c_customer_sk#860], [ss_customer_sk#1906], Inner, BuildLeft\n      :     :           :              :     :- ReusedExchange [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :           :              :     +- *(8) Project [ss_customer_sk#1906, ss_ext_discount_amt#1917, ss_ext_list_price#1920, ss_sold_date_sk#1926]\n      :     :           :              :        +- *(8) Filter isnotnull(ss_customer_sk#1906)\n      :     :           :              :           +- *(8) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_ext_discount_amt#1917,ss_ext_list_price#1920,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_ext_discount_amt:decimal(7,2),ss_ext_list_price:decimal(7,2)>\n      :     :           :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :           :                 +- *(7) Project [d_date_sk#1040, d_year#1046]\n      :     :           :                    +- *(7) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n      :     :           :                       +- *(7) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n      :     :           +- LocalTableScan <empty>, [customer_id#11424, customer_first_name#11425, customer_last_name#11426, customer_preferred_cust_flag#11427, year_total#11432]\n      :     +- *(16) Sort [customer_id#11446 ASC NULLS FIRST], false, 0\n      :        +- Exchange hashpartitioning(customer_id#11446, 200)\n      :           +- Union\n      :              :- LocalTableScan <empty>, [customer_id#11446, year_total#11454]\n      :              +- *(15) Filter (isnotnull(year_total#11432) && (year_total#11432 > 0.00))\n      :                 +- *(15) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[sum(UnscaledValue(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(8,2)))), DecimalType(8,2))))], output=[customer_id#11424, year_total#11432])\n      :                    +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, 200)\n      :                       +- *(14) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[partial_sum(UnscaledValue(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(8,2)))), DecimalType(8,2))))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, sum#11475L])\n      :                          +- *(14) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_list_price#1779, d_year#1046]\n      :                             +- *(14) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n      :                                :- *(14) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n      :                                :  +- *(14) BroadcastHashJoin [c_customer_sk#860], [ws_bill_customer_sk#1758], Inner, BuildLeft\n      :                                :     :- ReusedExchange [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                                :     +- *(14) Project [ws_bill_customer_sk#1758, ws_ext_discount_amt#1776, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n      :                                :        +- *(14) Filter isnotnull(ws_bill_customer_sk#1758)\n      :                                :           +- *(14) FileScan parquet db_tpcds.web_sales[ws_bill_customer_sk#1758,ws_ext_discount_amt#1776,ws_ext_list_price#1779,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:int,ws_ext_discount_amt:decimal(7,2),ws_ext_list_price:decimal(7,2)>\n      :                                +- ReusedExchange [d_date_sk#1040, d_year#1046], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      +- *(22) Sort [customer_id#11456 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(customer_id#11456, 200)\n            +- Union\n               :- LocalTableScan <empty>, [customer_id#11456, year_total#11464]\n               +- *(21) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[sum(UnscaledValue(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(8,2)))), DecimalType(8,2))))], output=[customer_id#11424, year_total#11432])\n                  +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, 200)\n                     +- *(20) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046], functions=[partial_sum(UnscaledValue(CheckOverflow((promote_precision(cast(ws_ext_list_price#1779 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#1776 as decimal(8,2)))), DecimalType(8,2))))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, d_year#1046, sum#11477L])\n                        +- *(20) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_list_price#1779, d_year#1046]\n                           +- *(20) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                              :- *(20) Project [c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876, ws_ext_discount_amt#1776, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n                              :  +- *(20) BroadcastHashJoin [c_customer_sk#860], [ws_bill_customer_sk#1758], Inner, BuildLeft\n                              :     :- ReusedExchange [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_country#874, c_login#875, c_email_address#876], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     +- *(20) Project [ws_bill_customer_sk#1758, ws_ext_discount_amt#1776, ws_ext_list_price#1779, ws_sold_date_sk#1788]\n                              :        +- *(20) Filter isnotnull(ws_bill_customer_sk#1758)\n                              :           +- *(20) FileScan parquet db_tpcds.web_sales[ws_bill_customer_sk#1758,ws_ext_discount_amt#1776,ws_ext_list_price#1779,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:int,ws_ext_discount_amt:decimal(7,2),ws_ext_list_price:decimal(7,2)>\n                              +- ReusedExchange [d_date_sk#1040, d_year#1046], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q12-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin"],"tables":["web_sales","item","date_dim"],"parsingTime":0.002781,"analysisTime":7.44E-4,"optimizationTime":268.298351,"planningTime":11.545976,"executionTime":3260.877316,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_category ASC NULLS FIRST, 'i_class ASC NULLS FIRST, 'i_item_id ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST, 'revenueratio ASC NULLS FIRST], true\n      +- 'Aggregate ['i_item_id, 'i_item_desc, 'i_category, 'i_class, 'i_current_price], ['i_item_id, 'i_item_desc, 'i_category, 'i_class, 'i_current_price, 'sum('ws_ext_sales_price) AS itemrevenue#11560, (('sum('ws_ext_sales_price) * 100) / 'sum('sum('ws_ext_sales_price)) windowspecdefinition('i_class, unspecifiedframe$())) AS revenueratio#11561]\n         +- 'Filter ((('ws_item_sk = 'i_item_sk) && 'i_category IN (Sports,Books,Home)) && (('ws_sold_date_sk = 'd_date_sk) && (('d_date >= cast(1999-02-22 as date)) && ('d_date <= (cast(1999-02-22 as date) + interval 4 weeks 2 days)))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'UnresolvedRelation `web_sales`\n               :  +- 'UnresolvedRelation `item`\n               +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\ni_item_id: string, i_item_desc: string, i_category: string, i_class: string, i_current_price: decimal(7,2), itemrevenue: decimal(17,2), revenueratio: decimal(38,17)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_category#1184 ASC NULLS FIRST, i_class#1182 ASC NULLS FIRST, i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, revenueratio#11561 ASC NULLS FIRST], true\n      +- Project [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#11560, revenueratio#11561]\n         +- Project [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#11560, _w0#11566, _w1#11567, _we0#11568, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(_w0#11566 as decimal(17,2))) * promote_precision(cast(cast(100 as decimal(3,0)) as decimal(17,2)))), DecimalType(21,2)) as decimal(27,2))) / promote_precision(cast(_we0#11568 as decimal(27,2)))), DecimalType(38,17)) AS revenueratio#11561]\n            +- Window [sum(_w1#11567) windowspecdefinition(i_class#1182, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#11568], [i_class#1182]\n               +- Aggregate [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177], [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, sum(ws_ext_sales_price#1777) AS itemrevenue#11560, sum(ws_ext_sales_price#1777) AS _w0#11566, sum(ws_ext_sales_price#1777) AS _w1#11567]\n                  +- Filter (((ws_item_sk#1757 = i_item_sk#1172) && i_category#1184 IN (Sports,Books,Home)) && ((ws_sold_date_sk#1788 = d_date_sk#1040) && ((d_date#1042 >= cast(1999-02-22 as date)) && (d_date#1042 <= cast(cast(cast(1999-02-22 as date) as timestamp) + interval 4 weeks 2 days as date)))))\n                     +- Join Inner\n                        :- Join Inner\n                        :  :- SubqueryAlias web_sales\n                        :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        :  +- SubqueryAlias item\n                        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        +- SubqueryAlias date_dim\n                           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_category#1184 ASC NULLS FIRST, i_class#1182 ASC NULLS FIRST, i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, revenueratio#11561 ASC NULLS FIRST], true\n      +- Project [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#11560, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(_w0#11566) * 100.00), DecimalType(21,2)) as decimal(27,2))) / promote_precision(_we0#11568)), DecimalType(38,17)) AS revenueratio#11561]\n         +- Window [sum(_w1#11567) windowspecdefinition(i_class#1182, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#11568], [i_class#1182]\n            +- Aggregate [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177], [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#1777)),17,2) AS itemrevenue#11560, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#1777)),17,2) AS _w0#11566, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#1777)),17,2) AS _w1#11567]\n               +- Project [ws_ext_sales_price#1777, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                     :- Project [ws_ext_sales_price#1777, ws_sold_date_sk#1788, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                     :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n                     :     :- Project [ws_item_sk#1757, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                     :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n                     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :     +- Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                     :        +- Filter (i_category#1184 IN (Sports,Books,Home) && isnotnull(i_item_sk#1172))\n                     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     +- Project [d_date_sk#1040]\n                        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10644)) && (d_date#1042 <= 10674)) && isnotnull(d_date_sk#1040))\n                           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_category#1184 ASC NULLS FIRST,i_class#1182 ASC NULLS FIRST,i_item_id#1173 ASC NULLS FIRST,i_item_desc#1176 ASC NULLS FIRST,revenueratio#11561 ASC NULLS FIRST], output=[i_item_id#1173,i_item_desc#1176,i_category#1184,i_class#1182,i_current_price#1177,itemrevenue#11560,revenueratio#11561])\n+- *(6) Project [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#11560, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(_w0#11566) * 100.00), DecimalType(21,2)) as decimal(27,2))) / promote_precision(_we0#11568)), DecimalType(38,17)) AS revenueratio#11561]\n   +- Window [sum(_w1#11567) windowspecdefinition(i_class#1182, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#11568], [i_class#1182]\n      +- *(5) Sort [i_class#1182 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(i_class#1182, 200)\n            +- *(4) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177], functions=[sum(UnscaledValue(ws_ext_sales_price#1777))], output=[i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#11560, _w0#11566, _w1#11567])\n               +- Exchange hashpartitioning(i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, 200)\n                  +- *(3) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177], functions=[partial_sum(UnscaledValue(ws_ext_sales_price#1777))], output=[i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, sum#11577L])\n                     +- *(3) Project [ws_ext_sales_price#1777, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                        +- *(3) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                           :- *(3) Project [ws_ext_sales_price#1777, ws_sold_date_sk#1788, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                           :  +- *(3) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n                           :     :- *(3) Project [ws_item_sk#1757, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                           :     :  +- *(3) Filter isnotnull(ws_item_sk#1757)\n                           :     :     +- *(3) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_ext_sales_price:decimal(7,2)>\n                           :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :        +- *(1) Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                           :           +- *(1) Filter (i_category#1184 IN (Sports,Books,Home) && isnotnull(i_item_sk#1172))\n                           :              +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173,i_item_desc#1176,i_current_price#1177,i_class#1182,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [In(i_category, [Sports,Books,Home]), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string,i_item_desc:string,i_current_price:decimal(7,2),i_class:str...\n                           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              +- *(2) Project [d_date_sk#1040]\n                                 +- *(2) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10644)) && (d_date#1042 <= 10674)) && isnotnull(d_date_sk#1040))\n                                    +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1999-02-22), LessThanOrEqual(d_date,1999-03-24), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>"},{"name":"q13-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","store","customer_demographics","household_demographics","customer_address","date_dim"],"parsingTime":0.001983,"analysisTime":6.5E-4,"optimizationTime":426.779882,"planningTime":16.377434,"executionTime":4554.272112,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'Project [unresolvedalias('avg('ss_quantity), None), unresolvedalias('avg('ss_ext_sales_price), None), unresolvedalias('avg('ss_ext_wholesale_cost), None), unresolvedalias('sum('ss_ext_wholesale_cost), None)]\n+- 'Filter (((('s_store_sk = 'ss_store_sk) && ('ss_sold_date_sk = 'd_date_sk)) && ('d_year = 2001)) && ((((((('ss_hdemo_sk = 'hd_demo_sk) && ('cd_demo_sk = 'ss_cdemo_sk)) && ('cd_marital_status = M)) && ((('cd_education_status = Advanced Degree) && (('ss_sales_price >= 100.00) && ('ss_sales_price <= 150.00))) && ('hd_dep_count = 3))) || (((('ss_hdemo_sk = 'hd_demo_sk) && ('cd_demo_sk = 'ss_cdemo_sk)) && ('cd_marital_status = S)) && ((('cd_education_status = College) && (('ss_sales_price >= 50.00) && ('ss_sales_price <= 100.00))) && ('hd_dep_count = 1)))) || (((('ss_hdemo_sk = 'hd_demo_sk) && ('cd_demo_sk = 'ss_cdemo_sk)) && ('cd_marital_status = W)) && ((('cd_education_status = 2 yr Degree) && (('ss_sales_price >= 150.00) && ('ss_sales_price <= 200.00))) && ('hd_dep_count = 1)))) && ((((('ss_addr_sk = 'ca_address_sk) && ('ca_country = United States)) && ('ca_state IN (TX,OH,TX) && (('ss_net_profit >= 100) && ('ss_net_profit <= 200)))) || ((('ss_addr_sk = 'ca_address_sk) && ('ca_country = United States)) && ('ca_state IN (OR,NM,KY) && (('ss_net_profit >= 150) && ('ss_net_profit <= 300))))) || ((('ss_addr_sk = 'ca_address_sk) && ('ca_country = United States)) && ('ca_state IN (VA,TX,MS) && (('ss_net_profit >= 50) && ('ss_net_profit <= 250)))))))\n   +- 'Join Inner\n      :- 'Join Inner\n      :  :- 'Join Inner\n      :  :  :- 'Join Inner\n      :  :  :  :- 'Join Inner\n      :  :  :  :  :- 'UnresolvedRelation `store_sales`\n      :  :  :  :  +- 'UnresolvedRelation `store`\n      :  :  :  +- 'UnresolvedRelation `customer_demographics`\n      :  :  +- 'UnresolvedRelation `household_demographics`\n      :  +- 'UnresolvedRelation `customer_address`\n      +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\navg(ss_quantity): double, avg(ss_ext_sales_price): decimal(11,6), avg(ss_ext_wholesale_cost): decimal(11,6), sum(ss_ext_wholesale_cost): decimal(17,2)\nAggregate [avg(cast(ss_quantity#1913 as bigint)) AS avg(ss_quantity)#11825, avg(ss_ext_sales_price#1918) AS avg(ss_ext_sales_price)#11826, avg(ss_ext_wholesale_cost#1919) AS avg(ss_ext_wholesale_cost)#11827, sum(ss_ext_wholesale_cost#1919) AS sum(ss_ext_wholesale_cost)#11828]\n+- Filter ((((s_store_sk#1386 = ss_store_sk#1910) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && (d_year#1046 = 2001)) && (((((((ss_hdemo_sk#1908 = hd_demo_sk#1106) && (cd_demo_sk#966 = ss_cdemo_sk#1907)) && (cd_marital_status#968 = M)) && (((cd_education_status#969 = Advanced Degree) && ((cast(ss_sales_price#1916 as decimal(7,2)) >= cast(100.00 as decimal(7,2))) && (cast(ss_sales_price#1916 as decimal(7,2)) <= cast(150.00 as decimal(7,2))))) && (hd_dep_count#1109 = 3))) || ((((ss_hdemo_sk#1908 = hd_demo_sk#1106) && (cd_demo_sk#966 = ss_cdemo_sk#1907)) && (cd_marital_status#968 = S)) && (((cd_education_status#969 = College) && ((cast(ss_sales_price#1916 as decimal(7,2)) >= cast(50.00 as decimal(7,2))) && (cast(ss_sales_price#1916 as decimal(7,2)) <= cast(100.00 as decimal(7,2))))) && (hd_dep_count#1109 = 1)))) || ((((ss_hdemo_sk#1908 = hd_demo_sk#1106) && (cd_demo_sk#966 = ss_cdemo_sk#1907)) && (cd_marital_status#968 = W)) && (((cd_education_status#969 = 2 yr Degree) && ((cast(ss_sales_price#1916 as decimal(7,2)) >= cast(150.00 as decimal(7,2))) && (cast(ss_sales_price#1916 as decimal(7,2)) <= cast(200.00 as decimal(7,2))))) && (hd_dep_count#1109 = 1)))) && (((((ss_addr_sk#1909 = ca_address_sk#922) && (ca_country#932 = United States)) && (ca_state#930 IN (TX,OH,TX) && ((cast(ss_net_profit#1925 as decimal(7,2)) >= cast(cast(100 as decimal(3,0)) as decimal(7,2))) && (cast(ss_net_profit#1925 as decimal(7,2)) <= cast(cast(200 as decimal(3,0)) as decimal(7,2)))))) || (((ss_addr_sk#1909 = ca_address_sk#922) && (ca_country#932 = United States)) && (ca_state#930 IN (OR,NM,KY) && ((cast(ss_net_profit#1925 as decimal(7,2)) >= cast(cast(150 as decimal(3,0)) as decimal(7,2))) && (cast(ss_net_profit#1925 as decimal(7,2)) <= cast(cast(300 as decimal(3,0)) as decimal(7,2))))))) || (((ss_addr_sk#1909 = ca_address_sk#922) && (ca_country#932 = United States)) && (ca_state#930 IN (VA,TX,MS) && ((cast(ss_net_profit#1925 as decimal(7,2)) >= cast(cast(50 as decimal(2,0)) as decimal(7,2))) && (cast(ss_net_profit#1925 as decimal(7,2)) <= cast(cast(250 as decimal(3,0)) as decimal(7,2)))))))))\n   +- Join Inner\n      :- Join Inner\n      :  :- Join Inner\n      :  :  :- Join Inner\n      :  :  :  :- Join Inner\n      :  :  :  :  :- SubqueryAlias store_sales\n      :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :  :  :  :  +- SubqueryAlias store\n      :  :  :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n      :  :  :  +- SubqueryAlias customer_demographics\n      :  :  :     +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n      :  :  +- SubqueryAlias household_demographics\n      :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n      :  +- SubqueryAlias customer_address\n      :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n      +- SubqueryAlias date_dim\n         +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nAggregate [avg(cast(ss_quantity#1913 as bigint)) AS avg(ss_quantity)#11825, cast((avg(UnscaledValue(ss_ext_sales_price#1918)) / 100.0) as decimal(11,6)) AS avg(ss_ext_sales_price)#11826, cast((avg(UnscaledValue(ss_ext_wholesale_cost#1919)) / 100.0) as decimal(11,6)) AS avg(ss_ext_wholesale_cost)#11827, MakeDecimal(sum(UnscaledValue(ss_ext_wholesale_cost#1919)),17,2) AS sum(ss_ext_wholesale_cost)#11828]\n+- Project [ss_quantity#1913, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919]\n   +- Join Inner, ((ss_hdemo_sk#1908 = hd_demo_sk#1106) && (((((((cd_marital_status#968 = M) && (cd_education_status#969 = Advanced Degree)) && (ss_sales_price#1916 >= 100.00)) && (ss_sales_price#1916 <= 150.00)) && (hd_dep_count#1109 = 3)) || (((((cd_marital_status#968 = S) && (cd_education_status#969 = College)) && (ss_sales_price#1916 >= 50.00)) && (ss_sales_price#1916 <= 100.00)) && (hd_dep_count#1109 = 1))) || (((((cd_marital_status#968 = W) && (cd_education_status#969 = 2 yr Degree)) && (ss_sales_price#1916 >= 150.00)) && (ss_sales_price#1916 <= 200.00)) && (hd_dep_count#1109 = 1))))\n      :- Project [ss_hdemo_sk#1908, ss_quantity#1913, ss_sales_price#1916, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, cd_marital_status#968, cd_education_status#969]\n      :  +- Join Inner, (cd_demo_sk#966 = ss_cdemo_sk#1907)\n      :     :- Project [ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_quantity#1913, ss_sales_price#1916, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919]\n      :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n      :     :     :- Project [ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_quantity#1913, ss_sales_price#1916, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_sold_date_sk#1926]\n      :     :     :  +- Join Inner, ((ss_addr_sk#1909 = ca_address_sk#922) && ((((ca_state#930 IN (TX,OH) && (ss_net_profit#1925 >= 100.00)) && (ss_net_profit#1925 <= 200.00)) || ((ca_state#930 IN (OR,NM,KY) && (ss_net_profit#1925 >= 150.00)) && (ss_net_profit#1925 <= 300.00))) || ((ca_state#930 IN (VA,TX,MS) && (ss_net_profit#1925 >= 50.00)) && (ss_net_profit#1925 <= 250.00))))\n      :     :     :     :- Project [ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_quantity#1913, ss_sales_price#1916, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_net_profit#1925, ss_sold_date_sk#1926]\n      :     :     :     :  +- Join Inner, (s_store_sk#1386 = ss_store_sk#1910)\n      :     :     :     :     :- Project [ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_quantity#1913, ss_sales_price#1916, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_net_profit#1925, ss_sold_date_sk#1926]\n      :     :     :     :     :  +- Filter ((((isnotnull(ss_store_sk#1910) && isnotnull(ss_addr_sk#1909)) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_cdemo_sk#1907)) && isnotnull(ss_hdemo_sk#1908))\n      :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :     :     :     :     +- Project [s_store_sk#1386]\n      :     :     :     :        +- Filter isnotnull(s_store_sk#1386)\n      :     :     :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n      :     :     :     +- Project [ca_address_sk#922, ca_state#930]\n      :     :     :        +- Filter ((isnotnull(ca_country#932) && (ca_country#932 = United States)) && isnotnull(ca_address_sk#922))\n      :     :     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n      :     :     +- Project [d_date_sk#1040]\n      :     :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n      :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n      :     +- Project [cd_demo_sk#966, cd_marital_status#968, cd_education_status#969]\n      :        +- Filter isnotnull(cd_demo_sk#966)\n      :           +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n      +- Project [hd_demo_sk#1106, hd_dep_count#1109]\n         +- Filter isnotnull(hd_demo_sk#1106)\n            +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n\n== Physical Plan ==\n*(7) HashAggregate(keys=[], functions=[avg(cast(ss_quantity#1913 as bigint)), avg(UnscaledValue(ss_ext_sales_price#1918)), avg(UnscaledValue(ss_ext_wholesale_cost#1919)), sum(UnscaledValue(ss_ext_wholesale_cost#1919))], output=[avg(ss_quantity)#11825, avg(ss_ext_sales_price)#11826, avg(ss_ext_wholesale_cost)#11827, sum(ss_ext_wholesale_cost)#11828])\n+- Exchange SinglePartition\n   +- *(6) HashAggregate(keys=[], functions=[partial_avg(cast(ss_quantity#1913 as bigint)), partial_avg(UnscaledValue(ss_ext_sales_price#1918)), partial_avg(UnscaledValue(ss_ext_wholesale_cost#1919)), partial_sum(UnscaledValue(ss_ext_wholesale_cost#1919))], output=[sum#11840, count#11841L, sum#11842, count#11843L, sum#11844, count#11845L, sum#11846L])\n      +- *(6) Project [ss_quantity#1913, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919]\n         +- *(6) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight, (((((((cd_marital_status#968 = M) && (cd_education_status#969 = Advanced Degree)) && (ss_sales_price#1916 >= 100.00)) && (ss_sales_price#1916 <= 150.00)) && (hd_dep_count#1109 = 3)) || (((((cd_marital_status#968 = S) && (cd_education_status#969 = College)) && (ss_sales_price#1916 >= 50.00)) && (ss_sales_price#1916 <= 100.00)) && (hd_dep_count#1109 = 1))) || (((((cd_marital_status#968 = W) && (cd_education_status#969 = 2 yr Degree)) && (ss_sales_price#1916 >= 150.00)) && (ss_sales_price#1916 <= 200.00)) && (hd_dep_count#1109 = 1)))\n            :- *(6) Project [ss_hdemo_sk#1908, ss_quantity#1913, ss_sales_price#1916, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, cd_marital_status#968, cd_education_status#969]\n            :  +- *(6) BroadcastHashJoin [ss_cdemo_sk#1907], [cd_demo_sk#966], Inner, BuildRight\n            :     :- *(6) Project [ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_quantity#1913, ss_sales_price#1916, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919]\n            :     :  +- *(6) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n            :     :     :- *(6) Project [ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_quantity#1913, ss_sales_price#1916, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_sold_date_sk#1926]\n            :     :     :  +- *(6) BroadcastHashJoin [ss_addr_sk#1909], [ca_address_sk#922], Inner, BuildRight, ((((ca_state#930 IN (TX,OH) && (ss_net_profit#1925 >= 100.00)) && (ss_net_profit#1925 <= 200.00)) || ((ca_state#930 IN (OR,NM,KY) && (ss_net_profit#1925 >= 150.00)) && (ss_net_profit#1925 <= 300.00))) || ((ca_state#930 IN (VA,TX,MS) && (ss_net_profit#1925 >= 50.00)) && (ss_net_profit#1925 <= 250.00)))\n            :     :     :     :- *(6) Project [ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_quantity#1913, ss_sales_price#1916, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_net_profit#1925, ss_sold_date_sk#1926]\n            :     :     :     :  +- *(6) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n            :     :     :     :     :- *(6) Project [ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_quantity#1913, ss_sales_price#1916, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_net_profit#1925, ss_sold_date_sk#1926]\n            :     :     :     :     :  +- *(6) Filter (((isnotnull(ss_store_sk#1910) && isnotnull(ss_addr_sk#1909)) && isnotnull(ss_cdemo_sk#1907)) && isnotnull(ss_hdemo_sk#1908))\n            :     :     :     :     :     +- *(6) FileScan parquet db_tpcds.store_sales[ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_quantity#1913,ss_sales_price#1916,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_addr_sk), IsNotNull(ss_cdemo_sk), IsNotNull(ss_hdemo_sk)], ReadSchema: struct<ss_cdemo_sk:int,ss_hdemo_sk:int,ss_addr_sk:int,ss_store_sk:int,ss_quantity:int,ss_sales_pr...\n            :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :     :     :     :        +- *(1) Project [s_store_sk#1386]\n            :     :     :     :           +- *(1) Filter isnotnull(s_store_sk#1386)\n            :     :     :     :              +- *(1) FileScan parquet db_tpcds.store[s_store_sk#1386] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int>\n            :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :     :     :        +- *(2) Project [ca_address_sk#922, ca_state#930]\n            :     :     :           +- *(2) Filter ((isnotnull(ca_country#932) && (ca_country#932 = United States)) && isnotnull(ca_address_sk#922))\n            :     :     :              +- *(2) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930,ca_country#932] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_country), EqualTo(ca_country,United States), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string,ca_country:string>\n            :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :     :        +- *(3) Project [d_date_sk#1040]\n            :     :           +- *(3) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n            :     :              +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n            :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :        +- *(4) Project [cd_demo_sk#966, cd_marital_status#968, cd_education_status#969]\n            :           +- *(4) Filter isnotnull(cd_demo_sk#966)\n            :              +- *(4) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_marital_status#968,cd_education_status#969] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:int,cd_marital_status:string,cd_education_status:string>\n            +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               +- *(5) Project [hd_demo_sk#1106, hd_dep_count#1109]\n                  +- *(5) Filter isnotnull(hd_demo_sk#1106)\n                     +- *(5) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_dep_count#1109] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:int,hd_dep_count:int>"},{"name":"q14a-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin"],"tables":["store_sales","item","date_dim","catalog_sales","item","date_dim","web_sales","item","date_dim"],"parsingTime":0.002195,"analysisTime":7.08E-4,"optimizationTime":5177.359412,"planningTime":530.701693,"executionTime":46760.917384,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [cross_items, avg_sales]\n:  :- 'SubqueryAlias cross_items\n:  :  +- 'Project ['i_item_sk AS ss_item_sk#11996]\n:  :     +- 'Filter ((('i_brand_id = 'brand_id) && ('i_class_id = 'class_id)) && ('i_category_id = 'category_id))\n:  :        +- 'Join Inner\n:  :           :- 'UnresolvedRelation `item`\n:  :           +- 'SubqueryAlias x\n:  :              +- 'Intersect\n:  :                 :- 'Intersect\n:  :                 :  :- 'Project ['iss.i_brand_id AS brand_id#11993, 'iss.i_class_id AS class_id#11994, 'iss.i_category_id AS category_id#11995]\n:  :                 :  :  +- 'Filter ((('ss_item_sk = 'iss.i_item_sk) && ('ss_sold_date_sk = 'd1.d_date_sk)) && (('d1.d_year >= 1999) && ('d1.d_year <= (1999 + 2))))\n:  :                 :  :     +- 'Join Inner\n:  :                 :  :        :- 'Join Inner\n:  :                 :  :        :  :- 'UnresolvedRelation `store_sales`\n:  :                 :  :        :  +- 'SubqueryAlias iss\n:  :                 :  :        :     +- 'UnresolvedRelation `item`\n:  :                 :  :        +- 'SubqueryAlias d1\n:  :                 :  :           +- 'UnresolvedRelation `date_dim`\n:  :                 :  +- 'Project ['ics.i_brand_id, 'ics.i_class_id, 'ics.i_category_id]\n:  :                 :     +- 'Filter ((('cs_item_sk = 'ics.i_item_sk) && ('cs_sold_date_sk = 'd2.d_date_sk)) && (('d2.d_year >= 1999) && ('d2.d_year <= (1999 + 2))))\n:  :                 :        +- 'Join Inner\n:  :                 :           :- 'Join Inner\n:  :                 :           :  :- 'UnresolvedRelation `catalog_sales`\n:  :                 :           :  +- 'SubqueryAlias ics\n:  :                 :           :     +- 'UnresolvedRelation `item`\n:  :                 :           +- 'SubqueryAlias d2\n:  :                 :              +- 'UnresolvedRelation `date_dim`\n:  :                 +- 'Project ['iws.i_brand_id, 'iws.i_class_id, 'iws.i_category_id]\n:  :                    +- 'Filter ((('ws_item_sk = 'iws.i_item_sk) && ('ws_sold_date_sk = 'd3.d_date_sk)) && (('d3.d_year >= 1999) && ('d3.d_year <= (1999 + 2))))\n:  :                       +- 'Join Inner\n:  :                          :- 'Join Inner\n:  :                          :  :- 'UnresolvedRelation `web_sales`\n:  :                          :  +- 'SubqueryAlias iws\n:  :                          :     +- 'UnresolvedRelation `item`\n:  :                          +- 'SubqueryAlias d3\n:  :                             +- 'UnresolvedRelation `date_dim`\n:  +- 'SubqueryAlias avg_sales\n:     +- 'Project ['avg(('quantity * 'list_price)) AS average_sales#12003]\n:        +- 'SubqueryAlias x\n:           +- 'Union\n:              :- 'Union\n:              :  :- 'Project ['ss_quantity AS quantity#11997, 'ss_list_price AS list_price#11998]\n:              :  :  +- 'Filter (('ss_sold_date_sk = 'd_date_sk) && (('d_year >= 1999) && ('d_year <= 2001)))\n:              :  :     +- 'Join Inner\n:              :  :        :- 'UnresolvedRelation `store_sales`\n:              :  :        +- 'UnresolvedRelation `date_dim`\n:              :  +- 'Project ['cs_quantity AS quantity#11999, 'cs_list_price AS list_price#12000]\n:              :     +- 'Filter (('cs_sold_date_sk = 'd_date_sk) && (('d_year >= 1999) && ('d_year <= (1999 + 2))))\n:              :        +- 'Join Inner\n:              :           :- 'UnresolvedRelation `catalog_sales`\n:              :           +- 'UnresolvedRelation `date_dim`\n:              +- 'Project ['ws_quantity AS quantity#12001, 'ws_list_price AS list_price#12002]\n:                 +- 'Filter (('ws_sold_date_sk = 'd_date_sk) && (('d_year >= 1999) && ('d_year <= (1999 + 2))))\n:                    +- 'Join Inner\n:                       :- 'UnresolvedRelation `web_sales`\n:                       +- 'UnresolvedRelation `date_dim`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['channel ASC NULLS FIRST, 'i_brand_id ASC NULLS FIRST, 'i_class_id ASC NULLS FIRST, 'i_category_id ASC NULLS FIRST], true\n         +- 'Aggregate ['rollup('channel, 'i_brand_id, 'i_class_id, 'i_category_id)], ['channel, 'i_brand_id, 'i_class_id, 'i_category_id, unresolvedalias('sum('sales), None), unresolvedalias('sum('number_sales), None)]\n            +- 'SubqueryAlias y\n               +- 'Union\n                  :- 'Union\n                  :  :- 'Filter ('sum(('ss_quantity * 'ss_list_price)) > scalar-subquery#11982 [])\n                  :  :  :  +- 'Project ['average_sales]\n                  :  :  :     +- 'UnresolvedRelation `avg_sales`\n                  :  :  +- 'Aggregate ['i_brand_id, 'i_class_id, 'i_category_id], [store AS channel#11978, 'i_brand_id, 'i_class_id, 'i_category_id, 'sum(('ss_quantity * 'ss_list_price)) AS sales#11979, 'count(1) AS number_sales#11980]\n                  :  :     +- 'Filter ((('ss_item_sk IN (list#11981 []) && ('ss_item_sk = 'i_item_sk)) && ('ss_sold_date_sk = 'd_date_sk)) && (('d_year = (1999 + 2)) && ('d_moy = 11)))\n                  :  :        :  +- 'Project ['ss_item_sk]\n                  :  :        :     +- 'UnresolvedRelation `cross_items`\n                  :  :        +- 'Join Inner\n                  :  :           :- 'Join Inner\n                  :  :           :  :- 'UnresolvedRelation `store_sales`\n                  :  :           :  +- 'UnresolvedRelation `item`\n                  :  :           +- 'UnresolvedRelation `date_dim`\n                  :  +- 'Filter ('sum(('cs_quantity * 'cs_list_price)) > scalar-subquery#11987 [])\n                  :     :  +- 'Project ['average_sales]\n                  :     :     +- 'UnresolvedRelation `avg_sales`\n                  :     +- 'Aggregate ['i_brand_id, 'i_class_id, 'i_category_id], [catalog AS channel#11983, 'i_brand_id, 'i_class_id, 'i_category_id, 'sum(('cs_quantity * 'cs_list_price)) AS sales#11984, 'count(1) AS number_sales#11985]\n                  :        +- 'Filter ((('cs_item_sk IN (list#11986 []) && ('cs_item_sk = 'i_item_sk)) && ('cs_sold_date_sk = 'd_date_sk)) && (('d_year = (1999 + 2)) && ('d_moy = 11)))\n                  :           :  +- 'Project ['ss_item_sk]\n                  :           :     +- 'UnresolvedRelation `cross_items`\n                  :           +- 'Join Inner\n                  :              :- 'Join Inner\n                  :              :  :- 'UnresolvedRelation `catalog_sales`\n                  :              :  +- 'UnresolvedRelation `item`\n                  :              +- 'UnresolvedRelation `date_dim`\n                  +- 'Filter ('sum(('ws_quantity * 'ws_list_price)) > scalar-subquery#11992 [])\n                     :  +- 'Project ['average_sales]\n                     :     +- 'UnresolvedRelation `avg_sales`\n                     +- 'Aggregate ['i_brand_id, 'i_class_id, 'i_category_id], [web AS channel#11988, 'i_brand_id, 'i_class_id, 'i_category_id, 'sum(('ws_quantity * 'ws_list_price)) AS sales#11989, 'count(1) AS number_sales#11990]\n                        +- 'Filter ((('ws_item_sk IN (list#11991 []) && ('ws_item_sk = 'i_item_sk)) && ('ws_sold_date_sk = 'd_date_sk)) && (('d_year = (1999 + 2)) && ('d_moy = 11)))\n                           :  +- 'Project ['ss_item_sk]\n                           :     +- 'UnresolvedRelation `cross_items`\n                           +- 'Join Inner\n                              :- 'Join Inner\n                              :  :- 'UnresolvedRelation `web_sales`\n                              :  +- 'UnresolvedRelation `item`\n                              +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nchannel: string, i_brand_id: int, i_class_id: int, i_category_id: int, sum(sales): decimal(38,2), sum(number_sales): bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#12032 ASC NULLS FIRST, i_brand_id#12033 ASC NULLS FIRST, i_class_id#12034 ASC NULLS FIRST, i_category_id#12035 ASC NULLS FIRST], true\n      +- Aggregate [channel#12032, i_brand_id#12033, i_class_id#12034, i_category_id#12035, spark_grouping_id#12027], [channel#12032, i_brand_id#12033, i_class_id#12034, i_category_id#12035, sum(sales#11979) AS sum(sales)#12022, sum(number_sales#11980L) AS sum(number_sales)#12023L]\n         +- Expand [List(channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11979, number_sales#11980L, channel#12028, i_brand_id#12029, i_class_id#12030, i_category_id#12031, 0), List(channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11979, number_sales#11980L, channel#12028, i_brand_id#12029, i_class_id#12030, null, 1), List(channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11979, number_sales#11980L, channel#12028, i_brand_id#12029, null, null, 3), List(channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11979, number_sales#11980L, channel#12028, null, null, null, 7), List(channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11979, number_sales#11980L, null, null, null, null, 15)], [channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11979, number_sales#11980L, channel#12032, i_brand_id#12033, i_class_id#12034, i_category_id#12035, spark_grouping_id#12027]\n            +- Project [channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11979, number_sales#11980L, channel#11978 AS channel#12028, i_brand_id#1179 AS i_brand_id#12029, i_class_id#1181 AS i_class_id#12030, i_category_id#1183 AS i_category_id#12031]\n               +- SubqueryAlias y\n                  +- Union\n                     :- Union\n                     :  :- Project [channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11979, number_sales#11980L]\n                     :  :  +- Filter (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12013 as decimal(32,6)) > cast(scalar-subquery#11982 [] as decimal(32,6)))\n                     :  :     :  +- Project [average_sales#12003]\n                     :  :     :     +- SubqueryAlias avg_sales\n                     :  :     :        +- Aggregate [avg(CheckOverflow((promote_precision(cast(cast(quantity#11997 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#11998 as decimal(12,2)))), DecimalType(18,2))) AS average_sales#12003]\n                     :  :     :           +- SubqueryAlias x\n                     :  :     :              +- Union\n                     :  :     :                 :- Union\n                     :  :     :                 :  :- Project [ss_quantity#1913 AS quantity#11997, ss_list_price#1915 AS list_price#11998]\n                     :  :     :                 :  :  +- Filter ((ss_sold_date_sk#1926 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= 2001)))\n                     :  :     :                 :  :     +- Join Inner\n                     :  :     :                 :  :        :- SubqueryAlias store_sales\n                     :  :     :                 :  :        :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :  :     :                 :  :        +- SubqueryAlias date_dim\n                     :  :     :                 :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  :     :                 :  +- Project [cs_quantity#1806 AS quantity#11999, cs_list_price#1808 AS list_price#12000]\n                     :  :     :                 :     +- Filter ((cs_sold_date_sk#1822 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                     :  :     :                 :        +- Join Inner\n                     :  :     :                 :           :- SubqueryAlias catalog_sales\n                     :  :     :                 :           :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :  :     :                 :           +- SubqueryAlias date_dim\n                     :  :     :                 :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  :     :                 +- Project [ws_quantity#1772 AS quantity#12001, ws_list_price#1774 AS list_price#12002]\n                     :  :     :                    +- Filter ((ws_sold_date_sk#1788 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                     :  :     :                       +- Join Inner\n                     :  :     :                          :- SubqueryAlias web_sales\n                     :  :     :                          :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :  :     :                          +- SubqueryAlias date_dim\n                     :  :     :                             +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  :     +- Aggregate [i_brand_id#1179, i_class_id#1181, i_category_id#1183], [store AS channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))) AS sales#11979, count(1) AS number_sales#11980L, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12013]\n                     :  :        +- Filter (((ss_item_sk#1905 IN (list#11981 []) && (ss_item_sk#1905 = i_item_sk#1172)) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && ((d_year#1046 = (1999 + 2)) && (d_moy#1048 = 11)))\n                     :  :           :  +- Project [ss_item_sk#11996]\n                     :  :           :     +- SubqueryAlias cross_items\n                     :  :           :        +- Project [i_item_sk#1172 AS ss_item_sk#11996]\n                     :  :           :           +- Filter (((i_brand_id#1179 = brand_id#11993) && (i_class_id#1181 = class_id#11994)) && (i_category_id#1183 = category_id#11995))\n                     :  :           :              +- Join Inner\n                     :  :           :                 :- SubqueryAlias item\n                     :  :           :                 :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :  :           :                 +- SubqueryAlias x\n                     :  :           :                    +- Intersect\n                     :  :           :                       :- Intersect\n                     :  :           :                       :  :- Project [i_brand_id#1179 AS brand_id#11993, i_class_id#1181 AS class_id#11994, i_category_id#1183 AS category_id#11995]\n                     :  :           :                       :  :  +- Filter (((ss_item_sk#1905 = i_item_sk#1172) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                     :  :           :                       :  :     +- Join Inner\n                     :  :           :                       :  :        :- Join Inner\n                     :  :           :                       :  :        :  :- SubqueryAlias store_sales\n                     :  :           :                       :  :        :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :  :           :                       :  :        :  +- SubqueryAlias iss\n                     :  :           :                       :  :        :     +- SubqueryAlias item\n                     :  :           :                       :  :        :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :  :           :                       :  :        +- SubqueryAlias d1\n                     :  :           :                       :  :           +- SubqueryAlias date_dim\n                     :  :           :                       :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  :           :                       :  +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                     :  :           :                       :     +- Filter (((cs_item_sk#1803 = i_item_sk#1172) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                     :  :           :                       :        +- Join Inner\n                     :  :           :                       :           :- Join Inner\n                     :  :           :                       :           :  :- SubqueryAlias catalog_sales\n                     :  :           :                       :           :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :  :           :                       :           :  +- SubqueryAlias ics\n                     :  :           :                       :           :     +- SubqueryAlias item\n                     :  :           :                       :           :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :  :           :                       :           +- SubqueryAlias d2\n                     :  :           :                       :              +- SubqueryAlias date_dim\n                     :  :           :                       :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  :           :                       +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                     :  :           :                          +- Filter (((ws_item_sk#1757 = i_item_sk#1172) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                     :  :           :                             +- Join Inner\n                     :  :           :                                :- Join Inner\n                     :  :           :                                :  :- SubqueryAlias web_sales\n                     :  :           :                                :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :  :           :                                :  +- SubqueryAlias iws\n                     :  :           :                                :     +- SubqueryAlias item\n                     :  :           :                                :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :  :           :                                +- SubqueryAlias d3\n                     :  :           :                                   +- SubqueryAlias date_dim\n                     :  :           :                                      +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  :           +- Join Inner\n                     :  :              :- Join Inner\n                     :  :              :  :- SubqueryAlias store_sales\n                     :  :              :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :  :              :  +- SubqueryAlias item\n                     :  :              :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :  :              +- SubqueryAlias date_dim\n                     :  :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  +- Project [channel#11983, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11984, number_sales#11985L]\n                     :     +- Filter (cast(sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)))#12016 as decimal(32,6)) > cast(scalar-subquery#11987 [] as decimal(32,6)))\n                     :        :  +- Project [average_sales#12003]\n                     :        :     +- SubqueryAlias avg_sales\n                     :        :        +- Aggregate [avg(CheckOverflow((promote_precision(cast(cast(quantity#11997 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#11998 as decimal(12,2)))), DecimalType(18,2))) AS average_sales#12003]\n                     :        :           +- SubqueryAlias x\n                     :        :              +- Union\n                     :        :                 :- Union\n                     :        :                 :  :- Project [ss_quantity#1913 AS quantity#11997, ss_list_price#1915 AS list_price#11998]\n                     :        :                 :  :  +- Filter ((ss_sold_date_sk#1926 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= 2001)))\n                     :        :                 :  :     +- Join Inner\n                     :        :                 :  :        :- SubqueryAlias store_sales\n                     :        :                 :  :        :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :        :                 :  :        +- SubqueryAlias date_dim\n                     :        :                 :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :        :                 :  +- Project [cs_quantity#1806 AS quantity#11999, cs_list_price#1808 AS list_price#12000]\n                     :        :                 :     +- Filter ((cs_sold_date_sk#1822 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                     :        :                 :        +- Join Inner\n                     :        :                 :           :- SubqueryAlias catalog_sales\n                     :        :                 :           :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :        :                 :           +- SubqueryAlias date_dim\n                     :        :                 :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :        :                 +- Project [ws_quantity#1772 AS quantity#12001, ws_list_price#1774 AS list_price#12002]\n                     :        :                    +- Filter ((ws_sold_date_sk#1788 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                     :        :                       +- Join Inner\n                     :        :                          :- SubqueryAlias web_sales\n                     :        :                          :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :        :                          +- SubqueryAlias date_dim\n                     :        :                             +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :        +- Aggregate [i_brand_id#1179, i_class_id#1181, i_category_id#1183], [catalog AS channel#11983, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2))) AS sales#11984, count(1) AS number_sales#11985L, sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)))#12016]\n                     :           +- Filter (((cs_item_sk#1803 IN (list#11986 []) && (cs_item_sk#1803 = i_item_sk#1172)) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && ((d_year#1046 = (1999 + 2)) && (d_moy#1048 = 11)))\n                     :              :  +- Project [ss_item_sk#11996]\n                     :              :     +- SubqueryAlias cross_items\n                     :              :        +- Project [i_item_sk#1172 AS ss_item_sk#11996]\n                     :              :           +- Filter (((i_brand_id#1179 = brand_id#11993) && (i_class_id#1181 = class_id#11994)) && (i_category_id#1183 = category_id#11995))\n                     :              :              +- Join Inner\n                     :              :                 :- SubqueryAlias item\n                     :              :                 :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :              :                 +- SubqueryAlias x\n                     :              :                    +- Intersect\n                     :              :                       :- Intersect\n                     :              :                       :  :- Project [i_brand_id#1179 AS brand_id#11993, i_class_id#1181 AS class_id#11994, i_category_id#1183 AS category_id#11995]\n                     :              :                       :  :  +- Filter (((ss_item_sk#1905 = i_item_sk#1172) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                     :              :                       :  :     +- Join Inner\n                     :              :                       :  :        :- Join Inner\n                     :              :                       :  :        :  :- SubqueryAlias store_sales\n                     :              :                       :  :        :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :              :                       :  :        :  +- SubqueryAlias iss\n                     :              :                       :  :        :     +- SubqueryAlias item\n                     :              :                       :  :        :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :              :                       :  :        +- SubqueryAlias d1\n                     :              :                       :  :           +- SubqueryAlias date_dim\n                     :              :                       :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :              :                       :  +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                     :              :                       :     +- Filter (((cs_item_sk#1803 = i_item_sk#1172) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                     :              :                       :        +- Join Inner\n                     :              :                       :           :- Join Inner\n                     :              :                       :           :  :- SubqueryAlias catalog_sales\n                     :              :                       :           :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :              :                       :           :  +- SubqueryAlias ics\n                     :              :                       :           :     +- SubqueryAlias item\n                     :              :                       :           :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :              :                       :           +- SubqueryAlias d2\n                     :              :                       :              +- SubqueryAlias date_dim\n                     :              :                       :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :              :                       +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                     :              :                          +- Filter (((ws_item_sk#1757 = i_item_sk#1172) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                     :              :                             +- Join Inner\n                     :              :                                :- Join Inner\n                     :              :                                :  :- SubqueryAlias web_sales\n                     :              :                                :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :              :                                :  +- SubqueryAlias iws\n                     :              :                                :     +- SubqueryAlias item\n                     :              :                                :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :              :                                +- SubqueryAlias d3\n                     :              :                                   +- SubqueryAlias date_dim\n                     :              :                                      +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :              +- Join Inner\n                     :                 :- Join Inner\n                     :                 :  :- SubqueryAlias catalog_sales\n                     :                 :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :                 :  +- SubqueryAlias item\n                     :                 :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :                 +- SubqueryAlias date_dim\n                     :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     +- Project [channel#11988, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11989, number_sales#11990L]\n                        +- Filter (cast(sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)))#12019 as decimal(32,6)) > cast(scalar-subquery#11992 [] as decimal(32,6)))\n                           :  +- Project [average_sales#12003]\n                           :     +- SubqueryAlias avg_sales\n                           :        +- Aggregate [avg(CheckOverflow((promote_precision(cast(cast(quantity#11997 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#11998 as decimal(12,2)))), DecimalType(18,2))) AS average_sales#12003]\n                           :           +- SubqueryAlias x\n                           :              +- Union\n                           :                 :- Union\n                           :                 :  :- Project [ss_quantity#1913 AS quantity#11997, ss_list_price#1915 AS list_price#11998]\n                           :                 :  :  +- Filter ((ss_sold_date_sk#1926 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= 2001)))\n                           :                 :  :     +- Join Inner\n                           :                 :  :        :- SubqueryAlias store_sales\n                           :                 :  :        :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                           :                 :  :        +- SubqueryAlias date_dim\n                           :                 :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                           :                 :  +- Project [cs_quantity#1806 AS quantity#11999, cs_list_price#1808 AS list_price#12000]\n                           :                 :     +- Filter ((cs_sold_date_sk#1822 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                           :                 :        +- Join Inner\n                           :                 :           :- SubqueryAlias catalog_sales\n                           :                 :           :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                           :                 :           +- SubqueryAlias date_dim\n                           :                 :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                           :                 +- Project [ws_quantity#1772 AS quantity#12001, ws_list_price#1774 AS list_price#12002]\n                           :                    +- Filter ((ws_sold_date_sk#1788 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                           :                       +- Join Inner\n                           :                          :- SubqueryAlias web_sales\n                           :                          :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                           :                          +- SubqueryAlias date_dim\n                           :                             +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                           +- Aggregate [i_brand_id#1179, i_class_id#1181, i_category_id#1183], [web AS channel#11988, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2))) AS sales#11989, count(1) AS number_sales#11990L, sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)))#12019]\n                              +- Filter (((ws_item_sk#1757 IN (list#11991 []) && (ws_item_sk#1757 = i_item_sk#1172)) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && ((d_year#1046 = (1999 + 2)) && (d_moy#1048 = 11)))\n                                 :  +- Project [ss_item_sk#11996]\n                                 :     +- SubqueryAlias cross_items\n                                 :        +- Project [i_item_sk#1172 AS ss_item_sk#11996]\n                                 :           +- Filter (((i_brand_id#1179 = brand_id#11993) && (i_class_id#1181 = class_id#11994)) && (i_category_id#1183 = category_id#11995))\n                                 :              +- Join Inner\n                                 :                 :- SubqueryAlias item\n                                 :                 :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                                 :                 +- SubqueryAlias x\n                                 :                    +- Intersect\n                                 :                       :- Intersect\n                                 :                       :  :- Project [i_brand_id#1179 AS brand_id#11993, i_class_id#1181 AS class_id#11994, i_category_id#1183 AS category_id#11995]\n                                 :                       :  :  +- Filter (((ss_item_sk#1905 = i_item_sk#1172) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                                 :                       :  :     +- Join Inner\n                                 :                       :  :        :- Join Inner\n                                 :                       :  :        :  :- SubqueryAlias store_sales\n                                 :                       :  :        :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                 :                       :  :        :  +- SubqueryAlias iss\n                                 :                       :  :        :     +- SubqueryAlias item\n                                 :                       :  :        :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                                 :                       :  :        +- SubqueryAlias d1\n                                 :                       :  :           +- SubqueryAlias date_dim\n                                 :                       :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                 :                       :  +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                                 :                       :     +- Filter (((cs_item_sk#1803 = i_item_sk#1172) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                                 :                       :        +- Join Inner\n                                 :                       :           :- Join Inner\n                                 :                       :           :  :- SubqueryAlias catalog_sales\n                                 :                       :           :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                                 :                       :           :  +- SubqueryAlias ics\n                                 :                       :           :     +- SubqueryAlias item\n                                 :                       :           :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                                 :                       :           +- SubqueryAlias d2\n                                 :                       :              +- SubqueryAlias date_dim\n                                 :                       :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                 :                       +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                                 :                          +- Filter (((ws_item_sk#1757 = i_item_sk#1172) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                                 :                             +- Join Inner\n                                 :                                :- Join Inner\n                                 :                                :  :- SubqueryAlias web_sales\n                                 :                                :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                                 :                                :  +- SubqueryAlias iws\n                                 :                                :     +- SubqueryAlias item\n                                 :                                :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                                 :                                +- SubqueryAlias d3\n                                 :                                   +- SubqueryAlias date_dim\n                                 :                                      +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                 +- Join Inner\n                                    :- Join Inner\n                                    :  :- SubqueryAlias web_sales\n                                    :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                                    :  +- SubqueryAlias item\n                                    :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                                    +- SubqueryAlias date_dim\n                                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#12032 ASC NULLS FIRST, i_brand_id#12033 ASC NULLS FIRST, i_class_id#12034 ASC NULLS FIRST, i_category_id#12035 ASC NULLS FIRST], true\n      +- Aggregate [channel#12032, i_brand_id#12033, i_class_id#12034, i_category_id#12035, spark_grouping_id#12027], [channel#12032, i_brand_id#12033, i_class_id#12034, i_category_id#12035, sum(sales#11979) AS sum(sales)#12022, sum(number_sales#11980L) AS sum(number_sales)#12023L]\n         +- Expand [List(sales#11979, number_sales#11980L, channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, 0), List(sales#11979, number_sales#11980L, channel#11978, i_brand_id#1179, i_class_id#1181, null, 1), List(sales#11979, number_sales#11980L, channel#11978, i_brand_id#1179, null, null, 3), List(sales#11979, number_sales#11980L, channel#11978, null, null, null, 7), List(sales#11979, number_sales#11980L, null, null, null, null, 15)], [sales#11979, number_sales#11980L, channel#12032, i_brand_id#12033, i_class_id#12034, i_category_id#12035, spark_grouping_id#12027]\n            +- Union\n               :- Project [sales#11979, number_sales#11980L, channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :  +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12013) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12013 as decimal(32,6)) > cast(scalar-subquery#11982 [] as decimal(32,6))))\n               :     :  +- Aggregate [avg(CheckOverflow((promote_precision(cast(cast(quantity#11997 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#11998 as decimal(12,2)))), DecimalType(18,2))) AS average_sales#12003]\n               :     :     +- Union\n               :     :        :- Project [ss_quantity#1913 AS quantity#11997, ss_list_price#1915 AS list_price#11998]\n               :     :        :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :     :        :     :- Project [ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926]\n               :     :        :     :  +- Filter isnotnull(ss_sold_date_sk#1926)\n               :     :        :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :        :     +- Project [d_date_sk#1040]\n               :     :        :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :        :- Project [cs_quantity#1806 AS quantity#11999, cs_list_price#1808 AS list_price#12000]\n               :     :        :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :     :        :     :- Project [cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n               :     :        :     :  +- Filter isnotnull(cs_sold_date_sk#1822)\n               :     :        :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :        :     +- Project [d_date_sk#1040]\n               :     :        :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :        +- Project [ws_quantity#1772 AS quantity#12001, ws_list_price#1774 AS list_price#12002]\n               :     :           +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n               :     :              :- Project [ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n               :     :              :  +- Filter isnotnull(ws_sold_date_sk#1788)\n               :     :              :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :              +- Project [d_date_sk#1040]\n               :     :                 +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :     :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Aggregate [i_brand_id#1179, i_class_id#1181, i_category_id#1183], [store AS channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))) AS sales#11979, count(1) AS number_sales#11980L, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12013]\n               :        +- Project [ss_quantity#1913, ss_list_price#1915, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :           +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :              :- Project [ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :              :     :- Join LeftSemi, (ss_item_sk#1905 = ss_item_sk#11996)\n               :              :     :  :- Project [ss_item_sk#1905, ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926]\n               :              :     :  :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n               :              :     :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :              :     :  +- Project [i_item_sk#1172 AS ss_item_sk#11996]\n               :              :     :     +- Join Inner, (((i_brand_id#1179 = brand_id#11993) && (i_class_id#1181 = class_id#11994)) && (i_category_id#1183 = category_id#11995))\n               :              :     :        :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :        :  +- Filter ((isnotnull(i_category_id#1183) && isnotnull(i_brand_id#1179)) && isnotnull(i_class_id#1181))\n               :              :     :        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :     :        +- Aggregate [brand_id#11993, class_id#11994, category_id#11995], [brand_id#11993, class_id#11994, category_id#11995]\n               :              :     :           +- Join LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n               :              :     :              :- Aggregate [brand_id#11993, class_id#11994, category_id#11995], [brand_id#11993, class_id#11994, category_id#11995]\n               :              :     :              :  +- Join LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n               :              :     :              :     :- Project [i_brand_id#1179 AS brand_id#11993, i_class_id#1181 AS class_id#11994, i_category_id#1183 AS category_id#11995]\n               :              :     :              :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :              :     :              :     :     :- Project [ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :              :     :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :              :     :              :     :     :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n               :              :     :              :     :     :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n               :              :     :              :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :              :     :              :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :              :     :     :        +- Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179)) && isnotnull(i_category_id#1183))\n               :              :     :              :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :     :              :     :     +- Project [d_date_sk#1040]\n               :              :     :              :     :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :              :     :              :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :     :              :     +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :              :        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :              :     :              :           :- Project [cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :              :           :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n               :              :     :              :           :     :- Project [cs_item_sk#1803, cs_sold_date_sk#1822]\n               :              :     :              :           :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n               :              :     :              :           :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :              :     :              :           :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :              :           :        +- Filter isnotnull(i_item_sk#1172)\n               :              :     :              :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :     :              :           +- Project [d_date_sk#1040]\n               :              :     :              :              +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :              :     :              :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :     :              +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :                 +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n               :              :     :                    :- Project [ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :                    :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n               :              :     :                    :     :- Project [ws_item_sk#1757, ws_sold_date_sk#1788]\n               :              :     :                    :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n               :              :     :                    :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :              :     :                    :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :                    :        +- Filter isnotnull(i_item_sk#1172)\n               :              :     :                    :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :     :                    +- Project [d_date_sk#1040]\n               :              :     :                       +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :              :     :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :     +- Join LeftSemi, (i_item_sk#1172 = ss_item_sk#11996)\n               :              :        :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :        :  +- Filter isnotnull(i_item_sk#1172)\n               :              :        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :        +- Project [i_item_sk#1172 AS ss_item_sk#11996]\n               :              :           +- Join Inner, (((i_brand_id#1179 = brand_id#11993) && (i_class_id#1181 = class_id#11994)) && (i_category_id#1183 = category_id#11995))\n               :              :              :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :              :  +- Filter ((isnotnull(i_category_id#1183) && isnotnull(i_brand_id#1179)) && isnotnull(i_class_id#1181))\n               :              :              :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :              +- Aggregate [brand_id#11993, class_id#11994, category_id#11995], [brand_id#11993, class_id#11994, category_id#11995]\n               :              :                 +- Join LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n               :              :                    :- Aggregate [brand_id#11993, class_id#11994, category_id#11995], [brand_id#11993, class_id#11994, category_id#11995]\n               :              :                    :  +- Join LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n               :              :                    :     :- Project [i_brand_id#1179 AS brand_id#11993, i_class_id#1181 AS class_id#11994, i_category_id#1183 AS category_id#11995]\n               :              :                    :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :              :                    :     :     :- Project [ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                    :     :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :              :                    :     :     :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n               :              :                    :     :     :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n               :              :                    :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :              :                    :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                    :     :     :        +- Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179)) && isnotnull(i_category_id#1183))\n               :              :                    :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :                    :     :     +- Project [d_date_sk#1040]\n               :              :                    :     :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :              :                    :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :                    :     +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                    :        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :              :                    :           :- Project [cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                    :           :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n               :              :                    :           :     :- Project [cs_item_sk#1803, cs_sold_date_sk#1822]\n               :              :                    :           :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n               :              :                    :           :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :              :                    :           :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                    :           :        +- Filter isnotnull(i_item_sk#1172)\n               :              :                    :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :                    :           +- Project [d_date_sk#1040]\n               :              :                    :              +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :              :                    :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :                    +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                       +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n               :              :                          :- Project [ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                          :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n               :              :                          :     :- Project [ws_item_sk#1757, ws_sold_date_sk#1788]\n               :              :                          :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n               :              :                          :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :              :                          :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                          :        +- Filter isnotnull(i_item_sk#1172)\n               :              :                          :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :                          +- Project [d_date_sk#1040]\n               :              :                             +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :              :                                +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              +- Project [d_date_sk#1040]\n               :                 +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 11)) && isnotnull(d_date_sk#1040))\n               :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :- Project [sales#11984, number_sales#11985L, channel#11983, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :  +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)))#12016) && (cast(sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)))#12016 as decimal(32,6)) > cast(scalar-subquery#11987 [] as decimal(32,6))))\n               :     :  +- Aggregate [avg(CheckOverflow((promote_precision(cast(cast(quantity#11997 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#11998 as decimal(12,2)))), DecimalType(18,2))) AS average_sales#12003]\n               :     :     +- Union\n               :     :        :- Project [ss_quantity#1913 AS quantity#11997, ss_list_price#1915 AS list_price#11998]\n               :     :        :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :     :        :     :- Project [ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926]\n               :     :        :     :  +- Filter isnotnull(ss_sold_date_sk#1926)\n               :     :        :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :        :     +- Project [d_date_sk#1040]\n               :     :        :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :        :- Project [cs_quantity#1806 AS quantity#11999, cs_list_price#1808 AS list_price#12000]\n               :     :        :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :     :        :     :- Project [cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n               :     :        :     :  +- Filter isnotnull(cs_sold_date_sk#1822)\n               :     :        :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :        :     +- Project [d_date_sk#1040]\n               :     :        :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :        +- Project [ws_quantity#1772 AS quantity#12001, ws_list_price#1774 AS list_price#12002]\n               :     :           +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n               :     :              :- Project [ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n               :     :              :  +- Filter isnotnull(ws_sold_date_sk#1788)\n               :     :              :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :              +- Project [d_date_sk#1040]\n               :     :                 +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :     :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Aggregate [i_brand_id#1179, i_class_id#1181, i_category_id#1183], [catalog AS channel#11983, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2))) AS sales#11984, count(1) AS number_sales#11985L, sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)))#12016]\n               :        +- Project [cs_quantity#1806, cs_list_price#1808, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :           +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :              :- Project [cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n               :              :     :- Join LeftSemi, (cs_item_sk#1803 = ss_item_sk#11996)\n               :              :     :  :- Project [cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n               :              :     :  :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n               :              :     :  :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :              :     :  +- Project [i_item_sk#1172 AS ss_item_sk#11996]\n               :              :     :     +- Join Inner, (((i_brand_id#1179 = brand_id#11993) && (i_class_id#1181 = class_id#11994)) && (i_category_id#1183 = category_id#11995))\n               :              :     :        :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :        :  +- Filter ((isnotnull(i_category_id#1183) && isnotnull(i_brand_id#1179)) && isnotnull(i_class_id#1181))\n               :              :     :        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :     :        +- Aggregate [brand_id#11993, class_id#11994, category_id#11995], [brand_id#11993, class_id#11994, category_id#11995]\n               :              :     :           +- Join LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n               :              :     :              :- Aggregate [brand_id#11993, class_id#11994, category_id#11995], [brand_id#11993, class_id#11994, category_id#11995]\n               :              :     :              :  +- Join LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n               :              :     :              :     :- Project [i_brand_id#1179 AS brand_id#11993, i_class_id#1181 AS class_id#11994, i_category_id#1183 AS category_id#11995]\n               :              :     :              :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :              :     :              :     :     :- Project [ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :              :     :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :              :     :              :     :     :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n               :              :     :              :     :     :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n               :              :     :              :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :              :     :              :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :              :     :     :        +- Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179)) && isnotnull(i_category_id#1183))\n               :              :     :              :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :     :              :     :     +- Project [d_date_sk#1040]\n               :              :     :              :     :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :              :     :              :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :     :              :     +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :              :        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :              :     :              :           :- Project [cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :              :           :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n               :              :     :              :           :     :- Project [cs_item_sk#1803, cs_sold_date_sk#1822]\n               :              :     :              :           :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n               :              :     :              :           :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :              :     :              :           :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :              :           :        +- Filter isnotnull(i_item_sk#1172)\n               :              :     :              :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :     :              :           +- Project [d_date_sk#1040]\n               :              :     :              :              +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :              :     :              :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :     :              +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :                 +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n               :              :     :                    :- Project [ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :                    :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n               :              :     :                    :     :- Project [ws_item_sk#1757, ws_sold_date_sk#1788]\n               :              :     :                    :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n               :              :     :                    :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :              :     :                    :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :     :                    :        +- Filter isnotnull(i_item_sk#1172)\n               :              :     :                    :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :     :                    +- Project [d_date_sk#1040]\n               :              :     :                       +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :              :     :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :     +- Join LeftSemi, (i_item_sk#1172 = ss_item_sk#11996)\n               :              :        :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :        :  +- Filter isnotnull(i_item_sk#1172)\n               :              :        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :        +- Project [i_item_sk#1172 AS ss_item_sk#11996]\n               :              :           +- Join Inner, (((i_brand_id#1179 = brand_id#11993) && (i_class_id#1181 = class_id#11994)) && (i_category_id#1183 = category_id#11995))\n               :              :              :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :              :  +- Filter ((isnotnull(i_category_id#1183) && isnotnull(i_brand_id#1179)) && isnotnull(i_class_id#1181))\n               :              :              :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :              +- Aggregate [brand_id#11993, class_id#11994, category_id#11995], [brand_id#11993, class_id#11994, category_id#11995]\n               :              :                 +- Join LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n               :              :                    :- Aggregate [brand_id#11993, class_id#11994, category_id#11995], [brand_id#11993, class_id#11994, category_id#11995]\n               :              :                    :  +- Join LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n               :              :                    :     :- Project [i_brand_id#1179 AS brand_id#11993, i_class_id#1181 AS class_id#11994, i_category_id#1183 AS category_id#11995]\n               :              :                    :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :              :                    :     :     :- Project [ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                    :     :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :              :                    :     :     :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n               :              :                    :     :     :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n               :              :                    :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :              :                    :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                    :     :     :        +- Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179)) && isnotnull(i_category_id#1183))\n               :              :                    :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :                    :     :     +- Project [d_date_sk#1040]\n               :              :                    :     :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :              :                    :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :                    :     +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                    :        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :              :                    :           :- Project [cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                    :           :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n               :              :                    :           :     :- Project [cs_item_sk#1803, cs_sold_date_sk#1822]\n               :              :                    :           :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n               :              :                    :           :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :              :                    :           :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                    :           :        +- Filter isnotnull(i_item_sk#1172)\n               :              :                    :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :                    :           +- Project [d_date_sk#1040]\n               :              :                    :              +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :              :                    :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :                    +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                       +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n               :              :                          :- Project [ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                          :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n               :              :                          :     :- Project [ws_item_sk#1757, ws_sold_date_sk#1788]\n               :              :                          :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n               :              :                          :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :              :                          :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :                          :        +- Filter isnotnull(i_item_sk#1172)\n               :              :                          :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :                          +- Project [d_date_sk#1040]\n               :              :                             +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :              :                                +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              +- Project [d_date_sk#1040]\n               :                 +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 11)) && isnotnull(d_date_sk#1040))\n               :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- Project [sales#11989, number_sales#11990L, channel#11988, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                  +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)))#12019) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)))#12019 as decimal(32,6)) > cast(scalar-subquery#11992 [] as decimal(32,6))))\n                     :  +- Aggregate [avg(CheckOverflow((promote_precision(cast(cast(quantity#11997 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#11998 as decimal(12,2)))), DecimalType(18,2))) AS average_sales#12003]\n                     :     +- Union\n                     :        :- Project [ss_quantity#1913 AS quantity#11997, ss_list_price#1915 AS list_price#11998]\n                     :        :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                     :        :     :- Project [ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926]\n                     :        :     :  +- Filter isnotnull(ss_sold_date_sk#1926)\n                     :        :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :        :     +- Project [d_date_sk#1040]\n                     :        :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :        :- Project [cs_quantity#1806 AS quantity#11999, cs_list_price#1808 AS list_price#12000]\n                     :        :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n                     :        :     :- Project [cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n                     :        :     :  +- Filter isnotnull(cs_sold_date_sk#1822)\n                     :        :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :        :     +- Project [d_date_sk#1040]\n                     :        :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :        +- Project [ws_quantity#1772 AS quantity#12001, ws_list_price#1774 AS list_price#12002]\n                     :           +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                     :              :- Project [ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n                     :              :  +- Filter isnotnull(ws_sold_date_sk#1788)\n                     :              :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :              +- Project [d_date_sk#1040]\n                     :                 +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                     :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     +- Aggregate [i_brand_id#1179, i_class_id#1181, i_category_id#1183], [web AS channel#11988, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2))) AS sales#11989, count(1) AS number_sales#11990L, sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)))#12019]\n                        +- Project [ws_quantity#1772, ws_list_price#1774, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                           +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                              :- Project [ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n                              :     :- Join LeftSemi, (ws_item_sk#1757 = ss_item_sk#11996)\n                              :     :  :- Project [ws_item_sk#1757, ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n                              :     :  :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n                              :     :  :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                              :     :  +- Project [i_item_sk#1172 AS ss_item_sk#11996]\n                              :     :     +- Join Inner, (((i_brand_id#1179 = brand_id#11993) && (i_class_id#1181 = class_id#11994)) && (i_category_id#1183 = category_id#11995))\n                              :     :        :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :     :        :  +- Filter ((isnotnull(i_category_id#1183) && isnotnull(i_brand_id#1179)) && isnotnull(i_class_id#1181))\n                              :     :        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :     :        +- Aggregate [brand_id#11993, class_id#11994, category_id#11995], [brand_id#11993, class_id#11994, category_id#11995]\n                              :     :           +- Join LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n                              :     :              :- Aggregate [brand_id#11993, class_id#11994, category_id#11995], [brand_id#11993, class_id#11994, category_id#11995]\n                              :     :              :  +- Join LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n                              :     :              :     :- Project [i_brand_id#1179 AS brand_id#11993, i_class_id#1181 AS class_id#11994, i_category_id#1183 AS category_id#11995]\n                              :     :              :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                              :     :              :     :     :- Project [ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :     :              :     :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                              :     :              :     :     :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n                              :     :              :     :     :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n                              :     :              :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                              :     :              :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :     :              :     :     :        +- Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179)) && isnotnull(i_category_id#1183))\n                              :     :              :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :     :              :     :     +- Project [d_date_sk#1040]\n                              :     :              :     :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                              :     :              :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :     :              :     +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :     :              :        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n                              :     :              :           :- Project [cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :     :              :           :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n                              :     :              :           :     :- Project [cs_item_sk#1803, cs_sold_date_sk#1822]\n                              :     :              :           :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n                              :     :              :           :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                              :     :              :           :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :     :              :           :        +- Filter isnotnull(i_item_sk#1172)\n                              :     :              :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :     :              :           +- Project [d_date_sk#1040]\n                              :     :              :              +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                              :     :              :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :     :              +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :     :                 +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                              :     :                    :- Project [ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :     :                    :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n                              :     :                    :     :- Project [ws_item_sk#1757, ws_sold_date_sk#1788]\n                              :     :                    :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n                              :     :                    :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                              :     :                    :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :     :                    :        +- Filter isnotnull(i_item_sk#1172)\n                              :     :                    :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :     :                    +- Project [d_date_sk#1040]\n                              :     :                       +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                              :     :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :     +- Join LeftSemi, (i_item_sk#1172 = ss_item_sk#11996)\n                              :        :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :        :  +- Filter isnotnull(i_item_sk#1172)\n                              :        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :        +- Project [i_item_sk#1172 AS ss_item_sk#11996]\n                              :           +- Join Inner, (((i_brand_id#1179 = brand_id#11993) && (i_class_id#1181 = class_id#11994)) && (i_category_id#1183 = category_id#11995))\n                              :              :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :              :  +- Filter ((isnotnull(i_category_id#1183) && isnotnull(i_brand_id#1179)) && isnotnull(i_class_id#1181))\n                              :              :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :              +- Aggregate [brand_id#11993, class_id#11994, category_id#11995], [brand_id#11993, class_id#11994, category_id#11995]\n                              :                 +- Join LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n                              :                    :- Aggregate [brand_id#11993, class_id#11994, category_id#11995], [brand_id#11993, class_id#11994, category_id#11995]\n                              :                    :  +- Join LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n                              :                    :     :- Project [i_brand_id#1179 AS brand_id#11993, i_class_id#1181 AS class_id#11994, i_category_id#1183 AS category_id#11995]\n                              :                    :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                              :                    :     :     :- Project [ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :                    :     :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                              :                    :     :     :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n                              :                    :     :     :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n                              :                    :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                              :                    :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :                    :     :     :        +- Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179)) && isnotnull(i_category_id#1183))\n                              :                    :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :                    :     :     +- Project [d_date_sk#1040]\n                              :                    :     :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                              :                    :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :                    :     +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :                    :        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n                              :                    :           :- Project [cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :                    :           :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n                              :                    :           :     :- Project [cs_item_sk#1803, cs_sold_date_sk#1822]\n                              :                    :           :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n                              :                    :           :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                              :                    :           :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :                    :           :        +- Filter isnotnull(i_item_sk#1172)\n                              :                    :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :                    :           +- Project [d_date_sk#1040]\n                              :                    :              +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                              :                    :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :                    +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :                       +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                              :                          :- Project [ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :                          :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n                              :                          :     :- Project [ws_item_sk#1757, ws_sold_date_sk#1788]\n                              :                          :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n                              :                          :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                              :                          :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :                          :        +- Filter isnotnull(i_item_sk#1172)\n                              :                          :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :                          +- Project [d_date_sk#1040]\n                              :                             +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                              :                                +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              +- Project [d_date_sk#1040]\n                                 +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 11)) && isnotnull(d_date_sk#1040))\n                                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[channel#12032 ASC NULLS FIRST,i_brand_id#12033 ASC NULLS FIRST,i_class_id#12034 ASC NULLS FIRST,i_category_id#12035 ASC NULLS FIRST], output=[channel#12032,i_brand_id#12033,i_class_id#12034,i_category_id#12035,sum(sales)#12022,sum(number_sales)#12023L])\n+- *(137) HashAggregate(keys=[channel#12032, i_brand_id#12033, i_class_id#12034, i_category_id#12035, spark_grouping_id#12027], functions=[sum(sales#11979), sum(number_sales#11980L)], output=[channel#12032, i_brand_id#12033, i_class_id#12034, i_category_id#12035, sum(sales)#12022, sum(number_sales)#12023L])\n   +- Exchange hashpartitioning(channel#12032, i_brand_id#12033, i_class_id#12034, i_category_id#12035, spark_grouping_id#12027, 200)\n      +- *(136) HashAggregate(keys=[channel#12032, i_brand_id#12033, i_class_id#12034, i_category_id#12035, spark_grouping_id#12027], functions=[partial_sum(sales#11979), partial_sum(number_sales#11980L)], output=[channel#12032, i_brand_id#12033, i_class_id#12034, i_category_id#12035, spark_grouping_id#12027, sum#12063, sum#12064L])\n         +- *(136) Expand [List(sales#11979, number_sales#11980L, channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, 0), List(sales#11979, number_sales#11980L, channel#11978, i_brand_id#1179, i_class_id#1181, null, 1), List(sales#11979, number_sales#11980L, channel#11978, i_brand_id#1179, null, null, 3), List(sales#11979, number_sales#11980L, channel#11978, null, null, null, 7), List(sales#11979, number_sales#11980L, null, null, null, null, 15)], [sales#11979, number_sales#11980L, channel#12032, i_brand_id#12033, i_class_id#12034, i_category_id#12035, spark_grouping_id#12027]\n            +- Union\n               :- *(45) Project [sales#11979, number_sales#11980L, channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :  +- *(45) Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12013) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12013 as decimal(32,6)) > cast(Subquery subquery11982 as decimal(32,6))))\n               :     :  +- Subquery subquery11982\n               :     :     +- *(8) HashAggregate(keys=[], functions=[avg(CheckOverflow((promote_precision(cast(cast(quantity#11997 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#11998 as decimal(12,2)))), DecimalType(18,2)))], output=[average_sales#12003])\n               :     :        +- Exchange SinglePartition\n               :     :           +- *(7) HashAggregate(keys=[], functions=[partial_avg(CheckOverflow((promote_precision(cast(cast(quantity#11997 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#11998 as decimal(12,2)))), DecimalType(18,2)))], output=[sum#12079, count#12080L])\n               :     :              +- Union\n               :     :                 :- *(2) Project [ss_quantity#1913 AS quantity#11997, ss_list_price#1915 AS list_price#11998]\n               :     :                 :  +- *(2) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :                 :     :- *(2) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_list_price#1915,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [], ReadSchema: struct<ss_quantity:int,ss_list_price:decimal(7,2)>\n               :     :                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :                 :        +- *(1) Project [d_date_sk#1040]\n               :     :                 :           +- *(1) Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :     :                 :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:int,d_year:int>\n               :     :                 :- *(4) Project [cs_quantity#1806 AS quantity#11999, cs_list_price#1808 AS list_price#12000]\n               :     :                 :  +- *(4) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :     :                 :     :- *(4) FileScan parquet db_tpcds.catalog_sales[cs_quantity#1806,cs_list_price#1808,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_quantity:int,cs_list_price:decimal(7,2)>\n               :     :                 :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :                 +- *(6) Project [ws_quantity#1772 AS quantity#12001, ws_list_price#1774 AS list_price#12002]\n               :     :                    +- *(6) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n               :     :                       :- *(6) FileScan parquet db_tpcds.web_sales[ws_quantity#1772,ws_list_price#1774,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [], ReadSchema: struct<ws_quantity:int,ws_list_price:decimal(7,2)>\n               :     :                       +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     +- *(45) HashAggregate(keys=[i_brand_id#1179, i_class_id#1181, i_category_id#1183], functions=[sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))), count(1)], output=[channel#11978, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11979, number_sales#11980L, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12013])\n               :        +- Exchange hashpartitioning(i_brand_id#1179, i_class_id#1181, i_category_id#1183, 200)\n               :           +- *(44) HashAggregate(keys=[i_brand_id#1179, i_class_id#1181, i_category_id#1183], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))), partial_count(1)], output=[i_brand_id#1179, i_class_id#1181, i_category_id#1183, sum#12067, count#12068L])\n               :              +- *(44) Project [ss_quantity#1913, ss_list_price#1915, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                 +- *(44) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :                    :- *(44) Project [ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                    :  +- *(44) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :                    :     :- SortMergeJoin [ss_item_sk#1905], [ss_item_sk#11996], LeftSemi\n               :                    :     :  :- *(2) Sort [ss_item_sk#1905 ASC NULLS FIRST], false, 0\n               :                    :     :  :  +- Exchange hashpartitioning(ss_item_sk#1905, 200)\n               :                    :     :  :     +- *(1) Project [ss_item_sk#1905, ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926]\n               :                    :     :  :        +- *(1) Filter isnotnull(ss_item_sk#1905)\n               :                    :     :  :           +- *(1) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_quantity#1913,ss_list_price#1915,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_quantity:int,ss_list_price:decimal(7,2)>\n               :                    :     :  +- *(21) Sort [ss_item_sk#11996 ASC NULLS FIRST], false, 0\n               :                    :     :     +- Exchange hashpartitioning(ss_item_sk#11996, 200)\n               :                    :     :        +- *(20) Project [i_item_sk#1172 AS ss_item_sk#11996]\n               :                    :     :           +- *(20) BroadcastHashJoin [i_brand_id#1179, i_class_id#1181, i_category_id#1183], [brand_id#11993, class_id#11994, category_id#11995], Inner, BuildLeft\n               :                    :     :              :- BroadcastExchange HashedRelationBroadcastMode(ArrayBuffer(input[1, int, true], input[2, int, true], input[3, int, true]))\n               :                    :     :              :  +- *(3) Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                    :     :              :     +- *(3) Filter ((isnotnull(i_category_id#1183) && isnotnull(i_brand_id#1179)) && isnotnull(i_class_id#1181))\n               :                    :     :              :        +- *(3) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_class_id#1181,i_category_id#1183] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_category_id), IsNotNull(i_brand_id), IsNotNull(i_class_id)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_class_id:int,i_category_id:int>\n               :                    :     :              +- *(20) HashAggregate(keys=[brand_id#11993, class_id#11994, category_id#11995], functions=[], output=[brand_id#11993, class_id#11994, category_id#11995])\n               :                    :     :                 +- Exchange hashpartitioning(brand_id#11993, class_id#11994, category_id#11995, 200)\n               :                    :     :                    +- *(19) HashAggregate(keys=[brand_id#11993, class_id#11994, category_id#11995], functions=[], output=[brand_id#11993, class_id#11994, category_id#11995])\n               :                    :     :                       +- SortMergeJoin [coalesce(brand_id#11993, 0), coalesce(class_id#11994, 0), coalesce(category_id#11995, 0)], [coalesce(i_brand_id#1179, 0), coalesce(i_class_id#1181, 0), coalesce(i_category_id#1183, 0)], LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n               :                    :     :                          :- *(14) Sort [coalesce(brand_id#11993, 0) ASC NULLS FIRST, coalesce(class_id#11994, 0) ASC NULLS FIRST, coalesce(category_id#11995, 0) ASC NULLS FIRST], false, 0\n               :                    :     :                          :  +- Exchange hashpartitioning(coalesce(brand_id#11993, 0), coalesce(class_id#11994, 0), coalesce(category_id#11995, 0), 200)\n               :                    :     :                          :     +- *(13) HashAggregate(keys=[brand_id#11993, class_id#11994, category_id#11995], functions=[], output=[brand_id#11993, class_id#11994, category_id#11995])\n               :                    :     :                          :        +- Exchange hashpartitioning(brand_id#11993, class_id#11994, category_id#11995, 200)\n               :                    :     :                          :           +- *(12) HashAggregate(keys=[brand_id#11993, class_id#11994, category_id#11995], functions=[], output=[brand_id#11993, class_id#11994, category_id#11995])\n               :                    :     :                          :              +- SortMergeJoin [coalesce(brand_id#11993, 0), coalesce(class_id#11994, 0), coalesce(category_id#11995, 0)], [coalesce(i_brand_id#1179, 0), coalesce(i_class_id#1181, 0), coalesce(i_category_id#1183, 0)], LeftSemi, (((brand_id#11993 <=> i_brand_id#1179) && (class_id#11994 <=> i_class_id#1181)) && (category_id#11995 <=> i_category_id#1183))\n               :                    :     :                          :                 :- *(7) Sort [coalesce(brand_id#11993, 0) ASC NULLS FIRST, coalesce(class_id#11994, 0) ASC NULLS FIRST, coalesce(category_id#11995, 0) ASC NULLS FIRST], false, 0\n               :                    :     :                          :                 :  +- Exchange hashpartitioning(coalesce(brand_id#11993, 0), coalesce(class_id#11994, 0), coalesce(category_id#11995, 0), 200)\n               :                    :     :                          :                 :     +- *(6) Project [i_brand_id#1179 AS brand_id#11993, i_class_id#1181 AS class_id#11994, i_category_id#1183 AS category_id#11995]\n               :                    :     :                          :                 :        +- *(6) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :                    :     :                          :                 :           :- *(6) Project [ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                    :     :                          :                 :           :  +- *(6) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :                    :     :                          :                 :           :     :- *(6) Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n               :                    :     :                          :                 :           :     :  +- *(6) Filter isnotnull(ss_item_sk#1905)\n               :                    :     :                          :                 :           :     :     +- *(6) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int>\n               :                    :     :                          :                 :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                    :     :                          :                 :           :        +- *(4) Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                    :     :                          :                 :           :           +- *(4) Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179)) && isnotnull(i_category_id#1183))\n               :                    :     :                          :                 :           :              +- *(4) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_class_id#1181,i_category_id#1183] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_class_id), IsNotNull(i_brand_id), IsNotNull(i_category_id)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_class_id:int,i_category_id:int>\n               :                    :     :                          :                 :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                    :     :                          :                 :              +- *(5) Project [d_date_sk#1040]\n               :                    :     :                          :                 :                 +- *(5) Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :                    :     :                          :                 :                    +- *(5) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:int,d_year:int>\n               :                    :     :                          :                 +- *(11) Sort [coalesce(i_brand_id#1179, 0) ASC NULLS FIRST, coalesce(i_class_id#1181, 0) ASC NULLS FIRST, coalesce(i_category_id#1183, 0) ASC NULLS FIRST], false, 0\n               :                    :     :                          :                    +- Exchange hashpartitioning(coalesce(i_brand_id#1179, 0), coalesce(i_class_id#1181, 0), coalesce(i_category_id#1183, 0), 200)\n               :                    :     :                          :                       +- *(10) Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                    :     :                          :                          +- *(10) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :                    :     :                          :                             :- *(10) Project [cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                    :     :                          :                             :  +- *(10) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n               :                    :     :                          :                             :     :- *(10) Project [cs_item_sk#1803, cs_sold_date_sk#1822]\n               :                    :     :                          :                             :     :  +- *(10) Filter isnotnull(cs_item_sk#1803)\n               :                    :     :                          :                             :     :     +- *(10) FileScan parquet db_tpcds.catalog_sales[cs_item_sk#1803,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:int>\n               :                    :     :                          :                             :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                    :     :                          :                             :        +- *(8) Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                    :     :                          :                             :           +- *(8) Filter isnotnull(i_item_sk#1172)\n               :                    :     :                          :                             :              +- *(8) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_class_id#1181,i_category_id#1183] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_class_id:int,i_category_id:int>\n               :                    :     :                          :                             +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                    :     :                          +- *(18) Sort [coalesce(i_brand_id#1179, 0) ASC NULLS FIRST, coalesce(i_class_id#1181, 0) ASC NULLS FIRST, coalesce(i_category_id#1183, 0) ASC NULLS FIRST], false, 0\n               :                    :     :                             +- Exchange hashpartitioning(coalesce(i_brand_id#1179, 0), coalesce(i_class_id#1181, 0), coalesce(i_category_id#1183, 0), 200)\n               :                    :     :                                +- *(17) Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                    :     :                                   +- *(17) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n               :                    :     :                                      :- *(17) Project [ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                    :     :                                      :  +- *(17) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n               :                    :     :                                      :     :- *(17) Project [ws_item_sk#1757, ws_sold_date_sk#1788]\n               :                    :     :                                      :     :  +- *(17) Filter isnotnull(ws_item_sk#1757)\n               :                    :     :                                      :     :     +- *(17) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int>\n               :                    :     :                                      :     +- ReusedExchange [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                    :     :                                      +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                    :        +- SortMergeJoin [i_item_sk#1172], [ss_item_sk#11996], LeftSemi\n               :                    :           :- *(23) Sort [i_item_sk#1172 ASC NULLS FIRST], false, 0\n               :                    :           :  +- Exchange hashpartitioning(i_item_sk#1172, 200)\n               :                    :           :     +- *(22) Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                    :           :        +- *(22) Filter isnotnull(i_item_sk#1172)\n               :                    :           :           +- *(22) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_class_id#1181,i_category_id#1183] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_class_id:int,i_category_id:int>\n               :                    :           +- *(42) Sort [ss_item_sk#11996 ASC NULLS FIRST], false, 0\n               :                    :              +- ReusedExchange [ss_item_sk#11996], Exchange hashpartitioning(ss_item_sk#11996, 200)\n               :                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                       +- *(43) Project [d_date_sk#1040]\n               :                          +- *(43) Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 11)) && isnotnull(d_date_sk#1040))\n               :                             +- *(43) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               :- *(90) Project [sales#11984, number_sales#11985L, channel#11983, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :  +- *(90) Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)))#12016) && (cast(sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)))#12016 as decimal(32,6)) > cast(Subquery subquery11987 as decimal(32,6))))\n               :     :  +- Subquery subquery11987\n               :     :     +- *(8) HashAggregate(keys=[], functions=[avg(CheckOverflow((promote_precision(cast(cast(quantity#11997 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#11998 as decimal(12,2)))), DecimalType(18,2)))], output=[average_sales#12003])\n               :     :        +- Exchange SinglePartition\n               :     :           +- *(7) HashAggregate(keys=[], functions=[partial_avg(CheckOverflow((promote_precision(cast(cast(quantity#11997 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#11998 as decimal(12,2)))), DecimalType(18,2)))], output=[sum#12079, count#12080L])\n               :     :              +- Union\n               :     :                 :- *(2) Project [ss_quantity#1913 AS quantity#11997, ss_list_price#1915 AS list_price#11998]\n               :     :                 :  +- *(2) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :                 :     :- *(2) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_list_price#1915,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [], ReadSchema: struct<ss_quantity:int,ss_list_price:decimal(7,2)>\n               :     :                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :                 :        +- *(1) Project [d_date_sk#1040]\n               :     :                 :           +- *(1) Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :     :                 :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:int,d_year:int>\n               :     :                 :- *(4) Project [cs_quantity#1806 AS quantity#11999, cs_list_price#1808 AS list_price#12000]\n               :     :                 :  +- *(4) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :     :                 :     :- *(4) FileScan parquet db_tpcds.catalog_sales[cs_quantity#1806,cs_list_price#1808,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_quantity:int,cs_list_price:decimal(7,2)>\n               :     :                 :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :                 +- *(6) Project [ws_quantity#1772 AS quantity#12001, ws_list_price#1774 AS list_price#12002]\n               :     :                    +- *(6) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n               :     :                       :- *(6) FileScan parquet db_tpcds.web_sales[ws_quantity#1772,ws_list_price#1774,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [], ReadSchema: struct<ws_quantity:int,ws_list_price:decimal(7,2)>\n               :     :                       +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     +- *(90) HashAggregate(keys=[i_brand_id#1179, i_class_id#1181, i_category_id#1183], functions=[sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2))), count(1)], output=[channel#11983, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11984, number_sales#11985L, sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)))#12016])\n               :        +- Exchange hashpartitioning(i_brand_id#1179, i_class_id#1181, i_category_id#1183, 200)\n               :           +- *(89) HashAggregate(keys=[i_brand_id#1179, i_class_id#1181, i_category_id#1183], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2))), partial_count(1)], output=[i_brand_id#1179, i_class_id#1181, i_category_id#1183, sum#12071, count#12072L])\n               :              +- *(89) Project [cs_quantity#1806, cs_list_price#1808, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                 +- *(89) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :                    :- *(89) Project [cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :                    :  +- *(89) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n               :                    :     :- SortMergeJoin [cs_item_sk#1803], [ss_item_sk#11996], LeftSemi\n               :                    :     :  :- *(47) Sort [cs_item_sk#1803 ASC NULLS FIRST], false, 0\n               :                    :     :  :  +- Exchange hashpartitioning(cs_item_sk#1803, 200)\n               :                    :     :  :     +- *(46) Project [cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n               :                    :     :  :        +- *(46) Filter isnotnull(cs_item_sk#1803)\n               :                    :     :  :           +- *(46) FileScan parquet db_tpcds.catalog_sales[cs_item_sk#1803,cs_quantity#1806,cs_list_price#1808,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:int,cs_quantity:int,cs_list_price:decimal(7,2)>\n               :                    :     :  +- *(66) Sort [ss_item_sk#11996 ASC NULLS FIRST], false, 0\n               :                    :     :     +- ReusedExchange [ss_item_sk#11996], Exchange hashpartitioning(ss_item_sk#11996, 200)\n               :                    :     +- ReusedExchange [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                    +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               +- *(135) Project [sales#11989, number_sales#11990L, channel#11988, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                  +- *(135) Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)))#12019) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)))#12019 as decimal(32,6)) > cast(Subquery subquery11992 as decimal(32,6))))\n                     :  +- Subquery subquery11992\n                     :     +- *(8) HashAggregate(keys=[], functions=[avg(CheckOverflow((promote_precision(cast(cast(quantity#11997 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#11998 as decimal(12,2)))), DecimalType(18,2)))], output=[average_sales#12003])\n                     :        +- Exchange SinglePartition\n                     :           +- *(7) HashAggregate(keys=[], functions=[partial_avg(CheckOverflow((promote_precision(cast(cast(quantity#11997 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#11998 as decimal(12,2)))), DecimalType(18,2)))], output=[sum#12079, count#12080L])\n                     :              +- Union\n                     :                 :- *(2) Project [ss_quantity#1913 AS quantity#11997, ss_list_price#1915 AS list_price#11998]\n                     :                 :  +- *(2) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                     :                 :     :- *(2) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_list_price#1915,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [], ReadSchema: struct<ss_quantity:int,ss_list_price:decimal(7,2)>\n                     :                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :                 :        +- *(1) Project [d_date_sk#1040]\n                     :                 :           +- *(1) Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                     :                 :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:int,d_year:int>\n                     :                 :- *(4) Project [cs_quantity#1806 AS quantity#11999, cs_list_price#1808 AS list_price#12000]\n                     :                 :  +- *(4) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n                     :                 :     :- *(4) FileScan parquet db_tpcds.catalog_sales[cs_quantity#1806,cs_list_price#1808,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_quantity:int,cs_list_price:decimal(7,2)>\n                     :                 :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :                 +- *(6) Project [ws_quantity#1772 AS quantity#12001, ws_list_price#1774 AS list_price#12002]\n                     :                    +- *(6) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                     :                       :- *(6) FileScan parquet db_tpcds.web_sales[ws_quantity#1772,ws_list_price#1774,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [], ReadSchema: struct<ws_quantity:int,ws_list_price:decimal(7,2)>\n                     :                       +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     +- *(135) HashAggregate(keys=[i_brand_id#1179, i_class_id#1181, i_category_id#1183], functions=[sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2))), count(1)], output=[channel#11988, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#11989, number_sales#11990L, sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)))#12019])\n                        +- Exchange hashpartitioning(i_brand_id#1179, i_class_id#1181, i_category_id#1183, 200)\n                           +- *(134) HashAggregate(keys=[i_brand_id#1179, i_class_id#1181, i_category_id#1183], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2))), partial_count(1)], output=[i_brand_id#1179, i_class_id#1181, i_category_id#1183, sum#12075, count#12076L])\n                              +- *(134) Project [ws_quantity#1772, ws_list_price#1774, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                                 +- *(134) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                                    :- *(134) Project [ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                                    :  +- *(134) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n                                    :     :- SortMergeJoin [ws_item_sk#1757], [ss_item_sk#11996], LeftSemi\n                                    :     :  :- *(92) Sort [ws_item_sk#1757 ASC NULLS FIRST], false, 0\n                                    :     :  :  +- Exchange hashpartitioning(ws_item_sk#1757, 200)\n                                    :     :  :     +- *(91) Project [ws_item_sk#1757, ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n                                    :     :  :        +- *(91) Filter isnotnull(ws_item_sk#1757)\n                                    :     :  :           +- *(91) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_quantity#1772,ws_list_price#1774,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_quantity:int,ws_list_price:decimal(7,2)>\n                                    :     :  +- *(111) Sort [ss_item_sk#11996 ASC NULLS FIRST], false, 0\n                                    :     :     +- ReusedExchange [ss_item_sk#11996], Exchange hashpartitioning(ss_item_sk#11996, 200)\n                                    :     +- ReusedExchange [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                    +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q14b-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin"],"tables":["store_sales","item","date_dim","store_sales","item","date_dim"],"parsingTime":0.002174,"analysisTime":7.68E-4,"optimizationTime":3435.964008,"planningTime":408.637609,"executionTime":26447.094525,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [cross_items, avg_sales]\n:  :- 'SubqueryAlias cross_items\n:  :  +- 'Project ['i_item_sk AS ss_item_sk#12289]\n:  :     +- 'Filter ((('i_brand_id = 'brand_id) && ('i_class_id = 'class_id)) && ('i_category_id = 'category_id))\n:  :        +- 'Join Inner\n:  :           :- 'UnresolvedRelation `item`\n:  :           +- 'SubqueryAlias x\n:  :              +- 'Intersect\n:  :                 :- 'Intersect\n:  :                 :  :- 'Project ['iss.i_brand_id AS brand_id#12286, 'iss.i_class_id AS class_id#12287, 'iss.i_category_id AS category_id#12288]\n:  :                 :  :  +- 'Filter ((('ss_item_sk = 'iss.i_item_sk) && ('ss_sold_date_sk = 'd1.d_date_sk)) && (('d1.d_year >= 1999) && ('d1.d_year <= (1999 + 2))))\n:  :                 :  :     +- 'Join Inner\n:  :                 :  :        :- 'Join Inner\n:  :                 :  :        :  :- 'UnresolvedRelation `store_sales`\n:  :                 :  :        :  +- 'SubqueryAlias iss\n:  :                 :  :        :     +- 'UnresolvedRelation `item`\n:  :                 :  :        +- 'SubqueryAlias d1\n:  :                 :  :           +- 'UnresolvedRelation `date_dim`\n:  :                 :  +- 'Project ['ics.i_brand_id, 'ics.i_class_id, 'ics.i_category_id]\n:  :                 :     +- 'Filter ((('cs_item_sk = 'ics.i_item_sk) && ('cs_sold_date_sk = 'd2.d_date_sk)) && (('d2.d_year >= 1999) && ('d2.d_year <= (1999 + 2))))\n:  :                 :        +- 'Join Inner\n:  :                 :           :- 'Join Inner\n:  :                 :           :  :- 'UnresolvedRelation `catalog_sales`\n:  :                 :           :  +- 'SubqueryAlias ics\n:  :                 :           :     +- 'UnresolvedRelation `item`\n:  :                 :           +- 'SubqueryAlias d2\n:  :                 :              +- 'UnresolvedRelation `date_dim`\n:  :                 +- 'Project ['iws.i_brand_id, 'iws.i_class_id, 'iws.i_category_id]\n:  :                    +- 'Filter ((('ws_item_sk = 'iws.i_item_sk) && ('ws_sold_date_sk = 'd3.d_date_sk)) && (('d3.d_year >= 1999) && ('d3.d_year <= (1999 + 2))))\n:  :                       +- 'Join Inner\n:  :                          :- 'Join Inner\n:  :                          :  :- 'UnresolvedRelation `web_sales`\n:  :                          :  +- 'SubqueryAlias iws\n:  :                          :     +- 'UnresolvedRelation `item`\n:  :                          +- 'SubqueryAlias d3\n:  :                             +- 'UnresolvedRelation `date_dim`\n:  +- 'SubqueryAlias avg_sales\n:     +- 'Project ['avg(('quantity * 'list_price)) AS average_sales#12296]\n:        +- 'SubqueryAlias x\n:           +- 'Union\n:              :- 'Union\n:              :  :- 'Project ['ss_quantity AS quantity#12290, 'ss_list_price AS list_price#12291]\n:              :  :  +- 'Filter (('ss_sold_date_sk = 'd_date_sk) && (('d_year >= 1999) && ('d_year <= (1999 + 2))))\n:              :  :     +- 'Join Inner\n:              :  :        :- 'UnresolvedRelation `store_sales`\n:              :  :        +- 'UnresolvedRelation `date_dim`\n:              :  +- 'Project ['cs_quantity AS quantity#12292, 'cs_list_price AS list_price#12293]\n:              :     +- 'Filter (('cs_sold_date_sk = 'd_date_sk) && (('d_year >= 1999) && ('d_year <= (1999 + 2))))\n:              :        +- 'Join Inner\n:              :           :- 'UnresolvedRelation `catalog_sales`\n:              :           +- 'UnresolvedRelation `date_dim`\n:              +- 'Project ['ws_quantity AS quantity#12294, 'ws_list_price AS list_price#12295]\n:                 +- 'Filter (('ws_sold_date_sk = 'd_date_sk) && (('d_year >= 1999) && ('d_year <= (1999 + 2))))\n:                    +- 'Join Inner\n:                       :- 'UnresolvedRelation `web_sales`\n:                       +- 'UnresolvedRelation `date_dim`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['this_year.channel ASC NULLS FIRST, 'this_year.i_brand_id ASC NULLS FIRST, 'this_year.i_class_id ASC NULLS FIRST, 'this_year.i_category_id ASC NULLS FIRST], true\n         +- 'Project [*]\n            +- 'Filter ((('this_year.i_brand_id = 'last_year.i_brand_id) && ('this_year.i_class_id = 'last_year.i_class_id)) && ('this_year.i_category_id = 'last_year.i_category_id))\n               +- 'Join Inner\n                  :- 'SubqueryAlias this_year\n                  :  +- 'Filter ('sum(('ss_quantity * 'ss_list_price)) > scalar-subquery#12279 [])\n                  :     :  +- 'Project ['average_sales]\n                  :     :     +- 'UnresolvedRelation `avg_sales`\n                  :     +- 'Aggregate ['i_brand_id, 'i_class_id, 'i_category_id], [store AS channel#12274, 'i_brand_id, 'i_class_id, 'i_category_id, 'sum(('ss_quantity * 'ss_list_price)) AS sales#12275, 'count(1) AS number_sales#12276]\n                  :        +- 'Filter (('ss_item_sk IN (list#12277 []) && ('ss_item_sk = 'i_item_sk)) && (('ss_sold_date_sk = 'd_date_sk) && ('d_week_seq = scalar-subquery#12278 [])))\n                  :           :  :- 'Project ['ss_item_sk]\n                  :           :  :  +- 'UnresolvedRelation `cross_items`\n                  :           :  +- 'Project ['d_week_seq]\n                  :           :     +- 'Filter ((('d_year = (1999 + 1)) && ('d_moy = 12)) && ('d_dom = 11))\n                  :           :        +- 'UnresolvedRelation `date_dim`\n                  :           +- 'Join Inner\n                  :              :- 'Join Inner\n                  :              :  :- 'UnresolvedRelation `store_sales`\n                  :              :  +- 'UnresolvedRelation `item`\n                  :              +- 'UnresolvedRelation `date_dim`\n                  +- 'SubqueryAlias last_year\n                     +- 'Filter ('sum(('ss_quantity * 'ss_list_price)) > scalar-subquery#12285 [])\n                        :  +- 'Project ['average_sales]\n                        :     +- 'UnresolvedRelation `avg_sales`\n                        +- 'Aggregate ['i_brand_id, 'i_class_id, 'i_category_id], [store AS channel#12280, 'i_brand_id, 'i_class_id, 'i_category_id, 'sum(('ss_quantity * 'ss_list_price)) AS sales#12281, 'count(1) AS number_sales#12282]\n                           +- 'Filter (('ss_item_sk IN (list#12283 []) && ('ss_item_sk = 'i_item_sk)) && (('ss_sold_date_sk = 'd_date_sk) && ('d_week_seq = scalar-subquery#12284 [])))\n                              :  :- 'Project ['ss_item_sk]\n                              :  :  +- 'UnresolvedRelation `cross_items`\n                              :  +- 'Project ['d_week_seq]\n                              :     +- 'Filter ((('d_year = 1999) && ('d_moy = 12)) && ('d_dom = 11))\n                              :        +- 'UnresolvedRelation `date_dim`\n                              +- 'Join Inner\n                                 :- 'Join Inner\n                                 :  :- 'UnresolvedRelation `store_sales`\n                                 :  +- 'UnresolvedRelation `item`\n                                 +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nchannel: string, i_brand_id: int, i_class_id: int, i_category_id: int, sales: decimal(28,2), number_sales: bigint, channel: string, i_brand_id: int, i_class_id: int, i_category_id: int, sales: decimal(28,2), number_sales: bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#12274 ASC NULLS FIRST, i_brand_id#1179 ASC NULLS FIRST, i_class_id#1181 ASC NULLS FIRST, i_category_id#1183 ASC NULLS FIRST], true\n      +- Project [channel#12274, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#12275, number_sales#12276L, channel#12280, i_brand_id#12315, i_class_id#12317, i_category_id#12319, sales#12281, number_sales#12282L]\n         +- Filter (((i_brand_id#1179 = i_brand_id#12315) && (i_class_id#1181 = i_class_id#12317)) && (i_category_id#1183 = i_category_id#12319))\n            +- Join Inner\n               :- SubqueryAlias this_year\n               :  +- Project [channel#12274, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#12275, number_sales#12276L]\n               :     +- Filter (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12304 as decimal(32,6)) > cast(scalar-subquery#12279 [] as decimal(32,6)))\n               :        :  +- Project [average_sales#12296]\n               :        :     +- SubqueryAlias avg_sales\n               :        :        +- Aggregate [avg(CheckOverflow((promote_precision(cast(cast(quantity#12290 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#12291 as decimal(12,2)))), DecimalType(18,2))) AS average_sales#12296]\n               :        :           +- SubqueryAlias x\n               :        :              +- Union\n               :        :                 :- Union\n               :        :                 :  :- Project [ss_quantity#1913 AS quantity#12290, ss_list_price#1915 AS list_price#12291]\n               :        :                 :  :  +- Filter ((ss_sold_date_sk#1926 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n               :        :                 :  :     +- Join Inner\n               :        :                 :  :        :- SubqueryAlias store_sales\n               :        :                 :  :        :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :        :                 :  :        +- SubqueryAlias date_dim\n               :        :                 :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :        :                 :  +- Project [cs_quantity#1806 AS quantity#12292, cs_list_price#1808 AS list_price#12293]\n               :        :                 :     +- Filter ((cs_sold_date_sk#1822 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n               :        :                 :        +- Join Inner\n               :        :                 :           :- SubqueryAlias catalog_sales\n               :        :                 :           :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :        :                 :           +- SubqueryAlias date_dim\n               :        :                 :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :        :                 +- Project [ws_quantity#1772 AS quantity#12294, ws_list_price#1774 AS list_price#12295]\n               :        :                    +- Filter ((ws_sold_date_sk#1788 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n               :        :                       +- Join Inner\n               :        :                          :- SubqueryAlias web_sales\n               :        :                          :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :        :                          +- SubqueryAlias date_dim\n               :        :                             +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :        +- Aggregate [i_brand_id#1179, i_class_id#1181, i_category_id#1183], [store AS channel#12274, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))) AS sales#12275, count(1) AS number_sales#12276L, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12304]\n               :           +- Filter ((ss_item_sk#1905 IN (list#12277 []) && (ss_item_sk#1905 = i_item_sk#1172)) && ((ss_sold_date_sk#1926 = d_date_sk#1040) && (d_week_seq#1044 = scalar-subquery#12278 [])))\n               :              :  :- Project [ss_item_sk#12289]\n               :              :  :  +- SubqueryAlias cross_items\n               :              :  :     +- Project [i_item_sk#1172 AS ss_item_sk#12289]\n               :              :  :        +- Filter (((i_brand_id#1179 = brand_id#12286) && (i_class_id#1181 = class_id#12287)) && (i_category_id#1183 = category_id#12288))\n               :              :  :           +- Join Inner\n               :              :  :              :- SubqueryAlias item\n               :              :  :              :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :  :              +- SubqueryAlias x\n               :              :  :                 +- Intersect\n               :              :  :                    :- Intersect\n               :              :  :                    :  :- Project [i_brand_id#1179 AS brand_id#12286, i_class_id#1181 AS class_id#12287, i_category_id#1183 AS category_id#12288]\n               :              :  :                    :  :  +- Filter (((ss_item_sk#1905 = i_item_sk#1172) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n               :              :  :                    :  :     +- Join Inner\n               :              :  :                    :  :        :- Join Inner\n               :              :  :                    :  :        :  :- SubqueryAlias store_sales\n               :              :  :                    :  :        :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :              :  :                    :  :        :  +- SubqueryAlias iss\n               :              :  :                    :  :        :     +- SubqueryAlias item\n               :              :  :                    :  :        :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :  :                    :  :        +- SubqueryAlias d1\n               :              :  :                    :  :           +- SubqueryAlias date_dim\n               :              :  :                    :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :  :                    :  +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :  :                    :     +- Filter (((cs_item_sk#1803 = i_item_sk#1172) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n               :              :  :                    :        +- Join Inner\n               :              :  :                    :           :- Join Inner\n               :              :  :                    :           :  :- SubqueryAlias catalog_sales\n               :              :  :                    :           :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :              :  :                    :           :  +- SubqueryAlias ics\n               :              :  :                    :           :     +- SubqueryAlias item\n               :              :  :                    :           :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :  :                    :           +- SubqueryAlias d2\n               :              :  :                    :              +- SubqueryAlias date_dim\n               :              :  :                    :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :  :                    +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n               :              :  :                       +- Filter (((ws_item_sk#1757 = i_item_sk#1172) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n               :              :  :                          +- Join Inner\n               :              :  :                             :- Join Inner\n               :              :  :                             :  :- SubqueryAlias web_sales\n               :              :  :                             :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :              :  :                             :  +- SubqueryAlias iws\n               :              :  :                             :     +- SubqueryAlias item\n               :              :  :                             :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              :  :                             +- SubqueryAlias d3\n               :              :  :                                +- SubqueryAlias date_dim\n               :              :  :                                   +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              :  +- Project [d_week_seq#1044]\n               :              :     +- Filter (((d_year#1046 = (1999 + 1)) && (d_moy#1048 = 12)) && (d_dom#1049 = 11))\n               :              :        +- SubqueryAlias date_dim\n               :              :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              +- Join Inner\n               :                 :- Join Inner\n               :                 :  :- SubqueryAlias store_sales\n               :                 :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :                 :  +- SubqueryAlias item\n               :                 :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :                 +- SubqueryAlias date_dim\n               :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- SubqueryAlias last_year\n                  +- Project [channel#12280, i_brand_id#12315, i_class_id#12317, i_category_id#12319, sales#12281, number_sales#12282L]\n                     +- Filter (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12307 as decimal(32,6)) > cast(scalar-subquery#12285 [] as decimal(32,6)))\n                        :  +- Project [average_sales#12296]\n                        :     +- SubqueryAlias avg_sales\n                        :        +- Aggregate [avg(CheckOverflow((promote_precision(cast(cast(quantity#12290 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#12291 as decimal(12,2)))), DecimalType(18,2))) AS average_sales#12296]\n                        :           +- SubqueryAlias x\n                        :              +- Union\n                        :                 :- Union\n                        :                 :  :- Project [ss_quantity#1913 AS quantity#12290, ss_list_price#1915 AS list_price#12291]\n                        :                 :  :  +- Filter ((ss_sold_date_sk#1926 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                        :                 :  :     +- Join Inner\n                        :                 :  :        :- SubqueryAlias store_sales\n                        :                 :  :        :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :                 :  :        +- SubqueryAlias date_dim\n                        :                 :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :                 :  +- Project [cs_quantity#1806 AS quantity#12292, cs_list_price#1808 AS list_price#12293]\n                        :                 :     +- Filter ((cs_sold_date_sk#1822 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                        :                 :        +- Join Inner\n                        :                 :           :- SubqueryAlias catalog_sales\n                        :                 :           :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                        :                 :           +- SubqueryAlias date_dim\n                        :                 :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :                 +- Project [ws_quantity#1772 AS quantity#12294, ws_list_price#1774 AS list_price#12295]\n                        :                    +- Filter ((ws_sold_date_sk#1788 = d_date_sk#1040) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                        :                       +- Join Inner\n                        :                          :- SubqueryAlias web_sales\n                        :                          :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        :                          +- SubqueryAlias date_dim\n                        :                             +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Aggregate [i_brand_id#12315, i_class_id#12317, i_category_id#12319], [store AS channel#12280, i_brand_id#12315, i_class_id#12317, i_category_id#12319, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))) AS sales#12281, count(1) AS number_sales#12282L, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12307]\n                           +- Filter ((ss_item_sk#1905 IN (list#12283 []) && (ss_item_sk#1905 = i_item_sk#12308)) && ((ss_sold_date_sk#1926 = d_date_sk#1040) && (d_week_seq#1044 = scalar-subquery#12284 [])))\n                              :  :- Project [ss_item_sk#12289]\n                              :  :  +- SubqueryAlias cross_items\n                              :  :     +- Project [i_item_sk#1172 AS ss_item_sk#12289]\n                              :  :        +- Filter (((i_brand_id#1179 = brand_id#12286) && (i_class_id#1181 = class_id#12287)) && (i_category_id#1183 = category_id#12288))\n                              :  :           +- Join Inner\n                              :  :              :- SubqueryAlias item\n                              :  :              :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :  :              +- SubqueryAlias x\n                              :  :                 +- Intersect\n                              :  :                    :- Intersect\n                              :  :                    :  :- Project [i_brand_id#1179 AS brand_id#12286, i_class_id#1181 AS class_id#12287, i_category_id#1183 AS category_id#12288]\n                              :  :                    :  :  +- Filter (((ss_item_sk#1905 = i_item_sk#1172) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                              :  :                    :  :     +- Join Inner\n                              :  :                    :  :        :- Join Inner\n                              :  :                    :  :        :  :- SubqueryAlias store_sales\n                              :  :                    :  :        :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                              :  :                    :  :        :  +- SubqueryAlias iss\n                              :  :                    :  :        :     +- SubqueryAlias item\n                              :  :                    :  :        :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :  :                    :  :        +- SubqueryAlias d1\n                              :  :                    :  :           +- SubqueryAlias date_dim\n                              :  :                    :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :  :                    :  +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :  :                    :     +- Filter (((cs_item_sk#1803 = i_item_sk#1172) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                              :  :                    :        +- Join Inner\n                              :  :                    :           :- Join Inner\n                              :  :                    :           :  :- SubqueryAlias catalog_sales\n                              :  :                    :           :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                              :  :                    :           :  +- SubqueryAlias ics\n                              :  :                    :           :     +- SubqueryAlias item\n                              :  :                    :           :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :  :                    :           +- SubqueryAlias d2\n                              :  :                    :              +- SubqueryAlias date_dim\n                              :  :                    :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :  :                    +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                              :  :                       +- Filter (((ws_item_sk#1757 = i_item_sk#1172) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && ((d_year#1046 >= 1999) && (d_year#1046 <= (1999 + 2))))\n                              :  :                          +- Join Inner\n                              :  :                             :- Join Inner\n                              :  :                             :  :- SubqueryAlias web_sales\n                              :  :                             :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                              :  :                             :  +- SubqueryAlias iws\n                              :  :                             :     +- SubqueryAlias item\n                              :  :                             :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              :  :                             +- SubqueryAlias d3\n                              :  :                                +- SubqueryAlias date_dim\n                              :  :                                   +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :  +- Project [d_week_seq#1044]\n                              :     +- Filter (((d_year#1046 = 1999) && (d_moy#1048 = 12)) && (d_dom#1049 = 11))\n                              :        +- SubqueryAlias date_dim\n                              :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              +- Join Inner\n                                 :- Join Inner\n                                 :  :- SubqueryAlias store_sales\n                                 :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                 :  +- SubqueryAlias item\n                                 :     +- Relation[i_item_sk#12308,i_item_id#12309,i_rec_start_date#12310,i_rec_end_date#12311,i_item_desc#12312,i_current_price#12313,i_wholesale_cost#12314,i_brand_id#12315,i_brand#12316,i_class_id#12317,i_class#12318,i_category_id#12319,i_category#12320,i_manufact_id#12321,i_manufact#12322,i_size#12323,i_formulation#12324,i_color#12325,i_units#12326,i_container#12327,i_manager_id#12328,i_product_name#12329] parquet\n                                 +- SubqueryAlias date_dim\n                                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#12274 ASC NULLS FIRST, i_brand_id#1179 ASC NULLS FIRST, i_class_id#1181 ASC NULLS FIRST, i_category_id#1183 ASC NULLS FIRST], true\n      +- Join Inner, (((i_brand_id#1179 = i_brand_id#12315) && (i_class_id#1181 = i_class_id#12317)) && (i_category_id#1183 = i_category_id#12319))\n         :- Project [channel#12274, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#12275, number_sales#12276L]\n         :  +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12304) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12304 as decimal(32,6)) > cast(scalar-subquery#12279 [] as decimal(32,6))))\n         :     :  +- Aggregate [avg(CheckOverflow((promote_precision(cast(cast(quantity#12290 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#12291 as decimal(12,2)))), DecimalType(18,2))) AS average_sales#12296]\n         :     :     +- Union\n         :     :        :- Project [ss_quantity#1913 AS quantity#12290, ss_list_price#1915 AS list_price#12291]\n         :     :        :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n         :     :        :     :- Project [ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926]\n         :     :        :     :  +- Filter isnotnull(ss_sold_date_sk#1926)\n         :     :        :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :     :        :     +- Project [d_date_sk#1040]\n         :     :        :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n         :     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :     :        :- Project [cs_quantity#1806 AS quantity#12292, cs_list_price#1808 AS list_price#12293]\n         :     :        :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n         :     :        :     :- Project [cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n         :     :        :     :  +- Filter isnotnull(cs_sold_date_sk#1822)\n         :     :        :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n         :     :        :     +- Project [d_date_sk#1040]\n         :     :        :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n         :     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :     :        +- Project [ws_quantity#1772 AS quantity#12294, ws_list_price#1774 AS list_price#12295]\n         :     :           +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n         :     :              :- Project [ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n         :     :              :  +- Filter isnotnull(ws_sold_date_sk#1788)\n         :     :              :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n         :     :              +- Project [d_date_sk#1040]\n         :     :                 +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n         :     :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :     +- Aggregate [i_brand_id#1179, i_class_id#1181, i_category_id#1183], [store AS channel#12274, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))) AS sales#12275, count(1) AS number_sales#12276L, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12304]\n         :        +- Project [ss_quantity#1913, ss_list_price#1915, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :           +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n         :              :- Project [ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n         :              :     :- Join LeftSemi, (ss_item_sk#1905 = ss_item_sk#12289)\n         :              :     :  :- Project [ss_item_sk#1905, ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926]\n         :              :     :  :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n         :              :     :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :              :     :  +- Project [i_item_sk#1172 AS ss_item_sk#12289]\n         :              :     :     +- Join Inner, (((i_brand_id#1179 = brand_id#12286) && (i_class_id#1181 = class_id#12287)) && (i_category_id#1183 = category_id#12288))\n         :              :     :        :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :     :        :  +- Filter ((isnotnull(i_category_id#1183) && isnotnull(i_brand_id#1179)) && isnotnull(i_class_id#1181))\n         :              :     :        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :              :     :        +- Aggregate [brand_id#12286, class_id#12287, category_id#12288], [brand_id#12286, class_id#12287, category_id#12288]\n         :              :     :           +- Join LeftSemi, (((brand_id#12286 <=> i_brand_id#1179) && (class_id#12287 <=> i_class_id#1181)) && (category_id#12288 <=> i_category_id#1183))\n         :              :     :              :- Aggregate [brand_id#12286, class_id#12287, category_id#12288], [brand_id#12286, class_id#12287, category_id#12288]\n         :              :     :              :  +- Join LeftSemi, (((brand_id#12286 <=> i_brand_id#1179) && (class_id#12287 <=> i_class_id#1181)) && (category_id#12288 <=> i_category_id#1183))\n         :              :     :              :     :- Project [i_brand_id#1179 AS brand_id#12286, i_class_id#1181 AS class_id#12287, i_category_id#1183 AS category_id#12288]\n         :              :     :              :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n         :              :     :              :     :     :- Project [ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :     :              :     :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n         :              :     :              :     :     :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n         :              :     :              :     :     :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n         :              :     :              :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :              :     :              :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :     :              :     :     :        +- Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_class_id#1181)) && isnotnull(i_category_id#1183)) && isnotnull(i_brand_id#1179))\n         :              :     :              :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :              :     :              :     :     +- Project [d_date_sk#1040]\n         :              :     :              :     :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n         :              :     :              :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :              :     :              :     +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :     :              :        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n         :              :     :              :           :- Project [cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :     :              :           :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n         :              :     :              :           :     :- Project [cs_item_sk#1803, cs_sold_date_sk#1822]\n         :              :     :              :           :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n         :              :     :              :           :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n         :              :     :              :           :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :     :              :           :        +- Filter isnotnull(i_item_sk#1172)\n         :              :     :              :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :              :     :              :           +- Project [d_date_sk#1040]\n         :              :     :              :              +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n         :              :     :              :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :              :     :              +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :     :                 +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n         :              :     :                    :- Project [ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :     :                    :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n         :              :     :                    :     :- Project [ws_item_sk#1757, ws_sold_date_sk#1788]\n         :              :     :                    :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n         :              :     :                    :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n         :              :     :                    :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :     :                    :        +- Filter isnotnull(i_item_sk#1172)\n         :              :     :                    :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :              :     :                    +- Project [d_date_sk#1040]\n         :              :     :                       +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n         :              :     :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :              :     +- Join LeftSemi, (i_item_sk#1172 = ss_item_sk#12289)\n         :              :        :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :        :  +- Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_category_id#1183)) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179))\n         :              :        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :              :        +- Project [i_item_sk#1172 AS ss_item_sk#12289]\n         :              :           +- Join Inner, (((i_brand_id#1179 = brand_id#12286) && (i_class_id#1181 = class_id#12287)) && (i_category_id#1183 = category_id#12288))\n         :              :              :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :              :  +- Filter ((isnotnull(i_category_id#1183) && isnotnull(i_brand_id#1179)) && isnotnull(i_class_id#1181))\n         :              :              :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :              :              +- Aggregate [brand_id#12286, class_id#12287, category_id#12288], [brand_id#12286, class_id#12287, category_id#12288]\n         :              :                 +- Join LeftSemi, (((brand_id#12286 <=> i_brand_id#1179) && (class_id#12287 <=> i_class_id#1181)) && (category_id#12288 <=> i_category_id#1183))\n         :              :                    :- Aggregate [brand_id#12286, class_id#12287, category_id#12288], [brand_id#12286, class_id#12287, category_id#12288]\n         :              :                    :  +- Join LeftSemi, (((brand_id#12286 <=> i_brand_id#1179) && (class_id#12287 <=> i_class_id#1181)) && (category_id#12288 <=> i_category_id#1183))\n         :              :                    :     :- Project [i_brand_id#1179 AS brand_id#12286, i_class_id#1181 AS class_id#12287, i_category_id#1183 AS category_id#12288]\n         :              :                    :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n         :              :                    :     :     :- Project [ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :                    :     :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n         :              :                    :     :     :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n         :              :                    :     :     :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n         :              :                    :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :              :                    :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :                    :     :     :        +- Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_class_id#1181)) && isnotnull(i_category_id#1183)) && isnotnull(i_brand_id#1179))\n         :              :                    :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :              :                    :     :     +- Project [d_date_sk#1040]\n         :              :                    :     :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n         :              :                    :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :              :                    :     +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :                    :        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n         :              :                    :           :- Project [cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :                    :           :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n         :              :                    :           :     :- Project [cs_item_sk#1803, cs_sold_date_sk#1822]\n         :              :                    :           :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n         :              :                    :           :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n         :              :                    :           :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :                    :           :        +- Filter isnotnull(i_item_sk#1172)\n         :              :                    :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :              :                    :           +- Project [d_date_sk#1040]\n         :              :                    :              +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n         :              :                    :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :              :                    +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :                       +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n         :              :                          :- Project [ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :                          :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n         :              :                          :     :- Project [ws_item_sk#1757, ws_sold_date_sk#1788]\n         :              :                          :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n         :              :                          :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n         :              :                          :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n         :              :                          :        +- Filter isnotnull(i_item_sk#1172)\n         :              :                          :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :              :                          +- Project [d_date_sk#1040]\n         :              :                             +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n         :              :                                +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :              +- Project [d_date_sk#1040]\n         :                 +- Filter ((isnotnull(d_week_seq#1044) && (d_week_seq#1044 = scalar-subquery#12278 [])) && isnotnull(d_date_sk#1040))\n         :                    :  +- Project [d_week_seq#1044]\n         :                    :     +- Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && isnotnull(d_dom#1049)) && (d_year#1046 = 2000)) && (d_moy#1048 = 12)) && (d_dom#1049 = 11))\n         :                    :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         +- Project [channel#12280, i_brand_id#12315, i_class_id#12317, i_category_id#12319, sales#12281, number_sales#12282L]\n            +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12307) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12307 as decimal(32,6)) > cast(scalar-subquery#12285 [] as decimal(32,6))))\n               :  +- Aggregate [avg(CheckOverflow((promote_precision(cast(cast(quantity#12290 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#12291 as decimal(12,2)))), DecimalType(18,2))) AS average_sales#12296]\n               :     +- Union\n               :        :- Project [ss_quantity#1913 AS quantity#12290, ss_list_price#1915 AS list_price#12291]\n               :        :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :        :     :- Project [ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926]\n               :        :     :  +- Filter isnotnull(ss_sold_date_sk#1926)\n               :        :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :        :     +- Project [d_date_sk#1040]\n               :        :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :        :- Project [cs_quantity#1806 AS quantity#12292, cs_list_price#1808 AS list_price#12293]\n               :        :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :        :     :- Project [cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n               :        :     :  +- Filter isnotnull(cs_sold_date_sk#1822)\n               :        :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :        :     +- Project [d_date_sk#1040]\n               :        :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :        +- Project [ws_quantity#1772 AS quantity#12294, ws_list_price#1774 AS list_price#12295]\n               :           +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n               :              :- Project [ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n               :              :  +- Filter isnotnull(ws_sold_date_sk#1788)\n               :              :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :              +- Project [d_date_sk#1040]\n               :                 +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n               :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- Aggregate [i_brand_id#12315, i_class_id#12317, i_category_id#12319], [store AS channel#12280, i_brand_id#12315, i_class_id#12317, i_category_id#12319, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))) AS sales#12281, count(1) AS number_sales#12282L, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12307]\n                  +- Project [ss_quantity#1913, ss_list_price#1915, i_brand_id#12315, i_class_id#12317, i_category_id#12319]\n                     +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                        :- Project [ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926, i_brand_id#12315, i_class_id#12317, i_category_id#12319]\n                        :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#12308)\n                        :     :- Join LeftSemi, (ss_item_sk#1905 = ss_item_sk#12289)\n                        :     :  :- Project [ss_item_sk#1905, ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926]\n                        :     :  :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n                        :     :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :     :  +- Project [i_item_sk#1172 AS ss_item_sk#12289]\n                        :     :     +- Join Inner, (((i_brand_id#1179 = brand_id#12286) && (i_class_id#1181 = class_id#12287)) && (i_category_id#1183 = category_id#12288))\n                        :     :        :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :     :        :  +- Filter ((isnotnull(i_category_id#1183) && isnotnull(i_brand_id#1179)) && isnotnull(i_class_id#1181))\n                        :     :        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :     :        +- Aggregate [brand_id#12286, class_id#12287, category_id#12288], [brand_id#12286, class_id#12287, category_id#12288]\n                        :     :           +- Join LeftSemi, (((brand_id#12286 <=> i_brand_id#1179) && (class_id#12287 <=> i_class_id#1181)) && (category_id#12288 <=> i_category_id#1183))\n                        :     :              :- Aggregate [brand_id#12286, class_id#12287, category_id#12288], [brand_id#12286, class_id#12287, category_id#12288]\n                        :     :              :  +- Join LeftSemi, (((brand_id#12286 <=> i_brand_id#1179) && (class_id#12287 <=> i_class_id#1181)) && (category_id#12288 <=> i_category_id#1183))\n                        :     :              :     :- Project [i_brand_id#1179 AS brand_id#12286, i_class_id#1181 AS class_id#12287, i_category_id#1183 AS category_id#12288]\n                        :     :              :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                        :     :              :     :     :- Project [ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :     :              :     :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                        :     :              :     :     :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n                        :     :              :     :     :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n                        :     :              :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :     :              :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :     :              :     :     :        +- Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_class_id#1181)) && isnotnull(i_category_id#1183)) && isnotnull(i_brand_id#1179))\n                        :     :              :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :     :              :     :     +- Project [d_date_sk#1040]\n                        :     :              :     :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                        :     :              :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :     :              :     +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :     :              :        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n                        :     :              :           :- Project [cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :     :              :           :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n                        :     :              :           :     :- Project [cs_item_sk#1803, cs_sold_date_sk#1822]\n                        :     :              :           :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n                        :     :              :           :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                        :     :              :           :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :     :              :           :        +- Filter isnotnull(i_item_sk#1172)\n                        :     :              :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :     :              :           +- Project [d_date_sk#1040]\n                        :     :              :              +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                        :     :              :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :     :              +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :     :                 +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                        :     :                    :- Project [ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :     :                    :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n                        :     :                    :     :- Project [ws_item_sk#1757, ws_sold_date_sk#1788]\n                        :     :                    :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n                        :     :                    :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        :     :                    :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :     :                    :        +- Filter isnotnull(i_item_sk#1172)\n                        :     :                    :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :     :                    +- Project [d_date_sk#1040]\n                        :     :                       +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                        :     :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :     +- Join LeftSemi, (i_item_sk#12308 = ss_item_sk#12289)\n                        :        :- Project [i_item_sk#12308, i_brand_id#12315, i_class_id#12317, i_category_id#12319]\n                        :        :  +- Filter (((isnotnull(i_item_sk#12308) && isnotnull(i_brand_id#12315)) && isnotnull(i_class_id#12317)) && isnotnull(i_category_id#12319))\n                        :        :     +- Relation[i_item_sk#12308,i_item_id#12309,i_rec_start_date#12310,i_rec_end_date#12311,i_item_desc#12312,i_current_price#12313,i_wholesale_cost#12314,i_brand_id#12315,i_brand#12316,i_class_id#12317,i_class#12318,i_category_id#12319,i_category#12320,i_manufact_id#12321,i_manufact#12322,i_size#12323,i_formulation#12324,i_color#12325,i_units#12326,i_container#12327,i_manager_id#12328,i_product_name#12329] parquet\n                        :        +- Project [i_item_sk#1172 AS ss_item_sk#12289]\n                        :           +- Join Inner, (((i_brand_id#1179 = brand_id#12286) && (i_class_id#1181 = class_id#12287)) && (i_category_id#1183 = category_id#12288))\n                        :              :- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :              :  +- Filter ((isnotnull(i_category_id#1183) && isnotnull(i_brand_id#1179)) && isnotnull(i_class_id#1181))\n                        :              :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :              +- Aggregate [brand_id#12286, class_id#12287, category_id#12288], [brand_id#12286, class_id#12287, category_id#12288]\n                        :                 +- Join LeftSemi, (((brand_id#12286 <=> i_brand_id#1179) && (class_id#12287 <=> i_class_id#1181)) && (category_id#12288 <=> i_category_id#1183))\n                        :                    :- Aggregate [brand_id#12286, class_id#12287, category_id#12288], [brand_id#12286, class_id#12287, category_id#12288]\n                        :                    :  +- Join LeftSemi, (((brand_id#12286 <=> i_brand_id#1179) && (class_id#12287 <=> i_class_id#1181)) && (category_id#12288 <=> i_category_id#1183))\n                        :                    :     :- Project [i_brand_id#1179 AS brand_id#12286, i_class_id#1181 AS class_id#12287, i_category_id#1183 AS category_id#12288]\n                        :                    :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                        :                    :     :     :- Project [ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :                    :     :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                        :                    :     :     :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n                        :                    :     :     :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n                        :                    :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :                    :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :                    :     :     :        +- Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_class_id#1181)) && isnotnull(i_category_id#1183)) && isnotnull(i_brand_id#1179))\n                        :                    :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :                    :     :     +- Project [d_date_sk#1040]\n                        :                    :     :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                        :                    :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :                    :     +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :                    :        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n                        :                    :           :- Project [cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :                    :           :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n                        :                    :           :     :- Project [cs_item_sk#1803, cs_sold_date_sk#1822]\n                        :                    :           :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n                        :                    :           :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                        :                    :           :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :                    :           :        +- Filter isnotnull(i_item_sk#1172)\n                        :                    :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :                    :           +- Project [d_date_sk#1040]\n                        :                    :              +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                        :                    :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :                    +- Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :                       +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                        :                          :- Project [ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :                          :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n                        :                          :     :- Project [ws_item_sk#1757, ws_sold_date_sk#1788]\n                        :                          :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n                        :                          :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        :                          :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n                        :                          :        +- Filter isnotnull(i_item_sk#1172)\n                        :                          :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :                          +- Project [d_date_sk#1040]\n                        :                             +- Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n                        :                                +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Project [d_date_sk#1040]\n                           +- Filter ((isnotnull(d_week_seq#1044) && (d_week_seq#1044 = scalar-subquery#12284 [])) && isnotnull(d_date_sk#1040))\n                              :  +- Project [d_week_seq#1044]\n                              :     +- Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && isnotnull(d_dom#1049)) && (d_year#1046 = 1999)) && (d_moy#1048 = 12)) && (d_dom#1049 = 11))\n                              :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[channel#12274 ASC NULLS FIRST,i_brand_id#1179 ASC NULLS FIRST,i_class_id#1181 ASC NULLS FIRST,i_category_id#1183 ASC NULLS FIRST], output=[channel#12274,i_brand_id#1179,i_class_id#1181,i_category_id#1183,sales#12275,number_sales#12276L,channel#12280,i_brand_id#12315,i_class_id#12317,i_category_id#12319,sales#12281,number_sales#12282L])\n+- *(91) SortMergeJoin [i_brand_id#1179, i_class_id#1181, i_category_id#1183], [i_brand_id#12315, i_class_id#12317, i_category_id#12319], Inner\n   :- *(45) Sort [i_brand_id#1179 ASC NULLS FIRST, i_class_id#1181 ASC NULLS FIRST, i_category_id#1183 ASC NULLS FIRST], false, 0\n   :  +- *(45) Project [channel#12274, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#12275, number_sales#12276L]\n   :     +- *(45) Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12304) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12304 as decimal(32,6)) > cast(Subquery subquery12279 as decimal(32,6))))\n   :        :  +- Subquery subquery12279\n   :        :     +- *(8) HashAggregate(keys=[], functions=[avg(CheckOverflow((promote_precision(cast(cast(quantity#12290 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#12291 as decimal(12,2)))), DecimalType(18,2)))], output=[average_sales#12296])\n   :        :        +- Exchange SinglePartition\n   :        :           +- *(7) HashAggregate(keys=[], functions=[partial_avg(CheckOverflow((promote_precision(cast(cast(quantity#12290 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#12291 as decimal(12,2)))), DecimalType(18,2)))], output=[sum#12356, count#12357L])\n   :        :              +- Union\n   :        :                 :- *(2) Project [ss_quantity#1913 AS quantity#12290, ss_list_price#1915 AS list_price#12291]\n   :        :                 :  +- *(2) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n   :        :                 :     :- *(2) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_list_price#1915,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [], ReadSchema: struct<ss_quantity:int,ss_list_price:decimal(7,2)>\n   :        :                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :        :                 :        +- *(1) Project [d_date_sk#1040]\n   :        :                 :           +- *(1) Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n   :        :                 :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:int,d_year:int>\n   :        :                 :- *(4) Project [cs_quantity#1806 AS quantity#12292, cs_list_price#1808 AS list_price#12293]\n   :        :                 :  +- *(4) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n   :        :                 :     :- *(4) FileScan parquet db_tpcds.catalog_sales[cs_quantity#1806,cs_list_price#1808,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_quantity:int,cs_list_price:decimal(7,2)>\n   :        :                 :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :        :                 +- *(6) Project [ws_quantity#1772 AS quantity#12294, ws_list_price#1774 AS list_price#12295]\n   :        :                    +- *(6) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n   :        :                       :- *(6) FileScan parquet db_tpcds.web_sales[ws_quantity#1772,ws_list_price#1774,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [], ReadSchema: struct<ws_quantity:int,ws_list_price:decimal(7,2)>\n   :        :                       +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :        +- *(45) HashAggregate(keys=[i_brand_id#1179, i_class_id#1181, i_category_id#1183], functions=[sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))), count(1)], output=[channel#12274, i_brand_id#1179, i_class_id#1181, i_category_id#1183, sales#12275, number_sales#12276L, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12304])\n   :           +- Exchange hashpartitioning(i_brand_id#1179, i_class_id#1181, i_category_id#1183, 200)\n   :              +- *(44) HashAggregate(keys=[i_brand_id#1179, i_class_id#1181, i_category_id#1183], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))), partial_count(1)], output=[i_brand_id#1179, i_class_id#1181, i_category_id#1183, sum#12348, count#12349L])\n   :                 +- *(44) Project [ss_quantity#1913, ss_list_price#1915, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n   :                    +- *(44) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n   :                       :- *(44) Project [ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n   :                       :  +- *(44) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n   :                       :     :- SortMergeJoin [ss_item_sk#1905], [ss_item_sk#12289], LeftSemi\n   :                       :     :  :- *(2) Sort [ss_item_sk#1905 ASC NULLS FIRST], false, 0\n   :                       :     :  :  +- Exchange hashpartitioning(ss_item_sk#1905, 200)\n   :                       :     :  :     +- *(1) Project [ss_item_sk#1905, ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926]\n   :                       :     :  :        +- *(1) Filter isnotnull(ss_item_sk#1905)\n   :                       :     :  :           +- *(1) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_quantity#1913,ss_list_price#1915,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_quantity:int,ss_list_price:decimal(7,2)>\n   :                       :     :  +- *(21) Sort [ss_item_sk#12289 ASC NULLS FIRST], false, 0\n   :                       :     :     +- Exchange hashpartitioning(ss_item_sk#12289, 200)\n   :                       :     :        +- *(20) Project [i_item_sk#1172 AS ss_item_sk#12289]\n   :                       :     :           +- *(20) BroadcastHashJoin [i_brand_id#1179, i_class_id#1181, i_category_id#1183], [brand_id#12286, class_id#12287, category_id#12288], Inner, BuildLeft\n   :                       :     :              :- BroadcastExchange HashedRelationBroadcastMode(ArrayBuffer(input[1, int, true], input[2, int, true], input[3, int, true]))\n   :                       :     :              :  +- *(3) Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n   :                       :     :              :     +- *(3) Filter ((isnotnull(i_category_id#1183) && isnotnull(i_brand_id#1179)) && isnotnull(i_class_id#1181))\n   :                       :     :              :        +- *(3) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_class_id#1181,i_category_id#1183] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_category_id), IsNotNull(i_brand_id), IsNotNull(i_class_id)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_class_id:int,i_category_id:int>\n   :                       :     :              +- *(20) HashAggregate(keys=[brand_id#12286, class_id#12287, category_id#12288], functions=[], output=[brand_id#12286, class_id#12287, category_id#12288])\n   :                       :     :                 +- Exchange hashpartitioning(brand_id#12286, class_id#12287, category_id#12288, 200)\n   :                       :     :                    +- *(19) HashAggregate(keys=[brand_id#12286, class_id#12287, category_id#12288], functions=[], output=[brand_id#12286, class_id#12287, category_id#12288])\n   :                       :     :                       +- SortMergeJoin [coalesce(brand_id#12286, 0), coalesce(class_id#12287, 0), coalesce(category_id#12288, 0)], [coalesce(i_brand_id#1179, 0), coalesce(i_class_id#1181, 0), coalesce(i_category_id#1183, 0)], LeftSemi, (((brand_id#12286 <=> i_brand_id#1179) && (class_id#12287 <=> i_class_id#1181)) && (category_id#12288 <=> i_category_id#1183))\n   :                       :     :                          :- *(14) Sort [coalesce(brand_id#12286, 0) ASC NULLS FIRST, coalesce(class_id#12287, 0) ASC NULLS FIRST, coalesce(category_id#12288, 0) ASC NULLS FIRST], false, 0\n   :                       :     :                          :  +- Exchange hashpartitioning(coalesce(brand_id#12286, 0), coalesce(class_id#12287, 0), coalesce(category_id#12288, 0), 200)\n   :                       :     :                          :     +- *(13) HashAggregate(keys=[brand_id#12286, class_id#12287, category_id#12288], functions=[], output=[brand_id#12286, class_id#12287, category_id#12288])\n   :                       :     :                          :        +- Exchange hashpartitioning(brand_id#12286, class_id#12287, category_id#12288, 200)\n   :                       :     :                          :           +- *(12) HashAggregate(keys=[brand_id#12286, class_id#12287, category_id#12288], functions=[], output=[brand_id#12286, class_id#12287, category_id#12288])\n   :                       :     :                          :              +- SortMergeJoin [coalesce(brand_id#12286, 0), coalesce(class_id#12287, 0), coalesce(category_id#12288, 0)], [coalesce(i_brand_id#1179, 0), coalesce(i_class_id#1181, 0), coalesce(i_category_id#1183, 0)], LeftSemi, (((brand_id#12286 <=> i_brand_id#1179) && (class_id#12287 <=> i_class_id#1181)) && (category_id#12288 <=> i_category_id#1183))\n   :                       :     :                          :                 :- *(7) Sort [coalesce(brand_id#12286, 0) ASC NULLS FIRST, coalesce(class_id#12287, 0) ASC NULLS FIRST, coalesce(category_id#12288, 0) ASC NULLS FIRST], false, 0\n   :                       :     :                          :                 :  +- Exchange hashpartitioning(coalesce(brand_id#12286, 0), coalesce(class_id#12287, 0), coalesce(category_id#12288, 0), 200)\n   :                       :     :                          :                 :     +- *(6) Project [i_brand_id#1179 AS brand_id#12286, i_class_id#1181 AS class_id#12287, i_category_id#1183 AS category_id#12288]\n   :                       :     :                          :                 :        +- *(6) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n   :                       :     :                          :                 :           :- *(6) Project [ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n   :                       :     :                          :                 :           :  +- *(6) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n   :                       :     :                          :                 :           :     :- *(6) Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n   :                       :     :                          :                 :           :     :  +- *(6) Filter isnotnull(ss_item_sk#1905)\n   :                       :     :                          :                 :           :     :     +- *(6) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int>\n   :                       :     :                          :                 :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                       :     :                          :                 :           :        +- *(4) Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n   :                       :     :                          :                 :           :           +- *(4) Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_class_id#1181)) && isnotnull(i_category_id#1183)) && isnotnull(i_brand_id#1179))\n   :                       :     :                          :                 :           :              +- *(4) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_class_id#1181,i_category_id#1183] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_class_id), IsNotNull(i_category_id), IsNotNull(i_brand_id)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_class_id:int,i_category_id:int>\n   :                       :     :                          :                 :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                       :     :                          :                 :              +- *(5) Project [d_date_sk#1040]\n   :                       :     :                          :                 :                 +- *(5) Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n   :                       :     :                          :                 :                    +- *(5) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:int,d_year:int>\n   :                       :     :                          :                 +- *(11) Sort [coalesce(i_brand_id#1179, 0) ASC NULLS FIRST, coalesce(i_class_id#1181, 0) ASC NULLS FIRST, coalesce(i_category_id#1183, 0) ASC NULLS FIRST], false, 0\n   :                       :     :                          :                    +- Exchange hashpartitioning(coalesce(i_brand_id#1179, 0), coalesce(i_class_id#1181, 0), coalesce(i_category_id#1183, 0), 200)\n   :                       :     :                          :                       +- *(10) Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n   :                       :     :                          :                          +- *(10) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n   :                       :     :                          :                             :- *(10) Project [cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n   :                       :     :                          :                             :  +- *(10) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n   :                       :     :                          :                             :     :- *(10) Project [cs_item_sk#1803, cs_sold_date_sk#1822]\n   :                       :     :                          :                             :     :  +- *(10) Filter isnotnull(cs_item_sk#1803)\n   :                       :     :                          :                             :     :     +- *(10) FileScan parquet db_tpcds.catalog_sales[cs_item_sk#1803,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:int>\n   :                       :     :                          :                             :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                       :     :                          :                             :        +- *(8) Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n   :                       :     :                          :                             :           +- *(8) Filter isnotnull(i_item_sk#1172)\n   :                       :     :                          :                             :              +- *(8) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_class_id#1181,i_category_id#1183] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_class_id:int,i_category_id:int>\n   :                       :     :                          :                             +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                       :     :                          +- *(18) Sort [coalesce(i_brand_id#1179, 0) ASC NULLS FIRST, coalesce(i_class_id#1181, 0) ASC NULLS FIRST, coalesce(i_category_id#1183, 0) ASC NULLS FIRST], false, 0\n   :                       :     :                             +- Exchange hashpartitioning(coalesce(i_brand_id#1179, 0), coalesce(i_class_id#1181, 0), coalesce(i_category_id#1183, 0), 200)\n   :                       :     :                                +- *(17) Project [i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n   :                       :     :                                   +- *(17) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n   :                       :     :                                      :- *(17) Project [ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n   :                       :     :                                      :  +- *(17) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n   :                       :     :                                      :     :- *(17) Project [ws_item_sk#1757, ws_sold_date_sk#1788]\n   :                       :     :                                      :     :  +- *(17) Filter isnotnull(ws_item_sk#1757)\n   :                       :     :                                      :     :     +- *(17) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int>\n   :                       :     :                                      :     +- ReusedExchange [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                       :     :                                      +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                       :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                       :        +- SortMergeJoin [i_item_sk#1172], [ss_item_sk#12289], LeftSemi\n   :                       :           :- *(23) Sort [i_item_sk#1172 ASC NULLS FIRST], false, 0\n   :                       :           :  +- Exchange hashpartitioning(i_item_sk#1172, 200)\n   :                       :           :     +- *(22) Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183]\n   :                       :           :        +- *(22) Filter (((isnotnull(i_item_sk#1172) && isnotnull(i_category_id#1183)) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179))\n   :                       :           :           +- *(22) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_class_id#1181,i_category_id#1183] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category_id), IsNotNull(i_class_id), IsNotNull(i_brand_id)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_class_id:int,i_category_id:int>\n   :                       :           +- *(42) Sort [ss_item_sk#12289 ASC NULLS FIRST], false, 0\n   :                       :              +- ReusedExchange [ss_item_sk#12289], Exchange hashpartitioning(ss_item_sk#12289, 200)\n   :                       +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                          +- *(43) Project [d_date_sk#1040]\n   :                             +- *(43) Filter ((isnotnull(d_week_seq#1044) && (d_week_seq#1044 = Subquery subquery12278)) && isnotnull(d_date_sk#1040))\n   :                                :  +- Subquery subquery12278\n   :                                :     +- *(1) Project [d_week_seq#1044]\n   :                                :        +- *(1) Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && isnotnull(d_dom#1049)) && (d_year#1046 = 2000)) && (d_moy#1048 = 12)) && (d_dom#1049 = 11))\n   :                                :           +- *(1) FileScan parquet db_tpcds.date_dim[d_week_seq#1044,d_year#1046,d_moy#1048,d_dom#1049] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), IsNotNull(d_dom), EqualTo(d_year,2000), EqualTo(d_moy,12), ..., ReadSchema: struct<d_week_seq:int,d_year:int,d_moy:int,d_dom:int>\n   :                                +- *(43) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_week_seq:int>\n   :                                      +- Subquery subquery12278\n   :                                         +- *(1) Project [d_week_seq#1044]\n   :                                            +- *(1) Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && isnotnull(d_dom#1049)) && (d_year#1046 = 2000)) && (d_moy#1048 = 12)) && (d_dom#1049 = 11))\n   :                                               +- *(1) FileScan parquet db_tpcds.date_dim[d_week_seq#1044,d_year#1046,d_moy#1048,d_dom#1049] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), IsNotNull(d_dom), EqualTo(d_year,2000), EqualTo(d_moy,12), ..., ReadSchema: struct<d_week_seq:int,d_year:int,d_moy:int,d_dom:int>\n   +- *(90) Sort [i_brand_id#12315 ASC NULLS FIRST, i_class_id#12317 ASC NULLS FIRST, i_category_id#12319 ASC NULLS FIRST], false, 0\n      +- *(90) Project [channel#12280, i_brand_id#12315, i_class_id#12317, i_category_id#12319, sales#12281, number_sales#12282L]\n         +- *(90) Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12307) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12307 as decimal(32,6)) > cast(Subquery subquery12285 as decimal(32,6))))\n            :  +- Subquery subquery12285\n            :     +- *(8) HashAggregate(keys=[], functions=[avg(CheckOverflow((promote_precision(cast(cast(quantity#12290 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#12291 as decimal(12,2)))), DecimalType(18,2)))], output=[average_sales#12296])\n            :        +- Exchange SinglePartition\n            :           +- *(7) HashAggregate(keys=[], functions=[partial_avg(CheckOverflow((promote_precision(cast(cast(quantity#12290 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(list_price#12291 as decimal(12,2)))), DecimalType(18,2)))], output=[sum#12356, count#12357L])\n            :              +- Union\n            :                 :- *(2) Project [ss_quantity#1913 AS quantity#12290, ss_list_price#1915 AS list_price#12291]\n            :                 :  +- *(2) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n            :                 :     :- *(2) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_list_price#1915,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [], ReadSchema: struct<ss_quantity:int,ss_list_price:decimal(7,2)>\n            :                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :                 :        +- *(1) Project [d_date_sk#1040]\n            :                 :           +- *(1) Filter (((isnotnull(d_year#1046) && (d_year#1046 >= 1999)) && (d_year#1046 <= 2001)) && isnotnull(d_date_sk#1040))\n            :                 :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), GreaterThanOrEqual(d_year,1999), LessThanOrEqual(d_year,2001), IsNotNull(d_da..., ReadSchema: struct<d_date_sk:int,d_year:int>\n            :                 :- *(4) Project [cs_quantity#1806 AS quantity#12292, cs_list_price#1808 AS list_price#12293]\n            :                 :  +- *(4) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n            :                 :     :- *(4) FileScan parquet db_tpcds.catalog_sales[cs_quantity#1806,cs_list_price#1808,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_quantity:int,cs_list_price:decimal(7,2)>\n            :                 :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :                 +- *(6) Project [ws_quantity#1772 AS quantity#12294, ws_list_price#1774 AS list_price#12295]\n            :                    +- *(6) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n            :                       :- *(6) FileScan parquet db_tpcds.web_sales[ws_quantity#1772,ws_list_price#1774,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [], ReadSchema: struct<ws_quantity:int,ws_list_price:decimal(7,2)>\n            :                       +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            +- *(90) HashAggregate(keys=[i_brand_id#12315, i_class_id#12317, i_category_id#12319], functions=[sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))), count(1)], output=[channel#12280, i_brand_id#12315, i_class_id#12317, i_category_id#12319, sales#12281, number_sales#12282L, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2)))#12307])\n               +- Exchange hashpartitioning(i_brand_id#12315, i_class_id#12317, i_category_id#12319, 200)\n                  +- *(89) HashAggregate(keys=[i_brand_id#12315, i_class_id#12317, i_category_id#12319], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_list_price#1915 as decimal(12,2)))), DecimalType(18,2))), partial_count(1)], output=[i_brand_id#12315, i_class_id#12317, i_category_id#12319, sum#12352, count#12353L])\n                     +- *(89) Project [ss_quantity#1913, ss_list_price#1915, i_brand_id#12315, i_class_id#12317, i_category_id#12319]\n                        +- *(89) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                           :- *(89) Project [ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926, i_brand_id#12315, i_class_id#12317, i_category_id#12319]\n                           :  +- *(89) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#12308], Inner, BuildRight\n                           :     :- SortMergeJoin [ss_item_sk#1905], [ss_item_sk#12289], LeftSemi\n                           :     :  :- *(47) Sort [ss_item_sk#1905 ASC NULLS FIRST], false, 0\n                           :     :  :  +- ReusedExchange [ss_item_sk#1905, ss_quantity#1913, ss_list_price#1915, ss_sold_date_sk#1926], Exchange hashpartitioning(ss_item_sk#1905, 200)\n                           :     :  +- *(66) Sort [ss_item_sk#12289 ASC NULLS FIRST], false, 0\n                           :     :     +- ReusedExchange [ss_item_sk#12289], Exchange hashpartitioning(ss_item_sk#12289, 200)\n                           :     +- ReusedExchange [i_item_sk#12308, i_brand_id#12315, i_class_id#12317, i_category_id#12319], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              +- *(88) Project [d_date_sk#1040]\n                                 +- *(88) Filter ((isnotnull(d_week_seq#1044) && (d_week_seq#1044 = Subquery subquery12284)) && isnotnull(d_date_sk#1040))\n                                    :  +- Subquery subquery12284\n                                    :     +- *(1) Project [d_week_seq#1044]\n                                    :        +- *(1) Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && isnotnull(d_dom#1049)) && (d_year#1046 = 1999)) && (d_moy#1048 = 12)) && (d_dom#1049 = 11))\n                                    :           +- *(1) FileScan parquet db_tpcds.date_dim[d_week_seq#1044,d_year#1046,d_moy#1048,d_dom#1049] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), IsNotNull(d_dom), EqualTo(d_year,1999), EqualTo(d_moy,12), ..., ReadSchema: struct<d_week_seq:int,d_year:int,d_moy:int,d_dom:int>\n                                    +- *(88) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_week_seq:int>\n                                          +- Subquery subquery12284\n                                             +- *(1) Project [d_week_seq#1044]\n                                                +- *(1) Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && isnotnull(d_dom#1049)) && (d_year#1046 = 1999)) && (d_moy#1048 = 12)) && (d_dom#1049 = 11))\n                                                   +- *(1) FileScan parquet db_tpcds.date_dim[d_week_seq#1044,d_year#1046,d_moy#1048,d_dom#1049] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), IsNotNull(d_dom), EqualTo(d_year,1999), EqualTo(d_moy,12), ..., ReadSchema: struct<d_week_seq:int,d_year:int,d_moy:int,d_dom:int>"},{"name":"q15-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["catalog_sales","customer","customer_address","date_dim"],"parsingTime":0.0027,"analysisTime":7.37E-4,"optimizationTime":235.725478,"planningTime":11.160555,"executionTime":2445.56118,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['ca_zip ASC NULLS FIRST], true\n      +- 'Aggregate ['ca_zip], ['ca_zip, unresolvedalias('sum('cs_sales_price), None)]\n         +- 'Filter (((('cs_bill_customer_sk = 'c_customer_sk) && ('c_current_addr_sk = 'ca_address_sk)) && (('substr('ca_zip, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) || 'ca_state IN (CA,WA,GA)) || ('cs_sales_price > 500))) && ((('cs_sold_date_sk = 'd_date_sk) && ('d_qoy = 2)) && ('d_year = 2001)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'UnresolvedRelation `catalog_sales`\n               :  :  +- 'UnresolvedRelation `customer`\n               :  +- 'UnresolvedRelation `customer_address`\n               +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nca_zip: string, sum(cs_sales_price): decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [ca_zip#931, sum(cs_sales_price)#12449]\n      +- Sort [ca_zip#931 ASC NULLS FIRST], true\n         +- Aggregate [ca_zip#931], [ca_zip#931, sum(cs_sales_price#1809) AS sum(cs_sales_price)#12449]\n            +- Filter ((((cs_bill_customer_sk#1791 = c_customer_sk#860) && (c_current_addr_sk#864 = ca_address_sk#922)) && ((substring(ca_zip#931, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) || ca_state#930 IN (CA,WA,GA)) || (cast(cs_sales_price#1809 as decimal(7,2)) > cast(cast(500 as decimal(3,0)) as decimal(7,2))))) && (((cs_sold_date_sk#1822 = d_date_sk#1040) && (d_qoy#1050 = 2)) && (d_year#1046 = 2001)))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- SubqueryAlias catalog_sales\n                  :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                  :  :  +- SubqueryAlias customer\n                  :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :  +- SubqueryAlias customer_address\n                  :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  +- SubqueryAlias date_dim\n                     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [ca_zip#931 ASC NULLS FIRST], true\n      +- Aggregate [ca_zip#931], [ca_zip#931, MakeDecimal(sum(UnscaledValue(cs_sales_price#1809)),17,2) AS sum(cs_sales_price)#12449]\n         +- Project [cs_sales_price#1809, ca_zip#931]\n            +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :- Project [cs_sales_price#1809, cs_sold_date_sk#1822, ca_zip#931]\n               :  +- Join Inner, ((c_current_addr_sk#864 = ca_address_sk#922) && ((substring(ca_zip#931, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) || ca_state#930 IN (CA,WA,GA)) || (cs_sales_price#1809 > 500.00)))\n               :     :- Project [cs_sales_price#1809, cs_sold_date_sk#1822, c_current_addr_sk#864]\n               :     :  +- Join Inner, (cs_bill_customer_sk#1791 = c_customer_sk#860)\n               :     :     :- Project [cs_bill_customer_sk#1791, cs_sales_price#1809, cs_sold_date_sk#1822]\n               :     :     :  +- Filter (isnotnull(cs_bill_customer_sk#1791) && isnotnull(cs_sold_date_sk#1822))\n               :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :     +- Project [c_customer_sk#860, c_current_addr_sk#864]\n               :     :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n               :     :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :     +- Project [ca_address_sk#922, ca_state#930, ca_zip#931]\n               :        +- Filter isnotnull(ca_address_sk#922)\n               :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- Project [d_date_sk#1040]\n                  +- Filter ((((isnotnull(d_qoy#1050) && isnotnull(d_year#1046)) && (d_qoy#1050 = 2)) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n                     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[ca_zip#931 ASC NULLS FIRST], output=[ca_zip#931,sum(cs_sales_price)#12449])\n+- *(5) HashAggregate(keys=[ca_zip#931], functions=[sum(UnscaledValue(cs_sales_price#1809))], output=[ca_zip#931, sum(cs_sales_price)#12449])\n   +- Exchange hashpartitioning(ca_zip#931, 200)\n      +- *(4) HashAggregate(keys=[ca_zip#931], functions=[partial_sum(UnscaledValue(cs_sales_price#1809))], output=[ca_zip#931, sum#12454L])\n         +- *(4) Project [cs_sales_price#1809, ca_zip#931]\n            +- *(4) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :- *(4) Project [cs_sales_price#1809, cs_sold_date_sk#1822, ca_zip#931]\n               :  +- *(4) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight, ((substring(ca_zip#931, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) || ca_state#930 IN (CA,WA,GA)) || (cs_sales_price#1809 > 500.00))\n               :     :- *(4) Project [cs_sales_price#1809, cs_sold_date_sk#1822, c_current_addr_sk#864]\n               :     :  +- *(4) BroadcastHashJoin [cs_bill_customer_sk#1791], [c_customer_sk#860], Inner, BuildRight\n               :     :     :- *(4) Project [cs_bill_customer_sk#1791, cs_sales_price#1809, cs_sold_date_sk#1822]\n               :     :     :  +- *(4) Filter isnotnull(cs_bill_customer_sk#1791)\n               :     :     :     +- *(4) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_sales_price#1809,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:int,cs_sales_price:decimal(7,2)>\n               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(1) Project [c_customer_sk#860, c_current_addr_sk#864]\n               :     :           +- *(1) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n               :     :              +- *(1) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_addr_sk#864] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:int,c_current_addr_sk:int>\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(2) Project [ca_address_sk#922, ca_state#930, ca_zip#931]\n               :           +- *(2) Filter isnotnull(ca_address_sk#922)\n               :              +- *(2) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930,ca_zip#931] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string,ca_zip:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(3) Project [d_date_sk#1040]\n                     +- *(3) Filter ((((isnotnull(d_qoy#1050) && isnotnull(d_year#1046)) && (d_qoy#1050 = 2)) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n                        +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_qoy#1050] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>"},{"name":"q16-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","SortMergeJoin"],"tables":["catalog_sales","date_dim","customer_address","call_center"],"parsingTime":0.002446,"analysisTime":7.19E-4,"optimizationTime":67.77926,"planningTime":727.260353,"executionTime":8398.481685,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['count('cs_order_number) ASC NULLS FIRST], true\n      +- 'Project ['count('cs_order_number) AS order count#12516, 'sum('cs_ext_ship_cost) AS total shipping cost#12517, 'sum('cs_net_profit) AS total net profit#12518]\n         +- 'Filter ((((('d_date >= cast(2002-02-01 as date)) && ('d_date <= (cast(2002-02-01 as date) + interval 8 weeks 4 days))) && ('cs1.cs_ship_date_sk = 'd_date_sk)) && (('cs1.cs_ship_addr_sk = 'ca_address_sk) && ('ca_state = GA))) && ((('cs1.cs_call_center_sk = 'cc_call_center_sk) && 'cc_county IN (Williamson County,Williamson County,Williamson County,Williamson County,Williamson County)) && (exists#12519 [] && NOT exists#12520 [])))\n            :  :- 'Project [*]\n            :  :  +- 'Filter (('cs1.cs_order_number = 'cs2.cs_order_number) && NOT ('cs1.cs_warehouse_sk = 'cs2.cs_warehouse_sk))\n            :  :     +- 'SubqueryAlias cs2\n            :  :        +- 'UnresolvedRelation `catalog_sales`\n            :  +- 'Project [*]\n            :     +- 'Filter ('cs1.cs_order_number = 'cr1.cr_order_number)\n            :        +- 'SubqueryAlias cr1\n            :           +- 'UnresolvedRelation `catalog_returns`\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'SubqueryAlias cs1\n               :  :  :  +- 'UnresolvedRelation `catalog_sales`\n               :  :  +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `customer_address`\n               +- 'UnresolvedRelation `call_center`\n\n== Analyzed Logical Plan ==\norder count: bigint, total shipping cost: decimal(17,2), total net profit: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [order count#12516L, total shipping cost#12517, total net profit#12518]\n      +- Sort [order count#12516L ASC NULLS FIRST], true\n         +- Aggregate [count(distinct cs_order_number#1805L) AS order count#12516L, sum(cs_ext_ship_cost#1816) AS total shipping cost#12517, sum(cs_net_profit#1821) AS total net profit#12518]\n            +- Filter (((((d_date#1042 >= cast(2002-02-01 as date)) && (d_date#1042 <= cast(cast(cast(2002-02-01 as date) as timestamp) + interval 8 weeks 4 days as date))) && (cs_ship_date_sk#1790 = d_date_sk#1040)) && ((cs_ship_addr_sk#1798 = ca_address_sk#922) && (ca_state#930 = GA))) && (((cs_call_center_sk#1799 = cc_call_center_sk#726) && cc_county#751 IN (Williamson County,Williamson County,Williamson County,Williamson County,Williamson County)) && (exists#12519 [cs_order_number#1805L && cs_warehouse_sk#1802] && NOT exists#12520 [cs_order_number#1805L])))\n               :  :- Project [cs_sold_time_sk#1789, cs_ship_date_sk#1790, cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_bill_addr_sk#1794, cs_ship_customer_sk#1795, cs_ship_cdemo_sk#1796, cs_ship_hdemo_sk#1797, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_catalog_page_sk#1800, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_wholesale_cost#1807, cs_list_price#1808, cs_sales_price#1809, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, ... 10 more fields]\n               :  :  +- Filter ((outer(cs_order_number#1805L) = cs_order_number#1805L) && NOT (outer(cs_warehouse_sk#1802) = cs_warehouse_sk#1802))\n               :  :     +- SubqueryAlias cs2\n               :  :        +- SubqueryAlias catalog_sales\n               :  :           +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :  +- Project [cr_returned_time_sk#2086, cr_item_sk#2087, cr_refunded_customer_sk#2088, cr_refunded_cdemo_sk#2089, cr_refunded_hdemo_sk#2090, cr_refunded_addr_sk#2091, cr_returning_customer_sk#2092, cr_returning_cdemo_sk#2093, cr_returning_hdemo_sk#2094, cr_returning_addr_sk#2095, cr_call_center_sk#2096, cr_catalog_page_sk#2097, cr_ship_mode_sk#2098, cr_warehouse_sk#2099, cr_reason_sk#2100, cr_order_number#2101L, cr_return_quantity#2102, cr_return_amount#2103, cr_return_tax#2104, cr_return_amt_inc_tax#2105, cr_fee#2106, cr_return_ship_cost#2107, cr_refunded_cash#2108, cr_reversed_charge#2109, ... 3 more fields]\n               :     +- Filter (outer(cs_order_number#1805L) = cr_order_number#2101L)\n               :        +- SubqueryAlias cr1\n               :           +- SubqueryAlias catalog_returns\n               :              +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- SubqueryAlias cs1\n                  :  :  :  +- SubqueryAlias catalog_sales\n                  :  :  :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                  :  :  +- SubqueryAlias date_dim\n                  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :  +- SubqueryAlias customer_address\n                  :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  +- SubqueryAlias call_center\n                     +- Relation[cc_call_center_sk#726,cc_call_center_id#727,cc_rec_start_date#728,cc_rec_end_date#729,cc_closed_date_sk#730,cc_open_date_sk#731,cc_name#732,cc_class#733,cc_employees#734,cc_sq_ft#735,cc_hours#736,cc_manager#737,cc_mkt_id#738,cc_mkt_class#739,cc_mkt_desc#740,cc_market_manager#741,cc_division#742,cc_division_name#743,cc_company#744,cc_company_name#745,cc_street_number#746,cc_street_name#747,cc_street_type#748,cc_suite_number#749,... 7 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [order count#12516L ASC NULLS FIRST], true\n      +- Aggregate [count(distinct cs_order_number#1805L) AS order count#12516L, MakeDecimal(sum(UnscaledValue(cs_ext_ship_cost#1816)),17,2) AS total shipping cost#12517, MakeDecimal(sum(UnscaledValue(cs_net_profit#1821)),17,2) AS total net profit#12518]\n         +- Project [cs_order_number#1805L, cs_ext_ship_cost#1816, cs_net_profit#1821]\n            +- Join Inner, (cs_call_center_sk#1799 = cc_call_center_sk#726)\n               :- Project [cs_call_center_sk#1799, cs_order_number#1805L, cs_ext_ship_cost#1816, cs_net_profit#1821]\n               :  +- Join Inner, (cs_ship_addr_sk#1798 = ca_address_sk#922)\n               :     :- Project [cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_order_number#1805L, cs_ext_ship_cost#1816, cs_net_profit#1821]\n               :     :  +- Join Inner, (cs_ship_date_sk#1790 = d_date_sk#1040)\n               :     :     :- Join LeftAnti, (cs_order_number#1805L = cr_order_number#2101L)\n               :     :     :  :- Project [cs_ship_date_sk#1790, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_order_number#1805L, cs_ext_ship_cost#1816, cs_net_profit#1821]\n               :     :     :  :  +- Join LeftSemi, ((cs_order_number#1805L = cs_order_number#1805L#12533L) && NOT (cs_warehouse_sk#1802 = cs_warehouse_sk#1802#12536))\n               :     :     :  :     :- Project [cs_ship_date_sk#1790, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_warehouse_sk#1802, cs_order_number#1805L, cs_ext_ship_cost#1816, cs_net_profit#1821]\n               :     :     :  :     :  +- Filter ((isnotnull(cs_ship_date_sk#1790) && isnotnull(cs_ship_addr_sk#1798)) && isnotnull(cs_call_center_sk#1799))\n               :     :     :  :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :     :  :     +- Project [cs_warehouse_sk#1802 AS cs_warehouse_sk#1802#12536, cs_order_number#1805L AS cs_order_number#1805L#12533L]\n               :     :     :  :        +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :     :  +- Project [cr_order_number#2101L]\n               :     :     :     +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n               :     :     +- Project [d_date_sk#1040]\n               :     :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11719)) && (d_date#1042 <= 11779)) && isnotnull(d_date_sk#1040))\n               :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [ca_address_sk#922]\n               :        +- Filter ((isnotnull(ca_state#930) && (ca_state#930 = GA)) && isnotnull(ca_address_sk#922))\n               :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- Project [cc_call_center_sk#726]\n                  +- Filter (cc_county#751 IN (Williamson County) && isnotnull(cc_call_center_sk#726))\n                     +- Relation[cc_call_center_sk#726,cc_call_center_id#727,cc_rec_start_date#728,cc_rec_end_date#729,cc_closed_date_sk#730,cc_open_date_sk#731,cc_name#732,cc_class#733,cc_employees#734,cc_sq_ft#735,cc_hours#736,cc_manager#737,cc_mkt_id#738,cc_mkt_class#739,cc_mkt_desc#740,cc_market_manager#741,cc_division#742,cc_division_name#743,cc_company#744,cc_company_name#745,cc_street_number#746,cc_street_name#747,cc_street_type#748,cc_suite_number#749,... 7 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[order count#12516L ASC NULLS FIRST], output=[order count#12516L,total shipping cost#12517,total net profit#12518])\n+- *(12) HashAggregate(keys=[], functions=[sum(UnscaledValue(cs_ext_ship_cost#1816)), sum(UnscaledValue(cs_net_profit#1821)), count(distinct cs_order_number#1805L)], output=[order count#12516L, total shipping cost#12517, total net profit#12518])\n   +- Exchange SinglePartition\n      +- *(11) HashAggregate(keys=[], functions=[merge_sum(UnscaledValue(cs_ext_ship_cost#1816)), merge_sum(UnscaledValue(cs_net_profit#1821)), partial_count(distinct cs_order_number#1805L)], output=[sum#12564L, sum#12566L, count#12569L])\n         +- *(11) HashAggregate(keys=[cs_order_number#1805L], functions=[merge_sum(UnscaledValue(cs_ext_ship_cost#1816)), merge_sum(UnscaledValue(cs_net_profit#1821))], output=[cs_order_number#1805L, sum#12564L, sum#12566L])\n            +- *(11) HashAggregate(keys=[cs_order_number#1805L], functions=[partial_sum(UnscaledValue(cs_ext_ship_cost#1816)), partial_sum(UnscaledValue(cs_net_profit#1821))], output=[cs_order_number#1805L, sum#12564L, sum#12566L])\n               +- *(11) Project [cs_order_number#1805L, cs_ext_ship_cost#1816, cs_net_profit#1821]\n                  +- *(11) BroadcastHashJoin [cs_call_center_sk#1799], [cc_call_center_sk#726], Inner, BuildRight\n                     :- *(11) Project [cs_call_center_sk#1799, cs_order_number#1805L, cs_ext_ship_cost#1816, cs_net_profit#1821]\n                     :  +- *(11) BroadcastHashJoin [cs_ship_addr_sk#1798], [ca_address_sk#922], Inner, BuildRight\n                     :     :- *(11) Project [cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_order_number#1805L, cs_ext_ship_cost#1816, cs_net_profit#1821]\n                     :     :  +- *(11) BroadcastHashJoin [cs_ship_date_sk#1790], [d_date_sk#1040], Inner, BuildRight\n                     :     :     :- SortMergeJoin [cs_order_number#1805L], [cr_order_number#2101L], LeftAnti\n                     :     :     :  :- *(5) Project [cs_ship_date_sk#1790, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_order_number#1805L, cs_ext_ship_cost#1816, cs_net_profit#1821]\n                     :     :     :  :  +- SortMergeJoin [cs_order_number#1805L], [cs_order_number#1805L#12533L], LeftSemi, NOT (cs_warehouse_sk#1802 = cs_warehouse_sk#1802#12536)\n                     :     :     :  :     :- *(2) Sort [cs_order_number#1805L ASC NULLS FIRST], false, 0\n                     :     :     :  :     :  +- Exchange hashpartitioning(cs_order_number#1805L, 200)\n                     :     :     :  :     :     +- *(1) Project [cs_ship_date_sk#1790, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_warehouse_sk#1802, cs_order_number#1805L, cs_ext_ship_cost#1816, cs_net_profit#1821]\n                     :     :     :  :     :        +- *(1) Filter ((isnotnull(cs_ship_date_sk#1790) && isnotnull(cs_ship_addr_sk#1798)) && isnotnull(cs_call_center_sk#1799))\n                     :     :     :  :     :           +- *(1) FileScan parquet db_tpcds.catalog_sales[cs_ship_date_sk#1790,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_warehouse_sk#1802,cs_order_number#1805L,cs_ext_ship_cost#1816,cs_net_profit#1821,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales], PartitionCount: 1831, PartitionFilters: [], PushedFilters: [IsNotNull(cs_ship_date_sk), IsNotNull(cs_ship_addr_sk), IsNotNull(cs_call_center_sk)], ReadSchema: struct<cs_ship_date_sk:int,cs_ship_addr_sk:int,cs_call_center_sk:int,cs_warehouse_sk:int,cs_order...\n                     :     :     :  :     +- *(4) Sort [cs_order_number#1805L#12533L ASC NULLS FIRST], false, 0\n                     :     :     :  :        +- Exchange hashpartitioning(cs_order_number#1805L#12533L, 200)\n                     :     :     :  :           +- *(3) Project [cs_warehouse_sk#1802 AS cs_warehouse_sk#1802#12536, cs_order_number#1805L AS cs_order_number#1805L#12533L]\n                     :     :     :  :              +- *(3) FileScan parquet db_tpcds.catalog_sales[cs_warehouse_sk#1802,cs_order_number#1805L,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales], PartitionCount: 1831, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<cs_warehouse_sk:int,cs_order_number:bigint>\n                     :     :     :  +- *(7) Sort [cr_order_number#2101L ASC NULLS FIRST], false, 0\n                     :     :     :     +- Exchange hashpartitioning(cr_order_number#2101L, 200)\n                     :     :     :        +- *(6) Project [cr_order_number#2101L]\n                     :     :     :           +- *(6) FileScan parquet db_tpcds.catalog_returns[cr_order_number#2101L,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns], PartitionCount: 2066, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<cr_order_number:bigint>\n                     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :     :        +- *(8) Project [d_date_sk#1040]\n                     :     :           +- *(8) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11719)) && (d_date#1042 <= 11779)) && isnotnull(d_date_sk#1040))\n                     :     :              +- *(8) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2002-02-01), LessThanOrEqual(d_date,2002-04-02), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>\n                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :        +- *(9) Project [ca_address_sk#922]\n                     :           +- *(9) Filter ((isnotnull(ca_state#930) && (ca_state#930 = GA)) && isnotnull(ca_address_sk#922))\n                     :              +- *(9) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_state), EqualTo(ca_state,GA), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string>\n                     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        +- *(10) Project [cc_call_center_sk#726]\n                           +- *(10) Filter (cc_county#751 IN (Williamson County) && isnotnull(cc_call_center_sk#726))\n                              +- *(10) FileScan parquet db_tpcds.call_center[cc_call_center_sk#726,cc_county#751] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/call_center], PartitionFilters: [], PushedFilters: [In(cc_county, [Williamson County]), IsNotNull(cc_call_center_sk)], ReadSchema: struct<cc_call_center_sk:int,cc_county:string>"},{"name":"q17-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin"],"tables":["store_sales","store_returns","catalog_sales","date_dim","date_dim","date_dim","store","item"],"parsingTime":0.002248,"analysisTime":0.001129,"optimizationTime":825.289999,"planningTime":38.13905,"executionTime":8756.649192,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_item_id ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST, 's_state ASC NULLS FIRST], true\n      +- 'Aggregate ['i_item_id, 'i_item_desc, 's_state], ['i_item_id, 'i_item_desc, 's_state, 'count('ss_quantity) AS store_sales_quantitycount#12894, 'avg('ss_quantity) AS store_sales_quantityave#12895, 'stddev_samp('ss_quantity) AS store_sales_quantitystdev#12896, ('stddev_samp('ss_quantity) / 'avg('ss_quantity)) AS store_sales_quantitycov#12897, 'count('sr_return_quantity) AS as_store_returns_quantitycount#12898, 'avg('sr_return_quantity) AS as_store_returns_quantityave#12899, 'stddev_samp('sr_return_quantity) AS as_store_returns_quantitystdev#12900, ('stddev_samp('sr_return_quantity) / 'avg('sr_return_quantity)) AS store_returns_quantitycov#12901, 'count('cs_quantity) AS catalog_sales_quantitycount#12902, 'avg('cs_quantity) AS catalog_sales_quantityave#12903, ('stddev_samp('cs_quantity) / 'avg('cs_quantity)) AS catalog_sales_quantitystdev#12904, ('stddev_samp('cs_quantity) / 'avg('cs_quantity)) AS catalog_sales_quantitycov#12905]\n         +- 'Filter ((((('d1.d_quarter_name = 2001Q1) && ('d1.d_date_sk = 'ss_sold_date_sk)) && (('i_item_sk = 'ss_item_sk) && ('s_store_sk = 'ss_store_sk))) && ((('ss_customer_sk = 'sr_customer_sk) && ('ss_item_sk = 'sr_item_sk)) && ('ss_ticket_number = 'sr_ticket_number))) && (((('sr_returned_date_sk = 'd2.d_date_sk) && 'd2.d_quarter_name IN (2001Q1,2001Q2,2001Q3)) && ('sr_customer_sk = 'cs_bill_customer_sk)) && ((('sr_item_sk = 'cs_item_sk) && ('cs_sold_date_sk = 'd3.d_date_sk)) && 'd3.d_quarter_name IN (2001Q1,2001Q2,2001Q3))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'Join Inner\n               :  :  :  :  :- 'Join Inner\n               :  :  :  :  :  :- 'Join Inner\n               :  :  :  :  :  :  :- 'UnresolvedRelation `store_sales`\n               :  :  :  :  :  :  +- 'UnresolvedRelation `store_returns`\n               :  :  :  :  :  +- 'UnresolvedRelation `catalog_sales`\n               :  :  :  :  +- 'SubqueryAlias d1\n               :  :  :  :     +- 'UnresolvedRelation `date_dim`\n               :  :  :  +- 'SubqueryAlias d2\n               :  :  :     +- 'UnresolvedRelation `date_dim`\n               :  :  +- 'SubqueryAlias d3\n               :  :     +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `store`\n               +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\ni_item_id: string, i_item_desc: string, s_state: string, store_sales_quantitycount: bigint, store_sales_quantityave: double, store_sales_quantitystdev: double, store_sales_quantitycov: double, as_store_returns_quantitycount: bigint, as_store_returns_quantityave: double, as_store_returns_quantitystdev: double, store_returns_quantitycov: double, catalog_sales_quantitycount: bigint, catalog_sales_quantityave: double, catalog_sales_quantitystdev: double, catalog_sales_quantitycov: double\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, s_state#1410 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173, i_item_desc#1176, s_state#1410], [i_item_id#1173, i_item_desc#1176, s_state#1410, count(ss_quantity#1913) AS store_sales_quantitycount#12894L, avg(cast(ss_quantity#1913 as bigint)) AS store_sales_quantityave#12895, stddev_samp(cast(ss_quantity#1913 as double)) AS store_sales_quantitystdev#12896, (stddev_samp(cast(ss_quantity#1913 as double)) / avg(cast(ss_quantity#1913 as bigint))) AS store_sales_quantitycov#12897, count(sr_return_quantity#1713) AS as_store_returns_quantitycount#12898L, avg(cast(sr_return_quantity#1713 as bigint)) AS as_store_returns_quantityave#12899, stddev_samp(cast(sr_return_quantity#1713 as double)) AS as_store_returns_quantitystdev#12900, (stddev_samp(cast(sr_return_quantity#1713 as double)) / avg(cast(sr_return_quantity#1713 as bigint))) AS store_returns_quantitycov#12901, count(cs_quantity#1806) AS catalog_sales_quantitycount#12902L, avg(cast(cs_quantity#1806 as bigint)) AS catalog_sales_quantityave#12903, (stddev_samp(cast(cs_quantity#1806 as double)) / avg(cast(cs_quantity#1806 as bigint))) AS catalog_sales_quantitystdev#12904, (stddev_samp(cast(cs_quantity#1806 as double)) / avg(cast(cs_quantity#1806 as bigint))) AS catalog_sales_quantitycov#12905]\n         +- Filter (((((d_quarter_name#1055 = 2001Q1) && (d_date_sk#1040 = ss_sold_date_sk#1926)) && ((i_item_sk#1172 = ss_item_sk#1905) && (s_store_sk#1386 = ss_store_sk#1910))) && (((ss_customer_sk#1906 = sr_customer_sk#1706) && (ss_item_sk#1905 = sr_item_sk#1705)) && (ss_ticket_number#1912L = sr_ticket_number#1712L))) && ((((sr_returned_date_sk#1723 = d_date_sk#12906) && d_quarter_name#12921 IN (2001Q1,2001Q2,2001Q3)) && (sr_customer_sk#1706 = cs_bill_customer_sk#1791)) && (((sr_item_sk#1705 = cs_item_sk#1803) && (cs_sold_date_sk#1822 = d_date_sk#12934)) && d_quarter_name#12949 IN (2001Q1,2001Q2,2001Q3))))\n            +- Join Inner\n               :- Join Inner\n               :  :- Join Inner\n               :  :  :- Join Inner\n               :  :  :  :- Join Inner\n               :  :  :  :  :- Join Inner\n               :  :  :  :  :  :- Join Inner\n               :  :  :  :  :  :  :- SubqueryAlias store_sales\n               :  :  :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :  :  :  :  :  +- SubqueryAlias store_returns\n               :  :  :  :  :  :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :  :  :  :  :  +- SubqueryAlias catalog_sales\n               :  :  :  :  :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :  :  :  :  +- SubqueryAlias d1\n               :  :  :  :     +- SubqueryAlias date_dim\n               :  :  :  :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :  +- SubqueryAlias d2\n               :  :  :     +- SubqueryAlias date_dim\n               :  :  :        +- Relation[d_date_sk#12906,d_date_id#12907,d_date#12908,d_month_seq#12909,d_week_seq#12910,d_quarter_seq#12911,d_year#12912,d_dow#12913,d_moy#12914,d_dom#12915,d_qoy#12916,d_fy_year#12917,d_fy_quarter_seq#12918,d_fy_week_seq#12919,d_day_name#12920,d_quarter_name#12921,d_holiday#12922,d_weekend#12923,d_following_holiday#12924,d_first_dom#12925,d_last_dom#12926,d_same_day_ly#12927,d_same_day_lq#12928,d_current_day#12929,... 4 more fields] parquet\n               :  :  +- SubqueryAlias d3\n               :  :     +- SubqueryAlias date_dim\n               :  :        +- Relation[d_date_sk#12934,d_date_id#12935,d_date#12936,d_month_seq#12937,d_week_seq#12938,d_quarter_seq#12939,d_year#12940,d_dow#12941,d_moy#12942,d_dom#12943,d_qoy#12944,d_fy_year#12945,d_fy_quarter_seq#12946,d_fy_week_seq#12947,d_day_name#12948,d_quarter_name#12949,d_holiday#12950,d_weekend#12951,d_following_holiday#12952,d_first_dom#12953,d_last_dom#12954,d_same_day_ly#12955,d_same_day_lq#12956,d_current_day#12957,... 4 more fields] parquet\n               :  +- SubqueryAlias store\n               :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               +- SubqueryAlias item\n                  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, s_state#1410 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173, i_item_desc#1176, s_state#1410], [i_item_id#1173, i_item_desc#1176, s_state#1410, count(ss_quantity#1913) AS store_sales_quantitycount#12894L, avg(cast(ss_quantity#1913 as bigint)) AS store_sales_quantityave#12895, stddev_samp(cast(ss_quantity#1913 as double)) AS store_sales_quantitystdev#12896, (stddev_samp(cast(ss_quantity#1913 as double)) / avg(cast(ss_quantity#1913 as bigint))) AS store_sales_quantitycov#12897, count(sr_return_quantity#1713) AS as_store_returns_quantitycount#12898L, avg(cast(sr_return_quantity#1713 as bigint)) AS as_store_returns_quantityave#12899, stddev_samp(cast(sr_return_quantity#1713 as double)) AS as_store_returns_quantitystdev#12900, (stddev_samp(cast(sr_return_quantity#1713 as double)) / avg(cast(sr_return_quantity#1713 as bigint))) AS store_returns_quantitycov#12901, count(cs_quantity#1806) AS catalog_sales_quantitycount#12902L, avg(cast(cs_quantity#1806 as bigint)) AS catalog_sales_quantityave#12903, (stddev_samp(cast(cs_quantity#1806 as double)) / avg(cast(cs_quantity#1806 as bigint))) AS catalog_sales_quantitystdev#12904, (stddev_samp(cast(cs_quantity#1806 as double)) / avg(cast(cs_quantity#1806 as bigint))) AS catalog_sales_quantitycov#12905]\n         +- Project [ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806, s_state#1410, i_item_id#1173, i_item_desc#1176]\n            +- Join Inner, (i_item_sk#1172 = ss_item_sk#1905)\n               :- Project [ss_item_sk#1905, ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806, s_state#1410]\n               :  +- Join Inner, (s_store_sk#1386 = ss_store_sk#1910)\n               :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806]\n               :     :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#12934)\n               :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :  +- Join Inner, (sr_returned_date_sk#1723 = d_date_sk#12906)\n               :     :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, sr_return_quantity#1713, sr_returned_date_sk#1723, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :  +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n               :     :     :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_sold_date_sk#1926, sr_return_quantity#1713, sr_returned_date_sk#1723, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :     :  +- Join Inner, ((sr_customer_sk#1706 = cs_bill_customer_sk#1791) && (sr_item_sk#1705 = cs_item_sk#1803))\n               :     :     :     :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_sold_date_sk#1926, sr_item_sk#1705, sr_customer_sk#1706, sr_return_quantity#1713, sr_returned_date_sk#1723]\n               :     :     :     :     :     :  +- Join Inner, (((ss_customer_sk#1906 = sr_customer_sk#1706) && (ss_item_sk#1905 = sr_item_sk#1705)) && (ss_ticket_number#1912L = sr_ticket_number#1712L))\n               :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_quantity#1913, ss_sold_date_sk#1926]\n               :     :     :     :     :     :     :  +- Filter ((((isnotnull(ss_item_sk#1905) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_store_sk#1910))\n               :     :     :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :     :     :     :     :     +- Project [sr_item_sk#1705, sr_customer_sk#1706, sr_ticket_number#1712L, sr_return_quantity#1713, sr_returned_date_sk#1723]\n               :     :     :     :     :     :        +- Filter (((isnotnull(sr_customer_sk#1706) && isnotnull(sr_ticket_number#1712L)) && isnotnull(sr_item_sk#1705)) && isnotnull(sr_returned_date_sk#1723))\n               :     :     :     :     :     :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :     :     :     :     :     +- Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :     :        +- Filter ((isnotnull(cs_item_sk#1803) && isnotnull(cs_bill_customer_sk#1791)) && isnotnull(cs_sold_date_sk#1822))\n               :     :     :     :     :           +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :     :     :     +- Project [d_date_sk#1040]\n               :     :     :     :        +- Filter ((isnotnull(d_quarter_name#1055) && (d_quarter_name#1055 = 2001Q1)) && isnotnull(d_date_sk#1040))\n               :     :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :     :     +- Project [d_date_sk#12906]\n               :     :     :        +- Filter (d_quarter_name#12921 IN (2001Q1,2001Q2,2001Q3) && isnotnull(d_date_sk#12906))\n               :     :     :           +- Relation[d_date_sk#12906,d_date_id#12907,d_date#12908,d_month_seq#12909,d_week_seq#12910,d_quarter_seq#12911,d_year#12912,d_dow#12913,d_moy#12914,d_dom#12915,d_qoy#12916,d_fy_year#12917,d_fy_quarter_seq#12918,d_fy_week_seq#12919,d_day_name#12920,d_quarter_name#12921,d_holiday#12922,d_weekend#12923,d_following_holiday#12924,d_first_dom#12925,d_last_dom#12926,d_same_day_ly#12927,d_same_day_lq#12928,d_current_day#12929,... 4 more fields] parquet\n               :     :     +- Project [d_date_sk#12934]\n               :     :        +- Filter (d_quarter_name#12949 IN (2001Q1,2001Q2,2001Q3) && isnotnull(d_date_sk#12934))\n               :     :           +- Relation[d_date_sk#12934,d_date_id#12935,d_date#12936,d_month_seq#12937,d_week_seq#12938,d_quarter_seq#12939,d_year#12940,d_dow#12941,d_moy#12942,d_dom#12943,d_qoy#12944,d_fy_year#12945,d_fy_quarter_seq#12946,d_fy_week_seq#12947,d_day_name#12948,d_quarter_name#12949,d_holiday#12950,d_weekend#12951,d_following_holiday#12952,d_first_dom#12953,d_last_dom#12954,d_same_day_ly#12955,d_same_day_lq#12956,d_current_day#12957,... 4 more fields] parquet\n               :     +- Project [s_store_sk#1386, s_state#1410]\n               :        +- Filter isnotnull(s_store_sk#1386)\n               :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               +- Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176]\n                  +- Filter isnotnull(i_item_sk#1172)\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_item_id#1173 ASC NULLS FIRST,i_item_desc#1176 ASC NULLS FIRST,s_state#1410 ASC NULLS FIRST], output=[i_item_id#1173,i_item_desc#1176,s_state#1410,store_sales_quantitycount#12894L,store_sales_quantityave#12895,store_sales_quantitystdev#12896,store_sales_quantitycov#12897,as_store_returns_quantitycount#12898L,as_store_returns_quantityave#12899,as_store_returns_quantitystdev#12900,store_returns_quantitycov#12901,catalog_sales_quantitycount#12902L,catalog_sales_quantityave#12903,catalog_sales_quantitystdev#12904,catalog_sales_quantitycov#12905])\n+- *(12) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, s_state#1410], functions=[count(ss_quantity#1913), avg(cast(ss_quantity#1913 as bigint)), stddev_samp(cast(ss_quantity#1913 as double)), count(sr_return_quantity#1713), avg(cast(sr_return_quantity#1713 as bigint)), stddev_samp(cast(sr_return_quantity#1713 as double)), count(cs_quantity#1806), avg(cast(cs_quantity#1806 as bigint)), stddev_samp(cast(cs_quantity#1806 as double))], output=[i_item_id#1173, i_item_desc#1176, s_state#1410, store_sales_quantitycount#12894L, store_sales_quantityave#12895, store_sales_quantitystdev#12896, store_sales_quantitycov#12897, as_store_returns_quantitycount#12898L, as_store_returns_quantityave#12899, as_store_returns_quantitystdev#12900, store_returns_quantitycov#12901, catalog_sales_quantitycount#12902L, catalog_sales_quantityave#12903, catalog_sales_quantitystdev#12904, catalog_sales_quantitycov#12905])\n   +- Exchange hashpartitioning(i_item_id#1173, i_item_desc#1176, s_state#1410, 200)\n      +- *(11) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, s_state#1410], functions=[partial_count(ss_quantity#1913), partial_avg(cast(ss_quantity#1913 as bigint)), partial_stddev_samp(cast(ss_quantity#1913 as double)), partial_count(sr_return_quantity#1713), partial_avg(cast(sr_return_quantity#1713 as bigint)), partial_stddev_samp(cast(sr_return_quantity#1713 as double)), partial_count(cs_quantity#1806), partial_avg(cast(cs_quantity#1806 as bigint)), partial_stddev_samp(cast(cs_quantity#1806 as double))], output=[i_item_id#1173, i_item_desc#1176, s_state#1410, count#13194L, sum#13195, count#13196L, n#13079, avg#13080, m2#13081, count#13197L, sum#13198, count#13199L, n#13095, avg#13096, m2#13097, count#13200L, sum#13201, count#13202L, n#13111, avg#13112, m2#13113])\n         +- *(11) Project [ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806, s_state#1410, i_item_id#1173, i_item_desc#1176]\n            +- *(11) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :- *(11) Project [ss_item_sk#1905, ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806, s_state#1410]\n               :  +- *(11) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n               :     :- *(11) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806]\n               :     :  +- *(11) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#12934], Inner, BuildRight\n               :     :     :- *(11) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :  +- *(11) BroadcastHashJoin [sr_returned_date_sk#1723], [d_date_sk#12906], Inner, BuildRight\n               :     :     :     :- *(11) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, sr_return_quantity#1713, sr_returned_date_sk#1723, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :  +- *(11) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :     :     :     :- *(11) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_sold_date_sk#1926, sr_return_quantity#1713, sr_returned_date_sk#1723, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :     :  +- *(11) SortMergeJoin [sr_customer_sk#1706, sr_item_sk#1705], [cs_bill_customer_sk#1791, cs_item_sk#1803], Inner\n               :     :     :     :     :     :- *(3) Sort [sr_customer_sk#1706 ASC NULLS FIRST, sr_item_sk#1705 ASC NULLS FIRST], false, 0\n               :     :     :     :     :     :  +- Exchange hashpartitioning(sr_customer_sk#1706, sr_item_sk#1705, 200)\n               :     :     :     :     :     :     +- *(2) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_sold_date_sk#1926, sr_item_sk#1705, sr_customer_sk#1706, sr_return_quantity#1713, sr_returned_date_sk#1723]\n               :     :     :     :     :     :        +- *(2) BroadcastHashJoin [ss_customer_sk#1906, ss_item_sk#1905, ss_ticket_number#1912L], [sr_customer_sk#1706, sr_item_sk#1705, sr_ticket_number#1712L], Inner, BuildRight\n               :     :     :     :     :     :           :- *(2) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_quantity#1913, ss_sold_date_sk#1926]\n               :     :     :     :     :     :           :  +- *(2) Filter (((isnotnull(ss_item_sk#1905) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910))\n               :     :     :     :     :     :           :     +- *(2) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_store_sk#1910,ss_ticket_number#1912L,ss_quantity#1913,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_stor..., ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_store_sk:int,ss_ticket_number:bigint,ss_quantity:int>\n               :     :     :     :     :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, int, true], input[0, int, true], input[2, bigint, true]))\n               :     :     :     :     :     :              +- *(1) Project [sr_item_sk#1705, sr_customer_sk#1706, sr_ticket_number#1712L, sr_return_quantity#1713, sr_returned_date_sk#1723]\n               :     :     :     :     :     :                 +- *(1) Filter ((isnotnull(sr_customer_sk#1706) && isnotnull(sr_ticket_number#1712L)) && isnotnull(sr_item_sk#1705))\n               :     :     :     :     :     :                    +- *(1) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_customer_sk#1706,sr_ticket_number#1712L,sr_return_quantity#1713,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns/sr_..., PartitionCount: 2001, PartitionFilters: [isnotnull(sr_returned_date_sk#1723)], PushedFilters: [IsNotNull(sr_customer_sk), IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:int,sr_customer_sk:int,sr_ticket_number:bigint,sr_return_quantity:int>\n               :     :     :     :     :     +- *(5) Sort [cs_bill_customer_sk#1791 ASC NULLS FIRST, cs_item_sk#1803 ASC NULLS FIRST], false, 0\n               :     :     :     :     :        +- Exchange hashpartitioning(cs_bill_customer_sk#1791, cs_item_sk#1803, 200)\n               :     :     :     :     :           +- *(4) Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :     :              +- *(4) Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_bill_customer_sk#1791))\n               :     :     :     :     :                 +- *(4) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_item_sk#1803,cs_quantity#1806,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:int,cs_item_sk:int,cs_quantity:int>\n               :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :     :        +- *(6) Project [d_date_sk#1040]\n               :     :     :     :           +- *(6) Filter ((isnotnull(d_quarter_name#1055) && (d_quarter_name#1055 = 2001Q1)) && isnotnull(d_date_sk#1040))\n               :     :     :     :              +- *(6) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_quarter_name#1055] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_quarter_name), EqualTo(d_quarter_name,2001Q1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_quarter_name:string>\n               :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :        +- *(7) Project [d_date_sk#12906]\n               :     :     :           +- *(7) Filter (d_quarter_name#12921 IN (2001Q1,2001Q2,2001Q3) && isnotnull(d_date_sk#12906))\n               :     :     :              +- *(7) FileScan parquet db_tpcds.date_dim[d_date_sk#12906,d_quarter_name#12921] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [In(d_quarter_name, [2001Q1,2001Q2,2001Q3]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_quarter_name:string>\n               :     :     +- ReusedExchange [d_date_sk#12934], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(9) Project [s_store_sk#1386, s_state#1410]\n               :           +- *(9) Filter isnotnull(s_store_sk#1386)\n               :              +- *(9) FileScan parquet db_tpcds.store[s_store_sk#1386,s_state#1410] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_state:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(10) Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176]\n                     +- *(10) Filter isnotnull(i_item_sk#1172)\n                        +- *(10) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173,i_item_desc#1176] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string,i_item_desc:string>"},{"name":"q18-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["catalog_sales","customer_demographics","customer_demographics","customer","customer_address","date_dim","item"],"parsingTime":0.002688,"analysisTime":5.96E-4,"optimizationTime":343.531226,"planningTime":16.557465,"executionTime":4479.568832,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['ca_country ASC NULLS FIRST, 'ca_state ASC NULLS FIRST, 'ca_county ASC NULLS FIRST, 'i_item_id ASC NULLS FIRST], true\n      +- 'Aggregate ['rollup('i_item_id, 'ca_country, 'ca_state, 'ca_county)], ['i_item_id, 'ca_country, 'ca_state, 'ca_county, 'avg(cast('cs_quantity as decimal(12,2))) AS agg1#13522, 'avg(cast('cs_list_price as decimal(12,2))) AS agg2#13523, 'avg(cast('cs_coupon_amt as decimal(12,2))) AS agg3#13524, 'avg(cast('cs_sales_price as decimal(12,2))) AS agg4#13525, 'avg(cast('cs_net_profit as decimal(12,2))) AS agg5#13526, 'avg(cast('c_birth_year as decimal(12,2))) AS agg6#13527, 'avg(cast('cd1.cd_dep_count as decimal(12,2))) AS agg7#13528]\n         +- 'Filter ((((('cs_sold_date_sk = 'd_date_sk) && ('cs_item_sk = 'i_item_sk)) && ('cs_bill_cdemo_sk = 'cd1.cd_demo_sk)) && ((('cs_bill_customer_sk = 'c_customer_sk) && ('cd1.cd_gender = F)) && ('cd1.cd_education_status = Unknown))) && (((('c_current_cdemo_sk = 'cd2.cd_demo_sk) && ('c_current_addr_sk = 'ca_address_sk)) && 'c_birth_month IN (1,6,8,9,12,2)) && (('d_year = 1998) && 'ca_state IN (MS,IN,ND,OK,NM,VA,MS))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'Join Inner\n               :  :  :  :  :- 'Join Inner\n               :  :  :  :  :  :- 'UnresolvedRelation `catalog_sales`\n               :  :  :  :  :  +- 'SubqueryAlias cd1\n               :  :  :  :  :     +- 'UnresolvedRelation `customer_demographics`\n               :  :  :  :  +- 'SubqueryAlias cd2\n               :  :  :  :     +- 'UnresolvedRelation `customer_demographics`\n               :  :  :  +- 'UnresolvedRelation `customer`\n               :  :  +- 'UnresolvedRelation `customer_address`\n               :  +- 'UnresolvedRelation `date_dim`\n               +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\ni_item_id: string, ca_country: string, ca_state: string, ca_county: string, agg1: decimal(16,6), agg2: decimal(16,6), agg3: decimal(16,6), agg4: decimal(16,6), agg5: decimal(16,6), agg6: decimal(16,6), agg7: decimal(16,6)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [ca_country#13551 ASC NULLS FIRST, ca_state#13552 ASC NULLS FIRST, ca_county#13553 ASC NULLS FIRST, i_item_id#13550 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#13550, ca_country#13551, ca_state#13552, ca_county#13553, spark_grouping_id#13545], [i_item_id#13550, ca_country#13551, ca_state#13552, ca_county#13553, avg(cast(cs_quantity#1806 as decimal(12,2))) AS agg1#13522, avg(cast(cs_list_price#1808 as decimal(12,2))) AS agg2#13523, avg(cast(cs_coupon_amt#1815 as decimal(12,2))) AS agg3#13524, avg(cast(cs_sales_price#1809 as decimal(12,2))) AS agg4#13525, avg(cast(cs_net_profit#1821 as decimal(12,2))) AS agg5#13526, avg(cast(c_birth_year#873 as decimal(12,2))) AS agg6#13527, avg(cast(cd_dep_count#972 as decimal(12,2))) AS agg7#13528]\n         +- Expand [List(cs_sold_time_sk#1789, cs_ship_date_sk#1790, cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_bill_addr_sk#1794, cs_ship_customer_sk#1795, cs_ship_cdemo_sk#1796, cs_ship_hdemo_sk#1797, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_catalog_page_sk#1800, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_wholesale_cost#1807, cs_list_price#1808, cs_sales_price#1809, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_ext_tax#1814, cs_coupon_amt#1815, cs_ext_ship_cost#1816, cs_net_paid#1817, cs_net_paid_inc_tax#1818, cs_net_paid_inc_ship#1819, cs_net_paid_inc_ship_tax#1820, cs_net_profit#1821, cs_sold_date_sk#1822, cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974, cd_demo_sk#13529, cd_gender#13530, cd_marital_status#13531, cd_education_status#13532, cd_purchase_estimate#13533, cd_credit_rating#13534, cd_dep_count#13535, cd_dep_employed_count#13536, cd_dep_college_count#13537, c_customer_sk#860, c_customer_id#861, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_day#871, c_birth_month#872, c_birth_year#873, c_birth_country#874, c_login#875, c_email_address#876, c_last_review_date#877, ca_address_sk#922, ca_address_id#923, ca_street_number#924, ca_street_name#925, ca_street_type#926, ca_suite_number#927, ca_city#928, ca_county#929, ca_state#930, ca_zip#931, ca_country#932, ca_gmt_offset#933, ca_location_type#934, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_item_id#13546, ca_country#13547, ca_state#13548, ca_county#13549, 0), List(cs_sold_time_sk#1789, cs_ship_date_sk#1790, cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_bill_addr_sk#1794, cs_ship_customer_sk#1795, cs_ship_cdemo_sk#1796, cs_ship_hdemo_sk#1797, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_catalog_page_sk#1800, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_wholesale_cost#1807, cs_list_price#1808, cs_sales_price#1809, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_ext_tax#1814, cs_coupon_amt#1815, cs_ext_ship_cost#1816, cs_net_paid#1817, cs_net_paid_inc_tax#1818, cs_net_paid_inc_ship#1819, cs_net_paid_inc_ship_tax#1820, cs_net_profit#1821, cs_sold_date_sk#1822, cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974, cd_demo_sk#13529, cd_gender#13530, cd_marital_status#13531, cd_education_status#13532, cd_purchase_estimate#13533, cd_credit_rating#13534, cd_dep_count#13535, cd_dep_employed_count#13536, cd_dep_college_count#13537, c_customer_sk#860, c_customer_id#861, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_day#871, c_birth_month#872, c_birth_year#873, c_birth_country#874, c_login#875, c_email_address#876, c_last_review_date#877, ca_address_sk#922, ca_address_id#923, ca_street_number#924, ca_street_name#925, ca_street_type#926, ca_suite_number#927, ca_city#928, ca_county#929, ca_state#930, ca_zip#931, ca_country#932, ca_gmt_offset#933, ca_location_type#934, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_item_id#13546, ca_country#13547, ca_state#13548, null, 1), List(cs_sold_time_sk#1789, cs_ship_date_sk#1790, cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_bill_addr_sk#1794, cs_ship_customer_sk#1795, cs_ship_cdemo_sk#1796, cs_ship_hdemo_sk#1797, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_catalog_page_sk#1800, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_wholesale_cost#1807, cs_list_price#1808, cs_sales_price#1809, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_ext_tax#1814, cs_coupon_amt#1815, cs_ext_ship_cost#1816, cs_net_paid#1817, cs_net_paid_inc_tax#1818, cs_net_paid_inc_ship#1819, cs_net_paid_inc_ship_tax#1820, cs_net_profit#1821, cs_sold_date_sk#1822, cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974, cd_demo_sk#13529, cd_gender#13530, cd_marital_status#13531, cd_education_status#13532, cd_purchase_estimate#13533, cd_credit_rating#13534, cd_dep_count#13535, cd_dep_employed_count#13536, cd_dep_college_count#13537, c_customer_sk#860, c_customer_id#861, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_day#871, c_birth_month#872, c_birth_year#873, c_birth_country#874, c_login#875, c_email_address#876, c_last_review_date#877, ca_address_sk#922, ca_address_id#923, ca_street_number#924, ca_street_name#925, ca_street_type#926, ca_suite_number#927, ca_city#928, ca_county#929, ca_state#930, ca_zip#931, ca_country#932, ca_gmt_offset#933, ca_location_type#934, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_item_id#13546, ca_country#13547, null, null, 3), List(cs_sold_time_sk#1789, cs_ship_date_sk#1790, cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_bill_addr_sk#1794, cs_ship_customer_sk#1795, cs_ship_cdemo_sk#1796, cs_ship_hdemo_sk#1797, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_catalog_page_sk#1800, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_wholesale_cost#1807, cs_list_price#1808, cs_sales_price#1809, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_ext_tax#1814, cs_coupon_amt#1815, cs_ext_ship_cost#1816, cs_net_paid#1817, cs_net_paid_inc_tax#1818, cs_net_paid_inc_ship#1819, cs_net_paid_inc_ship_tax#1820, cs_net_profit#1821, cs_sold_date_sk#1822, cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974, cd_demo_sk#13529, cd_gender#13530, cd_marital_status#13531, cd_education_status#13532, cd_purchase_estimate#13533, cd_credit_rating#13534, cd_dep_count#13535, cd_dep_employed_count#13536, cd_dep_college_count#13537, c_customer_sk#860, c_customer_id#861, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_day#871, c_birth_month#872, c_birth_year#873, c_birth_country#874, c_login#875, c_email_address#876, c_last_review_date#877, ca_address_sk#922, ca_address_id#923, ca_street_number#924, ca_street_name#925, ca_street_type#926, ca_suite_number#927, ca_city#928, ca_county#929, ca_state#930, ca_zip#931, ca_country#932, ca_gmt_offset#933, ca_location_type#934, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_item_id#13546, null, null, null, 7), List(cs_sold_time_sk#1789, cs_ship_date_sk#1790, cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_bill_addr_sk#1794, cs_ship_customer_sk#1795, cs_ship_cdemo_sk#1796, cs_ship_hdemo_sk#1797, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_catalog_page_sk#1800, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_wholesale_cost#1807, cs_list_price#1808, cs_sales_price#1809, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, cs_ext_list_price#1813, cs_ext_tax#1814, cs_coupon_amt#1815, cs_ext_ship_cost#1816, cs_net_paid#1817, cs_net_paid_inc_tax#1818, cs_net_paid_inc_ship#1819, cs_net_paid_inc_ship_tax#1820, cs_net_profit#1821, cs_sold_date_sk#1822, cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974, cd_demo_sk#13529, cd_gender#13530, cd_marital_status#13531, cd_education_status#13532, cd_purchase_estimate#13533, cd_credit_rating#13534, cd_dep_count#13535, cd_dep_employed_count#13536, cd_dep_college_count#13537, c_customer_sk#860, c_customer_id#861, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_day#871, c_birth_month#872, c_birth_year#873, c_birth_country#874, c_login#875, c_email_address#876, c_last_review_date#877, ca_address_sk#922, ca_address_id#923, ca_street_number#924, ca_street_name#925, ca_street_type#926, ca_suite_number#927, ca_city#928, ca_county#929, ca_state#930, ca_zip#931, ca_country#932, ca_gmt_offset#933, ca_location_type#934, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, null, null, null, null, 15)], [cs_sold_time_sk#1789, cs_ship_date_sk#1790, cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_bill_addr_sk#1794, cs_ship_customer_sk#1795, cs_ship_cdemo_sk#1796, cs_ship_hdemo_sk#1797, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_catalog_page_sk#1800, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_wholesale_cost#1807, cs_list_price#1808, cs_sales_price#1809, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, ... 114 more fields]\n            +- Project [cs_sold_time_sk#1789, cs_ship_date_sk#1790, cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_bill_addr_sk#1794, cs_ship_customer_sk#1795, cs_ship_cdemo_sk#1796, cs_ship_hdemo_sk#1797, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_catalog_page_sk#1800, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_wholesale_cost#1807, cs_list_price#1808, cs_sales_price#1809, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, ... 113 more fields]\n               +- Filter (((((cs_sold_date_sk#1822 = d_date_sk#1040) && (cs_item_sk#1803 = i_item_sk#1172)) && (cs_bill_cdemo_sk#1792 = cd_demo_sk#966)) && (((cs_bill_customer_sk#1791 = c_customer_sk#860) && (cd_gender#967 = F)) && (cd_education_status#969 = Unknown))) && ((((c_current_cdemo_sk#862 = cd_demo_sk#13529) && (c_current_addr_sk#864 = ca_address_sk#922)) && c_birth_month#872 IN (1,6,8,9,12,2)) && ((d_year#1046 = 1998) && ca_state#930 IN (MS,IN,ND,OK,NM,VA,MS))))\n                  +- Join Inner\n                     :- Join Inner\n                     :  :- Join Inner\n                     :  :  :- Join Inner\n                     :  :  :  :- Join Inner\n                     :  :  :  :  :- Join Inner\n                     :  :  :  :  :  :- SubqueryAlias catalog_sales\n                     :  :  :  :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :  :  :  :  :  +- SubqueryAlias cd1\n                     :  :  :  :  :     +- SubqueryAlias customer_demographics\n                     :  :  :  :  :        +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n                     :  :  :  :  +- SubqueryAlias cd2\n                     :  :  :  :     +- SubqueryAlias customer_demographics\n                     :  :  :  :        +- Relation[cd_demo_sk#13529,cd_gender#13530,cd_marital_status#13531,cd_education_status#13532,cd_purchase_estimate#13533,cd_credit_rating#13534,cd_dep_count#13535,cd_dep_employed_count#13536,cd_dep_college_count#13537] parquet\n                     :  :  :  +- SubqueryAlias customer\n                     :  :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                     :  :  +- SubqueryAlias customer_address\n                     :  :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                     :  +- SubqueryAlias date_dim\n                     :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     +- SubqueryAlias item\n                        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [ca_country#13551 ASC NULLS FIRST, ca_state#13552 ASC NULLS FIRST, ca_county#13553 ASC NULLS FIRST, i_item_id#13550 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#13550, ca_country#13551, ca_state#13552, ca_county#13553, spark_grouping_id#13545], [i_item_id#13550, ca_country#13551, ca_state#13552, ca_county#13553, avg(cast(cs_quantity#1806 as decimal(12,2))) AS agg1#13522, avg(cast(cs_list_price#1808 as decimal(12,2))) AS agg2#13523, avg(cast(cs_coupon_amt#1815 as decimal(12,2))) AS agg3#13524, avg(cast(cs_sales_price#1809 as decimal(12,2))) AS agg4#13525, avg(cast(cs_net_profit#1821 as decimal(12,2))) AS agg5#13526, avg(cast(c_birth_year#873 as decimal(12,2))) AS agg6#13527, avg(cast(cd_dep_count#972 as decimal(12,2))) AS agg7#13528]\n         +- Expand [List(cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, i_item_id#1173, ca_country#932, ca_state#930, ca_county#929, 0), List(cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, i_item_id#1173, ca_country#932, ca_state#930, null, 1), List(cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, i_item_id#1173, ca_country#932, null, null, 3), List(cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, i_item_id#1173, null, null, null, 7), List(cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, null, null, null, null, 15)], [cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, i_item_id#13550, ca_country#13551, ca_state#13552, ca_county#13553, spark_grouping_id#13545]\n            +- Project [cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, i_item_id#1173, ca_country#932, ca_state#930, ca_county#929]\n               +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n                  :- Project [cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, ca_county#929, ca_state#930, ca_country#932]\n                  :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n                  :     :- Project [cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cs_sold_date_sk#1822, cd_dep_count#972, c_birth_year#873, ca_county#929, ca_state#930, ca_country#932]\n                  :     :  +- Join Inner, (c_current_addr_sk#864 = ca_address_sk#922)\n                  :     :     :- Project [cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cs_sold_date_sk#1822, cd_dep_count#972, c_current_addr_sk#864, c_birth_year#873]\n                  :     :     :  +- Join Inner, (c_current_cdemo_sk#862 = cd_demo_sk#13529)\n                  :     :     :     :- Project [cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cs_sold_date_sk#1822, cd_dep_count#972, c_current_cdemo_sk#862, c_current_addr_sk#864, c_birth_year#873]\n                  :     :     :     :  +- Join Inner, (cs_bill_customer_sk#1791 = c_customer_sk#860)\n                  :     :     :     :     :- Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cs_sold_date_sk#1822, cd_dep_count#972]\n                  :     :     :     :     :  +- Join Inner, (cs_bill_cdemo_sk#1792 = cd_demo_sk#966)\n                  :     :     :     :     :     :- Project [cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cs_sold_date_sk#1822]\n                  :     :     :     :     :     :  +- Filter (((isnotnull(cs_bill_cdemo_sk#1792) && isnotnull(cs_bill_customer_sk#1791)) && isnotnull(cs_sold_date_sk#1822)) && isnotnull(cs_item_sk#1803))\n                  :     :     :     :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                  :     :     :     :     :     +- Project [cd_demo_sk#966, cd_dep_count#972]\n                  :     :     :     :     :        +- Filter ((((isnotnull(cd_gender#967) && isnotnull(cd_education_status#969)) && (cd_gender#967 = F)) && (cd_education_status#969 = Unknown)) && isnotnull(cd_demo_sk#966))\n                  :     :     :     :     :           +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n                  :     :     :     :     +- Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_addr_sk#864, c_birth_year#873]\n                  :     :     :     :        +- Filter (((c_birth_month#872 IN (1,6,8,9,12,2) && isnotnull(c_customer_sk#860)) && isnotnull(c_current_cdemo_sk#862)) && isnotnull(c_current_addr_sk#864))\n                  :     :     :     :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :     :     :     +- Project [cd_demo_sk#13529]\n                  :     :     :        +- Filter isnotnull(cd_demo_sk#13529)\n                  :     :     :           +- Relation[cd_demo_sk#13529,cd_gender#13530,cd_marital_status#13531,cd_education_status#13532,cd_purchase_estimate#13533,cd_credit_rating#13534,cd_dep_count#13535,cd_dep_employed_count#13536,cd_dep_college_count#13537] parquet\n                  :     :     +- Project [ca_address_sk#922, ca_county#929, ca_state#930, ca_country#932]\n                  :     :        +- Filter (ca_state#930 IN (MS,IN,ND,OK,NM,VA) && isnotnull(ca_address_sk#922))\n                  :     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  :     +- Project [d_date_sk#1040]\n                  :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 1998)) && isnotnull(d_date_sk#1040))\n                  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  +- Project [i_item_sk#1172, i_item_id#1173]\n                     +- Filter isnotnull(i_item_sk#1172)\n                        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[ca_country#13551 ASC NULLS FIRST,ca_state#13552 ASC NULLS FIRST,ca_county#13553 ASC NULLS FIRST,i_item_id#13550 ASC NULLS FIRST], output=[i_item_id#13550,ca_country#13551,ca_state#13552,ca_county#13553,agg1#13522,agg2#13523,agg3#13524,agg4#13525,agg5#13526,agg6#13527,agg7#13528])\n+- *(8) HashAggregate(keys=[i_item_id#13550, ca_country#13551, ca_state#13552, ca_county#13553, spark_grouping_id#13545], functions=[avg(cast(cs_quantity#1806 as decimal(12,2))), avg(cast(cs_list_price#1808 as decimal(12,2))), avg(cast(cs_coupon_amt#1815 as decimal(12,2))), avg(cast(cs_sales_price#1809 as decimal(12,2))), avg(cast(cs_net_profit#1821 as decimal(12,2))), avg(cast(c_birth_year#873 as decimal(12,2))), avg(cast(cd_dep_count#972 as decimal(12,2)))], output=[i_item_id#13550, ca_country#13551, ca_state#13552, ca_county#13553, agg1#13522, agg2#13523, agg3#13524, agg4#13525, agg5#13526, agg6#13527, agg7#13528])\n   +- Exchange hashpartitioning(i_item_id#13550, ca_country#13551, ca_state#13552, ca_county#13553, spark_grouping_id#13545, 200)\n      +- *(7) HashAggregate(keys=[i_item_id#13550, ca_country#13551, ca_state#13552, ca_county#13553, spark_grouping_id#13545], functions=[partial_avg(cast(cs_quantity#1806 as decimal(12,2))), partial_avg(cast(cs_list_price#1808 as decimal(12,2))), partial_avg(cast(cs_coupon_amt#1815 as decimal(12,2))), partial_avg(cast(cs_sales_price#1809 as decimal(12,2))), partial_avg(cast(cs_net_profit#1821 as decimal(12,2))), partial_avg(cast(c_birth_year#873 as decimal(12,2))), partial_avg(cast(cd_dep_count#972 as decimal(12,2)))], output=[i_item_id#13550, ca_country#13551, ca_state#13552, ca_county#13553, spark_grouping_id#13545, sum#13583, count#13584L, sum#13585, count#13586L, sum#13587, count#13588L, sum#13589, count#13590L, sum#13591, count#13592L, sum#13593, count#13594L, sum#13595, count#13596L])\n         +- *(7) Expand [List(cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, i_item_id#1173, ca_country#932, ca_state#930, ca_county#929, 0), List(cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, i_item_id#1173, ca_country#932, ca_state#930, null, 1), List(cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, i_item_id#1173, ca_country#932, null, null, 3), List(cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, i_item_id#1173, null, null, null, 7), List(cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, null, null, null, null, 15)], [cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, i_item_id#13550, ca_country#13551, ca_state#13552, ca_county#13553, spark_grouping_id#13545]\n            +- *(7) Project [cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, i_item_id#1173, ca_country#932, ca_state#930, ca_county#929]\n               +- *(7) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n                  :- *(7) Project [cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cd_dep_count#972, c_birth_year#873, ca_county#929, ca_state#930, ca_country#932]\n                  :  +- *(7) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n                  :     :- *(7) Project [cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cs_sold_date_sk#1822, cd_dep_count#972, c_birth_year#873, ca_county#929, ca_state#930, ca_country#932]\n                  :     :  +- *(7) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n                  :     :     :- *(7) Project [cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cs_sold_date_sk#1822, cd_dep_count#972, c_current_addr_sk#864, c_birth_year#873]\n                  :     :     :  +- *(7) BroadcastHashJoin [c_current_cdemo_sk#862], [cd_demo_sk#13529], Inner, BuildRight\n                  :     :     :     :- *(7) Project [cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cs_sold_date_sk#1822, cd_dep_count#972, c_current_cdemo_sk#862, c_current_addr_sk#864, c_birth_year#873]\n                  :     :     :     :  +- *(7) BroadcastHashJoin [cs_bill_customer_sk#1791], [c_customer_sk#860], Inner, BuildRight\n                  :     :     :     :     :- *(7) Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cs_sold_date_sk#1822, cd_dep_count#972]\n                  :     :     :     :     :  +- *(7) BroadcastHashJoin [cs_bill_cdemo_sk#1792], [cd_demo_sk#966], Inner, BuildRight\n                  :     :     :     :     :     :- *(7) Project [cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_net_profit#1821, cs_sold_date_sk#1822]\n                  :     :     :     :     :     :  +- *(7) Filter ((isnotnull(cs_bill_cdemo_sk#1792) && isnotnull(cs_bill_customer_sk#1791)) && isnotnull(cs_item_sk#1803))\n                  :     :     :     :     :     :     +- *(7) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_item_sk#1803,cs_quantity#1806,cs_list_price#1808,cs_sales_price#1809,cs_coupon_amt#1815,cs_net_profit#1821,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_bill_cdemo_sk), IsNotNull(cs_bill_customer_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_bill_customer_sk:int,cs_bill_cdemo_sk:int,cs_item_sk:int,cs_quantity:int,cs_list_price:...\n                  :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :     :     :     :        +- *(1) Project [cd_demo_sk#966, cd_dep_count#972]\n                  :     :     :     :     :           +- *(1) Filter ((((isnotnull(cd_gender#967) && isnotnull(cd_education_status#969)) && (cd_gender#967 = F)) && (cd_education_status#969 = Unknown)) && isnotnull(cd_demo_sk#966))\n                  :     :     :     :     :              +- *(1) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_gender#967,cd_education_status#969,cd_dep_count#972] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_gender), IsNotNull(cd_education_status), EqualTo(cd_gender,F), EqualTo(cd_education..., ReadSchema: struct<cd_demo_sk:int,cd_gender:string,cd_education_status:string,cd_dep_count:int>\n                  :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :     :     :        +- *(2) Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_addr_sk#864, c_birth_year#873]\n                  :     :     :     :           +- *(2) Filter (((c_birth_month#872 IN (1,6,8,9,12,2) && isnotnull(c_customer_sk#860)) && isnotnull(c_current_cdemo_sk#862)) && isnotnull(c_current_addr_sk#864))\n                  :     :     :     :              +- *(2) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_cdemo_sk#862,c_current_addr_sk#864,c_birth_month#872,c_birth_year#873] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [In(c_birth_month, [1,6,8,9,12,2]), IsNotNull(c_customer_sk), IsNotNull(c_current_cdemo_sk), IsNo..., ReadSchema: struct<c_customer_sk:int,c_current_cdemo_sk:int,c_current_addr_sk:int,c_birth_month:int,c_birth_y...\n                  :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :     :        +- *(3) Project [cd_demo_sk#13529]\n                  :     :     :           +- *(3) Filter isnotnull(cd_demo_sk#13529)\n                  :     :     :              +- *(3) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#13529] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:int>\n                  :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :        +- *(4) Project [ca_address_sk#922, ca_county#929, ca_state#930, ca_country#932]\n                  :     :           +- *(4) Filter (ca_state#930 IN (MS,IN,ND,OK,NM,VA) && isnotnull(ca_address_sk#922))\n                  :     :              +- *(4) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_county#929,ca_state#930,ca_country#932] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [In(ca_state, [MS,IN,ND,OK,NM,VA]), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_county:string,ca_state:string,ca_country:string>\n                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :        +- *(5) Project [d_date_sk#1040]\n                  :           +- *(5) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 1998)) && isnotnull(d_date_sk#1040))\n                  :              +- *(5) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n                  +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     +- *(6) Project [i_item_sk#1172, i_item_id#1173]\n                        +- *(6) Filter isnotnull(i_item_sk#1172)\n                           +- *(6) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string>"},{"name":"q19-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["date_dim","store_sales","item","customer","customer_address","store"],"parsingTime":0.002955,"analysisTime":7.25E-4,"optimizationTime":275.766064,"planningTime":12.34252,"executionTime":2424.294591,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['ext_price DESC NULLS LAST, 'brand ASC NULLS FIRST, 'brand_id ASC NULLS FIRST, 'i_manufact_id ASC NULLS FIRST, 'i_manufact ASC NULLS FIRST], true\n      +- 'Aggregate ['i_brand, 'i_brand_id, 'i_manufact_id, 'i_manufact], ['i_brand_id AS brand_id#13661, 'i_brand AS brand#13662, 'i_manufact_id, 'i_manufact, 'sum('ss_ext_sales_price) AS ext_price#13663]\n         +- 'Filter ((((('d_date_sk = 'ss_sold_date_sk) && ('ss_item_sk = 'i_item_sk)) && ('i_manager_id = 8)) && (('d_moy = 11) && ('d_year = 1998))) && ((('ss_customer_sk = 'c_customer_sk) && ('c_current_addr_sk = 'ca_address_sk)) && (NOT ('substr('ca_zip, 1, 5) = 'substr('s_zip, 1, 5)) && ('ss_store_sk = 's_store_sk))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'Join Inner\n               :  :  :  :  :- 'UnresolvedRelation `date_dim`\n               :  :  :  :  +- 'UnresolvedRelation `store_sales`\n               :  :  :  +- 'UnresolvedRelation `item`\n               :  :  +- 'UnresolvedRelation `customer`\n               :  +- 'UnresolvedRelation `customer_address`\n               +- 'UnresolvedRelation `store`\n\n== Analyzed Logical Plan ==\nbrand_id: int, brand: string, i_manufact_id: int, i_manufact: string, ext_price: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [ext_price#13663 DESC NULLS LAST, brand#13662 ASC NULLS FIRST, brand_id#13661 ASC NULLS FIRST, i_manufact_id#1185 ASC NULLS FIRST, i_manufact#1186 ASC NULLS FIRST], true\n      +- Aggregate [i_brand#1180, i_brand_id#1179, i_manufact_id#1185, i_manufact#1186], [i_brand_id#1179 AS brand_id#13661, i_brand#1180 AS brand#13662, i_manufact_id#1185, i_manufact#1186, sum(ss_ext_sales_price#1918) AS ext_price#13663]\n         +- Filter (((((d_date_sk#1040 = ss_sold_date_sk#1926) && (ss_item_sk#1905 = i_item_sk#1172)) && (i_manager_id#1192 = 8)) && ((d_moy#1048 = 11) && (d_year#1046 = 1998))) && (((ss_customer_sk#1906 = c_customer_sk#860) && (c_current_addr_sk#864 = ca_address_sk#922)) && (NOT (substring(ca_zip#931, 1, 5) = substring(s_zip#1411, 1, 5)) && (ss_store_sk#1910 = s_store_sk#1386))))\n            +- Join Inner\n               :- Join Inner\n               :  :- Join Inner\n               :  :  :- Join Inner\n               :  :  :  :- Join Inner\n               :  :  :  :  :- SubqueryAlias date_dim\n               :  :  :  :  :  +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :  :  +- SubqueryAlias store_sales\n               :  :  :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :  :  +- SubqueryAlias item\n               :  :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  :  +- SubqueryAlias customer\n               :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  +- SubqueryAlias customer_address\n               :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- SubqueryAlias store\n                  +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [ext_price#13663 DESC NULLS LAST, brand#13662 ASC NULLS FIRST, brand_id#13661 ASC NULLS FIRST, i_manufact_id#1185 ASC NULLS FIRST, i_manufact#1186 ASC NULLS FIRST], true\n      +- Aggregate [i_brand#1180, i_brand_id#1179, i_manufact_id#1185, i_manufact#1186], [i_brand_id#1179 AS brand_id#13661, i_brand#1180 AS brand#13662, i_manufact_id#1185, i_manufact#1186, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS ext_price#13663]\n         +- Project [ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180, i_manufact_id#1185, i_manufact#1186]\n            +- Join Inner, (NOT (substring(ca_zip#931, 1, 5) = substring(s_zip#1411, 1, 5)) && (ss_store_sk#1910 = s_store_sk#1386))\n               :- Project [ss_store_sk#1910, ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180, i_manufact_id#1185, i_manufact#1186, ca_zip#931]\n               :  +- Join Inner, (c_current_addr_sk#864 = ca_address_sk#922)\n               :     :- Project [ss_store_sk#1910, ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180, i_manufact_id#1185, i_manufact#1186, c_current_addr_sk#864]\n               :     :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n               :     :     :- Project [ss_customer_sk#1906, ss_store_sk#1910, ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180, i_manufact_id#1185, i_manufact#1186]\n               :     :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ext_sales_price#1918]\n               :     :     :     :  +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n               :     :     :     :     :- Project [d_date_sk#1040]\n               :     :     :     :     :  +- Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 11)) && (d_year#1046 = 1998)) && isnotnull(d_date_sk#1040))\n               :     :     :     :     :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :     :     :     +- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n               :     :     :     :        +- Filter (((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_item_sk#1905)) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_store_sk#1910))\n               :     :     :     :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_brand#1180, i_manufact_id#1185, i_manufact#1186]\n               :     :     :        +- Filter ((isnotnull(i_manager_id#1192) && (i_manager_id#1192 = 8)) && isnotnull(i_item_sk#1172))\n               :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :     :     +- Project [c_customer_sk#860, c_current_addr_sk#864]\n               :     :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n               :     :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :     +- Project [ca_address_sk#922, ca_zip#931]\n               :        +- Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_zip#931))\n               :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- Project [s_store_sk#1386, s_zip#1411]\n                  +- Filter (isnotnull(s_zip#1411) && isnotnull(s_store_sk#1386))\n                     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[ext_price#13663 DESC NULLS LAST,brand#13662 ASC NULLS FIRST,brand_id#13661 ASC NULLS FIRST,i_manufact_id#1185 ASC NULLS FIRST,i_manufact#1186 ASC NULLS FIRST], output=[brand_id#13661,brand#13662,i_manufact_id#1185,i_manufact#1186,ext_price#13663])\n+- *(7) HashAggregate(keys=[i_brand#1180, i_brand_id#1179, i_manufact_id#1185, i_manufact#1186], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[brand_id#13661, brand#13662, i_manufact_id#1185, i_manufact#1186, ext_price#13663])\n   +- Exchange hashpartitioning(i_brand#1180, i_brand_id#1179, i_manufact_id#1185, i_manufact#1186, 200)\n      +- *(6) HashAggregate(keys=[i_brand#1180, i_brand_id#1179, i_manufact_id#1185, i_manufact#1186], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[i_brand#1180, i_brand_id#1179, i_manufact_id#1185, i_manufact#1186, sum#13676L])\n         +- *(6) Project [ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180, i_manufact_id#1185, i_manufact#1186]\n            +- *(6) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight, NOT (substring(ca_zip#931, 1, 5) = substring(s_zip#1411, 1, 5))\n               :- *(6) Project [ss_store_sk#1910, ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180, i_manufact_id#1185, i_manufact#1186, ca_zip#931]\n               :  +- *(6) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n               :     :- *(6) Project [ss_store_sk#1910, ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180, i_manufact_id#1185, i_manufact#1186, c_current_addr_sk#864]\n               :     :  +- *(6) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n               :     :     :- *(6) Project [ss_customer_sk#1906, ss_store_sk#1910, ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180, i_manufact_id#1185, i_manufact#1186]\n               :     :     :  +- *(6) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :     :     :     :- *(6) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ext_sales_price#1918]\n               :     :     :     :  +- *(6) BroadcastHashJoin [d_date_sk#1040], [ss_sold_date_sk#1926], Inner, BuildLeft\n               :     :     :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :     :     :  +- *(1) Project [d_date_sk#1040]\n               :     :     :     :     :     +- *(1) Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 11)) && (d_year#1046 = 1998)) && isnotnull(d_date_sk#1040))\n               :     :     :     :     :        +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,11), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               :     :     :     :     +- *(6) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n               :     :     :     :        +- *(6) Filter ((isnotnull(ss_item_sk#1905) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_store_sk#1910))\n               :     :     :     :           +- *(6) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_store_sk#1910,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_store_sk:int,ss_ext_sales_price:decimal(7,2)>\n               :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :        +- *(2) Project [i_item_sk#1172, i_brand_id#1179, i_brand#1180, i_manufact_id#1185, i_manufact#1186]\n               :     :     :           +- *(2) Filter ((isnotnull(i_manager_id#1192) && (i_manager_id#1192 = 8)) && isnotnull(i_item_sk#1172))\n               :     :     :              +- *(2) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_brand#1180,i_manufact_id#1185,i_manufact#1186,i_manager_id#1192] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_manager_id), EqualTo(i_manager_id,8), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_brand:string,i_manufact_id:int,i_manufact:string,i_manager_...\n               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(3) Project [c_customer_sk#860, c_current_addr_sk#864]\n               :     :           +- *(3) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n               :     :              +- *(3) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_addr_sk#864] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:int,c_current_addr_sk:int>\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(4) Project [ca_address_sk#922, ca_zip#931]\n               :           +- *(4) Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_zip#931))\n               :              +- *(4) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_zip#931] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_zip)], ReadSchema: struct<ca_address_sk:int,ca_zip:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(5) Project [s_store_sk#1386, s_zip#1411]\n                     +- *(5) Filter (isnotnull(s_zip#1411) && isnotnull(s_store_sk#1386))\n                        +- *(5) FileScan parquet db_tpcds.store[s_store_sk#1386,s_zip#1411] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_zip), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_zip:string>"},{"name":"q20-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin"],"tables":["catalog_sales","item","date_dim"],"parsingTime":0.002085,"analysisTime":6.7E-4,"optimizationTime":230.020301,"planningTime":11.548479,"executionTime":3158.757072,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_category ASC NULLS FIRST, 'i_class ASC NULLS FIRST, 'i_item_id ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST, 'revenueratio ASC NULLS FIRST], true\n      +- 'Aggregate ['i_item_id, 'i_item_desc, 'i_category, 'i_class, 'i_current_price], ['i_item_id, 'i_item_desc, 'i_category, 'i_class, 'i_current_price, 'sum('cs_ext_sales_price) AS itemrevenue#13710, (('sum('cs_ext_sales_price) * 100) / 'sum('sum('cs_ext_sales_price)) windowspecdefinition('i_class, unspecifiedframe$())) AS revenueratio#13711]\n         +- 'Filter ((('cs_item_sk = 'i_item_sk) && 'i_category IN (Sports,Books,Home)) && (('cs_sold_date_sk = 'd_date_sk) && (('d_date >= cast(1999-02-22 as date)) && ('d_date <= (cast(1999-02-22 as date) + interval 4 weeks 2 days)))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'UnresolvedRelation `catalog_sales`\n               :  +- 'UnresolvedRelation `item`\n               +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\ni_item_id: string, i_item_desc: string, i_category: string, i_class: string, i_current_price: decimal(7,2), itemrevenue: decimal(17,2), revenueratio: decimal(38,17)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_category#1184 ASC NULLS FIRST, i_class#1182 ASC NULLS FIRST, i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, revenueratio#13711 ASC NULLS FIRST], true\n      +- Project [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#13710, revenueratio#13711]\n         +- Project [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#13710, _w0#13716, _w1#13717, _we0#13718, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(_w0#13716 as decimal(17,2))) * promote_precision(cast(cast(100 as decimal(3,0)) as decimal(17,2)))), DecimalType(21,2)) as decimal(27,2))) / promote_precision(cast(_we0#13718 as decimal(27,2)))), DecimalType(38,17)) AS revenueratio#13711]\n            +- Window [sum(_w1#13717) windowspecdefinition(i_class#1182, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#13718], [i_class#1182]\n               +- Aggregate [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177], [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, sum(cs_ext_sales_price#1811) AS itemrevenue#13710, sum(cs_ext_sales_price#1811) AS _w0#13716, sum(cs_ext_sales_price#1811) AS _w1#13717]\n                  +- Filter (((cs_item_sk#1803 = i_item_sk#1172) && i_category#1184 IN (Sports,Books,Home)) && ((cs_sold_date_sk#1822 = d_date_sk#1040) && ((d_date#1042 >= cast(1999-02-22 as date)) && (d_date#1042 <= cast(cast(cast(1999-02-22 as date) as timestamp) + interval 4 weeks 2 days as date)))))\n                     +- Join Inner\n                        :- Join Inner\n                        :  :- SubqueryAlias catalog_sales\n                        :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                        :  +- SubqueryAlias item\n                        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        +- SubqueryAlias date_dim\n                           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_category#1184 ASC NULLS FIRST, i_class#1182 ASC NULLS FIRST, i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, revenueratio#13711 ASC NULLS FIRST], true\n      +- Project [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#13710, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(_w0#13716) * 100.00), DecimalType(21,2)) as decimal(27,2))) / promote_precision(_we0#13718)), DecimalType(38,17)) AS revenueratio#13711]\n         +- Window [sum(_w1#13717) windowspecdefinition(i_class#1182, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#13718], [i_class#1182]\n            +- Aggregate [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177], [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, MakeDecimal(sum(UnscaledValue(cs_ext_sales_price#1811)),17,2) AS itemrevenue#13710, MakeDecimal(sum(UnscaledValue(cs_ext_sales_price#1811)),17,2) AS _w0#13716, MakeDecimal(sum(UnscaledValue(cs_ext_sales_price#1811)),17,2) AS _w1#13717]\n               +- Project [cs_ext_sales_price#1811, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n                     :- Project [cs_ext_sales_price#1811, cs_sold_date_sk#1822, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                     :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n                     :     :- Project [cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n                     :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n                     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :     +- Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                     :        +- Filter (i_category#1184 IN (Sports,Books,Home) && isnotnull(i_item_sk#1172))\n                     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     +- Project [d_date_sk#1040]\n                        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10644)) && (d_date#1042 <= 10674)) && isnotnull(d_date_sk#1040))\n                           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_category#1184 ASC NULLS FIRST,i_class#1182 ASC NULLS FIRST,i_item_id#1173 ASC NULLS FIRST,i_item_desc#1176 ASC NULLS FIRST,revenueratio#13711 ASC NULLS FIRST], output=[i_item_id#1173,i_item_desc#1176,i_category#1184,i_class#1182,i_current_price#1177,itemrevenue#13710,revenueratio#13711])\n+- *(6) Project [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#13710, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(_w0#13716) * 100.00), DecimalType(21,2)) as decimal(27,2))) / promote_precision(_we0#13718)), DecimalType(38,17)) AS revenueratio#13711]\n   +- Window [sum(_w1#13717) windowspecdefinition(i_class#1182, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#13718], [i_class#1182]\n      +- *(5) Sort [i_class#1182 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(i_class#1182, 200)\n            +- *(4) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177], functions=[sum(UnscaledValue(cs_ext_sales_price#1811))], output=[i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#13710, _w0#13716, _w1#13717])\n               +- Exchange hashpartitioning(i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, 200)\n                  +- *(3) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177], functions=[partial_sum(UnscaledValue(cs_ext_sales_price#1811))], output=[i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, sum#13727L])\n                     +- *(3) Project [cs_ext_sales_price#1811, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                        +- *(3) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n                           :- *(3) Project [cs_ext_sales_price#1811, cs_sold_date_sk#1822, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                           :  +- *(3) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n                           :     :- *(3) Project [cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n                           :     :  +- *(3) Filter isnotnull(cs_item_sk#1803)\n                           :     :     +- *(3) FileScan parquet db_tpcds.catalog_sales[cs_item_sk#1803,cs_ext_sales_price#1811,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:int,cs_ext_sales_price:decimal(7,2)>\n                           :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :        +- *(1) Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                           :           +- *(1) Filter (i_category#1184 IN (Sports,Books,Home) && isnotnull(i_item_sk#1172))\n                           :              +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173,i_item_desc#1176,i_current_price#1177,i_class#1182,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [In(i_category, [Sports,Books,Home]), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string,i_item_desc:string,i_current_price:decimal(7,2),i_class:str...\n                           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              +- *(2) Project [d_date_sk#1040]\n                                 +- *(2) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10644)) && (d_date#1042 <= 10674)) && isnotnull(d_date_sk#1040))\n                                    +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1999-02-22), LessThanOrEqual(d_date,1999-03-24), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>"},{"name":"q21-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["inventory","warehouse","item","date_dim"],"parsingTime":0.002263,"analysisTime":7.02E-4,"optimizationTime":77.586725,"planningTime":6.503268,"executionTime":2000.000079,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['w_warehouse_name ASC NULLS FIRST, 'i_item_id ASC NULLS FIRST], true\n      +- 'Project [*]\n         +- 'Filter ((CASE WHEN ('inv_before > 0) THEN ('inv_after / 'inv_before) ELSE null END >= (2.0 / 3.0)) && (CASE WHEN ('inv_before > 0) THEN ('inv_after / 'inv_before) ELSE null END <= (3.0 / 2.0)))\n            +- 'SubqueryAlias x\n               +- 'Aggregate ['w_warehouse_name, 'i_item_id], ['w_warehouse_name, 'i_item_id, 'sum(CASE WHEN (cast('d_date as date) < cast(2000-03-11 as date)) THEN 'inv_quantity_on_hand ELSE 0 END) AS inv_before#13957, 'sum(CASE WHEN (cast('d_date as date) >= cast(2000-03-11 as date)) THEN 'inv_quantity_on_hand ELSE 0 END) AS inv_after#13958]\n                  +- 'Filter ((((('i_current_price >= 0.99) && ('i_current_price <= 1.49)) && ('i_item_sk = 'inv_item_sk)) && ('inv_warehouse_sk = 'w_warehouse_sk)) && (('inv_date_sk = 'd_date_sk) && (('d_date >= (cast(2000-03-11 as date) - interval 4 weeks 2 days)) && ('d_date <= (cast(2000-03-11 as date) + interval 4 weeks 2 days)))))\n                     +- 'Join Inner\n                        :- 'Join Inner\n                        :  :- 'Join Inner\n                        :  :  :- 'UnresolvedRelation `inventory`\n                        :  :  +- 'UnresolvedRelation `warehouse`\n                        :  +- 'UnresolvedRelation `item`\n                        +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nw_warehouse_name: string, i_item_id: string, inv_before: bigint, inv_after: bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [w_warehouse_name#1514 ASC NULLS FIRST, i_item_id#1173 ASC NULLS FIRST], true\n      +- Project [w_warehouse_name#1514, i_item_id#1173, inv_before#13957L, inv_after#13958L]\n         +- Filter ((CASE WHEN (inv_before#13957L > cast(0 as bigint)) THEN (cast(inv_after#13958L as double) / cast(inv_before#13957L as double)) ELSE cast(null as double) END >= cast(CheckOverflow((promote_precision(cast(2.0 as decimal(2,1))) / promote_precision(cast(3.0 as decimal(2,1)))), DecimalType(8,6)) as double)) && (CASE WHEN (inv_before#13957L > cast(0 as bigint)) THEN (cast(inv_after#13958L as double) / cast(inv_before#13957L as double)) ELSE cast(null as double) END <= cast(CheckOverflow((promote_precision(cast(3.0 as decimal(2,1))) / promote_precision(cast(2.0 as decimal(2,1)))), DecimalType(8,6)) as double)))\n            +- SubqueryAlias x\n               +- Aggregate [w_warehouse_name#1514, i_item_id#1173], [w_warehouse_name#1514, i_item_id#1173, sum(cast(CASE WHEN (cast(d_date#1042 as date) < cast(2000-03-11 as date)) THEN inv_quantity_on_hand#2867 ELSE 0 END as bigint)) AS inv_before#13957L, sum(cast(CASE WHEN (cast(d_date#1042 as date) >= cast(2000-03-11 as date)) THEN inv_quantity_on_hand#2867 ELSE 0 END as bigint)) AS inv_after#13958L]\n                  +- Filter (((((cast(i_current_price#1177 as decimal(7,2)) >= cast(0.99 as decimal(7,2))) && (cast(i_current_price#1177 as decimal(7,2)) <= cast(1.49 as decimal(7,2)))) && (i_item_sk#1172 = inv_item_sk#2865)) && (inv_warehouse_sk#2866 = w_warehouse_sk#1512)) && ((inv_date_sk#2868 = d_date_sk#1040) && ((d_date#1042 >= cast(cast(cast(2000-03-11 as date) as timestamp) - interval 4 weeks 2 days as date)) && (d_date#1042 <= cast(cast(cast(2000-03-11 as date) as timestamp) + interval 4 weeks 2 days as date)))))\n                     +- Join Inner\n                        :- Join Inner\n                        :  :- Join Inner\n                        :  :  :- SubqueryAlias inventory\n                        :  :  :  +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n                        :  :  +- SubqueryAlias warehouse\n                        :  :     +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n                        :  +- SubqueryAlias item\n                        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        +- SubqueryAlias date_dim\n                           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [w_warehouse_name#1514 ASC NULLS FIRST, i_item_id#1173 ASC NULLS FIRST], true\n      +- Filter ((CASE WHEN (inv_before#13957L > 0) THEN (cast(inv_after#13958L as double) / cast(inv_before#13957L as double)) ELSE null END >= 0.666667) && (CASE WHEN (inv_before#13957L > 0) THEN (cast(inv_after#13958L as double) / cast(inv_before#13957L as double)) ELSE null END <= 1.5))\n         +- Aggregate [w_warehouse_name#1514, i_item_id#1173], [w_warehouse_name#1514, i_item_id#1173, sum(cast(CASE WHEN (d_date#1042 < 11027) THEN inv_quantity_on_hand#2867 ELSE 0 END as bigint)) AS inv_before#13957L, sum(cast(CASE WHEN (d_date#1042 >= 11027) THEN inv_quantity_on_hand#2867 ELSE 0 END as bigint)) AS inv_after#13958L]\n            +- Project [inv_quantity_on_hand#2867, w_warehouse_name#1514, i_item_id#1173, d_date#1042]\n               +- Join Inner, (inv_date_sk#2868 = d_date_sk#1040)\n                  :- Project [inv_quantity_on_hand#2867, inv_date_sk#2868, w_warehouse_name#1514, i_item_id#1173]\n                  :  +- Join Inner, (i_item_sk#1172 = inv_item_sk#2865)\n                  :     :- Project [inv_item_sk#2865, inv_quantity_on_hand#2867, inv_date_sk#2868, w_warehouse_name#1514]\n                  :     :  +- Join Inner, (inv_warehouse_sk#2866 = w_warehouse_sk#1512)\n                  :     :     :- Filter ((isnotnull(inv_warehouse_sk#2866) && isnotnull(inv_item_sk#2865)) && isnotnull(inv_date_sk#2868))\n                  :     :     :  +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n                  :     :     +- Project [w_warehouse_sk#1512, w_warehouse_name#1514]\n                  :     :        +- Filter isnotnull(w_warehouse_sk#1512)\n                  :     :           +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n                  :     +- Project [i_item_sk#1172, i_item_id#1173]\n                  :        +- Filter (((isnotnull(i_current_price#1177) && (i_current_price#1177 >= 0.99)) && (i_current_price#1177 <= 1.49)) && isnotnull(i_item_sk#1172))\n                  :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  +- Project [d_date_sk#1040, d_date#1042]\n                     +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10997)) && (d_date#1042 <= 11057)) && isnotnull(d_date_sk#1040))\n                        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[w_warehouse_name#1514 ASC NULLS FIRST,i_item_id#1173 ASC NULLS FIRST], output=[w_warehouse_name#1514,i_item_id#1173,inv_before#13957L,inv_after#13958L])\n+- *(5) Filter ((CASE WHEN (inv_before#13957L > 0) THEN (cast(inv_after#13958L as double) / cast(inv_before#13957L as double)) ELSE null END >= 0.666667) && (CASE WHEN (inv_before#13957L > 0) THEN (cast(inv_after#13958L as double) / cast(inv_before#13957L as double)) ELSE null END <= 1.5))\n   +- *(5) HashAggregate(keys=[w_warehouse_name#1514, i_item_id#1173], functions=[sum(cast(CASE WHEN (d_date#1042 < 11027) THEN inv_quantity_on_hand#2867 ELSE 0 END as bigint)), sum(cast(CASE WHEN (d_date#1042 >= 11027) THEN inv_quantity_on_hand#2867 ELSE 0 END as bigint))], output=[w_warehouse_name#1514, i_item_id#1173, inv_before#13957L, inv_after#13958L])\n      +- Exchange hashpartitioning(w_warehouse_name#1514, i_item_id#1173, 200)\n         +- *(4) HashAggregate(keys=[w_warehouse_name#1514, i_item_id#1173], functions=[partial_sum(cast(CASE WHEN (d_date#1042 < 11027) THEN inv_quantity_on_hand#2867 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN (d_date#1042 >= 11027) THEN inv_quantity_on_hand#2867 ELSE 0 END as bigint))], output=[w_warehouse_name#1514, i_item_id#1173, sum#13967L, sum#13968L])\n            +- *(4) Project [inv_quantity_on_hand#2867, w_warehouse_name#1514, i_item_id#1173, d_date#1042]\n               +- *(4) BroadcastHashJoin [inv_date_sk#2868], [d_date_sk#1040], Inner, BuildRight\n                  :- *(4) Project [inv_quantity_on_hand#2867, inv_date_sk#2868, w_warehouse_name#1514, i_item_id#1173]\n                  :  +- *(4) BroadcastHashJoin [inv_item_sk#2865], [i_item_sk#1172], Inner, BuildRight\n                  :     :- *(4) Project [inv_item_sk#2865, inv_quantity_on_hand#2867, inv_date_sk#2868, w_warehouse_name#1514]\n                  :     :  +- *(4) BroadcastHashJoin [inv_warehouse_sk#2866], [w_warehouse_sk#1512], Inner, BuildRight\n                  :     :     :- *(4) Project [inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868]\n                  :     :     :  +- *(4) Filter (isnotnull(inv_warehouse_sk#2866) && isnotnull(inv_item_sk#2865))\n                  :     :     :     +- *(4) FileScan parquet db_tpcds.inventory[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/inventory/inv_dat..., PartitionCount: 261, PartitionFilters: [isnotnull(inv_date_sk#2868)], PushedFilters: [IsNotNull(inv_warehouse_sk), IsNotNull(inv_item_sk)], ReadSchema: struct<inv_item_sk:int,inv_warehouse_sk:int,inv_quantity_on_hand:int>\n                  :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :        +- *(1) Project [w_warehouse_sk#1512, w_warehouse_name#1514]\n                  :     :           +- *(1) Filter isnotnull(w_warehouse_sk#1512)\n                  :     :              +- *(1) FileScan parquet db_tpcds.warehouse[w_warehouse_sk#1512,w_warehouse_name#1514] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/warehouse], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>\n                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :        +- *(2) Project [i_item_sk#1172, i_item_id#1173]\n                  :           +- *(2) Filter (((isnotnull(i_current_price#1177) && (i_current_price#1177 >= 0.99)) && (i_current_price#1177 <= 1.49)) && isnotnull(i_item_sk#1172))\n                  :              +- *(2) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173,i_current_price#1177] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThanOrEqual(i_current_price,0.99), LessThanOrEqual(i_current_..., ReadSchema: struct<i_item_sk:int,i_item_id:string,i_current_price:decimal(7,2)>\n                  +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     +- *(3) Project [d_date_sk#1040, d_date#1042]\n                        +- *(3) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10997)) && (d_date#1042 <= 11057)) && isnotnull(d_date_sk#1040))\n                           +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2000-02-10), LessThanOrEqual(d_date,2000-04-10), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>"},{"name":"q22-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["inventory","date_dim","item","warehouse"],"parsingTime":0.00258,"analysisTime":5.94E-4,"optimizationTime":66.370747,"planningTime":5.431914,"executionTime":3999.182115,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['qoh ASC NULLS FIRST, 'i_product_name ASC NULLS FIRST, 'i_brand ASC NULLS FIRST, 'i_class ASC NULLS FIRST, 'i_category ASC NULLS FIRST], true\n      +- 'Aggregate ['rollup('i_product_name, 'i_brand, 'i_class, 'i_category)], ['i_product_name, 'i_brand, 'i_class, 'i_category, 'avg('inv_quantity_on_hand) AS qoh#14003]\n         +- 'Filter ((('inv_date_sk = 'd_date_sk) && ('inv_item_sk = 'i_item_sk)) && (('inv_warehouse_sk = 'w_warehouse_sk) && (('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11)))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'UnresolvedRelation `inventory`\n               :  :  +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `item`\n               +- 'UnresolvedRelation `warehouse`\n\n== Analyzed Logical Plan ==\ni_product_name: string, i_brand: string, i_class: string, i_category: string, qoh: double\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [qoh#14003 ASC NULLS FIRST, i_product_name#14010 ASC NULLS FIRST, i_brand#14011 ASC NULLS FIRST, i_class#14012 ASC NULLS FIRST, i_category#14013 ASC NULLS FIRST], true\n      +- Aggregate [i_product_name#14010, i_brand#14011, i_class#14012, i_category#14013, spark_grouping_id#14005], [i_product_name#14010, i_brand#14011, i_class#14012, i_category#14013, avg(cast(inv_quantity_on_hand#2867 as bigint)) AS qoh#14003]\n         +- Expand [List(inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, w_warehouse_sk#1512, w_warehouse_id#1513, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_street_number#1516, w_street_name#1517, w_street_type#1518, w_suite_number#1519, w_city#1520, w_county#1521, w_state#1522, w_zip#1523, w_country#1524, w_gmt_offset#1525, i_product_name#14006, i_brand#14007, i_class#14008, i_category#14009, 0), List(inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, w_warehouse_sk#1512, w_warehouse_id#1513, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_street_number#1516, w_street_name#1517, w_street_type#1518, w_suite_number#1519, w_city#1520, w_county#1521, w_state#1522, w_zip#1523, w_country#1524, w_gmt_offset#1525, i_product_name#14006, i_brand#14007, i_class#14008, null, 1), List(inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, w_warehouse_sk#1512, w_warehouse_id#1513, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_street_number#1516, w_street_name#1517, w_street_type#1518, w_suite_number#1519, w_city#1520, w_county#1521, w_state#1522, w_zip#1523, w_country#1524, w_gmt_offset#1525, i_product_name#14006, i_brand#14007, null, null, 3), List(inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, w_warehouse_sk#1512, w_warehouse_id#1513, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_street_number#1516, w_street_name#1517, w_street_type#1518, w_suite_number#1519, w_city#1520, w_county#1521, w_state#1522, w_zip#1523, w_country#1524, w_gmt_offset#1525, i_product_name#14006, null, null, null, 7), List(inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, w_warehouse_sk#1512, w_warehouse_id#1513, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_street_number#1516, w_street_name#1517, w_street_type#1518, w_suite_number#1519, w_city#1520, w_county#1521, w_state#1522, w_zip#1523, w_country#1524, w_gmt_offset#1525, null, null, null, null, 15)], [inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, ... 49 more fields]\n            +- Project [inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, ... 48 more fields]\n               +- Filter (((inv_date_sk#2868 = d_date_sk#1040) && (inv_item_sk#2865 = i_item_sk#1172)) && ((inv_warehouse_sk#2866 = w_warehouse_sk#1512) && ((d_month_seq#1043 >= 1200) && (d_month_seq#1043 <= (1200 + 11)))))\n                  +- Join Inner\n                     :- Join Inner\n                     :  :- Join Inner\n                     :  :  :- SubqueryAlias inventory\n                     :  :  :  +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n                     :  :  +- SubqueryAlias date_dim\n                     :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  +- SubqueryAlias item\n                     :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     +- SubqueryAlias warehouse\n                        +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [qoh#14003 ASC NULLS FIRST, i_product_name#14010 ASC NULLS FIRST, i_brand#14011 ASC NULLS FIRST, i_class#14012 ASC NULLS FIRST, i_category#14013 ASC NULLS FIRST], true\n      +- Aggregate [i_product_name#14010, i_brand#14011, i_class#14012, i_category#14013, spark_grouping_id#14005], [i_product_name#14010, i_brand#14011, i_class#14012, i_category#14013, avg(cast(inv_quantity_on_hand#2867 as bigint)) AS qoh#14003]\n         +- Expand [List(inv_quantity_on_hand#2867, i_product_name#1193, i_brand#1180, i_class#1182, i_category#1184, 0), List(inv_quantity_on_hand#2867, i_product_name#1193, i_brand#1180, i_class#1182, null, 1), List(inv_quantity_on_hand#2867, i_product_name#1193, i_brand#1180, null, null, 3), List(inv_quantity_on_hand#2867, i_product_name#1193, null, null, null, 7), List(inv_quantity_on_hand#2867, null, null, null, null, 15)], [inv_quantity_on_hand#2867, i_product_name#14010, i_brand#14011, i_class#14012, i_category#14013, spark_grouping_id#14005]\n            +- Project [inv_quantity_on_hand#2867, i_product_name#1193, i_brand#1180, i_class#1182, i_category#1184]\n               +- Join Inner, (inv_warehouse_sk#2866 = w_warehouse_sk#1512)\n                  :- Project [inv_warehouse_sk#2866, inv_quantity_on_hand#2867, i_brand#1180, i_class#1182, i_category#1184, i_product_name#1193]\n                  :  +- Join Inner, (inv_item_sk#2865 = i_item_sk#1172)\n                  :     :- Project [inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867]\n                  :     :  +- Join Inner, (inv_date_sk#2868 = d_date_sk#1040)\n                  :     :     :- Filter ((isnotnull(inv_date_sk#2868) && isnotnull(inv_item_sk#2865)) && isnotnull(inv_warehouse_sk#2866))\n                  :     :     :  +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n                  :     :     +- Project [d_date_sk#1040]\n                  :     :        +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                  :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :     +- Project [i_item_sk#1172, i_brand#1180, i_class#1182, i_category#1184, i_product_name#1193]\n                  :        +- Filter isnotnull(i_item_sk#1172)\n                  :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  +- Project [w_warehouse_sk#1512]\n                     +- Filter isnotnull(w_warehouse_sk#1512)\n                        +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[qoh#14003 ASC NULLS FIRST,i_product_name#14010 ASC NULLS FIRST,i_brand#14011 ASC NULLS FIRST,i_class#14012 ASC NULLS FIRST,i_category#14013 ASC NULLS FIRST], output=[i_product_name#14010,i_brand#14011,i_class#14012,i_category#14013,qoh#14003])\n+- *(5) HashAggregate(keys=[i_product_name#14010, i_brand#14011, i_class#14012, i_category#14013, spark_grouping_id#14005], functions=[avg(cast(inv_quantity_on_hand#2867 as bigint))], output=[i_product_name#14010, i_brand#14011, i_class#14012, i_category#14013, qoh#14003])\n   +- Exchange hashpartitioning(i_product_name#14010, i_brand#14011, i_class#14012, i_category#14013, spark_grouping_id#14005, 200)\n      +- *(4) HashAggregate(keys=[i_product_name#14010, i_brand#14011, i_class#14012, i_category#14013, spark_grouping_id#14005], functions=[partial_avg(cast(inv_quantity_on_hand#2867 as bigint))], output=[i_product_name#14010, i_brand#14011, i_class#14012, i_category#14013, spark_grouping_id#14005, sum#14026, count#14027L])\n         +- *(4) Expand [List(inv_quantity_on_hand#2867, i_product_name#1193, i_brand#1180, i_class#1182, i_category#1184, 0), List(inv_quantity_on_hand#2867, i_product_name#1193, i_brand#1180, i_class#1182, null, 1), List(inv_quantity_on_hand#2867, i_product_name#1193, i_brand#1180, null, null, 3), List(inv_quantity_on_hand#2867, i_product_name#1193, null, null, null, 7), List(inv_quantity_on_hand#2867, null, null, null, null, 15)], [inv_quantity_on_hand#2867, i_product_name#14010, i_brand#14011, i_class#14012, i_category#14013, spark_grouping_id#14005]\n            +- *(4) Project [inv_quantity_on_hand#2867, i_product_name#1193, i_brand#1180, i_class#1182, i_category#1184]\n               +- *(4) BroadcastHashJoin [inv_warehouse_sk#2866], [w_warehouse_sk#1512], Inner, BuildRight\n                  :- *(4) Project [inv_warehouse_sk#2866, inv_quantity_on_hand#2867, i_brand#1180, i_class#1182, i_category#1184, i_product_name#1193]\n                  :  +- *(4) BroadcastHashJoin [inv_item_sk#2865], [i_item_sk#1172], Inner, BuildRight\n                  :     :- *(4) Project [inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867]\n                  :     :  +- *(4) BroadcastHashJoin [inv_date_sk#2868], [d_date_sk#1040], Inner, BuildRight\n                  :     :     :- *(4) Project [inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868]\n                  :     :     :  +- *(4) Filter (isnotnull(inv_item_sk#2865) && isnotnull(inv_warehouse_sk#2866))\n                  :     :     :     +- *(4) FileScan parquet db_tpcds.inventory[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/inventory/inv_dat..., PartitionCount: 261, PartitionFilters: [isnotnull(inv_date_sk#2868)], PushedFilters: [IsNotNull(inv_item_sk), IsNotNull(inv_warehouse_sk)], ReadSchema: struct<inv_item_sk:int,inv_warehouse_sk:int,inv_quantity_on_hand:int>\n                  :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :        +- *(1) Project [d_date_sk#1040]\n                  :     :           +- *(1) Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                  :     :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_month_seq#1043] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>\n                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :        +- *(2) Project [i_item_sk#1172, i_brand#1180, i_class#1182, i_category#1184, i_product_name#1193]\n                  :           +- *(2) Filter isnotnull(i_item_sk#1172)\n                  :              +- *(2) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand#1180,i_class#1182,i_category#1184,i_product_name#1193] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_class:string,i_category:string,i_product_name:string>\n                  +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     +- *(3) Project [w_warehouse_sk#1512]\n                        +- *(3) Filter isnotnull(w_warehouse_sk#1512)\n                           +- *(3) FileScan parquet db_tpcds.warehouse[w_warehouse_sk#1512] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/warehouse], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int>"},{"name":"q23a-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","SortMergeJoin"],"tables":["catalog_sales","date_dim","web_sales","date_dim"],"parsingTime":0.003454,"analysisTime":9.01E-4,"optimizationTime":1850.486437,"planningTime":1303.625463,"executionTime":20933.761591,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [frequent_ss_items, max_store_sales, best_ss_customer]\n:  :- 'SubqueryAlias frequent_ss_items\n:  :  +- 'Filter ('count(1) > 4)\n:  :     +- 'Aggregate ['substr('i_item_desc, 1, 30), 'i_item_sk, 'd_date], ['substr('i_item_desc, 1, 30) AS itemdesc#14115, 'i_item_sk AS item_sk#14116, 'd_date AS solddate#14117, 'count(1) AS cnt#14118]\n:  :        +- 'Filter ((('ss_sold_date_sk = 'd_date_sk) && ('ss_item_sk = 'i_item_sk)) && 'd_year IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))\n:  :           +- 'Join Inner\n:  :              :- 'Join Inner\n:  :              :  :- 'UnresolvedRelation `store_sales`\n:  :              :  +- 'UnresolvedRelation `date_dim`\n:  :              +- 'UnresolvedRelation `item`\n:  :- 'SubqueryAlias max_store_sales\n:  :  +- 'Project ['max('csales) AS tpcds_cmax#14120]\n:  :     +- 'SubqueryAlias x\n:  :        +- 'Aggregate ['c_customer_sk], ['c_customer_sk, 'sum(('ss_quantity * 'ss_sales_price)) AS csales#14119]\n:  :           +- 'Filter ((('ss_customer_sk = 'c_customer_sk) && ('ss_sold_date_sk = 'd_date_sk)) && 'd_year IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))\n:  :              +- 'Join Inner\n:  :                 :- 'Join Inner\n:  :                 :  :- 'UnresolvedRelation `store_sales`\n:  :                 :  +- 'UnresolvedRelation `customer`\n:  :                 +- 'UnresolvedRelation `date_dim`\n:  +- 'SubqueryAlias best_ss_customer\n:     +- 'Filter ('sum(('ss_quantity * 'ss_sales_price)) > ((95 / 100.0) * scalar-subquery#14122 []))\n:        :  +- 'Project [*]\n:        :     +- 'UnresolvedRelation `max_store_sales`\n:        +- 'Aggregate ['c_customer_sk], ['c_customer_sk, 'sum(('ss_quantity * 'ss_sales_price)) AS ssales#14121]\n:           +- 'Filter ('ss_customer_sk = 'c_customer_sk)\n:              +- 'Join Inner\n:                 :- 'UnresolvedRelation `store_sales`\n:                 +- 'UnresolvedRelation `customer`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Project [unresolvedalias('sum('sales), None)]\n         +- 'SubqueryAlias x\n            +- 'Union\n               :- 'Project [('cs_quantity * 'cs_list_price) AS sales#14109]\n               :  +- 'Filter (((('d_year = 2000) && ('d_moy = 2)) && ('cs_sold_date_sk = 'd_date_sk)) && ('cs_item_sk IN (list#14110 []) && 'cs_bill_customer_sk IN (list#14111 [])))\n               :     :  :- 'Project ['item_sk]\n               :     :  :  +- 'UnresolvedRelation `frequent_ss_items`\n               :     :  +- 'Project ['c_customer_sk]\n               :     :     +- 'UnresolvedRelation `best_ss_customer`\n               :     +- 'Join Inner\n               :        :- 'UnresolvedRelation `catalog_sales`\n               :        +- 'UnresolvedRelation `date_dim`\n               +- 'Project [('ws_quantity * 'ws_list_price) AS sales#14112]\n                  +- 'Filter (((('d_year = 2000) && ('d_moy = 2)) && ('ws_sold_date_sk = 'd_date_sk)) && ('ws_item_sk IN (list#14113 []) && 'ws_bill_customer_sk IN (list#14114 [])))\n                     :  :- 'Project ['item_sk]\n                     :  :  +- 'UnresolvedRelation `frequent_ss_items`\n                     :  +- 'Project ['c_customer_sk]\n                     :     +- 'UnresolvedRelation `best_ss_customer`\n                     +- 'Join Inner\n                        :- 'UnresolvedRelation `web_sales`\n                        +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nsum(sales): decimal(28,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Aggregate [sum(sales#14109) AS sum(sales)#14144]\n      +- SubqueryAlias x\n         +- Union\n            :- Project [CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)) AS sales#14109]\n            :  +- Filter ((((d_year#1046 = 2000) && (d_moy#1048 = 2)) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && (cs_item_sk#1803 IN (list#14110 []) && cs_bill_customer_sk#1791 IN (list#14111 [])))\n            :     :  :- Project [item_sk#14116]\n            :     :  :  +- SubqueryAlias frequent_ss_items\n            :     :  :     +- Project [itemdesc#14115, item_sk#14116, solddate#14117, cnt#14118L]\n            :     :  :        +- Filter (count(1)#14126L > cast(4 as bigint))\n            :     :  :           +- Aggregate [substring(i_item_desc#1176, 1, 30), i_item_sk#1172, d_date#1042], [substring(i_item_desc#1176, 1, 30) AS itemdesc#14115, i_item_sk#1172 AS item_sk#14116, d_date#1042 AS solddate#14117, count(1) AS cnt#14118L, count(1) AS count(1)#14126L]\n            :     :  :              +- Filter (((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_item_sk#1905 = i_item_sk#1172)) && d_year#1046 IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))\n            :     :  :                 +- Join Inner\n            :     :  :                    :- Join Inner\n            :     :  :                    :  :- SubqueryAlias store_sales\n            :     :  :                    :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :  :                    :  +- SubqueryAlias date_dim\n            :     :  :                    :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :  :                    +- SubqueryAlias item\n            :     :  :                       +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :     :  +- Project [c_customer_sk#860]\n            :     :     +- SubqueryAlias best_ss_customer\n            :     :        +- Project [c_customer_sk#860, ssales#14121]\n            :     :           +- Filter (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133 as decimal(38,8)) > cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cast(95 as decimal(2,0)) as decimal(4,1))) / promote_precision(cast(100.0 as decimal(4,1)))), DecimalType(9,6)) as decimal(32,6))) * promote_precision(cast(scalar-subquery#14122 [] as decimal(32,6)))), DecimalType(38,8)) as decimal(38,8)))\n            :     :              :  +- Project [tpcds_cmax#14120]\n            :     :              :     +- SubqueryAlias max_store_sales\n            :     :              :        +- Aggregate [max(csales#14119) AS tpcds_cmax#14120]\n            :     :              :           +- SubqueryAlias x\n            :     :              :              +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS csales#14119]\n            :     :              :                 +- Filter (((ss_customer_sk#1906 = c_customer_sk#860) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && d_year#1046 IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))\n            :     :              :                    +- Join Inner\n            :     :              :                       :- Join Inner\n            :     :              :                       :  :- SubqueryAlias store_sales\n            :     :              :                       :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :              :                       :  +- SubqueryAlias customer\n            :     :              :                       :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :     :              :                       +- SubqueryAlias date_dim\n            :     :              :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :              +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS ssales#14121, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133]\n            :     :                 +- Filter (ss_customer_sk#1906 = c_customer_sk#860)\n            :     :                    +- Join Inner\n            :     :                       :- SubqueryAlias store_sales\n            :     :                       :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :                       +- SubqueryAlias customer\n            :     :                          +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :     +- Join Inner\n            :        :- SubqueryAlias catalog_sales\n            :        :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :        +- SubqueryAlias date_dim\n            :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Project [CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)) AS sales#14112]\n               +- Filter ((((d_year#1046 = 2000) && (d_moy#1048 = 2)) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && (ws_item_sk#1757 IN (list#14113 []) && ws_bill_customer_sk#1758 IN (list#14114 [])))\n                  :  :- Project [item_sk#14116]\n                  :  :  +- SubqueryAlias frequent_ss_items\n                  :  :     +- Project [itemdesc#14115, item_sk#14116, solddate#14117, cnt#14118L]\n                  :  :        +- Filter (count(1)#14126L > cast(4 as bigint))\n                  :  :           +- Aggregate [substring(i_item_desc#1176, 1, 30), i_item_sk#1172, d_date#1042], [substring(i_item_desc#1176, 1, 30) AS itemdesc#14115, i_item_sk#1172 AS item_sk#14116, d_date#1042 AS solddate#14117, count(1) AS cnt#14118L, count(1) AS count(1)#14126L]\n                  :  :              +- Filter (((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_item_sk#1905 = i_item_sk#1172)) && d_year#1046 IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))\n                  :  :                 +- Join Inner\n                  :  :                    :- Join Inner\n                  :  :                    :  :- SubqueryAlias store_sales\n                  :  :                    :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :  :                    :  +- SubqueryAlias date_dim\n                  :  :                    :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :  :                    +- SubqueryAlias item\n                  :  :                       +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  :  +- Project [c_customer_sk#860]\n                  :     +- SubqueryAlias best_ss_customer\n                  :        +- Project [c_customer_sk#860, ssales#14121]\n                  :           +- Filter (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133 as decimal(38,8)) > cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cast(95 as decimal(2,0)) as decimal(4,1))) / promote_precision(cast(100.0 as decimal(4,1)))), DecimalType(9,6)) as decimal(32,6))) * promote_precision(cast(scalar-subquery#14122 [] as decimal(32,6)))), DecimalType(38,8)) as decimal(38,8)))\n                  :              :  +- Project [tpcds_cmax#14120]\n                  :              :     +- SubqueryAlias max_store_sales\n                  :              :        +- Aggregate [max(csales#14119) AS tpcds_cmax#14120]\n                  :              :           +- SubqueryAlias x\n                  :              :              +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS csales#14119]\n                  :              :                 +- Filter (((ss_customer_sk#1906 = c_customer_sk#860) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && d_year#1046 IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))\n                  :              :                    +- Join Inner\n                  :              :                       :- Join Inner\n                  :              :                       :  :- SubqueryAlias store_sales\n                  :              :                       :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :              :                       :  +- SubqueryAlias customer\n                  :              :                       :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :              :                       +- SubqueryAlias date_dim\n                  :              :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :              +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS ssales#14121, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133]\n                  :                 +- Filter (ss_customer_sk#1906 = c_customer_sk#860)\n                  :                    +- Join Inner\n                  :                       :- SubqueryAlias store_sales\n                  :                       :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :                       +- SubqueryAlias customer\n                  :                          +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  +- Join Inner\n                     :- SubqueryAlias web_sales\n                     :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     +- SubqueryAlias date_dim\n                        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Aggregate [sum(sales#14109) AS sum(sales)#14144]\n      +- Union\n         :- Project [CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)) AS sales#14109]\n         :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n         :     :- Project [cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n         :     :  +- Join LeftSemi, (cs_bill_customer_sk#1791 = c_customer_sk#860)\n         :     :     :- Project [cs_bill_customer_sk#1791, cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n         :     :     :  +- Join LeftSemi, (cs_item_sk#1803 = item_sk#14116)\n         :     :     :     :- Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n         :     :     :     :  +- Filter isnotnull(cs_sold_date_sk#1822)\n         :     :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n         :     :     :     +- Project [item_sk#14116]\n         :     :     :        +- Filter (count(1)#14126L > 4)\n         :     :     :           +- Aggregate [substring(i_item_desc#1176, 1, 30), i_item_sk#1172, d_date#1042], [i_item_sk#1172 AS item_sk#14116, count(1) AS count(1)#14126L]\n         :     :     :              +- Project [d_date#1042, i_item_sk#1172, i_item_desc#1176]\n         :     :     :                 +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n         :     :     :                    :- Project [ss_item_sk#1905, d_date#1042]\n         :     :     :                    :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n         :     :     :                    :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n         :     :     :                    :     :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_item_sk#1905))\n         :     :     :                    :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :     :     :                    :     +- Project [d_date_sk#1040, d_date#1042]\n         :     :     :                    :        +- Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n         :     :     :                    :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :     :     :                    +- Project [i_item_sk#1172, i_item_desc#1176]\n         :     :     :                       +- Filter isnotnull(i_item_sk#1172)\n         :     :     :                          +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :     :     +- Project [c_customer_sk#860]\n         :     :        +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133 as decimal(38,8)) > CheckOverflow((0.950000 * promote_precision(cast(scalar-subquery#14122 [] as decimal(32,6)))), DecimalType(38,8))))\n         :     :           :  +- Aggregate [max(csales#14119) AS tpcds_cmax#14120]\n         :     :           :     +- Aggregate [c_customer_sk#860], [sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS csales#14119]\n         :     :           :        +- Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n         :     :           :           +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n         :     :           :              :- Project [ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926, c_customer_sk#860]\n         :     :           :              :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n         :     :           :              :     :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926]\n         :     :           :              :     :  +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n         :     :           :              :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :     :           :              :     +- Project [c_customer_sk#860]\n         :     :           :              :        +- Filter isnotnull(c_customer_sk#860)\n         :     :           :              :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n         :     :           :              +- Project [d_date_sk#1040]\n         :     :           :                 +- Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n         :     :           :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :     :           +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133]\n         :     :              +- Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n         :     :                 +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n         :     :                    :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916]\n         :     :                    :  +- Filter isnotnull(ss_customer_sk#1906)\n         :     :                    :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :     :                    +- Project [c_customer_sk#860]\n         :     :                       +- Filter isnotnull(c_customer_sk#860)\n         :     :                          +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n         :     +- Project [d_date_sk#1040]\n         :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2000)) && (d_moy#1048 = 2)) && isnotnull(d_date_sk#1040))\n         :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         +- Project [CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)) AS sales#14112]\n            +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n               :- Project [ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n               :  +- Join LeftSemi, (ws_bill_customer_sk#1758 = c_customer_sk#860)\n               :     :- Project [ws_bill_customer_sk#1758, ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n               :     :  +- Join LeftSemi, (ws_item_sk#1757 = item_sk#14116)\n               :     :     :- Project [ws_item_sk#1757, ws_bill_customer_sk#1758, ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n               :     :     :  +- Filter isnotnull(ws_sold_date_sk#1788)\n               :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :     +- Project [item_sk#14116]\n               :     :        +- Filter (count(1)#14126L > 4)\n               :     :           +- Aggregate [substring(i_item_desc#1176, 1, 30), i_item_sk#1172, d_date#1042], [i_item_sk#1172 AS item_sk#14116, count(1) AS count(1)#14126L]\n               :     :              +- Project [d_date#1042, i_item_sk#1172, i_item_desc#1176]\n               :     :                 +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :     :                    :- Project [ss_item_sk#1905, d_date#1042]\n               :     :                    :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :     :                    :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n               :     :                    :     :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_item_sk#1905))\n               :     :                    :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :                    :     +- Project [d_date_sk#1040, d_date#1042]\n               :     :                    :        +- Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n               :     :                    :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :                    +- Project [i_item_sk#1172, i_item_desc#1176]\n               :     :                       +- Filter isnotnull(i_item_sk#1172)\n               :     :                          +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :     +- Project [c_customer_sk#860]\n               :        +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133 as decimal(38,8)) > CheckOverflow((0.950000 * promote_precision(cast(scalar-subquery#14122 [] as decimal(32,6)))), DecimalType(38,8))))\n               :           :  +- Aggregate [max(csales#14119) AS tpcds_cmax#14120]\n               :           :     +- Aggregate [c_customer_sk#860], [sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS csales#14119]\n               :           :        +- Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n               :           :           +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :           :              :- Project [ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926, c_customer_sk#860]\n               :           :              :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n               :           :              :     :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926]\n               :           :              :     :  +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n               :           :              :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :           :              :     +- Project [c_customer_sk#860]\n               :           :              :        +- Filter isnotnull(c_customer_sk#860)\n               :           :              :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :           :              +- Project [d_date_sk#1040]\n               :           :                 +- Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n               :           :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :           +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133]\n               :              +- Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n               :                 +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n               :                    :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916]\n               :                    :  +- Filter isnotnull(ss_customer_sk#1906)\n               :                    :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :                    +- Project [c_customer_sk#860]\n               :                       +- Filter isnotnull(c_customer_sk#860)\n               :                          +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               +- Project [d_date_sk#1040]\n                  +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2000)) && (d_moy#1048 = 2)) && isnotnull(d_date_sk#1040))\n                     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nCollectLimit 100\n+- *(30) LocalLimit 100\n   +- *(30) HashAggregate(keys=[], functions=[sum(sales#14109)], output=[sum(sales)#14144])\n      +- Exchange SinglePartition\n         +- *(29) HashAggregate(keys=[], functions=[partial_sum(sales#14109)], output=[sum#14147])\n            +- Union\n               :- *(14) Project [CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)) AS sales#14109]\n               :  +- *(14) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :     :- *(14) Project [cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n               :     :  +- SortMergeJoin [cs_bill_customer_sk#1791], [c_customer_sk#860], LeftSemi\n               :     :     :- *(9) Sort [cs_bill_customer_sk#1791 ASC NULLS FIRST], false, 0\n               :     :     :  +- Exchange hashpartitioning(cs_bill_customer_sk#1791, 200)\n               :     :     :     +- *(8) Project [cs_bill_customer_sk#1791, cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n               :     :     :        +- SortMergeJoin [cs_item_sk#1803], [item_sk#14116], LeftSemi\n               :     :     :           :- *(2) Sort [cs_item_sk#1803 ASC NULLS FIRST], false, 0\n               :     :     :           :  +- Exchange hashpartitioning(cs_item_sk#1803, 200)\n               :     :     :           :     +- *(1) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_item_sk#1803,cs_quantity#1806,cs_list_price#1808,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_bill_customer_sk:int,cs_item_sk:int,cs_quantity:int,cs_list_price:decimal(7,2)>\n               :     :     :           +- *(7) Sort [item_sk#14116 ASC NULLS FIRST], false, 0\n               :     :     :              +- Exchange hashpartitioning(item_sk#14116, 200)\n               :     :     :                 +- *(6) Project [item_sk#14116]\n               :     :     :                    +- *(6) Filter (count(1)#14126L > 4)\n               :     :     :                       +- *(6) HashAggregate(keys=[substring(i_item_desc#1176, 1, 30)#14148, i_item_sk#1172, d_date#1042], functions=[count(1)], output=[item_sk#14116, count(1)#14126L])\n               :     :     :                          +- Exchange hashpartitioning(substring(i_item_desc#1176, 1, 30)#14148, i_item_sk#1172, d_date#1042, 200)\n               :     :     :                             +- *(5) HashAggregate(keys=[substring(i_item_desc#1176, 1, 30) AS substring(i_item_desc#1176, 1, 30)#14148, i_item_sk#1172, d_date#1042], functions=[partial_count(1)], output=[substring(i_item_desc#1176, 1, 30)#14148, i_item_sk#1172, d_date#1042, count#14150L])\n               :     :     :                                +- *(5) Project [d_date#1042, i_item_sk#1172, i_item_desc#1176]\n               :     :     :                                   +- *(5) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :     :     :                                      :- *(5) Project [ss_item_sk#1905, d_date#1042]\n               :     :     :                                      :  +- *(5) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :     :                                      :     :- *(5) Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n               :     :     :                                      :     :  +- *(5) Filter isnotnull(ss_item_sk#1905)\n               :     :     :                                      :     :     +- *(5) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int>\n               :     :     :                                      :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :                                      :        +- *(3) Project [d_date_sk#1040, d_date#1042]\n               :     :     :                                      :           +- *(3) Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n               :     :     :                                      :              +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [In(d_year, [2000,2001,2002,2003]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_date:date,d_year:int>\n               :     :     :                                      +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :                                         +- *(4) Project [i_item_sk#1172, i_item_desc#1176]\n               :     :     :                                            +- *(4) Filter isnotnull(i_item_sk#1172)\n               :     :     :                                               +- *(4) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_desc#1176] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_desc:string>\n               :     :     +- *(12) Sort [c_customer_sk#860 ASC NULLS FIRST], false, 0\n               :     :        +- *(12) Project [c_customer_sk#860]\n               :     :           +- *(12) Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133 as decimal(38,8)) > CheckOverflow((0.950000 * promote_precision(cast(Subquery subquery14122 as decimal(32,6)))), DecimalType(38,8))))\n               :     :              :  +- Subquery subquery14122\n               :     :              :     +- *(5) HashAggregate(keys=[], functions=[max(csales#14119)], output=[tpcds_cmax#14120])\n               :     :              :        +- Exchange SinglePartition\n               :     :              :           +- *(4) HashAggregate(keys=[], functions=[partial_max(csales#14119)], output=[max#14155])\n               :     :              :              +- *(4) HashAggregate(keys=[c_customer_sk#860], functions=[sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))], output=[csales#14119])\n               :     :              :                 +- Exchange hashpartitioning(c_customer_sk#860, 200)\n               :     :              :                    +- *(3) HashAggregate(keys=[c_customer_sk#860], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))], output=[c_customer_sk#860, sum#14157])\n               :     :              :                       +- *(3) Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n               :     :              :                          +- *(3) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :              :                             :- *(3) Project [ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926, c_customer_sk#860]\n               :     :              :                             :  +- *(3) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n               :     :              :                             :     :- *(3) Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926]\n               :     :              :                             :     :  +- *(3) Filter isnotnull(ss_customer_sk#1906)\n               :     :              :                             :     :     +- *(3) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_quantity#1913,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_quantity:int,ss_sales_price:decimal(7,2)>\n               :     :              :                             :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :              :                             :        +- *(1) Project [c_customer_sk#860]\n               :     :              :                             :           +- *(1) Filter isnotnull(c_customer_sk#860)\n               :     :              :                             :              +- *(1) FileScan parquet db_tpcds.customer[c_customer_sk#860] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int>\n               :     :              :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :              :                                +- *(2) Project [d_date_sk#1040]\n               :     :              :                                   +- *(2) Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n               :     :              :                                      +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [In(d_year, [2000,2001,2002,2003]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n               :     :              +- *(12) HashAggregate(keys=[c_customer_sk#860], functions=[sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))], output=[c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133])\n               :     :                 +- Exchange hashpartitioning(c_customer_sk#860, 200)\n               :     :                    +- *(11) HashAggregate(keys=[c_customer_sk#860], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))], output=[c_customer_sk#860, sum#14152])\n               :     :                       +- *(11) Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n               :     :                          +- *(11) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n               :     :                             :- *(11) Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916]\n               :     :                             :  +- *(11) Filter isnotnull(ss_customer_sk#1906)\n               :     :                             :     +- *(11) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_quantity#1913,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_quantity:int,ss_sales_price:decimal(7,2)>\n               :     :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :                                +- *(10) Project [c_customer_sk#860]\n               :     :                                   +- *(10) Filter isnotnull(c_customer_sk#860)\n               :     :                                      +- *(10) FileScan parquet db_tpcds.customer[c_customer_sk#860] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int>\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(13) Project [d_date_sk#1040]\n               :           +- *(13) Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2000)) && (d_moy#1048 = 2)) && isnotnull(d_date_sk#1040))\n               :              +- *(13) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,2), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               +- *(28) Project [CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)) AS sales#14112]\n                  +- *(28) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                     :- *(28) Project [ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n                     :  +- SortMergeJoin [ws_bill_customer_sk#1758], [c_customer_sk#860], LeftSemi\n                     :     :- *(23) Sort [ws_bill_customer_sk#1758 ASC NULLS FIRST], false, 0\n                     :     :  +- Exchange hashpartitioning(ws_bill_customer_sk#1758, 200)\n                     :     :     +- *(22) Project [ws_bill_customer_sk#1758, ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n                     :     :        +- SortMergeJoin [ws_item_sk#1757], [item_sk#14116], LeftSemi\n                     :     :           :- *(16) Sort [ws_item_sk#1757 ASC NULLS FIRST], false, 0\n                     :     :           :  +- Exchange hashpartitioning(ws_item_sk#1757, 200)\n                     :     :           :     +- *(15) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_bill_customer_sk#1758,ws_quantity#1772,ws_list_price#1774,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [], ReadSchema: struct<ws_item_sk:int,ws_bill_customer_sk:int,ws_quantity:int,ws_list_price:decimal(7,2)>\n                     :     :           +- *(21) Sort [item_sk#14116 ASC NULLS FIRST], false, 0\n                     :     :              +- ReusedExchange [item_sk#14116], Exchange hashpartitioning(item_sk#14116, 200)\n                     :     +- *(26) Sort [c_customer_sk#860 ASC NULLS FIRST], false, 0\n                     :        +- *(26) Project [c_customer_sk#860]\n                     :           +- *(26) Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133 as decimal(38,8)) > CheckOverflow((0.950000 * promote_precision(cast(Subquery subquery14122 as decimal(32,6)))), DecimalType(38,8))))\n                     :              :  +- Subquery subquery14122\n                     :              :     +- *(5) HashAggregate(keys=[], functions=[max(csales#14119)], output=[tpcds_cmax#14120])\n                     :              :        +- Exchange SinglePartition\n                     :              :           +- *(4) HashAggregate(keys=[], functions=[partial_max(csales#14119)], output=[max#14155])\n                     :              :              +- *(4) HashAggregate(keys=[c_customer_sk#860], functions=[sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))], output=[csales#14119])\n                     :              :                 +- Exchange hashpartitioning(c_customer_sk#860, 200)\n                     :              :                    +- *(3) HashAggregate(keys=[c_customer_sk#860], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))], output=[c_customer_sk#860, sum#14157])\n                     :              :                       +- *(3) Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n                     :              :                          +- *(3) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                     :              :                             :- *(3) Project [ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926, c_customer_sk#860]\n                     :              :                             :  +- *(3) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n                     :              :                             :     :- *(3) Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926]\n                     :              :                             :     :  +- *(3) Filter isnotnull(ss_customer_sk#1906)\n                     :              :                             :     :     +- *(3) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_quantity#1913,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_quantity:int,ss_sales_price:decimal(7,2)>\n                     :              :                             :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :              :                             :        +- *(1) Project [c_customer_sk#860]\n                     :              :                             :           +- *(1) Filter isnotnull(c_customer_sk#860)\n                     :              :                             :              +- *(1) FileScan parquet db_tpcds.customer[c_customer_sk#860] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int>\n                     :              :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :              :                                +- *(2) Project [d_date_sk#1040]\n                     :              :                                   +- *(2) Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n                     :              :                                      +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [In(d_year, [2000,2001,2002,2003]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n                     :              +- *(26) HashAggregate(keys=[c_customer_sk#860], functions=[sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))], output=[c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14133])\n                     :                 +- ReusedExchange [c_customer_sk#860, sum#14152], Exchange hashpartitioning(c_customer_sk#860, 200)\n                     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q23b-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","SortMergeJoin"],"tables":["catalog_sales","customer","date_dim","web_sales","customer","date_dim"],"parsingTime":0.002232,"analysisTime":7.49E-4,"optimizationTime":1512.821913,"planningTime":2000.443588,"executionTime":20155.832499,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [frequent_ss_items, max_store_sales, best_ss_customer]\n:  :- 'SubqueryAlias frequent_ss_items\n:  :  +- 'Filter ('count(1) > 4)\n:  :     +- 'Aggregate ['substr('i_item_desc, 1, 30), 'i_item_sk, 'd_date], ['substr('i_item_desc, 1, 30) AS itemdesc#14277, 'i_item_sk AS item_sk#14278, 'd_date AS solddate#14279, 'count(1) AS cnt#14280]\n:  :        +- 'Filter ((('ss_sold_date_sk = 'd_date_sk) && ('ss_item_sk = 'i_item_sk)) && 'd_year IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))\n:  :           +- 'Join Inner\n:  :              :- 'Join Inner\n:  :              :  :- 'UnresolvedRelation `store_sales`\n:  :              :  +- 'UnresolvedRelation `date_dim`\n:  :              +- 'UnresolvedRelation `item`\n:  :- 'SubqueryAlias max_store_sales\n:  :  +- 'Project ['max('csales) AS tpcds_cmax#14282]\n:  :     +- 'SubqueryAlias x\n:  :        +- 'Aggregate ['c_customer_sk], ['c_customer_sk, 'sum(('ss_quantity * 'ss_sales_price)) AS csales#14281]\n:  :           +- 'Filter ((('ss_customer_sk = 'c_customer_sk) && ('ss_sold_date_sk = 'd_date_sk)) && 'd_year IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))\n:  :              +- 'Join Inner\n:  :                 :- 'Join Inner\n:  :                 :  :- 'UnresolvedRelation `store_sales`\n:  :                 :  +- 'UnresolvedRelation `customer`\n:  :                 +- 'UnresolvedRelation `date_dim`\n:  +- 'SubqueryAlias best_ss_customer\n:     +- 'Filter ('sum(('ss_quantity * 'ss_sales_price)) > ((95 / 100.0) * scalar-subquery#14284 []))\n:        :  +- 'Project [*]\n:        :     +- 'UnresolvedRelation `max_store_sales`\n:        +- 'Aggregate ['c_customer_sk], ['c_customer_sk, 'sum(('ss_quantity * 'ss_sales_price)) AS ssales#14283]\n:           +- 'Filter ('ss_customer_sk = 'c_customer_sk)\n:              +- 'Join Inner\n:                 :- 'UnresolvedRelation `store_sales`\n:                 +- 'UnresolvedRelation `customer`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['c_last_name ASC NULLS FIRST, 'c_first_name ASC NULLS FIRST, 'sales ASC NULLS FIRST], true\n         +- 'Project ['c_last_name, 'c_first_name, 'sales]\n            +- 'SubqueryAlias y\n               +- 'Union\n                  :- 'Aggregate ['c_last_name, 'c_first_name], ['c_last_name, 'c_first_name, 'sum(('cs_quantity * 'cs_list_price)) AS sales#14271]\n                  :  +- 'Filter (((('d_year = 2000) && ('d_moy = 2)) && ('cs_sold_date_sk = 'd_date_sk)) && (('cs_item_sk IN (list#14272 []) && 'cs_bill_customer_sk IN (list#14273 [])) && ('cs_bill_customer_sk = 'c_customer_sk)))\n                  :     :  :- 'Project ['item_sk]\n                  :     :  :  +- 'UnresolvedRelation `frequent_ss_items`\n                  :     :  +- 'Project ['c_customer_sk]\n                  :     :     +- 'UnresolvedRelation `best_ss_customer`\n                  :     +- 'Join Inner\n                  :        :- 'Join Inner\n                  :        :  :- 'UnresolvedRelation `catalog_sales`\n                  :        :  +- 'UnresolvedRelation `customer`\n                  :        +- 'UnresolvedRelation `date_dim`\n                  +- 'Aggregate ['c_last_name, 'c_first_name], ['c_last_name, 'c_first_name, 'sum(('ws_quantity * 'ws_list_price)) AS sales#14274]\n                     +- 'Filter (((('d_year = 2000) && ('d_moy = 2)) && ('ws_sold_date_sk = 'd_date_sk)) && (('ws_item_sk IN (list#14275 []) && 'ws_bill_customer_sk IN (list#14276 [])) && ('ws_bill_customer_sk = 'c_customer_sk)))\n                        :  :- 'Project ['item_sk]\n                        :  :  +- 'UnresolvedRelation `frequent_ss_items`\n                        :  +- 'Project ['c_customer_sk]\n                        :     +- 'UnresolvedRelation `best_ss_customer`\n                        +- 'Join Inner\n                           :- 'Join Inner\n                           :  :- 'UnresolvedRelation `web_sales`\n                           :  +- 'UnresolvedRelation `customer`\n                           +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nc_last_name: string, c_first_name: string, sales: decimal(28,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [c_last_name#869 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, sales#14271 ASC NULLS FIRST], true\n      +- Project [c_last_name#869, c_first_name#868, sales#14271]\n         +- SubqueryAlias y\n            +- Union\n               :- Aggregate [c_last_name#869, c_first_name#868], [c_last_name#869, c_first_name#868, sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2))) AS sales#14271]\n               :  +- Filter ((((d_year#1046 = 2000) && (d_moy#1048 = 2)) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && ((cs_item_sk#1803 IN (list#14272 []) && cs_bill_customer_sk#1791 IN (list#14273 [])) && (cs_bill_customer_sk#1791 = c_customer_sk#860)))\n               :     :  :- Project [item_sk#14278]\n               :     :  :  +- SubqueryAlias frequent_ss_items\n               :     :  :     +- Project [itemdesc#14277, item_sk#14278, solddate#14279, cnt#14280L]\n               :     :  :        +- Filter (count(1)#14288L > cast(4 as bigint))\n               :     :  :           +- Aggregate [substring(i_item_desc#1176, 1, 30), i_item_sk#1172, d_date#1042], [substring(i_item_desc#1176, 1, 30) AS itemdesc#14277, i_item_sk#1172 AS item_sk#14278, d_date#1042 AS solddate#14279, count(1) AS cnt#14280L, count(1) AS count(1)#14288L]\n               :     :  :              +- Filter (((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_item_sk#1905 = i_item_sk#1172)) && d_year#1046 IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))\n               :     :  :                 +- Join Inner\n               :     :  :                    :- Join Inner\n               :     :  :                    :  :- SubqueryAlias store_sales\n               :     :  :                    :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :  :                    :  +- SubqueryAlias date_dim\n               :     :  :                    :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :  :                    +- SubqueryAlias item\n               :     :  :                       +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :     :  +- Project [c_customer_sk#860]\n               :     :     +- SubqueryAlias best_ss_customer\n               :     :        +- Project [c_customer_sk#860, ssales#14283]\n               :     :           +- Filter (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295 as decimal(38,8)) > cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cast(95 as decimal(2,0)) as decimal(4,1))) / promote_precision(cast(100.0 as decimal(4,1)))), DecimalType(9,6)) as decimal(32,6))) * promote_precision(cast(scalar-subquery#14284 [] as decimal(32,6)))), DecimalType(38,8)) as decimal(38,8)))\n               :     :              :  +- Project [tpcds_cmax#14282]\n               :     :              :     +- SubqueryAlias max_store_sales\n               :     :              :        +- Aggregate [max(csales#14281) AS tpcds_cmax#14282]\n               :     :              :           +- SubqueryAlias x\n               :     :              :              +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS csales#14281]\n               :     :              :                 +- Filter (((ss_customer_sk#1906 = c_customer_sk#860) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && d_year#1046 IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))\n               :     :              :                    +- Join Inner\n               :     :              :                       :- Join Inner\n               :     :              :                       :  :- SubqueryAlias store_sales\n               :     :              :                       :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :              :                       :  +- SubqueryAlias customer\n               :     :              :                       :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :     :              :                       +- SubqueryAlias date_dim\n               :     :              :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :              +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS ssales#14283, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295]\n               :     :                 +- Filter (ss_customer_sk#1906 = c_customer_sk#860)\n               :     :                    +- Join Inner\n               :     :                       :- SubqueryAlias store_sales\n               :     :                       :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :                       +- SubqueryAlias customer\n               :     :                          +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :     +- Join Inner\n               :        :- Join Inner\n               :        :  :- SubqueryAlias catalog_sales\n               :        :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :        :  +- SubqueryAlias customer\n               :        :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :        +- SubqueryAlias date_dim\n               :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- Aggregate [c_last_name#869, c_first_name#868], [c_last_name#869, c_first_name#868, sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2))) AS sales#14274]\n                  +- Filter ((((d_year#1046 = 2000) && (d_moy#1048 = 2)) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && ((ws_item_sk#1757 IN (list#14275 []) && ws_bill_customer_sk#1758 IN (list#14276 [])) && (ws_bill_customer_sk#1758 = c_customer_sk#860)))\n                     :  :- Project [item_sk#14278]\n                     :  :  +- SubqueryAlias frequent_ss_items\n                     :  :     +- Project [itemdesc#14277, item_sk#14278, solddate#14279, cnt#14280L]\n                     :  :        +- Filter (count(1)#14288L > cast(4 as bigint))\n                     :  :           +- Aggregate [substring(i_item_desc#1176, 1, 30), i_item_sk#1172, d_date#1042], [substring(i_item_desc#1176, 1, 30) AS itemdesc#14277, i_item_sk#1172 AS item_sk#14278, d_date#1042 AS solddate#14279, count(1) AS cnt#14280L, count(1) AS count(1)#14288L]\n                     :  :              +- Filter (((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_item_sk#1905 = i_item_sk#1172)) && d_year#1046 IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))\n                     :  :                 +- Join Inner\n                     :  :                    :- Join Inner\n                     :  :                    :  :- SubqueryAlias store_sales\n                     :  :                    :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :  :                    :  +- SubqueryAlias date_dim\n                     :  :                    :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  :                    +- SubqueryAlias item\n                     :  :                       +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :  +- Project [c_customer_sk#860]\n                     :     +- SubqueryAlias best_ss_customer\n                     :        +- Project [c_customer_sk#860, ssales#14283]\n                     :           +- Filter (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295 as decimal(38,8)) > cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cast(95 as decimal(2,0)) as decimal(4,1))) / promote_precision(cast(100.0 as decimal(4,1)))), DecimalType(9,6)) as decimal(32,6))) * promote_precision(cast(scalar-subquery#14284 [] as decimal(32,6)))), DecimalType(38,8)) as decimal(38,8)))\n                     :              :  +- Project [tpcds_cmax#14282]\n                     :              :     +- SubqueryAlias max_store_sales\n                     :              :        +- Aggregate [max(csales#14281) AS tpcds_cmax#14282]\n                     :              :           +- SubqueryAlias x\n                     :              :              +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS csales#14281]\n                     :              :                 +- Filter (((ss_customer_sk#1906 = c_customer_sk#860) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && d_year#1046 IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))\n                     :              :                    +- Join Inner\n                     :              :                       :- Join Inner\n                     :              :                       :  :- SubqueryAlias store_sales\n                     :              :                       :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :              :                       :  +- SubqueryAlias customer\n                     :              :                       :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                     :              :                       +- SubqueryAlias date_dim\n                     :              :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :              +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS ssales#14283, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295]\n                     :                 +- Filter (ss_customer_sk#1906 = c_customer_sk#860)\n                     :                    +- Join Inner\n                     :                       :- SubqueryAlias store_sales\n                     :                       :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :                       +- SubqueryAlias customer\n                     :                          +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                     +- Join Inner\n                        :- Join Inner\n                        :  :- SubqueryAlias web_sales\n                        :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        :  +- SubqueryAlias customer\n                        :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                        +- SubqueryAlias date_dim\n                           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [c_last_name#869 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, sales#14271 ASC NULLS FIRST], true\n      +- Union\n         :- Aggregate [c_last_name#869, c_first_name#868], [c_last_name#869, c_first_name#868, sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2))) AS sales#14271]\n         :  +- Project [cs_quantity#1806, cs_list_price#1808, c_first_name#868, c_last_name#869]\n         :     +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n         :        :- Project [cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822, c_first_name#868, c_last_name#869]\n         :        :  +- Join Inner, (cs_bill_customer_sk#1791 = c_customer_sk#860)\n         :        :     :- Join LeftSemi, (cs_bill_customer_sk#1791 = c_customer_sk#860#14310)\n         :        :     :  :- Project [cs_bill_customer_sk#1791, cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n         :        :     :  :  +- Join LeftSemi, (cs_item_sk#1803 = item_sk#14278)\n         :        :     :  :     :- Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n         :        :     :  :     :  +- Filter (isnotnull(cs_bill_customer_sk#1791) && isnotnull(cs_sold_date_sk#1822))\n         :        :     :  :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n         :        :     :  :     +- Project [item_sk#14278]\n         :        :     :  :        +- Filter (count(1)#14288L > 4)\n         :        :     :  :           +- Aggregate [substring(i_item_desc#1176, 1, 30), i_item_sk#1172, d_date#1042], [i_item_sk#1172 AS item_sk#14278, count(1) AS count(1)#14288L]\n         :        :     :  :              +- Project [d_date#1042, i_item_sk#1172, i_item_desc#1176]\n         :        :     :  :                 +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n         :        :     :  :                    :- Project [ss_item_sk#1905, d_date#1042]\n         :        :     :  :                    :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n         :        :     :  :                    :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n         :        :     :  :                    :     :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_item_sk#1905))\n         :        :     :  :                    :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :        :     :  :                    :     +- Project [d_date_sk#1040, d_date#1042]\n         :        :     :  :                    :        +- Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n         :        :     :  :                    :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :        :     :  :                    +- Project [i_item_sk#1172, i_item_desc#1176]\n         :        :     :  :                       +- Filter isnotnull(i_item_sk#1172)\n         :        :     :  :                          +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :        :     :  +- Project [c_customer_sk#860 AS c_customer_sk#860#14310]\n         :        :     :     +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295 as decimal(38,8)) > CheckOverflow((0.950000 * promote_precision(cast(scalar-subquery#14284 [] as decimal(32,6)))), DecimalType(38,8))))\n         :        :     :        :  +- Aggregate [max(csales#14281) AS tpcds_cmax#14282]\n         :        :     :        :     +- Aggregate [c_customer_sk#860], [sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS csales#14281]\n         :        :     :        :        +- Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n         :        :     :        :           +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n         :        :     :        :              :- Project [ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926, c_customer_sk#860]\n         :        :     :        :              :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n         :        :     :        :              :     :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926]\n         :        :     :        :              :     :  +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n         :        :     :        :              :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :        :     :        :              :     +- Project [c_customer_sk#860]\n         :        :     :        :              :        +- Filter isnotnull(c_customer_sk#860)\n         :        :     :        :              :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n         :        :     :        :              +- Project [d_date_sk#1040]\n         :        :     :        :                 +- Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n         :        :     :        :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :        :     :        +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295]\n         :        :     :           +- Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n         :        :     :              +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n         :        :     :                 :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916]\n         :        :     :                 :  +- Filter isnotnull(ss_customer_sk#1906)\n         :        :     :                 :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :        :     :                 +- Project [c_customer_sk#860]\n         :        :     :                    +- Filter isnotnull(c_customer_sk#860)\n         :        :     :                       +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n         :        :     +- Join LeftSemi, (c_customer_sk#860 = c_customer_sk#860#14310)\n         :        :        :- Project [c_customer_sk#860, c_first_name#868, c_last_name#869]\n         :        :        :  +- Filter isnotnull(c_customer_sk#860)\n         :        :        :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n         :        :        +- Project [c_customer_sk#860 AS c_customer_sk#860#14310]\n         :        :           +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295 as decimal(38,8)) > CheckOverflow((0.950000 * promote_precision(cast(scalar-subquery#14284 [] as decimal(32,6)))), DecimalType(38,8))))\n         :        :              :  +- Aggregate [max(csales#14281) AS tpcds_cmax#14282]\n         :        :              :     +- Aggregate [c_customer_sk#860], [sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS csales#14281]\n         :        :              :        +- Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n         :        :              :           +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n         :        :              :              :- Project [ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926, c_customer_sk#860]\n         :        :              :              :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n         :        :              :              :     :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926]\n         :        :              :              :     :  +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n         :        :              :              :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :        :              :              :     +- Project [c_customer_sk#860]\n         :        :              :              :        +- Filter isnotnull(c_customer_sk#860)\n         :        :              :              :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n         :        :              :              +- Project [d_date_sk#1040]\n         :        :              :                 +- Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n         :        :              :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :        :              +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295]\n         :        :                 +- Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n         :        :                    +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n         :        :                       :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916]\n         :        :                       :  +- Filter isnotnull(ss_customer_sk#1906)\n         :        :                       :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :        :                       +- Project [c_customer_sk#860]\n         :        :                          +- Filter isnotnull(c_customer_sk#860)\n         :        :                             +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n         :        +- Project [d_date_sk#1040]\n         :           +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2000)) && (d_moy#1048 = 2)) && isnotnull(d_date_sk#1040))\n         :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         +- Aggregate [c_last_name#869, c_first_name#868], [c_last_name#869, c_first_name#868, sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2))) AS sales#14274]\n            +- Project [ws_quantity#1772, ws_list_price#1774, c_first_name#868, c_last_name#869]\n               +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                  :- Project [ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788, c_first_name#868, c_last_name#869]\n                  :  +- Join Inner, (ws_bill_customer_sk#1758 = c_customer_sk#860)\n                  :     :- Join LeftSemi, (ws_bill_customer_sk#1758 = c_customer_sk#860#14311)\n                  :     :  :- Project [ws_bill_customer_sk#1758, ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n                  :     :  :  +- Join LeftSemi, (ws_item_sk#1757 = item_sk#14278)\n                  :     :  :     :- Project [ws_item_sk#1757, ws_bill_customer_sk#1758, ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n                  :     :  :     :  +- Filter (isnotnull(ws_bill_customer_sk#1758) && isnotnull(ws_sold_date_sk#1788))\n                  :     :  :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :     :  :     +- Project [item_sk#14278]\n                  :     :  :        +- Filter (count(1)#14288L > 4)\n                  :     :  :           +- Aggregate [substring(i_item_desc#1176, 1, 30), i_item_sk#1172, d_date#1042], [i_item_sk#1172 AS item_sk#14278, count(1) AS count(1)#14288L]\n                  :     :  :              +- Project [d_date#1042, i_item_sk#1172, i_item_desc#1176]\n                  :     :  :                 +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                  :     :  :                    :- Project [ss_item_sk#1905, d_date#1042]\n                  :     :  :                    :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                  :     :  :                    :     :- Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n                  :     :  :                    :     :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_item_sk#1905))\n                  :     :  :                    :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :     :  :                    :     +- Project [d_date_sk#1040, d_date#1042]\n                  :     :  :                    :        +- Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n                  :     :  :                    :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :     :  :                    +- Project [i_item_sk#1172, i_item_desc#1176]\n                  :     :  :                       +- Filter isnotnull(i_item_sk#1172)\n                  :     :  :                          +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  :     :  +- Project [c_customer_sk#860 AS c_customer_sk#860#14311]\n                  :     :     +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295 as decimal(38,8)) > CheckOverflow((0.950000 * promote_precision(cast(scalar-subquery#14284 [] as decimal(32,6)))), DecimalType(38,8))))\n                  :     :        :  +- Aggregate [max(csales#14281) AS tpcds_cmax#14282]\n                  :     :        :     +- Aggregate [c_customer_sk#860], [sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS csales#14281]\n                  :     :        :        +- Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n                  :     :        :           +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                  :     :        :              :- Project [ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926, c_customer_sk#860]\n                  :     :        :              :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n                  :     :        :              :     :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926]\n                  :     :        :              :     :  +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n                  :     :        :              :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :     :        :              :     +- Project [c_customer_sk#860]\n                  :     :        :              :        +- Filter isnotnull(c_customer_sk#860)\n                  :     :        :              :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :     :        :              +- Project [d_date_sk#1040]\n                  :     :        :                 +- Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n                  :     :        :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :     :        +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295]\n                  :     :           +- Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n                  :     :              +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n                  :     :                 :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916]\n                  :     :                 :  +- Filter isnotnull(ss_customer_sk#1906)\n                  :     :                 :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :     :                 +- Project [c_customer_sk#860]\n                  :     :                    +- Filter isnotnull(c_customer_sk#860)\n                  :     :                       +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :     +- Join LeftSemi, (c_customer_sk#860 = c_customer_sk#860#14311)\n                  :        :- Project [c_customer_sk#860, c_first_name#868, c_last_name#869]\n                  :        :  +- Filter isnotnull(c_customer_sk#860)\n                  :        :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :        +- Project [c_customer_sk#860 AS c_customer_sk#860#14311]\n                  :           +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295 as decimal(38,8)) > CheckOverflow((0.950000 * promote_precision(cast(scalar-subquery#14284 [] as decimal(32,6)))), DecimalType(38,8))))\n                  :              :  +- Aggregate [max(csales#14281) AS tpcds_cmax#14282]\n                  :              :     +- Aggregate [c_customer_sk#860], [sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS csales#14281]\n                  :              :        +- Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n                  :              :           +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                  :              :              :- Project [ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926, c_customer_sk#860]\n                  :              :              :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n                  :              :              :     :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926]\n                  :              :              :     :  +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n                  :              :              :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :              :              :     +- Project [c_customer_sk#860]\n                  :              :              :        +- Filter isnotnull(c_customer_sk#860)\n                  :              :              :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :              :              +- Project [d_date_sk#1040]\n                  :              :                 +- Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n                  :              :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :              +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2))) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295]\n                  :                 +- Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n                  :                    +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n                  :                       :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916]\n                  :                       :  +- Filter isnotnull(ss_customer_sk#1906)\n                  :                       :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :                       +- Project [c_customer_sk#860]\n                  :                          +- Filter isnotnull(c_customer_sk#860)\n                  :                             +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  +- Project [d_date_sk#1040]\n                     +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2000)) && (d_moy#1048 = 2)) && isnotnull(d_date_sk#1040))\n                        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[c_last_name#869 ASC NULLS FIRST,c_first_name#868 ASC NULLS FIRST,sales#14271 ASC NULLS FIRST], output=[c_last_name#869,c_first_name#868,sales#14271])\n+- Union\n   :- *(22) HashAggregate(keys=[c_last_name#869, c_first_name#868], functions=[sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)))], output=[c_last_name#869, c_first_name#868, sales#14271])\n   :  +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, 200)\n   :     +- *(21) HashAggregate(keys=[c_last_name#869, c_first_name#868], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#1808 as decimal(12,2)))), DecimalType(18,2)))], output=[c_last_name#869, c_first_name#868, sum#14313])\n   :        +- *(21) Project [cs_quantity#1806, cs_list_price#1808, c_first_name#868, c_last_name#869]\n   :           +- *(21) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n   :              :- *(21) Project [cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822, c_first_name#868, c_last_name#869]\n   :              :  +- *(21) BroadcastHashJoin [cs_bill_customer_sk#1791], [c_customer_sk#860], Inner, BuildRight\n   :              :     :- SortMergeJoin [cs_bill_customer_sk#1791], [c_customer_sk#860#14310], LeftSemi\n   :              :     :  :- *(9) Sort [cs_bill_customer_sk#1791 ASC NULLS FIRST], false, 0\n   :              :     :  :  +- Exchange hashpartitioning(cs_bill_customer_sk#1791, 200)\n   :              :     :  :     +- *(8) Project [cs_bill_customer_sk#1791, cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n   :              :     :  :        +- SortMergeJoin [cs_item_sk#1803], [item_sk#14278], LeftSemi\n   :              :     :  :           :- *(2) Sort [cs_item_sk#1803 ASC NULLS FIRST], false, 0\n   :              :     :  :           :  +- Exchange hashpartitioning(cs_item_sk#1803, 200)\n   :              :     :  :           :     +- *(1) Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_list_price#1808, cs_sold_date_sk#1822]\n   :              :     :  :           :        +- *(1) Filter isnotnull(cs_bill_customer_sk#1791)\n   :              :     :  :           :           +- *(1) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_item_sk#1803,cs_quantity#1806,cs_list_price#1808,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:int,cs_item_sk:int,cs_quantity:int,cs_list_price:decimal(7,2)>\n   :              :     :  :           +- *(7) Sort [item_sk#14278 ASC NULLS FIRST], false, 0\n   :              :     :  :              +- Exchange hashpartitioning(item_sk#14278, 200)\n   :              :     :  :                 +- *(6) Project [item_sk#14278]\n   :              :     :  :                    +- *(6) Filter (count(1)#14288L > 4)\n   :              :     :  :                       +- *(6) HashAggregate(keys=[substring(i_item_desc#1176, 1, 30)#14314, i_item_sk#1172, d_date#1042], functions=[count(1)], output=[item_sk#14278, count(1)#14288L])\n   :              :     :  :                          +- Exchange hashpartitioning(substring(i_item_desc#1176, 1, 30)#14314, i_item_sk#1172, d_date#1042, 200)\n   :              :     :  :                             +- *(5) HashAggregate(keys=[substring(i_item_desc#1176, 1, 30) AS substring(i_item_desc#1176, 1, 30)#14314, i_item_sk#1172, d_date#1042], functions=[partial_count(1)], output=[substring(i_item_desc#1176, 1, 30)#14314, i_item_sk#1172, d_date#1042, count#14316L])\n   :              :     :  :                                +- *(5) Project [d_date#1042, i_item_sk#1172, i_item_desc#1176]\n   :              :     :  :                                   +- *(5) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n   :              :     :  :                                      :- *(5) Project [ss_item_sk#1905, d_date#1042]\n   :              :     :  :                                      :  +- *(5) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n   :              :     :  :                                      :     :- *(5) Project [ss_item_sk#1905, ss_sold_date_sk#1926]\n   :              :     :  :                                      :     :  +- *(5) Filter isnotnull(ss_item_sk#1905)\n   :              :     :  :                                      :     :     +- *(5) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int>\n   :              :     :  :                                      :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :              :     :  :                                      :        +- *(3) Project [d_date_sk#1040, d_date#1042]\n   :              :     :  :                                      :           +- *(3) Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n   :              :     :  :                                      :              +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [In(d_year, [2000,2001,2002,2003]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_date:date,d_year:int>\n   :              :     :  :                                      +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :              :     :  :                                         +- *(4) Project [i_item_sk#1172, i_item_desc#1176]\n   :              :     :  :                                            +- *(4) Filter isnotnull(i_item_sk#1172)\n   :              :     :  :                                               +- *(4) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_desc#1176] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_desc:string>\n   :              :     :  +- *(13) Sort [c_customer_sk#860#14310 ASC NULLS FIRST], false, 0\n   :              :     :     +- Exchange hashpartitioning(c_customer_sk#860#14310, 200)\n   :              :     :        +- *(12) Project [c_customer_sk#860 AS c_customer_sk#860#14310]\n   :              :     :           +- *(12) Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295) && (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295 as decimal(38,8)) > CheckOverflow((0.950000 * promote_precision(cast(Subquery subquery14284 as decimal(32,6)))), DecimalType(38,8))))\n   :              :     :              :  +- Subquery subquery14284\n   :              :     :              :     +- *(5) HashAggregate(keys=[], functions=[max(csales#14281)], output=[tpcds_cmax#14282])\n   :              :     :              :        +- Exchange SinglePartition\n   :              :     :              :           +- *(4) HashAggregate(keys=[], functions=[partial_max(csales#14281)], output=[max#14323])\n   :              :     :              :              +- *(4) HashAggregate(keys=[c_customer_sk#860], functions=[sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))], output=[csales#14281])\n   :              :     :              :                 +- Exchange hashpartitioning(c_customer_sk#860, 200)\n   :              :     :              :                    +- *(3) HashAggregate(keys=[c_customer_sk#860], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))], output=[c_customer_sk#860, sum#14325])\n   :              :     :              :                       +- *(3) Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n   :              :     :              :                          +- *(3) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n   :              :     :              :                             :- *(3) Project [ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926, c_customer_sk#860]\n   :              :     :              :                             :  +- *(3) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n   :              :     :              :                             :     :- *(3) Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926]\n   :              :     :              :                             :     :  +- *(3) Filter isnotnull(ss_customer_sk#1906)\n   :              :     :              :                             :     :     +- *(3) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_quantity#1913,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_quantity:int,ss_sales_price:decimal(7,2)>\n   :              :     :              :                             :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :              :     :              :                             :        +- *(1) Project [c_customer_sk#860]\n   :              :     :              :                             :           +- *(1) Filter isnotnull(c_customer_sk#860)\n   :              :     :              :                             :              +- *(1) FileScan parquet db_tpcds.customer[c_customer_sk#860] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int>\n   :              :     :              :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :              :     :              :                                +- *(2) Project [d_date_sk#1040]\n   :              :     :              :                                   +- *(2) Filter (d_year#1046 IN (2000,2001,2002,2003) && isnotnull(d_date_sk#1040))\n   :              :     :              :                                      +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [In(d_year, [2000,2001,2002,2003]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n   :              :     :              +- *(12) HashAggregate(keys=[c_customer_sk#860], functions=[sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))], output=[c_customer_sk#860, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))#14295])\n   :              :     :                 +- Exchange hashpartitioning(c_customer_sk#860, 200)\n   :              :     :                    +- *(11) HashAggregate(keys=[c_customer_sk#860], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)))], output=[c_customer_sk#860, sum#14318])\n   :              :     :                       +- *(11) Project [ss_quantity#1913, ss_sales_price#1916, c_customer_sk#860]\n   :              :     :                          +- *(11) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n   :              :     :                             :- *(11) Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916]\n   :              :     :                             :  +- *(11) Filter isnotnull(ss_customer_sk#1906)\n   :              :     :                             :     +- *(11) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_quantity#1913,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_quantity:int,ss_sales_price:decimal(7,2)>\n   :              :     :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :              :     :                                +- *(10) Project [c_customer_sk#860]\n   :              :     :                                   +- *(10) Filter isnotnull(c_customer_sk#860)\n   :              :     :                                      +- *(10) FileScan parquet db_tpcds.customer[c_customer_sk#860] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int>\n   :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :              :        +- SortMergeJoin [c_customer_sk#860], [c_customer_sk#860#14310], LeftSemi\n   :              :           :- *(15) Sort [c_customer_sk#860 ASC NULLS FIRST], false, 0\n   :              :           :  +- Exchange hashpartitioning(c_customer_sk#860, 200)\n   :              :           :     +- *(14) Project [c_customer_sk#860, c_first_name#868, c_last_name#869]\n   :              :           :        +- *(14) Filter isnotnull(c_customer_sk#860)\n   :              :           :           +- *(14) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_first_name#868,c_last_name#869] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int,c_first_name:string,c_last_name:string>\n   :              :           +- *(19) Sort [c_customer_sk#860#14310 ASC NULLS FIRST], false, 0\n   :              :              +- ReusedExchange [c_customer_sk#860#14310], Exchange hashpartitioning(c_customer_sk#860#14310, 200)\n   :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                 +- *(20) Project [d_date_sk#1040]\n   :                    +- *(20) Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2000)) && (d_moy#1048 = 2)) && isnotnull(d_date_sk#1040))\n   :                       +- *(20) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,2), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n   +- *(44) HashAggregate(keys=[c_last_name#869, c_first_name#868], functions=[sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)))], output=[c_last_name#869, c_first_name#868, sales#14274])\n      +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, 200)\n         +- *(43) HashAggregate(keys=[c_last_name#869, c_first_name#868], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#1774 as decimal(12,2)))), DecimalType(18,2)))], output=[c_last_name#869, c_first_name#868, sum#14320])\n            +- *(43) Project [ws_quantity#1772, ws_list_price#1774, c_first_name#868, c_last_name#869]\n               +- *(43) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                  :- *(43) Project [ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788, c_first_name#868, c_last_name#869]\n                  :  +- *(43) BroadcastHashJoin [ws_bill_customer_sk#1758], [c_customer_sk#860], Inner, BuildRight\n                  :     :- SortMergeJoin [ws_bill_customer_sk#1758], [c_customer_sk#860#14311], LeftSemi\n                  :     :  :- *(31) Sort [ws_bill_customer_sk#1758 ASC NULLS FIRST], false, 0\n                  :     :  :  +- Exchange hashpartitioning(ws_bill_customer_sk#1758, 200)\n                  :     :  :     +- *(30) Project [ws_bill_customer_sk#1758, ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n                  :     :  :        +- SortMergeJoin [ws_item_sk#1757], [item_sk#14278], LeftSemi\n                  :     :  :           :- *(24) Sort [ws_item_sk#1757 ASC NULLS FIRST], false, 0\n                  :     :  :           :  +- Exchange hashpartitioning(ws_item_sk#1757, 200)\n                  :     :  :           :     +- *(23) Project [ws_item_sk#1757, ws_bill_customer_sk#1758, ws_quantity#1772, ws_list_price#1774, ws_sold_date_sk#1788]\n                  :     :  :           :        +- *(23) Filter isnotnull(ws_bill_customer_sk#1758)\n                  :     :  :           :           +- *(23) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_bill_customer_sk#1758,ws_quantity#1772,ws_list_price#1774,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_item_sk:int,ws_bill_customer_sk:int,ws_quantity:int,ws_list_price:decimal(7,2)>\n                  :     :  :           +- *(29) Sort [item_sk#14278 ASC NULLS FIRST], false, 0\n                  :     :  :              +- ReusedExchange [item_sk#14278], Exchange hashpartitioning(item_sk#14278, 200)\n                  :     :  +- *(35) Sort [c_customer_sk#860#14311 ASC NULLS FIRST], false, 0\n                  :     :     +- ReusedExchange [c_customer_sk#860#14311], Exchange hashpartitioning(c_customer_sk#860#14310, 200)\n                  :     +- ReusedExchange [c_customer_sk#860, c_first_name#868, c_last_name#869], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q24a-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin"],"tables":["ssales"],"parsingTime":0.003006,"analysisTime":0.001038,"optimizationTime":188.361395,"planningTime":1103.8507,"executionTime":14025.459979,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ssales]\n:  +- 'SubqueryAlias ssales\n:     +- 'Aggregate ['c_last_name, 'c_first_name, 's_store_name, 'ca_state, 's_state, 'i_color, 'i_current_price, 'i_manager_id, 'i_units, 'i_size], ['c_last_name, 'c_first_name, 's_store_name, 'ca_state, 's_state, 'i_color, 'i_current_price, 'i_manager_id, 'i_units, 'i_size, 'sum('ss_net_paid) AS netpaid#14403]\n:        +- 'Filter (((('ss_ticket_number = 'sr_ticket_number) && ('ss_item_sk = 'sr_item_sk)) && (('ss_customer_sk = 'c_customer_sk) && ('ss_item_sk = 'i_item_sk))) && ((('ss_store_sk = 's_store_sk) && ('c_birth_country = 'upper('ca_country))) && (('s_zip = 'ca_zip) && ('s_market_id = 8))))\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'Join Inner\n:              :  :  :- 'Join Inner\n:              :  :  :  :- 'Join Inner\n:              :  :  :  :  :- 'UnresolvedRelation `store_sales`\n:              :  :  :  :  +- 'UnresolvedRelation `store_returns`\n:              :  :  :  +- 'UnresolvedRelation `store`\n:              :  :  +- 'UnresolvedRelation `item`\n:              :  +- 'UnresolvedRelation `customer`\n:              +- 'UnresolvedRelation `customer_address`\n+- 'Filter ('sum('netpaid) > scalar-subquery#14402 [])\n   :  +- 'Project [unresolvedalias((0.05 * 'avg('netpaid)), None)]\n   :     +- 'UnresolvedRelation `ssales`\n   +- 'Aggregate ['c_last_name, 'c_first_name, 's_store_name], ['c_last_name, 'c_first_name, 's_store_name, 'sum('netpaid) AS paid#14401]\n      +- 'Filter ('i_color = pale)\n         +- 'UnresolvedRelation `ssales`\n\n== Analyzed Logical Plan ==\nc_last_name: string, c_first_name: string, s_store_name: string, paid: decimal(27,2)\nProject [c_last_name#869, c_first_name#868, s_store_name#1391, paid#14401]\n+- Filter (cast(sum(netpaid#14403)#14410 as decimal(33,8)) > cast(scalar-subquery#14402 [] as decimal(33,8)))\n   :  +- Aggregate [CheckOverflow((promote_precision(cast(0.05 as decimal(21,6))) * promote_precision(cast(avg(netpaid#14403) as decimal(21,6)))), DecimalType(24,8)) AS (CAST(0.05 AS DECIMAL(21,6)) * CAST(avg(netpaid) AS DECIMAL(21,6)))#14407]\n   :     +- SubqueryAlias ssales\n   :        +- Aggregate [c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], [c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187, sum(ss_net_paid#1923) AS netpaid#14403]\n   :           +- Filter ((((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705)) && ((ss_customer_sk#1906 = c_customer_sk#860) && (ss_item_sk#1905 = i_item_sk#1172))) && (((ss_store_sk#1910 = s_store_sk#1386) && (c_birth_country#874 = upper(ca_country#932))) && ((s_zip#1411 = ca_zip#931) && (s_market_id#1396 = 8))))\n   :              +- Join Inner\n   :                 :- Join Inner\n   :                 :  :- Join Inner\n   :                 :  :  :- Join Inner\n   :                 :  :  :  :- Join Inner\n   :                 :  :  :  :  :- SubqueryAlias store_sales\n   :                 :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n   :                 :  :  :  :  +- SubqueryAlias store_returns\n   :                 :  :  :  :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n   :                 :  :  :  +- SubqueryAlias store\n   :                 :  :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n   :                 :  :  +- SubqueryAlias item\n   :                 :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n   :                 :  +- SubqueryAlias customer\n   :                 :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n   :                 +- SubqueryAlias customer_address\n   :                    +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n   +- Aggregate [c_last_name#869, c_first_name#868, s_store_name#1391], [c_last_name#869, c_first_name#868, s_store_name#1391, sum(netpaid#14403) AS paid#14401, sum(netpaid#14403) AS sum(netpaid#14403)#14410]\n      +- Filter (i_color#1189 = pale)\n         +- SubqueryAlias ssales\n            +- Aggregate [c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], [c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187, sum(ss_net_paid#1923) AS netpaid#14403]\n               +- Filter ((((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705)) && ((ss_customer_sk#1906 = c_customer_sk#860) && (ss_item_sk#1905 = i_item_sk#1172))) && (((ss_store_sk#1910 = s_store_sk#1386) && (c_birth_country#874 = upper(ca_country#932))) && ((s_zip#1411 = ca_zip#931) && (s_market_id#1396 = 8))))\n                  +- Join Inner\n                     :- Join Inner\n                     :  :- Join Inner\n                     :  :  :- Join Inner\n                     :  :  :  :- Join Inner\n                     :  :  :  :  :- SubqueryAlias store_sales\n                     :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :  :  :  :  +- SubqueryAlias store_returns\n                     :  :  :  :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                     :  :  :  +- SubqueryAlias store\n                     :  :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                     :  :  +- SubqueryAlias item\n                     :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :  +- SubqueryAlias customer\n                     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                     +- SubqueryAlias customer_address\n                        +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n\n== Optimized Logical Plan ==\nProject [c_last_name#869, c_first_name#868, s_store_name#1391, paid#14401]\n+- Filter (isnotnull(sum(netpaid#14403)#14410) && (cast(sum(netpaid#14403)#14410 as decimal(33,8)) > cast(scalar-subquery#14402 [] as decimal(33,8))))\n   :  +- Aggregate [CheckOverflow((0.050000 * promote_precision(avg(netpaid#14403))), DecimalType(24,8)) AS (CAST(0.05 AS DECIMAL(21,6)) * CAST(avg(netpaid) AS DECIMAL(21,6)))#14407]\n   :     +- Aggregate [c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], [MakeDecimal(sum(UnscaledValue(ss_net_paid#1923)),17,2) AS netpaid#14403]\n   :        +- Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, ca_state#930]\n   :           +- Join Inner, ((c_birth_country#874 = upper(ca_country#932)) && (s_zip#1411 = ca_zip#931))\n   :              :- Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, c_birth_country#874]\n   :              :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n   :              :     :- Project [ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n   :              :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n   :              :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411]\n   :              :     :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n   :              :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_net_paid#1923]\n   :              :     :     :     :  +- Join Inner, ((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705))\n   :              :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_net_paid#1923]\n   :              :     :     :     :     :  +- Filter (((isnotnull(ss_item_sk#1905) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_customer_sk#1906))\n   :              :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n   :              :     :     :     :     +- Project [sr_item_sk#1705, sr_ticket_number#1712L]\n   :              :     :     :     :        +- Filter (isnotnull(sr_ticket_number#1712L) && isnotnull(sr_item_sk#1705))\n   :              :     :     :     :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n   :              :     :     :     +- Project [s_store_sk#1386, s_store_name#1391, s_state#1410, s_zip#1411]\n   :              :     :     :        +- Filter (((isnotnull(s_market_id#1396) && (s_market_id#1396 = 8)) && isnotnull(s_store_sk#1386)) && isnotnull(s_zip#1411))\n   :              :     :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n   :              :     :     +- Project [i_item_sk#1172, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n   :              :     :        +- Filter isnotnull(i_item_sk#1172)\n   :              :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n   :              :     +- Project [c_customer_sk#860, c_first_name#868, c_last_name#869, c_birth_country#874]\n   :              :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_birth_country#874))\n   :              :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n   :              +- Project [ca_state#930, ca_zip#931, ca_country#932]\n   :                 +- Filter isnotnull(ca_zip#931)\n   :                    +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n   +- Aggregate [c_last_name#869, c_first_name#868, s_store_name#1391], [c_last_name#869, c_first_name#868, s_store_name#1391, sum(netpaid#14403) AS paid#14401, sum(netpaid#14403) AS sum(netpaid#14403)#14410]\n      +- Aggregate [c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], [c_last_name#869, c_first_name#868, s_store_name#1391, MakeDecimal(sum(UnscaledValue(ss_net_paid#1923)),17,2) AS netpaid#14403]\n         +- Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, ca_state#930]\n            +- Join Inner, ((c_birth_country#874 = upper(ca_country#932)) && (s_zip#1411 = ca_zip#931))\n               :- Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, c_birth_country#874]\n               :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n               :     :- Project [ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n               :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411]\n               :     :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n               :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_net_paid#1923]\n               :     :     :     :  +- Join Inner, ((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705))\n               :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_net_paid#1923]\n               :     :     :     :     :  +- Filter (((isnotnull(ss_item_sk#1905) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_customer_sk#1906))\n               :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :     :     :     +- Project [sr_item_sk#1705, sr_ticket_number#1712L]\n               :     :     :     :        +- Filter (isnotnull(sr_ticket_number#1712L) && isnotnull(sr_item_sk#1705))\n               :     :     :     :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :     :     :     +- Project [s_store_sk#1386, s_store_name#1391, s_state#1410, s_zip#1411]\n               :     :     :        +- Filter (((isnotnull(s_market_id#1396) && (s_market_id#1396 = 8)) && isnotnull(s_store_sk#1386)) && isnotnull(s_zip#1411))\n               :     :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               :     :     +- Project [i_item_sk#1172, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n               :     :        +- Filter ((isnotnull(i_color#1189) && (i_color#1189 = pale)) && isnotnull(i_item_sk#1172))\n               :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :     +- Project [c_customer_sk#860, c_first_name#868, c_last_name#869, c_birth_country#874]\n               :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_birth_country#874))\n               :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               +- Project [ca_state#930, ca_zip#931, ca_country#932]\n                  +- Filter isnotnull(ca_zip#931)\n                     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n\n== Physical Plan ==\n*(11) Project [c_last_name#869, c_first_name#868, s_store_name#1391, paid#14401]\n+- *(11) Filter (isnotnull(sum(netpaid#14403)#14410) && (cast(sum(netpaid#14403)#14410 as decimal(33,8)) > cast(Subquery subquery14402 as decimal(33,8))))\n   :  +- Subquery subquery14402\n   :     +- *(11) HashAggregate(keys=[], functions=[avg(netpaid#14403)], output=[(CAST(0.05 AS DECIMAL(21,6)) * CAST(avg(netpaid) AS DECIMAL(21,6)))#14407])\n   :        +- Exchange SinglePartition\n   :           +- *(10) HashAggregate(keys=[], functions=[partial_avg(netpaid#14403)], output=[sum#14422, count#14423L])\n   :              +- *(10) HashAggregate(keys=[c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], functions=[sum(UnscaledValue(ss_net_paid#1923))], output=[netpaid#14403])\n   :                 +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187, 200)\n   :                    +- *(9) HashAggregate(keys=[c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], functions=[partial_sum(UnscaledValue(ss_net_paid#1923))], output=[c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187, sum#14425L])\n   :                       +- *(9) Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, ca_state#930]\n   :                          +- *(9) BroadcastHashJoin [c_birth_country#874, s_zip#1411], [upper(ca_country#932), ca_zip#931], Inner, BuildRight\n   :                             :- *(9) Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, c_birth_country#874]\n   :                             :  +- *(9) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n   :                             :     :- *(9) Project [ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n   :                             :     :  +- *(9) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n   :                             :     :     :- *(9) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411]\n   :                             :     :     :  +- *(9) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n   :                             :     :     :     :- *(9) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_net_paid#1923]\n   :                             :     :     :     :  +- *(9) SortMergeJoin [ss_ticket_number#1912L, ss_item_sk#1905], [sr_ticket_number#1712L, sr_item_sk#1705], Inner\n   :                             :     :     :     :     :- *(2) Sort [ss_ticket_number#1912L ASC NULLS FIRST, ss_item_sk#1905 ASC NULLS FIRST], false, 0\n   :                             :     :     :     :     :  +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_item_sk#1905, 200)\n   :                             :     :     :     :     :     +- *(1) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_net_paid#1923]\n   :                             :     :     :     :     :        +- *(1) Filter (((isnotnull(ss_item_sk#1905) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_customer_sk#1906))\n   :                             :     :     :     :     :           +- *(1) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_store_sk#1910,ss_ticket_number#1912L,ss_net_paid#1923,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_store_sk), IsNotNull(ss_custome..., ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_store_sk:int,ss_ticket_number:bigint,ss_net_paid:deci...\n   :                             :     :     :     :     +- *(4) Sort [sr_ticket_number#1712L ASC NULLS FIRST, sr_item_sk#1705 ASC NULLS FIRST], false, 0\n   :                             :     :     :     :        +- Exchange hashpartitioning(sr_ticket_number#1712L, sr_item_sk#1705, 200)\n   :                             :     :     :     :           +- *(3) Project [sr_item_sk#1705, sr_ticket_number#1712L]\n   :                             :     :     :     :              +- *(3) Filter (isnotnull(sr_ticket_number#1712L) && isnotnull(sr_item_sk#1705))\n   :                             :     :     :     :                 +- *(3) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_ticket_number#1712L,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns], PartitionCount: 2002, PartitionFilters: [], PushedFilters: [IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint>\n   :                             :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                             :     :     :        +- *(5) Project [s_store_sk#1386, s_store_name#1391, s_state#1410, s_zip#1411]\n   :                             :     :     :           +- *(5) Filter (((isnotnull(s_market_id#1396) && (s_market_id#1396 = 8)) && isnotnull(s_store_sk#1386)) && isnotnull(s_zip#1411))\n   :                             :     :     :              +- *(5) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_name#1391,s_market_id#1396,s_state#1410,s_zip#1411] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_market_id), EqualTo(s_market_id,8), IsNotNull(s_store_sk), IsNotNull(s_zip)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_market_id:int,s_state:string,s_zip:string>\n   :                             :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                             :     :        +- *(6) Project [i_item_sk#1172, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n   :                             :     :           +- *(6) Filter isnotnull(i_item_sk#1172)\n   :                             :     :              +- *(6) FileScan parquet db_tpcds.item[i_item_sk#1172,i_current_price#1177,i_size#1187,i_color#1189,i_units#1190,i_manager_id#1192] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_current_price:decimal(7,2),i_size:string,i_color:string,i_units:string,i_m...\n   :                             :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                             :        +- *(7) Project [c_customer_sk#860, c_first_name#868, c_last_name#869, c_birth_country#874]\n   :                             :           +- *(7) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_birth_country#874))\n   :                             :              +- *(7) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_first_name#868,c_last_name#869,c_birth_country#874] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_birth_country)], ReadSchema: struct<c_customer_sk:int,c_first_name:string,c_last_name:string,c_birth_country:string>\n   :                             +- BroadcastExchange HashedRelationBroadcastMode(List(upper(input[2, string, true]), input[1, string, true]))\n   :                                +- *(8) Project [ca_state#930, ca_zip#931, ca_country#932]\n   :                                   +- *(8) Filter isnotnull(ca_zip#931)\n   :                                      +- *(8) FileScan parquet db_tpcds.customer_address[ca_state#930,ca_zip#931,ca_country#932] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_zip)], ReadSchema: struct<ca_state:string,ca_zip:string,ca_country:string>\n   +- *(11) HashAggregate(keys=[c_last_name#869, c_first_name#868, s_store_name#1391], functions=[sum(netpaid#14403)], output=[c_last_name#869, c_first_name#868, s_store_name#1391, paid#14401, sum(netpaid#14403)#14410])\n      +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, s_store_name#1391, 200)\n         +- *(10) HashAggregate(keys=[c_last_name#869, c_first_name#868, s_store_name#1391], functions=[partial_sum(netpaid#14403)], output=[c_last_name#869, c_first_name#868, s_store_name#1391, sum#14417])\n            +- *(10) HashAggregate(keys=[c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], functions=[sum(UnscaledValue(ss_net_paid#1923))], output=[c_last_name#869, c_first_name#868, s_store_name#1391, netpaid#14403])\n               +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187, 200)\n                  +- *(9) HashAggregate(keys=[c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], functions=[partial_sum(UnscaledValue(ss_net_paid#1923))], output=[c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187, sum#14419L])\n                     +- *(9) Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, ca_state#930]\n                        +- *(9) BroadcastHashJoin [c_birth_country#874, s_zip#1411], [upper(ca_country#932), ca_zip#931], Inner, BuildRight\n                           :- *(9) Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, c_birth_country#874]\n                           :  +- *(9) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n                           :     :- *(9) Project [ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n                           :     :  +- *(9) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n                           :     :     :- *(9) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411]\n                           :     :     :  +- *(9) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                           :     :     :     :- *(9) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_net_paid#1923]\n                           :     :     :     :  +- *(9) SortMergeJoin [ss_ticket_number#1912L, ss_item_sk#1905], [sr_ticket_number#1712L, sr_item_sk#1705], Inner\n                           :     :     :     :     :- *(2) Sort [ss_ticket_number#1912L ASC NULLS FIRST, ss_item_sk#1905 ASC NULLS FIRST], false, 0\n                           :     :     :     :     :  +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_item_sk#1905, 200)\n                           :     :     :     :     :     +- *(1) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_net_paid#1923]\n                           :     :     :     :     :        +- *(1) Filter (((isnotnull(ss_item_sk#1905) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_customer_sk#1906))\n                           :     :     :     :     :           +- *(1) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_store_sk#1910,ss_ticket_number#1912L,ss_net_paid#1923,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_store_sk), IsNotNull(ss_custome..., ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_store_sk:int,ss_ticket_number:bigint,ss_net_paid:deci...\n                           :     :     :     :     +- *(4) Sort [sr_ticket_number#1712L ASC NULLS FIRST, sr_item_sk#1705 ASC NULLS FIRST], false, 0\n                           :     :     :     :        +- Exchange hashpartitioning(sr_ticket_number#1712L, sr_item_sk#1705, 200)\n                           :     :     :     :           +- *(3) Project [sr_item_sk#1705, sr_ticket_number#1712L]\n                           :     :     :     :              +- *(3) Filter (isnotnull(sr_ticket_number#1712L) && isnotnull(sr_item_sk#1705))\n                           :     :     :     :                 +- *(3) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_ticket_number#1712L,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns], PartitionCount: 2002, PartitionFilters: [], PushedFilters: [IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint>\n                           :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :     :     :        +- *(5) Project [s_store_sk#1386, s_store_name#1391, s_state#1410, s_zip#1411]\n                           :     :     :           +- *(5) Filter (((isnotnull(s_market_id#1396) && (s_market_id#1396 = 8)) && isnotnull(s_store_sk#1386)) && isnotnull(s_zip#1411))\n                           :     :     :              +- *(5) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_name#1391,s_market_id#1396,s_state#1410,s_zip#1411] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_market_id), EqualTo(s_market_id,8), IsNotNull(s_store_sk), IsNotNull(s_zip)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_market_id:int,s_state:string,s_zip:string>\n                           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :     :        +- *(6) Project [i_item_sk#1172, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n                           :     :           +- *(6) Filter ((isnotnull(i_color#1189) && (i_color#1189 = pale)) && isnotnull(i_item_sk#1172))\n                           :     :              +- *(6) FileScan parquet db_tpcds.item[i_item_sk#1172,i_current_price#1177,i_size#1187,i_color#1189,i_units#1190,i_manager_id#1192] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_color), EqualTo(i_color,pale), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_current_price:decimal(7,2),i_size:string,i_color:string,i_units:string,i_m...\n                           :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :        +- *(7) Project [c_customer_sk#860, c_first_name#868, c_last_name#869, c_birth_country#874]\n                           :           +- *(7) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_birth_country#874))\n                           :              +- *(7) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_first_name#868,c_last_name#869,c_birth_country#874] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_birth_country)], ReadSchema: struct<c_customer_sk:int,c_first_name:string,c_last_name:string,c_birth_country:string>\n                           +- BroadcastExchange HashedRelationBroadcastMode(List(upper(input[2, string, true]), input[1, string, true]))\n                              +- *(8) Project [ca_state#930, ca_zip#931, ca_country#932]\n                                 +- *(8) Filter isnotnull(ca_zip#931)\n                                    +- *(8) FileScan parquet db_tpcds.customer_address[ca_state#930,ca_zip#931,ca_country#932] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_zip)], ReadSchema: struct<ca_state:string,ca_zip:string,ca_country:string>"},{"name":"q24b-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin"],"tables":["ssales"],"parsingTime":0.002963,"analysisTime":8.56E-4,"optimizationTime":177.0057,"planningTime":999.549734,"executionTime":13362.711209,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ssales]\n:  +- 'SubqueryAlias ssales\n:     +- 'Aggregate ['c_last_name, 'c_first_name, 's_store_name, 'ca_state, 's_state, 'i_color, 'i_current_price, 'i_manager_id, 'i_units, 'i_size], ['c_last_name, 'c_first_name, 's_store_name, 'ca_state, 's_state, 'i_color, 'i_current_price, 'i_manager_id, 'i_units, 'i_size, 'sum('ss_net_paid) AS netpaid#14469]\n:        +- 'Filter (((('ss_ticket_number = 'sr_ticket_number) && ('ss_item_sk = 'sr_item_sk)) && (('ss_customer_sk = 'c_customer_sk) && ('ss_item_sk = 'i_item_sk))) && ((('ss_store_sk = 's_store_sk) && ('c_birth_country = 'upper('ca_country))) && (('s_zip = 'ca_zip) && ('s_market_id = 8))))\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'Join Inner\n:              :  :  :- 'Join Inner\n:              :  :  :  :- 'Join Inner\n:              :  :  :  :  :- 'UnresolvedRelation `store_sales`\n:              :  :  :  :  +- 'UnresolvedRelation `store_returns`\n:              :  :  :  +- 'UnresolvedRelation `store`\n:              :  :  +- 'UnresolvedRelation `item`\n:              :  +- 'UnresolvedRelation `customer`\n:              +- 'UnresolvedRelation `customer_address`\n+- 'Filter ('sum('netpaid) > scalar-subquery#14468 [])\n   :  +- 'Project [unresolvedalias((0.05 * 'avg('netpaid)), None)]\n   :     +- 'UnresolvedRelation `ssales`\n   +- 'Aggregate ['c_last_name, 'c_first_name, 's_store_name], ['c_last_name, 'c_first_name, 's_store_name, 'sum('netpaid) AS paid#14467]\n      +- 'Filter ('i_color = chiffon)\n         +- 'UnresolvedRelation `ssales`\n\n== Analyzed Logical Plan ==\nc_last_name: string, c_first_name: string, s_store_name: string, paid: decimal(27,2)\nProject [c_last_name#869, c_first_name#868, s_store_name#1391, paid#14467]\n+- Filter (cast(sum(netpaid#14469)#14476 as decimal(33,8)) > cast(scalar-subquery#14468 [] as decimal(33,8)))\n   :  +- Aggregate [CheckOverflow((promote_precision(cast(0.05 as decimal(21,6))) * promote_precision(cast(avg(netpaid#14469) as decimal(21,6)))), DecimalType(24,8)) AS (CAST(0.05 AS DECIMAL(21,6)) * CAST(avg(netpaid) AS DECIMAL(21,6)))#14473]\n   :     +- SubqueryAlias ssales\n   :        +- Aggregate [c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], [c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187, sum(ss_net_paid#1923) AS netpaid#14469]\n   :           +- Filter ((((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705)) && ((ss_customer_sk#1906 = c_customer_sk#860) && (ss_item_sk#1905 = i_item_sk#1172))) && (((ss_store_sk#1910 = s_store_sk#1386) && (c_birth_country#874 = upper(ca_country#932))) && ((s_zip#1411 = ca_zip#931) && (s_market_id#1396 = 8))))\n   :              +- Join Inner\n   :                 :- Join Inner\n   :                 :  :- Join Inner\n   :                 :  :  :- Join Inner\n   :                 :  :  :  :- Join Inner\n   :                 :  :  :  :  :- SubqueryAlias store_sales\n   :                 :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n   :                 :  :  :  :  +- SubqueryAlias store_returns\n   :                 :  :  :  :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n   :                 :  :  :  +- SubqueryAlias store\n   :                 :  :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n   :                 :  :  +- SubqueryAlias item\n   :                 :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n   :                 :  +- SubqueryAlias customer\n   :                 :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n   :                 +- SubqueryAlias customer_address\n   :                    +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n   +- Aggregate [c_last_name#869, c_first_name#868, s_store_name#1391], [c_last_name#869, c_first_name#868, s_store_name#1391, sum(netpaid#14469) AS paid#14467, sum(netpaid#14469) AS sum(netpaid#14469)#14476]\n      +- Filter (i_color#1189 = chiffon)\n         +- SubqueryAlias ssales\n            +- Aggregate [c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], [c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187, sum(ss_net_paid#1923) AS netpaid#14469]\n               +- Filter ((((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705)) && ((ss_customer_sk#1906 = c_customer_sk#860) && (ss_item_sk#1905 = i_item_sk#1172))) && (((ss_store_sk#1910 = s_store_sk#1386) && (c_birth_country#874 = upper(ca_country#932))) && ((s_zip#1411 = ca_zip#931) && (s_market_id#1396 = 8))))\n                  +- Join Inner\n                     :- Join Inner\n                     :  :- Join Inner\n                     :  :  :- Join Inner\n                     :  :  :  :- Join Inner\n                     :  :  :  :  :- SubqueryAlias store_sales\n                     :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :  :  :  :  +- SubqueryAlias store_returns\n                     :  :  :  :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                     :  :  :  +- SubqueryAlias store\n                     :  :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                     :  :  +- SubqueryAlias item\n                     :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :  +- SubqueryAlias customer\n                     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                     +- SubqueryAlias customer_address\n                        +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n\n== Optimized Logical Plan ==\nProject [c_last_name#869, c_first_name#868, s_store_name#1391, paid#14467]\n+- Filter (isnotnull(sum(netpaid#14469)#14476) && (cast(sum(netpaid#14469)#14476 as decimal(33,8)) > cast(scalar-subquery#14468 [] as decimal(33,8))))\n   :  +- Aggregate [CheckOverflow((0.050000 * promote_precision(avg(netpaid#14469))), DecimalType(24,8)) AS (CAST(0.05 AS DECIMAL(21,6)) * CAST(avg(netpaid) AS DECIMAL(21,6)))#14473]\n   :     +- Aggregate [c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], [MakeDecimal(sum(UnscaledValue(ss_net_paid#1923)),17,2) AS netpaid#14469]\n   :        +- Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, ca_state#930]\n   :           +- Join Inner, ((c_birth_country#874 = upper(ca_country#932)) && (s_zip#1411 = ca_zip#931))\n   :              :- Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, c_birth_country#874]\n   :              :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n   :              :     :- Project [ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n   :              :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n   :              :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411]\n   :              :     :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n   :              :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_net_paid#1923]\n   :              :     :     :     :  +- Join Inner, ((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705))\n   :              :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_net_paid#1923]\n   :              :     :     :     :     :  +- Filter (((isnotnull(ss_item_sk#1905) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_customer_sk#1906))\n   :              :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n   :              :     :     :     :     +- Project [sr_item_sk#1705, sr_ticket_number#1712L]\n   :              :     :     :     :        +- Filter (isnotnull(sr_ticket_number#1712L) && isnotnull(sr_item_sk#1705))\n   :              :     :     :     :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n   :              :     :     :     +- Project [s_store_sk#1386, s_store_name#1391, s_state#1410, s_zip#1411]\n   :              :     :     :        +- Filter (((isnotnull(s_market_id#1396) && (s_market_id#1396 = 8)) && isnotnull(s_store_sk#1386)) && isnotnull(s_zip#1411))\n   :              :     :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n   :              :     :     +- Project [i_item_sk#1172, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n   :              :     :        +- Filter isnotnull(i_item_sk#1172)\n   :              :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n   :              :     +- Project [c_customer_sk#860, c_first_name#868, c_last_name#869, c_birth_country#874]\n   :              :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_birth_country#874))\n   :              :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n   :              +- Project [ca_state#930, ca_zip#931, ca_country#932]\n   :                 +- Filter isnotnull(ca_zip#931)\n   :                    +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n   +- Aggregate [c_last_name#869, c_first_name#868, s_store_name#1391], [c_last_name#869, c_first_name#868, s_store_name#1391, sum(netpaid#14469) AS paid#14467, sum(netpaid#14469) AS sum(netpaid#14469)#14476]\n      +- Aggregate [c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], [c_last_name#869, c_first_name#868, s_store_name#1391, MakeDecimal(sum(UnscaledValue(ss_net_paid#1923)),17,2) AS netpaid#14469]\n         +- Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, ca_state#930]\n            +- Join Inner, ((c_birth_country#874 = upper(ca_country#932)) && (s_zip#1411 = ca_zip#931))\n               :- Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, c_birth_country#874]\n               :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n               :     :- Project [ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n               :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411]\n               :     :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n               :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_net_paid#1923]\n               :     :     :     :  +- Join Inner, ((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705))\n               :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_net_paid#1923]\n               :     :     :     :     :  +- Filter (((isnotnull(ss_item_sk#1905) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_customer_sk#1906))\n               :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :     :     :     +- Project [sr_item_sk#1705, sr_ticket_number#1712L]\n               :     :     :     :        +- Filter (isnotnull(sr_ticket_number#1712L) && isnotnull(sr_item_sk#1705))\n               :     :     :     :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :     :     :     +- Project [s_store_sk#1386, s_store_name#1391, s_state#1410, s_zip#1411]\n               :     :     :        +- Filter (((isnotnull(s_market_id#1396) && (s_market_id#1396 = 8)) && isnotnull(s_store_sk#1386)) && isnotnull(s_zip#1411))\n               :     :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               :     :     +- Project [i_item_sk#1172, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n               :     :        +- Filter ((isnotnull(i_color#1189) && (i_color#1189 = chiffon)) && isnotnull(i_item_sk#1172))\n               :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :     +- Project [c_customer_sk#860, c_first_name#868, c_last_name#869, c_birth_country#874]\n               :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_birth_country#874))\n               :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               +- Project [ca_state#930, ca_zip#931, ca_country#932]\n                  +- Filter isnotnull(ca_zip#931)\n                     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n\n== Physical Plan ==\n*(11) Project [c_last_name#869, c_first_name#868, s_store_name#1391, paid#14467]\n+- *(11) Filter (isnotnull(sum(netpaid#14469)#14476) && (cast(sum(netpaid#14469)#14476 as decimal(33,8)) > cast(Subquery subquery14468 as decimal(33,8))))\n   :  +- Subquery subquery14468\n   :     +- *(11) HashAggregate(keys=[], functions=[avg(netpaid#14469)], output=[(CAST(0.05 AS DECIMAL(21,6)) * CAST(avg(netpaid) AS DECIMAL(21,6)))#14473])\n   :        +- Exchange SinglePartition\n   :           +- *(10) HashAggregate(keys=[], functions=[partial_avg(netpaid#14469)], output=[sum#14488, count#14489L])\n   :              +- *(10) HashAggregate(keys=[c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], functions=[sum(UnscaledValue(ss_net_paid#1923))], output=[netpaid#14469])\n   :                 +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187, 200)\n   :                    +- *(9) HashAggregate(keys=[c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], functions=[partial_sum(UnscaledValue(ss_net_paid#1923))], output=[c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187, sum#14491L])\n   :                       +- *(9) Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, ca_state#930]\n   :                          +- *(9) BroadcastHashJoin [c_birth_country#874, s_zip#1411], [upper(ca_country#932), ca_zip#931], Inner, BuildRight\n   :                             :- *(9) Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, c_birth_country#874]\n   :                             :  +- *(9) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n   :                             :     :- *(9) Project [ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n   :                             :     :  +- *(9) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n   :                             :     :     :- *(9) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411]\n   :                             :     :     :  +- *(9) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n   :                             :     :     :     :- *(9) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_net_paid#1923]\n   :                             :     :     :     :  +- *(9) SortMergeJoin [ss_ticket_number#1912L, ss_item_sk#1905], [sr_ticket_number#1712L, sr_item_sk#1705], Inner\n   :                             :     :     :     :     :- *(2) Sort [ss_ticket_number#1912L ASC NULLS FIRST, ss_item_sk#1905 ASC NULLS FIRST], false, 0\n   :                             :     :     :     :     :  +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_item_sk#1905, 200)\n   :                             :     :     :     :     :     +- *(1) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_net_paid#1923]\n   :                             :     :     :     :     :        +- *(1) Filter (((isnotnull(ss_item_sk#1905) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_customer_sk#1906))\n   :                             :     :     :     :     :           +- *(1) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_store_sk#1910,ss_ticket_number#1912L,ss_net_paid#1923,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_store_sk), IsNotNull(ss_custome..., ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_store_sk:int,ss_ticket_number:bigint,ss_net_paid:deci...\n   :                             :     :     :     :     +- *(4) Sort [sr_ticket_number#1712L ASC NULLS FIRST, sr_item_sk#1705 ASC NULLS FIRST], false, 0\n   :                             :     :     :     :        +- Exchange hashpartitioning(sr_ticket_number#1712L, sr_item_sk#1705, 200)\n   :                             :     :     :     :           +- *(3) Project [sr_item_sk#1705, sr_ticket_number#1712L]\n   :                             :     :     :     :              +- *(3) Filter (isnotnull(sr_ticket_number#1712L) && isnotnull(sr_item_sk#1705))\n   :                             :     :     :     :                 +- *(3) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_ticket_number#1712L,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns], PartitionCount: 2002, PartitionFilters: [], PushedFilters: [IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint>\n   :                             :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                             :     :     :        +- *(5) Project [s_store_sk#1386, s_store_name#1391, s_state#1410, s_zip#1411]\n   :                             :     :     :           +- *(5) Filter (((isnotnull(s_market_id#1396) && (s_market_id#1396 = 8)) && isnotnull(s_store_sk#1386)) && isnotnull(s_zip#1411))\n   :                             :     :     :              +- *(5) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_name#1391,s_market_id#1396,s_state#1410,s_zip#1411] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_market_id), EqualTo(s_market_id,8), IsNotNull(s_store_sk), IsNotNull(s_zip)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_market_id:int,s_state:string,s_zip:string>\n   :                             :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                             :     :        +- *(6) Project [i_item_sk#1172, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n   :                             :     :           +- *(6) Filter isnotnull(i_item_sk#1172)\n   :                             :     :              +- *(6) FileScan parquet db_tpcds.item[i_item_sk#1172,i_current_price#1177,i_size#1187,i_color#1189,i_units#1190,i_manager_id#1192] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_current_price:decimal(7,2),i_size:string,i_color:string,i_units:string,i_m...\n   :                             :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :                             :        +- *(7) Project [c_customer_sk#860, c_first_name#868, c_last_name#869, c_birth_country#874]\n   :                             :           +- *(7) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_birth_country#874))\n   :                             :              +- *(7) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_first_name#868,c_last_name#869,c_birth_country#874] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_birth_country)], ReadSchema: struct<c_customer_sk:int,c_first_name:string,c_last_name:string,c_birth_country:string>\n   :                             +- BroadcastExchange HashedRelationBroadcastMode(List(upper(input[2, string, true]), input[1, string, true]))\n   :                                +- *(8) Project [ca_state#930, ca_zip#931, ca_country#932]\n   :                                   +- *(8) Filter isnotnull(ca_zip#931)\n   :                                      +- *(8) FileScan parquet db_tpcds.customer_address[ca_state#930,ca_zip#931,ca_country#932] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_zip)], ReadSchema: struct<ca_state:string,ca_zip:string,ca_country:string>\n   +- *(11) HashAggregate(keys=[c_last_name#869, c_first_name#868, s_store_name#1391], functions=[sum(netpaid#14469)], output=[c_last_name#869, c_first_name#868, s_store_name#1391, paid#14467, sum(netpaid#14469)#14476])\n      +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, s_store_name#1391, 200)\n         +- *(10) HashAggregate(keys=[c_last_name#869, c_first_name#868, s_store_name#1391], functions=[partial_sum(netpaid#14469)], output=[c_last_name#869, c_first_name#868, s_store_name#1391, sum#14483])\n            +- *(10) HashAggregate(keys=[c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], functions=[sum(UnscaledValue(ss_net_paid#1923))], output=[c_last_name#869, c_first_name#868, s_store_name#1391, netpaid#14469])\n               +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187, 200)\n                  +- *(9) HashAggregate(keys=[c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187], functions=[partial_sum(UnscaledValue(ss_net_paid#1923))], output=[c_last_name#869, c_first_name#868, s_store_name#1391, ca_state#930, s_state#1410, i_color#1189, i_current_price#1177, i_manager_id#1192, i_units#1190, i_size#1187, sum#14485L])\n                     +- *(9) Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, ca_state#930]\n                        +- *(9) BroadcastHashJoin [c_birth_country#874, s_zip#1411], [upper(ca_country#932), ca_zip#931], Inner, BuildRight\n                           :- *(9) Project [ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192, c_first_name#868, c_last_name#869, c_birth_country#874]\n                           :  +- *(9) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n                           :     :- *(9) Project [ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n                           :     :  +- *(9) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n                           :     :     :- *(9) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_net_paid#1923, s_store_name#1391, s_state#1410, s_zip#1411]\n                           :     :     :  +- *(9) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                           :     :     :     :- *(9) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_net_paid#1923]\n                           :     :     :     :  +- *(9) SortMergeJoin [ss_ticket_number#1912L, ss_item_sk#1905], [sr_ticket_number#1712L, sr_item_sk#1705], Inner\n                           :     :     :     :     :- *(2) Sort [ss_ticket_number#1912L ASC NULLS FIRST, ss_item_sk#1905 ASC NULLS FIRST], false, 0\n                           :     :     :     :     :  +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_item_sk#1905, 200)\n                           :     :     :     :     :     +- *(1) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_net_paid#1923]\n                           :     :     :     :     :        +- *(1) Filter (((isnotnull(ss_item_sk#1905) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_customer_sk#1906))\n                           :     :     :     :     :           +- *(1) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_store_sk#1910,ss_ticket_number#1912L,ss_net_paid#1923,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_store_sk), IsNotNull(ss_custome..., ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_store_sk:int,ss_ticket_number:bigint,ss_net_paid:deci...\n                           :     :     :     :     +- *(4) Sort [sr_ticket_number#1712L ASC NULLS FIRST, sr_item_sk#1705 ASC NULLS FIRST], false, 0\n                           :     :     :     :        +- Exchange hashpartitioning(sr_ticket_number#1712L, sr_item_sk#1705, 200)\n                           :     :     :     :           +- *(3) Project [sr_item_sk#1705, sr_ticket_number#1712L]\n                           :     :     :     :              +- *(3) Filter (isnotnull(sr_ticket_number#1712L) && isnotnull(sr_item_sk#1705))\n                           :     :     :     :                 +- *(3) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_ticket_number#1712L,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns], PartitionCount: 2002, PartitionFilters: [], PushedFilters: [IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint>\n                           :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :     :     :        +- *(5) Project [s_store_sk#1386, s_store_name#1391, s_state#1410, s_zip#1411]\n                           :     :     :           +- *(5) Filter (((isnotnull(s_market_id#1396) && (s_market_id#1396 = 8)) && isnotnull(s_store_sk#1386)) && isnotnull(s_zip#1411))\n                           :     :     :              +- *(5) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_name#1391,s_market_id#1396,s_state#1410,s_zip#1411] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_market_id), EqualTo(s_market_id,8), IsNotNull(s_store_sk), IsNotNull(s_zip)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_market_id:int,s_state:string,s_zip:string>\n                           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :     :        +- *(6) Project [i_item_sk#1172, i_current_price#1177, i_size#1187, i_color#1189, i_units#1190, i_manager_id#1192]\n                           :     :           +- *(6) Filter ((isnotnull(i_color#1189) && (i_color#1189 = chiffon)) && isnotnull(i_item_sk#1172))\n                           :     :              +- *(6) FileScan parquet db_tpcds.item[i_item_sk#1172,i_current_price#1177,i_size#1187,i_color#1189,i_units#1190,i_manager_id#1192] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_color), EqualTo(i_color,chiffon), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_current_price:decimal(7,2),i_size:string,i_color:string,i_units:string,i_m...\n                           :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :        +- *(7) Project [c_customer_sk#860, c_first_name#868, c_last_name#869, c_birth_country#874]\n                           :           +- *(7) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_birth_country#874))\n                           :              +- *(7) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_first_name#868,c_last_name#869,c_birth_country#874] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_birth_country)], ReadSchema: struct<c_customer_sk:int,c_first_name:string,c_last_name:string,c_birth_country:string>\n                           +- BroadcastExchange HashedRelationBroadcastMode(List(upper(input[2, string, true]), input[1, string, true]))\n                              +- *(8) Project [ca_state#930, ca_zip#931, ca_country#932]\n                                 +- *(8) Filter isnotnull(ca_zip#931)\n                                    +- *(8) FileScan parquet db_tpcds.customer_address[ca_state#930,ca_zip#931,ca_country#932] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_zip)], ReadSchema: struct<ca_state:string,ca_zip:string,ca_country:string>"},{"name":"q25-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin"],"tables":["store_sales","store_returns","catalog_sales","date_dim","date_dim","date_dim","store","item"],"parsingTime":0.002884,"analysisTime":7.64E-4,"optimizationTime":946.094333,"planningTime":38.867723,"executionTime":8729.66216,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_item_id ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST, 's_store_id ASC NULLS FIRST, 's_store_name ASC NULLS FIRST], true\n      +- 'Aggregate ['i_item_id, 'i_item_desc, 's_store_id, 's_store_name], ['i_item_id, 'i_item_desc, 's_store_id, 's_store_name, 'sum('ss_net_profit) AS store_sales_profit#14587, 'sum('sr_net_loss) AS store_returns_loss#14588, 'sum('cs_net_profit) AS catalog_sales_profit#14589]\n         +- 'Filter ((((('d1.d_moy = 4) && ('d1.d_year = 2001)) && (('d1.d_date_sk = 'ss_sold_date_sk) && ('i_item_sk = 'ss_item_sk))) && ((('s_store_sk = 'ss_store_sk) && ('ss_customer_sk = 'sr_customer_sk)) && (('ss_item_sk = 'sr_item_sk) && ('ss_ticket_number = 'sr_ticket_number)))) && (((('sr_returned_date_sk = 'd2.d_date_sk) && (('d2.d_moy >= 4) && ('d2.d_moy <= 10))) && (('d2.d_year = 2001) && ('sr_customer_sk = 'cs_bill_customer_sk))) && ((('sr_item_sk = 'cs_item_sk) && ('cs_sold_date_sk = 'd3.d_date_sk)) && ((('d3.d_moy >= 4) && ('d3.d_moy <= 10)) && ('d3.d_year = 2001)))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'Join Inner\n               :  :  :  :  :- 'Join Inner\n               :  :  :  :  :  :- 'Join Inner\n               :  :  :  :  :  :  :- 'UnresolvedRelation `store_sales`\n               :  :  :  :  :  :  +- 'UnresolvedRelation `store_returns`\n               :  :  :  :  :  +- 'UnresolvedRelation `catalog_sales`\n               :  :  :  :  +- 'SubqueryAlias d1\n               :  :  :  :     +- 'UnresolvedRelation `date_dim`\n               :  :  :  +- 'SubqueryAlias d2\n               :  :  :     +- 'UnresolvedRelation `date_dim`\n               :  :  +- 'SubqueryAlias d3\n               :  :     +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `store`\n               +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\ni_item_id: string, i_item_desc: string, s_store_id: string, s_store_name: string, store_sales_profit: decimal(17,2), store_returns_loss: decimal(17,2), catalog_sales_profit: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391, store_sales_profit#14587, store_returns_loss#14588, catalog_sales_profit#14589]\n      +- Sort [i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, s_store_id#1387 ASC NULLS FIRST, s_store_name#1391 ASC NULLS FIRST], true\n         +- Aggregate [i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391], [i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391, sum(ss_net_profit#1925) AS store_sales_profit#14587, sum(sr_net_loss#1722) AS store_returns_loss#14588, sum(cs_net_profit#1821) AS catalog_sales_profit#14589]\n            +- Filter (((((d_moy#1048 = 4) && (d_year#1046 = 2001)) && ((d_date_sk#1040 = ss_sold_date_sk#1926) && (i_item_sk#1172 = ss_item_sk#1905))) && (((s_store_sk#1386 = ss_store_sk#1910) && (ss_customer_sk#1906 = sr_customer_sk#1706)) && ((ss_item_sk#1905 = sr_item_sk#1705) && (ss_ticket_number#1912L = sr_ticket_number#1712L)))) && ((((sr_returned_date_sk#1723 = d_date_sk#14590) && ((d_moy#14598 >= 4) && (d_moy#14598 <= 10))) && ((d_year#14596 = 2001) && (sr_customer_sk#1706 = cs_bill_customer_sk#1791))) && (((sr_item_sk#1705 = cs_item_sk#1803) && (cs_sold_date_sk#1822 = d_date_sk#14618)) && (((d_moy#14626 >= 4) && (d_moy#14626 <= 10)) && (d_year#14624 = 2001)))))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- Join Inner\n                  :  :  :  :- Join Inner\n                  :  :  :  :  :- Join Inner\n                  :  :  :  :  :  :- Join Inner\n                  :  :  :  :  :  :  :- SubqueryAlias store_sales\n                  :  :  :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :  :  :  :  :  :  +- SubqueryAlias store_returns\n                  :  :  :  :  :  :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                  :  :  :  :  :  +- SubqueryAlias catalog_sales\n                  :  :  :  :  :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                  :  :  :  :  +- SubqueryAlias d1\n                  :  :  :  :     +- SubqueryAlias date_dim\n                  :  :  :  :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :  :  :  +- SubqueryAlias d2\n                  :  :  :     +- SubqueryAlias date_dim\n                  :  :  :        +- Relation[d_date_sk#14590,d_date_id#14591,d_date#14592,d_month_seq#14593,d_week_seq#14594,d_quarter_seq#14595,d_year#14596,d_dow#14597,d_moy#14598,d_dom#14599,d_qoy#14600,d_fy_year#14601,d_fy_quarter_seq#14602,d_fy_week_seq#14603,d_day_name#14604,d_quarter_name#14605,d_holiday#14606,d_weekend#14607,d_following_holiday#14608,d_first_dom#14609,d_last_dom#14610,d_same_day_ly#14611,d_same_day_lq#14612,d_current_day#14613,... 4 more fields] parquet\n                  :  :  +- SubqueryAlias d3\n                  :  :     +- SubqueryAlias date_dim\n                  :  :        +- Relation[d_date_sk#14618,d_date_id#14619,d_date#14620,d_month_seq#14621,d_week_seq#14622,d_quarter_seq#14623,d_year#14624,d_dow#14625,d_moy#14626,d_dom#14627,d_qoy#14628,d_fy_year#14629,d_fy_quarter_seq#14630,d_fy_week_seq#14631,d_day_name#14632,d_quarter_name#14633,d_holiday#14634,d_weekend#14635,d_following_holiday#14636,d_first_dom#14637,d_last_dom#14638,d_same_day_ly#14639,d_same_day_lq#14640,d_current_day#14641,... 4 more fields] parquet\n                  :  +- SubqueryAlias store\n                  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                  +- SubqueryAlias item\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, s_store_id#1387 ASC NULLS FIRST, s_store_name#1391 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391], [i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391, MakeDecimal(sum(UnscaledValue(ss_net_profit#1925)),17,2) AS store_sales_profit#14587, MakeDecimal(sum(UnscaledValue(sr_net_loss#1722)),17,2) AS store_returns_loss#14588, MakeDecimal(sum(UnscaledValue(cs_net_profit#1821)),17,2) AS catalog_sales_profit#14589]\n         +- Project [ss_net_profit#1925, sr_net_loss#1722, cs_net_profit#1821, s_store_id#1387, s_store_name#1391, i_item_id#1173, i_item_desc#1176]\n            +- Join Inner, (i_item_sk#1172 = ss_item_sk#1905)\n               :- Project [ss_item_sk#1905, ss_net_profit#1925, sr_net_loss#1722, cs_net_profit#1821, s_store_id#1387, s_store_name#1391]\n               :  +- Join Inner, (s_store_sk#1386 = ss_store_sk#1910)\n               :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_net_profit#1925, sr_net_loss#1722, cs_net_profit#1821]\n               :     :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#14618)\n               :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_net_profit#1925, sr_net_loss#1722, cs_net_profit#1821, cs_sold_date_sk#1822]\n               :     :     :  +- Join Inner, (sr_returned_date_sk#1723 = d_date_sk#14590)\n               :     :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_net_profit#1925, sr_net_loss#1722, sr_returned_date_sk#1723, cs_net_profit#1821, cs_sold_date_sk#1822]\n               :     :     :     :  +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n               :     :     :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_net_profit#1925, ss_sold_date_sk#1926, sr_net_loss#1722, sr_returned_date_sk#1723, cs_net_profit#1821, cs_sold_date_sk#1822]\n               :     :     :     :     :  +- Join Inner, ((sr_customer_sk#1706 = cs_bill_customer_sk#1791) && (sr_item_sk#1705 = cs_item_sk#1803))\n               :     :     :     :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_net_profit#1925, ss_sold_date_sk#1926, sr_item_sk#1705, sr_customer_sk#1706, sr_net_loss#1722, sr_returned_date_sk#1723]\n               :     :     :     :     :     :  +- Join Inner, (((ss_customer_sk#1906 = sr_customer_sk#1706) && (ss_item_sk#1905 = sr_item_sk#1705)) && (ss_ticket_number#1912L = sr_ticket_number#1712L))\n               :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_net_profit#1925, ss_sold_date_sk#1926]\n               :     :     :     :     :     :     :  +- Filter ((((isnotnull(ss_item_sk#1905) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_store_sk#1910))\n               :     :     :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :     :     :     :     :     +- Project [sr_item_sk#1705, sr_customer_sk#1706, sr_ticket_number#1712L, sr_net_loss#1722, sr_returned_date_sk#1723]\n               :     :     :     :     :     :        +- Filter (((isnotnull(sr_customer_sk#1706) && isnotnull(sr_ticket_number#1712L)) && isnotnull(sr_item_sk#1705)) && isnotnull(sr_returned_date_sk#1723))\n               :     :     :     :     :     :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :     :     :     :     :     +- Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_net_profit#1821, cs_sold_date_sk#1822]\n               :     :     :     :     :        +- Filter ((isnotnull(cs_item_sk#1803) && isnotnull(cs_bill_customer_sk#1791)) && isnotnull(cs_sold_date_sk#1822))\n               :     :     :     :     :           +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :     :     :     +- Project [d_date_sk#1040]\n               :     :     :     :        +- Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 4)) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n               :     :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :     :     +- Project [d_date_sk#14590]\n               :     :     :        +- Filter (((((isnotnull(d_year#14596) && isnotnull(d_moy#14598)) && (d_moy#14598 >= 4)) && (d_moy#14598 <= 10)) && (d_year#14596 = 2001)) && isnotnull(d_date_sk#14590))\n               :     :     :           +- Relation[d_date_sk#14590,d_date_id#14591,d_date#14592,d_month_seq#14593,d_week_seq#14594,d_quarter_seq#14595,d_year#14596,d_dow#14597,d_moy#14598,d_dom#14599,d_qoy#14600,d_fy_year#14601,d_fy_quarter_seq#14602,d_fy_week_seq#14603,d_day_name#14604,d_quarter_name#14605,d_holiday#14606,d_weekend#14607,d_following_holiday#14608,d_first_dom#14609,d_last_dom#14610,d_same_day_ly#14611,d_same_day_lq#14612,d_current_day#14613,... 4 more fields] parquet\n               :     :     +- Project [d_date_sk#14618]\n               :     :        +- Filter (((((isnotnull(d_year#14624) && isnotnull(d_moy#14626)) && (d_moy#14626 >= 4)) && (d_moy#14626 <= 10)) && (d_year#14624 = 2001)) && isnotnull(d_date_sk#14618))\n               :     :           +- Relation[d_date_sk#14618,d_date_id#14619,d_date#14620,d_month_seq#14621,d_week_seq#14622,d_quarter_seq#14623,d_year#14624,d_dow#14625,d_moy#14626,d_dom#14627,d_qoy#14628,d_fy_year#14629,d_fy_quarter_seq#14630,d_fy_week_seq#14631,d_day_name#14632,d_quarter_name#14633,d_holiday#14634,d_weekend#14635,d_following_holiday#14636,d_first_dom#14637,d_last_dom#14638,d_same_day_ly#14639,d_same_day_lq#14640,d_current_day#14641,... 4 more fields] parquet\n               :     +- Project [s_store_sk#1386, s_store_id#1387, s_store_name#1391]\n               :        +- Filter isnotnull(s_store_sk#1386)\n               :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               +- Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176]\n                  +- Filter isnotnull(i_item_sk#1172)\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_item_id#1173 ASC NULLS FIRST,i_item_desc#1176 ASC NULLS FIRST,s_store_id#1387 ASC NULLS FIRST,s_store_name#1391 ASC NULLS FIRST], output=[i_item_id#1173,i_item_desc#1176,s_store_id#1387,s_store_name#1391,store_sales_profit#14587,store_returns_loss#14588,catalog_sales_profit#14589])\n+- *(12) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391], functions=[sum(UnscaledValue(ss_net_profit#1925)), sum(UnscaledValue(sr_net_loss#1722)), sum(UnscaledValue(cs_net_profit#1821))], output=[i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391, store_sales_profit#14587, store_returns_loss#14588, catalog_sales_profit#14589])\n   +- Exchange hashpartitioning(i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391, 200)\n      +- *(11) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391], functions=[partial_sum(UnscaledValue(ss_net_profit#1925)), partial_sum(UnscaledValue(sr_net_loss#1722)), partial_sum(UnscaledValue(cs_net_profit#1821))], output=[i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391, sum#14663L, sum#14664L, sum#14665L])\n         +- *(11) Project [ss_net_profit#1925, sr_net_loss#1722, cs_net_profit#1821, s_store_id#1387, s_store_name#1391, i_item_id#1173, i_item_desc#1176]\n            +- *(11) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :- *(11) Project [ss_item_sk#1905, ss_net_profit#1925, sr_net_loss#1722, cs_net_profit#1821, s_store_id#1387, s_store_name#1391]\n               :  +- *(11) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n               :     :- *(11) Project [ss_item_sk#1905, ss_store_sk#1910, ss_net_profit#1925, sr_net_loss#1722, cs_net_profit#1821]\n               :     :  +- *(11) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#14618], Inner, BuildRight\n               :     :     :- *(11) Project [ss_item_sk#1905, ss_store_sk#1910, ss_net_profit#1925, sr_net_loss#1722, cs_net_profit#1821, cs_sold_date_sk#1822]\n               :     :     :  +- *(11) BroadcastHashJoin [sr_returned_date_sk#1723], [d_date_sk#14590], Inner, BuildRight\n               :     :     :     :- *(11) Project [ss_item_sk#1905, ss_store_sk#1910, ss_net_profit#1925, sr_net_loss#1722, sr_returned_date_sk#1723, cs_net_profit#1821, cs_sold_date_sk#1822]\n               :     :     :     :  +- *(11) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :     :     :     :- *(11) Project [ss_item_sk#1905, ss_store_sk#1910, ss_net_profit#1925, ss_sold_date_sk#1926, sr_net_loss#1722, sr_returned_date_sk#1723, cs_net_profit#1821, cs_sold_date_sk#1822]\n               :     :     :     :     :  +- *(11) SortMergeJoin [sr_customer_sk#1706, sr_item_sk#1705], [cs_bill_customer_sk#1791, cs_item_sk#1803], Inner\n               :     :     :     :     :     :- *(3) Sort [sr_customer_sk#1706 ASC NULLS FIRST, sr_item_sk#1705 ASC NULLS FIRST], false, 0\n               :     :     :     :     :     :  +- Exchange hashpartitioning(sr_customer_sk#1706, sr_item_sk#1705, 200)\n               :     :     :     :     :     :     +- *(2) Project [ss_item_sk#1905, ss_store_sk#1910, ss_net_profit#1925, ss_sold_date_sk#1926, sr_item_sk#1705, sr_customer_sk#1706, sr_net_loss#1722, sr_returned_date_sk#1723]\n               :     :     :     :     :     :        +- *(2) BroadcastHashJoin [ss_customer_sk#1906, ss_item_sk#1905, ss_ticket_number#1912L], [sr_customer_sk#1706, sr_item_sk#1705, sr_ticket_number#1712L], Inner, BuildRight\n               :     :     :     :     :     :           :- *(2) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_net_profit#1925, ss_sold_date_sk#1926]\n               :     :     :     :     :     :           :  +- *(2) Filter (((isnotnull(ss_item_sk#1905) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910))\n               :     :     :     :     :     :           :     +- *(2) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_store_sk#1910,ss_ticket_number#1912L,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_stor..., ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_store_sk:int,ss_ticket_number:bigint,ss_net_profit:de...\n               :     :     :     :     :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, int, true], input[0, int, true], input[2, bigint, true]))\n               :     :     :     :     :     :              +- *(1) Project [sr_item_sk#1705, sr_customer_sk#1706, sr_ticket_number#1712L, sr_net_loss#1722, sr_returned_date_sk#1723]\n               :     :     :     :     :     :                 +- *(1) Filter ((isnotnull(sr_customer_sk#1706) && isnotnull(sr_ticket_number#1712L)) && isnotnull(sr_item_sk#1705))\n               :     :     :     :     :     :                    +- *(1) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_customer_sk#1706,sr_ticket_number#1712L,sr_net_loss#1722,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns/sr_..., PartitionCount: 2001, PartitionFilters: [isnotnull(sr_returned_date_sk#1723)], PushedFilters: [IsNotNull(sr_customer_sk), IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:int,sr_customer_sk:int,sr_ticket_number:bigint,sr_net_loss:decimal(7,2)>\n               :     :     :     :     :     +- *(5) Sort [cs_bill_customer_sk#1791 ASC NULLS FIRST, cs_item_sk#1803 ASC NULLS FIRST], false, 0\n               :     :     :     :     :        +- Exchange hashpartitioning(cs_bill_customer_sk#1791, cs_item_sk#1803, 200)\n               :     :     :     :     :           +- *(4) Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_net_profit#1821, cs_sold_date_sk#1822]\n               :     :     :     :     :              +- *(4) Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_bill_customer_sk#1791))\n               :     :     :     :     :                 +- *(4) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_item_sk#1803,cs_net_profit#1821,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:int,cs_item_sk:int,cs_net_profit:decimal(7,2)>\n               :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :     :        +- *(6) Project [d_date_sk#1040]\n               :     :     :     :           +- *(6) Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 4)) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n               :     :     :     :              +- *(6) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,4), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :        +- *(7) Project [d_date_sk#14590]\n               :     :     :           +- *(7) Filter (((((isnotnull(d_year#14596) && isnotnull(d_moy#14598)) && (d_moy#14598 >= 4)) && (d_moy#14598 <= 10)) && (d_year#14596 = 2001)) && isnotnull(d_date_sk#14590))\n               :     :     :              +- *(7) FileScan parquet db_tpcds.date_dim[d_date_sk#14590,d_year#14596,d_moy#14598] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), GreaterThanOrEqual(d_moy,4), LessThanOrEqual(d_moy,10), Equ..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               :     :     +- ReusedExchange [d_date_sk#14618], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(9) Project [s_store_sk#1386, s_store_id#1387, s_store_name#1391]\n               :           +- *(9) Filter isnotnull(s_store_sk#1386)\n               :              +- *(9) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_id#1387,s_store_name#1391] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_store_id:string,s_store_name:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(10) Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176]\n                     +- *(10) Filter isnotnull(i_item_sk#1172)\n                        +- *(10) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173,i_item_desc#1176] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string,i_item_desc:string>"},{"name":"q26-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["catalog_sales","customer_demographics","date_dim","item","promotion"],"parsingTime":0.002758,"analysisTime":6.34E-4,"optimizationTime":294.512968,"planningTime":14.305127,"executionTime":2847.718715,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_item_id ASC NULLS FIRST], true\n      +- 'Aggregate ['i_item_id], ['i_item_id, 'avg('cs_quantity) AS agg1#14770, 'avg('cs_list_price) AS agg2#14771, 'avg('cs_coupon_amt) AS agg3#14772, 'avg('cs_sales_price) AS agg4#14773]\n         +- 'Filter ((((('cs_sold_date_sk = 'd_date_sk) && ('cs_item_sk = 'i_item_sk)) && ('cs_bill_cdemo_sk = 'cd_demo_sk)) && (('cs_promo_sk = 'p_promo_sk) && ('cd_gender = M))) && ((('cd_marital_status = S) && ('cd_education_status = College)) && ((('p_channel_email = N) || ('p_channel_event = N)) && ('d_year = 2000))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'UnresolvedRelation `catalog_sales`\n               :  :  :  +- 'UnresolvedRelation `customer_demographics`\n               :  :  +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `item`\n               +- 'UnresolvedRelation `promotion`\n\n== Analyzed Logical Plan ==\ni_item_id: string, agg1: double, agg2: decimal(11,6), agg3: decimal(11,6), agg4: decimal(11,6)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [i_item_id#1173, agg1#14770, agg2#14771, agg3#14772, agg4#14773]\n      +- Sort [i_item_id#1173 ASC NULLS FIRST], true\n         +- Aggregate [i_item_id#1173], [i_item_id#1173, avg(cast(cs_quantity#1806 as bigint)) AS agg1#14770, avg(cs_list_price#1808) AS agg2#14771, avg(cs_coupon_amt#1815) AS agg3#14772, avg(cs_sales_price#1809) AS agg4#14773]\n            +- Filter (((((cs_sold_date_sk#1822 = d_date_sk#1040) && (cs_item_sk#1803 = i_item_sk#1172)) && (cs_bill_cdemo_sk#1792 = cd_demo_sk#966)) && ((cs_promo_sk#1804 = p_promo_sk#1254) && (cd_gender#967 = M))) && (((cd_marital_status#968 = S) && (cd_education_status#969 = College)) && (((p_channel_email#1263 = N) || (p_channel_event#1268 = N)) && (d_year#1046 = 2000))))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- Join Inner\n                  :  :  :  :- SubqueryAlias catalog_sales\n                  :  :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                  :  :  :  +- SubqueryAlias customer_demographics\n                  :  :  :     +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n                  :  :  +- SubqueryAlias date_dim\n                  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :  +- SubqueryAlias item\n                  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  +- SubqueryAlias promotion\n                     +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#1173 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173], [i_item_id#1173, avg(cast(cs_quantity#1806 as bigint)) AS agg1#14770, cast((avg(UnscaledValue(cs_list_price#1808)) / 100.0) as decimal(11,6)) AS agg2#14771, cast((avg(UnscaledValue(cs_coupon_amt#1815)) / 100.0) as decimal(11,6)) AS agg3#14772, cast((avg(UnscaledValue(cs_sales_price#1809)) / 100.0) as decimal(11,6)) AS agg4#14773]\n         +- Project [cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, i_item_id#1173]\n            +- Join Inner, (cs_promo_sk#1804 = p_promo_sk#1254)\n               :- Project [cs_promo_sk#1804, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, i_item_id#1173]\n               :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n               :     :- Project [cs_item_sk#1803, cs_promo_sk#1804, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815]\n               :     :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :     :     :- Project [cs_item_sk#1803, cs_promo_sk#1804, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_sold_date_sk#1822]\n               :     :     :  +- Join Inner, (cs_bill_cdemo_sk#1792 = cd_demo_sk#966)\n               :     :     :     :- Project [cs_bill_cdemo_sk#1792, cs_item_sk#1803, cs_promo_sk#1804, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_sold_date_sk#1822]\n               :     :     :     :  +- Filter (((isnotnull(cs_bill_cdemo_sk#1792) && isnotnull(cs_sold_date_sk#1822)) && isnotnull(cs_item_sk#1803)) && isnotnull(cs_promo_sk#1804))\n               :     :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :     :     +- Project [cd_demo_sk#966]\n               :     :     :        +- Filter ((((((isnotnull(cd_gender#967) && isnotnull(cd_education_status#969)) && isnotnull(cd_marital_status#968)) && (cd_gender#967 = M)) && (cd_marital_status#968 = S)) && (cd_education_status#969 = College)) && isnotnull(cd_demo_sk#966))\n               :     :     :           +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n               :     :     +- Project [d_date_sk#1040]\n               :     :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n               :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [i_item_sk#1172, i_item_id#1173]\n               :        +- Filter isnotnull(i_item_sk#1172)\n               :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               +- Project [p_promo_sk#1254]\n                  +- Filter (((p_channel_email#1263 = N) || (p_channel_event#1268 = N)) && isnotnull(p_promo_sk#1254))\n                     +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_item_id#1173 ASC NULLS FIRST], output=[i_item_id#1173,agg1#14770,agg2#14771,agg3#14772,agg4#14773])\n+- *(6) HashAggregate(keys=[i_item_id#1173], functions=[avg(cast(cs_quantity#1806 as bigint)), avg(UnscaledValue(cs_list_price#1808)), avg(UnscaledValue(cs_coupon_amt#1815)), avg(UnscaledValue(cs_sales_price#1809))], output=[i_item_id#1173, agg1#14770, agg2#14771, agg3#14772, agg4#14773])\n   +- Exchange hashpartitioning(i_item_id#1173, 200)\n      +- *(5) HashAggregate(keys=[i_item_id#1173], functions=[partial_avg(cast(cs_quantity#1806 as bigint)), partial_avg(UnscaledValue(cs_list_price#1808)), partial_avg(UnscaledValue(cs_coupon_amt#1815)), partial_avg(UnscaledValue(cs_sales_price#1809))], output=[i_item_id#1173, sum#14792, count#14793L, sum#14794, count#14795L, sum#14796, count#14797L, sum#14798, count#14799L])\n         +- *(5) Project [cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, i_item_id#1173]\n            +- *(5) BroadcastHashJoin [cs_promo_sk#1804], [p_promo_sk#1254], Inner, BuildRight\n               :- *(5) Project [cs_promo_sk#1804, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, i_item_id#1173]\n               :  +- *(5) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n               :     :- *(5) Project [cs_item_sk#1803, cs_promo_sk#1804, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815]\n               :     :  +- *(5) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :     :     :- *(5) Project [cs_item_sk#1803, cs_promo_sk#1804, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_sold_date_sk#1822]\n               :     :     :  +- *(5) BroadcastHashJoin [cs_bill_cdemo_sk#1792], [cd_demo_sk#966], Inner, BuildRight\n               :     :     :     :- *(5) Project [cs_bill_cdemo_sk#1792, cs_item_sk#1803, cs_promo_sk#1804, cs_quantity#1806, cs_list_price#1808, cs_sales_price#1809, cs_coupon_amt#1815, cs_sold_date_sk#1822]\n               :     :     :     :  +- *(5) Filter ((isnotnull(cs_bill_cdemo_sk#1792) && isnotnull(cs_item_sk#1803)) && isnotnull(cs_promo_sk#1804))\n               :     :     :     :     +- *(5) FileScan parquet db_tpcds.catalog_sales[cs_bill_cdemo_sk#1792,cs_item_sk#1803,cs_promo_sk#1804,cs_quantity#1806,cs_list_price#1808,cs_sales_price#1809,cs_coupon_amt#1815,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_bill_cdemo_sk), IsNotNull(cs_item_sk), IsNotNull(cs_promo_sk)], ReadSchema: struct<cs_bill_cdemo_sk:int,cs_item_sk:int,cs_promo_sk:int,cs_quantity:int,cs_list_price:decimal(...\n               :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :        +- *(1) Project [cd_demo_sk#966]\n               :     :     :           +- *(1) Filter ((((((isnotnull(cd_gender#967) && isnotnull(cd_education_status#969)) && isnotnull(cd_marital_status#968)) && (cd_gender#967 = M)) && (cd_marital_status#968 = S)) && (cd_education_status#969 = College)) && isnotnull(cd_demo_sk#966))\n               :     :     :              +- *(1) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_gender), IsNotNull(cd_education_status), IsNotNull(cd_marital_status), EqualTo(cd_g..., ReadSchema: struct<cd_demo_sk:int,cd_gender:string,cd_marital_status:string,cd_education_status:string>\n               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(2) Project [d_date_sk#1040]\n               :     :           +- *(2) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n               :     :              +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(3) Project [i_item_sk#1172, i_item_id#1173]\n               :           +- *(3) Filter isnotnull(i_item_sk#1172)\n               :              +- *(3) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(4) Project [p_promo_sk#1254]\n                     +- *(4) Filter (((p_channel_email#1263 = N) || (p_channel_event#1268 = N)) && isnotnull(p_promo_sk#1254))\n                        +- *(4) FileScan parquet db_tpcds.promotion[p_promo_sk#1254,p_channel_email#1263,p_channel_event#1268] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/promotion], PartitionFilters: [], PushedFilters: [Or(EqualTo(p_channel_email,N),EqualTo(p_channel_event,N)), IsNotNull(p_promo_sk)], ReadSchema: struct<p_promo_sk:int,p_channel_email:string,p_channel_event:string>"},{"name":"q27-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","customer_demographics","date_dim","store","item"],"parsingTime":0.003172,"analysisTime":6.61E-4,"optimizationTime":328.933533,"planningTime":12.664975,"executionTime":3558.160053,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_item_id ASC NULLS FIRST, 's_state ASC NULLS FIRST], true\n      +- 'Aggregate ['rollup('i_item_id, 's_state)], ['i_item_id, 's_state, 'grouping('s_state) AS g_state#14855, 'avg('ss_quantity) AS agg1#14856, 'avg('ss_list_price) AS agg2#14857, 'avg('ss_coupon_amt) AS agg3#14858, 'avg('ss_sales_price) AS agg4#14859]\n         +- 'Filter ((((('ss_sold_date_sk = 'd_date_sk) && ('ss_item_sk = 'i_item_sk)) && ('ss_store_sk = 's_store_sk)) && (('ss_cdemo_sk = 'cd_demo_sk) && ('cd_gender = M))) && ((('cd_marital_status = S) && ('cd_education_status = College)) && (('d_year = 2002) && 's_state IN (TN,TN,TN,TN,TN,TN))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'UnresolvedRelation `store_sales`\n               :  :  :  +- 'UnresolvedRelation `customer_demographics`\n               :  :  +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `store`\n               +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\ni_item_id: string, s_state: string, g_state: tinyint, agg1: double, agg2: decimal(11,6), agg3: decimal(11,6), agg4: decimal(11,6)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#14867 ASC NULLS FIRST, s_state#14868 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#14867, s_state#14868, spark_grouping_id#14864], [i_item_id#14867, s_state#14868, cast((shiftright(spark_grouping_id#14864, 0) & 1) as tinyint) AS g_state#14855, avg(cast(ss_quantity#1913 as bigint)) AS agg1#14856, avg(ss_list_price#1915) AS agg2#14857, avg(ss_coupon_amt#1922) AS agg3#14858, avg(ss_sales_price#1916) AS agg4#14859]\n         +- Expand [List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_item_id#14865, s_state#14866, 0), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_item_id#14865, null, 1), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, null, null, 3)], [ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, cd_demo_sk#966, ... 90 more fields]\n            +- Project [ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, cd_demo_sk#966, ... 89 more fields]\n               +- Filter (((((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_item_sk#1905 = i_item_sk#1172)) && (ss_store_sk#1910 = s_store_sk#1386)) && ((ss_cdemo_sk#1907 = cd_demo_sk#966) && (cd_gender#967 = M))) && (((cd_marital_status#968 = S) && (cd_education_status#969 = College)) && ((d_year#1046 = 2002) && s_state#1410 IN (TN,TN,TN,TN,TN,TN))))\n                  +- Join Inner\n                     :- Join Inner\n                     :  :- Join Inner\n                     :  :  :- Join Inner\n                     :  :  :  :- SubqueryAlias store_sales\n                     :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :  :  :  +- SubqueryAlias customer_demographics\n                     :  :  :     +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n                     :  :  +- SubqueryAlias date_dim\n                     :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  +- SubqueryAlias store\n                     :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                     +- SubqueryAlias item\n                        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#14867 ASC NULLS FIRST, s_state#14868 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#14867, s_state#14868, spark_grouping_id#14864], [i_item_id#14867, s_state#14868, cast((shiftright(spark_grouping_id#14864, 0) & 1) as tinyint) AS g_state#14855, avg(cast(ss_quantity#1913 as bigint)) AS agg1#14856, cast((avg(UnscaledValue(ss_list_price#1915)) / 100.0) as decimal(11,6)) AS agg2#14857, cast((avg(UnscaledValue(ss_coupon_amt#1922)) / 100.0) as decimal(11,6)) AS agg3#14858, cast((avg(UnscaledValue(ss_sales_price#1916)) / 100.0) as decimal(11,6)) AS agg4#14859]\n         +- Expand [List(ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, i_item_id#1173, s_state#1410, 0), List(ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, i_item_id#1173, null, 1), List(ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, null, null, 3)], [ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, i_item_id#14867, s_state#14868, spark_grouping_id#14864]\n            +- Project [ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, i_item_id#1173, s_state#1410]\n               +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                  :- Project [ss_item_sk#1905, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, s_state#1410]\n                  :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n                  :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922]\n                  :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                  :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n                  :     :     :  +- Join Inner, (ss_cdemo_sk#1907 = cd_demo_sk#966)\n                  :     :     :     :- Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_store_sk#1910, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n                  :     :     :     :  +- Filter (((isnotnull(ss_cdemo_sk#1907) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_item_sk#1905))\n                  :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :     :     :     +- Project [cd_demo_sk#966]\n                  :     :     :        +- Filter ((((((isnotnull(cd_gender#967) && isnotnull(cd_education_status#969)) && isnotnull(cd_marital_status#968)) && (cd_gender#967 = M)) && (cd_marital_status#968 = S)) && (cd_education_status#969 = College)) && isnotnull(cd_demo_sk#966))\n                  :     :     :           +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n                  :     :     +- Project [d_date_sk#1040]\n                  :     :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n                  :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :     +- Project [s_store_sk#1386, s_state#1410]\n                  :        +- Filter (s_state#1410 IN (TN) && isnotnull(s_store_sk#1386))\n                  :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                  +- Project [i_item_sk#1172, i_item_id#1173]\n                     +- Filter isnotnull(i_item_sk#1172)\n                        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_item_id#14867 ASC NULLS FIRST,s_state#14868 ASC NULLS FIRST], output=[i_item_id#14867,s_state#14868,g_state#14855,agg1#14856,agg2#14857,agg3#14858,agg4#14859])\n+- *(6) HashAggregate(keys=[i_item_id#14867, s_state#14868, spark_grouping_id#14864], functions=[avg(cast(ss_quantity#1913 as bigint)), avg(UnscaledValue(ss_list_price#1915)), avg(UnscaledValue(ss_coupon_amt#1922)), avg(UnscaledValue(ss_sales_price#1916))], output=[i_item_id#14867, s_state#14868, g_state#14855, agg1#14856, agg2#14857, agg3#14858, agg4#14859])\n   +- Exchange hashpartitioning(i_item_id#14867, s_state#14868, spark_grouping_id#14864, 200)\n      +- *(5) HashAggregate(keys=[i_item_id#14867, s_state#14868, spark_grouping_id#14864], functions=[partial_avg(cast(ss_quantity#1913 as bigint)), partial_avg(UnscaledValue(ss_list_price#1915)), partial_avg(UnscaledValue(ss_coupon_amt#1922)), partial_avg(UnscaledValue(ss_sales_price#1916))], output=[i_item_id#14867, s_state#14868, spark_grouping_id#14864, sum#14887, count#14888L, sum#14889, count#14890L, sum#14891, count#14892L, sum#14893, count#14894L])\n         +- *(5) Expand [List(ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, i_item_id#1173, s_state#1410, 0), List(ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, i_item_id#1173, null, 1), List(ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, null, null, 3)], [ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, i_item_id#14867, s_state#14868, spark_grouping_id#14864]\n            +- *(5) Project [ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, i_item_id#1173, s_state#1410]\n               +- *(5) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n                  :- *(5) Project [ss_item_sk#1905, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, s_state#1410]\n                  :  +- *(5) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                  :     :- *(5) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922]\n                  :     :  +- *(5) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                  :     :     :- *(5) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n                  :     :     :  +- *(5) BroadcastHashJoin [ss_cdemo_sk#1907], [cd_demo_sk#966], Inner, BuildRight\n                  :     :     :     :- *(5) Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_store_sk#1910, ss_quantity#1913, ss_list_price#1915, ss_sales_price#1916, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n                  :     :     :     :  +- *(5) Filter ((isnotnull(ss_cdemo_sk#1907) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_item_sk#1905))\n                  :     :     :     :     +- *(5) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_cdemo_sk#1907,ss_store_sk#1910,ss_quantity#1913,ss_list_price#1915,ss_sales_price#1916,ss_coupon_amt#1922,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_cdemo_sk), IsNotNull(ss_store_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_cdemo_sk:int,ss_store_sk:int,ss_quantity:int,ss_list_price:decimal(7,2),...\n                  :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :     :        +- *(1) Project [cd_demo_sk#966]\n                  :     :     :           +- *(1) Filter ((((((isnotnull(cd_gender#967) && isnotnull(cd_education_status#969)) && isnotnull(cd_marital_status#968)) && (cd_gender#967 = M)) && (cd_marital_status#968 = S)) && (cd_education_status#969 = College)) && isnotnull(cd_demo_sk#966))\n                  :     :     :              +- *(1) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_gender), IsNotNull(cd_education_status), IsNotNull(cd_marital_status), EqualTo(cd_g..., ReadSchema: struct<cd_demo_sk:int,cd_gender:string,cd_marital_status:string,cd_education_status:string>\n                  :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :        +- *(2) Project [d_date_sk#1040]\n                  :     :           +- *(2) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n                  :     :              +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :        +- *(3) Project [s_store_sk#1386, s_state#1410]\n                  :           +- *(3) Filter (s_state#1410 IN (TN) && isnotnull(s_store_sk#1386))\n                  :              +- *(3) FileScan parquet db_tpcds.store[s_store_sk#1386,s_state#1410] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [In(s_state, [TN]), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_state:string>\n                  +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     +- *(4) Project [i_item_sk#1172, i_item_id#1173]\n                        +- *(4) Filter isnotnull(i_item_sk#1172)\n                           +- *(4) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string>"},{"name":"q28-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastNestedLoopJoin","BroadcastNestedLoopJoin","BroadcastNestedLoopJoin","BroadcastNestedLoopJoin","BroadcastNestedLoopJoin"],"tables":["store_sales","store_sales","store_sales","store_sales","store_sales","store_sales"],"parsingTime":0.001928,"analysisTime":0.001109,"optimizationTime":48.504987,"planningTime":2596.962088,"executionTime":14097.653135,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Project [*]\n      +- 'Join Cross\n         :- 'Join Cross\n         :  :- 'Join Cross\n         :  :  :- 'Join Cross\n         :  :  :  :- 'Join Cross\n         :  :  :  :  :- 'SubqueryAlias B1\n         :  :  :  :  :  +- 'Project ['avg('ss_list_price) AS B1_LP#15094, 'count('ss_list_price) AS B1_CNT#15095, 'count('ss_list_price) AS B1_CNTD#15096]\n         :  :  :  :  :     +- 'Filter ((('ss_quantity >= 0) && ('ss_quantity <= 5)) && (((('ss_list_price >= 8) && ('ss_list_price <= (8 + 10))) || (('ss_coupon_amt >= 459) && ('ss_coupon_amt <= (459 + 1000)))) || (('ss_wholesale_cost >= 57) && ('ss_wholesale_cost <= (57 + 20)))))\n         :  :  :  :  :        +- 'UnresolvedRelation `store_sales`\n         :  :  :  :  +- 'SubqueryAlias B2\n         :  :  :  :     +- 'Project ['avg('ss_list_price) AS B2_LP#15097, 'count('ss_list_price) AS B2_CNT#15098, 'count('ss_list_price) AS B2_CNTD#15099]\n         :  :  :  :        +- 'Filter ((('ss_quantity >= 6) && ('ss_quantity <= 10)) && (((('ss_list_price >= 90) && ('ss_list_price <= (90 + 10))) || (('ss_coupon_amt >= 2323) && ('ss_coupon_amt <= (2323 + 1000)))) || (('ss_wholesale_cost >= 31) && ('ss_wholesale_cost <= (31 + 20)))))\n         :  :  :  :           +- 'UnresolvedRelation `store_sales`\n         :  :  :  +- 'SubqueryAlias B3\n         :  :  :     +- 'Project ['avg('ss_list_price) AS B3_LP#15100, 'count('ss_list_price) AS B3_CNT#15101, 'count('ss_list_price) AS B3_CNTD#15102]\n         :  :  :        +- 'Filter ((('ss_quantity >= 11) && ('ss_quantity <= 15)) && (((('ss_list_price >= 142) && ('ss_list_price <= (142 + 10))) || (('ss_coupon_amt >= 12214) && ('ss_coupon_amt <= (12214 + 1000)))) || (('ss_wholesale_cost >= 79) && ('ss_wholesale_cost <= (79 + 20)))))\n         :  :  :           +- 'UnresolvedRelation `store_sales`\n         :  :  +- 'SubqueryAlias B4\n         :  :     +- 'Project ['avg('ss_list_price) AS B4_LP#15103, 'count('ss_list_price) AS B4_CNT#15104, 'count('ss_list_price) AS B4_CNTD#15105]\n         :  :        +- 'Filter ((('ss_quantity >= 16) && ('ss_quantity <= 20)) && (((('ss_list_price >= 135) && ('ss_list_price <= (135 + 10))) || (('ss_coupon_amt >= 6071) && ('ss_coupon_amt <= (6071 + 1000)))) || (('ss_wholesale_cost >= 38) && ('ss_wholesale_cost <= (38 + 20)))))\n         :  :           +- 'UnresolvedRelation `store_sales`\n         :  +- 'SubqueryAlias B5\n         :     +- 'Project ['avg('ss_list_price) AS B5_LP#15106, 'count('ss_list_price) AS B5_CNT#15107, 'count('ss_list_price) AS B5_CNTD#15108]\n         :        +- 'Filter ((('ss_quantity >= 21) && ('ss_quantity <= 25)) && (((('ss_list_price >= 122) && ('ss_list_price <= (122 + 10))) || (('ss_coupon_amt >= 836) && ('ss_coupon_amt <= (836 + 1000)))) || (('ss_wholesale_cost >= 17) && ('ss_wholesale_cost <= (17 + 20)))))\n         :           +- 'UnresolvedRelation `store_sales`\n         +- 'SubqueryAlias B6\n            +- 'Project ['avg('ss_list_price) AS B6_LP#15109, 'count('ss_list_price) AS B6_CNT#15110, 'count('ss_list_price) AS B6_CNTD#15111]\n               +- 'Filter ((('ss_quantity >= 26) && ('ss_quantity <= 30)) && (((('ss_list_price >= 154) && ('ss_list_price <= (154 + 10))) || (('ss_coupon_amt >= 7326) && ('ss_coupon_amt <= (7326 + 1000)))) || (('ss_wholesale_cost >= 7) && ('ss_wholesale_cost <= (7 + 20)))))\n                  +- 'UnresolvedRelation `store_sales`\n\n== Analyzed Logical Plan ==\nB1_LP: decimal(11,6), B1_CNT: bigint, B1_CNTD: bigint, B2_LP: decimal(11,6), B2_CNT: bigint, B2_CNTD: bigint, B3_LP: decimal(11,6), B3_CNT: bigint, B3_CNTD: bigint, B4_LP: decimal(11,6), B4_CNT: bigint, B4_CNTD: bigint, B5_LP: decimal(11,6), B5_CNT: bigint, B5_CNTD: bigint, B6_LP: decimal(11,6), B6_CNT: bigint, B6_CNTD: bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [B1_LP#15094, B1_CNT#15095L, B1_CNTD#15096L, B2_LP#15097, B2_CNT#15098L, B2_CNTD#15099L, B3_LP#15100, B3_CNT#15101L, B3_CNTD#15102L, B4_LP#15103, B4_CNT#15104L, B4_CNTD#15105L, B5_LP#15106, B5_CNT#15107L, B5_CNTD#15108L, B6_LP#15109, B6_CNT#15110L, B6_CNTD#15111L]\n      +- Join Cross\n         :- Join Cross\n         :  :- Join Cross\n         :  :  :- Join Cross\n         :  :  :  :- Join Cross\n         :  :  :  :  :- SubqueryAlias B1\n         :  :  :  :  :  +- Aggregate [avg(ss_list_price#1915) AS B1_LP#15094, count(ss_list_price#1915) AS B1_CNT#15095L, count(distinct ss_list_price#1915) AS B1_CNTD#15096L]\n         :  :  :  :  :     +- Filter (((ss_quantity#1913 >= 0) && (ss_quantity#1913 <= 5)) && ((((cast(ss_list_price#1915 as decimal(7,2)) >= cast(cast(8 as decimal(1,0)) as decimal(7,2))) && (cast(ss_list_price#1915 as decimal(12,2)) <= cast(cast((8 + 10) as decimal(10,0)) as decimal(12,2)))) || ((cast(ss_coupon_amt#1922 as decimal(7,2)) >= cast(cast(459 as decimal(3,0)) as decimal(7,2))) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= cast(cast((459 + 1000) as decimal(10,0)) as decimal(12,2))))) || ((cast(ss_wholesale_cost#1914 as decimal(7,2)) >= cast(cast(57 as decimal(2,0)) as decimal(7,2))) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= cast(cast((57 + 20) as decimal(10,0)) as decimal(12,2))))))\n         :  :  :  :  :        +- SubqueryAlias store_sales\n         :  :  :  :  :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :  :  :  :  +- SubqueryAlias B2\n         :  :  :  :     +- Aggregate [avg(ss_list_price#1915) AS B2_LP#15097, count(ss_list_price#1915) AS B2_CNT#15098L, count(distinct ss_list_price#1915) AS B2_CNTD#15099L]\n         :  :  :  :        +- Filter (((ss_quantity#1913 >= 6) && (ss_quantity#1913 <= 10)) && ((((cast(ss_list_price#1915 as decimal(7,2)) >= cast(cast(90 as decimal(2,0)) as decimal(7,2))) && (cast(ss_list_price#1915 as decimal(12,2)) <= cast(cast((90 + 10) as decimal(10,0)) as decimal(12,2)))) || ((cast(ss_coupon_amt#1922 as decimal(7,2)) >= cast(cast(2323 as decimal(4,0)) as decimal(7,2))) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= cast(cast((2323 + 1000) as decimal(10,0)) as decimal(12,2))))) || ((cast(ss_wholesale_cost#1914 as decimal(7,2)) >= cast(cast(31 as decimal(2,0)) as decimal(7,2))) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= cast(cast((31 + 20) as decimal(10,0)) as decimal(12,2))))))\n         :  :  :  :           +- SubqueryAlias store_sales\n         :  :  :  :              +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :  :  :  +- SubqueryAlias B3\n         :  :  :     +- Aggregate [avg(ss_list_price#1915) AS B3_LP#15100, count(ss_list_price#1915) AS B3_CNT#15101L, count(distinct ss_list_price#1915) AS B3_CNTD#15102L]\n         :  :  :        +- Filter (((ss_quantity#1913 >= 11) && (ss_quantity#1913 <= 15)) && ((((cast(ss_list_price#1915 as decimal(7,2)) >= cast(cast(142 as decimal(3,0)) as decimal(7,2))) && (cast(ss_list_price#1915 as decimal(12,2)) <= cast(cast((142 + 10) as decimal(10,0)) as decimal(12,2)))) || ((cast(ss_coupon_amt#1922 as decimal(7,2)) >= cast(cast(12214 as decimal(5,0)) as decimal(7,2))) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= cast(cast((12214 + 1000) as decimal(10,0)) as decimal(12,2))))) || ((cast(ss_wholesale_cost#1914 as decimal(7,2)) >= cast(cast(79 as decimal(2,0)) as decimal(7,2))) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= cast(cast((79 + 20) as decimal(10,0)) as decimal(12,2))))))\n         :  :  :           +- SubqueryAlias store_sales\n         :  :  :              +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :  :  +- SubqueryAlias B4\n         :  :     +- Aggregate [avg(ss_list_price#1915) AS B4_LP#15103, count(ss_list_price#1915) AS B4_CNT#15104L, count(distinct ss_list_price#1915) AS B4_CNTD#15105L]\n         :  :        +- Filter (((ss_quantity#1913 >= 16) && (ss_quantity#1913 <= 20)) && ((((cast(ss_list_price#1915 as decimal(7,2)) >= cast(cast(135 as decimal(3,0)) as decimal(7,2))) && (cast(ss_list_price#1915 as decimal(12,2)) <= cast(cast((135 + 10) as decimal(10,0)) as decimal(12,2)))) || ((cast(ss_coupon_amt#1922 as decimal(7,2)) >= cast(cast(6071 as decimal(4,0)) as decimal(7,2))) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= cast(cast((6071 + 1000) as decimal(10,0)) as decimal(12,2))))) || ((cast(ss_wholesale_cost#1914 as decimal(7,2)) >= cast(cast(38 as decimal(2,0)) as decimal(7,2))) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= cast(cast((38 + 20) as decimal(10,0)) as decimal(12,2))))))\n         :  :           +- SubqueryAlias store_sales\n         :  :              +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :  +- SubqueryAlias B5\n         :     +- Aggregate [avg(ss_list_price#1915) AS B5_LP#15106, count(ss_list_price#1915) AS B5_CNT#15107L, count(distinct ss_list_price#1915) AS B5_CNTD#15108L]\n         :        +- Filter (((ss_quantity#1913 >= 21) && (ss_quantity#1913 <= 25)) && ((((cast(ss_list_price#1915 as decimal(7,2)) >= cast(cast(122 as decimal(3,0)) as decimal(7,2))) && (cast(ss_list_price#1915 as decimal(12,2)) <= cast(cast((122 + 10) as decimal(10,0)) as decimal(12,2)))) || ((cast(ss_coupon_amt#1922 as decimal(7,2)) >= cast(cast(836 as decimal(3,0)) as decimal(7,2))) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= cast(cast((836 + 1000) as decimal(10,0)) as decimal(12,2))))) || ((cast(ss_wholesale_cost#1914 as decimal(7,2)) >= cast(cast(17 as decimal(2,0)) as decimal(7,2))) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= cast(cast((17 + 20) as decimal(10,0)) as decimal(12,2))))))\n         :           +- SubqueryAlias store_sales\n         :              +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         +- SubqueryAlias B6\n            +- Aggregate [avg(ss_list_price#1915) AS B6_LP#15109, count(ss_list_price#1915) AS B6_CNT#15110L, count(distinct ss_list_price#1915) AS B6_CNTD#15111L]\n               +- Filter (((ss_quantity#1913 >= 26) && (ss_quantity#1913 <= 30)) && ((((cast(ss_list_price#1915 as decimal(7,2)) >= cast(cast(154 as decimal(3,0)) as decimal(7,2))) && (cast(ss_list_price#1915 as decimal(12,2)) <= cast(cast((154 + 10) as decimal(10,0)) as decimal(12,2)))) || ((cast(ss_coupon_amt#1922 as decimal(7,2)) >= cast(cast(7326 as decimal(4,0)) as decimal(7,2))) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= cast(cast((7326 + 1000) as decimal(10,0)) as decimal(12,2))))) || ((cast(ss_wholesale_cost#1914 as decimal(7,2)) >= cast(cast(7 as decimal(1,0)) as decimal(7,2))) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= cast(cast((7 + 20) as decimal(10,0)) as decimal(12,2))))))\n                  +- SubqueryAlias store_sales\n                     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Join Cross\n      :- Join Cross\n      :  :- Join Cross\n      :  :  :- Join Cross\n      :  :  :  :- Join Cross\n      :  :  :  :  :- Aggregate [cast((avg(UnscaledValue(ss_list_price#1915)) / 100.0) as decimal(11,6)) AS B1_LP#15094, count(ss_list_price#1915) AS B1_CNT#15095L, count(distinct ss_list_price#1915) AS B1_CNTD#15096L]\n      :  :  :  :  :  +- Project [ss_list_price#1915]\n      :  :  :  :  :     +- Filter (((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 0)) && (ss_quantity#1913 <= 5)) && ((((ss_list_price#1915 >= 8.00) && (cast(ss_list_price#1915 as decimal(12,2)) <= 18.00)) || ((ss_coupon_amt#1922 >= 459.00) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= 1459.00))) || ((ss_wholesale_cost#1914 >= 57.00) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= 77.00))))\n      :  :  :  :  :        +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :  :  :  :  +- Aggregate [cast((avg(UnscaledValue(ss_list_price#1915)) / 100.0) as decimal(11,6)) AS B2_LP#15097, count(ss_list_price#1915) AS B2_CNT#15098L, count(distinct ss_list_price#1915) AS B2_CNTD#15099L]\n      :  :  :  :     +- Project [ss_list_price#1915]\n      :  :  :  :        +- Filter (((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 6)) && (ss_quantity#1913 <= 10)) && ((((ss_list_price#1915 >= 90.00) && (cast(ss_list_price#1915 as decimal(12,2)) <= 100.00)) || ((ss_coupon_amt#1922 >= 2323.00) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= 3323.00))) || ((ss_wholesale_cost#1914 >= 31.00) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= 51.00))))\n      :  :  :  :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :  :  :  +- Aggregate [cast((avg(UnscaledValue(ss_list_price#1915)) / 100.0) as decimal(11,6)) AS B3_LP#15100, count(ss_list_price#1915) AS B3_CNT#15101L, count(distinct ss_list_price#1915) AS B3_CNTD#15102L]\n      :  :  :     +- Project [ss_list_price#1915]\n      :  :  :        +- Filter (((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 11)) && (ss_quantity#1913 <= 15)) && ((((ss_list_price#1915 >= 142.00) && (cast(ss_list_price#1915 as decimal(12,2)) <= 152.00)) || ((ss_coupon_amt#1922 >= 12214.00) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= 13214.00))) || ((ss_wholesale_cost#1914 >= 79.00) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= 99.00))))\n      :  :  :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :  :  +- Aggregate [cast((avg(UnscaledValue(ss_list_price#1915)) / 100.0) as decimal(11,6)) AS B4_LP#15103, count(ss_list_price#1915) AS B4_CNT#15104L, count(distinct ss_list_price#1915) AS B4_CNTD#15105L]\n      :  :     +- Project [ss_list_price#1915]\n      :  :        +- Filter (((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 16)) && (ss_quantity#1913 <= 20)) && ((((ss_list_price#1915 >= 135.00) && (cast(ss_list_price#1915 as decimal(12,2)) <= 145.00)) || ((ss_coupon_amt#1922 >= 6071.00) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= 7071.00))) || ((ss_wholesale_cost#1914 >= 38.00) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= 58.00))))\n      :  :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :  +- Aggregate [cast((avg(UnscaledValue(ss_list_price#1915)) / 100.0) as decimal(11,6)) AS B5_LP#15106, count(ss_list_price#1915) AS B5_CNT#15107L, count(distinct ss_list_price#1915) AS B5_CNTD#15108L]\n      :     +- Project [ss_list_price#1915]\n      :        +- Filter (((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 21)) && (ss_quantity#1913 <= 25)) && ((((ss_list_price#1915 >= 122.00) && (cast(ss_list_price#1915 as decimal(12,2)) <= 132.00)) || ((ss_coupon_amt#1922 >= 836.00) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= 1836.00))) || ((ss_wholesale_cost#1914 >= 17.00) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= 37.00))))\n      :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      +- Aggregate [cast((avg(UnscaledValue(ss_list_price#1915)) / 100.0) as decimal(11,6)) AS B6_LP#15109, count(ss_list_price#1915) AS B6_CNT#15110L, count(distinct ss_list_price#1915) AS B6_CNTD#15111L]\n         +- Project [ss_list_price#1915]\n            +- Filter (((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 26)) && (ss_quantity#1913 <= 30)) && ((((ss_list_price#1915 >= 154.00) && (cast(ss_list_price#1915 as decimal(12,2)) <= 164.00)) || ((ss_coupon_amt#1922 >= 7326.00) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= 8326.00))) || ((ss_wholesale_cost#1914 >= 7.00) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= 27.00))))\n               +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n\n== Physical Plan ==\nCollectLimit 100\n+- *(19) LocalLimit 100\n   +- BroadcastNestedLoopJoin BuildRight, Cross\n      :- BroadcastNestedLoopJoin BuildRight, Cross\n      :  :- BroadcastNestedLoopJoin BuildRight, Cross\n      :  :  :- BroadcastNestedLoopJoin BuildRight, Cross\n      :  :  :  :- BroadcastNestedLoopJoin BuildRight, Cross\n      :  :  :  :  :- *(3) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_list_price#1915)), count(ss_list_price#1915), count(distinct ss_list_price#1915)], output=[B1_LP#15094, B1_CNT#15095L, B1_CNTD#15096L])\n      :  :  :  :  :  +- Exchange SinglePartition\n      :  :  :  :  :     +- *(2) HashAggregate(keys=[], functions=[merge_avg(UnscaledValue(ss_list_price#1915)), merge_count(ss_list_price#1915), partial_count(distinct ss_list_price#1915)], output=[sum#15150, count#15151L, count#15153L, count#15156L])\n      :  :  :  :  :        +- *(2) HashAggregate(keys=[ss_list_price#1915], functions=[merge_avg(UnscaledValue(ss_list_price#1915)), merge_count(ss_list_price#1915)], output=[ss_list_price#1915, sum#15150, count#15151L, count#15153L])\n      :  :  :  :  :           +- Exchange hashpartitioning(ss_list_price#1915, 200)\n      :  :  :  :  :              +- *(1) HashAggregate(keys=[ss_list_price#1915], functions=[partial_avg(UnscaledValue(ss_list_price#1915)), partial_count(ss_list_price#1915)], output=[ss_list_price#1915, sum#15150, count#15151L, count#15153L])\n      :  :  :  :  :                 +- *(1) Project [ss_list_price#1915]\n      :  :  :  :  :                    +- *(1) Filter (((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 0)) && (ss_quantity#1913 <= 5)) && ((((ss_list_price#1915 >= 8.00) && (cast(ss_list_price#1915 as decimal(12,2)) <= 18.00)) || ((ss_coupon_amt#1922 >= 459.00) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= 1459.00))) || ((ss_wholesale_cost#1914 >= 57.00) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= 77.00))))\n      :  :  :  :  :                       +- *(1) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_coupon_amt#1922,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,0), LessThanOrEqual(ss_quantity,5)], ReadSchema: struct<ss_quantity:int,ss_wholesale_cost:decimal(7,2),ss_list_price:decimal(7,2),ss_coupon_amt:de...\n      :  :  :  :  +- BroadcastExchange IdentityBroadcastMode\n      :  :  :  :     +- *(6) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_list_price#1915)), count(ss_list_price#1915), count(distinct ss_list_price#1915)], output=[B2_LP#15097, B2_CNT#15098L, B2_CNTD#15099L])\n      :  :  :  :        +- Exchange SinglePartition\n      :  :  :  :           +- *(5) HashAggregate(keys=[], functions=[merge_avg(UnscaledValue(ss_list_price#1915)), merge_count(ss_list_price#1915), partial_count(distinct ss_list_price#1915)], output=[sum#15160, count#15161L, count#15163L, count#15166L])\n      :  :  :  :              +- *(5) HashAggregate(keys=[ss_list_price#1915], functions=[merge_avg(UnscaledValue(ss_list_price#1915)), merge_count(ss_list_price#1915)], output=[ss_list_price#1915, sum#15160, count#15161L, count#15163L])\n      :  :  :  :                 +- Exchange hashpartitioning(ss_list_price#1915, 200)\n      :  :  :  :                    +- *(4) HashAggregate(keys=[ss_list_price#1915], functions=[partial_avg(UnscaledValue(ss_list_price#1915)), partial_count(ss_list_price#1915)], output=[ss_list_price#1915, sum#15160, count#15161L, count#15163L])\n      :  :  :  :                       +- *(4) Project [ss_list_price#1915]\n      :  :  :  :                          +- *(4) Filter (((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 6)) && (ss_quantity#1913 <= 10)) && ((((ss_list_price#1915 >= 90.00) && (cast(ss_list_price#1915 as decimal(12,2)) <= 100.00)) || ((ss_coupon_amt#1922 >= 2323.00) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= 3323.00))) || ((ss_wholesale_cost#1914 >= 31.00) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= 51.00))))\n      :  :  :  :                             +- *(4) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_coupon_amt#1922,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,6), LessThanOrEqual(ss_quantity,10)], ReadSchema: struct<ss_quantity:int,ss_wholesale_cost:decimal(7,2),ss_list_price:decimal(7,2),ss_coupon_amt:de...\n      :  :  :  +- BroadcastExchange IdentityBroadcastMode\n      :  :  :     +- *(9) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_list_price#1915)), count(ss_list_price#1915), count(distinct ss_list_price#1915)], output=[B3_LP#15100, B3_CNT#15101L, B3_CNTD#15102L])\n      :  :  :        +- Exchange SinglePartition\n      :  :  :           +- *(8) HashAggregate(keys=[], functions=[merge_avg(UnscaledValue(ss_list_price#1915)), merge_count(ss_list_price#1915), partial_count(distinct ss_list_price#1915)], output=[sum#15170, count#15171L, count#15173L, count#15176L])\n      :  :  :              +- *(8) HashAggregate(keys=[ss_list_price#1915], functions=[merge_avg(UnscaledValue(ss_list_price#1915)), merge_count(ss_list_price#1915)], output=[ss_list_price#1915, sum#15170, count#15171L, count#15173L])\n      :  :  :                 +- Exchange hashpartitioning(ss_list_price#1915, 200)\n      :  :  :                    +- *(7) HashAggregate(keys=[ss_list_price#1915], functions=[partial_avg(UnscaledValue(ss_list_price#1915)), partial_count(ss_list_price#1915)], output=[ss_list_price#1915, sum#15170, count#15171L, count#15173L])\n      :  :  :                       +- *(7) Project [ss_list_price#1915]\n      :  :  :                          +- *(7) Filter (((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 11)) && (ss_quantity#1913 <= 15)) && ((((ss_list_price#1915 >= 142.00) && (cast(ss_list_price#1915 as decimal(12,2)) <= 152.00)) || ((ss_coupon_amt#1922 >= 12214.00) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= 13214.00))) || ((ss_wholesale_cost#1914 >= 79.00) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= 99.00))))\n      :  :  :                             +- *(7) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_coupon_amt#1922,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,11), LessThanOrEqual(ss_quantity,15)], ReadSchema: struct<ss_quantity:int,ss_wholesale_cost:decimal(7,2),ss_list_price:decimal(7,2),ss_coupon_amt:de...\n      :  :  +- BroadcastExchange IdentityBroadcastMode\n      :  :     +- *(12) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_list_price#1915)), count(ss_list_price#1915), count(distinct ss_list_price#1915)], output=[B4_LP#15103, B4_CNT#15104L, B4_CNTD#15105L])\n      :  :        +- Exchange SinglePartition\n      :  :           +- *(11) HashAggregate(keys=[], functions=[merge_avg(UnscaledValue(ss_list_price#1915)), merge_count(ss_list_price#1915), partial_count(distinct ss_list_price#1915)], output=[sum#15180, count#15181L, count#15183L, count#15186L])\n      :  :              +- *(11) HashAggregate(keys=[ss_list_price#1915], functions=[merge_avg(UnscaledValue(ss_list_price#1915)), merge_count(ss_list_price#1915)], output=[ss_list_price#1915, sum#15180, count#15181L, count#15183L])\n      :  :                 +- Exchange hashpartitioning(ss_list_price#1915, 200)\n      :  :                    +- *(10) HashAggregate(keys=[ss_list_price#1915], functions=[partial_avg(UnscaledValue(ss_list_price#1915)), partial_count(ss_list_price#1915)], output=[ss_list_price#1915, sum#15180, count#15181L, count#15183L])\n      :  :                       +- *(10) Project [ss_list_price#1915]\n      :  :                          +- *(10) Filter (((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 16)) && (ss_quantity#1913 <= 20)) && ((((ss_list_price#1915 >= 135.00) && (cast(ss_list_price#1915 as decimal(12,2)) <= 145.00)) || ((ss_coupon_amt#1922 >= 6071.00) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= 7071.00))) || ((ss_wholesale_cost#1914 >= 38.00) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= 58.00))))\n      :  :                             +- *(10) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_coupon_amt#1922,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,16), LessThanOrEqual(ss_quantity,20)], ReadSchema: struct<ss_quantity:int,ss_wholesale_cost:decimal(7,2),ss_list_price:decimal(7,2),ss_coupon_amt:de...\n      :  +- BroadcastExchange IdentityBroadcastMode\n      :     +- *(15) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_list_price#1915)), count(ss_list_price#1915), count(distinct ss_list_price#1915)], output=[B5_LP#15106, B5_CNT#15107L, B5_CNTD#15108L])\n      :        +- Exchange SinglePartition\n      :           +- *(14) HashAggregate(keys=[], functions=[merge_avg(UnscaledValue(ss_list_price#1915)), merge_count(ss_list_price#1915), partial_count(distinct ss_list_price#1915)], output=[sum#15190, count#15191L, count#15193L, count#15196L])\n      :              +- *(14) HashAggregate(keys=[ss_list_price#1915], functions=[merge_avg(UnscaledValue(ss_list_price#1915)), merge_count(ss_list_price#1915)], output=[ss_list_price#1915, sum#15190, count#15191L, count#15193L])\n      :                 +- Exchange hashpartitioning(ss_list_price#1915, 200)\n      :                    +- *(13) HashAggregate(keys=[ss_list_price#1915], functions=[partial_avg(UnscaledValue(ss_list_price#1915)), partial_count(ss_list_price#1915)], output=[ss_list_price#1915, sum#15190, count#15191L, count#15193L])\n      :                       +- *(13) Project [ss_list_price#1915]\n      :                          +- *(13) Filter (((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 21)) && (ss_quantity#1913 <= 25)) && ((((ss_list_price#1915 >= 122.00) && (cast(ss_list_price#1915 as decimal(12,2)) <= 132.00)) || ((ss_coupon_amt#1922 >= 836.00) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= 1836.00))) || ((ss_wholesale_cost#1914 >= 17.00) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= 37.00))))\n      :                             +- *(13) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_coupon_amt#1922,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,21), LessThanOrEqual(ss_quantity,25)], ReadSchema: struct<ss_quantity:int,ss_wholesale_cost:decimal(7,2),ss_list_price:decimal(7,2),ss_coupon_amt:de...\n      +- BroadcastExchange IdentityBroadcastMode\n         +- *(18) HashAggregate(keys=[], functions=[avg(UnscaledValue(ss_list_price#1915)), count(ss_list_price#1915), count(distinct ss_list_price#1915)], output=[B6_LP#15109, B6_CNT#15110L, B6_CNTD#15111L])\n            +- Exchange SinglePartition\n               +- *(17) HashAggregate(keys=[], functions=[merge_avg(UnscaledValue(ss_list_price#1915)), merge_count(ss_list_price#1915), partial_count(distinct ss_list_price#1915)], output=[sum#15200, count#15201L, count#15203L, count#15206L])\n                  +- *(17) HashAggregate(keys=[ss_list_price#1915], functions=[merge_avg(UnscaledValue(ss_list_price#1915)), merge_count(ss_list_price#1915)], output=[ss_list_price#1915, sum#15200, count#15201L, count#15203L])\n                     +- Exchange hashpartitioning(ss_list_price#1915, 200)\n                        +- *(16) HashAggregate(keys=[ss_list_price#1915], functions=[partial_avg(UnscaledValue(ss_list_price#1915)), partial_count(ss_list_price#1915)], output=[ss_list_price#1915, sum#15200, count#15201L, count#15203L])\n                           +- *(16) Project [ss_list_price#1915]\n                              +- *(16) Filter (((isnotnull(ss_quantity#1913) && (ss_quantity#1913 >= 26)) && (ss_quantity#1913 <= 30)) && ((((ss_list_price#1915 >= 154.00) && (cast(ss_list_price#1915 as decimal(12,2)) <= 164.00)) || ((ss_coupon_amt#1922 >= 7326.00) && (cast(ss_coupon_amt#1922 as decimal(12,2)) <= 8326.00))) || ((ss_wholesale_cost#1914 >= 7.00) && (cast(ss_wholesale_cost#1914 as decimal(12,2)) <= 27.00))))\n                                 +- *(16) FileScan parquet db_tpcds.store_sales[ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_coupon_amt#1922,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_quantity), GreaterThanOrEqual(ss_quantity,26), LessThanOrEqual(ss_quantity,30)], ReadSchema: struct<ss_quantity:int,ss_wholesale_cost:decimal(7,2),ss_list_price:decimal(7,2),ss_coupon_amt:de..."},{"name":"q29-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin"],"tables":["store_sales","store_returns","catalog_sales","date_dim","date_dim","date_dim","store","item"],"parsingTime":0.002581,"analysisTime":7.56E-4,"optimizationTime":821.970784,"planningTime":34.943683,"executionTime":7992.353962,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_item_id ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST, 's_store_id ASC NULLS FIRST, 's_store_name ASC NULLS FIRST], true\n      +- 'Aggregate ['i_item_id, 'i_item_desc, 's_store_id, 's_store_name], ['i_item_id, 'i_item_desc, 's_store_id, 's_store_name, 'sum('ss_quantity) AS store_sales_quantity#15402, 'sum('sr_return_quantity) AS store_returns_quantity#15403, 'sum('cs_quantity) AS catalog_sales_quantity#15404]\n         +- 'Filter ((((('d1.d_moy = 9) && ('d1.d_year = 1999)) && (('d1.d_date_sk = 'ss_sold_date_sk) && ('i_item_sk = 'ss_item_sk))) && ((('s_store_sk = 'ss_store_sk) && ('ss_customer_sk = 'sr_customer_sk)) && (('ss_item_sk = 'sr_item_sk) && ('ss_ticket_number = 'sr_ticket_number)))) && (((('sr_returned_date_sk = 'd2.d_date_sk) && (('d2.d_moy >= 9) && ('d2.d_moy <= (9 + 3)))) && (('d2.d_year = 1999) && ('sr_customer_sk = 'cs_bill_customer_sk))) && ((('sr_item_sk = 'cs_item_sk) && ('cs_sold_date_sk = 'd3.d_date_sk)) && 'd3.d_year IN (1999,(1999 + 1),(1999 + 2)))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'Join Inner\n               :  :  :  :  :- 'Join Inner\n               :  :  :  :  :  :- 'Join Inner\n               :  :  :  :  :  :  :- 'UnresolvedRelation `store_sales`\n               :  :  :  :  :  :  +- 'UnresolvedRelation `store_returns`\n               :  :  :  :  :  +- 'UnresolvedRelation `catalog_sales`\n               :  :  :  :  +- 'SubqueryAlias d1\n               :  :  :  :     +- 'UnresolvedRelation `date_dim`\n               :  :  :  +- 'SubqueryAlias d2\n               :  :  :     +- 'UnresolvedRelation `date_dim`\n               :  :  +- 'SubqueryAlias d3\n               :  :     +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `store`\n               +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\ni_item_id: string, i_item_desc: string, s_store_id: string, s_store_name: string, store_sales_quantity: bigint, store_returns_quantity: bigint, catalog_sales_quantity: bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391, store_sales_quantity#15402L, store_returns_quantity#15403L, catalog_sales_quantity#15404L]\n      +- Sort [i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, s_store_id#1387 ASC NULLS FIRST, s_store_name#1391 ASC NULLS FIRST], true\n         +- Aggregate [i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391], [i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391, sum(cast(ss_quantity#1913 as bigint)) AS store_sales_quantity#15402L, sum(cast(sr_return_quantity#1713 as bigint)) AS store_returns_quantity#15403L, sum(cast(cs_quantity#1806 as bigint)) AS catalog_sales_quantity#15404L]\n            +- Filter (((((d_moy#1048 = 9) && (d_year#1046 = 1999)) && ((d_date_sk#1040 = ss_sold_date_sk#1926) && (i_item_sk#1172 = ss_item_sk#1905))) && (((s_store_sk#1386 = ss_store_sk#1910) && (ss_customer_sk#1906 = sr_customer_sk#1706)) && ((ss_item_sk#1905 = sr_item_sk#1705) && (ss_ticket_number#1912L = sr_ticket_number#1712L)))) && ((((sr_returned_date_sk#1723 = d_date_sk#15405) && ((d_moy#15413 >= 9) && (d_moy#15413 <= (9 + 3)))) && ((d_year#15411 = 1999) && (sr_customer_sk#1706 = cs_bill_customer_sk#1791))) && (((sr_item_sk#1705 = cs_item_sk#1803) && (cs_sold_date_sk#1822 = d_date_sk#15433)) && d_year#15439 IN (1999,(1999 + 1),(1999 + 2)))))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- Join Inner\n                  :  :  :  :- Join Inner\n                  :  :  :  :  :- Join Inner\n                  :  :  :  :  :  :- Join Inner\n                  :  :  :  :  :  :  :- SubqueryAlias store_sales\n                  :  :  :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :  :  :  :  :  :  +- SubqueryAlias store_returns\n                  :  :  :  :  :  :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                  :  :  :  :  :  +- SubqueryAlias catalog_sales\n                  :  :  :  :  :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                  :  :  :  :  +- SubqueryAlias d1\n                  :  :  :  :     +- SubqueryAlias date_dim\n                  :  :  :  :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :  :  :  +- SubqueryAlias d2\n                  :  :  :     +- SubqueryAlias date_dim\n                  :  :  :        +- Relation[d_date_sk#15405,d_date_id#15406,d_date#15407,d_month_seq#15408,d_week_seq#15409,d_quarter_seq#15410,d_year#15411,d_dow#15412,d_moy#15413,d_dom#15414,d_qoy#15415,d_fy_year#15416,d_fy_quarter_seq#15417,d_fy_week_seq#15418,d_day_name#15419,d_quarter_name#15420,d_holiday#15421,d_weekend#15422,d_following_holiday#15423,d_first_dom#15424,d_last_dom#15425,d_same_day_ly#15426,d_same_day_lq#15427,d_current_day#15428,... 4 more fields] parquet\n                  :  :  +- SubqueryAlias d3\n                  :  :     +- SubqueryAlias date_dim\n                  :  :        +- Relation[d_date_sk#15433,d_date_id#15434,d_date#15435,d_month_seq#15436,d_week_seq#15437,d_quarter_seq#15438,d_year#15439,d_dow#15440,d_moy#15441,d_dom#15442,d_qoy#15443,d_fy_year#15444,d_fy_quarter_seq#15445,d_fy_week_seq#15446,d_day_name#15447,d_quarter_name#15448,d_holiday#15449,d_weekend#15450,d_following_holiday#15451,d_first_dom#15452,d_last_dom#15453,d_same_day_ly#15454,d_same_day_lq#15455,d_current_day#15456,... 4 more fields] parquet\n                  :  +- SubqueryAlias store\n                  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                  +- SubqueryAlias item\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, s_store_id#1387 ASC NULLS FIRST, s_store_name#1391 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391], [i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391, sum(cast(ss_quantity#1913 as bigint)) AS store_sales_quantity#15402L, sum(cast(sr_return_quantity#1713 as bigint)) AS store_returns_quantity#15403L, sum(cast(cs_quantity#1806 as bigint)) AS catalog_sales_quantity#15404L]\n         +- Project [ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806, s_store_id#1387, s_store_name#1391, i_item_id#1173, i_item_desc#1176]\n            +- Join Inner, (i_item_sk#1172 = ss_item_sk#1905)\n               :- Project [ss_item_sk#1905, ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806, s_store_id#1387, s_store_name#1391]\n               :  +- Join Inner, (s_store_sk#1386 = ss_store_sk#1910)\n               :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806]\n               :     :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#15433)\n               :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :  +- Join Inner, (sr_returned_date_sk#1723 = d_date_sk#15405)\n               :     :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, sr_return_quantity#1713, sr_returned_date_sk#1723, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :  +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n               :     :     :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_sold_date_sk#1926, sr_return_quantity#1713, sr_returned_date_sk#1723, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :     :  +- Join Inner, ((sr_customer_sk#1706 = cs_bill_customer_sk#1791) && (sr_item_sk#1705 = cs_item_sk#1803))\n               :     :     :     :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_sold_date_sk#1926, sr_item_sk#1705, sr_customer_sk#1706, sr_return_quantity#1713, sr_returned_date_sk#1723]\n               :     :     :     :     :     :  +- Join Inner, (((ss_customer_sk#1906 = sr_customer_sk#1706) && (ss_item_sk#1905 = sr_item_sk#1705)) && (ss_ticket_number#1912L = sr_ticket_number#1712L))\n               :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_quantity#1913, ss_sold_date_sk#1926]\n               :     :     :     :     :     :     :  +- Filter ((((isnotnull(ss_item_sk#1905) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_store_sk#1910))\n               :     :     :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :     :     :     :     :     +- Project [sr_item_sk#1705, sr_customer_sk#1706, sr_ticket_number#1712L, sr_return_quantity#1713, sr_returned_date_sk#1723]\n               :     :     :     :     :     :        +- Filter (((isnotnull(sr_customer_sk#1706) && isnotnull(sr_ticket_number#1712L)) && isnotnull(sr_item_sk#1705)) && isnotnull(sr_returned_date_sk#1723))\n               :     :     :     :     :     :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :     :     :     :     :     +- Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :     :        +- Filter ((isnotnull(cs_item_sk#1803) && isnotnull(cs_bill_customer_sk#1791)) && isnotnull(cs_sold_date_sk#1822))\n               :     :     :     :     :           +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :     :     :     +- Project [d_date_sk#1040]\n               :     :     :     :        +- Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 9)) && (d_year#1046 = 1999)) && isnotnull(d_date_sk#1040))\n               :     :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :     :     +- Project [d_date_sk#15405]\n               :     :     :        +- Filter (((((isnotnull(d_year#15411) && isnotnull(d_moy#15413)) && (d_moy#15413 >= 9)) && (d_moy#15413 <= 12)) && (d_year#15411 = 1999)) && isnotnull(d_date_sk#15405))\n               :     :     :           +- Relation[d_date_sk#15405,d_date_id#15406,d_date#15407,d_month_seq#15408,d_week_seq#15409,d_quarter_seq#15410,d_year#15411,d_dow#15412,d_moy#15413,d_dom#15414,d_qoy#15415,d_fy_year#15416,d_fy_quarter_seq#15417,d_fy_week_seq#15418,d_day_name#15419,d_quarter_name#15420,d_holiday#15421,d_weekend#15422,d_following_holiday#15423,d_first_dom#15424,d_last_dom#15425,d_same_day_ly#15426,d_same_day_lq#15427,d_current_day#15428,... 4 more fields] parquet\n               :     :     +- Project [d_date_sk#15433]\n               :     :        +- Filter (d_year#15439 IN (1999,2000,2001) && isnotnull(d_date_sk#15433))\n               :     :           +- Relation[d_date_sk#15433,d_date_id#15434,d_date#15435,d_month_seq#15436,d_week_seq#15437,d_quarter_seq#15438,d_year#15439,d_dow#15440,d_moy#15441,d_dom#15442,d_qoy#15443,d_fy_year#15444,d_fy_quarter_seq#15445,d_fy_week_seq#15446,d_day_name#15447,d_quarter_name#15448,d_holiday#15449,d_weekend#15450,d_following_holiday#15451,d_first_dom#15452,d_last_dom#15453,d_same_day_ly#15454,d_same_day_lq#15455,d_current_day#15456,... 4 more fields] parquet\n               :     +- Project [s_store_sk#1386, s_store_id#1387, s_store_name#1391]\n               :        +- Filter isnotnull(s_store_sk#1386)\n               :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               +- Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176]\n                  +- Filter isnotnull(i_item_sk#1172)\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_item_id#1173 ASC NULLS FIRST,i_item_desc#1176 ASC NULLS FIRST,s_store_id#1387 ASC NULLS FIRST,s_store_name#1391 ASC NULLS FIRST], output=[i_item_id#1173,i_item_desc#1176,s_store_id#1387,s_store_name#1391,store_sales_quantity#15402L,store_returns_quantity#15403L,catalog_sales_quantity#15404L])\n+- *(12) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391], functions=[sum(cast(ss_quantity#1913 as bigint)), sum(cast(sr_return_quantity#1713 as bigint)), sum(cast(cs_quantity#1806 as bigint))], output=[i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391, store_sales_quantity#15402L, store_returns_quantity#15403L, catalog_sales_quantity#15404L])\n   +- Exchange hashpartitioning(i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391, 200)\n      +- *(11) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391], functions=[partial_sum(cast(ss_quantity#1913 as bigint)), partial_sum(cast(sr_return_quantity#1713 as bigint)), partial_sum(cast(cs_quantity#1806 as bigint))], output=[i_item_id#1173, i_item_desc#1176, s_store_id#1387, s_store_name#1391, sum#15478L, sum#15479L, sum#15480L])\n         +- *(11) Project [ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806, s_store_id#1387, s_store_name#1391, i_item_id#1173, i_item_desc#1176]\n            +- *(11) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :- *(11) Project [ss_item_sk#1905, ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806, s_store_id#1387, s_store_name#1391]\n               :  +- *(11) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n               :     :- *(11) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806]\n               :     :  +- *(11) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#15433], Inner, BuildRight\n               :     :     :- *(11) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, sr_return_quantity#1713, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :  +- *(11) BroadcastHashJoin [sr_returned_date_sk#1723], [d_date_sk#15405], Inner, BuildRight\n               :     :     :     :- *(11) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, sr_return_quantity#1713, sr_returned_date_sk#1723, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :  +- *(11) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :     :     :     :- *(11) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_sold_date_sk#1926, sr_return_quantity#1713, sr_returned_date_sk#1723, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :     :  +- *(11) SortMergeJoin [sr_customer_sk#1706, sr_item_sk#1705], [cs_bill_customer_sk#1791, cs_item_sk#1803], Inner\n               :     :     :     :     :     :- *(3) Sort [sr_customer_sk#1706 ASC NULLS FIRST, sr_item_sk#1705 ASC NULLS FIRST], false, 0\n               :     :     :     :     :     :  +- Exchange hashpartitioning(sr_customer_sk#1706, sr_item_sk#1705, 200)\n               :     :     :     :     :     :     +- *(2) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_sold_date_sk#1926, sr_item_sk#1705, sr_customer_sk#1706, sr_return_quantity#1713, sr_returned_date_sk#1723]\n               :     :     :     :     :     :        +- *(2) BroadcastHashJoin [ss_customer_sk#1906, ss_item_sk#1905, ss_ticket_number#1912L], [sr_customer_sk#1706, sr_item_sk#1705, sr_ticket_number#1712L], Inner, BuildRight\n               :     :     :     :     :     :           :- *(2) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_quantity#1913, ss_sold_date_sk#1926]\n               :     :     :     :     :     :           :  +- *(2) Filter (((isnotnull(ss_item_sk#1905) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910))\n               :     :     :     :     :     :           :     +- *(2) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_store_sk#1910,ss_ticket_number#1912L,ss_quantity#1913,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_stor..., ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_store_sk:int,ss_ticket_number:bigint,ss_quantity:int>\n               :     :     :     :     :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, int, true], input[0, int, true], input[2, bigint, true]))\n               :     :     :     :     :     :              +- *(1) Project [sr_item_sk#1705, sr_customer_sk#1706, sr_ticket_number#1712L, sr_return_quantity#1713, sr_returned_date_sk#1723]\n               :     :     :     :     :     :                 +- *(1) Filter ((isnotnull(sr_customer_sk#1706) && isnotnull(sr_ticket_number#1712L)) && isnotnull(sr_item_sk#1705))\n               :     :     :     :     :     :                    +- *(1) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_customer_sk#1706,sr_ticket_number#1712L,sr_return_quantity#1713,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns/sr_..., PartitionCount: 2001, PartitionFilters: [isnotnull(sr_returned_date_sk#1723)], PushedFilters: [IsNotNull(sr_customer_sk), IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:int,sr_customer_sk:int,sr_ticket_number:bigint,sr_return_quantity:int>\n               :     :     :     :     :     +- *(5) Sort [cs_bill_customer_sk#1791 ASC NULLS FIRST, cs_item_sk#1803 ASC NULLS FIRST], false, 0\n               :     :     :     :     :        +- Exchange hashpartitioning(cs_bill_customer_sk#1791, cs_item_sk#1803, 200)\n               :     :     :     :     :           +- *(4) Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :     :              +- *(4) Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_bill_customer_sk#1791))\n               :     :     :     :     :                 +- *(4) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_item_sk#1803,cs_quantity#1806,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:int,cs_item_sk:int,cs_quantity:int>\n               :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :     :        +- *(6) Project [d_date_sk#1040]\n               :     :     :     :           +- *(6) Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 9)) && (d_year#1046 = 1999)) && isnotnull(d_date_sk#1040))\n               :     :     :     :              +- *(6) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,9), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :        +- *(7) Project [d_date_sk#15405]\n               :     :     :           +- *(7) Filter (((((isnotnull(d_year#15411) && isnotnull(d_moy#15413)) && (d_moy#15413 >= 9)) && (d_moy#15413 <= 12)) && (d_year#15411 = 1999)) && isnotnull(d_date_sk#15405))\n               :     :     :              +- *(7) FileScan parquet db_tpcds.date_dim[d_date_sk#15405,d_year#15411,d_moy#15413] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), GreaterThanOrEqual(d_moy,9), LessThanOrEqual(d_moy,12), Equ..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(8) Project [d_date_sk#15433]\n               :     :           +- *(8) Filter (d_year#15439 IN (1999,2000,2001) && isnotnull(d_date_sk#15433))\n               :     :              +- *(8) FileScan parquet db_tpcds.date_dim[d_date_sk#15433,d_year#15439] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [In(d_year, [1999,2000,2001]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(9) Project [s_store_sk#1386, s_store_id#1387, s_store_name#1391]\n               :           +- *(9) Filter isnotnull(s_store_sk#1386)\n               :              +- *(9) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_id#1387,s_store_name#1391] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_store_id:string,s_store_name:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(10) Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176]\n                     +- *(10) Filter isnotnull(i_item_sk#1172)\n                        +- *(10) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173,i_item_desc#1176] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string,i_item_desc:string>"},{"name":"q30-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["customer_total_return","customer_address","customer"],"parsingTime":0.002076,"analysisTime":7.03E-4,"optimizationTime":665.837574,"planningTime":46.782776,"executionTime":8018.267423,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [customer_total_return]\n:  +- 'SubqueryAlias customer_total_return\n:     +- 'Aggregate ['wr_returning_customer_sk, 'ca_state], ['wr_returning_customer_sk AS ctr_customer_sk#15587, 'ca_state AS ctr_state#15588, 'sum('wr_return_amt) AS ctr_total_return#15589]\n:        +- 'Filter ((('wr_returned_date_sk = 'd_date_sk) && ('d_year = 2002)) && ('wr_returning_addr_sk = 'ca_address_sk))\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'UnresolvedRelation `web_returns`\n:              :  +- 'UnresolvedRelation `date_dim`\n:              +- 'UnresolvedRelation `customer_address`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['c_customer_id ASC NULLS FIRST, 'c_salutation ASC NULLS FIRST, 'c_first_name ASC NULLS FIRST, 'c_last_name ASC NULLS FIRST, 'c_preferred_cust_flag ASC NULLS FIRST, 'c_birth_day ASC NULLS FIRST, 'c_birth_month ASC NULLS FIRST, 'c_birth_year ASC NULLS FIRST, 'c_birth_country ASC NULLS FIRST, 'c_login ASC NULLS FIRST, 'c_email_address ASC NULLS FIRST, 'c_last_review_date ASC NULLS FIRST, 'ctr_total_return ASC NULLS FIRST], true\n         +- 'Project ['c_customer_id, 'c_salutation, 'c_first_name, 'c_last_name, 'c_preferred_cust_flag, 'c_birth_day, 'c_birth_month, 'c_birth_year, 'c_birth_country, 'c_login, 'c_email_address, 'c_last_review_date, 'ctr_total_return]\n            +- 'Filter ((('ctr1.ctr_total_return > scalar-subquery#15586 []) && ('ca_address_sk = 'c_current_addr_sk)) && (('ca_state = GA) && ('ctr1.ctr_customer_sk = 'c_customer_sk)))\n               :  +- 'Project [unresolvedalias(('avg('ctr_total_return) * 1.2), None)]\n               :     +- 'Filter ('ctr1.ctr_state = 'ctr2.ctr_state)\n               :        +- 'SubqueryAlias ctr2\n               :           +- 'UnresolvedRelation `customer_total_return`\n               +- 'Join Inner\n                  :- 'Join Inner\n                  :  :- 'SubqueryAlias ctr1\n                  :  :  +- 'UnresolvedRelation `customer_total_return`\n                  :  +- 'UnresolvedRelation `customer_address`\n                  +- 'UnresolvedRelation `customer`\n\n== Analyzed Logical Plan ==\nc_customer_id: string, c_salutation: string, c_first_name: string, c_last_name: string, c_preferred_cust_flag: string, c_birth_day: int, c_birth_month: int, c_birth_year: int, c_birth_country: string, c_login: string, c_email_address: string, c_last_review_date: string, ctr_total_return: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [c_customer_id#861 ASC NULLS FIRST, c_salutation#867 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, c_last_name#869 ASC NULLS FIRST, c_preferred_cust_flag#870 ASC NULLS FIRST, c_birth_day#871 ASC NULLS FIRST, c_birth_month#872 ASC NULLS FIRST, c_birth_year#873 ASC NULLS FIRST, c_birth_country#874 ASC NULLS FIRST, c_login#875 ASC NULLS FIRST, c_email_address#876 ASC NULLS FIRST, c_last_review_date#877 ASC NULLS FIRST, ctr_total_return#15589 ASC NULLS FIRST], true\n      +- Project [c_customer_id#861, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_day#871, c_birth_month#872, c_birth_year#873, c_birth_country#874, c_login#875, c_email_address#876, c_last_review_date#877, ctr_total_return#15589]\n         +- Filter (((cast(ctr_total_return#15589 as decimal(24,7)) > cast(scalar-subquery#15586 [ctr_state#15588] as decimal(24,7))) && (ca_address_sk#922 = c_current_addr_sk#864)) && ((ca_state#930 = GA) && (ctr_customer_sk#15587 = c_customer_sk#860)))\n            :  +- Aggregate [CheckOverflow((promote_precision(cast(avg(ctr_total_return#15589) as decimal(21,6))) * promote_precision(cast(1.2 as decimal(21,6)))), DecimalType(24,7)) AS (CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#15592]\n            :     +- Filter (outer(ctr_state#15588) = ctr_state#15588)\n            :        +- SubqueryAlias ctr2\n            :           +- SubqueryAlias customer_total_return\n            :              +- Aggregate [wr_returning_customer_sk#2123, ca_state#930], [wr_returning_customer_sk#2123 AS ctr_customer_sk#15587, ca_state#930 AS ctr_state#15588, sum(wr_return_amt#2131) AS ctr_total_return#15589]\n            :                 +- Filter (((wr_returned_date_sk#2140 = d_date_sk#1040) && (d_year#1046 = 2002)) && (wr_returning_addr_sk#2126 = ca_address_sk#922))\n            :                    +- Join Inner\n            :                       :- Join Inner\n            :                       :  :- SubqueryAlias web_returns\n            :                       :  :  +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n            :                       :  +- SubqueryAlias date_dim\n            :                       :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :                       +- SubqueryAlias customer_address\n            :                          +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias ctr1\n               :  :  +- SubqueryAlias customer_total_return\n               :  :     +- Aggregate [wr_returning_customer_sk#2123, ca_state#930], [wr_returning_customer_sk#2123 AS ctr_customer_sk#15587, ca_state#930 AS ctr_state#15588, sum(wr_return_amt#2131) AS ctr_total_return#15589]\n               :  :        +- Filter (((wr_returned_date_sk#2140 = d_date_sk#1040) && (d_year#1046 = 2002)) && (wr_returning_addr_sk#2126 = ca_address_sk#922))\n               :  :           +- Join Inner\n               :  :              :- Join Inner\n               :  :              :  :- SubqueryAlias web_returns\n               :  :              :  :  +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n               :  :              :  +- SubqueryAlias date_dim\n               :  :              :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :              +- SubqueryAlias customer_address\n               :  :                 +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               :  +- SubqueryAlias customer_address\n               :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- SubqueryAlias customer\n                  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [c_customer_id#861 ASC NULLS FIRST, c_salutation#867 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, c_last_name#869 ASC NULLS FIRST, c_preferred_cust_flag#870 ASC NULLS FIRST, c_birth_day#871 ASC NULLS FIRST, c_birth_month#872 ASC NULLS FIRST, c_birth_year#873 ASC NULLS FIRST, c_birth_country#874 ASC NULLS FIRST, c_login#875 ASC NULLS FIRST, c_email_address#876 ASC NULLS FIRST, c_last_review_date#877 ASC NULLS FIRST, ctr_total_return#15589 ASC NULLS FIRST], true\n      +- Project [c_customer_id#861, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_day#871, c_birth_month#872, c_birth_year#873, c_birth_country#874, c_login#875, c_email_address#876, c_last_review_date#877, ctr_total_return#15589]\n         +- Join Inner, (ca_address_sk#922 = c_current_addr_sk#864)\n            :- Project [ctr_total_return#15589, c_customer_id#861, c_current_addr_sk#864, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_day#871, c_birth_month#872, c_birth_year#873, c_birth_country#874, c_login#875, c_email_address#876, c_last_review_date#877]\n            :  +- Join Inner, (ctr_customer_sk#15587 = c_customer_sk#860)\n            :     :- Project [ctr_customer_sk#15587, ctr_total_return#15589]\n            :     :  +- Join Inner, ((cast(ctr_total_return#15589 as decimal(24,7)) > (CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#15592) && (ctr_state#15588 = ctr_state#15588#15606))\n            :     :     :- Filter isnotnull(ctr_total_return#15589)\n            :     :     :  +- Aggregate [wr_returning_customer_sk#2123, ca_state#930], [wr_returning_customer_sk#2123 AS ctr_customer_sk#15587, ca_state#930 AS ctr_state#15588, MakeDecimal(sum(UnscaledValue(wr_return_amt#2131)),17,2) AS ctr_total_return#15589]\n            :     :     :     +- Project [wr_returning_customer_sk#2123, wr_return_amt#2131, ca_state#930]\n            :     :     :        +- Join Inner, (wr_returning_addr_sk#2126 = ca_address_sk#922)\n            :     :     :           :- Project [wr_returning_customer_sk#2123, wr_returning_addr_sk#2126, wr_return_amt#2131]\n            :     :     :           :  +- Join Inner, (wr_returned_date_sk#2140 = d_date_sk#1040)\n            :     :     :           :     :- Project [wr_returning_customer_sk#2123, wr_returning_addr_sk#2126, wr_return_amt#2131, wr_returned_date_sk#2140]\n            :     :     :           :     :  +- Filter ((isnotnull(wr_returned_date_sk#2140) && isnotnull(wr_returning_addr_sk#2126)) && isnotnull(wr_returning_customer_sk#2123))\n            :     :     :           :     :     +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n            :     :     :           :     +- Project [d_date_sk#1040]\n            :     :     :           :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n            :     :     :           :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :     :           +- Project [ca_address_sk#922, ca_state#930]\n            :     :     :              +- Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_state#930))\n            :     :     :                 +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :     :     +- Filter isnotnull((CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#15592)\n            :     :        +- Aggregate [ctr_state#15588], [CheckOverflow((promote_precision(avg(ctr_total_return#15589)) * 1.200000), DecimalType(24,7)) AS (CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#15592, ctr_state#15588 AS ctr_state#15588#15606]\n            :     :           +- Aggregate [wr_returning_customer_sk#2123, ca_state#930], [ca_state#930 AS ctr_state#15588, MakeDecimal(sum(UnscaledValue(wr_return_amt#2131)),17,2) AS ctr_total_return#15589]\n            :     :              +- Project [wr_returning_customer_sk#2123, wr_return_amt#2131, ca_state#930]\n            :     :                 +- Join Inner, (wr_returning_addr_sk#2126 = ca_address_sk#922)\n            :     :                    :- Project [wr_returning_customer_sk#2123, wr_returning_addr_sk#2126, wr_return_amt#2131]\n            :     :                    :  +- Join Inner, (wr_returned_date_sk#2140 = d_date_sk#1040)\n            :     :                    :     :- Project [wr_returning_customer_sk#2123, wr_returning_addr_sk#2126, wr_return_amt#2131, wr_returned_date_sk#2140]\n            :     :                    :     :  +- Filter (isnotnull(wr_returned_date_sk#2140) && isnotnull(wr_returning_addr_sk#2126))\n            :     :                    :     :     +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n            :     :                    :     +- Project [d_date_sk#1040]\n            :     :                    :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n            :     :                    :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :                    +- Project [ca_address_sk#922, ca_state#930]\n            :     :                       +- Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_state#930))\n            :     :                          +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :     +- Project [c_customer_sk#860, c_customer_id#861, c_current_addr_sk#864, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_day#871, c_birth_month#872, c_birth_year#873, c_birth_country#874, c_login#875, c_email_address#876, c_last_review_date#877]\n            :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n            :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            +- Project [ca_address_sk#922]\n               +- Filter ((isnotnull(ca_state#930) && (ca_state#930 = GA)) && isnotnull(ca_address_sk#922))\n                  +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[c_customer_id#861 ASC NULLS FIRST,c_salutation#867 ASC NULLS FIRST,c_first_name#868 ASC NULLS FIRST,c_last_name#869 ASC NULLS FIRST,c_preferred_cust_flag#870 ASC NULLS FIRST,c_birth_day#871 ASC NULLS FIRST,c_birth_month#872 ASC NULLS FIRST,c_birth_year#873 ASC NULLS FIRST,c_birth_country#874 ASC NULLS FIRST,c_login#875 ASC NULLS FIRST,c_email_address#876 ASC NULLS FIRST,c_last_review_date#877 ASC NULLS FIRST,ctr_total_return#15589 ASC NULLS FIRST], output=[c_customer_id#861,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877,ctr_total_return#15589])\n+- *(14) Project [c_customer_id#861, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_day#871, c_birth_month#872, c_birth_year#873, c_birth_country#874, c_login#875, c_email_address#876, c_last_review_date#877, ctr_total_return#15589]\n   +- *(14) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n      :- *(14) Project [ctr_total_return#15589, c_customer_id#861, c_current_addr_sk#864, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_day#871, c_birth_month#872, c_birth_year#873, c_birth_country#874, c_login#875, c_email_address#876, c_last_review_date#877]\n      :  +- *(14) BroadcastHashJoin [ctr_customer_sk#15587], [c_customer_sk#860], Inner, BuildRight\n      :     :- *(14) Project [ctr_customer_sk#15587, ctr_total_return#15589]\n      :     :  +- *(14) SortMergeJoin [ctr_state#15588], [ctr_state#15588#15606], Inner, (cast(ctr_total_return#15589 as decimal(24,7)) > (CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#15592)\n      :     :     :- *(5) Sort [ctr_state#15588 ASC NULLS FIRST], false, 0\n      :     :     :  +- Exchange hashpartitioning(ctr_state#15588, 200)\n      :     :     :     +- *(4) Filter isnotnull(ctr_total_return#15589)\n      :     :     :        +- *(4) HashAggregate(keys=[wr_returning_customer_sk#2123, ca_state#930], functions=[sum(UnscaledValue(wr_return_amt#2131))], output=[ctr_customer_sk#15587, ctr_state#15588, ctr_total_return#15589])\n      :     :     :           +- Exchange hashpartitioning(wr_returning_customer_sk#2123, ca_state#930, 200)\n      :     :     :              +- *(3) HashAggregate(keys=[wr_returning_customer_sk#2123, ca_state#930], functions=[partial_sum(UnscaledValue(wr_return_amt#2131))], output=[wr_returning_customer_sk#2123, ca_state#930, sum#15608L])\n      :     :     :                 +- *(3) Project [wr_returning_customer_sk#2123, wr_return_amt#2131, ca_state#930]\n      :     :     :                    +- *(3) BroadcastHashJoin [wr_returning_addr_sk#2126], [ca_address_sk#922], Inner, BuildRight\n      :     :     :                       :- *(3) Project [wr_returning_customer_sk#2123, wr_returning_addr_sk#2126, wr_return_amt#2131]\n      :     :     :                       :  +- *(3) BroadcastHashJoin [wr_returned_date_sk#2140], [d_date_sk#1040], Inner, BuildRight\n      :     :     :                       :     :- *(3) Project [wr_returning_customer_sk#2123, wr_returning_addr_sk#2126, wr_return_amt#2131, wr_returned_date_sk#2140]\n      :     :     :                       :     :  +- *(3) Filter (isnotnull(wr_returning_addr_sk#2126) && isnotnull(wr_returning_customer_sk#2123))\n      :     :     :                       :     :     +- *(3) FileScan parquet db_tpcds.web_returns[wr_returning_customer_sk#2123,wr_returning_addr_sk#2126,wr_return_amt#2131,wr_returned_date_sk#2140] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_returns/wr_re..., PartitionCount: 2109, PartitionFilters: [isnotnull(wr_returned_date_sk#2140)], PushedFilters: [IsNotNull(wr_returning_addr_sk), IsNotNull(wr_returning_customer_sk)], ReadSchema: struct<wr_returning_customer_sk:int,wr_returning_addr_sk:int,wr_return_amt:decimal(7,2)>\n      :     :     :                       :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :     :                       :        +- *(1) Project [d_date_sk#1040]\n      :     :     :                       :           +- *(1) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n      :     :     :                       :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n      :     :     :                       +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :     :                          +- *(2) Project [ca_address_sk#922, ca_state#930]\n      :     :     :                             +- *(2) Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_state#930))\n      :     :     :                                +- *(2) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_state)], ReadSchema: struct<ca_address_sk:int,ca_state:string>\n      :     :     +- *(11) Sort [ctr_state#15588#15606 ASC NULLS FIRST], false, 0\n      :     :        +- Exchange hashpartitioning(ctr_state#15588#15606, 200)\n      :     :           +- *(10) Filter isnotnull((CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#15592)\n      :     :              +- *(10) HashAggregate(keys=[ctr_state#15588], functions=[avg(ctr_total_return#15589)], output=[(CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#15592, ctr_state#15588#15606])\n      :     :                 +- Exchange hashpartitioning(ctr_state#15588, 200)\n      :     :                    +- *(9) HashAggregate(keys=[ctr_state#15588], functions=[partial_avg(ctr_total_return#15589)], output=[ctr_state#15588, sum#15611, count#15612L])\n      :     :                       +- *(9) HashAggregate(keys=[wr_returning_customer_sk#2123, ca_state#930], functions=[sum(UnscaledValue(wr_return_amt#2131))], output=[ctr_state#15588, ctr_total_return#15589])\n      :     :                          +- Exchange hashpartitioning(wr_returning_customer_sk#2123, ca_state#930, 200)\n      :     :                             +- *(8) HashAggregate(keys=[wr_returning_customer_sk#2123, ca_state#930], functions=[partial_sum(UnscaledValue(wr_return_amt#2131))], output=[wr_returning_customer_sk#2123, ca_state#930, sum#15614L])\n      :     :                                +- *(8) Project [wr_returning_customer_sk#2123, wr_return_amt#2131, ca_state#930]\n      :     :                                   +- *(8) BroadcastHashJoin [wr_returning_addr_sk#2126], [ca_address_sk#922], Inner, BuildRight\n      :     :                                      :- *(8) Project [wr_returning_customer_sk#2123, wr_returning_addr_sk#2126, wr_return_amt#2131]\n      :     :                                      :  +- *(8) BroadcastHashJoin [wr_returned_date_sk#2140], [d_date_sk#1040], Inner, BuildRight\n      :     :                                      :     :- *(8) Project [wr_returning_customer_sk#2123, wr_returning_addr_sk#2126, wr_return_amt#2131, wr_returned_date_sk#2140]\n      :     :                                      :     :  +- *(8) Filter isnotnull(wr_returning_addr_sk#2126)\n      :     :                                      :     :     +- *(8) FileScan parquet db_tpcds.web_returns[wr_returning_customer_sk#2123,wr_returning_addr_sk#2126,wr_return_amt#2131,wr_returned_date_sk#2140] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_returns/wr_re..., PartitionCount: 2109, PartitionFilters: [isnotnull(wr_returned_date_sk#2140)], PushedFilters: [IsNotNull(wr_returning_addr_sk)], ReadSchema: struct<wr_returning_customer_sk:int,wr_returning_addr_sk:int,wr_return_amt:decimal(7,2)>\n      :     :                                      :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                                      +- ReusedExchange [ca_address_sk#922, ca_state#930], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :        +- *(12) Project [c_customer_sk#860, c_customer_id#861, c_current_addr_sk#864, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870, c_birth_day#871, c_birth_month#872, c_birth_year#873, c_birth_country#874, c_login#875, c_email_address#876, c_last_review_date#877]\n      :           +- *(12) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n      :              +- *(12) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_customer_id#861,c_current_addr_sk#864,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_current_addr_sk:int,c_salutation:string,c_first_n...\n      +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         +- *(13) Project [ca_address_sk#922]\n            +- *(13) Filter ((isnotnull(ca_state#930) && (ca_state#930 = GA)) && isnotnull(ca_address_sk#922))\n               +- *(13) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_state), EqualTo(ca_state,GA), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string>"},{"name":"q31-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","SortMergeJoin","SortMergeJoin","SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["ss","ss","ss","ws","ws","ws"],"parsingTime":0.00223,"analysisTime":8.23E-4,"optimizationTime":1396.502432,"planningTime":158.528055,"executionTime":16528.981243,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ss, ws]\n:  :- 'SubqueryAlias ss\n:  :  +- 'Aggregate ['ca_county, 'd_qoy, 'd_year], ['ca_county, 'd_qoy, 'd_year, 'sum('ss_ext_sales_price) AS store_sales#16117]\n:  :     +- 'Filter (('ss_sold_date_sk = 'd_date_sk) && ('ss_addr_sk = 'ca_address_sk))\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'UnresolvedRelation `store_sales`\n:  :           :  +- 'UnresolvedRelation `date_dim`\n:  :           +- 'UnresolvedRelation `customer_address`\n:  +- 'SubqueryAlias ws\n:     +- 'Aggregate ['ca_county, 'd_qoy, 'd_year], ['ca_county, 'd_qoy, 'd_year, 'sum('ws_ext_sales_price) AS web_sales#16118]\n:        +- 'Filter (('ws_sold_date_sk = 'd_date_sk) && ('ws_bill_addr_sk = 'ca_address_sk))\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'UnresolvedRelation `web_sales`\n:              :  +- 'UnresolvedRelation `date_dim`\n:              +- 'UnresolvedRelation `customer_address`\n+- 'Sort ['ss1.ca_county ASC NULLS FIRST], true\n   +- 'Project ['ss1.ca_county, 'ss1.d_year, ('ws2.web_sales / 'ws1.web_sales) AS web_q1_q2_increase#16113, ('ss2.store_sales / 'ss1.store_sales) AS store_q1_q2_increase#16114, ('ws3.web_sales / 'ws2.web_sales) AS web_q2_q3_increase#16115, ('ss3.store_sales / 'ss2.store_sales) AS store_q2_q3_increase#16116]\n      +- 'Filter (((((('ss1.d_qoy = 1) && ('ss1.d_year = 2000)) && ('ss1.ca_county = 'ss2.ca_county)) && (('ss2.d_qoy = 2) && ('ss2.d_year = 2000))) && (((('ss2.ca_county = 'ss3.ca_county) && ('ss3.d_qoy = 3)) && ('ss3.d_year = 2000)) && (('ss1.ca_county = 'ws1.ca_county) && ('ws1.d_qoy = 1)))) && ((((('ws1.d_year = 2000) && ('ws1.ca_county = 'ws2.ca_county)) && ('ws2.d_qoy = 2)) && (('ws2.d_year = 2000) && ('ws1.ca_county = 'ws3.ca_county))) && ((('ws3.d_qoy = 3) && ('ws3.d_year = 2000)) && ((CASE WHEN ('ws1.web_sales > 0) THEN ('ws2.web_sales / 'ws1.web_sales) ELSE null END > CASE WHEN ('ss1.store_sales > 0) THEN ('ss2.store_sales / 'ss1.store_sales) ELSE null END) && (CASE WHEN ('ws2.web_sales > 0) THEN ('ws3.web_sales / 'ws2.web_sales) ELSE null END > CASE WHEN ('ss2.store_sales > 0) THEN ('ss3.store_sales / 'ss2.store_sales) ELSE null END)))))\n         +- 'Join Inner\n            :- 'Join Inner\n            :  :- 'Join Inner\n            :  :  :- 'Join Inner\n            :  :  :  :- 'Join Inner\n            :  :  :  :  :- 'SubqueryAlias ss1\n            :  :  :  :  :  +- 'UnresolvedRelation `ss`\n            :  :  :  :  +- 'SubqueryAlias ss2\n            :  :  :  :     +- 'UnresolvedRelation `ss`\n            :  :  :  +- 'SubqueryAlias ss3\n            :  :  :     +- 'UnresolvedRelation `ss`\n            :  :  +- 'SubqueryAlias ws1\n            :  :     +- 'UnresolvedRelation `ws`\n            :  +- 'SubqueryAlias ws2\n            :     +- 'UnresolvedRelation `ws`\n            +- 'SubqueryAlias ws3\n               +- 'UnresolvedRelation `ws`\n\n== Analyzed Logical Plan ==\nca_county: string, d_year: int, web_q1_q2_increase: decimal(37,20), store_q1_q2_increase: decimal(37,20), web_q2_q3_increase: decimal(37,20), store_q2_q3_increase: decimal(37,20)\nSort [ca_county#929 ASC NULLS FIRST], true\n+- Project [ca_county#929, d_year#1046, CheckOverflow((promote_precision(cast(web_sales#16367 as decimal(17,2))) / promote_precision(cast(web_sales#16118 as decimal(17,2)))), DecimalType(37,20)) AS web_q1_q2_increase#16113, CheckOverflow((promote_precision(cast(store_sales#16121 as decimal(17,2))) / promote_precision(cast(store_sales#16117 as decimal(17,2)))), DecimalType(37,20)) AS store_q1_q2_increase#16114, CheckOverflow((promote_precision(cast(web_sales#16463 as decimal(17,2))) / promote_precision(cast(web_sales#16367 as decimal(17,2)))), DecimalType(37,20)) AS web_q2_q3_increase#16115, CheckOverflow((promote_precision(cast(store_sales#16217 as decimal(17,2))) / promote_precision(cast(store_sales#16121 as decimal(17,2)))), DecimalType(37,20)) AS store_q2_q3_increase#16116]\n   +- Filter ((((((d_qoy#1050 = 1) && (d_year#1046 = 2000)) && (ca_county#929 = ca_county#16211)) && ((d_qoy#16173 = 2) && (d_year#16169 = 2000))) && ((((ca_county#16211 = ca_county#16307) && (d_qoy#16269 = 3)) && (d_year#16265 = 2000)) && ((ca_county#929 = ca_county#16361) && (d_qoy#16323 = 1)))) && (((((d_year#16319 = 2000) && (ca_county#16361 = ca_county#16457)) && (d_qoy#16419 = 2)) && ((d_year#16415 = 2000) && (ca_county#16361 = ca_county#16553))) && (((d_qoy#16515 = 3) && (d_year#16511 = 2000)) && ((CASE WHEN (cast(web_sales#16118 as decimal(17,2)) > cast(cast(0 as decimal(1,0)) as decimal(17,2))) THEN CheckOverflow((promote_precision(cast(web_sales#16367 as decimal(17,2))) / promote_precision(cast(web_sales#16118 as decimal(17,2)))), DecimalType(37,20)) ELSE cast(null as decimal(37,20)) END > CASE WHEN (cast(store_sales#16117 as decimal(17,2)) > cast(cast(0 as decimal(1,0)) as decimal(17,2))) THEN CheckOverflow((promote_precision(cast(store_sales#16121 as decimal(17,2))) / promote_precision(cast(store_sales#16117 as decimal(17,2)))), DecimalType(37,20)) ELSE cast(null as decimal(37,20)) END) && (CASE WHEN (cast(web_sales#16367 as decimal(17,2)) > cast(cast(0 as decimal(1,0)) as decimal(17,2))) THEN CheckOverflow((promote_precision(cast(web_sales#16463 as decimal(17,2))) / promote_precision(cast(web_sales#16367 as decimal(17,2)))), DecimalType(37,20)) ELSE cast(null as decimal(37,20)) END > CASE WHEN (cast(store_sales#16121 as decimal(17,2)) > cast(cast(0 as decimal(1,0)) as decimal(17,2))) THEN CheckOverflow((promote_precision(cast(store_sales#16217 as decimal(17,2))) / promote_precision(cast(store_sales#16121 as decimal(17,2)))), DecimalType(37,20)) ELSE cast(null as decimal(37,20)) END)))))\n      +- Join Inner\n         :- Join Inner\n         :  :- Join Inner\n         :  :  :- Join Inner\n         :  :  :  :- Join Inner\n         :  :  :  :  :- SubqueryAlias ss1\n         :  :  :  :  :  +- SubqueryAlias ss\n         :  :  :  :  :     +- Aggregate [ca_county#929, d_qoy#1050, d_year#1046], [ca_county#929, d_qoy#1050, d_year#1046, sum(ss_ext_sales_price#1918) AS store_sales#16117]\n         :  :  :  :  :        +- Filter ((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_addr_sk#1909 = ca_address_sk#922))\n         :  :  :  :  :           +- Join Inner\n         :  :  :  :  :              :- Join Inner\n         :  :  :  :  :              :  :- SubqueryAlias store_sales\n         :  :  :  :  :              :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :  :  :  :  :              :  +- SubqueryAlias date_dim\n         :  :  :  :  :              :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :  :  :  :  :              +- SubqueryAlias customer_address\n         :  :  :  :  :                 +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n         :  :  :  :  +- SubqueryAlias ss2\n         :  :  :  :     +- SubqueryAlias ss\n         :  :  :  :        +- Aggregate [ca_county#16211, d_qoy#16173, d_year#16169], [ca_county#16211, d_qoy#16173, d_year#16169, sum(ss_ext_sales_price#1918) AS store_sales#16121]\n         :  :  :  :           +- Filter ((ss_sold_date_sk#1926 = d_date_sk#16163) && (ss_addr_sk#1909 = ca_address_sk#16204))\n         :  :  :  :              +- Join Inner\n         :  :  :  :                 :- Join Inner\n         :  :  :  :                 :  :- SubqueryAlias store_sales\n         :  :  :  :                 :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :  :  :  :                 :  +- SubqueryAlias date_dim\n         :  :  :  :                 :     +- Relation[d_date_sk#16163,d_date_id#16164,d_date#16165,d_month_seq#16166,d_week_seq#16167,d_quarter_seq#16168,d_year#16169,d_dow#16170,d_moy#16171,d_dom#16172,d_qoy#16173,d_fy_year#16174,d_fy_quarter_seq#16175,d_fy_week_seq#16176,d_day_name#16177,d_quarter_name#16178,d_holiday#16179,d_weekend#16180,d_following_holiday#16181,d_first_dom#16182,d_last_dom#16183,d_same_day_ly#16184,d_same_day_lq#16185,d_current_day#16186,... 4 more fields] parquet\n         :  :  :  :                 +- SubqueryAlias customer_address\n         :  :  :  :                    +- Relation[ca_address_sk#16204,ca_address_id#16205,ca_street_number#16206,ca_street_name#16207,ca_street_type#16208,ca_suite_number#16209,ca_city#16210,ca_county#16211,ca_state#16212,ca_zip#16213,ca_country#16214,ca_gmt_offset#16215,ca_location_type#16216] parquet\n         :  :  :  +- SubqueryAlias ss3\n         :  :  :     +- SubqueryAlias ss\n         :  :  :        +- Aggregate [ca_county#16307, d_qoy#16269, d_year#16265], [ca_county#16307, d_qoy#16269, d_year#16265, sum(ss_ext_sales_price#1918) AS store_sales#16217]\n         :  :  :           +- Filter ((ss_sold_date_sk#1926 = d_date_sk#16259) && (ss_addr_sk#1909 = ca_address_sk#16300))\n         :  :  :              +- Join Inner\n         :  :  :                 :- Join Inner\n         :  :  :                 :  :- SubqueryAlias store_sales\n         :  :  :                 :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :  :  :                 :  +- SubqueryAlias date_dim\n         :  :  :                 :     +- Relation[d_date_sk#16259,d_date_id#16260,d_date#16261,d_month_seq#16262,d_week_seq#16263,d_quarter_seq#16264,d_year#16265,d_dow#16266,d_moy#16267,d_dom#16268,d_qoy#16269,d_fy_year#16270,d_fy_quarter_seq#16271,d_fy_week_seq#16272,d_day_name#16273,d_quarter_name#16274,d_holiday#16275,d_weekend#16276,d_following_holiday#16277,d_first_dom#16278,d_last_dom#16279,d_same_day_ly#16280,d_same_day_lq#16281,d_current_day#16282,... 4 more fields] parquet\n         :  :  :                 +- SubqueryAlias customer_address\n         :  :  :                    +- Relation[ca_address_sk#16300,ca_address_id#16301,ca_street_number#16302,ca_street_name#16303,ca_street_type#16304,ca_suite_number#16305,ca_city#16306,ca_county#16307,ca_state#16308,ca_zip#16309,ca_country#16310,ca_gmt_offset#16311,ca_location_type#16312] parquet\n         :  :  +- SubqueryAlias ws1\n         :  :     +- SubqueryAlias ws\n         :  :        +- Aggregate [ca_county#16361, d_qoy#16323, d_year#16319], [ca_county#16361, d_qoy#16323, d_year#16319, sum(ws_ext_sales_price#1777) AS web_sales#16118]\n         :  :           +- Filter ((ws_sold_date_sk#1788 = d_date_sk#16313) && (ws_bill_addr_sk#1761 = ca_address_sk#16354))\n         :  :              +- Join Inner\n         :  :                 :- Join Inner\n         :  :                 :  :- SubqueryAlias web_sales\n         :  :                 :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n         :  :                 :  +- SubqueryAlias date_dim\n         :  :                 :     +- Relation[d_date_sk#16313,d_date_id#16314,d_date#16315,d_month_seq#16316,d_week_seq#16317,d_quarter_seq#16318,d_year#16319,d_dow#16320,d_moy#16321,d_dom#16322,d_qoy#16323,d_fy_year#16324,d_fy_quarter_seq#16325,d_fy_week_seq#16326,d_day_name#16327,d_quarter_name#16328,d_holiday#16329,d_weekend#16330,d_following_holiday#16331,d_first_dom#16332,d_last_dom#16333,d_same_day_ly#16334,d_same_day_lq#16335,d_current_day#16336,... 4 more fields] parquet\n         :  :                 +- SubqueryAlias customer_address\n         :  :                    +- Relation[ca_address_sk#16354,ca_address_id#16355,ca_street_number#16356,ca_street_name#16357,ca_street_type#16358,ca_suite_number#16359,ca_city#16360,ca_county#16361,ca_state#16362,ca_zip#16363,ca_country#16364,ca_gmt_offset#16365,ca_location_type#16366] parquet\n         :  +- SubqueryAlias ws2\n         :     +- SubqueryAlias ws\n         :        +- Aggregate [ca_county#16457, d_qoy#16419, d_year#16415], [ca_county#16457, d_qoy#16419, d_year#16415, sum(ws_ext_sales_price#1777) AS web_sales#16367]\n         :           +- Filter ((ws_sold_date_sk#1788 = d_date_sk#16409) && (ws_bill_addr_sk#1761 = ca_address_sk#16450))\n         :              +- Join Inner\n         :                 :- Join Inner\n         :                 :  :- SubqueryAlias web_sales\n         :                 :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n         :                 :  +- SubqueryAlias date_dim\n         :                 :     +- Relation[d_date_sk#16409,d_date_id#16410,d_date#16411,d_month_seq#16412,d_week_seq#16413,d_quarter_seq#16414,d_year#16415,d_dow#16416,d_moy#16417,d_dom#16418,d_qoy#16419,d_fy_year#16420,d_fy_quarter_seq#16421,d_fy_week_seq#16422,d_day_name#16423,d_quarter_name#16424,d_holiday#16425,d_weekend#16426,d_following_holiday#16427,d_first_dom#16428,d_last_dom#16429,d_same_day_ly#16430,d_same_day_lq#16431,d_current_day#16432,... 4 more fields] parquet\n         :                 +- SubqueryAlias customer_address\n         :                    +- Relation[ca_address_sk#16450,ca_address_id#16451,ca_street_number#16452,ca_street_name#16453,ca_street_type#16454,ca_suite_number#16455,ca_city#16456,ca_county#16457,ca_state#16458,ca_zip#16459,ca_country#16460,ca_gmt_offset#16461,ca_location_type#16462] parquet\n         +- SubqueryAlias ws3\n            +- SubqueryAlias ws\n               +- Aggregate [ca_county#16553, d_qoy#16515, d_year#16511], [ca_county#16553, d_qoy#16515, d_year#16511, sum(ws_ext_sales_price#1777) AS web_sales#16463]\n                  +- Filter ((ws_sold_date_sk#1788 = d_date_sk#16505) && (ws_bill_addr_sk#1761 = ca_address_sk#16546))\n                     +- Join Inner\n                        :- Join Inner\n                        :  :- SubqueryAlias web_sales\n                        :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        :  +- SubqueryAlias date_dim\n                        :     +- Relation[d_date_sk#16505,d_date_id#16506,d_date#16507,d_month_seq#16508,d_week_seq#16509,d_quarter_seq#16510,d_year#16511,d_dow#16512,d_moy#16513,d_dom#16514,d_qoy#16515,d_fy_year#16516,d_fy_quarter_seq#16517,d_fy_week_seq#16518,d_day_name#16519,d_quarter_name#16520,d_holiday#16521,d_weekend#16522,d_following_holiday#16523,d_first_dom#16524,d_last_dom#16525,d_same_day_ly#16526,d_same_day_lq#16527,d_current_day#16528,... 4 more fields] parquet\n                        +- SubqueryAlias customer_address\n                           +- Relation[ca_address_sk#16546,ca_address_id#16547,ca_street_number#16548,ca_street_name#16549,ca_street_type#16550,ca_suite_number#16551,ca_city#16552,ca_county#16553,ca_state#16554,ca_zip#16555,ca_country#16556,ca_gmt_offset#16557,ca_location_type#16558] parquet\n\n== Optimized Logical Plan ==\nSort [ca_county#929 ASC NULLS FIRST], true\n+- Project [ca_county#929, d_year#1046, CheckOverflow((promote_precision(web_sales#16367) / promote_precision(web_sales#16118)), DecimalType(37,20)) AS web_q1_q2_increase#16113, CheckOverflow((promote_precision(store_sales#16121) / promote_precision(store_sales#16117)), DecimalType(37,20)) AS store_q1_q2_increase#16114, CheckOverflow((promote_precision(web_sales#16463) / promote_precision(web_sales#16367)), DecimalType(37,20)) AS web_q2_q3_increase#16115, CheckOverflow((promote_precision(store_sales#16217) / promote_precision(store_sales#16121)), DecimalType(37,20)) AS store_q2_q3_increase#16116]\n   +- Join Inner, ((ca_county#16361 = ca_county#16553) && (CASE WHEN (web_sales#16367 > 0.00) THEN CheckOverflow((promote_precision(web_sales#16463) / promote_precision(web_sales#16367)), DecimalType(37,20)) ELSE null END > CASE WHEN (store_sales#16121 > 0.00) THEN CheckOverflow((promote_precision(store_sales#16217) / promote_precision(store_sales#16121)), DecimalType(37,20)) ELSE null END))\n      :- Project [ca_county#929, d_year#1046, store_sales#16117, store_sales#16121, store_sales#16217, ca_county#16361, web_sales#16118, web_sales#16367]\n      :  +- Join Inner, ((ca_county#16361 = ca_county#16457) && (CASE WHEN (web_sales#16118 > 0.00) THEN CheckOverflow((promote_precision(web_sales#16367) / promote_precision(web_sales#16118)), DecimalType(37,20)) ELSE null END > CASE WHEN (store_sales#16117 > 0.00) THEN CheckOverflow((promote_precision(store_sales#16121) / promote_precision(store_sales#16117)), DecimalType(37,20)) ELSE null END))\n      :     :- Join Inner, (ca_county#929 = ca_county#16361)\n      :     :  :- Project [ca_county#929, d_year#1046, store_sales#16117, store_sales#16121, store_sales#16217]\n      :     :  :  +- Join Inner, (ca_county#16211 = ca_county#16307)\n      :     :  :     :- Join Inner, (ca_county#929 = ca_county#16211)\n      :     :  :     :  :- Aggregate [ca_county#929, d_qoy#1050, d_year#1046], [ca_county#929, d_year#1046, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS store_sales#16117]\n      :     :  :     :  :  +- Project [ss_ext_sales_price#1918, d_year#1046, d_qoy#1050, ca_county#929]\n      :     :  :     :  :     +- Join Inner, (ss_addr_sk#1909 = ca_address_sk#922)\n      :     :  :     :  :        :- Project [ss_addr_sk#1909, ss_ext_sales_price#1918, d_year#1046, d_qoy#1050]\n      :     :  :     :  :        :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n      :     :  :     :  :        :     :- Project [ss_addr_sk#1909, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n      :     :  :     :  :        :     :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_addr_sk#1909))\n      :     :  :     :  :        :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :     :  :     :  :        :     +- Project [d_date_sk#1040, d_year#1046, d_qoy#1050]\n      :     :  :     :  :        :        +- Filter ((((isnotnull(d_qoy#1050) && isnotnull(d_year#1046)) && (d_qoy#1050 = 1)) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n      :     :  :     :  :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n      :     :  :     :  :        +- Project [ca_address_sk#922, ca_county#929]\n      :     :  :     :  :           +- Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_county#929))\n      :     :  :     :  :              +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n      :     :  :     :  +- Aggregate [ca_county#16211, d_qoy#16173, d_year#16169], [ca_county#16211, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS store_sales#16121]\n      :     :  :     :     +- Project [ss_ext_sales_price#1918, d_year#16169, d_qoy#16173, ca_county#16211]\n      :     :  :     :        +- Join Inner, (ss_addr_sk#1909 = ca_address_sk#16204)\n      :     :  :     :           :- Project [ss_addr_sk#1909, ss_ext_sales_price#1918, d_year#16169, d_qoy#16173]\n      :     :  :     :           :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#16163)\n      :     :  :     :           :     :- Project [ss_addr_sk#1909, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n      :     :  :     :           :     :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_addr_sk#1909))\n      :     :  :     :           :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :     :  :     :           :     +- Project [d_date_sk#16163, d_year#16169, d_qoy#16173]\n      :     :  :     :           :        +- Filter ((((isnotnull(d_qoy#16173) && isnotnull(d_year#16169)) && (d_qoy#16173 = 2)) && (d_year#16169 = 2000)) && isnotnull(d_date_sk#16163))\n      :     :  :     :           :           +- Relation[d_date_sk#16163,d_date_id#16164,d_date#16165,d_month_seq#16166,d_week_seq#16167,d_quarter_seq#16168,d_year#16169,d_dow#16170,d_moy#16171,d_dom#16172,d_qoy#16173,d_fy_year#16174,d_fy_quarter_seq#16175,d_fy_week_seq#16176,d_day_name#16177,d_quarter_name#16178,d_holiday#16179,d_weekend#16180,d_following_holiday#16181,d_first_dom#16182,d_last_dom#16183,d_same_day_ly#16184,d_same_day_lq#16185,d_current_day#16186,... 4 more fields] parquet\n      :     :  :     :           +- Project [ca_address_sk#16204, ca_county#16211]\n      :     :  :     :              +- Filter (isnotnull(ca_address_sk#16204) && isnotnull(ca_county#16211))\n      :     :  :     :                 +- Relation[ca_address_sk#16204,ca_address_id#16205,ca_street_number#16206,ca_street_name#16207,ca_street_type#16208,ca_suite_number#16209,ca_city#16210,ca_county#16211,ca_state#16212,ca_zip#16213,ca_country#16214,ca_gmt_offset#16215,ca_location_type#16216] parquet\n      :     :  :     +- Aggregate [ca_county#16307, d_qoy#16269, d_year#16265], [ca_county#16307, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS store_sales#16217]\n      :     :  :        +- Project [ss_ext_sales_price#1918, d_year#16265, d_qoy#16269, ca_county#16307]\n      :     :  :           +- Join Inner, (ss_addr_sk#1909 = ca_address_sk#16300)\n      :     :  :              :- Project [ss_addr_sk#1909, ss_ext_sales_price#1918, d_year#16265, d_qoy#16269]\n      :     :  :              :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#16259)\n      :     :  :              :     :- Project [ss_addr_sk#1909, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n      :     :  :              :     :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_addr_sk#1909))\n      :     :  :              :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :     :  :              :     +- Project [d_date_sk#16259, d_year#16265, d_qoy#16269]\n      :     :  :              :        +- Filter ((((isnotnull(d_qoy#16269) && isnotnull(d_year#16265)) && (d_qoy#16269 = 3)) && (d_year#16265 = 2000)) && isnotnull(d_date_sk#16259))\n      :     :  :              :           +- Relation[d_date_sk#16259,d_date_id#16260,d_date#16261,d_month_seq#16262,d_week_seq#16263,d_quarter_seq#16264,d_year#16265,d_dow#16266,d_moy#16267,d_dom#16268,d_qoy#16269,d_fy_year#16270,d_fy_quarter_seq#16271,d_fy_week_seq#16272,d_day_name#16273,d_quarter_name#16274,d_holiday#16275,d_weekend#16276,d_following_holiday#16277,d_first_dom#16278,d_last_dom#16279,d_same_day_ly#16280,d_same_day_lq#16281,d_current_day#16282,... 4 more fields] parquet\n      :     :  :              +- Project [ca_address_sk#16300, ca_county#16307]\n      :     :  :                 +- Filter (isnotnull(ca_address_sk#16300) && isnotnull(ca_county#16307))\n      :     :  :                    +- Relation[ca_address_sk#16300,ca_address_id#16301,ca_street_number#16302,ca_street_name#16303,ca_street_type#16304,ca_suite_number#16305,ca_city#16306,ca_county#16307,ca_state#16308,ca_zip#16309,ca_country#16310,ca_gmt_offset#16311,ca_location_type#16312] parquet\n      :     :  +- Aggregate [ca_county#16361, d_qoy#16323, d_year#16319], [ca_county#16361, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#1777)),17,2) AS web_sales#16118]\n      :     :     +- Project [ws_ext_sales_price#1777, d_year#16319, d_qoy#16323, ca_county#16361]\n      :     :        +- Join Inner, (ws_bill_addr_sk#1761 = ca_address_sk#16354)\n      :     :           :- Project [ws_bill_addr_sk#1761, ws_ext_sales_price#1777, d_year#16319, d_qoy#16323]\n      :     :           :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#16313)\n      :     :           :     :- Project [ws_bill_addr_sk#1761, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n      :     :           :     :  +- Filter (isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_bill_addr_sk#1761))\n      :     :           :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n      :     :           :     +- Project [d_date_sk#16313, d_year#16319, d_qoy#16323]\n      :     :           :        +- Filter ((((isnotnull(d_qoy#16323) && isnotnull(d_year#16319)) && (d_qoy#16323 = 1)) && (d_year#16319 = 2000)) && isnotnull(d_date_sk#16313))\n      :     :           :           +- Relation[d_date_sk#16313,d_date_id#16314,d_date#16315,d_month_seq#16316,d_week_seq#16317,d_quarter_seq#16318,d_year#16319,d_dow#16320,d_moy#16321,d_dom#16322,d_qoy#16323,d_fy_year#16324,d_fy_quarter_seq#16325,d_fy_week_seq#16326,d_day_name#16327,d_quarter_name#16328,d_holiday#16329,d_weekend#16330,d_following_holiday#16331,d_first_dom#16332,d_last_dom#16333,d_same_day_ly#16334,d_same_day_lq#16335,d_current_day#16336,... 4 more fields] parquet\n      :     :           +- Project [ca_address_sk#16354, ca_county#16361]\n      :     :              +- Filter (isnotnull(ca_address_sk#16354) && isnotnull(ca_county#16361))\n      :     :                 +- Relation[ca_address_sk#16354,ca_address_id#16355,ca_street_number#16356,ca_street_name#16357,ca_street_type#16358,ca_suite_number#16359,ca_city#16360,ca_county#16361,ca_state#16362,ca_zip#16363,ca_country#16364,ca_gmt_offset#16365,ca_location_type#16366] parquet\n      :     +- Aggregate [ca_county#16457, d_qoy#16419, d_year#16415], [ca_county#16457, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#1777)),17,2) AS web_sales#16367]\n      :        +- Project [ws_ext_sales_price#1777, d_year#16415, d_qoy#16419, ca_county#16457]\n      :           +- Join Inner, (ws_bill_addr_sk#1761 = ca_address_sk#16450)\n      :              :- Project [ws_bill_addr_sk#1761, ws_ext_sales_price#1777, d_year#16415, d_qoy#16419]\n      :              :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#16409)\n      :              :     :- Project [ws_bill_addr_sk#1761, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n      :              :     :  +- Filter (isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_bill_addr_sk#1761))\n      :              :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n      :              :     +- Project [d_date_sk#16409, d_year#16415, d_qoy#16419]\n      :              :        +- Filter ((((isnotnull(d_qoy#16419) && isnotnull(d_year#16415)) && (d_qoy#16419 = 2)) && (d_year#16415 = 2000)) && isnotnull(d_date_sk#16409))\n      :              :           +- Relation[d_date_sk#16409,d_date_id#16410,d_date#16411,d_month_seq#16412,d_week_seq#16413,d_quarter_seq#16414,d_year#16415,d_dow#16416,d_moy#16417,d_dom#16418,d_qoy#16419,d_fy_year#16420,d_fy_quarter_seq#16421,d_fy_week_seq#16422,d_day_name#16423,d_quarter_name#16424,d_holiday#16425,d_weekend#16426,d_following_holiday#16427,d_first_dom#16428,d_last_dom#16429,d_same_day_ly#16430,d_same_day_lq#16431,d_current_day#16432,... 4 more fields] parquet\n      :              +- Project [ca_address_sk#16450, ca_county#16457]\n      :                 +- Filter (isnotnull(ca_address_sk#16450) && isnotnull(ca_county#16457))\n      :                    +- Relation[ca_address_sk#16450,ca_address_id#16451,ca_street_number#16452,ca_street_name#16453,ca_street_type#16454,ca_suite_number#16455,ca_city#16456,ca_county#16457,ca_state#16458,ca_zip#16459,ca_country#16460,ca_gmt_offset#16461,ca_location_type#16462] parquet\n      +- Aggregate [ca_county#16553, d_qoy#16515, d_year#16511], [ca_county#16553, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#1777)),17,2) AS web_sales#16463]\n         +- Project [ws_ext_sales_price#1777, d_year#16511, d_qoy#16515, ca_county#16553]\n            +- Join Inner, (ws_bill_addr_sk#1761 = ca_address_sk#16546)\n               :- Project [ws_bill_addr_sk#1761, ws_ext_sales_price#1777, d_year#16511, d_qoy#16515]\n               :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#16505)\n               :     :- Project [ws_bill_addr_sk#1761, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n               :     :  +- Filter (isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_bill_addr_sk#1761))\n               :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     +- Project [d_date_sk#16505, d_year#16511, d_qoy#16515]\n               :        +- Filter ((((isnotnull(d_qoy#16515) && isnotnull(d_year#16511)) && (d_qoy#16515 = 3)) && (d_year#16511 = 2000)) && isnotnull(d_date_sk#16505))\n               :           +- Relation[d_date_sk#16505,d_date_id#16506,d_date#16507,d_month_seq#16508,d_week_seq#16509,d_quarter_seq#16510,d_year#16511,d_dow#16512,d_moy#16513,d_dom#16514,d_qoy#16515,d_fy_year#16516,d_fy_quarter_seq#16517,d_fy_week_seq#16518,d_day_name#16519,d_quarter_name#16520,d_holiday#16521,d_weekend#16522,d_following_holiday#16523,d_first_dom#16524,d_last_dom#16525,d_same_day_ly#16526,d_same_day_lq#16527,d_current_day#16528,... 4 more fields] parquet\n               +- Project [ca_address_sk#16546, ca_county#16553]\n                  +- Filter (isnotnull(ca_address_sk#16546) && isnotnull(ca_county#16553))\n                     +- Relation[ca_address_sk#16546,ca_address_id#16547,ca_street_number#16548,ca_street_name#16549,ca_street_type#16550,ca_suite_number#16551,ca_city#16552,ca_county#16553,ca_state#16554,ca_zip#16555,ca_country#16556,ca_gmt_offset#16557,ca_location_type#16558] parquet\n\n== Physical Plan ==\n*(36) Sort [ca_county#929 ASC NULLS FIRST], true, 0\n+- Exchange rangepartitioning(ca_county#929 ASC NULLS FIRST, 200)\n   +- *(35) Project [ca_county#929, d_year#1046, CheckOverflow((promote_precision(web_sales#16367) / promote_precision(web_sales#16118)), DecimalType(37,20)) AS web_q1_q2_increase#16113, CheckOverflow((promote_precision(store_sales#16121) / promote_precision(store_sales#16117)), DecimalType(37,20)) AS store_q1_q2_increase#16114, CheckOverflow((promote_precision(web_sales#16463) / promote_precision(web_sales#16367)), DecimalType(37,20)) AS web_q2_q3_increase#16115, CheckOverflow((promote_precision(store_sales#16217) / promote_precision(store_sales#16121)), DecimalType(37,20)) AS store_q2_q3_increase#16116]\n      +- *(35) SortMergeJoin [ca_county#16361], [ca_county#16553], Inner, (CASE WHEN (web_sales#16367 > 0.00) THEN CheckOverflow((promote_precision(web_sales#16463) / promote_precision(web_sales#16367)), DecimalType(37,20)) ELSE null END > CASE WHEN (store_sales#16121 > 0.00) THEN CheckOverflow((promote_precision(store_sales#16217) / promote_precision(store_sales#16121)), DecimalType(37,20)) ELSE null END)\n         :- *(29) Project [ca_county#929, d_year#1046, store_sales#16117, store_sales#16121, store_sales#16217, ca_county#16361, web_sales#16118, web_sales#16367]\n         :  +- *(29) SortMergeJoin [ca_county#16361], [ca_county#16457], Inner, (CASE WHEN (web_sales#16118 > 0.00) THEN CheckOverflow((promote_precision(web_sales#16367) / promote_precision(web_sales#16118)), DecimalType(37,20)) ELSE null END > CASE WHEN (store_sales#16117 > 0.00) THEN CheckOverflow((promote_precision(store_sales#16121) / promote_precision(store_sales#16117)), DecimalType(37,20)) ELSE null END)\n         :     :- *(23) SortMergeJoin [ca_county#929], [ca_county#16361], Inner\n         :     :  :- *(17) Project [ca_county#929, d_year#1046, store_sales#16117, store_sales#16121, store_sales#16217]\n         :     :  :  +- *(17) SortMergeJoin [ca_county#16211], [ca_county#16307], Inner\n         :     :  :     :- *(11) SortMergeJoin [ca_county#929], [ca_county#16211], Inner\n         :     :  :     :  :- *(5) Sort [ca_county#929 ASC NULLS FIRST], false, 0\n         :     :  :     :  :  +- Exchange hashpartitioning(ca_county#929, 200)\n         :     :  :     :  :     +- *(4) HashAggregate(keys=[ca_county#929, d_qoy#1050, d_year#1046], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[ca_county#929, d_year#1046, store_sales#16117])\n         :     :  :     :  :        +- Exchange hashpartitioning(ca_county#929, d_qoy#1050, d_year#1046, 200)\n         :     :  :     :  :           +- *(3) HashAggregate(keys=[ca_county#929, d_qoy#1050, d_year#1046], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[ca_county#929, d_qoy#1050, d_year#1046, sum#16566L])\n         :     :  :     :  :              +- *(3) Project [ss_ext_sales_price#1918, d_year#1046, d_qoy#1050, ca_county#929]\n         :     :  :     :  :                 +- *(3) BroadcastHashJoin [ss_addr_sk#1909], [ca_address_sk#922], Inner, BuildRight\n         :     :  :     :  :                    :- *(3) Project [ss_addr_sk#1909, ss_ext_sales_price#1918, d_year#1046, d_qoy#1050]\n         :     :  :     :  :                    :  +- *(3) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n         :     :  :     :  :                    :     :- *(3) Project [ss_addr_sk#1909, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n         :     :  :     :  :                    :     :  +- *(3) Filter isnotnull(ss_addr_sk#1909)\n         :     :  :     :  :                    :     :     +- *(3) FileScan parquet db_tpcds.store_sales[ss_addr_sk#1909,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_addr_sk)], ReadSchema: struct<ss_addr_sk:int,ss_ext_sales_price:decimal(7,2)>\n         :     :  :     :  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :     :  :     :  :                    :        +- *(1) Project [d_date_sk#1040, d_year#1046, d_qoy#1050]\n         :     :  :     :  :                    :           +- *(1) Filter ((((isnotnull(d_qoy#1050) && isnotnull(d_year#1046)) && (d_qoy#1050 = 1)) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n         :     :  :     :  :                    :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_qoy#1050] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,1), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>\n         :     :  :     :  :                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :     :  :     :  :                       +- *(2) Project [ca_address_sk#922, ca_county#929]\n         :     :  :     :  :                          +- *(2) Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_county#929))\n         :     :  :     :  :                             +- *(2) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_county#929] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_county)], ReadSchema: struct<ca_address_sk:int,ca_county:string>\n         :     :  :     :  +- *(10) Sort [ca_county#16211 ASC NULLS FIRST], false, 0\n         :     :  :     :     +- Exchange hashpartitioning(ca_county#16211, 200)\n         :     :  :     :        +- *(9) HashAggregate(keys=[ca_county#16211, d_qoy#16173, d_year#16169], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[ca_county#16211, store_sales#16121])\n         :     :  :     :           +- Exchange hashpartitioning(ca_county#16211, d_qoy#16173, d_year#16169, 200)\n         :     :  :     :              +- *(8) HashAggregate(keys=[ca_county#16211, d_qoy#16173, d_year#16169], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[ca_county#16211, d_qoy#16173, d_year#16169, sum#16568L])\n         :     :  :     :                 +- *(8) Project [ss_ext_sales_price#1918, d_year#16169, d_qoy#16173, ca_county#16211]\n         :     :  :     :                    +- *(8) BroadcastHashJoin [ss_addr_sk#1909], [ca_address_sk#16204], Inner, BuildRight\n         :     :  :     :                       :- *(8) Project [ss_addr_sk#1909, ss_ext_sales_price#1918, d_year#16169, d_qoy#16173]\n         :     :  :     :                       :  +- *(8) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#16163], Inner, BuildRight\n         :     :  :     :                       :     :- *(8) Project [ss_addr_sk#1909, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n         :     :  :     :                       :     :  +- *(8) Filter isnotnull(ss_addr_sk#1909)\n         :     :  :     :                       :     :     +- *(8) FileScan parquet db_tpcds.store_sales[ss_addr_sk#1909,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_addr_sk)], ReadSchema: struct<ss_addr_sk:int,ss_ext_sales_price:decimal(7,2)>\n         :     :  :     :                       :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :     :  :     :                       :        +- *(6) Project [d_date_sk#16163, d_year#16169, d_qoy#16173]\n         :     :  :     :                       :           +- *(6) Filter ((((isnotnull(d_qoy#16173) && isnotnull(d_year#16169)) && (d_qoy#16173 = 2)) && (d_year#16169 = 2000)) && isnotnull(d_date_sk#16163))\n         :     :  :     :                       :              +- *(6) FileScan parquet db_tpcds.date_dim[d_date_sk#16163,d_year#16169,d_qoy#16173] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>\n         :     :  :     :                       +- ReusedExchange [ca_address_sk#16204, ca_county#16211], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :     :  :     +- *(16) Sort [ca_county#16307 ASC NULLS FIRST], false, 0\n         :     :  :        +- Exchange hashpartitioning(ca_county#16307, 200)\n         :     :  :           +- *(15) HashAggregate(keys=[ca_county#16307, d_qoy#16269, d_year#16265], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[ca_county#16307, store_sales#16217])\n         :     :  :              +- Exchange hashpartitioning(ca_county#16307, d_qoy#16269, d_year#16265, 200)\n         :     :  :                 +- *(14) HashAggregate(keys=[ca_county#16307, d_qoy#16269, d_year#16265], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[ca_county#16307, d_qoy#16269, d_year#16265, sum#16570L])\n         :     :  :                    +- *(14) Project [ss_ext_sales_price#1918, d_year#16265, d_qoy#16269, ca_county#16307]\n         :     :  :                       +- *(14) BroadcastHashJoin [ss_addr_sk#1909], [ca_address_sk#16300], Inner, BuildRight\n         :     :  :                          :- *(14) Project [ss_addr_sk#1909, ss_ext_sales_price#1918, d_year#16265, d_qoy#16269]\n         :     :  :                          :  +- *(14) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#16259], Inner, BuildRight\n         :     :  :                          :     :- *(14) Project [ss_addr_sk#1909, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n         :     :  :                          :     :  +- *(14) Filter isnotnull(ss_addr_sk#1909)\n         :     :  :                          :     :     +- *(14) FileScan parquet db_tpcds.store_sales[ss_addr_sk#1909,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_addr_sk)], ReadSchema: struct<ss_addr_sk:int,ss_ext_sales_price:decimal(7,2)>\n         :     :  :                          :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :     :  :                          :        +- *(12) Project [d_date_sk#16259, d_year#16265, d_qoy#16269]\n         :     :  :                          :           +- *(12) Filter ((((isnotnull(d_qoy#16269) && isnotnull(d_year#16265)) && (d_qoy#16269 = 3)) && (d_year#16265 = 2000)) && isnotnull(d_date_sk#16259))\n         :     :  :                          :              +- *(12) FileScan parquet db_tpcds.date_dim[d_date_sk#16259,d_year#16265,d_qoy#16269] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,3), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>\n         :     :  :                          +- ReusedExchange [ca_address_sk#16300, ca_county#16307], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :     :  +- *(22) Sort [ca_county#16361 ASC NULLS FIRST], false, 0\n         :     :     +- Exchange hashpartitioning(ca_county#16361, 200)\n         :     :        +- *(21) HashAggregate(keys=[ca_county#16361, d_qoy#16323, d_year#16319], functions=[sum(UnscaledValue(ws_ext_sales_price#1777))], output=[ca_county#16361, web_sales#16118])\n         :     :           +- Exchange hashpartitioning(ca_county#16361, d_qoy#16323, d_year#16319, 200)\n         :     :              +- *(20) HashAggregate(keys=[ca_county#16361, d_qoy#16323, d_year#16319], functions=[partial_sum(UnscaledValue(ws_ext_sales_price#1777))], output=[ca_county#16361, d_qoy#16323, d_year#16319, sum#16572L])\n         :     :                 +- *(20) Project [ws_ext_sales_price#1777, d_year#16319, d_qoy#16323, ca_county#16361]\n         :     :                    +- *(20) BroadcastHashJoin [ws_bill_addr_sk#1761], [ca_address_sk#16354], Inner, BuildRight\n         :     :                       :- *(20) Project [ws_bill_addr_sk#1761, ws_ext_sales_price#1777, d_year#16319, d_qoy#16323]\n         :     :                       :  +- *(20) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#16313], Inner, BuildRight\n         :     :                       :     :- *(20) Project [ws_bill_addr_sk#1761, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n         :     :                       :     :  +- *(20) Filter isnotnull(ws_bill_addr_sk#1761)\n         :     :                       :     :     +- *(20) FileScan parquet db_tpcds.web_sales[ws_bill_addr_sk#1761,ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_addr_sk)], ReadSchema: struct<ws_bill_addr_sk:int,ws_ext_sales_price:decimal(7,2)>\n         :     :                       :     +- ReusedExchange [d_date_sk#16313, d_year#16319, d_qoy#16323], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :     :                       +- ReusedExchange [ca_address_sk#16354, ca_county#16361], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :     +- *(28) Sort [ca_county#16457 ASC NULLS FIRST], false, 0\n         :        +- Exchange hashpartitioning(ca_county#16457, 200)\n         :           +- *(27) HashAggregate(keys=[ca_county#16457, d_qoy#16419, d_year#16415], functions=[sum(UnscaledValue(ws_ext_sales_price#1777))], output=[ca_county#16457, web_sales#16367])\n         :              +- Exchange hashpartitioning(ca_county#16457, d_qoy#16419, d_year#16415, 200)\n         :                 +- *(26) HashAggregate(keys=[ca_county#16457, d_qoy#16419, d_year#16415], functions=[partial_sum(UnscaledValue(ws_ext_sales_price#1777))], output=[ca_county#16457, d_qoy#16419, d_year#16415, sum#16574L])\n         :                    +- *(26) Project [ws_ext_sales_price#1777, d_year#16415, d_qoy#16419, ca_county#16457]\n         :                       +- *(26) BroadcastHashJoin [ws_bill_addr_sk#1761], [ca_address_sk#16450], Inner, BuildRight\n         :                          :- *(26) Project [ws_bill_addr_sk#1761, ws_ext_sales_price#1777, d_year#16415, d_qoy#16419]\n         :                          :  +- *(26) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#16409], Inner, BuildRight\n         :                          :     :- *(26) Project [ws_bill_addr_sk#1761, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n         :                          :     :  +- *(26) Filter isnotnull(ws_bill_addr_sk#1761)\n         :                          :     :     +- *(26) FileScan parquet db_tpcds.web_sales[ws_bill_addr_sk#1761,ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_addr_sk)], ReadSchema: struct<ws_bill_addr_sk:int,ws_ext_sales_price:decimal(7,2)>\n         :                          :     +- ReusedExchange [d_date_sk#16409, d_year#16415, d_qoy#16419], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                          +- ReusedExchange [ca_address_sk#16450, ca_county#16457], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         +- *(34) Sort [ca_county#16553 ASC NULLS FIRST], false, 0\n            +- Exchange hashpartitioning(ca_county#16553, 200)\n               +- *(33) HashAggregate(keys=[ca_county#16553, d_qoy#16515, d_year#16511], functions=[sum(UnscaledValue(ws_ext_sales_price#1777))], output=[ca_county#16553, web_sales#16463])\n                  +- Exchange hashpartitioning(ca_county#16553, d_qoy#16515, d_year#16511, 200)\n                     +- *(32) HashAggregate(keys=[ca_county#16553, d_qoy#16515, d_year#16511], functions=[partial_sum(UnscaledValue(ws_ext_sales_price#1777))], output=[ca_county#16553, d_qoy#16515, d_year#16511, sum#16576L])\n                        +- *(32) Project [ws_ext_sales_price#1777, d_year#16511, d_qoy#16515, ca_county#16553]\n                           +- *(32) BroadcastHashJoin [ws_bill_addr_sk#1761], [ca_address_sk#16546], Inner, BuildRight\n                              :- *(32) Project [ws_bill_addr_sk#1761, ws_ext_sales_price#1777, d_year#16511, d_qoy#16515]\n                              :  +- *(32) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#16505], Inner, BuildRight\n                              :     :- *(32) Project [ws_bill_addr_sk#1761, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                              :     :  +- *(32) Filter isnotnull(ws_bill_addr_sk#1761)\n                              :     :     +- *(32) FileScan parquet db_tpcds.web_sales[ws_bill_addr_sk#1761,ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_addr_sk)], ReadSchema: struct<ws_bill_addr_sk:int,ws_ext_sales_price:decimal(7,2)>\n                              :     +- ReusedExchange [d_date_sk#16505, d_year#16511, d_qoy#16515], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              +- ReusedExchange [ca_address_sk#16546, ca_county#16553], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q32-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["catalog_sales","item","date_dim"],"parsingTime":0.002262,"analysisTime":7.56E-4,"optimizationTime":482.396208,"planningTime":21.36868,"executionTime":4205.844683,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Project ['sum('cs_ext_discount_amt) AS excess discount amount#17054]\n      +- 'Filter (((('i_manufact_id = 977) && ('i_item_sk = 'cs_item_sk)) && (('d_date >= cast(2000-01-27 as date)) && ('d_date <= (cast(2000-01-27 as date) + interval 12 weeks 6 days)))) && (('d_date_sk = 'cs_sold_date_sk) && ('cs_ext_discount_amt > scalar-subquery#17055 [])))\n         :  +- 'Project [unresolvedalias((1.3 * 'avg('cs_ext_discount_amt)), None)]\n         :     +- 'Filter ((('cs_item_sk = 'i_item_sk) && (('d_date >= cast(2000-01-27 as date)) && ('d_date <= (cast(2000-01-27 as date) + interval 12 weeks 6 days)))) && ('d_date_sk = 'cs_sold_date_sk))\n         :        +- 'Join Inner\n         :           :- 'UnresolvedRelation `catalog_sales`\n         :           +- 'UnresolvedRelation `date_dim`\n         +- 'Join Inner\n            :- 'Join Inner\n            :  :- 'UnresolvedRelation `catalog_sales`\n            :  +- 'UnresolvedRelation `item`\n            +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nexcess discount amount: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Aggregate [sum(cs_ext_discount_amt#1810) AS excess discount amount#17054]\n      +- Filter ((((i_manufact_id#1185 = 977) && (i_item_sk#1172 = cs_item_sk#1803)) && ((d_date#1042 >= cast(2000-01-27 as date)) && (d_date#1042 <= cast(cast(cast(2000-01-27 as date) as timestamp) + interval 12 weeks 6 days as date)))) && ((d_date_sk#1040 = cs_sold_date_sk#1822) && (cast(cs_ext_discount_amt#1810 as decimal(14,7)) > cast(scalar-subquery#17055 [i_item_sk#1172] as decimal(14,7)))))\n         :  +- Aggregate [CheckOverflow((promote_precision(cast(1.3 as decimal(11,6))) * promote_precision(cast(avg(cs_ext_discount_amt#1810) as decimal(11,6)))), DecimalType(14,7)) AS (CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(cs_ext_discount_amt) AS DECIMAL(11,6)))#17057]\n         :     +- Filter (((cs_item_sk#1803 = outer(i_item_sk#1172)) && ((d_date#1042 >= cast(2000-01-27 as date)) && (d_date#1042 <= cast(cast(cast(2000-01-27 as date) as timestamp) + interval 12 weeks 6 days as date)))) && (d_date_sk#1040 = cs_sold_date_sk#1822))\n         :        +- Join Inner\n         :           :- SubqueryAlias catalog_sales\n         :           :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n         :           +- SubqueryAlias date_dim\n         :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         +- Join Inner\n            :- Join Inner\n            :  :- SubqueryAlias catalog_sales\n            :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :  +- SubqueryAlias item\n            :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            +- SubqueryAlias date_dim\n               +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Aggregate [MakeDecimal(sum(UnscaledValue(cs_ext_discount_amt#1810)),17,2) AS excess discount amount#17054]\n      +- Project [cs_ext_discount_amt#1810]\n         +- Join Inner, (d_date_sk#1040 = cs_sold_date_sk#1822)\n            :- Project [cs_ext_discount_amt#1810, cs_sold_date_sk#1822]\n            :  +- Join Inner, ((cast(cs_ext_discount_amt#1810 as decimal(14,7)) > (CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(cs_ext_discount_amt) AS DECIMAL(11,6)))#17057) && (cs_item_sk#1803#17060 = i_item_sk#1172))\n            :     :- Project [cs_ext_discount_amt#1810, cs_sold_date_sk#1822, i_item_sk#1172]\n            :     :  +- Join Inner, (i_item_sk#1172 = cs_item_sk#1803)\n            :     :     :- Project [cs_item_sk#1803, cs_ext_discount_amt#1810, cs_sold_date_sk#1822]\n            :     :     :  +- Filter ((isnotnull(cs_item_sk#1803) && isnotnull(cs_ext_discount_amt#1810)) && isnotnull(cs_sold_date_sk#1822))\n            :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :     :     +- Project [i_item_sk#1172]\n            :     :        +- Filter ((isnotnull(i_manufact_id#1185) && (i_manufact_id#1185 = 977)) && isnotnull(i_item_sk#1172))\n            :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :     +- Filter isnotnull((CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(cs_ext_discount_amt) AS DECIMAL(11,6)))#17057)\n            :        +- Aggregate [cs_item_sk#1803], [CheckOverflow((1.300000 * promote_precision(cast((avg(UnscaledValue(cs_ext_discount_amt#1810)) / 100.0) as decimal(11,6)))), DecimalType(14,7)) AS (CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(cs_ext_discount_amt) AS DECIMAL(11,6)))#17057, cs_item_sk#1803 AS cs_item_sk#1803#17060]\n            :           +- Project [cs_item_sk#1803, cs_ext_discount_amt#1810]\n            :              +- Join Inner, (d_date_sk#1040 = cs_sold_date_sk#1822)\n            :                 :- Project [cs_item_sk#1803, cs_ext_discount_amt#1810, cs_sold_date_sk#1822]\n            :                 :  +- Filter (isnotnull(cs_sold_date_sk#1822) && isnotnull(cs_item_sk#1803))\n            :                 :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :                 +- Project [d_date_sk#1040]\n            :                    +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10983)) && (d_date#1042 <= 11073)) && isnotnull(d_date_sk#1040))\n            :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Project [d_date_sk#1040]\n               +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10983)) && (d_date#1042 <= 11073)) && isnotnull(d_date_sk#1040))\n                  +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nCollectLimit 100\n+- *(10) LocalLimit 100\n   +- *(10) HashAggregate(keys=[], functions=[sum(UnscaledValue(cs_ext_discount_amt#1810))], output=[excess discount amount#17054])\n      +- Exchange SinglePartition\n         +- *(9) HashAggregate(keys=[], functions=[partial_sum(UnscaledValue(cs_ext_discount_amt#1810))], output=[sum#17062L])\n            +- *(9) Project [cs_ext_discount_amt#1810]\n               +- *(9) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n                  :- *(9) Project [cs_ext_discount_amt#1810, cs_sold_date_sk#1822]\n                  :  +- *(9) SortMergeJoin [i_item_sk#1172], [cs_item_sk#1803#17060], Inner, (cast(cs_ext_discount_amt#1810 as decimal(14,7)) > (CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(cs_ext_discount_amt) AS DECIMAL(11,6)))#17057)\n                  :     :- *(3) Sort [i_item_sk#1172 ASC NULLS FIRST], false, 0\n                  :     :  +- Exchange hashpartitioning(i_item_sk#1172, 200)\n                  :     :     +- *(2) Project [cs_ext_discount_amt#1810, cs_sold_date_sk#1822, i_item_sk#1172]\n                  :     :        +- *(2) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n                  :     :           :- *(2) Project [cs_item_sk#1803, cs_ext_discount_amt#1810, cs_sold_date_sk#1822]\n                  :     :           :  +- *(2) Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_ext_discount_amt#1810))\n                  :     :           :     +- *(2) FileScan parquet db_tpcds.catalog_sales[cs_item_sk#1803,cs_ext_discount_amt#1810,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_ext_discount_amt)], ReadSchema: struct<cs_item_sk:int,cs_ext_discount_amt:decimal(7,2)>\n                  :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :              +- *(1) Project [i_item_sk#1172]\n                  :     :                 +- *(1) Filter ((isnotnull(i_manufact_id#1185) && (i_manufact_id#1185 = 977)) && isnotnull(i_item_sk#1172))\n                  :     :                    +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_manufact_id#1185] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_manufact_id), EqualTo(i_manufact_id,977), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_manufact_id:int>\n                  :     +- *(7) Sort [cs_item_sk#1803#17060 ASC NULLS FIRST], false, 0\n                  :        +- Exchange hashpartitioning(cs_item_sk#1803#17060, 200)\n                  :           +- *(6) Filter isnotnull((CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(cs_ext_discount_amt) AS DECIMAL(11,6)))#17057)\n                  :              +- *(6) HashAggregate(keys=[cs_item_sk#1803], functions=[avg(UnscaledValue(cs_ext_discount_amt#1810))], output=[(CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(cs_ext_discount_amt) AS DECIMAL(11,6)))#17057, cs_item_sk#1803#17060])\n                  :                 +- Exchange hashpartitioning(cs_item_sk#1803, 200)\n                  :                    +- *(5) HashAggregate(keys=[cs_item_sk#1803], functions=[partial_avg(UnscaledValue(cs_ext_discount_amt#1810))], output=[cs_item_sk#1803, sum#17065, count#17066L])\n                  :                       +- *(5) Project [cs_item_sk#1803, cs_ext_discount_amt#1810]\n                  :                          +- *(5) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n                  :                             :- *(5) Project [cs_item_sk#1803, cs_ext_discount_amt#1810, cs_sold_date_sk#1822]\n                  :                             :  +- *(5) Filter isnotnull(cs_item_sk#1803)\n                  :                             :     +- *(5) FileScan parquet db_tpcds.catalog_sales[cs_item_sk#1803,cs_ext_discount_amt#1810,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:int,cs_ext_discount_amt:decimal(7,2)>\n                  :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :                                +- *(4) Project [d_date_sk#1040]\n                  :                                   +- *(4) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10983)) && (d_date#1042 <= 11073)) && isnotnull(d_date_sk#1040))\n                  :                                      +- *(4) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2000-01-27), LessThanOrEqual(d_date,2000-04-26), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>\n                  +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q33-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["ss","cs","ws"],"parsingTime":0.002118,"analysisTime":7.03E-4,"optimizationTime":870.415284,"planningTime":65.499988,"executionTime":7682.88654,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ss, cs, ws]\n:  :- 'SubqueryAlias ss\n:  :  +- 'Aggregate ['i_manufact_id], ['i_manufact_id, 'sum('ss_ext_sales_price) AS total_sales#17103]\n:  :     +- 'Filter ((('i_manufact_id IN (list#17104 []) && ('ss_item_sk = 'i_item_sk)) && (('ss_sold_date_sk = 'd_date_sk) && ('d_year = 1998))) && ((('d_moy = 5) && ('ss_addr_sk = 'ca_address_sk)) && ('ca_gmt_offset = -5)))\n:  :        :  +- 'Project ['i_manufact_id]\n:  :        :     +- 'Filter 'i_category IN (Electronics)\n:  :        :        +- 'UnresolvedRelation `item`\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'Join Inner\n:  :           :  :  :- 'UnresolvedRelation `store_sales`\n:  :           :  :  +- 'UnresolvedRelation `date_dim`\n:  :           :  +- 'UnresolvedRelation `customer_address`\n:  :           +- 'UnresolvedRelation `item`\n:  :- 'SubqueryAlias cs\n:  :  +- 'Aggregate ['i_manufact_id], ['i_manufact_id, 'sum('cs_ext_sales_price) AS total_sales#17105]\n:  :     +- 'Filter ((('i_manufact_id IN (list#17106 []) && ('cs_item_sk = 'i_item_sk)) && (('cs_sold_date_sk = 'd_date_sk) && ('d_year = 1998))) && ((('d_moy = 5) && ('cs_bill_addr_sk = 'ca_address_sk)) && ('ca_gmt_offset = -5)))\n:  :        :  +- 'Project ['i_manufact_id]\n:  :        :     +- 'Filter 'i_category IN (Electronics)\n:  :        :        +- 'UnresolvedRelation `item`\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'Join Inner\n:  :           :  :  :- 'UnresolvedRelation `catalog_sales`\n:  :           :  :  +- 'UnresolvedRelation `date_dim`\n:  :           :  +- 'UnresolvedRelation `customer_address`\n:  :           +- 'UnresolvedRelation `item`\n:  +- 'SubqueryAlias ws\n:     +- 'Aggregate ['i_manufact_id], ['i_manufact_id, 'sum('ws_ext_sales_price) AS total_sales#17107]\n:        +- 'Filter ((('i_manufact_id IN (list#17108 []) && ('ws_item_sk = 'i_item_sk)) && (('ws_sold_date_sk = 'd_date_sk) && ('d_year = 1998))) && ((('d_moy = 5) && ('ws_bill_addr_sk = 'ca_address_sk)) && ('ca_gmt_offset = -5)))\n:           :  +- 'Project ['i_manufact_id]\n:           :     +- 'Filter 'i_category IN (Electronics)\n:           :        +- 'UnresolvedRelation `item`\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'Join Inner\n:              :  :  :- 'UnresolvedRelation `web_sales`\n:              :  :  +- 'UnresolvedRelation `date_dim`\n:              :  +- 'UnresolvedRelation `customer_address`\n:              +- 'UnresolvedRelation `item`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['total_sales ASC NULLS FIRST], true\n         +- 'Aggregate ['i_manufact_id], ['i_manufact_id, 'sum('total_sales) AS total_sales#17102]\n            +- 'SubqueryAlias tmp1\n               +- 'Union\n                  :- 'Union\n                  :  :- 'Project [*]\n                  :  :  +- 'UnresolvedRelation `ss`\n                  :  +- 'Project [*]\n                  :     +- 'UnresolvedRelation `cs`\n                  +- 'Project [*]\n                     +- 'UnresolvedRelation `ws`\n\n== Analyzed Logical Plan ==\ni_manufact_id: int, total_sales: decimal(27,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [total_sales#17102 ASC NULLS FIRST], true\n      +- Aggregate [i_manufact_id#1185], [i_manufact_id#1185, sum(total_sales#17103) AS total_sales#17102]\n         +- SubqueryAlias tmp1\n            +- Union\n               :- Union\n               :  :- Project [i_manufact_id#1185, total_sales#17103]\n               :  :  +- SubqueryAlias ss\n               :  :     +- Aggregate [i_manufact_id#1185], [i_manufact_id#1185, sum(ss_ext_sales_price#1918) AS total_sales#17103]\n               :  :        +- Filter (((i_manufact_id#1185 IN (list#17104 []) && (ss_item_sk#1905 = i_item_sk#1172)) && ((ss_sold_date_sk#1926 = d_date_sk#1040) && (d_year#1046 = 1998))) && (((d_moy#1048 = 5) && (ss_addr_sk#1909 = ca_address_sk#922)) && (cast(ca_gmt_offset#933 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2)))))\n               :  :           :  +- Project [i_manufact_id#1185]\n               :  :           :     +- Filter i_category#1184 IN (Electronics)\n               :  :           :        +- SubqueryAlias item\n               :  :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  :           +- Join Inner\n               :  :              :- Join Inner\n               :  :              :  :- Join Inner\n               :  :              :  :  :- SubqueryAlias store_sales\n               :  :              :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :              :  :  +- SubqueryAlias date_dim\n               :  :              :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :              :  +- SubqueryAlias customer_address\n               :  :              :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               :  :              +- SubqueryAlias item\n               :  :                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  +- Project [i_manufact_id#1185, total_sales#17105]\n               :     +- SubqueryAlias cs\n               :        +- Aggregate [i_manufact_id#1185], [i_manufact_id#1185, sum(cs_ext_sales_price#1811) AS total_sales#17105]\n               :           +- Filter (((i_manufact_id#1185 IN (list#17106 []) && (cs_item_sk#1803 = i_item_sk#1172)) && ((cs_sold_date_sk#1822 = d_date_sk#1040) && (d_year#1046 = 1998))) && (((d_moy#1048 = 5) && (cs_bill_addr_sk#1794 = ca_address_sk#922)) && (cast(ca_gmt_offset#933 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2)))))\n               :              :  +- Project [i_manufact_id#1185]\n               :              :     +- Filter i_category#1184 IN (Electronics)\n               :              :        +- SubqueryAlias item\n               :              :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              +- Join Inner\n               :                 :- Join Inner\n               :                 :  :- Join Inner\n               :                 :  :  :- SubqueryAlias catalog_sales\n               :                 :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :                 :  :  +- SubqueryAlias date_dim\n               :                 :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :                 :  +- SubqueryAlias customer_address\n               :                 :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               :                 +- SubqueryAlias item\n               :                    +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               +- Project [i_manufact_id#1185, total_sales#17107]\n                  +- SubqueryAlias ws\n                     +- Aggregate [i_manufact_id#1185], [i_manufact_id#1185, sum(ws_ext_sales_price#1777) AS total_sales#17107]\n                        +- Filter (((i_manufact_id#1185 IN (list#17108 []) && (ws_item_sk#1757 = i_item_sk#1172)) && ((ws_sold_date_sk#1788 = d_date_sk#1040) && (d_year#1046 = 1998))) && (((d_moy#1048 = 5) && (ws_bill_addr_sk#1761 = ca_address_sk#922)) && (cast(ca_gmt_offset#933 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2)))))\n                           :  +- Project [i_manufact_id#1185]\n                           :     +- Filter i_category#1184 IN (Electronics)\n                           :        +- SubqueryAlias item\n                           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                           +- Join Inner\n                              :- Join Inner\n                              :  :- Join Inner\n                              :  :  :- SubqueryAlias web_sales\n                              :  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                              :  :  +- SubqueryAlias date_dim\n                              :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :  +- SubqueryAlias customer_address\n                              :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                              +- SubqueryAlias item\n                                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [total_sales#17102 ASC NULLS FIRST], true\n      +- Aggregate [i_manufact_id#1185], [i_manufact_id#1185, sum(total_sales#17103) AS total_sales#17102]\n         +- Union\n            :- Aggregate [i_manufact_id#1185], [i_manufact_id#1185, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS total_sales#17103]\n            :  +- Project [ss_ext_sales_price#1918, i_manufact_id#1185]\n            :     +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n            :        :- Project [ss_item_sk#1905, ss_ext_sales_price#1918]\n            :        :  +- Join Inner, (ss_addr_sk#1909 = ca_address_sk#922)\n            :        :     :- Project [ss_item_sk#1905, ss_addr_sk#1909, ss_ext_sales_price#1918]\n            :        :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :        :     :     :- Project [ss_item_sk#1905, ss_addr_sk#1909, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :        :     :     :  +- Filter ((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_addr_sk#1909)) && isnotnull(ss_item_sk#1905))\n            :        :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :        :     :     +- Project [d_date_sk#1040]\n            :        :     :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 5)) && isnotnull(d_date_sk#1040))\n            :        :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :        :     +- Project [ca_address_sk#922]\n            :        :        +- Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n            :        :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :        +- Join LeftSemi, (i_manufact_id#1185 = i_manufact_id#1185#17116)\n            :           :- Project [i_item_sk#1172, i_manufact_id#1185]\n            :           :  +- Filter isnotnull(i_item_sk#1172)\n            :           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :           +- Project [i_manufact_id#1185 AS i_manufact_id#1185#17116]\n            :              +- Filter i_category#1184 IN (Electronics)\n            :                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :- Aggregate [i_manufact_id#1185], [i_manufact_id#1185, MakeDecimal(sum(UnscaledValue(cs_ext_sales_price#1811)),17,2) AS total_sales#17105]\n            :  +- Project [cs_ext_sales_price#1811, i_manufact_id#1185]\n            :     +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n            :        :- Project [cs_item_sk#1803, cs_ext_sales_price#1811]\n            :        :  +- Join Inner, (cs_bill_addr_sk#1794 = ca_address_sk#922)\n            :        :     :- Project [cs_bill_addr_sk#1794, cs_item_sk#1803, cs_ext_sales_price#1811]\n            :        :     :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n            :        :     :     :- Project [cs_bill_addr_sk#1794, cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n            :        :     :     :  +- Filter ((isnotnull(cs_sold_date_sk#1822) && isnotnull(cs_bill_addr_sk#1794)) && isnotnull(cs_item_sk#1803))\n            :        :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :        :     :     +- Project [d_date_sk#1040]\n            :        :     :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 5)) && isnotnull(d_date_sk#1040))\n            :        :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :        :     +- Project [ca_address_sk#922]\n            :        :        +- Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n            :        :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :        +- Join LeftSemi, (i_manufact_id#1185 = i_manufact_id#1185#17117)\n            :           :- Project [i_item_sk#1172, i_manufact_id#1185]\n            :           :  +- Filter isnotnull(i_item_sk#1172)\n            :           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :           +- Project [i_manufact_id#1185 AS i_manufact_id#1185#17117]\n            :              +- Filter i_category#1184 IN (Electronics)\n            :                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            +- Aggregate [i_manufact_id#1185], [i_manufact_id#1185, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#1777)),17,2) AS total_sales#17107]\n               +- Project [ws_ext_sales_price#1777, i_manufact_id#1185]\n                  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n                     :- Project [ws_item_sk#1757, ws_ext_sales_price#1777]\n                     :  +- Join Inner, (ws_bill_addr_sk#1761 = ca_address_sk#922)\n                     :     :- Project [ws_item_sk#1757, ws_bill_addr_sk#1761, ws_ext_sales_price#1777]\n                     :     :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                     :     :     :- Project [ws_item_sk#1757, ws_bill_addr_sk#1761, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                     :     :     :  +- Filter ((isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_bill_addr_sk#1761)) && isnotnull(ws_item_sk#1757))\n                     :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :     :     +- Project [d_date_sk#1040]\n                     :     :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 5)) && isnotnull(d_date_sk#1040))\n                     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :     +- Project [ca_address_sk#922]\n                     :        +- Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n                     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                     +- Join LeftSemi, (i_manufact_id#1185 = i_manufact_id#1185#17118)\n                        :- Project [i_item_sk#1172, i_manufact_id#1185]\n                        :  +- Filter isnotnull(i_item_sk#1172)\n                        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        +- Project [i_manufact_id#1185 AS i_manufact_id#1185#17118]\n                           +- Filter i_category#1184 IN (Electronics)\n                              +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[total_sales#17102 ASC NULLS FIRST], output=[i_manufact_id#1185,total_sales#17102])\n+- *(20) HashAggregate(keys=[i_manufact_id#1185], functions=[sum(total_sales#17103)], output=[i_manufact_id#1185, total_sales#17102])\n   +- Exchange hashpartitioning(i_manufact_id#1185, 200)\n      +- *(19) HashAggregate(keys=[i_manufact_id#1185], functions=[partial_sum(total_sales#17103)], output=[i_manufact_id#1185, sum#17120])\n         +- Union\n            :- *(6) HashAggregate(keys=[i_manufact_id#1185], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[i_manufact_id#1185, total_sales#17103])\n            :  +- Exchange hashpartitioning(i_manufact_id#1185, 200)\n            :     +- *(5) HashAggregate(keys=[i_manufact_id#1185], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[i_manufact_id#1185, sum#17122L])\n            :        +- *(5) Project [ss_ext_sales_price#1918, i_manufact_id#1185]\n            :           +- *(5) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n            :              :- *(5) Project [ss_item_sk#1905, ss_ext_sales_price#1918]\n            :              :  +- *(5) BroadcastHashJoin [ss_addr_sk#1909], [ca_address_sk#922], Inner, BuildRight\n            :              :     :- *(5) Project [ss_item_sk#1905, ss_addr_sk#1909, ss_ext_sales_price#1918]\n            :              :     :  +- *(5) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n            :              :     :     :- *(5) Project [ss_item_sk#1905, ss_addr_sk#1909, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :              :     :     :  +- *(5) Filter (isnotnull(ss_addr_sk#1909) && isnotnull(ss_item_sk#1905))\n            :              :     :     :     +- *(5) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_addr_sk#1909,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_addr_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_addr_sk:int,ss_ext_sales_price:decimal(7,2)>\n            :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              :     :        +- *(1) Project [d_date_sk#1040]\n            :              :     :           +- *(1) Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 5)) && isnotnull(d_date_sk#1040))\n            :              :     :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1998), EqualTo(d_moy,5), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n            :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              :        +- *(2) Project [ca_address_sk#922]\n            :              :           +- *(2) Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n            :              :              +- *(2) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_gmt_offset#933] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-5.00), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_gmt_offset:decimal(5,2)>\n            :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :                 +- *(4) BroadcastHashJoin [i_manufact_id#1185], [i_manufact_id#1185#17116], LeftSemi, BuildRight\n            :                    :- *(4) Project [i_item_sk#1172, i_manufact_id#1185]\n            :                    :  +- *(4) Filter isnotnull(i_item_sk#1172)\n            :                    :     +- *(4) FileScan parquet db_tpcds.item[i_item_sk#1172,i_manufact_id#1185] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_manufact_id:int>\n            :                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :                       +- *(3) Project [i_manufact_id#1185 AS i_manufact_id#1185#17116]\n            :                          +- *(3) Filter i_category#1184 IN (Electronics)\n            :                             +- *(3) FileScan parquet db_tpcds.item[i_category#1184,i_manufact_id#1185] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [In(i_category, [Electronics])], ReadSchema: struct<i_category:string,i_manufact_id:int>\n            :- *(12) HashAggregate(keys=[i_manufact_id#1185], functions=[sum(UnscaledValue(cs_ext_sales_price#1811))], output=[i_manufact_id#1185, total_sales#17105])\n            :  +- Exchange hashpartitioning(i_manufact_id#1185, 200)\n            :     +- *(11) HashAggregate(keys=[i_manufact_id#1185], functions=[partial_sum(UnscaledValue(cs_ext_sales_price#1811))], output=[i_manufact_id#1185, sum#17124L])\n            :        +- *(11) Project [cs_ext_sales_price#1811, i_manufact_id#1185]\n            :           +- *(11) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n            :              :- *(11) Project [cs_item_sk#1803, cs_ext_sales_price#1811]\n            :              :  +- *(11) BroadcastHashJoin [cs_bill_addr_sk#1794], [ca_address_sk#922], Inner, BuildRight\n            :              :     :- *(11) Project [cs_bill_addr_sk#1794, cs_item_sk#1803, cs_ext_sales_price#1811]\n            :              :     :  +- *(11) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n            :              :     :     :- *(11) Project [cs_bill_addr_sk#1794, cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n            :              :     :     :  +- *(11) Filter (isnotnull(cs_bill_addr_sk#1794) && isnotnull(cs_item_sk#1803))\n            :              :     :     :     +- *(11) FileScan parquet db_tpcds.catalog_sales[cs_bill_addr_sk#1794,cs_item_sk#1803,cs_ext_sales_price#1811,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_bill_addr_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_bill_addr_sk:int,cs_item_sk:int,cs_ext_sales_price:decimal(7,2)>\n            :              :     :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              :     +- ReusedExchange [ca_address_sk#922], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              +- ReusedExchange [i_item_sk#1172, i_manufact_id#1185], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            +- *(18) HashAggregate(keys=[i_manufact_id#1185], functions=[sum(UnscaledValue(ws_ext_sales_price#1777))], output=[i_manufact_id#1185, total_sales#17107])\n               +- Exchange hashpartitioning(i_manufact_id#1185, 200)\n                  +- *(17) HashAggregate(keys=[i_manufact_id#1185], functions=[partial_sum(UnscaledValue(ws_ext_sales_price#1777))], output=[i_manufact_id#1185, sum#17126L])\n                     +- *(17) Project [ws_ext_sales_price#1777, i_manufact_id#1185]\n                        +- *(17) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n                           :- *(17) Project [ws_item_sk#1757, ws_ext_sales_price#1777]\n                           :  +- *(17) BroadcastHashJoin [ws_bill_addr_sk#1761], [ca_address_sk#922], Inner, BuildRight\n                           :     :- *(17) Project [ws_item_sk#1757, ws_bill_addr_sk#1761, ws_ext_sales_price#1777]\n                           :     :  +- *(17) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                           :     :     :- *(17) Project [ws_item_sk#1757, ws_bill_addr_sk#1761, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                           :     :     :  +- *(17) Filter (isnotnull(ws_bill_addr_sk#1761) && isnotnull(ws_item_sk#1757))\n                           :     :     :     +- *(17) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_bill_addr_sk#1761,ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_addr_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_bill_addr_sk:int,ws_ext_sales_price:decimal(7,2)>\n                           :     :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :     +- ReusedExchange [ca_address_sk#922], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           +- ReusedExchange [i_item_sk#1172, i_manufact_id#1185], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q34-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","date_dim","store","household_demographics","customer"],"parsingTime":0.002686,"analysisTime":6.05E-4,"optimizationTime":281.755079,"planningTime":12.353636,"executionTime":3571.74718,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'Sort ['c_last_name ASC NULLS FIRST, 'c_first_name ASC NULLS FIRST, 'c_salutation ASC NULLS FIRST, 'c_preferred_cust_flag DESC NULLS LAST, 'ss_ticket_number ASC NULLS FIRST], true\n+- 'Project ['c_last_name, 'c_first_name, 'c_salutation, 'c_preferred_cust_flag, 'ss_ticket_number, 'cnt]\n   +- 'Filter (('ss_customer_sk = 'c_customer_sk) && (('cnt >= 15) && ('cnt <= 20)))\n      +- 'Join Inner\n         :- 'SubqueryAlias dn\n         :  +- 'Aggregate ['ss_ticket_number, 'ss_customer_sk], ['ss_ticket_number, 'ss_customer_sk, 'count(1) AS cnt#17155]\n         :     +- 'Filter ((((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) && ('store_sales.ss_store_sk = 'store.s_store_sk)) && ('store_sales.ss_hdemo_sk = 'household_demographics.hd_demo_sk)) && (((('date_dim.d_dom >= 1) && ('date_dim.d_dom <= 3)) || (('date_dim.d_dom >= 25) && ('date_dim.d_dom <= 28))) && (('household_demographics.hd_buy_potential = >10000) || ('household_demographics.hd_buy_potential = unknown)))) && ((('household_demographics.hd_vehicle_count > 0) && (CASE WHEN ('household_demographics.hd_vehicle_count > 0) THEN ('household_demographics.hd_dep_count / 'household_demographics.hd_vehicle_count) ELSE null END > 1.2)) && ('date_dim.d_year IN (1999,(1999 + 1),(1999 + 2)) && 'store.s_county IN (Williamson County,Williamson County,Williamson County,Williamson County,Williamson County,Williamson County,Williamson County,Williamson County))))\n         :        +- 'Join Inner\n         :           :- 'Join Inner\n         :           :  :- 'Join Inner\n         :           :  :  :- 'UnresolvedRelation `store_sales`\n         :           :  :  +- 'UnresolvedRelation `date_dim`\n         :           :  +- 'UnresolvedRelation `store`\n         :           +- 'UnresolvedRelation `household_demographics`\n         +- 'UnresolvedRelation `customer`\n\n== Analyzed Logical Plan ==\nc_last_name: string, c_first_name: string, c_salutation: string, c_preferred_cust_flag: string, ss_ticket_number: bigint, cnt: bigint\nSort [c_last_name#869 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, c_salutation#867 ASC NULLS FIRST, c_preferred_cust_flag#870 DESC NULLS LAST, ss_ticket_number#1912L ASC NULLS FIRST], true\n+- Project [c_last_name#869, c_first_name#868, c_salutation#867, c_preferred_cust_flag#870, ss_ticket_number#1912L, cnt#17155L]\n   +- Filter ((ss_customer_sk#1906 = c_customer_sk#860) && ((cnt#17155L >= cast(15 as bigint)) && (cnt#17155L <= cast(20 as bigint))))\n      +- Join Inner\n         :- SubqueryAlias dn\n         :  +- Aggregate [ss_ticket_number#1912L, ss_customer_sk#1906], [ss_ticket_number#1912L, ss_customer_sk#1906, count(1) AS cnt#17155L]\n         :     +- Filter (((((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_store_sk#1910 = s_store_sk#1386)) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && ((((d_dom#1049 >= 1) && (d_dom#1049 <= 3)) || ((d_dom#1049 >= 25) && (d_dom#1049 <= 28))) && ((hd_buy_potential#1108 = >10000) || (hd_buy_potential#1108 = unknown)))) && (((hd_vehicle_count#1110 > 0) && (CASE WHEN (hd_vehicle_count#1110 > 0) THEN (cast(hd_dep_count#1109 as double) / cast(hd_vehicle_count#1110 as double)) ELSE cast(null as double) END > cast(1.2 as double))) && (d_year#1046 IN (1999,(1999 + 1),(1999 + 2)) && s_county#1409 IN (Williamson County,Williamson County,Williamson County,Williamson County,Williamson County,Williamson County,Williamson County,Williamson County))))\n         :        +- Join Inner\n         :           :- Join Inner\n         :           :  :- Join Inner\n         :           :  :  :- SubqueryAlias store_sales\n         :           :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :           :  :  +- SubqueryAlias date_dim\n         :           :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :           :  +- SubqueryAlias store\n         :           :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n         :           +- SubqueryAlias household_demographics\n         :              +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n         +- SubqueryAlias customer\n            +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n\n== Optimized Logical Plan ==\nSort [c_last_name#869 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, c_salutation#867 ASC NULLS FIRST, c_preferred_cust_flag#870 DESC NULLS LAST, ss_ticket_number#1912L ASC NULLS FIRST], true\n+- Project [c_last_name#869, c_first_name#868, c_salutation#867, c_preferred_cust_flag#870, ss_ticket_number#1912L, cnt#17155L]\n   +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n      :- Filter ((cnt#17155L >= 15) && (cnt#17155L <= 20))\n      :  +- Aggregate [ss_ticket_number#1912L, ss_customer_sk#1906], [ss_ticket_number#1912L, ss_customer_sk#1906, count(1) AS cnt#17155L]\n      :     +- Project [ss_customer_sk#1906, ss_ticket_number#1912L]\n      :        +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n      :           :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_ticket_number#1912L]\n      :           :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n      :           :     :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_store_sk#1910, ss_ticket_number#1912L]\n      :           :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n      :           :     :     :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_store_sk#1910, ss_ticket_number#1912L, ss_sold_date_sk#1926]\n      :           :     :     :  +- Filter (((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_customer_sk#1906))\n      :           :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :           :     :     +- Project [d_date_sk#1040]\n      :           :     :        +- Filter (((((d_dom#1049 >= 1) && (d_dom#1049 <= 3)) || ((d_dom#1049 >= 25) && (d_dom#1049 <= 28))) && d_year#1046 IN (1999,2000,2001)) && isnotnull(d_date_sk#1040))\n      :           :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n      :           :     +- Project [s_store_sk#1386]\n      :           :        +- Filter (s_county#1409 IN (Williamson County) && isnotnull(s_store_sk#1386))\n      :           :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n      :           +- Project [hd_demo_sk#1106]\n      :              +- Filter ((((isnotnull(hd_vehicle_count#1110) && ((hd_buy_potential#1108 = >10000) || (hd_buy_potential#1108 = unknown))) && (hd_vehicle_count#1110 > 0)) && (CASE WHEN (hd_vehicle_count#1110 > 0) THEN (cast(hd_dep_count#1109 as double) / cast(hd_vehicle_count#1110 as double)) ELSE null END > 1.2)) && isnotnull(hd_demo_sk#1106))\n      :                 +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n      +- Project [c_customer_sk#860, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870]\n         +- Filter isnotnull(c_customer_sk#860)\n            +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n\n== Physical Plan ==\n*(7) Sort [c_last_name#869 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, c_salutation#867 ASC NULLS FIRST, c_preferred_cust_flag#870 DESC NULLS LAST, ss_ticket_number#1912L ASC NULLS FIRST], true, 0\n+- Exchange rangepartitioning(c_last_name#869 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, c_salutation#867 ASC NULLS FIRST, c_preferred_cust_flag#870 DESC NULLS LAST, ss_ticket_number#1912L ASC NULLS FIRST, 200)\n   +- *(6) Project [c_last_name#869, c_first_name#868, c_salutation#867, c_preferred_cust_flag#870, ss_ticket_number#1912L, cnt#17155L]\n      +- *(6) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n         :- *(6) Filter ((cnt#17155L >= 15) && (cnt#17155L <= 20))\n         :  +- *(6) HashAggregate(keys=[ss_ticket_number#1912L, ss_customer_sk#1906], functions=[count(1)], output=[ss_ticket_number#1912L, ss_customer_sk#1906, cnt#17155L])\n         :     +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_customer_sk#1906, 200)\n         :        +- *(4) HashAggregate(keys=[ss_ticket_number#1912L, ss_customer_sk#1906], functions=[partial_count(1)], output=[ss_ticket_number#1912L, ss_customer_sk#1906, count#17164L])\n         :           +- *(4) Project [ss_customer_sk#1906, ss_ticket_number#1912L]\n         :              +- *(4) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n         :                 :- *(4) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_ticket_number#1912L]\n         :                 :  +- *(4) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n         :                 :     :- *(4) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_store_sk#1910, ss_ticket_number#1912L]\n         :                 :     :  +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n         :                 :     :     :- *(4) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_store_sk#1910, ss_ticket_number#1912L, ss_sold_date_sk#1926]\n         :                 :     :     :  +- *(4) Filter ((isnotnull(ss_store_sk#1910) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_customer_sk#1906))\n         :                 :     :     :     +- *(4) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_hdemo_sk#1908,ss_store_sk#1910,ss_ticket_number#1912L,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_hdemo_sk:int,ss_store_sk:int,ss_ticket_number:bigint>\n         :                 :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                 :     :        +- *(1) Project [d_date_sk#1040]\n         :                 :     :           +- *(1) Filter (((((d_dom#1049 >= 1) && (d_dom#1049 <= 3)) || ((d_dom#1049 >= 25) && (d_dom#1049 <= 28))) && d_year#1046 IN (1999,2000,2001)) && isnotnull(d_date_sk#1040))\n         :                 :     :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_dom#1049] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [Or(And(GreaterThanOrEqual(d_dom,1),LessThanOrEqual(d_dom,3)),And(GreaterThanOrEqual(d_dom,25),Le..., ReadSchema: struct<d_date_sk:int,d_year:int,d_dom:int>\n         :                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                 :        +- *(2) Project [s_store_sk#1386]\n         :                 :           +- *(2) Filter (s_county#1409 IN (Williamson County) && isnotnull(s_store_sk#1386))\n         :                 :              +- *(2) FileScan parquet db_tpcds.store[s_store_sk#1386,s_county#1409] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [In(s_county, [Williamson County]), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_county:string>\n         :                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    +- *(3) Project [hd_demo_sk#1106]\n         :                       +- *(3) Filter ((((isnotnull(hd_vehicle_count#1110) && ((hd_buy_potential#1108 = >10000) || (hd_buy_potential#1108 = unknown))) && (hd_vehicle_count#1110 > 0)) && (CASE WHEN (hd_vehicle_count#1110 > 0) THEN (cast(hd_dep_count#1109 as double) / cast(hd_vehicle_count#1110 as double)) ELSE null END > 1.2)) && isnotnull(hd_demo_sk#1106))\n         :                          +- *(3) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(hd_vehicle_count), Or(EqualTo(hd_buy_potential,>10000),EqualTo(hd_buy_potential,unknow..., ReadSchema: struct<hd_demo_sk:int,hd_buy_potential:string,hd_dep_count:int,hd_vehicle_count:int>\n         +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            +- *(5) Project [c_customer_sk#860, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870]\n               +- *(5) Filter isnotnull(c_customer_sk#860)\n                  +- *(5) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int,c_salutation:string,c_first_name:string,c_last_name:string,c_preferred_c..."},{"name":"q35-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["customer","customer_address","customer_demographics"],"parsingTime":0.002583,"analysisTime":6.51E-4,"optimizationTime":815.50816,"planningTime":37.561442,"executionTime":10987.01829,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['ca_state ASC NULLS FIRST, 'cd_gender ASC NULLS FIRST, 'cd_marital_status ASC NULLS FIRST, 'cd_dep_count ASC NULLS FIRST, 'cd_dep_employed_count ASC NULLS FIRST, 'cd_dep_college_count ASC NULLS FIRST], true\n      +- 'Aggregate ['ca_state, 'cd_gender, 'cd_marital_status, 'cd_dep_count, 'cd_dep_employed_count, 'cd_dep_college_count], ['ca_state, 'cd_gender, 'cd_marital_status, 'cd_dep_count, 'count(1) AS cnt1#17253, unresolvedalias('min('cd_dep_count), None), unresolvedalias('max('cd_dep_count), None), unresolvedalias('avg('cd_dep_count), None), 'cd_dep_employed_count, 'count(1) AS cnt2#17254, unresolvedalias('min('cd_dep_employed_count), None), unresolvedalias('max('cd_dep_employed_count), None), unresolvedalias('avg('cd_dep_employed_count), None), 'cd_dep_college_count, 'count(1) AS cnt3#17255, unresolvedalias('min('cd_dep_college_count), None), unresolvedalias('max('cd_dep_college_count), None), unresolvedalias('avg('cd_dep_college_count), None)]\n         +- 'Filter ((('c.c_current_addr_sk = 'ca.ca_address_sk) && ('cd_demo_sk = 'c.c_current_cdemo_sk)) && (exists#17256 [] && (exists#17257 [] || exists#17258 [])))\n            :  :- 'Project [*]\n            :  :  +- 'Filter ((('c.c_customer_sk = 'ss_customer_sk) && ('ss_sold_date_sk = 'd_date_sk)) && (('d_year = 2002) && ('d_qoy < 4)))\n            :  :     +- 'Join Inner\n            :  :        :- 'UnresolvedRelation `store_sales`\n            :  :        +- 'UnresolvedRelation `date_dim`\n            :  :- 'Project [*]\n            :  :  +- 'Filter ((('c.c_customer_sk = 'ws_bill_customer_sk) && ('ws_sold_date_sk = 'd_date_sk)) && (('d_year = 2002) && ('d_qoy < 4)))\n            :  :     +- 'Join Inner\n            :  :        :- 'UnresolvedRelation `web_sales`\n            :  :        +- 'UnresolvedRelation `date_dim`\n            :  +- 'Project [*]\n            :     +- 'Filter ((('c.c_customer_sk = 'cs_ship_customer_sk) && ('cs_sold_date_sk = 'd_date_sk)) && (('d_year = 2002) && ('d_qoy < 4)))\n            :        +- 'Join Inner\n            :           :- 'UnresolvedRelation `catalog_sales`\n            :           +- 'UnresolvedRelation `date_dim`\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'SubqueryAlias c\n               :  :  +- 'UnresolvedRelation `customer`\n               :  +- 'SubqueryAlias ca\n               :     +- 'UnresolvedRelation `customer_address`\n               +- 'UnresolvedRelation `customer_demographics`\n\n== Analyzed Logical Plan ==\nca_state: string, cd_gender: string, cd_marital_status: string, cd_dep_count: int, cnt1: bigint, min(cd_dep_count): int, max(cd_dep_count): int, avg(cd_dep_count): double, cd_dep_employed_count: int, cnt2: bigint, min(cd_dep_employed_count): int, max(cd_dep_employed_count): int, avg(cd_dep_employed_count): double, cd_dep_college_count: int, cnt3: bigint, min(cd_dep_college_count): int, max(cd_dep_college_count): int, avg(cd_dep_college_count): double\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [ca_state#930, cd_gender#967, cd_marital_status#968, cd_dep_count#972, cnt1#17253L, min(cd_dep_count)#17271, max(cd_dep_count)#17272, avg(cd_dep_count)#17273, cd_dep_employed_count#973, cnt2#17254L, min(cd_dep_employed_count)#17274, max(cd_dep_employed_count)#17275, avg(cd_dep_employed_count)#17276, cd_dep_college_count#974, cnt3#17255L, min(cd_dep_college_count)#17277, max(cd_dep_college_count)#17278, avg(cd_dep_college_count)#17279]\n      +- Sort [ca_state#930 ASC NULLS FIRST, cd_gender#967 ASC NULLS FIRST, cd_marital_status#968 ASC NULLS FIRST, cd_dep_count#972 ASC NULLS FIRST, cd_dep_employed_count#973 ASC NULLS FIRST, cd_dep_college_count#974 ASC NULLS FIRST], true\n         +- Aggregate [ca_state#930, cd_gender#967, cd_marital_status#968, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974], [ca_state#930, cd_gender#967, cd_marital_status#968, cd_dep_count#972, count(1) AS cnt1#17253L, min(cd_dep_count#972) AS min(cd_dep_count)#17271, max(cd_dep_count#972) AS max(cd_dep_count)#17272, avg(cast(cd_dep_count#972 as bigint)) AS avg(cd_dep_count)#17273, cd_dep_employed_count#973, count(1) AS cnt2#17254L, min(cd_dep_employed_count#973) AS min(cd_dep_employed_count)#17274, max(cd_dep_employed_count#973) AS max(cd_dep_employed_count)#17275, avg(cast(cd_dep_employed_count#973 as bigint)) AS avg(cd_dep_employed_count)#17276, cd_dep_college_count#974, count(1) AS cnt3#17255L, min(cd_dep_college_count#974) AS min(cd_dep_college_count)#17277, max(cd_dep_college_count#974) AS max(cd_dep_college_count)#17278, avg(cast(cd_dep_college_count#974 as bigint)) AS avg(cd_dep_college_count)#17279]\n            +- Filter (((c_current_addr_sk#864 = ca_address_sk#922) && (cd_demo_sk#966 = c_current_cdemo_sk#862)) && (exists#17256 [c_customer_sk#860] && (exists#17257 [c_customer_sk#860] || exists#17258 [c_customer_sk#860])))\n               :  :- Project [ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, ... 27 more fields]\n               :  :  +- Filter (((outer(c_customer_sk#860) = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && ((d_year#1046 = 2002) && (d_qoy#1050 < 4)))\n               :  :     +- Join Inner\n               :  :        :- SubqueryAlias store_sales\n               :  :        :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :        +- SubqueryAlias date_dim\n               :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :- Project [ws_sold_time_sk#1755, ws_ship_date_sk#1756, ws_item_sk#1757, ws_bill_customer_sk#1758, ws_bill_cdemo_sk#1759, ws_bill_hdemo_sk#1760, ws_bill_addr_sk#1761, ws_ship_customer_sk#1762, ws_ship_cdemo_sk#1763, ws_ship_hdemo_sk#1764, ws_ship_addr_sk#1765, ws_web_page_sk#1766, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_promo_sk#1770, ws_order_number#1771L, ws_quantity#1772, ws_wholesale_cost#1773, ws_list_price#1774, ws_sales_price#1775, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ... 38 more fields]\n               :  :  +- Filter (((outer(c_customer_sk#860) = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && ((d_year#1046 = 2002) && (d_qoy#1050 < 4)))\n               :  :     +- Join Inner\n               :  :        :- SubqueryAlias web_sales\n               :  :        :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :  :        +- SubqueryAlias date_dim\n               :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  +- Project [cs_sold_time_sk#1789, cs_ship_date_sk#1790, cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_bill_addr_sk#1794, cs_ship_customer_sk#1795, cs_ship_cdemo_sk#1796, cs_ship_hdemo_sk#1797, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_catalog_page_sk#1800, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_wholesale_cost#1807, cs_list_price#1808, cs_sales_price#1809, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, ... 38 more fields]\n               :     +- Filter (((outer(c_customer_sk#860) = cs_ship_customer_sk#1795) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && ((d_year#1046 = 2002) && (d_qoy#1050 < 4)))\n               :        +- Join Inner\n               :           :- SubqueryAlias catalog_sales\n               :           :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :           +- SubqueryAlias date_dim\n               :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- Join Inner\n                  :- Join Inner\n                  :  :- SubqueryAlias c\n                  :  :  +- SubqueryAlias customer\n                  :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :  +- SubqueryAlias ca\n                  :     +- SubqueryAlias customer_address\n                  :        +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  +- SubqueryAlias customer_demographics\n                     +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [ca_state#930 ASC NULLS FIRST, cd_gender#967 ASC NULLS FIRST, cd_marital_status#968 ASC NULLS FIRST, cd_dep_count#972 ASC NULLS FIRST, cd_dep_employed_count#973 ASC NULLS FIRST, cd_dep_college_count#974 ASC NULLS FIRST], true\n      +- Aggregate [ca_state#930, cd_gender#967, cd_marital_status#968, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974], [ca_state#930, cd_gender#967, cd_marital_status#968, cd_dep_count#972, count(1) AS cnt1#17253L, min(cd_dep_count#972) AS min(cd_dep_count)#17271, max(cd_dep_count#972) AS max(cd_dep_count)#17272, avg(cast(cd_dep_count#972 as bigint)) AS avg(cd_dep_count)#17273, cd_dep_employed_count#973, count(1) AS cnt2#17254L, min(cd_dep_employed_count#973) AS min(cd_dep_employed_count)#17274, max(cd_dep_employed_count#973) AS max(cd_dep_employed_count)#17275, avg(cast(cd_dep_employed_count#973 as bigint)) AS avg(cd_dep_employed_count)#17276, cd_dep_college_count#974, count(1) AS cnt3#17255L, min(cd_dep_college_count#974) AS min(cd_dep_college_count)#17277, max(cd_dep_college_count#974) AS max(cd_dep_college_count)#17278, avg(cast(cd_dep_college_count#974 as bigint)) AS avg(cd_dep_college_count)#17279]\n         +- Project [ca_state#930, cd_gender#967, cd_marital_status#968, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974]\n            +- Join Inner, (cd_demo_sk#966 = c_current_cdemo_sk#862)\n               :- Project [c_current_cdemo_sk#862, ca_state#930]\n               :  +- Join Inner, (c_current_addr_sk#864 = ca_address_sk#922)\n               :     :- Project [c_current_cdemo_sk#862, c_current_addr_sk#864]\n               :     :  +- Filter (exists#17304 || exists#17305)\n               :     :     +- Join ExistenceJoin(exists#17305), (c_customer_sk#860 = cs_ship_customer_sk#1795)\n               :     :        :- Join ExistenceJoin(exists#17304), (c_customer_sk#860 = ws_bill_customer_sk#1758)\n               :     :        :  :- Join LeftSemi, (c_customer_sk#860 = ss_customer_sk#1906)\n               :     :        :  :  :- Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_addr_sk#864]\n               :     :        :  :  :  +- Filter (isnotnull(c_current_addr_sk#864) && isnotnull(c_current_cdemo_sk#862))\n               :     :        :  :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :     :        :  :  +- Project [ss_customer_sk#1906]\n               :     :        :  :     +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :     :        :  :        :- Project [ss_customer_sk#1906, ss_sold_date_sk#1926]\n               :     :        :  :        :  +- Filter isnotnull(ss_sold_date_sk#1926)\n               :     :        :  :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :        :  :        +- Project [d_date_sk#1040]\n               :     :        :  :           +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_qoy#1050)) && (d_year#1046 = 2002)) && (d_qoy#1050 < 4)) && isnotnull(d_date_sk#1040))\n               :     :        :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :        :  +- Project [ws_bill_customer_sk#1758]\n               :     :        :     +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n               :     :        :        :- Project [ws_bill_customer_sk#1758, ws_sold_date_sk#1788]\n               :     :        :        :  +- Filter isnotnull(ws_sold_date_sk#1788)\n               :     :        :        :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :        :        +- Project [d_date_sk#1040]\n               :     :        :           +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_qoy#1050)) && (d_year#1046 = 2002)) && (d_qoy#1050 < 4)) && isnotnull(d_date_sk#1040))\n               :     :        :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :        +- Project [cs_ship_customer_sk#1795]\n               :     :           +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :     :              :- Project [cs_ship_customer_sk#1795, cs_sold_date_sk#1822]\n               :     :              :  +- Filter isnotnull(cs_sold_date_sk#1822)\n               :     :              :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :              +- Project [d_date_sk#1040]\n               :     :                 +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_qoy#1050)) && (d_year#1046 = 2002)) && (d_qoy#1050 < 4)) && isnotnull(d_date_sk#1040))\n               :     :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [ca_address_sk#922, ca_state#930]\n               :        +- Filter isnotnull(ca_address_sk#922)\n               :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- Project [cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974]\n                  +- Filter isnotnull(cd_demo_sk#966)\n                     +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[ca_state#930 ASC NULLS FIRST,cd_gender#967 ASC NULLS FIRST,cd_marital_status#968 ASC NULLS FIRST,cd_dep_count#972 ASC NULLS FIRST,cd_dep_employed_count#973 ASC NULLS FIRST,cd_dep_college_count#974 ASC NULLS FIRST], output=[ca_state#930,cd_gender#967,cd_marital_status#968,cd_dep_count#972,cnt1#17253L,min(cd_dep_count)#17271,max(cd_dep_count)#17272,avg(cd_dep_count)#17273,cd_dep_employed_count#973,cnt2#17254L,min(cd_dep_employed_count)#17274,max(cd_dep_employed_count)#17275,avg(cd_dep_employed_count)#17276,cd_dep_college_count#974,cnt3#17255L,min(cd_dep_college_count)#17277,max(cd_dep_college_count)#17278,avg(cd_dep_college_count)#17279])\n+- *(15) HashAggregate(keys=[ca_state#930, cd_gender#967, cd_marital_status#968, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974], functions=[count(1), min(cd_dep_count#972), max(cd_dep_count#972), avg(cast(cd_dep_count#972 as bigint)), min(cd_dep_employed_count#973), max(cd_dep_employed_count#973), avg(cast(cd_dep_employed_count#973 as bigint)), min(cd_dep_college_count#974), max(cd_dep_college_count#974), avg(cast(cd_dep_college_count#974 as bigint))], output=[ca_state#930, cd_gender#967, cd_marital_status#968, cd_dep_count#972, cnt1#17253L, min(cd_dep_count)#17271, max(cd_dep_count)#17272, avg(cd_dep_count)#17273, cd_dep_employed_count#973, cnt2#17254L, min(cd_dep_employed_count)#17274, max(cd_dep_employed_count)#17275, avg(cd_dep_employed_count)#17276, cd_dep_college_count#974, cnt3#17255L, min(cd_dep_college_count)#17277, max(cd_dep_college_count)#17278, avg(cd_dep_college_count)#17279])\n   +- Exchange hashpartitioning(ca_state#930, cd_gender#967, cd_marital_status#968, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974, 200)\n      +- *(14) HashAggregate(keys=[ca_state#930, cd_gender#967, cd_marital_status#968, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974], functions=[partial_count(1), partial_min(cd_dep_count#972), partial_max(cd_dep_count#972), partial_avg(cast(cd_dep_count#972 as bigint)), partial_min(cd_dep_employed_count#973), partial_max(cd_dep_employed_count#973), partial_avg(cast(cd_dep_employed_count#973 as bigint)), partial_min(cd_dep_college_count#974), partial_max(cd_dep_college_count#974), partial_avg(cast(cd_dep_college_count#974 as bigint))], output=[ca_state#930, cd_gender#967, cd_marital_status#968, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974, count#17319L, min#17320, max#17321, sum#17322, count#17323L, min#17324, max#17325, sum#17326, count#17327L, min#17328, max#17329, sum#17330, count#17331L])\n         +- *(14) Project [ca_state#930, cd_gender#967, cd_marital_status#968, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974]\n            +- *(14) BroadcastHashJoin [c_current_cdemo_sk#862], [cd_demo_sk#966], Inner, BuildRight\n               :- *(14) Project [c_current_cdemo_sk#862, ca_state#930]\n               :  +- *(14) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n               :     :- *(14) Project [c_current_cdemo_sk#862, c_current_addr_sk#864]\n               :     :  +- *(14) Filter (exists#17304 || exists#17305)\n               :     :     +- SortMergeJoin [c_customer_sk#860], [cs_ship_customer_sk#1795], ExistenceJoin(exists#17305)\n               :     :        :- SortMergeJoin [c_customer_sk#860], [ws_bill_customer_sk#1758], ExistenceJoin(exists#17304)\n               :     :        :  :- SortMergeJoin [c_customer_sk#860], [ss_customer_sk#1906], LeftSemi\n               :     :        :  :  :- *(2) Sort [c_customer_sk#860 ASC NULLS FIRST], false, 0\n               :     :        :  :  :  +- Exchange hashpartitioning(c_customer_sk#860, 200)\n               :     :        :  :  :     +- *(1) Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_addr_sk#864]\n               :     :        :  :  :        +- *(1) Filter (isnotnull(c_current_addr_sk#864) && isnotnull(c_current_cdemo_sk#862))\n               :     :        :  :  :           +- *(1) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_cdemo_sk#862,c_current_addr_sk#864] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_current_addr_sk), IsNotNull(c_current_cdemo_sk)], ReadSchema: struct<c_customer_sk:int,c_current_cdemo_sk:int,c_current_addr_sk:int>\n               :     :        :  :  +- *(5) Sort [ss_customer_sk#1906 ASC NULLS FIRST], false, 0\n               :     :        :  :     +- Exchange hashpartitioning(ss_customer_sk#1906, 200)\n               :     :        :  :        +- *(4) Project [ss_customer_sk#1906]\n               :     :        :  :           +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :        :  :              :- *(4) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [], ReadSchema: struct<ss_customer_sk:int>\n               :     :        :  :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        :  :                 +- *(3) Project [d_date_sk#1040]\n               :     :        :  :                    +- *(3) Filter ((((isnotnull(d_year#1046) && isnotnull(d_qoy#1050)) && (d_year#1046 = 2002)) && (d_qoy#1050 < 4)) && isnotnull(d_date_sk#1040))\n               :     :        :  :                       +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_qoy#1050] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_qoy), EqualTo(d_year,2002), LessThan(d_qoy,4), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>\n               :     :        :  +- *(8) Sort [ws_bill_customer_sk#1758 ASC NULLS FIRST], false, 0\n               :     :        :     +- Exchange hashpartitioning(ws_bill_customer_sk#1758, 200)\n               :     :        :        +- *(7) Project [ws_bill_customer_sk#1758]\n               :     :        :           +- *(7) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n               :     :        :              :- *(7) FileScan parquet db_tpcds.web_sales[ws_bill_customer_sk#1758,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [], ReadSchema: struct<ws_bill_customer_sk:int>\n               :     :        :              +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(11) Sort [cs_ship_customer_sk#1795 ASC NULLS FIRST], false, 0\n               :     :           +- Exchange hashpartitioning(cs_ship_customer_sk#1795, 200)\n               :     :              +- *(10) Project [cs_ship_customer_sk#1795]\n               :     :                 +- *(10) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :     :                    :- *(10) FileScan parquet db_tpcds.catalog_sales[cs_ship_customer_sk#1795,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_ship_customer_sk:int>\n               :     :                    +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(12) Project [ca_address_sk#922, ca_state#930]\n               :           +- *(12) Filter isnotnull(ca_address_sk#922)\n               :              +- *(12) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(13) Project [cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_dep_count#972, cd_dep_employed_count#973, cd_dep_college_count#974]\n                     +- *(13) Filter isnotnull(cd_demo_sk#966)\n                        +- *(13) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:int,cd_gender:string,cd_marital_status:string,cd_dep_count:int,cd_dep_employed_..."},{"name":"q36-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","date_dim","item","store"],"parsingTime":0.002281,"analysisTime":6.81E-4,"optimizationTime":279.201065,"planningTime":14.333108,"executionTime":3960.045482,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['lochierarchy DESC NULLS LAST, CASE WHEN ('lochierarchy = 0) THEN 'i_category END ASC NULLS FIRST, 'rank_within_parent ASC NULLS FIRST], true\n      +- 'Aggregate ['rollup('i_category, 'i_class)], [('sum('ss_net_profit) / 'sum('ss_ext_sales_price)) AS gross_margin#17431, 'i_category, 'i_class, ('grouping('i_category) + 'grouping('i_class)) AS lochierarchy#17432, 'rank() windowspecdefinition(('grouping('i_category) + 'grouping('i_class)), CASE WHEN ('grouping('i_class) = 0) THEN 'i_category END, ('sum('ss_net_profit) / 'sum('ss_ext_sales_price)) ASC NULLS FIRST, unspecifiedframe$()) AS rank_within_parent#17433]\n         +- 'Filter (((('d1.d_year = 2001) && ('d1.d_date_sk = 'ss_sold_date_sk)) && ('i_item_sk = 'ss_item_sk)) && (('s_store_sk = 'ss_store_sk) && 's_state IN (TN,TN,TN,TN,TN,TN,TN,TN)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'UnresolvedRelation `store_sales`\n               :  :  +- 'SubqueryAlias d1\n               :  :     +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `item`\n               +- 'UnresolvedRelation `store`\n\n== Analyzed Logical Plan ==\ngross_margin: decimal(37,20), i_category: string, i_class: string, lochierarchy: tinyint, rank_within_parent: int\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [lochierarchy#17432 DESC NULLS LAST, CASE WHEN (cast(lochierarchy#17432 as int) = 0) THEN i_category#17443 END ASC NULLS FIRST, rank_within_parent#17433 ASC NULLS FIRST], true\n      +- Project [gross_margin#17431, i_category#17443, i_class#17444, lochierarchy#17432, rank_within_parent#17433]\n         +- Project [gross_margin#17431, i_category#17443, i_class#17444, lochierarchy#17432, _w0#17453, _w1#17457, _w2#17458, _w3#17459, rank_within_parent#17433, rank_within_parent#17433]\n            +- Window [rank(_w3#17459) windowspecdefinition(_w1#17457, _w2#17458, _w3#17459 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#17433], [_w1#17457, _w2#17458], [_w3#17459 ASC NULLS FIRST]\n               +- Aggregate [i_category#17443, i_class#17444, spark_grouping_id#17440], [CheckOverflow((promote_precision(cast(sum(ss_net_profit#1925) as decimal(17,2))) / promote_precision(cast(sum(ss_ext_sales_price#1918) as decimal(17,2)))), DecimalType(37,20)) AS gross_margin#17431, i_category#17443, i_class#17444, (cast((shiftright(spark_grouping_id#17440, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#17440, 0) & 1) as tinyint)) AS lochierarchy#17432, CheckOverflow((promote_precision(cast(sum(ss_net_profit#1925) as decimal(17,2))) / promote_precision(cast(sum(ss_ext_sales_price#1918) as decimal(17,2)))), DecimalType(37,20)) AS _w0#17453, (cast((shiftright(spark_grouping_id#17440, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#17440, 0) & 1) as tinyint)) AS _w1#17457, CASE WHEN (cast(cast((shiftright(spark_grouping_id#17440, 0) & 1) as tinyint) as int) = 0) THEN i_category#17443 END AS _w2#17458, CheckOverflow((promote_precision(cast(sum(ss_net_profit#1925) as decimal(17,2))) / promote_precision(cast(sum(ss_ext_sales_price#1918) as decimal(17,2)))), DecimalType(37,20)) AS _w3#17459]\n                  +- Expand [List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_category#17441, i_class#17442, 0), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_category#17441, null, 1), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, null, null, 3)], [ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, ... 81 more fields]\n                     +- Project [ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, ... 80 more fields]\n                        +- Filter ((((d_year#1046 = 2001) && (d_date_sk#1040 = ss_sold_date_sk#1926)) && (i_item_sk#1172 = ss_item_sk#1905)) && ((s_store_sk#1386 = ss_store_sk#1910) && s_state#1410 IN (TN,TN,TN,TN,TN,TN,TN,TN)))\n                           +- Join Inner\n                              :- Join Inner\n                              :  :- Join Inner\n                              :  :  :- SubqueryAlias store_sales\n                              :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                              :  :  +- SubqueryAlias d1\n                              :  :     +- SubqueryAlias date_dim\n                              :  :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :  +- SubqueryAlias item\n                              :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                              +- SubqueryAlias store\n                                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [lochierarchy#17432 DESC NULLS LAST, CASE WHEN (cast(lochierarchy#17432 as int) = 0) THEN i_category#17443 END ASC NULLS FIRST, rank_within_parent#17433 ASC NULLS FIRST], true\n      +- Project [gross_margin#17431, i_category#17443, i_class#17444, lochierarchy#17432, rank_within_parent#17433]\n         +- Window [rank(_w3#17459) windowspecdefinition(_w1#17457, _w2#17458, _w3#17459 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#17433], [_w1#17457, _w2#17458], [_w3#17459 ASC NULLS FIRST]\n            +- Aggregate [i_category#17443, i_class#17444, spark_grouping_id#17440], [CheckOverflow((promote_precision(MakeDecimal(sum(UnscaledValue(ss_net_profit#1925)),17,2)) / promote_precision(MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2))), DecimalType(37,20)) AS gross_margin#17431, i_category#17443, i_class#17444, (cast((shiftright(spark_grouping_id#17440, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#17440, 0) & 1) as tinyint)) AS lochierarchy#17432, (cast((shiftright(spark_grouping_id#17440, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#17440, 0) & 1) as tinyint)) AS _w1#17457, CASE WHEN (cast(cast((shiftright(spark_grouping_id#17440, 0) & 1) as tinyint) as int) = 0) THEN i_category#17443 END AS _w2#17458, CheckOverflow((promote_precision(MakeDecimal(sum(UnscaledValue(ss_net_profit#1925)),17,2)) / promote_precision(MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2))), DecimalType(37,20)) AS _w3#17459]\n               +- Expand [List(ss_ext_sales_price#1918, ss_net_profit#1925, i_category#1184, i_class#1182, 0), List(ss_ext_sales_price#1918, ss_net_profit#1925, i_category#1184, null, 1), List(ss_ext_sales_price#1918, ss_net_profit#1925, null, null, 3)], [ss_ext_sales_price#1918, ss_net_profit#1925, i_category#17443, i_class#17444, spark_grouping_id#17440]\n                  +- Project [ss_ext_sales_price#1918, ss_net_profit#1925, i_category#1184, i_class#1182]\n                     +- Join Inner, (s_store_sk#1386 = ss_store_sk#1910)\n                        :- Project [ss_store_sk#1910, ss_ext_sales_price#1918, ss_net_profit#1925, i_class#1182, i_category#1184]\n                        :  +- Join Inner, (i_item_sk#1172 = ss_item_sk#1905)\n                        :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_ext_sales_price#1918, ss_net_profit#1925]\n                        :     :  +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n                        :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_ext_sales_price#1918, ss_net_profit#1925, ss_sold_date_sk#1926]\n                        :     :     :  +- Filter ((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_item_sk#1905)) && isnotnull(ss_store_sk#1910))\n                        :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :     :     +- Project [d_date_sk#1040]\n                        :     :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n                        :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :     +- Project [i_item_sk#1172, i_class#1182, i_category#1184]\n                        :        +- Filter isnotnull(i_item_sk#1172)\n                        :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        +- Project [s_store_sk#1386]\n                           +- Filter (s_state#1410 IN (TN) && isnotnull(s_store_sk#1386))\n                              +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[lochierarchy#17432 DESC NULLS LAST,CASE WHEN (cast(lochierarchy#17432 as int) = 0) THEN i_category#17443 END ASC NULLS FIRST,rank_within_parent#17433 ASC NULLS FIRST], output=[gross_margin#17431,i_category#17443,i_class#17444,lochierarchy#17432,rank_within_parent#17433])\n+- *(7) Project [gross_margin#17431, i_category#17443, i_class#17444, lochierarchy#17432, rank_within_parent#17433]\n   +- Window [rank(_w3#17459) windowspecdefinition(_w1#17457, _w2#17458, _w3#17459 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#17433], [_w1#17457, _w2#17458], [_w3#17459 ASC NULLS FIRST]\n      +- *(6) Sort [_w1#17457 ASC NULLS FIRST, _w2#17458 ASC NULLS FIRST, _w3#17459 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(_w1#17457, _w2#17458, 200)\n            +- *(5) HashAggregate(keys=[i_category#17443, i_class#17444, spark_grouping_id#17440], functions=[sum(UnscaledValue(ss_net_profit#1925)), sum(UnscaledValue(ss_ext_sales_price#1918))], output=[gross_margin#17431, i_category#17443, i_class#17444, lochierarchy#17432, _w1#17457, _w2#17458, _w3#17459])\n               +- Exchange hashpartitioning(i_category#17443, i_class#17444, spark_grouping_id#17440, 200)\n                  +- *(4) HashAggregate(keys=[i_category#17443, i_class#17444, spark_grouping_id#17440], functions=[partial_sum(UnscaledValue(ss_net_profit#1925)), partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[i_category#17443, i_class#17444, spark_grouping_id#17440, sum#17476L, sum#17477L])\n                     +- *(4) Expand [List(ss_ext_sales_price#1918, ss_net_profit#1925, i_category#1184, i_class#1182, 0), List(ss_ext_sales_price#1918, ss_net_profit#1925, i_category#1184, null, 1), List(ss_ext_sales_price#1918, ss_net_profit#1925, null, null, 3)], [ss_ext_sales_price#1918, ss_net_profit#1925, i_category#17443, i_class#17444, spark_grouping_id#17440]\n                        +- *(4) Project [ss_ext_sales_price#1918, ss_net_profit#1925, i_category#1184, i_class#1182]\n                           +- *(4) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                              :- *(4) Project [ss_store_sk#1910, ss_ext_sales_price#1918, ss_net_profit#1925, i_class#1182, i_category#1184]\n                              :  +- *(4) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n                              :     :- *(4) Project [ss_item_sk#1905, ss_store_sk#1910, ss_ext_sales_price#1918, ss_net_profit#1925]\n                              :     :  +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                              :     :     :- *(4) Project [ss_item_sk#1905, ss_store_sk#1910, ss_ext_sales_price#1918, ss_net_profit#1925, ss_sold_date_sk#1926]\n                              :     :     :  +- *(4) Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_store_sk#1910))\n                              :     :     :     +- *(4) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_store_sk#1910,ss_ext_sales_price#1918,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:int,ss_store_sk:int,ss_ext_sales_price:decimal(7,2),ss_net_profit:decimal(7,2)>\n                              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :        +- *(1) Project [d_date_sk#1040]\n                              :     :           +- *(1) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n                              :     :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n                              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :        +- *(2) Project [i_item_sk#1172, i_class#1182, i_category#1184]\n                              :           +- *(2) Filter isnotnull(i_item_sk#1172)\n                              :              +- *(2) FileScan parquet db_tpcds.item[i_item_sk#1172,i_class#1182,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_class:string,i_category:string>\n                              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 +- *(3) Project [s_store_sk#1386]\n                                    +- *(3) Filter (s_state#1410 IN (TN) && isnotnull(s_store_sk#1386))\n                                       +- *(3) FileScan parquet db_tpcds.store[s_store_sk#1386,s_state#1410] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [In(s_state, [TN]), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_state:string>"},{"name":"q37-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["item","inventory","date_dim","catalog_sales"],"parsingTime":0.002879,"analysisTime":9.48E-4,"optimizationTime":77.997795,"planningTime":227.967332,"executionTime":3008.405294,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_item_id ASC NULLS FIRST], true\n      +- 'Aggregate ['i_item_id, 'i_item_desc, 'i_current_price], ['i_item_id, 'i_item_desc, 'i_current_price]\n         +- 'Filter ((((('i_current_price >= 68) && ('i_current_price <= (68 + 30))) && ('inv_item_sk = 'i_item_sk)) && (('d_date_sk = 'inv_date_sk) && (('d_date >= cast(2000-02-01 as date)) && ('d_date <= (cast(2000-02-01 as date) + interval 8 weeks 4 days))))) && (('i_manufact_id IN (677,940,694,808) && (('inv_quantity_on_hand >= 100) && ('inv_quantity_on_hand <= 500))) && ('cs_item_sk = 'i_item_sk)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'UnresolvedRelation `item`\n               :  :  +- 'UnresolvedRelation `inventory`\n               :  +- 'UnresolvedRelation `date_dim`\n               +- 'UnresolvedRelation `catalog_sales`\n\n== Analyzed Logical Plan ==\ni_item_id: string, i_item_desc: string, i_current_price: decimal(7,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#1173 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173, i_item_desc#1176, i_current_price#1177], [i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n         +- Filter (((((cast(i_current_price#1177 as decimal(7,2)) >= cast(cast(68 as decimal(2,0)) as decimal(7,2))) && (cast(i_current_price#1177 as decimal(12,2)) <= cast(cast((68 + 30) as decimal(10,0)) as decimal(12,2)))) && (inv_item_sk#2865 = i_item_sk#1172)) && ((d_date_sk#1040 = inv_date_sk#2868) && ((d_date#1042 >= cast(2000-02-01 as date)) && (d_date#1042 <= cast(cast(cast(2000-02-01 as date) as timestamp) + interval 8 weeks 4 days as date))))) && ((i_manufact_id#1185 IN (677,940,694,808) && ((inv_quantity_on_hand#2867 >= 100) && (inv_quantity_on_hand#2867 <= 500))) && (cs_item_sk#1803 = i_item_sk#1172)))\n            +- Join Inner\n               :- Join Inner\n               :  :- Join Inner\n               :  :  :- SubqueryAlias item\n               :  :  :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  :  +- SubqueryAlias inventory\n               :  :     +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n               :  +- SubqueryAlias date_dim\n               :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- SubqueryAlias catalog_sales\n                  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#1173 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173, i_item_desc#1176, i_current_price#1177], [i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n         +- Project [i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n            +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n               :- Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n               :  +- Join Inner, (d_date_sk#1040 = inv_date_sk#2868)\n               :     :- Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177, inv_date_sk#2868]\n               :     :  +- Join Inner, (inv_item_sk#2865 = i_item_sk#1172)\n               :     :     :- Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n               :     :     :  +- Filter ((((isnotnull(i_current_price#1177) && (i_current_price#1177 >= 68.00)) && (cast(i_current_price#1177 as decimal(12,2)) <= 98.00)) && i_manufact_id#1185 IN (677,940,694,808)) && isnotnull(i_item_sk#1172))\n               :     :     :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :     :     +- Project [inv_item_sk#2865, inv_date_sk#2868]\n               :     :        +- Filter ((((isnotnull(inv_quantity_on_hand#2867) && (inv_quantity_on_hand#2867 >= 100)) && (inv_quantity_on_hand#2867 <= 500)) && isnotnull(inv_item_sk#2865)) && isnotnull(inv_date_sk#2868))\n               :     :           +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n               :     +- Project [d_date_sk#1040]\n               :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10988)) && (d_date#1042 <= 11048)) && isnotnull(d_date_sk#1040))\n               :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- Project [cs_item_sk#1803]\n                  +- Filter isnotnull(cs_item_sk#1803)\n                     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_item_id#1173 ASC NULLS FIRST], output=[i_item_id#1173,i_item_desc#1176,i_current_price#1177])\n+- *(8) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, i_current_price#1177], functions=[], output=[i_item_id#1173, i_item_desc#1176, i_current_price#1177])\n   +- Exchange hashpartitioning(i_item_id#1173, i_item_desc#1176, i_current_price#1177, 200)\n      +- *(7) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, i_current_price#1177], functions=[], output=[i_item_id#1173, i_item_desc#1176, i_current_price#1177])\n         +- *(7) Project [i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n            +- *(7) SortMergeJoin [i_item_sk#1172], [cs_item_sk#1803], Inner\n               :- *(4) Sort [i_item_sk#1172 ASC NULLS FIRST], false, 0\n               :  +- Exchange hashpartitioning(i_item_sk#1172, 200)\n               :     +- *(3) Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n               :        +- *(3) BroadcastHashJoin [inv_date_sk#2868], [d_date_sk#1040], Inner, BuildRight\n               :           :- *(3) Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177, inv_date_sk#2868]\n               :           :  +- *(3) BroadcastHashJoin [i_item_sk#1172], [inv_item_sk#2865], Inner, BuildLeft\n               :           :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :           :     :  +- *(1) Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n               :           :     :     +- *(1) Filter ((((isnotnull(i_current_price#1177) && (i_current_price#1177 >= 68.00)) && (cast(i_current_price#1177 as decimal(12,2)) <= 98.00)) && i_manufact_id#1185 IN (677,940,694,808)) && isnotnull(i_item_sk#1172))\n               :           :     :        +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173,i_item_desc#1176,i_current_price#1177,i_manufact_id#1185] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThanOrEqual(i_current_price,68.00), In(i_manufact_id, [677,94..., ReadSchema: struct<i_item_sk:int,i_item_id:string,i_item_desc:string,i_current_price:decimal(7,2),i_manufact_...\n               :           :     +- *(3) Project [inv_item_sk#2865, inv_date_sk#2868]\n               :           :        +- *(3) Filter (((isnotnull(inv_quantity_on_hand#2867) && (inv_quantity_on_hand#2867 >= 100)) && (inv_quantity_on_hand#2867 <= 500)) && isnotnull(inv_item_sk#2865))\n               :           :           +- *(3) FileScan parquet db_tpcds.inventory[inv_item_sk#2865,inv_quantity_on_hand#2867,inv_date_sk#2868] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/inventory/inv_dat..., PartitionCount: 261, PartitionFilters: [isnotnull(inv_date_sk#2868)], PushedFilters: [IsNotNull(inv_quantity_on_hand), GreaterThanOrEqual(inv_quantity_on_hand,100), LessThanOrEqual(i..., ReadSchema: struct<inv_item_sk:int,inv_quantity_on_hand:int>\n               :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :              +- *(2) Project [d_date_sk#1040]\n               :                 +- *(2) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10988)) && (d_date#1042 <= 11048)) && isnotnull(d_date_sk#1040))\n               :                    +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2000-02-01), LessThanOrEqual(d_date,2000-04-01), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>\n               +- *(6) Sort [cs_item_sk#1803 ASC NULLS FIRST], false, 0\n                  +- Exchange hashpartitioning(cs_item_sk#1803, 200)\n                     +- *(5) Project [cs_item_sk#1803]\n                        +- *(5) Filter isnotnull(cs_item_sk#1803)\n                           +- *(5) FileScan parquet db_tpcds.catalog_sales[cs_item_sk#1803,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales], PartitionCount: 1831, PartitionFilters: [], PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:int>"},{"name":"q38-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","date_dim","customer","catalog_sales","date_dim","customer","web_sales","date_dim","customer"],"parsingTime":0.002658,"analysisTime":5.98E-4,"optimizationTime":766.712921,"planningTime":71.349429,"executionTime":11397.924932,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Project [unresolvedalias('count(1), None)]\n      +- 'SubqueryAlias hot_cust\n         +- 'Intersect\n            :- 'Intersect\n            :  :- 'Distinct\n            :  :  +- 'Project ['c_last_name, 'c_first_name, 'd_date]\n            :  :     +- 'Filter ((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) && ('store_sales.ss_customer_sk = 'customer.c_customer_sk)) && (('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11))))\n            :  :        +- 'Join Inner\n            :  :           :- 'Join Inner\n            :  :           :  :- 'UnresolvedRelation `store_sales`\n            :  :           :  +- 'UnresolvedRelation `date_dim`\n            :  :           +- 'UnresolvedRelation `customer`\n            :  +- 'Distinct\n            :     +- 'Project ['c_last_name, 'c_first_name, 'd_date]\n            :        +- 'Filter ((('catalog_sales.cs_sold_date_sk = 'date_dim.d_date_sk) && ('catalog_sales.cs_bill_customer_sk = 'customer.c_customer_sk)) && (('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11))))\n            :           +- 'Join Inner\n            :              :- 'Join Inner\n            :              :  :- 'UnresolvedRelation `catalog_sales`\n            :              :  +- 'UnresolvedRelation `date_dim`\n            :              +- 'UnresolvedRelation `customer`\n            +- 'Distinct\n               +- 'Project ['c_last_name, 'c_first_name, 'd_date]\n                  +- 'Filter ((('web_sales.ws_sold_date_sk = 'date_dim.d_date_sk) && ('web_sales.ws_bill_customer_sk = 'customer.c_customer_sk)) && (('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11))))\n                     +- 'Join Inner\n                        :- 'Join Inner\n                        :  :- 'UnresolvedRelation `web_sales`\n                        :  +- 'UnresolvedRelation `date_dim`\n                        +- 'UnresolvedRelation `customer`\n\n== Analyzed Logical Plan ==\ncount(1): bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Aggregate [count(1) AS count(1)#17794L]\n      +- SubqueryAlias hot_cust\n         +- Intersect\n            :- Project [c_last_name#869, c_first_name#868, d_date#1042]\n            :  +- Intersect\n            :     :- Project [c_last_name#869, c_first_name#868, d_date#1042]\n            :     :  +- Distinct\n            :     :     +- Project [c_last_name#869, c_first_name#868, d_date#1042]\n            :     :        +- Filter (((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_customer_sk#1906 = c_customer_sk#860)) && ((d_month_seq#1043 >= 1200) && (d_month_seq#1043 <= (1200 + 11))))\n            :     :           +- Join Inner\n            :     :              :- Join Inner\n            :     :              :  :- SubqueryAlias store_sales\n            :     :              :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :              :  +- SubqueryAlias date_dim\n            :     :              :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :              +- SubqueryAlias customer\n            :     :                 +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :     +- Project [c_last_name#17721, c_first_name#17720, d_date#17668]\n            :        +- Distinct\n            :           +- Project [c_last_name#17721, c_first_name#17720, d_date#17668]\n            :              +- Filter (((cs_sold_date_sk#1822 = d_date_sk#17666) && (cs_bill_customer_sk#1791 = c_customer_sk#17712)) && ((d_month_seq#17669 >= 1200) && (d_month_seq#17669 <= (1200 + 11))))\n            :                 +- Join Inner\n            :                    :- Join Inner\n            :                    :  :- SubqueryAlias catalog_sales\n            :                    :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :                    :  +- SubqueryAlias date_dim\n            :                    :     +- Relation[d_date_sk#17666,d_date_id#17667,d_date#17668,d_month_seq#17669,d_week_seq#17670,d_quarter_seq#17671,d_year#17672,d_dow#17673,d_moy#17674,d_dom#17675,d_qoy#17676,d_fy_year#17677,d_fy_quarter_seq#17678,d_fy_week_seq#17679,d_day_name#17680,d_quarter_name#17681,d_holiday#17682,d_weekend#17683,d_following_holiday#17684,d_first_dom#17685,d_last_dom#17686,d_same_day_ly#17687,d_same_day_lq#17688,d_current_day#17689,... 4 more fields] parquet\n            :                    +- SubqueryAlias customer\n            :                       +- Relation[c_customer_sk#17712,c_customer_id#17713,c_current_cdemo_sk#17714,c_current_hdemo_sk#17715,c_current_addr_sk#17716,c_first_shipto_date_sk#17717,c_first_sales_date_sk#17718,c_salutation#17719,c_first_name#17720,c_last_name#17721,c_preferred_cust_flag#17722,c_birth_day#17723,c_birth_month#17724,c_birth_year#17725,c_birth_country#17726,c_login#17727,c_email_address#17728,c_last_review_date#17729] parquet\n            +- Project [c_last_name#17785, c_first_name#17784, d_date#17732]\n               +- Distinct\n                  +- Project [c_last_name#17785, c_first_name#17784, d_date#17732]\n                     +- Filter (((ws_sold_date_sk#1788 = d_date_sk#17730) && (ws_bill_customer_sk#1758 = c_customer_sk#17776)) && ((d_month_seq#17733 >= 1200) && (d_month_seq#17733 <= (1200 + 11))))\n                        +- Join Inner\n                           :- Join Inner\n                           :  :- SubqueryAlias web_sales\n                           :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                           :  +- SubqueryAlias date_dim\n                           :     +- Relation[d_date_sk#17730,d_date_id#17731,d_date#17732,d_month_seq#17733,d_week_seq#17734,d_quarter_seq#17735,d_year#17736,d_dow#17737,d_moy#17738,d_dom#17739,d_qoy#17740,d_fy_year#17741,d_fy_quarter_seq#17742,d_fy_week_seq#17743,d_day_name#17744,d_quarter_name#17745,d_holiday#17746,d_weekend#17747,d_following_holiday#17748,d_first_dom#17749,d_last_dom#17750,d_same_day_ly#17751,d_same_day_lq#17752,d_current_day#17753,... 4 more fields] parquet\n                           +- SubqueryAlias customer\n                              +- Relation[c_customer_sk#17776,c_customer_id#17777,c_current_cdemo_sk#17778,c_current_hdemo_sk#17779,c_current_addr_sk#17780,c_first_shipto_date_sk#17781,c_first_sales_date_sk#17782,c_salutation#17783,c_first_name#17784,c_last_name#17785,c_preferred_cust_flag#17786,c_birth_day#17787,c_birth_month#17788,c_birth_year#17789,c_birth_country#17790,c_login#17791,c_email_address#17792,c_last_review_date#17793] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Aggregate [count(1) AS count(1)#17794L]\n      +- Aggregate [c_last_name#869, c_first_name#868, d_date#1042]\n         +- Join LeftSemi, (((c_last_name#869 <=> c_last_name#17785) && (c_first_name#868 <=> c_first_name#17784)) && (d_date#1042 <=> d_date#17732))\n            :- Aggregate [c_last_name#869, c_first_name#868, d_date#1042], [c_last_name#869, c_first_name#868, d_date#1042]\n            :  +- Join LeftSemi, (((c_last_name#869 <=> c_last_name#17721) && (c_first_name#868 <=> c_first_name#17720)) && (d_date#1042 <=> d_date#17668))\n            :     :- Aggregate [c_last_name#869, c_first_name#868, d_date#1042], [c_last_name#869, c_first_name#868, d_date#1042]\n            :     :  +- Project [c_last_name#869, c_first_name#868, d_date#1042]\n            :     :     +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n            :     :        :- Project [ss_customer_sk#1906, d_date#1042]\n            :     :        :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :     :        :     :- Project [ss_customer_sk#1906, ss_sold_date_sk#1926]\n            :     :        :     :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_customer_sk#1906))\n            :     :        :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :        :     +- Project [d_date_sk#1040, d_date#1042]\n            :     :        :        +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n            :     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :        +- Project [c_customer_sk#860, c_first_name#868, c_last_name#869]\n            :     :           +- Filter isnotnull(c_customer_sk#860)\n            :     :              +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :     +- Aggregate [c_last_name#17721, c_first_name#17720, d_date#17668], [c_last_name#17721, c_first_name#17720, d_date#17668]\n            :        +- Project [c_last_name#17721, c_first_name#17720, d_date#17668]\n            :           +- Join Inner, (cs_bill_customer_sk#1791 = c_customer_sk#17712)\n            :              :- Project [cs_bill_customer_sk#1791, d_date#17668]\n            :              :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#17666)\n            :              :     :- Project [cs_bill_customer_sk#1791, cs_sold_date_sk#1822]\n            :              :     :  +- Filter (isnotnull(cs_sold_date_sk#1822) && isnotnull(cs_bill_customer_sk#1791))\n            :              :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :              :     +- Project [d_date_sk#17666, d_date#17668]\n            :              :        +- Filter (((isnotnull(d_month_seq#17669) && (d_month_seq#17669 >= 1200)) && (d_month_seq#17669 <= 1211)) && isnotnull(d_date_sk#17666))\n            :              :           +- Relation[d_date_sk#17666,d_date_id#17667,d_date#17668,d_month_seq#17669,d_week_seq#17670,d_quarter_seq#17671,d_year#17672,d_dow#17673,d_moy#17674,d_dom#17675,d_qoy#17676,d_fy_year#17677,d_fy_quarter_seq#17678,d_fy_week_seq#17679,d_day_name#17680,d_quarter_name#17681,d_holiday#17682,d_weekend#17683,d_following_holiday#17684,d_first_dom#17685,d_last_dom#17686,d_same_day_ly#17687,d_same_day_lq#17688,d_current_day#17689,... 4 more fields] parquet\n            :              +- Project [c_customer_sk#17712, c_first_name#17720, c_last_name#17721]\n            :                 +- Filter isnotnull(c_customer_sk#17712)\n            :                    +- Relation[c_customer_sk#17712,c_customer_id#17713,c_current_cdemo_sk#17714,c_current_hdemo_sk#17715,c_current_addr_sk#17716,c_first_shipto_date_sk#17717,c_first_sales_date_sk#17718,c_salutation#17719,c_first_name#17720,c_last_name#17721,c_preferred_cust_flag#17722,c_birth_day#17723,c_birth_month#17724,c_birth_year#17725,c_birth_country#17726,c_login#17727,c_email_address#17728,c_last_review_date#17729] parquet\n            +- Aggregate [c_last_name#17785, c_first_name#17784, d_date#17732], [c_last_name#17785, c_first_name#17784, d_date#17732]\n               +- Project [c_last_name#17785, c_first_name#17784, d_date#17732]\n                  +- Join Inner, (ws_bill_customer_sk#1758 = c_customer_sk#17776)\n                     :- Project [ws_bill_customer_sk#1758, d_date#17732]\n                     :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#17730)\n                     :     :- Project [ws_bill_customer_sk#1758, ws_sold_date_sk#1788]\n                     :     :  +- Filter (isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_bill_customer_sk#1758))\n                     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :     +- Project [d_date_sk#17730, d_date#17732]\n                     :        +- Filter (((isnotnull(d_month_seq#17733) && (d_month_seq#17733 >= 1200)) && (d_month_seq#17733 <= 1211)) && isnotnull(d_date_sk#17730))\n                     :           +- Relation[d_date_sk#17730,d_date_id#17731,d_date#17732,d_month_seq#17733,d_week_seq#17734,d_quarter_seq#17735,d_year#17736,d_dow#17737,d_moy#17738,d_dom#17739,d_qoy#17740,d_fy_year#17741,d_fy_quarter_seq#17742,d_fy_week_seq#17743,d_day_name#17744,d_quarter_name#17745,d_holiday#17746,d_weekend#17747,d_following_holiday#17748,d_first_dom#17749,d_last_dom#17750,d_same_day_ly#17751,d_same_day_lq#17752,d_current_day#17753,... 4 more fields] parquet\n                     +- Project [c_customer_sk#17776, c_first_name#17784, c_last_name#17785]\n                        +- Filter isnotnull(c_customer_sk#17776)\n                           +- Relation[c_customer_sk#17776,c_customer_id#17777,c_current_cdemo_sk#17778,c_current_hdemo_sk#17779,c_current_addr_sk#17780,c_first_shipto_date_sk#17781,c_first_sales_date_sk#17782,c_salutation#17783,c_first_name#17784,c_last_name#17785,c_preferred_cust_flag#17786,c_birth_day#17787,c_birth_month#17788,c_birth_year#17789,c_birth_country#17790,c_login#17791,c_email_address#17792,c_last_review_date#17793] parquet\n\n== Physical Plan ==\nCollectLimit 100\n+- *(21) LocalLimit 100\n   +- *(21) HashAggregate(keys=[], functions=[count(1)], output=[count(1)#17794L])\n      +- Exchange SinglePartition\n         +- *(20) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#17797L])\n            +- *(20) HashAggregate(keys=[c_last_name#869, c_first_name#868, d_date#1042], functions=[], output=[])\n               +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, d_date#1042, 200)\n                  +- *(19) HashAggregate(keys=[c_last_name#869, c_first_name#868, d_date#1042], functions=[], output=[c_last_name#869, c_first_name#868, d_date#1042])\n                     +- SortMergeJoin [coalesce(c_last_name#869, ), coalesce(c_first_name#868, ), coalesce(d_date#1042, 0)], [coalesce(c_last_name#17785, ), coalesce(c_first_name#17784, ), coalesce(d_date#17732, 0)], LeftSemi, (((c_last_name#869 <=> c_last_name#17785) && (c_first_name#868 <=> c_first_name#17784)) && (d_date#1042 <=> d_date#17732))\n                        :- *(13) Sort [coalesce(c_last_name#869, ) ASC NULLS FIRST, coalesce(c_first_name#868, ) ASC NULLS FIRST, coalesce(d_date#1042, 0) ASC NULLS FIRST], false, 0\n                        :  +- Exchange hashpartitioning(coalesce(c_last_name#869, ), coalesce(c_first_name#868, ), coalesce(d_date#1042, 0), 200)\n                        :     +- *(12) HashAggregate(keys=[c_last_name#869, c_first_name#868, d_date#1042], functions=[], output=[c_last_name#869, c_first_name#868, d_date#1042])\n                        :        +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, d_date#1042, 200)\n                        :           +- *(11) HashAggregate(keys=[c_last_name#869, c_first_name#868, d_date#1042], functions=[], output=[c_last_name#869, c_first_name#868, d_date#1042])\n                        :              +- SortMergeJoin [coalesce(c_last_name#869, ), coalesce(c_first_name#868, ), coalesce(d_date#1042, 0)], [coalesce(c_last_name#17721, ), coalesce(c_first_name#17720, ), coalesce(d_date#17668, 0)], LeftSemi, (((c_last_name#869 <=> c_last_name#17721) && (c_first_name#868 <=> c_first_name#17720)) && (d_date#1042 <=> d_date#17668))\n                        :                 :- *(5) Sort [coalesce(c_last_name#869, ) ASC NULLS FIRST, coalesce(c_first_name#868, ) ASC NULLS FIRST, coalesce(d_date#1042, 0) ASC NULLS FIRST], false, 0\n                        :                 :  +- Exchange hashpartitioning(coalesce(c_last_name#869, ), coalesce(c_first_name#868, ), coalesce(d_date#1042, 0), 200)\n                        :                 :     +- *(4) HashAggregate(keys=[c_last_name#869, c_first_name#868, d_date#1042], functions=[], output=[c_last_name#869, c_first_name#868, d_date#1042])\n                        :                 :        +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, d_date#1042, 200)\n                        :                 :           +- *(3) HashAggregate(keys=[c_last_name#869, c_first_name#868, d_date#1042], functions=[], output=[c_last_name#869, c_first_name#868, d_date#1042])\n                        :                 :              +- *(3) Project [c_last_name#869, c_first_name#868, d_date#1042]\n                        :                 :                 +- *(3) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n                        :                 :                    :- *(3) Project [ss_customer_sk#1906, d_date#1042]\n                        :                 :                    :  +- *(3) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                        :                 :                    :     :- *(3) Project [ss_customer_sk#1906, ss_sold_date_sk#1926]\n                        :                 :                    :     :  +- *(3) Filter isnotnull(ss_customer_sk#1906)\n                        :                 :                    :     :     +- *(3) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int>\n                        :                 :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        :                 :                    :        +- *(1) Project [d_date_sk#1040, d_date#1042]\n                        :                 :                    :           +- *(1) Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                        :                 :                    :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042,d_month_seq#1043] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_date:date,d_month_seq:int>\n                        :                 :                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        :                 :                       +- *(2) Project [c_customer_sk#860, c_first_name#868, c_last_name#869]\n                        :                 :                          +- *(2) Filter isnotnull(c_customer_sk#860)\n                        :                 :                             +- *(2) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_first_name#868,c_last_name#869] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int,c_first_name:string,c_last_name:string>\n                        :                 +- *(10) Sort [coalesce(c_last_name#17721, ) ASC NULLS FIRST, coalesce(c_first_name#17720, ) ASC NULLS FIRST, coalesce(d_date#17668, 0) ASC NULLS FIRST], false, 0\n                        :                    +- Exchange hashpartitioning(coalesce(c_last_name#17721, ), coalesce(c_first_name#17720, ), coalesce(d_date#17668, 0), 200)\n                        :                       +- *(9) HashAggregate(keys=[c_last_name#17721, c_first_name#17720, d_date#17668], functions=[], output=[c_last_name#17721, c_first_name#17720, d_date#17668])\n                        :                          +- Exchange hashpartitioning(c_last_name#17721, c_first_name#17720, d_date#17668, 200)\n                        :                             +- *(8) HashAggregate(keys=[c_last_name#17721, c_first_name#17720, d_date#17668], functions=[], output=[c_last_name#17721, c_first_name#17720, d_date#17668])\n                        :                                +- *(8) Project [c_last_name#17721, c_first_name#17720, d_date#17668]\n                        :                                   +- *(8) BroadcastHashJoin [cs_bill_customer_sk#1791], [c_customer_sk#17712], Inner, BuildRight\n                        :                                      :- *(8) Project [cs_bill_customer_sk#1791, d_date#17668]\n                        :                                      :  +- *(8) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#17666], Inner, BuildRight\n                        :                                      :     :- *(8) Project [cs_bill_customer_sk#1791, cs_sold_date_sk#1822]\n                        :                                      :     :  +- *(8) Filter isnotnull(cs_bill_customer_sk#1791)\n                        :                                      :     :     +- *(8) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:int>\n                        :                                      :     +- ReusedExchange [d_date_sk#17666, d_date#17668], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        :                                      +- ReusedExchange [c_customer_sk#17712, c_first_name#17720, c_last_name#17721], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        +- *(18) Sort [coalesce(c_last_name#17785, ) ASC NULLS FIRST, coalesce(c_first_name#17784, ) ASC NULLS FIRST, coalesce(d_date#17732, 0) ASC NULLS FIRST], false, 0\n                           +- Exchange hashpartitioning(coalesce(c_last_name#17785, ), coalesce(c_first_name#17784, ), coalesce(d_date#17732, 0), 200)\n                              +- *(17) HashAggregate(keys=[c_last_name#17785, c_first_name#17784, d_date#17732], functions=[], output=[c_last_name#17785, c_first_name#17784, d_date#17732])\n                                 +- Exchange hashpartitioning(c_last_name#17785, c_first_name#17784, d_date#17732, 200)\n                                    +- *(16) HashAggregate(keys=[c_last_name#17785, c_first_name#17784, d_date#17732], functions=[], output=[c_last_name#17785, c_first_name#17784, d_date#17732])\n                                       +- *(16) Project [c_last_name#17785, c_first_name#17784, d_date#17732]\n                                          +- *(16) BroadcastHashJoin [ws_bill_customer_sk#1758], [c_customer_sk#17776], Inner, BuildRight\n                                             :- *(16) Project [ws_bill_customer_sk#1758, d_date#17732]\n                                             :  +- *(16) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#17730], Inner, BuildRight\n                                             :     :- *(16) Project [ws_bill_customer_sk#1758, ws_sold_date_sk#1788]\n                                             :     :  +- *(16) Filter isnotnull(ws_bill_customer_sk#1758)\n                                             :     :     +- *(16) FileScan parquet db_tpcds.web_sales[ws_bill_customer_sk#1758,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:int>\n                                             :     +- ReusedExchange [d_date_sk#17730, d_date#17732], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                             +- ReusedExchange [c_customer_sk#17776, c_first_name#17784, c_last_name#17785], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q39a-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["inv","inv"],"parsingTime":0.003271,"analysisTime":0.001011,"optimizationTime":214.214205,"planningTime":20.679941,"executionTime":6747.208493,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [inv]\n:  +- 'SubqueryAlias inv\n:     +- 'Project ['w_warehouse_name, 'w_warehouse_sk, 'i_item_sk, 'd_moy, 'stdev, 'mean, CASE WHEN ('mean = 0) THEN null ELSE ('stdev / 'mean) END AS cov#18322]\n:        +- 'Filter (CASE WHEN ('mean = 0) THEN 0 ELSE ('stdev / 'mean) END > 1)\n:           +- 'SubqueryAlias foo\n:              +- 'Aggregate ['w_warehouse_name, 'w_warehouse_sk, 'i_item_sk, 'd_moy], ['w_warehouse_name, 'w_warehouse_sk, 'i_item_sk, 'd_moy, 'stddev_samp('inv_quantity_on_hand) AS stdev#18320, 'avg('inv_quantity_on_hand) AS mean#18321]\n:                 +- 'Filter ((('inv_item_sk = 'i_item_sk) && ('inv_warehouse_sk = 'w_warehouse_sk)) && (('inv_date_sk = 'd_date_sk) && ('d_year = 2001)))\n:                    +- 'Join Inner\n:                       :- 'Join Inner\n:                       :  :- 'Join Inner\n:                       :  :  :- 'UnresolvedRelation `inventory`\n:                       :  :  +- 'UnresolvedRelation `item`\n:                       :  +- 'UnresolvedRelation `warehouse`\n:                       +- 'UnresolvedRelation `date_dim`\n+- 'Sort ['inv1.w_warehouse_sk ASC NULLS FIRST, 'inv1.i_item_sk ASC NULLS FIRST, 'inv1.d_moy ASC NULLS FIRST, 'inv1.mean ASC NULLS FIRST, 'inv1.cov ASC NULLS FIRST, 'inv2.d_moy ASC NULLS FIRST, 'inv2.mean ASC NULLS FIRST, 'inv2.cov ASC NULLS FIRST], true\n   +- 'Project ['inv1.w_warehouse_sk, 'inv1.i_item_sk, 'inv1.d_moy, 'inv1.mean, 'inv1.cov, 'inv2.w_warehouse_sk, 'inv2.i_item_sk, 'inv2.d_moy, 'inv2.mean, 'inv2.cov]\n      +- 'Filter ((('inv1.i_item_sk = 'inv2.i_item_sk) && ('inv1.w_warehouse_sk = 'inv2.w_warehouse_sk)) && (('inv1.d_moy = 1) && ('inv2.d_moy = (1 + 1))))\n         +- 'Join Inner\n            :- 'SubqueryAlias inv1\n            :  +- 'UnresolvedRelation `inv`\n            +- 'SubqueryAlias inv2\n               +- 'UnresolvedRelation `inv`\n\n== Analyzed Logical Plan ==\nw_warehouse_sk: int, i_item_sk: int, d_moy: int, mean: double, cov: double, w_warehouse_sk: int, i_item_sk: int, d_moy: int, mean: double, cov: double\nSort [w_warehouse_sk#1512 ASC NULLS FIRST, i_item_sk#1172 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, mean#18321 ASC NULLS FIRST, cov#18322 ASC NULLS FIRST, d_moy#18596 ASC NULLS FIRST, mean#18417 ASC NULLS FIRST, cov#18349 ASC NULLS FIRST], true\n+- Project [w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, mean#18321, cov#18322, w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596, mean#18417, cov#18349]\n   +- Filter (((i_item_sk#1172 = i_item_sk#18482) && (w_warehouse_sk#1512 = w_warehouse_sk#18546)) && ((d_moy#1048 = 1) && (d_moy#18596 = (1 + 1))))\n      +- Join Inner\n         :- SubqueryAlias inv1\n         :  +- SubqueryAlias inv\n         :     +- Project [w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, stdev#18320, mean#18321, CASE WHEN (mean#18321 = cast(0 as double)) THEN cast(null as double) ELSE (stdev#18320 / mean#18321) END AS cov#18322]\n         :        +- Filter (CASE WHEN (mean#18321 = cast(0 as double)) THEN cast(0 as double) ELSE (stdev#18320 / mean#18321) END > cast(1 as double))\n         :           +- SubqueryAlias foo\n         :              +- Aggregate [w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048], [w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, stddev_samp(cast(inv_quantity_on_hand#2867 as double)) AS stdev#18320, avg(cast(inv_quantity_on_hand#2867 as bigint)) AS mean#18321]\n         :                 +- Filter (((inv_item_sk#2865 = i_item_sk#1172) && (inv_warehouse_sk#2866 = w_warehouse_sk#1512)) && ((inv_date_sk#2868 = d_date_sk#1040) && (d_year#1046 = 2001)))\n         :                    +- Join Inner\n         :                       :- Join Inner\n         :                       :  :- Join Inner\n         :                       :  :  :- SubqueryAlias inventory\n         :                       :  :  :  +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n         :                       :  :  +- SubqueryAlias item\n         :                       :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :                       :  +- SubqueryAlias warehouse\n         :                       :     +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n         :                       +- SubqueryAlias date_dim\n         :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         +- SubqueryAlias inv2\n            +- SubqueryAlias inv\n               +- Project [w_warehouse_name#18548, w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596, stdev#18416, mean#18417, CASE WHEN (mean#18417 = cast(0 as double)) THEN cast(null as double) ELSE (stdev#18416 / mean#18417) END AS cov#18349]\n                  +- Filter (CASE WHEN (mean#18417 = cast(0 as double)) THEN cast(0 as double) ELSE (stdev#18416 / mean#18417) END > cast(1 as double))\n                     +- SubqueryAlias foo\n                        +- Aggregate [w_warehouse_name#18548, w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596], [w_warehouse_name#18548, w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596, stddev_samp(cast(inv_quantity_on_hand#2867 as double)) AS stdev#18416, avg(cast(inv_quantity_on_hand#2867 as bigint)) AS mean#18417]\n                           +- Filter (((inv_item_sk#2865 = i_item_sk#18482) && (inv_warehouse_sk#2866 = w_warehouse_sk#18546)) && ((inv_date_sk#2868 = d_date_sk#18588) && (d_year#18594 = 2001)))\n                              +- Join Inner\n                                 :- Join Inner\n                                 :  :- Join Inner\n                                 :  :  :- SubqueryAlias inventory\n                                 :  :  :  +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n                                 :  :  +- SubqueryAlias item\n                                 :  :     +- Relation[i_item_sk#18482,i_item_id#18483,i_rec_start_date#18484,i_rec_end_date#18485,i_item_desc#18486,i_current_price#18487,i_wholesale_cost#18488,i_brand_id#18489,i_brand#18490,i_class_id#18491,i_class#18492,i_category_id#18493,i_category#18494,i_manufact_id#18495,i_manufact#18496,i_size#18497,i_formulation#18498,i_color#18499,i_units#18500,i_container#18501,i_manager_id#18502,i_product_name#18503] parquet\n                                 :  +- SubqueryAlias warehouse\n                                 :     +- Relation[w_warehouse_sk#18546,w_warehouse_id#18547,w_warehouse_name#18548,w_warehouse_sq_ft#18549,w_street_number#18550,w_street_name#18551,w_street_type#18552,w_suite_number#18553,w_city#18554,w_county#18555,w_state#18556,w_zip#18557,w_country#18558,w_gmt_offset#18559] parquet\n                                 +- SubqueryAlias date_dim\n                                    +- Relation[d_date_sk#18588,d_date_id#18589,d_date#18590,d_month_seq#18591,d_week_seq#18592,d_quarter_seq#18593,d_year#18594,d_dow#18595,d_moy#18596,d_dom#18597,d_qoy#18598,d_fy_year#18599,d_fy_quarter_seq#18600,d_fy_week_seq#18601,d_day_name#18602,d_quarter_name#18603,d_holiday#18604,d_weekend#18605,d_following_holiday#18606,d_first_dom#18607,d_last_dom#18608,d_same_day_ly#18609,d_same_day_lq#18610,d_current_day#18611,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nSort [w_warehouse_sk#1512 ASC NULLS FIRST, i_item_sk#1172 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, mean#18321 ASC NULLS FIRST, cov#18322 ASC NULLS FIRST, d_moy#18596 ASC NULLS FIRST, mean#18417 ASC NULLS FIRST, cov#18349 ASC NULLS FIRST], true\n+- Join Inner, ((i_item_sk#1172 = i_item_sk#18482) && (w_warehouse_sk#1512 = w_warehouse_sk#18546))\n   :- Project [w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, mean#18321, CASE WHEN (mean#18321 = 0.0) THEN null ELSE (stdev#18320 / mean#18321) END AS cov#18322]\n   :  +- Filter (CASE WHEN (mean#18321 = 0.0) THEN 0.0 ELSE (stdev#18320 / mean#18321) END > 1.0)\n   :     +- Aggregate [w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048], [w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, stddev_samp(cast(inv_quantity_on_hand#2867 as double)) AS stdev#18320, avg(cast(inv_quantity_on_hand#2867 as bigint)) AS mean#18321]\n   :        +- Project [inv_quantity_on_hand#2867, i_item_sk#1172, w_warehouse_sk#1512, w_warehouse_name#1514, d_moy#1048]\n   :           +- Join Inner, (inv_date_sk#2868 = d_date_sk#1040)\n   :              :- Project [inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#1172, w_warehouse_sk#1512, w_warehouse_name#1514]\n   :              :  +- Join Inner, (inv_warehouse_sk#2866 = w_warehouse_sk#1512)\n   :              :     :- Project [inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#1172]\n   :              :     :  +- Join Inner, (inv_item_sk#2865 = i_item_sk#1172)\n   :              :     :     :- Filter ((isnotnull(inv_item_sk#2865) && isnotnull(inv_warehouse_sk#2866)) && isnotnull(inv_date_sk#2868))\n   :              :     :     :  +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n   :              :     :     +- Project [i_item_sk#1172]\n   :              :     :        +- Filter isnotnull(i_item_sk#1172)\n   :              :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n   :              :     +- Project [w_warehouse_sk#1512, w_warehouse_name#1514]\n   :              :        +- Filter isnotnull(w_warehouse_sk#1512)\n   :              :           +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n   :              +- Project [d_date_sk#1040, d_moy#1048]\n   :                 +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 1)) && isnotnull(d_date_sk#1040))\n   :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n   +- Project [w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596, mean#18417, CASE WHEN (mean#18417 = 0.0) THEN null ELSE (stdev#18416 / mean#18417) END AS cov#18349]\n      +- Filter (CASE WHEN (mean#18417 = 0.0) THEN 0.0 ELSE (stdev#18416 / mean#18417) END > 1.0)\n         +- Aggregate [w_warehouse_name#18548, w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596], [w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596, stddev_samp(cast(inv_quantity_on_hand#2867 as double)) AS stdev#18416, avg(cast(inv_quantity_on_hand#2867 as bigint)) AS mean#18417]\n            +- Project [inv_quantity_on_hand#2867, i_item_sk#18482, w_warehouse_sk#18546, w_warehouse_name#18548, d_moy#18596]\n               +- Join Inner, (inv_date_sk#2868 = d_date_sk#18588)\n                  :- Project [inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#18482, w_warehouse_sk#18546, w_warehouse_name#18548]\n                  :  +- Join Inner, (inv_warehouse_sk#2866 = w_warehouse_sk#18546)\n                  :     :- Project [inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#18482]\n                  :     :  +- Join Inner, (inv_item_sk#2865 = i_item_sk#18482)\n                  :     :     :- Filter ((isnotnull(inv_item_sk#2865) && isnotnull(inv_warehouse_sk#2866)) && isnotnull(inv_date_sk#2868))\n                  :     :     :  +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n                  :     :     +- Project [i_item_sk#18482]\n                  :     :        +- Filter isnotnull(i_item_sk#18482)\n                  :     :           +- Relation[i_item_sk#18482,i_item_id#18483,i_rec_start_date#18484,i_rec_end_date#18485,i_item_desc#18486,i_current_price#18487,i_wholesale_cost#18488,i_brand_id#18489,i_brand#18490,i_class_id#18491,i_class#18492,i_category_id#18493,i_category#18494,i_manufact_id#18495,i_manufact#18496,i_size#18497,i_formulation#18498,i_color#18499,i_units#18500,i_container#18501,i_manager_id#18502,i_product_name#18503] parquet\n                  :     +- Project [w_warehouse_sk#18546, w_warehouse_name#18548]\n                  :        +- Filter isnotnull(w_warehouse_sk#18546)\n                  :           +- Relation[w_warehouse_sk#18546,w_warehouse_id#18547,w_warehouse_name#18548,w_warehouse_sq_ft#18549,w_street_number#18550,w_street_name#18551,w_street_type#18552,w_suite_number#18553,w_city#18554,w_county#18555,w_state#18556,w_zip#18557,w_country#18558,w_gmt_offset#18559] parquet\n                  +- Project [d_date_sk#18588, d_moy#18596]\n                     +- Filter ((((isnotnull(d_year#18594) && isnotnull(d_moy#18596)) && (d_year#18594 = 2001)) && (d_moy#18596 = 2)) && isnotnull(d_date_sk#18588))\n                        +- Relation[d_date_sk#18588,d_date_id#18589,d_date#18590,d_month_seq#18591,d_week_seq#18592,d_quarter_seq#18593,d_year#18594,d_dow#18595,d_moy#18596,d_dom#18597,d_qoy#18598,d_fy_year#18599,d_fy_quarter_seq#18600,d_fy_week_seq#18601,d_day_name#18602,d_quarter_name#18603,d_holiday#18604,d_weekend#18605,d_following_holiday#18606,d_first_dom#18607,d_last_dom#18608,d_same_day_ly#18609,d_same_day_lq#18610,d_current_day#18611,... 4 more fields] parquet\n\n== Physical Plan ==\n*(14) Sort [w_warehouse_sk#1512 ASC NULLS FIRST, i_item_sk#1172 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, mean#18321 ASC NULLS FIRST, cov#18322 ASC NULLS FIRST, d_moy#18596 ASC NULLS FIRST, mean#18417 ASC NULLS FIRST, cov#18349 ASC NULLS FIRST], true, 0\n+- Exchange rangepartitioning(w_warehouse_sk#1512 ASC NULLS FIRST, i_item_sk#1172 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, mean#18321 ASC NULLS FIRST, cov#18322 ASC NULLS FIRST, d_moy#18596 ASC NULLS FIRST, mean#18417 ASC NULLS FIRST, cov#18349 ASC NULLS FIRST, 200)\n   +- *(13) SortMergeJoin [i_item_sk#1172, w_warehouse_sk#1512], [i_item_sk#18482, w_warehouse_sk#18546], Inner\n      :- *(6) Sort [i_item_sk#1172 ASC NULLS FIRST, w_warehouse_sk#1512 ASC NULLS FIRST], false, 0\n      :  +- Exchange hashpartitioning(i_item_sk#1172, w_warehouse_sk#1512, 200)\n      :     +- *(5) Project [w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, mean#18321, CASE WHEN (mean#18321 = 0.0) THEN null ELSE (stdev#18320 / mean#18321) END AS cov#18322]\n      :        +- *(5) Filter (CASE WHEN (mean#18321 = 0.0) THEN 0.0 ELSE (stdev#18320 / mean#18321) END > 1.0)\n      :           +- *(5) HashAggregate(keys=[w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048], functions=[stddev_samp(cast(inv_quantity_on_hand#2867 as double)), avg(cast(inv_quantity_on_hand#2867 as bigint))], output=[w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, stdev#18320, mean#18321])\n      :              +- Exchange hashpartitioning(w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, 200)\n      :                 +- *(4) HashAggregate(keys=[w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048], functions=[partial_stddev_samp(cast(inv_quantity_on_hand#2867 as double)), partial_avg(cast(inv_quantity_on_hand#2867 as bigint))], output=[w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, n#18346, avg#18347, m2#18348, sum#18636, count#18637L])\n      :                    +- *(4) Project [inv_quantity_on_hand#2867, i_item_sk#1172, w_warehouse_sk#1512, w_warehouse_name#1514, d_moy#1048]\n      :                       +- *(4) BroadcastHashJoin [inv_date_sk#2868], [d_date_sk#1040], Inner, BuildRight\n      :                          :- *(4) Project [inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#1172, w_warehouse_sk#1512, w_warehouse_name#1514]\n      :                          :  +- *(4) BroadcastHashJoin [inv_warehouse_sk#2866], [w_warehouse_sk#1512], Inner, BuildRight\n      :                          :     :- *(4) Project [inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#1172]\n      :                          :     :  +- *(4) BroadcastHashJoin [inv_item_sk#2865], [i_item_sk#1172], Inner, BuildRight\n      :                          :     :     :- *(4) Project [inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868]\n      :                          :     :     :  +- *(4) Filter (isnotnull(inv_item_sk#2865) && isnotnull(inv_warehouse_sk#2866))\n      :                          :     :     :     +- *(4) FileScan parquet db_tpcds.inventory[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/inventory/inv_dat..., PartitionCount: 261, PartitionFilters: [isnotnull(inv_date_sk#2868)], PushedFilters: [IsNotNull(inv_item_sk), IsNotNull(inv_warehouse_sk)], ReadSchema: struct<inv_item_sk:int,inv_warehouse_sk:int,inv_quantity_on_hand:int>\n      :                          :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                          :     :        +- *(1) Project [i_item_sk#1172]\n      :                          :     :           +- *(1) Filter isnotnull(i_item_sk#1172)\n      :                          :     :              +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int>\n      :                          :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                          :        +- *(2) Project [w_warehouse_sk#1512, w_warehouse_name#1514]\n      :                          :           +- *(2) Filter isnotnull(w_warehouse_sk#1512)\n      :                          :              +- *(2) FileScan parquet db_tpcds.warehouse[w_warehouse_sk#1512,w_warehouse_name#1514] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/warehouse], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>\n      :                          +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                             +- *(3) Project [d_date_sk#1040, d_moy#1048]\n      :                                +- *(3) Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 1)) && isnotnull(d_date_sk#1040))\n      :                                   +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n      +- *(12) Sort [i_item_sk#18482 ASC NULLS FIRST, w_warehouse_sk#18546 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(i_item_sk#18482, w_warehouse_sk#18546, 200)\n            +- *(11) Project [w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596, mean#18417, CASE WHEN (mean#18417 = 0.0) THEN null ELSE (stdev#18416 / mean#18417) END AS cov#18349]\n               +- *(11) Filter (CASE WHEN (mean#18417 = 0.0) THEN 0.0 ELSE (stdev#18416 / mean#18417) END > 1.0)\n                  +- *(11) HashAggregate(keys=[w_warehouse_name#18548, w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596], functions=[stddev_samp(cast(inv_quantity_on_hand#2867 as double)), avg(cast(inv_quantity_on_hand#2867 as bigint))], output=[w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596, stdev#18416, mean#18417])\n                     +- Exchange hashpartitioning(w_warehouse_name#18548, w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596, 200)\n                        +- *(10) HashAggregate(keys=[w_warehouse_name#18548, w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596], functions=[partial_stddev_samp(cast(inv_quantity_on_hand#2867 as double)), partial_avg(cast(inv_quantity_on_hand#2867 as bigint))], output=[w_warehouse_name#18548, w_warehouse_sk#18546, i_item_sk#18482, d_moy#18596, n#18346, avg#18347, m2#18348, sum#18636, count#18637L])\n                           +- *(10) Project [inv_quantity_on_hand#2867, i_item_sk#18482, w_warehouse_sk#18546, w_warehouse_name#18548, d_moy#18596]\n                              +- *(10) BroadcastHashJoin [inv_date_sk#2868], [d_date_sk#18588], Inner, BuildRight\n                                 :- *(10) Project [inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#18482, w_warehouse_sk#18546, w_warehouse_name#18548]\n                                 :  +- *(10) BroadcastHashJoin [inv_warehouse_sk#2866], [w_warehouse_sk#18546], Inner, BuildRight\n                                 :     :- *(10) Project [inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#18482]\n                                 :     :  +- *(10) BroadcastHashJoin [inv_item_sk#2865], [i_item_sk#18482], Inner, BuildRight\n                                 :     :     :- *(10) Project [inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868]\n                                 :     :     :  +- *(10) Filter (isnotnull(inv_item_sk#2865) && isnotnull(inv_warehouse_sk#2866))\n                                 :     :     :     +- *(10) FileScan parquet db_tpcds.inventory[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/inventory/inv_dat..., PartitionCount: 261, PartitionFilters: [isnotnull(inv_date_sk#2868)], PushedFilters: [IsNotNull(inv_item_sk), IsNotNull(inv_warehouse_sk)], ReadSchema: struct<inv_item_sk:int,inv_warehouse_sk:int,inv_quantity_on_hand:int>\n                                 :     :     +- ReusedExchange [i_item_sk#18482], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 :     +- ReusedExchange [w_warehouse_sk#18546, w_warehouse_name#18548], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                    +- *(9) Project [d_date_sk#18588, d_moy#18596]\n                                       +- *(9) Filter ((((isnotnull(d_year#18594) && isnotnull(d_moy#18596)) && (d_year#18594 = 2001)) && (d_moy#18596 = 2)) && isnotnull(d_date_sk#18588))\n                                          +- *(9) FileScan parquet db_tpcds.date_dim[d_date_sk#18588,d_year#18594,d_moy#18596] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), EqualTo(d_moy,2), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>"},{"name":"q39b-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["inv","inv"],"parsingTime":0.003119,"analysisTime":8.8E-4,"optimizationTime":192.645306,"planningTime":21.935588,"executionTime":4781.503885,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [inv]\n:  +- 'SubqueryAlias inv\n:     +- 'Project ['w_warehouse_name, 'w_warehouse_sk, 'i_item_sk, 'd_moy, 'stdev, 'mean, CASE WHEN ('mean = 0) THEN null ELSE ('stdev / 'mean) END AS cov#19409]\n:        +- 'Filter (CASE WHEN ('mean = 0) THEN 0 ELSE ('stdev / 'mean) END > 1)\n:           +- 'SubqueryAlias foo\n:              +- 'Aggregate ['w_warehouse_name, 'w_warehouse_sk, 'i_item_sk, 'd_moy], ['w_warehouse_name, 'w_warehouse_sk, 'i_item_sk, 'd_moy, 'stddev_samp('inv_quantity_on_hand) AS stdev#19407, 'avg('inv_quantity_on_hand) AS mean#19408]\n:                 +- 'Filter ((('inv_item_sk = 'i_item_sk) && ('inv_warehouse_sk = 'w_warehouse_sk)) && (('inv_date_sk = 'd_date_sk) && ('d_year = 2001)))\n:                    +- 'Join Inner\n:                       :- 'Join Inner\n:                       :  :- 'Join Inner\n:                       :  :  :- 'UnresolvedRelation `inventory`\n:                       :  :  +- 'UnresolvedRelation `item`\n:                       :  +- 'UnresolvedRelation `warehouse`\n:                       +- 'UnresolvedRelation `date_dim`\n+- 'Sort ['inv1.w_warehouse_sk ASC NULLS FIRST, 'inv1.i_item_sk ASC NULLS FIRST, 'inv1.d_moy ASC NULLS FIRST, 'inv1.mean ASC NULLS FIRST, 'inv1.cov ASC NULLS FIRST, 'inv2.d_moy ASC NULLS FIRST, 'inv2.mean ASC NULLS FIRST, 'inv2.cov ASC NULLS FIRST], true\n   +- 'Project ['inv1.w_warehouse_sk, 'inv1.i_item_sk, 'inv1.d_moy, 'inv1.mean, 'inv1.cov, 'inv2.w_warehouse_sk, 'inv2.i_item_sk, 'inv2.d_moy, 'inv2.mean, 'inv2.cov]\n      +- 'Filter (((('inv1.i_item_sk = 'inv2.i_item_sk) && ('inv1.w_warehouse_sk = 'inv2.w_warehouse_sk)) && ('inv1.d_moy = 1)) && (('inv2.d_moy = (1 + 1)) && ('inv1.cov > 1.5)))\n         +- 'Join Inner\n            :- 'SubqueryAlias inv1\n            :  +- 'UnresolvedRelation `inv`\n            +- 'SubqueryAlias inv2\n               +- 'UnresolvedRelation `inv`\n\n== Analyzed Logical Plan ==\nw_warehouse_sk: int, i_item_sk: int, d_moy: int, mean: double, cov: double, w_warehouse_sk: int, i_item_sk: int, d_moy: int, mean: double, cov: double\nSort [w_warehouse_sk#1512 ASC NULLS FIRST, i_item_sk#1172 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, mean#19408 ASC NULLS FIRST, cov#19409 ASC NULLS FIRST, d_moy#19683 ASC NULLS FIRST, mean#19504 ASC NULLS FIRST, cov#19436 ASC NULLS FIRST], true\n+- Project [w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, mean#19408, cov#19409, w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683, mean#19504, cov#19436]\n   +- Filter ((((i_item_sk#1172 = i_item_sk#19569) && (w_warehouse_sk#1512 = w_warehouse_sk#19633)) && (d_moy#1048 = 1)) && ((d_moy#19683 = (1 + 1)) && (cov#19409 > cast(1.5 as double))))\n      +- Join Inner\n         :- SubqueryAlias inv1\n         :  +- SubqueryAlias inv\n         :     +- Project [w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, stdev#19407, mean#19408, CASE WHEN (mean#19408 = cast(0 as double)) THEN cast(null as double) ELSE (stdev#19407 / mean#19408) END AS cov#19409]\n         :        +- Filter (CASE WHEN (mean#19408 = cast(0 as double)) THEN cast(0 as double) ELSE (stdev#19407 / mean#19408) END > cast(1 as double))\n         :           +- SubqueryAlias foo\n         :              +- Aggregate [w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048], [w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, stddev_samp(cast(inv_quantity_on_hand#2867 as double)) AS stdev#19407, avg(cast(inv_quantity_on_hand#2867 as bigint)) AS mean#19408]\n         :                 +- Filter (((inv_item_sk#2865 = i_item_sk#1172) && (inv_warehouse_sk#2866 = w_warehouse_sk#1512)) && ((inv_date_sk#2868 = d_date_sk#1040) && (d_year#1046 = 2001)))\n         :                    +- Join Inner\n         :                       :- Join Inner\n         :                       :  :- Join Inner\n         :                       :  :  :- SubqueryAlias inventory\n         :                       :  :  :  +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n         :                       :  :  +- SubqueryAlias item\n         :                       :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :                       :  +- SubqueryAlias warehouse\n         :                       :     +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n         :                       +- SubqueryAlias date_dim\n         :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         +- SubqueryAlias inv2\n            +- SubqueryAlias inv\n               +- Project [w_warehouse_name#19635, w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683, stdev#19503, mean#19504, CASE WHEN (mean#19504 = cast(0 as double)) THEN cast(null as double) ELSE (stdev#19503 / mean#19504) END AS cov#19436]\n                  +- Filter (CASE WHEN (mean#19504 = cast(0 as double)) THEN cast(0 as double) ELSE (stdev#19503 / mean#19504) END > cast(1 as double))\n                     +- SubqueryAlias foo\n                        +- Aggregate [w_warehouse_name#19635, w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683], [w_warehouse_name#19635, w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683, stddev_samp(cast(inv_quantity_on_hand#2867 as double)) AS stdev#19503, avg(cast(inv_quantity_on_hand#2867 as bigint)) AS mean#19504]\n                           +- Filter (((inv_item_sk#2865 = i_item_sk#19569) && (inv_warehouse_sk#2866 = w_warehouse_sk#19633)) && ((inv_date_sk#2868 = d_date_sk#19675) && (d_year#19681 = 2001)))\n                              +- Join Inner\n                                 :- Join Inner\n                                 :  :- Join Inner\n                                 :  :  :- SubqueryAlias inventory\n                                 :  :  :  +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n                                 :  :  +- SubqueryAlias item\n                                 :  :     +- Relation[i_item_sk#19569,i_item_id#19570,i_rec_start_date#19571,i_rec_end_date#19572,i_item_desc#19573,i_current_price#19574,i_wholesale_cost#19575,i_brand_id#19576,i_brand#19577,i_class_id#19578,i_class#19579,i_category_id#19580,i_category#19581,i_manufact_id#19582,i_manufact#19583,i_size#19584,i_formulation#19585,i_color#19586,i_units#19587,i_container#19588,i_manager_id#19589,i_product_name#19590] parquet\n                                 :  +- SubqueryAlias warehouse\n                                 :     +- Relation[w_warehouse_sk#19633,w_warehouse_id#19634,w_warehouse_name#19635,w_warehouse_sq_ft#19636,w_street_number#19637,w_street_name#19638,w_street_type#19639,w_suite_number#19640,w_city#19641,w_county#19642,w_state#19643,w_zip#19644,w_country#19645,w_gmt_offset#19646] parquet\n                                 +- SubqueryAlias date_dim\n                                    +- Relation[d_date_sk#19675,d_date_id#19676,d_date#19677,d_month_seq#19678,d_week_seq#19679,d_quarter_seq#19680,d_year#19681,d_dow#19682,d_moy#19683,d_dom#19684,d_qoy#19685,d_fy_year#19686,d_fy_quarter_seq#19687,d_fy_week_seq#19688,d_day_name#19689,d_quarter_name#19690,d_holiday#19691,d_weekend#19692,d_following_holiday#19693,d_first_dom#19694,d_last_dom#19695,d_same_day_ly#19696,d_same_day_lq#19697,d_current_day#19698,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nSort [w_warehouse_sk#1512 ASC NULLS FIRST, i_item_sk#1172 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, mean#19408 ASC NULLS FIRST, cov#19409 ASC NULLS FIRST, d_moy#19683 ASC NULLS FIRST, mean#19504 ASC NULLS FIRST, cov#19436 ASC NULLS FIRST], true\n+- Join Inner, ((i_item_sk#1172 = i_item_sk#19569) && (w_warehouse_sk#1512 = w_warehouse_sk#19633))\n   :- Project [w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, mean#19408, CASE WHEN (mean#19408 = 0.0) THEN null ELSE (stdev#19407 / mean#19408) END AS cov#19409]\n   :  +- Filter ((CASE WHEN (mean#19408 = 0.0) THEN 0.0 ELSE (stdev#19407 / mean#19408) END > 1.0) && (CASE WHEN (mean#19408 = 0.0) THEN null ELSE (stdev#19407 / mean#19408) END > 1.5))\n   :     +- Aggregate [w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048], [w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, stddev_samp(cast(inv_quantity_on_hand#2867 as double)) AS stdev#19407, avg(cast(inv_quantity_on_hand#2867 as bigint)) AS mean#19408]\n   :        +- Project [inv_quantity_on_hand#2867, i_item_sk#1172, w_warehouse_sk#1512, w_warehouse_name#1514, d_moy#1048]\n   :           +- Join Inner, (inv_date_sk#2868 = d_date_sk#1040)\n   :              :- Project [inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#1172, w_warehouse_sk#1512, w_warehouse_name#1514]\n   :              :  +- Join Inner, (inv_warehouse_sk#2866 = w_warehouse_sk#1512)\n   :              :     :- Project [inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#1172]\n   :              :     :  +- Join Inner, (inv_item_sk#2865 = i_item_sk#1172)\n   :              :     :     :- Filter ((isnotnull(inv_item_sk#2865) && isnotnull(inv_warehouse_sk#2866)) && isnotnull(inv_date_sk#2868))\n   :              :     :     :  +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n   :              :     :     +- Project [i_item_sk#1172]\n   :              :     :        +- Filter isnotnull(i_item_sk#1172)\n   :              :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n   :              :     +- Project [w_warehouse_sk#1512, w_warehouse_name#1514]\n   :              :        +- Filter isnotnull(w_warehouse_sk#1512)\n   :              :           +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n   :              +- Project [d_date_sk#1040, d_moy#1048]\n   :                 +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 1)) && isnotnull(d_date_sk#1040))\n   :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n   +- Project [w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683, mean#19504, CASE WHEN (mean#19504 = 0.0) THEN null ELSE (stdev#19503 / mean#19504) END AS cov#19436]\n      +- Filter (CASE WHEN (mean#19504 = 0.0) THEN 0.0 ELSE (stdev#19503 / mean#19504) END > 1.0)\n         +- Aggregate [w_warehouse_name#19635, w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683], [w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683, stddev_samp(cast(inv_quantity_on_hand#2867 as double)) AS stdev#19503, avg(cast(inv_quantity_on_hand#2867 as bigint)) AS mean#19504]\n            +- Project [inv_quantity_on_hand#2867, i_item_sk#19569, w_warehouse_sk#19633, w_warehouse_name#19635, d_moy#19683]\n               +- Join Inner, (inv_date_sk#2868 = d_date_sk#19675)\n                  :- Project [inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#19569, w_warehouse_sk#19633, w_warehouse_name#19635]\n                  :  +- Join Inner, (inv_warehouse_sk#2866 = w_warehouse_sk#19633)\n                  :     :- Project [inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#19569]\n                  :     :  +- Join Inner, (inv_item_sk#2865 = i_item_sk#19569)\n                  :     :     :- Filter ((isnotnull(inv_item_sk#2865) && isnotnull(inv_warehouse_sk#2866)) && isnotnull(inv_date_sk#2868))\n                  :     :     :  +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n                  :     :     +- Project [i_item_sk#19569]\n                  :     :        +- Filter isnotnull(i_item_sk#19569)\n                  :     :           +- Relation[i_item_sk#19569,i_item_id#19570,i_rec_start_date#19571,i_rec_end_date#19572,i_item_desc#19573,i_current_price#19574,i_wholesale_cost#19575,i_brand_id#19576,i_brand#19577,i_class_id#19578,i_class#19579,i_category_id#19580,i_category#19581,i_manufact_id#19582,i_manufact#19583,i_size#19584,i_formulation#19585,i_color#19586,i_units#19587,i_container#19588,i_manager_id#19589,i_product_name#19590] parquet\n                  :     +- Project [w_warehouse_sk#19633, w_warehouse_name#19635]\n                  :        +- Filter isnotnull(w_warehouse_sk#19633)\n                  :           +- Relation[w_warehouse_sk#19633,w_warehouse_id#19634,w_warehouse_name#19635,w_warehouse_sq_ft#19636,w_street_number#19637,w_street_name#19638,w_street_type#19639,w_suite_number#19640,w_city#19641,w_county#19642,w_state#19643,w_zip#19644,w_country#19645,w_gmt_offset#19646] parquet\n                  +- Project [d_date_sk#19675, d_moy#19683]\n                     +- Filter ((((isnotnull(d_year#19681) && isnotnull(d_moy#19683)) && (d_year#19681 = 2001)) && (d_moy#19683 = 2)) && isnotnull(d_date_sk#19675))\n                        +- Relation[d_date_sk#19675,d_date_id#19676,d_date#19677,d_month_seq#19678,d_week_seq#19679,d_quarter_seq#19680,d_year#19681,d_dow#19682,d_moy#19683,d_dom#19684,d_qoy#19685,d_fy_year#19686,d_fy_quarter_seq#19687,d_fy_week_seq#19688,d_day_name#19689,d_quarter_name#19690,d_holiday#19691,d_weekend#19692,d_following_holiday#19693,d_first_dom#19694,d_last_dom#19695,d_same_day_ly#19696,d_same_day_lq#19697,d_current_day#19698,... 4 more fields] parquet\n\n== Physical Plan ==\n*(14) Sort [w_warehouse_sk#1512 ASC NULLS FIRST, i_item_sk#1172 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, mean#19408 ASC NULLS FIRST, cov#19409 ASC NULLS FIRST, d_moy#19683 ASC NULLS FIRST, mean#19504 ASC NULLS FIRST, cov#19436 ASC NULLS FIRST], true, 0\n+- Exchange rangepartitioning(w_warehouse_sk#1512 ASC NULLS FIRST, i_item_sk#1172 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, mean#19408 ASC NULLS FIRST, cov#19409 ASC NULLS FIRST, d_moy#19683 ASC NULLS FIRST, mean#19504 ASC NULLS FIRST, cov#19436 ASC NULLS FIRST, 200)\n   +- *(13) SortMergeJoin [i_item_sk#1172, w_warehouse_sk#1512], [i_item_sk#19569, w_warehouse_sk#19633], Inner\n      :- *(6) Sort [i_item_sk#1172 ASC NULLS FIRST, w_warehouse_sk#1512 ASC NULLS FIRST], false, 0\n      :  +- Exchange hashpartitioning(i_item_sk#1172, w_warehouse_sk#1512, 200)\n      :     +- *(5) Project [w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, mean#19408, CASE WHEN (mean#19408 = 0.0) THEN null ELSE (stdev#19407 / mean#19408) END AS cov#19409]\n      :        +- *(5) Filter ((CASE WHEN (mean#19408 = 0.0) THEN 0.0 ELSE (stdev#19407 / mean#19408) END > 1.0) && (CASE WHEN (mean#19408 = 0.0) THEN null ELSE (stdev#19407 / mean#19408) END > 1.5))\n      :           +- *(5) HashAggregate(keys=[w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048], functions=[stddev_samp(cast(inv_quantity_on_hand#2867 as double)), avg(cast(inv_quantity_on_hand#2867 as bigint))], output=[w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, stdev#19407, mean#19408])\n      :              +- Exchange hashpartitioning(w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, 200)\n      :                 +- *(4) HashAggregate(keys=[w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048], functions=[partial_stddev_samp(cast(inv_quantity_on_hand#2867 as double)), partial_avg(cast(inv_quantity_on_hand#2867 as bigint))], output=[w_warehouse_name#1514, w_warehouse_sk#1512, i_item_sk#1172, d_moy#1048, n#19433, avg#19434, m2#19435, sum#19723, count#19724L])\n      :                    +- *(4) Project [inv_quantity_on_hand#2867, i_item_sk#1172, w_warehouse_sk#1512, w_warehouse_name#1514, d_moy#1048]\n      :                       +- *(4) BroadcastHashJoin [inv_date_sk#2868], [d_date_sk#1040], Inner, BuildRight\n      :                          :- *(4) Project [inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#1172, w_warehouse_sk#1512, w_warehouse_name#1514]\n      :                          :  +- *(4) BroadcastHashJoin [inv_warehouse_sk#2866], [w_warehouse_sk#1512], Inner, BuildRight\n      :                          :     :- *(4) Project [inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#1172]\n      :                          :     :  +- *(4) BroadcastHashJoin [inv_item_sk#2865], [i_item_sk#1172], Inner, BuildRight\n      :                          :     :     :- *(4) Project [inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868]\n      :                          :     :     :  +- *(4) Filter (isnotnull(inv_item_sk#2865) && isnotnull(inv_warehouse_sk#2866))\n      :                          :     :     :     +- *(4) FileScan parquet db_tpcds.inventory[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/inventory/inv_dat..., PartitionCount: 261, PartitionFilters: [isnotnull(inv_date_sk#2868)], PushedFilters: [IsNotNull(inv_item_sk), IsNotNull(inv_warehouse_sk)], ReadSchema: struct<inv_item_sk:int,inv_warehouse_sk:int,inv_quantity_on_hand:int>\n      :                          :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                          :     :        +- *(1) Project [i_item_sk#1172]\n      :                          :     :           +- *(1) Filter isnotnull(i_item_sk#1172)\n      :                          :     :              +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int>\n      :                          :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                          :        +- *(2) Project [w_warehouse_sk#1512, w_warehouse_name#1514]\n      :                          :           +- *(2) Filter isnotnull(w_warehouse_sk#1512)\n      :                          :              +- *(2) FileScan parquet db_tpcds.warehouse[w_warehouse_sk#1512,w_warehouse_name#1514] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/warehouse], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>\n      :                          +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                             +- *(3) Project [d_date_sk#1040, d_moy#1048]\n      :                                +- *(3) Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 1)) && isnotnull(d_date_sk#1040))\n      :                                   +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), EqualTo(d_moy,1), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n      +- *(12) Sort [i_item_sk#19569 ASC NULLS FIRST, w_warehouse_sk#19633 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(i_item_sk#19569, w_warehouse_sk#19633, 200)\n            +- *(11) Project [w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683, mean#19504, CASE WHEN (mean#19504 = 0.0) THEN null ELSE (stdev#19503 / mean#19504) END AS cov#19436]\n               +- *(11) Filter (CASE WHEN (mean#19504 = 0.0) THEN 0.0 ELSE (stdev#19503 / mean#19504) END > 1.0)\n                  +- *(11) HashAggregate(keys=[w_warehouse_name#19635, w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683], functions=[stddev_samp(cast(inv_quantity_on_hand#2867 as double)), avg(cast(inv_quantity_on_hand#2867 as bigint))], output=[w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683, stdev#19503, mean#19504])\n                     +- Exchange hashpartitioning(w_warehouse_name#19635, w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683, 200)\n                        +- *(10) HashAggregate(keys=[w_warehouse_name#19635, w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683], functions=[partial_stddev_samp(cast(inv_quantity_on_hand#2867 as double)), partial_avg(cast(inv_quantity_on_hand#2867 as bigint))], output=[w_warehouse_name#19635, w_warehouse_sk#19633, i_item_sk#19569, d_moy#19683, n#19433, avg#19434, m2#19435, sum#19723, count#19724L])\n                           +- *(10) Project [inv_quantity_on_hand#2867, i_item_sk#19569, w_warehouse_sk#19633, w_warehouse_name#19635, d_moy#19683]\n                              +- *(10) BroadcastHashJoin [inv_date_sk#2868], [d_date_sk#19675], Inner, BuildRight\n                                 :- *(10) Project [inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#19569, w_warehouse_sk#19633, w_warehouse_name#19635]\n                                 :  +- *(10) BroadcastHashJoin [inv_warehouse_sk#2866], [w_warehouse_sk#19633], Inner, BuildRight\n                                 :     :- *(10) Project [inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868, i_item_sk#19569]\n                                 :     :  +- *(10) BroadcastHashJoin [inv_item_sk#2865], [i_item_sk#19569], Inner, BuildRight\n                                 :     :     :- *(10) Project [inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868]\n                                 :     :     :  +- *(10) Filter (isnotnull(inv_item_sk#2865) && isnotnull(inv_warehouse_sk#2866))\n                                 :     :     :     +- *(10) FileScan parquet db_tpcds.inventory[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/inventory/inv_dat..., PartitionCount: 261, PartitionFilters: [isnotnull(inv_date_sk#2868)], PushedFilters: [IsNotNull(inv_item_sk), IsNotNull(inv_warehouse_sk)], ReadSchema: struct<inv_item_sk:int,inv_warehouse_sk:int,inv_quantity_on_hand:int>\n                                 :     :     +- ReusedExchange [i_item_sk#19569], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 :     +- ReusedExchange [w_warehouse_sk#19633, w_warehouse_name#19635], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                    +- *(9) Project [d_date_sk#19675, d_moy#19683]\n                                       +- *(9) Filter ((((isnotnull(d_year#19681) && isnotnull(d_moy#19683)) && (d_year#19681 = 2001)) && (d_moy#19683 = 2)) && isnotnull(d_date_sk#19675))\n                                          +- *(9) FileScan parquet db_tpcds.date_dim[d_date_sk#19675,d_year#19681,d_moy#19683] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), EqualTo(d_moy,2), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>"},{"name":"q40-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin"],"tables":["catalog_sales","catalog_returns","warehouse","item","date_dim"],"parsingTime":0.002772,"analysisTime":0.001121,"optimizationTime":261.115721,"planningTime":259.339388,"executionTime":6762.156126,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['w_state ASC NULLS FIRST, 'i_item_id ASC NULLS FIRST], true\n      +- 'Aggregate ['w_state, 'i_item_id], ['w_state, 'i_item_id, 'sum(CASE WHEN (cast('d_date as date) < cast(2000-03-11 as date)) THEN ('cs_sales_price - 'coalesce('cr_refunded_cash, 0)) ELSE 0 END) AS sales_before#20118, 'sum(CASE WHEN (cast('d_date as date) >= cast(2000-03-11 as date)) THEN ('cs_sales_price - 'coalesce('cr_refunded_cash, 0)) ELSE 0 END) AS sales_after#20119]\n         +- 'Filter ((((('i_current_price >= 0.99) && ('i_current_price <= 1.49)) && ('i_item_sk = 'cs_item_sk)) && ('cs_warehouse_sk = 'w_warehouse_sk)) && (('cs_sold_date_sk = 'd_date_sk) && (('d_date >= (cast(2000-03-11 as date) - interval 4 weeks 2 days)) && ('d_date <= (cast(2000-03-11 as date) + interval 4 weeks 2 days)))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join LeftOuter, (('cs_order_number = 'cr_order_number) && ('cs_item_sk = 'cr_item_sk))\n               :  :  :  :- 'UnresolvedRelation `catalog_sales`\n               :  :  :  +- 'UnresolvedRelation `catalog_returns`\n               :  :  +- 'UnresolvedRelation `warehouse`\n               :  +- 'UnresolvedRelation `item`\n               +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nw_state: string, i_item_id: string, sales_before: decimal(23,2), sales_after: decimal(23,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [w_state#1522, i_item_id#1173, sales_before#20118, sales_after#20119]\n      +- Sort [w_state#1522 ASC NULLS FIRST, i_item_id#1173 ASC NULLS FIRST], true\n         +- Aggregate [w_state#1522, i_item_id#1173], [w_state#1522, i_item_id#1173, sum(CASE WHEN (cast(d_date#1042 as date) < cast(2000-03-11 as date)) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(13,2))) - promote_precision(cast(coalesce(cast(cr_refunded_cash#2108 as decimal(12,2)), cast(0 as decimal(12,2))) as decimal(13,2)))), DecimalType(13,2)) ELSE cast(0 as decimal(13,2)) END) AS sales_before#20118, sum(CASE WHEN (cast(d_date#1042 as date) >= cast(2000-03-11 as date)) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(13,2))) - promote_precision(cast(coalesce(cast(cr_refunded_cash#2108 as decimal(12,2)), cast(0 as decimal(12,2))) as decimal(13,2)))), DecimalType(13,2)) ELSE cast(0 as decimal(13,2)) END) AS sales_after#20119]\n            +- Filter (((((cast(i_current_price#1177 as decimal(7,2)) >= cast(0.99 as decimal(7,2))) && (cast(i_current_price#1177 as decimal(7,2)) <= cast(1.49 as decimal(7,2)))) && (i_item_sk#1172 = cs_item_sk#1803)) && (cs_warehouse_sk#1802 = w_warehouse_sk#1512)) && ((cs_sold_date_sk#1822 = d_date_sk#1040) && ((d_date#1042 >= cast(cast(cast(2000-03-11 as date) as timestamp) - interval 4 weeks 2 days as date)) && (d_date#1042 <= cast(cast(cast(2000-03-11 as date) as timestamp) + interval 4 weeks 2 days as date)))))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- Join LeftOuter, ((cs_order_number#1805L = cr_order_number#2101L) && (cs_item_sk#1803 = cr_item_sk#2087))\n                  :  :  :  :- SubqueryAlias catalog_sales\n                  :  :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                  :  :  :  +- SubqueryAlias catalog_returns\n                  :  :  :     +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n                  :  :  +- SubqueryAlias warehouse\n                  :  :     +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n                  :  +- SubqueryAlias item\n                  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  +- SubqueryAlias date_dim\n                     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [w_state#1522 ASC NULLS FIRST, i_item_id#1173 ASC NULLS FIRST], true\n      +- Aggregate [w_state#1522, i_item_id#1173], [w_state#1522, i_item_id#1173, sum(CASE WHEN (d_date#1042 < 11027) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(13,2))) - promote_precision(cast(coalesce(cast(cr_refunded_cash#2108 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2)) ELSE 0.00 END) AS sales_before#20118, sum(CASE WHEN (d_date#1042 >= 11027) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(13,2))) - promote_precision(cast(coalesce(cast(cr_refunded_cash#2108 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2)) ELSE 0.00 END) AS sales_after#20119]\n         +- Project [cs_sales_price#1809, cr_refunded_cash#2108, w_state#1522, i_item_id#1173, d_date#1042]\n            +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :- Project [cs_sales_price#1809, cs_sold_date_sk#1822, cr_refunded_cash#2108, w_state#1522, i_item_id#1173]\n               :  +- Join Inner, (i_item_sk#1172 = cs_item_sk#1803)\n               :     :- Project [cs_item_sk#1803, cs_sales_price#1809, cs_sold_date_sk#1822, cr_refunded_cash#2108, w_state#1522]\n               :     :  +- Join Inner, (cs_warehouse_sk#1802 = w_warehouse_sk#1512)\n               :     :     :- Project [cs_warehouse_sk#1802, cs_item_sk#1803, cs_sales_price#1809, cs_sold_date_sk#1822, cr_refunded_cash#2108]\n               :     :     :  +- Join LeftOuter, ((cs_order_number#1805L = cr_order_number#2101L) && (cs_item_sk#1803 = cr_item_sk#2087))\n               :     :     :     :- Project [cs_warehouse_sk#1802, cs_item_sk#1803, cs_order_number#1805L, cs_sales_price#1809, cs_sold_date_sk#1822]\n               :     :     :     :  +- Filter ((isnotnull(cs_warehouse_sk#1802) && isnotnull(cs_item_sk#1803)) && isnotnull(cs_sold_date_sk#1822))\n               :     :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :     :     +- Project [cr_item_sk#2087, cr_order_number#2101L, cr_refunded_cash#2108]\n               :     :     :        +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n               :     :     +- Project [w_warehouse_sk#1512, w_state#1522]\n               :     :        +- Filter isnotnull(w_warehouse_sk#1512)\n               :     :           +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n               :     +- Project [i_item_sk#1172, i_item_id#1173]\n               :        +- Filter (((isnotnull(i_current_price#1177) && (i_current_price#1177 >= 0.99)) && (i_current_price#1177 <= 1.49)) && isnotnull(i_item_sk#1172))\n               :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               +- Project [d_date_sk#1040, d_date#1042]\n                  +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10997)) && (d_date#1042 <= 11057)) && isnotnull(d_date_sk#1040))\n                     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[w_state#1522 ASC NULLS FIRST,i_item_id#1173 ASC NULLS FIRST], output=[w_state#1522,i_item_id#1173,sales_before#20118,sales_after#20119])\n+- *(9) HashAggregate(keys=[w_state#1522, i_item_id#1173], functions=[sum(CASE WHEN (d_date#1042 < 11027) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(13,2))) - promote_precision(cast(coalesce(cast(cr_refunded_cash#2108 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2)) ELSE 0.00 END), sum(CASE WHEN (d_date#1042 >= 11027) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(13,2))) - promote_precision(cast(coalesce(cast(cr_refunded_cash#2108 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2)) ELSE 0.00 END)], output=[w_state#1522, i_item_id#1173, sales_before#20118, sales_after#20119])\n   +- Exchange hashpartitioning(w_state#1522, i_item_id#1173, 200)\n      +- *(8) HashAggregate(keys=[w_state#1522, i_item_id#1173], functions=[partial_sum(CASE WHEN (d_date#1042 < 11027) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(13,2))) - promote_precision(cast(coalesce(cast(cr_refunded_cash#2108 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_date#1042 >= 11027) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(13,2))) - promote_precision(cast(coalesce(cast(cr_refunded_cash#2108 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2)) ELSE 0.00 END)], output=[w_state#1522, i_item_id#1173, sum#20130, sum#20131])\n         +- *(8) Project [cs_sales_price#1809, cr_refunded_cash#2108, w_state#1522, i_item_id#1173, d_date#1042]\n            +- *(8) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :- *(8) Project [cs_sales_price#1809, cs_sold_date_sk#1822, cr_refunded_cash#2108, w_state#1522, i_item_id#1173]\n               :  +- *(8) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n               :     :- *(8) Project [cs_item_sk#1803, cs_sales_price#1809, cs_sold_date_sk#1822, cr_refunded_cash#2108, w_state#1522]\n               :     :  +- *(8) BroadcastHashJoin [cs_warehouse_sk#1802], [w_warehouse_sk#1512], Inner, BuildRight\n               :     :     :- *(8) Project [cs_warehouse_sk#1802, cs_item_sk#1803, cs_sales_price#1809, cs_sold_date_sk#1822, cr_refunded_cash#2108]\n               :     :     :  +- SortMergeJoin [cs_order_number#1805L, cs_item_sk#1803], [cr_order_number#2101L, cr_item_sk#2087], LeftOuter\n               :     :     :     :- *(2) Sort [cs_order_number#1805L ASC NULLS FIRST, cs_item_sk#1803 ASC NULLS FIRST], false, 0\n               :     :     :     :  +- Exchange hashpartitioning(cs_order_number#1805L, cs_item_sk#1803, 200)\n               :     :     :     :     +- *(1) Project [cs_warehouse_sk#1802, cs_item_sk#1803, cs_order_number#1805L, cs_sales_price#1809, cs_sold_date_sk#1822]\n               :     :     :     :        +- *(1) Filter (isnotnull(cs_warehouse_sk#1802) && isnotnull(cs_item_sk#1803))\n               :     :     :     :           +- *(1) FileScan parquet db_tpcds.catalog_sales[cs_warehouse_sk#1802,cs_item_sk#1803,cs_order_number#1805L,cs_sales_price#1809,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_warehouse_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_warehouse_sk:int,cs_item_sk:int,cs_order_number:bigint,cs_sales_price:decimal(7,2)>\n               :     :     :     +- *(4) Sort [cr_order_number#2101L ASC NULLS FIRST, cr_item_sk#2087 ASC NULLS FIRST], false, 0\n               :     :     :        +- Exchange hashpartitioning(cr_order_number#2101L, cr_item_sk#2087, 200)\n               :     :     :           +- *(3) Project [cr_item_sk#2087, cr_order_number#2101L, cr_refunded_cash#2108]\n               :     :     :              +- *(3) FileScan parquet db_tpcds.catalog_returns[cr_item_sk#2087,cr_order_number#2101L,cr_refunded_cash#2108,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns], PartitionCount: 2066, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<cr_item_sk:int,cr_order_number:bigint,cr_refunded_cash:decimal(7,2)>\n               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(5) Project [w_warehouse_sk#1512, w_state#1522]\n               :     :           +- *(5) Filter isnotnull(w_warehouse_sk#1512)\n               :     :              +- *(5) FileScan parquet db_tpcds.warehouse[w_warehouse_sk#1512,w_state#1522] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/warehouse], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_state:string>\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(6) Project [i_item_sk#1172, i_item_id#1173]\n               :           +- *(6) Filter (((isnotnull(i_current_price#1177) && (i_current_price#1177 >= 0.99)) && (i_current_price#1177 <= 1.49)) && isnotnull(i_item_sk#1172))\n               :              +- *(6) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173,i_current_price#1177] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThanOrEqual(i_current_price,0.99), LessThanOrEqual(i_current_..., ReadSchema: struct<i_item_sk:int,i_item_id:string,i_current_price:decimal(7,2)>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(7) Project [d_date_sk#1040, d_date#1042]\n                     +- *(7) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10997)) && (d_date#1042 <= 11057)) && isnotnull(d_date_sk#1040))\n                        +- *(7) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2000-02-10), LessThanOrEqual(d_date,2000-04-10), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>"},{"name":"q41-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin"],"tables":["item"],"parsingTime":0.002593,"analysisTime":8.64E-4,"optimizationTime":92.884131,"planningTime":6.28535,"executionTime":919.126196,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_product_name ASC NULLS FIRST], true\n      +- 'Distinct\n         +- 'Project ['i_product_name]\n            +- 'Filter ((('i_manufact_id >= 738) && ('i_manufact_id <= (738 + 40))) && (scalar-subquery#20152 [] > 0))\n               :  +- 'Project ['count(1) AS item_cnt#20151]\n               :     +- 'Filter ((('i_manufact = 'i1.i_manufact) && ((((('i_category = Women) && (('i_color = powder) || ('i_color = khaki))) && ((('i_units = Ounce) || ('i_units = Oz)) && (('i_size = medium) || ('i_size = extra large)))) || ((('i_category = Women) && (('i_color = brown) || ('i_color = honeydew))) && ((('i_units = Bunch) || ('i_units = Ton)) && (('i_size = N/A) || ('i_size = small))))) || (((('i_category = Men) && (('i_color = floral) || ('i_color = deep))) && ((('i_units = N/A) || ('i_units = Dozen)) && (('i_size = petite) || ('i_size = large)))) || ((('i_category = Men) && (('i_color = light) || ('i_color = cornflower))) && ((('i_units = Box) || ('i_units = Pound)) && (('i_size = medium) || ('i_size = extra large))))))) || (('i_manufact = 'i1.i_manufact) && ((((('i_category = Women) && (('i_color = midnight) || ('i_color = snow))) && ((('i_units = Pallet) || ('i_units = Gross)) && (('i_size = medium) || ('i_size = extra large)))) || ((('i_category = Women) && (('i_color = cyan) || ('i_color = papaya))) && ((('i_units = Cup) || ('i_units = Dram)) && (('i_size = N/A) || ('i_size = small))))) || (((('i_category = Men) && (('i_color = orange) || ('i_color = frosted))) && ((('i_units = Each) || ('i_units = Tbl)) && (('i_size = petite) || ('i_size = large)))) || ((('i_category = Men) && (('i_color = forest) || ('i_color = ghost))) && ((('i_units = Lb) || ('i_units = Bundle)) && (('i_size = medium) || ('i_size = extra large))))))))\n               :        +- 'UnresolvedRelation `item`\n               +- 'SubqueryAlias i1\n                  +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\ni_product_name: string\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_product_name#1193 ASC NULLS FIRST], true\n      +- Distinct\n         +- Project [i_product_name#1193]\n            +- Filter (((i_manufact_id#1185 >= 738) && (i_manufact_id#1185 <= (738 + 40))) && (scalar-subquery#20152 [i_manufact#1186 && i_manufact#1186] > cast(0 as bigint)))\n               :  +- Aggregate [count(1) AS item_cnt#20151L]\n               :     +- Filter (((i_manufact#1186 = outer(i_manufact#1186)) && (((((i_category#1184 = Women) && ((i_color#1189 = powder) || (i_color#1189 = khaki))) && (((i_units#1190 = Ounce) || (i_units#1190 = Oz)) && ((i_size#1187 = medium) || (i_size#1187 = extra large)))) || (((i_category#1184 = Women) && ((i_color#1189 = brown) || (i_color#1189 = honeydew))) && (((i_units#1190 = Bunch) || (i_units#1190 = Ton)) && ((i_size#1187 = N/A) || (i_size#1187 = small))))) || ((((i_category#1184 = Men) && ((i_color#1189 = floral) || (i_color#1189 = deep))) && (((i_units#1190 = N/A) || (i_units#1190 = Dozen)) && ((i_size#1187 = petite) || (i_size#1187 = large)))) || (((i_category#1184 = Men) && ((i_color#1189 = light) || (i_color#1189 = cornflower))) && (((i_units#1190 = Box) || (i_units#1190 = Pound)) && ((i_size#1187 = medium) || (i_size#1187 = extra large))))))) || ((i_manufact#1186 = outer(i_manufact#1186)) && (((((i_category#1184 = Women) && ((i_color#1189 = midnight) || (i_color#1189 = snow))) && (((i_units#1190 = Pallet) || (i_units#1190 = Gross)) && ((i_size#1187 = medium) || (i_size#1187 = extra large)))) || (((i_category#1184 = Women) && ((i_color#1189 = cyan) || (i_color#1189 = papaya))) && (((i_units#1190 = Cup) || (i_units#1190 = Dram)) && ((i_size#1187 = N/A) || (i_size#1187 = small))))) || ((((i_category#1184 = Men) && ((i_color#1189 = orange) || (i_color#1189 = frosted))) && (((i_units#1190 = Each) || (i_units#1190 = Tbl)) && ((i_size#1187 = petite) || (i_size#1187 = large)))) || (((i_category#1184 = Men) && ((i_color#1189 = forest) || (i_color#1189 = ghost))) && (((i_units#1190 = Lb) || (i_units#1190 = Bundle)) && ((i_size#1187 = medium) || (i_size#1187 = extra large))))))))\n               :        +- SubqueryAlias item\n               :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               +- SubqueryAlias i1\n                  +- SubqueryAlias item\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_product_name#1193 ASC NULLS FIRST], true\n      +- Aggregate [i_product_name#1193], [i_product_name#1193]\n         +- Project [i_product_name#1193]\n            +- Join Inner, (i_manufact#1186#20155 = i_manufact#1186)\n               :- Project [i_manufact#1186, i_product_name#1193]\n               :  +- Filter (((isnotnull(i_manufact_id#1185) && (i_manufact_id#1185 >= 738)) && (i_manufact_id#1185 <= 778)) && isnotnull(i_manufact#1186))\n               :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               +- Project [i_manufact#1186#20155]\n                  +- Filter (if (isnull(alwaysTrue#20156)) 0 else item_cnt#20151L > 0)\n                     +- Aggregate [i_manufact#1186], [count(1) AS item_cnt#20151L, i_manufact#1186 AS i_manufact#1186#20155, true AS alwaysTrue#20156]\n                        +- Project [i_manufact#1186]\n                           +- Filter (((((i_category#1184 = Women) && (((((i_color#1189 = powder) || (i_color#1189 = khaki)) && ((i_units#1190 = Ounce) || (i_units#1190 = Oz))) && ((i_size#1187 = medium) || (i_size#1187 = extra large))) || ((((i_color#1189 = brown) || (i_color#1189 = honeydew)) && ((i_units#1190 = Bunch) || (i_units#1190 = Ton))) && ((i_size#1187 = N/A) || (i_size#1187 = small))))) || ((i_category#1184 = Men) && (((((i_color#1189 = floral) || (i_color#1189 = deep)) && ((i_units#1190 = N/A) || (i_units#1190 = Dozen))) && ((i_size#1187 = petite) || (i_size#1187 = large))) || ((((i_color#1189 = light) || (i_color#1189 = cornflower)) && ((i_units#1190 = Box) || (i_units#1190 = Pound))) && ((i_size#1187 = medium) || (i_size#1187 = extra large)))))) || (((i_category#1184 = Women) && (((((i_color#1189 = midnight) || (i_color#1189 = snow)) && ((i_units#1190 = Pallet) || (i_units#1190 = Gross))) && ((i_size#1187 = medium) || (i_size#1187 = extra large))) || ((((i_color#1189 = cyan) || (i_color#1189 = papaya)) && ((i_units#1190 = Cup) || (i_units#1190 = Dram))) && ((i_size#1187 = N/A) || (i_size#1187 = small))))) || ((i_category#1184 = Men) && (((((i_color#1189 = orange) || (i_color#1189 = frosted)) && ((i_units#1190 = Each) || (i_units#1190 = Tbl))) && ((i_size#1187 = petite) || (i_size#1187 = large))) || ((((i_color#1189 = forest) || (i_color#1189 = ghost)) && ((i_units#1190 = Lb) || (i_units#1190 = Bundle))) && ((i_size#1187 = medium) || (i_size#1187 = extra large))))))) && isnotnull(i_manufact#1186))\n                              +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_product_name#1193 ASC NULLS FIRST], output=[i_product_name#1193])\n+- *(4) HashAggregate(keys=[i_product_name#1193], functions=[], output=[i_product_name#1193])\n   +- Exchange hashpartitioning(i_product_name#1193, 200)\n      +- *(3) HashAggregate(keys=[i_product_name#1193], functions=[], output=[i_product_name#1193])\n         +- *(3) Project [i_product_name#1193]\n            +- *(3) BroadcastHashJoin [i_manufact#1186], [i_manufact#1186#20155], Inner, BuildRight\n               :- *(3) Project [i_manufact#1186, i_product_name#1193]\n               :  +- *(3) Filter (((isnotnull(i_manufact_id#1185) && (i_manufact_id#1185 >= 738)) && (i_manufact_id#1185 <= 778)) && isnotnull(i_manufact#1186))\n               :     +- *(3) FileScan parquet db_tpcds.item[i_manufact_id#1185,i_manufact#1186,i_product_name#1193] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_manufact_id), GreaterThanOrEqual(i_manufact_id,738), LessThanOrEqual(i_manufact_id,7..., ReadSchema: struct<i_manufact_id:int,i_manufact:string,i_product_name:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]))\n                  +- *(2) Project [i_manufact#1186#20155]\n                     +- *(2) Filter (if (isnull(alwaysTrue#20156)) 0 else item_cnt#20151L > 0)\n                        +- *(2) HashAggregate(keys=[i_manufact#1186], functions=[count(1)], output=[item_cnt#20151L, i_manufact#1186#20155, alwaysTrue#20156])\n                           +- Exchange hashpartitioning(i_manufact#1186, 200)\n                              +- *(1) HashAggregate(keys=[i_manufact#1186], functions=[partial_count(1)], output=[i_manufact#1186, count#20158L])\n                                 +- *(1) Project [i_manufact#1186]\n                                    +- *(1) Filter (((((i_category#1184 = Women) && (((((i_color#1189 = powder) || (i_color#1189 = khaki)) && ((i_units#1190 = Ounce) || (i_units#1190 = Oz))) && ((i_size#1187 = medium) || (i_size#1187 = extra large))) || ((((i_color#1189 = brown) || (i_color#1189 = honeydew)) && ((i_units#1190 = Bunch) || (i_units#1190 = Ton))) && ((i_size#1187 = N/A) || (i_size#1187 = small))))) || ((i_category#1184 = Men) && (((((i_color#1189 = floral) || (i_color#1189 = deep)) && ((i_units#1190 = N/A) || (i_units#1190 = Dozen))) && ((i_size#1187 = petite) || (i_size#1187 = large))) || ((((i_color#1189 = light) || (i_color#1189 = cornflower)) && ((i_units#1190 = Box) || (i_units#1190 = Pound))) && ((i_size#1187 = medium) || (i_size#1187 = extra large)))))) || (((i_category#1184 = Women) && (((((i_color#1189 = midnight) || (i_color#1189 = snow)) && ((i_units#1190 = Pallet) || (i_units#1190 = Gross))) && ((i_size#1187 = medium) || (i_size#1187 = extra large))) || ((((i_color#1189 = cyan) || (i_color#1189 = papaya)) && ((i_units#1190 = Cup) || (i_units#1190 = Dram))) && ((i_size#1187 = N/A) || (i_size#1187 = small))))) || ((i_category#1184 = Men) && (((((i_color#1189 = orange) || (i_color#1189 = frosted)) && ((i_units#1190 = Each) || (i_units#1190 = Tbl))) && ((i_size#1187 = petite) || (i_size#1187 = large))) || ((((i_color#1189 = forest) || (i_color#1189 = ghost)) && ((i_units#1190 = Lb) || (i_units#1190 = Bundle))) && ((i_size#1187 = medium) || (i_size#1187 = extra large))))))) && isnotnull(i_manufact#1186))\n                                       +- *(1) FileScan parquet db_tpcds.item[i_category#1184,i_manufact#1186,i_size#1187,i_color#1189,i_units#1190] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [Or(Or(And(EqualTo(i_category,Women),Or(And(And(Or(EqualTo(i_color,powder),EqualTo(i_color,khaki)..., ReadSchema: struct<i_category:string,i_manufact:string,i_size:string,i_color:string,i_units:string>"},{"name":"q42-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin"],"tables":["date_dim","store_sales","item"],"parsingTime":0.002555,"analysisTime":8.3E-4,"optimizationTime":270.41613,"planningTime":12.374297,"executionTime":1745.645996,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['sum('ss_ext_sales_price) DESC NULLS LAST, 'dt.d_year ASC NULLS FIRST, 'item.i_category_id ASC NULLS FIRST, 'item.i_category ASC NULLS FIRST], true\n      +- 'Aggregate ['dt.d_year, 'item.i_category_id, 'item.i_category], ['dt.d_year, 'item.i_category_id, 'item.i_category, unresolvedalias('sum('ss_ext_sales_price), None)]\n         +- 'Filter (((('dt.d_date_sk = 'store_sales.ss_sold_date_sk) && ('store_sales.ss_item_sk = 'item.i_item_sk)) && ('item.i_manager_id = 1)) && (('dt.d_moy = 11) && ('dt.d_year = 2000)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'SubqueryAlias dt\n               :  :  +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `store_sales`\n               +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\nd_year: int, i_category_id: int, i_category: string, sum(ss_ext_sales_price): decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [d_year#1046, i_category_id#1183, i_category#1184, sum(ss_ext_sales_price)#20178]\n      +- Sort [sum(ss_ext_sales_price)#20178 DESC NULLS LAST, d_year#1046 ASC NULLS FIRST, i_category_id#1183 ASC NULLS FIRST, i_category#1184 ASC NULLS FIRST], true\n         +- Aggregate [d_year#1046, i_category_id#1183, i_category#1184], [d_year#1046, i_category_id#1183, i_category#1184, sum(ss_ext_sales_price#1918) AS sum(ss_ext_sales_price)#20178]\n            +- Filter ((((d_date_sk#1040 = ss_sold_date_sk#1926) && (ss_item_sk#1905 = i_item_sk#1172)) && (i_manager_id#1192 = 1)) && ((d_moy#1048 = 11) && (d_year#1046 = 2000)))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- SubqueryAlias dt\n                  :  :  +- SubqueryAlias date_dim\n                  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :  +- SubqueryAlias store_sales\n                  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  +- SubqueryAlias item\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [sum(ss_ext_sales_price)#20178 DESC NULLS LAST, d_year#1046 ASC NULLS FIRST, i_category_id#1183 ASC NULLS FIRST, i_category#1184 ASC NULLS FIRST], true\n      +- Aggregate [d_year#1046, i_category_id#1183, i_category#1184], [d_year#1046, i_category_id#1183, i_category#1184, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS sum(ss_ext_sales_price)#20178]\n         +- Project [d_year#1046, ss_ext_sales_price#1918, i_category_id#1183, i_category#1184]\n            +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :- Project [d_year#1046, ss_item_sk#1905, ss_ext_sales_price#1918]\n               :  +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n               :     :- Project [d_date_sk#1040, d_year#1046]\n               :     :  +- Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 11)) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n               :     :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n               :        +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_item_sk#1905))\n               :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               +- Project [i_item_sk#1172, i_category_id#1183, i_category#1184]\n                  +- Filter ((isnotnull(i_manager_id#1192) && (i_manager_id#1192 = 1)) && isnotnull(i_item_sk#1172))\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[sum(ss_ext_sales_price)#20178 DESC NULLS LAST,d_year#1046 ASC NULLS FIRST,i_category_id#1183 ASC NULLS FIRST,i_category#1184 ASC NULLS FIRST], output=[d_year#1046,i_category_id#1183,i_category#1184,sum(ss_ext_sales_price)#20178])\n+- *(4) HashAggregate(keys=[d_year#1046, i_category_id#1183, i_category#1184], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[d_year#1046, i_category_id#1183, i_category#1184, sum(ss_ext_sales_price)#20178])\n   +- Exchange hashpartitioning(d_year#1046, i_category_id#1183, i_category#1184, 200)\n      +- *(3) HashAggregate(keys=[d_year#1046, i_category_id#1183, i_category#1184], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[d_year#1046, i_category_id#1183, i_category#1184, sum#20189L])\n         +- *(3) Project [d_year#1046, ss_ext_sales_price#1918, i_category_id#1183, i_category#1184]\n            +- *(3) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :- *(3) Project [d_year#1046, ss_item_sk#1905, ss_ext_sales_price#1918]\n               :  +- *(3) BroadcastHashJoin [d_date_sk#1040], [ss_sold_date_sk#1926], Inner, BuildLeft\n               :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :  +- *(1) Project [d_date_sk#1040, d_year#1046]\n               :     :     +- *(1) Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 11)) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n               :     :        +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,11), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               :     +- *(3) Project [ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n               :        +- *(3) Filter isnotnull(ss_item_sk#1905)\n               :           +- *(3) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_ext_sales_price:decimal(7,2)>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(2) Project [i_item_sk#1172, i_category_id#1183, i_category#1184]\n                     +- *(2) Filter ((isnotnull(i_manager_id#1192) && (i_manager_id#1192 = 1)) && isnotnull(i_item_sk#1172))\n                        +- *(2) FileScan parquet db_tpcds.item[i_item_sk#1172,i_category_id#1183,i_category#1184,i_manager_id#1192] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_manager_id), EqualTo(i_manager_id,1), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_category_id:int,i_category:string,i_manager_id:int>"},{"name":"q43-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin"],"tables":["date_dim","store_sales","store"],"parsingTime":0.002831,"analysisTime":0.001296,"optimizationTime":234.65353,"planningTime":10.912837,"executionTime":2460.545281,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['s_store_name ASC NULLS FIRST, 's_store_id ASC NULLS FIRST, 'sun_sales ASC NULLS FIRST, 'mon_sales ASC NULLS FIRST, 'tue_sales ASC NULLS FIRST, 'wed_sales ASC NULLS FIRST, 'thu_sales ASC NULLS FIRST, 'fri_sales ASC NULLS FIRST, 'sat_sales ASC NULLS FIRST], true\n      +- 'Aggregate ['s_store_name, 's_store_id], ['s_store_name, 's_store_id, 'sum(CASE WHEN ('d_day_name = Sunday) THEN 'ss_sales_price ELSE null END) AS sun_sales#20248, 'sum(CASE WHEN ('d_day_name = Monday) THEN 'ss_sales_price ELSE null END) AS mon_sales#20249, 'sum(CASE WHEN ('d_day_name = Tuesday) THEN 'ss_sales_price ELSE null END) AS tue_sales#20250, 'sum(CASE WHEN ('d_day_name = Wednesday) THEN 'ss_sales_price ELSE null END) AS wed_sales#20251, 'sum(CASE WHEN ('d_day_name = Thursday) THEN 'ss_sales_price ELSE null END) AS thu_sales#20252, 'sum(CASE WHEN ('d_day_name = Friday) THEN 'ss_sales_price ELSE null END) AS fri_sales#20253, 'sum(CASE WHEN ('d_day_name = Saturday) THEN 'ss_sales_price ELSE null END) AS sat_sales#20254]\n         +- 'Filter ((('d_date_sk = 'ss_sold_date_sk) && ('s_store_sk = 'ss_store_sk)) && (('s_gmt_offset = -5) && ('d_year = 2000)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `store_sales`\n               +- 'UnresolvedRelation `store`\n\n== Analyzed Logical Plan ==\ns_store_name: string, s_store_id: string, sun_sales: decimal(17,2), mon_sales: decimal(17,2), tue_sales: decimal(17,2), wed_sales: decimal(17,2), thu_sales: decimal(17,2), fri_sales: decimal(17,2), sat_sales: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [s_store_name#1391 ASC NULLS FIRST, s_store_id#1387 ASC NULLS FIRST, sun_sales#20248 ASC NULLS FIRST, mon_sales#20249 ASC NULLS FIRST, tue_sales#20250 ASC NULLS FIRST, wed_sales#20251 ASC NULLS FIRST, thu_sales#20252 ASC NULLS FIRST, fri_sales#20253 ASC NULLS FIRST, sat_sales#20254 ASC NULLS FIRST], true\n      +- Aggregate [s_store_name#1391, s_store_id#1387], [s_store_name#1391, s_store_id#1387, sum(CASE WHEN (d_day_name#1054 = Sunday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS sun_sales#20248, sum(CASE WHEN (d_day_name#1054 = Monday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS mon_sales#20249, sum(CASE WHEN (d_day_name#1054 = Tuesday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS tue_sales#20250, sum(CASE WHEN (d_day_name#1054 = Wednesday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS wed_sales#20251, sum(CASE WHEN (d_day_name#1054 = Thursday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS thu_sales#20252, sum(CASE WHEN (d_day_name#1054 = Friday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS fri_sales#20253, sum(CASE WHEN (d_day_name#1054 = Saturday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS sat_sales#20254]\n         +- Filter (((d_date_sk#1040 = ss_sold_date_sk#1926) && (s_store_sk#1386 = ss_store_sk#1910)) && ((cast(s_gmt_offset#1413 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2))) && (d_year#1046 = 2000)))\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias date_dim\n               :  :  +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  +- SubqueryAlias store_sales\n               :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               +- SubqueryAlias store\n                  +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [s_store_name#1391 ASC NULLS FIRST, s_store_id#1387 ASC NULLS FIRST, sun_sales#20248 ASC NULLS FIRST, mon_sales#20249 ASC NULLS FIRST, tue_sales#20250 ASC NULLS FIRST, wed_sales#20251 ASC NULLS FIRST, thu_sales#20252 ASC NULLS FIRST, fri_sales#20253 ASC NULLS FIRST, sat_sales#20254 ASC NULLS FIRST], true\n      +- Aggregate [s_store_name#1391, s_store_id#1387], [s_store_name#1391, s_store_id#1387, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS sun_sales#20248, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS mon_sales#20249, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS tue_sales#20250, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS wed_sales#20251, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS thu_sales#20252, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS fri_sales#20253, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS sat_sales#20254]\n         +- Project [d_day_name#1054, ss_sales_price#1916, s_store_id#1387, s_store_name#1391]\n            +- Join Inner, (s_store_sk#1386 = ss_store_sk#1910)\n               :- Project [d_day_name#1054, ss_store_sk#1910, ss_sales_price#1916]\n               :  +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n               :     :- Project [d_date_sk#1040, d_day_name#1054]\n               :     :  +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n               :     :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n               :        +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910))\n               :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               +- Project [s_store_sk#1386, s_store_id#1387, s_store_name#1391]\n                  +- Filter ((isnotnull(s_gmt_offset#1413) && (s_gmt_offset#1413 = -5.00)) && isnotnull(s_store_sk#1386))\n                     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[s_store_name#1391 ASC NULLS FIRST,s_store_id#1387 ASC NULLS FIRST,sun_sales#20248 ASC NULLS FIRST,mon_sales#20249 ASC NULLS FIRST,tue_sales#20250 ASC NULLS FIRST,wed_sales#20251 ASC NULLS FIRST,thu_sales#20252 ASC NULLS FIRST,fri_sales#20253 ASC NULLS FIRST,sat_sales#20254 ASC NULLS FIRST], output=[s_store_name#1391,s_store_id#1387,sun_sales#20248,mon_sales#20249,tue_sales#20250,wed_sales#20251,thu_sales#20252,fri_sales#20253,sat_sales#20254])\n+- *(4) HashAggregate(keys=[s_store_name#1391, s_store_id#1387], functions=[sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN ss_sales_price#1916 ELSE null END))], output=[s_store_name#1391, s_store_id#1387, sun_sales#20248, mon_sales#20249, tue_sales#20250, wed_sales#20251, thu_sales#20252, fri_sales#20253, sat_sales#20254])\n   +- Exchange hashpartitioning(s_store_name#1391, s_store_id#1387, 200)\n      +- *(3) HashAggregate(keys=[s_store_name#1391, s_store_id#1387], functions=[partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN ss_sales_price#1916 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN ss_sales_price#1916 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN ss_sales_price#1916 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN ss_sales_price#1916 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN ss_sales_price#1916 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN ss_sales_price#1916 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN ss_sales_price#1916 ELSE null END))], output=[s_store_name#1391, s_store_id#1387, sum#20287L, sum#20288L, sum#20289L, sum#20290L, sum#20291L, sum#20292L, sum#20293L])\n         +- *(3) Project [d_day_name#1054, ss_sales_price#1916, s_store_id#1387, s_store_name#1391]\n            +- *(3) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n               :- *(3) Project [d_day_name#1054, ss_store_sk#1910, ss_sales_price#1916]\n               :  +- *(3) BroadcastHashJoin [d_date_sk#1040], [ss_sold_date_sk#1926], Inner, BuildLeft\n               :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :  +- *(1) Project [d_date_sk#1040, d_day_name#1054]\n               :     :     +- *(1) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n               :     :        +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_day_name#1054] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_day_name:string>\n               :     +- *(3) Project [ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n               :        +- *(3) Filter isnotnull(ss_store_sk#1910)\n               :           +- *(3) FileScan parquet db_tpcds.store_sales[ss_store_sk#1910,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:int,ss_sales_price:decimal(7,2)>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(2) Project [s_store_sk#1386, s_store_id#1387, s_store_name#1391]\n                     +- *(2) Filter ((isnotnull(s_gmt_offset#1413) && (s_gmt_offset#1413 = -5.00)) && isnotnull(s_store_sk#1386))\n                        +- *(2) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_id#1387,s_store_name#1391,s_gmt_offset#1413] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_gmt_offset), EqualTo(s_gmt_offset,-5.00), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_store_id:string,s_store_name:string,s_gmt_offset:decimal(5,2)>"},{"name":"q44-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin"],"tables":["store_sales","store_sales","item","item"],"parsingTime":0.003466,"analysisTime":8.63E-4,"optimizationTime":64.540805,"planningTime":1845.725746,"executionTime":6296.425881,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['asceding.rnk ASC NULLS FIRST], true\n      +- 'Project ['asceding.rnk, 'i1.i_product_name AS best_performing#20444, 'i2.i_product_name AS worst_performing#20445]\n         +- 'Filter ((('asceding.rnk = 'descending.rnk) && ('i1.i_item_sk = 'asceding.item_sk)) && ('i2.i_item_sk = 'descending.item_sk))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'SubqueryAlias asceding\n               :  :  :  +- 'Project [*]\n               :  :  :     +- 'Filter ('rnk < 11)\n               :  :  :        +- 'SubqueryAlias V11\n               :  :  :           +- 'Project ['item_sk, 'rank() windowspecdefinition('rank_col ASC NULLS FIRST, unspecifiedframe$()) AS rnk#20438]\n               :  :  :              +- 'SubqueryAlias V1\n               :  :  :                 +- 'Filter ('avg('ss_net_profit) > (0.9 * scalar-subquery#20437 []))\n               :  :  :                    :  +- 'Aggregate ['ss_store_sk], ['avg('ss_net_profit) AS rank_col#20436]\n               :  :  :                    :     +- 'Filter (('ss_store_sk = 4) && isnull('ss_addr_sk))\n               :  :  :                    :        +- 'UnresolvedRelation `store_sales`\n               :  :  :                    +- 'Aggregate ['ss_item_sk], ['ss_item_sk AS item_sk#20434, 'avg('ss_net_profit) AS rank_col#20435]\n               :  :  :                       +- 'Filter ('ss_store_sk = 4)\n               :  :  :                          +- 'SubqueryAlias ss1\n               :  :  :                             +- 'UnresolvedRelation `store_sales`\n               :  :  +- 'SubqueryAlias descending\n               :  :     +- 'Project [*]\n               :  :        +- 'Filter ('rnk < 11)\n               :  :           +- 'SubqueryAlias V21\n               :  :              +- 'Project ['item_sk, 'rank() windowspecdefinition('rank_col DESC NULLS LAST, unspecifiedframe$()) AS rnk#20443]\n               :  :                 +- 'SubqueryAlias V2\n               :  :                    +- 'Filter ('avg('ss_net_profit) > (0.9 * scalar-subquery#20442 []))\n               :  :                       :  +- 'Aggregate ['ss_store_sk], ['avg('ss_net_profit) AS rank_col#20441]\n               :  :                       :     +- 'Filter (('ss_store_sk = 4) && isnull('ss_addr_sk))\n               :  :                       :        +- 'UnresolvedRelation `store_sales`\n               :  :                       +- 'Aggregate ['ss_item_sk], ['ss_item_sk AS item_sk#20439, 'avg('ss_net_profit) AS rank_col#20440]\n               :  :                          +- 'Filter ('ss_store_sk = 4)\n               :  :                             +- 'SubqueryAlias ss1\n               :  :                                +- 'UnresolvedRelation `store_sales`\n               :  +- 'SubqueryAlias i1\n               :     +- 'UnresolvedRelation `item`\n               +- 'SubqueryAlias i2\n                  +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\nrnk: int, best_performing: string, worst_performing: string\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [rnk#20438 ASC NULLS FIRST], true\n      +- Project [rnk#20438, i_product_name#1193 AS best_performing#20444, i_product_name#20489 AS worst_performing#20445]\n         +- Filter (((rnk#20438 = rnk#20443) && (i_item_sk#1172 = item_sk#20434)) && (i_item_sk#20468 = item_sk#20439))\n            +- Join Inner\n               :- Join Inner\n               :  :- Join Inner\n               :  :  :- SubqueryAlias asceding\n               :  :  :  +- Project [item_sk#20434, rnk#20438]\n               :  :  :     +- Filter (rnk#20438 < 11)\n               :  :  :        +- SubqueryAlias V11\n               :  :  :           +- Project [item_sk#20434, rnk#20438]\n               :  :  :              +- Project [item_sk#20434, rank_col#20435, rnk#20438, rnk#20438]\n               :  :  :                 +- Window [rank(rank_col#20435) windowspecdefinition(rank_col#20435 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rnk#20438], [rank_col#20435 ASC NULLS FIRST]\n               :  :  :                    +- Project [item_sk#20434, rank_col#20435]\n               :  :  :                       +- SubqueryAlias V1\n               :  :  :                          +- Project [item_sk#20434, rank_col#20435]\n               :  :  :                             +- Filter (cast(avg(ss_net_profit#1925)#20456 as decimal(13,7)) > cast(CheckOverflow((promote_precision(cast(0.9 as decimal(11,6))) * promote_precision(cast(scalar-subquery#20437 [] as decimal(11,6)))), DecimalType(13,7)) as decimal(13,7)))\n               :  :  :                                :  +- Aggregate [ss_store_sk#1910], [avg(ss_net_profit#1925) AS rank_col#20436]\n               :  :  :                                :     +- Filter ((ss_store_sk#1910 = 4) && isnull(ss_addr_sk#1909))\n               :  :  :                                :        +- SubqueryAlias store_sales\n               :  :  :                                :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :  :                                +- Aggregate [ss_item_sk#1905], [ss_item_sk#1905 AS item_sk#20434, avg(ss_net_profit#1925) AS rank_col#20435, avg(ss_net_profit#1925) AS avg(ss_net_profit#1925)#20456]\n               :  :  :                                   +- Filter (ss_store_sk#1910 = 4)\n               :  :  :                                      +- SubqueryAlias ss1\n               :  :  :                                         +- SubqueryAlias store_sales\n               :  :  :                                            +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :  +- SubqueryAlias descending\n               :  :     +- Project [item_sk#20439, rnk#20443]\n               :  :        +- Filter (rnk#20443 < 11)\n               :  :           +- SubqueryAlias V21\n               :  :              +- Project [item_sk#20439, rnk#20443]\n               :  :                 +- Project [item_sk#20439, rank_col#20440, rnk#20443, rnk#20443]\n               :  :                    +- Window [rank(rank_col#20440) windowspecdefinition(rank_col#20440 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rnk#20443], [rank_col#20440 DESC NULLS LAST]\n               :  :                       +- Project [item_sk#20439, rank_col#20440]\n               :  :                          +- SubqueryAlias V2\n               :  :                             +- Project [item_sk#20439, rank_col#20440]\n               :  :                                +- Filter (cast(avg(ss_net_profit#1925)#20459 as decimal(13,7)) > cast(CheckOverflow((promote_precision(cast(0.9 as decimal(11,6))) * promote_precision(cast(scalar-subquery#20442 [] as decimal(11,6)))), DecimalType(13,7)) as decimal(13,7)))\n               :  :                                   :  +- Aggregate [ss_store_sk#1910], [avg(ss_net_profit#1925) AS rank_col#20441]\n               :  :                                   :     +- Filter ((ss_store_sk#1910 = 4) && isnull(ss_addr_sk#1909))\n               :  :                                   :        +- SubqueryAlias store_sales\n               :  :                                   :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :                                   +- Aggregate [ss_item_sk#1905], [ss_item_sk#1905 AS item_sk#20439, avg(ss_net_profit#1925) AS rank_col#20440, avg(ss_net_profit#1925) AS avg(ss_net_profit#1925)#20459]\n               :  :                                      +- Filter (ss_store_sk#1910 = 4)\n               :  :                                         +- SubqueryAlias ss1\n               :  :                                            +- SubqueryAlias store_sales\n               :  :                                               +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  +- SubqueryAlias i1\n               :     +- SubqueryAlias item\n               :        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               +- SubqueryAlias i2\n                  +- SubqueryAlias item\n                     +- Relation[i_item_sk#20468,i_item_id#20469,i_rec_start_date#20470,i_rec_end_date#20471,i_item_desc#20472,i_current_price#20473,i_wholesale_cost#20474,i_brand_id#20475,i_brand#20476,i_class_id#20477,i_class#20478,i_category_id#20479,i_category#20480,i_manufact_id#20481,i_manufact#20482,i_size#20483,i_formulation#20484,i_color#20485,i_units#20486,i_container#20487,i_manager_id#20488,i_product_name#20489] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [rnk#20438 ASC NULLS FIRST], true\n      +- Project [rnk#20438, i_product_name#1193 AS best_performing#20444, i_product_name#20489 AS worst_performing#20445]\n         +- Join Inner, (i_item_sk#20468 = item_sk#20439)\n            :- Project [rnk#20438, item_sk#20439, i_product_name#1193]\n            :  +- Join Inner, (i_item_sk#1172 = item_sk#20434)\n            :     :- Project [item_sk#20434, rnk#20438, item_sk#20439]\n            :     :  +- Join Inner, (rnk#20438 = rnk#20443)\n            :     :     :- Project [item_sk#20434, rnk#20438]\n            :     :     :  +- Filter ((isnotnull(rnk#20438) && (rnk#20438 < 11)) && isnotnull(item_sk#20434))\n            :     :     :     +- Window [rank(rank_col#20435) windowspecdefinition(rank_col#20435 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rnk#20438], [rank_col#20435 ASC NULLS FIRST]\n            :     :     :        +- Project [item_sk#20434, rank_col#20435]\n            :     :     :           +- Filter (isnotnull(avg(ss_net_profit#1925)#20456) && (cast(avg(ss_net_profit#1925)#20456 as decimal(13,7)) > CheckOverflow((0.900000 * promote_precision(scalar-subquery#20437 [])), DecimalType(13,7))))\n            :     :     :              :  +- Aggregate [ss_store_sk#1910], [cast((avg(UnscaledValue(ss_net_profit#1925)) / 100.0) as decimal(11,6)) AS rank_col#20436]\n            :     :     :              :     +- Project [ss_store_sk#1910, ss_net_profit#1925]\n            :     :     :              :        +- Filter ((isnotnull(ss_store_sk#1910) && (ss_store_sk#1910 = 4)) && isnull(ss_addr_sk#1909))\n            :     :     :              :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :     :              +- Aggregate [ss_item_sk#1905], [ss_item_sk#1905 AS item_sk#20434, cast((avg(UnscaledValue(ss_net_profit#1925)) / 100.0) as decimal(11,6)) AS rank_col#20435, cast((avg(UnscaledValue(ss_net_profit#1925)) / 100.0) as decimal(11,6)) AS avg(ss_net_profit#1925)#20456]\n            :     :     :                 +- Project [ss_item_sk#1905, ss_net_profit#1925]\n            :     :     :                    +- Filter (isnotnull(ss_store_sk#1910) && (ss_store_sk#1910 = 4))\n            :     :     :                       +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :     +- Project [item_sk#20439, rnk#20443]\n            :     :        +- Filter ((isnotnull(rnk#20443) && (rnk#20443 < 11)) && isnotnull(item_sk#20439))\n            :     :           +- Window [rank(rank_col#20440) windowspecdefinition(rank_col#20440 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rnk#20443], [rank_col#20440 DESC NULLS LAST]\n            :     :              +- Project [item_sk#20439, rank_col#20440]\n            :     :                 +- Filter (isnotnull(avg(ss_net_profit#1925)#20459) && (cast(avg(ss_net_profit#1925)#20459 as decimal(13,7)) > CheckOverflow((0.900000 * promote_precision(scalar-subquery#20442 [])), DecimalType(13,7))))\n            :     :                    :  +- Aggregate [ss_store_sk#1910], [cast((avg(UnscaledValue(ss_net_profit#1925)) / 100.0) as decimal(11,6)) AS rank_col#20441]\n            :     :                    :     +- Project [ss_store_sk#1910, ss_net_profit#1925]\n            :     :                    :        +- Filter ((isnotnull(ss_store_sk#1910) && (ss_store_sk#1910 = 4)) && isnull(ss_addr_sk#1909))\n            :     :                    :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :                    +- Aggregate [ss_item_sk#1905], [ss_item_sk#1905 AS item_sk#20439, cast((avg(UnscaledValue(ss_net_profit#1925)) / 100.0) as decimal(11,6)) AS rank_col#20440, cast((avg(UnscaledValue(ss_net_profit#1925)) / 100.0) as decimal(11,6)) AS avg(ss_net_profit#1925)#20459]\n            :     :                       +- Project [ss_item_sk#1905, ss_net_profit#1925]\n            :     :                          +- Filter (isnotnull(ss_store_sk#1910) && (ss_store_sk#1910 = 4))\n            :     :                             +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     +- Project [i_item_sk#1172, i_product_name#1193]\n            :        +- Filter isnotnull(i_item_sk#1172)\n            :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            +- Project [i_item_sk#20468, i_product_name#20489]\n               +- Filter isnotnull(i_item_sk#20468)\n                  +- Relation[i_item_sk#20468,i_item_id#20469,i_rec_start_date#20470,i_rec_end_date#20471,i_item_desc#20472,i_current_price#20473,i_wholesale_cost#20474,i_brand_id#20475,i_brand#20476,i_class_id#20477,i_class#20478,i_category_id#20479,i_category#20480,i_manufact_id#20481,i_manufact#20482,i_size#20483,i_formulation#20484,i_color#20485,i_units#20486,i_container#20487,i_manager_id#20488,i_product_name#20489] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[rnk#20438 ASC NULLS FIRST], output=[rnk#20438,best_performing#20444,worst_performing#20445])\n+- *(11) Project [rnk#20438, i_product_name#1193 AS best_performing#20444, i_product_name#20489 AS worst_performing#20445]\n   +- *(11) BroadcastHashJoin [item_sk#20439], [i_item_sk#20468], Inner, BuildRight\n      :- *(11) Project [rnk#20438, item_sk#20439, i_product_name#1193]\n      :  +- *(11) BroadcastHashJoin [item_sk#20434], [i_item_sk#1172], Inner, BuildRight\n      :     :- *(11) Project [item_sk#20434, rnk#20438, item_sk#20439]\n      :     :  +- *(11) SortMergeJoin [rnk#20438], [rnk#20443], Inner\n      :     :     :- *(4) Sort [rnk#20438 ASC NULLS FIRST], false, 0\n      :     :     :  +- *(4) Project [item_sk#20434, rnk#20438]\n      :     :     :     +- *(4) Filter ((isnotnull(rnk#20438) && (rnk#20438 < 11)) && isnotnull(item_sk#20434))\n      :     :     :        +- Window [rank(rank_col#20435) windowspecdefinition(rank_col#20435 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rnk#20438], [rank_col#20435 ASC NULLS FIRST]\n      :     :     :           +- *(3) Sort [rank_col#20435 ASC NULLS FIRST], false, 0\n      :     :     :              +- Exchange SinglePartition\n      :     :     :                 +- *(2) Project [item_sk#20434, rank_col#20435]\n      :     :     :                    +- *(2) Filter (isnotnull(avg(ss_net_profit#1925)#20456) && (cast(avg(ss_net_profit#1925)#20456 as decimal(13,7)) > CheckOverflow((0.900000 * promote_precision(Subquery subquery20437)), DecimalType(13,7))))\n      :     :     :                       :  +- Subquery subquery20437\n      :     :     :                       :     +- *(2) HashAggregate(keys=[ss_store_sk#1910], functions=[avg(UnscaledValue(ss_net_profit#1925))], output=[rank_col#20436])\n      :     :     :                       :        +- Exchange hashpartitioning(ss_store_sk#1910, 200)\n      :     :     :                       :           +- *(1) HashAggregate(keys=[ss_store_sk#1910], functions=[partial_avg(UnscaledValue(ss_net_profit#1925))], output=[ss_store_sk#1910, sum#20519, count#20520L])\n      :     :     :                       :              +- *(1) Project [ss_store_sk#1910, ss_net_profit#1925]\n      :     :     :                       :                 +- *(1) Filter ((isnotnull(ss_store_sk#1910) && (ss_store_sk#1910 = 4)) && isnull(ss_addr_sk#1909))\n      :     :     :                       :                    +- *(1) FileScan parquet db_tpcds.store_sales[ss_addr_sk#1909,ss_store_sk#1910,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_store_sk), EqualTo(ss_store_sk,4), IsNull(ss_addr_sk)], ReadSchema: struct<ss_addr_sk:int,ss_store_sk:int,ss_net_profit:decimal(7,2)>\n      :     :     :                       +- *(2) HashAggregate(keys=[ss_item_sk#1905], functions=[avg(UnscaledValue(ss_net_profit#1925))], output=[item_sk#20434, rank_col#20435, avg(ss_net_profit#1925)#20456])\n      :     :     :                          +- Exchange hashpartitioning(ss_item_sk#1905, 200)\n      :     :     :                             +- *(1) HashAggregate(keys=[ss_item_sk#1905], functions=[partial_avg(UnscaledValue(ss_net_profit#1925))], output=[ss_item_sk#1905, sum#20511, count#20512L])\n      :     :     :                                +- *(1) Project [ss_item_sk#1905, ss_net_profit#1925]\n      :     :     :                                   +- *(1) Filter (isnotnull(ss_store_sk#1910) && (ss_store_sk#1910 = 4))\n      :     :     :                                      +- *(1) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_store_sk#1910,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_store_sk), EqualTo(ss_store_sk,4)], ReadSchema: struct<ss_item_sk:int,ss_store_sk:int,ss_net_profit:decimal(7,2)>\n      :     :     +- *(8) Sort [rnk#20443 ASC NULLS FIRST], false, 0\n      :     :        +- *(8) Project [item_sk#20439, rnk#20443]\n      :     :           +- *(8) Filter ((isnotnull(rnk#20443) && (rnk#20443 < 11)) && isnotnull(item_sk#20439))\n      :     :              +- Window [rank(rank_col#20440) windowspecdefinition(rank_col#20440 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rnk#20443], [rank_col#20440 DESC NULLS LAST]\n      :     :                 +- *(7) Sort [rank_col#20440 DESC NULLS LAST], false, 0\n      :     :                    +- Exchange SinglePartition\n      :     :                       +- *(6) Project [item_sk#20439, rank_col#20440]\n      :     :                          +- *(6) Filter (isnotnull(avg(ss_net_profit#1925)#20459) && (cast(avg(ss_net_profit#1925)#20459 as decimal(13,7)) > CheckOverflow((0.900000 * promote_precision(Subquery subquery20442)), DecimalType(13,7))))\n      :     :                             :  +- Subquery subquery20442\n      :     :                             :     +- *(2) HashAggregate(keys=[ss_store_sk#1910], functions=[avg(UnscaledValue(ss_net_profit#1925))], output=[rank_col#20441])\n      :     :                             :        +- Exchange hashpartitioning(ss_store_sk#1910, 200)\n      :     :                             :           +- *(1) HashAggregate(keys=[ss_store_sk#1910], functions=[partial_avg(UnscaledValue(ss_net_profit#1925))], output=[ss_store_sk#1910, sum#20523, count#20524L])\n      :     :                             :              +- *(1) Project [ss_store_sk#1910, ss_net_profit#1925]\n      :     :                             :                 +- *(1) Filter ((isnotnull(ss_store_sk#1910) && (ss_store_sk#1910 = 4)) && isnull(ss_addr_sk#1909))\n      :     :                             :                    +- *(1) FileScan parquet db_tpcds.store_sales[ss_addr_sk#1909,ss_store_sk#1910,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_store_sk), EqualTo(ss_store_sk,4), IsNull(ss_addr_sk)], ReadSchema: struct<ss_addr_sk:int,ss_store_sk:int,ss_net_profit:decimal(7,2)>\n      :     :                             +- *(6) HashAggregate(keys=[ss_item_sk#1905], functions=[avg(UnscaledValue(ss_net_profit#1925))], output=[item_sk#20439, rank_col#20440, avg(ss_net_profit#1925)#20459])\n      :     :                                +- ReusedExchange [ss_item_sk#1905, sum#20515, count#20516L], Exchange hashpartitioning(ss_item_sk#1905, 200)\n      :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :        +- *(9) Project [i_item_sk#1172, i_product_name#1193]\n      :           +- *(9) Filter isnotnull(i_item_sk#1172)\n      :              +- *(9) FileScan parquet db_tpcds.item[i_item_sk#1172,i_product_name#1193] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_product_name:string>\n      +- ReusedExchange [i_item_sk#20468, i_product_name#20489], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q45-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["web_sales","customer","customer_address","date_dim","item"],"parsingTime":0.003432,"analysisTime":9.0E-4,"optimizationTime":410.330709,"planningTime":16.806227,"executionTime":2048.920713,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['ca_zip ASC NULLS FIRST, 'ca_city ASC NULLS FIRST], true\n      +- 'Aggregate ['ca_zip, 'ca_city], ['ca_zip, 'ca_city, unresolvedalias('sum('ws_sales_price), None)]\n         +- 'Filter (((('ws_bill_customer_sk = 'c_customer_sk) && ('c_current_addr_sk = 'ca_address_sk)) && (('ws_item_sk = 'i_item_sk) && ('substr('ca_zip, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) || 'i_item_id IN (list#20629 [])))) && ((('ws_sold_date_sk = 'd_date_sk) && ('d_qoy = 2)) && ('d_year = 2001)))\n            :  +- 'Project ['i_item_id]\n            :     +- 'Filter 'i_item_sk IN (2,3,5,7,11,13,17,19,23,29)\n            :        +- 'UnresolvedRelation `item`\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'UnresolvedRelation `web_sales`\n               :  :  :  +- 'UnresolvedRelation `customer`\n               :  :  +- 'UnresolvedRelation `customer_address`\n               :  +- 'UnresolvedRelation `date_dim`\n               +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\nca_zip: string, ca_city: string, sum(ws_sales_price): decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [ca_zip#931, ca_city#928, sum(ws_sales_price)#20631]\n      +- Sort [ca_zip#931 ASC NULLS FIRST, ca_city#928 ASC NULLS FIRST], true\n         +- Aggregate [ca_zip#931, ca_city#928], [ca_zip#931, ca_city#928, sum(ws_sales_price#1775) AS sum(ws_sales_price)#20631]\n            +- Filter ((((ws_bill_customer_sk#1758 = c_customer_sk#860) && (c_current_addr_sk#864 = ca_address_sk#922)) && ((ws_item_sk#1757 = i_item_sk#1172) && (substring(ca_zip#931, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) || i_item_id#1173 IN (list#20629 [])))) && (((ws_sold_date_sk#1788 = d_date_sk#1040) && (d_qoy#1050 = 2)) && (d_year#1046 = 2001)))\n               :  +- Project [i_item_id#1173]\n               :     +- Filter i_item_sk#1172 IN (2,3,5,7,11,13,17,19,23,29)\n               :        +- SubqueryAlias item\n               :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- Join Inner\n                  :  :  :  :- SubqueryAlias web_sales\n                  :  :  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :  :  :  +- SubqueryAlias customer\n                  :  :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :  :  +- SubqueryAlias customer_address\n                  :  :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  :  +- SubqueryAlias date_dim\n                  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  +- SubqueryAlias item\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [ca_zip#931 ASC NULLS FIRST, ca_city#928 ASC NULLS FIRST], true\n      +- Aggregate [ca_zip#931, ca_city#928], [ca_zip#931, ca_city#928, MakeDecimal(sum(UnscaledValue(ws_sales_price#1775)),17,2) AS sum(ws_sales_price)#20631]\n         +- Project [ws_sales_price#1775, ca_city#928, ca_zip#931]\n            +- Filter (substring(ca_zip#931, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) || exists#20638)\n               +- Join ExistenceJoin(exists#20638), (i_item_id#1173 = i_item_id#1173#20637)\n                  :- Project [ws_sales_price#1775, ca_city#928, ca_zip#931, i_item_id#1173]\n                  :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n                  :     :- Project [ws_item_sk#1757, ws_sales_price#1775, ca_city#928, ca_zip#931]\n                  :     :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                  :     :     :- Project [ws_item_sk#1757, ws_sales_price#1775, ws_sold_date_sk#1788, ca_city#928, ca_zip#931]\n                  :     :     :  +- Join Inner, (c_current_addr_sk#864 = ca_address_sk#922)\n                  :     :     :     :- Project [ws_item_sk#1757, ws_sales_price#1775, ws_sold_date_sk#1788, c_current_addr_sk#864]\n                  :     :     :     :  +- Join Inner, (ws_bill_customer_sk#1758 = c_customer_sk#860)\n                  :     :     :     :     :- Project [ws_item_sk#1757, ws_bill_customer_sk#1758, ws_sales_price#1775, ws_sold_date_sk#1788]\n                  :     :     :     :     :  +- Filter ((isnotnull(ws_bill_customer_sk#1758) && isnotnull(ws_sold_date_sk#1788)) && isnotnull(ws_item_sk#1757))\n                  :     :     :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :     :     :     :     +- Project [c_customer_sk#860, c_current_addr_sk#864]\n                  :     :     :     :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n                  :     :     :     :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :     :     :     +- Project [ca_address_sk#922, ca_city#928, ca_zip#931]\n                  :     :     :        +- Filter isnotnull(ca_address_sk#922)\n                  :     :     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  :     :     +- Project [d_date_sk#1040]\n                  :     :        +- Filter ((((isnotnull(d_qoy#1050) && isnotnull(d_year#1046)) && (d_qoy#1050 = 2)) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n                  :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :     +- Project [i_item_sk#1172, i_item_id#1173]\n                  :        +- Filter isnotnull(i_item_sk#1172)\n                  :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  +- Project [i_item_id#1173 AS i_item_id#1173#20637]\n                     +- Filter i_item_sk#1172 IN (2,3,5,7,11,13,17,19,23,29)\n                        +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[ca_zip#931 ASC NULLS FIRST,ca_city#928 ASC NULLS FIRST], output=[ca_zip#931,ca_city#928,sum(ws_sales_price)#20631])\n+- *(7) HashAggregate(keys=[ca_zip#931, ca_city#928], functions=[sum(UnscaledValue(ws_sales_price#1775))], output=[ca_zip#931, ca_city#928, sum(ws_sales_price)#20631])\n   +- Exchange hashpartitioning(ca_zip#931, ca_city#928, 200)\n      +- *(6) HashAggregate(keys=[ca_zip#931, ca_city#928], functions=[partial_sum(UnscaledValue(ws_sales_price#1775))], output=[ca_zip#931, ca_city#928, sum#20640L])\n         +- *(6) Project [ws_sales_price#1775, ca_city#928, ca_zip#931]\n            +- *(6) Filter (substring(ca_zip#931, 1, 5) IN (85669,86197,88274,83405,86475,85392,85460,80348,81792) || exists#20638)\n               +- *(6) BroadcastHashJoin [i_item_id#1173], [i_item_id#1173#20637], ExistenceJoin(exists#20638), BuildRight\n                  :- *(6) Project [ws_sales_price#1775, ca_city#928, ca_zip#931, i_item_id#1173]\n                  :  +- *(6) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n                  :     :- *(6) Project [ws_item_sk#1757, ws_sales_price#1775, ca_city#928, ca_zip#931]\n                  :     :  +- *(6) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                  :     :     :- *(6) Project [ws_item_sk#1757, ws_sales_price#1775, ws_sold_date_sk#1788, ca_city#928, ca_zip#931]\n                  :     :     :  +- *(6) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n                  :     :     :     :- *(6) Project [ws_item_sk#1757, ws_sales_price#1775, ws_sold_date_sk#1788, c_current_addr_sk#864]\n                  :     :     :     :  +- *(6) BroadcastHashJoin [ws_bill_customer_sk#1758], [c_customer_sk#860], Inner, BuildRight\n                  :     :     :     :     :- *(6) Project [ws_item_sk#1757, ws_bill_customer_sk#1758, ws_sales_price#1775, ws_sold_date_sk#1788]\n                  :     :     :     :     :  +- *(6) Filter (isnotnull(ws_bill_customer_sk#1758) && isnotnull(ws_item_sk#1757))\n                  :     :     :     :     :     +- *(6) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_bill_customer_sk#1758,ws_sales_price#1775,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_customer_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_bill_customer_sk:int,ws_sales_price:decimal(7,2)>\n                  :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :     :     :        +- *(1) Project [c_customer_sk#860, c_current_addr_sk#864]\n                  :     :     :     :           +- *(1) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n                  :     :     :     :              +- *(1) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_addr_sk#864] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:int,c_current_addr_sk:int>\n                  :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :     :        +- *(2) Project [ca_address_sk#922, ca_city#928, ca_zip#931]\n                  :     :     :           +- *(2) Filter isnotnull(ca_address_sk#922)\n                  :     :     :              +- *(2) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_city#928,ca_zip#931] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_city:string,ca_zip:string>\n                  :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :        +- *(3) Project [d_date_sk#1040]\n                  :     :           +- *(3) Filter ((((isnotnull(d_qoy#1050) && isnotnull(d_year#1046)) && (d_qoy#1050 = 2)) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n                  :     :              +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_qoy#1050] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_qoy), IsNotNull(d_year), EqualTo(d_qoy,2), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>\n                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :        +- *(4) Project [i_item_sk#1172, i_item_id#1173]\n                  :           +- *(4) Filter isnotnull(i_item_sk#1172)\n                  :              +- *(4) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string>\n                  +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]))\n                     +- *(5) Project [i_item_id#1173 AS i_item_id#1173#20637]\n                        +- *(5) Filter i_item_sk#1172 IN (2,3,5,7,11,13,17,19,23,29)\n                           +- *(5) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [In(i_item_sk, [2,3,5,7,11,13,17,19,23,29])], ReadSchema: struct<i_item_sk:int,i_item_id:string>"},{"name":"q46-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","date_dim","store","household_demographics","customer_address","customer","customer_address"],"parsingTime":0.003739,"analysisTime":0.0016,"optimizationTime":285.364482,"planningTime":13.621832,"executionTime":3182.554939,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['c_last_name ASC NULLS FIRST, 'c_first_name ASC NULLS FIRST, 'ca_city ASC NULLS FIRST, 'bought_city ASC NULLS FIRST, 'ss_ticket_number ASC NULLS FIRST], true\n      +- 'Project ['c_last_name, 'c_first_name, 'ca_city, 'bought_city, 'ss_ticket_number, 'amt, 'profit]\n         +- 'Filter ((('ss_customer_sk = 'c_customer_sk) && ('customer.c_current_addr_sk = 'current_addr.ca_address_sk)) && NOT ('current_addr.ca_city = 'bought_city))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'SubqueryAlias dn\n               :  :  +- 'Aggregate ['ss_ticket_number, 'ss_customer_sk, 'ss_addr_sk, 'ca_city], ['ss_ticket_number, 'ss_customer_sk, 'ca_city AS bought_city#20666, 'sum('ss_coupon_amt) AS amt#20667, 'sum('ss_net_profit) AS profit#20668]\n               :  :     +- 'Filter (((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) && ('store_sales.ss_store_sk = 'store.s_store_sk)) && (('store_sales.ss_hdemo_sk = 'household_demographics.hd_demo_sk) && ('store_sales.ss_addr_sk = 'customer_address.ca_address_sk))) && (((('household_demographics.hd_dep_count = 4) || ('household_demographics.hd_vehicle_count = 3)) && 'date_dim.d_dow IN (6,0)) && ('date_dim.d_year IN (1999,(1999 + 1),(1999 + 2)) && 'store.s_city IN (Fairview,Midway,Fairview,Fairview,Fairview))))\n               :  :        +- 'Join Inner\n               :  :           :- 'Join Inner\n               :  :           :  :- 'Join Inner\n               :  :           :  :  :- 'Join Inner\n               :  :           :  :  :  :- 'UnresolvedRelation `store_sales`\n               :  :           :  :  :  +- 'UnresolvedRelation `date_dim`\n               :  :           :  :  +- 'UnresolvedRelation `store`\n               :  :           :  +- 'UnresolvedRelation `household_demographics`\n               :  :           +- 'UnresolvedRelation `customer_address`\n               :  +- 'UnresolvedRelation `customer`\n               +- 'SubqueryAlias current_addr\n                  +- 'UnresolvedRelation `customer_address`\n\n== Analyzed Logical Plan ==\nc_last_name: string, c_first_name: string, ca_city: string, bought_city: string, ss_ticket_number: bigint, amt: decimal(17,2), profit: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [c_last_name#869 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, ca_city#928 ASC NULLS FIRST, bought_city#20666 ASC NULLS FIRST, ss_ticket_number#1912L ASC NULLS FIRST], true\n      +- Project [c_last_name#869, c_first_name#868, ca_city#928, bought_city#20666, ss_ticket_number#1912L, amt#20667, profit#20668]\n         +- Filter (((ss_customer_sk#1906 = c_customer_sk#860) && (c_current_addr_sk#864 = ca_address_sk#922)) && NOT (ca_city#928 = bought_city#20666))\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias dn\n               :  :  +- Aggregate [ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, ca_city#928], [ss_ticket_number#1912L, ss_customer_sk#1906, ca_city#928 AS bought_city#20666, sum(ss_coupon_amt#1922) AS amt#20667, sum(ss_net_profit#1925) AS profit#20668]\n               :  :     +- Filter ((((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_store_sk#1910 = s_store_sk#1386)) && ((ss_hdemo_sk#1908 = hd_demo_sk#1106) && (ss_addr_sk#1909 = ca_address_sk#922))) && ((((hd_dep_count#1109 = 4) || (hd_vehicle_count#1110 = 3)) && d_dow#1047 IN (6,0)) && (d_year#1046 IN (1999,(1999 + 1),(1999 + 2)) && s_city#1408 IN (Fairview,Midway,Fairview,Fairview,Fairview))))\n               :  :        +- Join Inner\n               :  :           :- Join Inner\n               :  :           :  :- Join Inner\n               :  :           :  :  :- Join Inner\n               :  :           :  :  :  :- SubqueryAlias store_sales\n               :  :           :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :           :  :  :  +- SubqueryAlias date_dim\n               :  :           :  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :           :  :  +- SubqueryAlias store\n               :  :           :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               :  :           :  +- SubqueryAlias household_demographics\n               :  :           :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n               :  :           +- SubqueryAlias customer_address\n               :  :              +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               :  +- SubqueryAlias customer\n               :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               +- SubqueryAlias current_addr\n                  +- SubqueryAlias customer_address\n                     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [c_last_name#869 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, ca_city#928 ASC NULLS FIRST, bought_city#20666 ASC NULLS FIRST, ss_ticket_number#1912L ASC NULLS FIRST], true\n      +- Project [c_last_name#869, c_first_name#868, ca_city#928, bought_city#20666, ss_ticket_number#1912L, amt#20667, profit#20668]\n         +- Join Inner, ((c_current_addr_sk#864 = ca_address_sk#922) && NOT (ca_city#928 = bought_city#20666))\n            :- Project [ss_ticket_number#1912L, bought_city#20666, amt#20667, profit#20668, c_current_addr_sk#864, c_first_name#868, c_last_name#869]\n            :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n            :     :- Aggregate [ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, ca_city#928], [ss_ticket_number#1912L, ss_customer_sk#1906, ca_city#928 AS bought_city#20666, MakeDecimal(sum(UnscaledValue(ss_coupon_amt#1922)),17,2) AS amt#20667, MakeDecimal(sum(UnscaledValue(ss_net_profit#1925)),17,2) AS profit#20668]\n            :     :  +- Project [ss_customer_sk#1906, ss_addr_sk#1909, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925, ca_city#928]\n            :     :     +- Join Inner, (ss_addr_sk#1909 = ca_address_sk#922)\n            :     :        :- Project [ss_customer_sk#1906, ss_addr_sk#1909, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925]\n            :     :        :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n            :     :        :     :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925]\n            :     :        :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n            :     :        :     :     :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925]\n            :     :        :     :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :     :        :     :     :     :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925, ss_sold_date_sk#1926]\n            :     :        :     :     :     :  +- Filter ((((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_addr_sk#1909)) && isnotnull(ss_customer_sk#1906))\n            :     :        :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :        :     :     :     +- Project [d_date_sk#1040]\n            :     :        :     :     :        +- Filter ((d_dow#1047 IN (6,0) && d_year#1046 IN (1999,2000,2001)) && isnotnull(d_date_sk#1040))\n            :     :        :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :        :     :     +- Project [s_store_sk#1386]\n            :     :        :     :        +- Filter (s_city#1408 IN (Fairview,Midway) && isnotnull(s_store_sk#1386))\n            :     :        :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n            :     :        :     +- Project [hd_demo_sk#1106]\n            :     :        :        +- Filter (((hd_dep_count#1109 = 4) || (hd_vehicle_count#1110 = 3)) && isnotnull(hd_demo_sk#1106))\n            :     :        :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n            :     :        +- Project [ca_address_sk#922, ca_city#928]\n            :     :           +- Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_city#928))\n            :     :              +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :     +- Project [c_customer_sk#860, c_current_addr_sk#864, c_first_name#868, c_last_name#869]\n            :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n            :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            +- Project [ca_address_sk#922, ca_city#928]\n               +- Filter (isnotnull(ca_city#928) && isnotnull(ca_address_sk#922))\n                  +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[c_last_name#869 ASC NULLS FIRST,c_first_name#868 ASC NULLS FIRST,ca_city#928 ASC NULLS FIRST,bought_city#20666 ASC NULLS FIRST,ss_ticket_number#1912L ASC NULLS FIRST], output=[c_last_name#869,c_first_name#868,ca_city#928,bought_city#20666,ss_ticket_number#1912L,amt#20667,profit#20668])\n+- *(8) Project [c_last_name#869, c_first_name#868, ca_city#928, bought_city#20666, ss_ticket_number#1912L, amt#20667, profit#20668]\n   +- *(8) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight, NOT (ca_city#928 = bought_city#20666)\n      :- *(8) Project [ss_ticket_number#1912L, bought_city#20666, amt#20667, profit#20668, c_current_addr_sk#864, c_first_name#868, c_last_name#869]\n      :  +- *(8) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n      :     :- *(8) HashAggregate(keys=[ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, ca_city#928], functions=[sum(UnscaledValue(ss_coupon_amt#1922)), sum(UnscaledValue(ss_net_profit#1925))], output=[ss_ticket_number#1912L, ss_customer_sk#1906, bought_city#20666, amt#20667, profit#20668])\n      :     :  +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, ca_city#928, 200)\n      :     :     +- *(5) HashAggregate(keys=[ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, ca_city#928], functions=[partial_sum(UnscaledValue(ss_coupon_amt#1922)), partial_sum(UnscaledValue(ss_net_profit#1925))], output=[ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, ca_city#928, sum#20680L, sum#20681L])\n      :     :        +- *(5) Project [ss_customer_sk#1906, ss_addr_sk#1909, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925, ca_city#928]\n      :     :           +- *(5) BroadcastHashJoin [ss_addr_sk#1909], [ca_address_sk#922], Inner, BuildRight\n      :     :              :- *(5) Project [ss_customer_sk#1906, ss_addr_sk#1909, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925]\n      :     :              :  +- *(5) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n      :     :              :     :- *(5) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925]\n      :     :              :     :  +- *(5) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n      :     :              :     :     :- *(5) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925]\n      :     :              :     :     :  +- *(5) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :     :              :     :     :     :- *(5) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925, ss_sold_date_sk#1926]\n      :     :              :     :     :     :  +- *(5) Filter (((isnotnull(ss_store_sk#1910) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_addr_sk#1909)) && isnotnull(ss_customer_sk#1906))\n      :     :              :     :     :     :     +- *(5) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_ticket_number#1912L,ss_coupon_amt#1922,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_addr_sk), IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_hdemo_sk:int,ss_addr_sk:int,ss_store_sk:int,ss_ticket_number:bigint,...\n      :     :              :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :              :     :     :        +- *(1) Project [d_date_sk#1040]\n      :     :              :     :     :           +- *(1) Filter ((d_dow#1047 IN (6,0) && d_year#1046 IN (1999,2000,2001)) && isnotnull(d_date_sk#1040))\n      :     :              :     :     :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_dow#1047] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [In(d_dow, [6,0]), In(d_year, [1999,2000,2001]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_dow:int>\n      :     :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :              :     :        +- *(2) Project [s_store_sk#1386]\n      :     :              :     :           +- *(2) Filter (s_city#1408 IN (Fairview,Midway) && isnotnull(s_store_sk#1386))\n      :     :              :     :              +- *(2) FileScan parquet db_tpcds.store[s_store_sk#1386,s_city#1408] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [In(s_city, [Fairview,Midway]), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_city:string>\n      :     :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :              :        +- *(3) Project [hd_demo_sk#1106]\n      :     :              :           +- *(3) Filter (((hd_dep_count#1109 = 4) || (hd_vehicle_count#1110 = 3)) && isnotnull(hd_demo_sk#1106))\n      :     :              :              +- *(3) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_dep_count#1109,hd_vehicle_count#1110] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [Or(EqualTo(hd_dep_count,4),EqualTo(hd_vehicle_count,3)), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:int,hd_dep_count:int,hd_vehicle_count:int>\n      :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                 +- *(4) Project [ca_address_sk#922, ca_city#928]\n      :     :                    +- *(4) Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_city#928))\n      :     :                       +- *(4) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_city#928] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_city)], ReadSchema: struct<ca_address_sk:int,ca_city:string>\n      :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :        +- *(6) Project [c_customer_sk#860, c_current_addr_sk#864, c_first_name#868, c_last_name#869]\n      :           +- *(6) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n      :              +- *(6) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_addr_sk#864,c_first_name#868,c_last_name#869] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:int,c_current_addr_sk:int,c_first_name:string,c_last_name:string>\n      +- ReusedExchange [ca_address_sk#922, ca_city#928], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q47-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["v2"],"parsingTime":0.003234,"analysisTime":0.001369,"optimizationTime":1022.919256,"planningTime":91.009077,"executionTime":23325.284242,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [v1, v2]\n:  :- 'SubqueryAlias v1\n:  :  +- 'Aggregate ['i_category, 'i_brand, 's_store_name, 's_company_name, 'd_year, 'd_moy], ['i_category, 'i_brand, 's_store_name, 's_company_name, 'd_year, 'd_moy, 'sum('ss_sales_price) AS sum_sales#21801, 'avg('sum('ss_sales_price)) windowspecdefinition('i_category, 'i_brand, 's_store_name, 's_company_name, 'd_year, unspecifiedframe$()) AS avg_monthly_sales#21802, 'rank() windowspecdefinition('i_category, 'i_brand, 's_store_name, 's_company_name, 'd_year ASC NULLS FIRST, 'd_moy ASC NULLS FIRST, unspecifiedframe$()) AS rn#21803]\n:  :     +- 'Filter ((('ss_item_sk = 'i_item_sk) && ('ss_sold_date_sk = 'd_date_sk)) && (('ss_store_sk = 's_store_sk) && ((('d_year = 1999) || (('d_year = (1999 - 1)) && ('d_moy = 12))) || (('d_year = (1999 + 1)) && ('d_moy = 1)))))\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'Join Inner\n:  :           :  :  :- 'UnresolvedRelation `item`\n:  :           :  :  +- 'UnresolvedRelation `store_sales`\n:  :           :  +- 'UnresolvedRelation `date_dim`\n:  :           +- 'UnresolvedRelation `store`\n:  +- 'SubqueryAlias v2\n:     +- 'Project ['v1.i_category, 'v1.i_brand, 'v1.s_store_name, 'v1.s_company_name, 'v1.d_year, 'v1.d_moy, 'v1.avg_monthly_sales, 'v1.sum_sales, 'v1_lag.sum_sales AS psum#21804, 'v1_lead.sum_sales AS nsum#21805]\n:        +- 'Filter ((((('v1.i_category = 'v1_lag.i_category) && ('v1.i_category = 'v1_lead.i_category)) && ('v1.i_brand = 'v1_lag.i_brand)) && (('v1.i_brand = 'v1_lead.i_brand) && ('v1.s_store_name = 'v1_lag.s_store_name))) && (((('v1.s_store_name = 'v1_lead.s_store_name) && ('v1.s_company_name = 'v1_lag.s_company_name)) && ('v1.s_company_name = 'v1_lead.s_company_name)) && (('v1.rn = ('v1_lag.rn + 1)) && ('v1.rn = ('v1_lead.rn - 1)))))\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'UnresolvedRelation `v1`\n:              :  +- 'SubqueryAlias v1_lag\n:              :     +- 'UnresolvedRelation `v1`\n:              +- 'SubqueryAlias v1_lead\n:                 +- 'UnresolvedRelation `v1`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort [('sum_sales - 'avg_monthly_sales) ASC NULLS FIRST, 3 ASC NULLS FIRST], true\n         +- 'Project [*]\n            +- 'Filter ((('d_year = 1999) && ('avg_monthly_sales > 0)) && (CASE WHEN ('avg_monthly_sales > 0) THEN ('abs(('sum_sales - 'avg_monthly_sales)) / 'avg_monthly_sales) ELSE null END > 0.1))\n               +- 'UnresolvedRelation `v2`\n\n== Analyzed Logical Plan ==\ni_category: string, i_brand: string, s_store_name: string, s_company_name: string, d_year: int, d_moy: int, avg_monthly_sales: decimal(21,6), sum_sales: decimal(17,2), psum: decimal(17,2), nsum: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [CheckOverflow((promote_precision(cast(sum_sales#21801 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#21802 as decimal(22,6)))), DecimalType(22,6)) ASC NULLS FIRST, s_store_name#1391 ASC NULLS FIRST], true\n      +- Project [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, avg_monthly_sales#21802, sum_sales#21801, psum#21804, nsum#21805]\n         +- Filter (((d_year#1046 = 1999) && (cast(avg_monthly_sales#21802 as decimal(21,6)) > cast(cast(0 as decimal(1,0)) as decimal(21,6)))) && (cast(CASE WHEN (cast(avg_monthly_sales#21802 as decimal(21,6)) > cast(cast(0 as decimal(1,0)) as decimal(21,6))) THEN CheckOverflow((promote_precision(cast(abs(CheckOverflow((promote_precision(cast(sum_sales#21801 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#21802 as decimal(22,6)))), DecimalType(22,6))) as decimal(22,6))) / promote_precision(cast(avg_monthly_sales#21802 as decimal(22,6)))), DecimalType(38,16)) ELSE cast(null as decimal(38,16)) END as decimal(38,16)) > cast(0.1 as decimal(38,16))))\n            +- SubqueryAlias v2\n               +- Project [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, avg_monthly_sales#21802, sum_sales#21801, sum_sales#22013 AS psum#21804, sum_sales#22488 AS nsum#21805]\n                  +- Filter (((((i_category#1184 = i_category#22118) && (i_category#1184 = i_category#22593)) && (i_brand#1180 = i_brand#22114)) && ((i_brand#1180 = i_brand#22589) && (s_store_name#1391 = s_store_name#22275))) && ((((s_store_name#1391 = s_store_name#22750) && (s_company_name#1403 = s_company_name#22287)) && (s_company_name#1403 = s_company_name#22762)) && ((rn#21803 = (rn#21824 + 1)) && (rn#21803 = (rn#22299 - 1)))))\n                     +- Join Inner\n                        :- Join Inner\n                        :  :- SubqueryAlias v1\n                        :  :  +- Project [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, sum_sales#21801, avg_monthly_sales#21802, rn#21803]\n                        :  :     +- Project [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, sum_sales#21801, _w0#21819, avg_monthly_sales#21802, rn#21803, avg_monthly_sales#21802, rn#21803]\n                        :  :        +- Window [rank(d_year#1046, d_moy#1048) windowspecdefinition(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#21803], [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403], [d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST]\n                        :  :           +- Window [avg(_w0#21819) windowspecdefinition(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#21802], [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046]\n                        :  :              +- Aggregate [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048], [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, sum(ss_sales_price#1916) AS sum_sales#21801, sum(ss_sales_price#1916) AS _w0#21819]\n                        :  :                 +- Filter (((ss_item_sk#1905 = i_item_sk#1172) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && ((ss_store_sk#1910 = s_store_sk#1386) && (((d_year#1046 = 1999) || ((d_year#1046 = (1999 - 1)) && (d_moy#1048 = 12))) || ((d_year#1046 = (1999 + 1)) && (d_moy#1048 = 1)))))\n                        :  :                    +- Join Inner\n                        :  :                       :- Join Inner\n                        :  :                       :  :- Join Inner\n                        :  :                       :  :  :- SubqueryAlias item\n                        :  :                       :  :  :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :  :                       :  :  +- SubqueryAlias store_sales\n                        :  :                       :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :  :                       :  +- SubqueryAlias date_dim\n                        :  :                       :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :  :                       +- SubqueryAlias store\n                        :  :                          +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                        :  +- SubqueryAlias v1_lag\n                        :     +- SubqueryAlias v1\n                        :        +- Project [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203, d_moy#22205, sum_sales#22013, avg_monthly_sales#21919, rn#21824]\n                        :           +- Project [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203, d_moy#22205, sum_sales#22013, _w0#22014, avg_monthly_sales#21919, rn#21824, avg_monthly_sales#21919, rn#21824]\n                        :              +- Window [rank(d_year#22203, d_moy#22205) windowspecdefinition(i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203 ASC NULLS FIRST, d_moy#22205 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#21824], [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287], [d_year#22203 ASC NULLS FIRST, d_moy#22205 ASC NULLS FIRST]\n                        :                 +- Window [avg(_w0#22014) windowspecdefinition(i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#21919], [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203]\n                        :                    +- Aggregate [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203, d_moy#22205], [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203, d_moy#22205, sum(ss_sales_price#1916) AS sum_sales#22013, sum(ss_sales_price#1916) AS _w0#22014]\n                        :                       +- Filter (((ss_item_sk#1905 = i_item_sk#22106) && (ss_sold_date_sk#1926 = d_date_sk#22197)) && ((ss_store_sk#1910 = s_store_sk#22270) && (((d_year#22203 = 1999) || ((d_year#22203 = (1999 - 1)) && (d_moy#22205 = 12))) || ((d_year#22203 = (1999 + 1)) && (d_moy#22205 = 1)))))\n                        :                          +- Join Inner\n                        :                             :- Join Inner\n                        :                             :  :- Join Inner\n                        :                             :  :  :- SubqueryAlias item\n                        :                             :  :  :  +- Relation[i_item_sk#22106,i_item_id#22107,i_rec_start_date#22108,i_rec_end_date#22109,i_item_desc#22110,i_current_price#22111,i_wholesale_cost#22112,i_brand_id#22113,i_brand#22114,i_class_id#22115,i_class#22116,i_category_id#22117,i_category#22118,i_manufact_id#22119,i_manufact#22120,i_size#22121,i_formulation#22122,i_color#22123,i_units#22124,i_container#22125,i_manager_id#22126,i_product_name#22127] parquet\n                        :                             :  :  +- SubqueryAlias store_sales\n                        :                             :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :                             :  +- SubqueryAlias date_dim\n                        :                             :     +- Relation[d_date_sk#22197,d_date_id#22198,d_date#22199,d_month_seq#22200,d_week_seq#22201,d_quarter_seq#22202,d_year#22203,d_dow#22204,d_moy#22205,d_dom#22206,d_qoy#22207,d_fy_year#22208,d_fy_quarter_seq#22209,d_fy_week_seq#22210,d_day_name#22211,d_quarter_name#22212,d_holiday#22213,d_weekend#22214,d_following_holiday#22215,d_first_dom#22216,d_last_dom#22217,d_same_day_ly#22218,d_same_day_lq#22219,d_current_day#22220,... 4 more fields] parquet\n                        :                             +- SubqueryAlias store\n                        :                                +- Relation[s_store_sk#22270,s_store_id#22271,s_rec_start_date#22272,s_rec_end_date#22273,s_closed_date_sk#22274,s_store_name#22275,s_number_employees#22276,s_floor_space#22277,s_hours#22278,s_manager#22279,s_market_id#22280,s_geography_class#22281,s_market_desc#22282,s_market_manager#22283,s_division_id#22284,s_division_name#22285,s_company_id#22286,s_company_name#22287,s_street_number#22288,s_street_name#22289,s_street_type#22290,s_suite_number#22291,s_city#22292,s_county#22293,... 5 more fields] parquet\n                        +- SubqueryAlias v1_lead\n                           +- SubqueryAlias v1\n                              +- Project [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, d_year#22678, d_moy#22680, sum_sales#22488, avg_monthly_sales#22394, rn#22299]\n                                 +- Project [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, d_year#22678, d_moy#22680, sum_sales#22488, _w0#22489, avg_monthly_sales#22394, rn#22299, avg_monthly_sales#22394, rn#22299]\n                                    +- Window [rank(d_year#22678, d_moy#22680) windowspecdefinition(i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, d_year#22678 ASC NULLS FIRST, d_moy#22680 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#22299], [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762], [d_year#22678 ASC NULLS FIRST, d_moy#22680 ASC NULLS FIRST]\n                                       +- Window [avg(_w0#22489) windowspecdefinition(i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, d_year#22678, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#22394], [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, d_year#22678]\n                                          +- Aggregate [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, d_year#22678, d_moy#22680], [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, d_year#22678, d_moy#22680, sum(ss_sales_price#1916) AS sum_sales#22488, sum(ss_sales_price#1916) AS _w0#22489]\n                                             +- Filter (((ss_item_sk#1905 = i_item_sk#22581) && (ss_sold_date_sk#1926 = d_date_sk#22672)) && ((ss_store_sk#1910 = s_store_sk#22745) && (((d_year#22678 = 1999) || ((d_year#22678 = (1999 - 1)) && (d_moy#22680 = 12))) || ((d_year#22678 = (1999 + 1)) && (d_moy#22680 = 1)))))\n                                                +- Join Inner\n                                                   :- Join Inner\n                                                   :  :- Join Inner\n                                                   :  :  :- SubqueryAlias item\n                                                   :  :  :  +- Relation[i_item_sk#22581,i_item_id#22582,i_rec_start_date#22583,i_rec_end_date#22584,i_item_desc#22585,i_current_price#22586,i_wholesale_cost#22587,i_brand_id#22588,i_brand#22589,i_class_id#22590,i_class#22591,i_category_id#22592,i_category#22593,i_manufact_id#22594,i_manufact#22595,i_size#22596,i_formulation#22597,i_color#22598,i_units#22599,i_container#22600,i_manager_id#22601,i_product_name#22602] parquet\n                                                   :  :  +- SubqueryAlias store_sales\n                                                   :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                                   :  +- SubqueryAlias date_dim\n                                                   :     +- Relation[d_date_sk#22672,d_date_id#22673,d_date#22674,d_month_seq#22675,d_week_seq#22676,d_quarter_seq#22677,d_year#22678,d_dow#22679,d_moy#22680,d_dom#22681,d_qoy#22682,d_fy_year#22683,d_fy_quarter_seq#22684,d_fy_week_seq#22685,d_day_name#22686,d_quarter_name#22687,d_holiday#22688,d_weekend#22689,d_following_holiday#22690,d_first_dom#22691,d_last_dom#22692,d_same_day_ly#22693,d_same_day_lq#22694,d_current_day#22695,... 4 more fields] parquet\n                                                   +- SubqueryAlias store\n                                                      +- Relation[s_store_sk#22745,s_store_id#22746,s_rec_start_date#22747,s_rec_end_date#22748,s_closed_date_sk#22749,s_store_name#22750,s_number_employees#22751,s_floor_space#22752,s_hours#22753,s_manager#22754,s_market_id#22755,s_geography_class#22756,s_market_desc#22757,s_market_manager#22758,s_division_id#22759,s_division_name#22760,s_company_id#22761,s_company_name#22762,s_street_number#22763,s_street_name#22764,s_street_type#22765,s_suite_number#22766,s_city#22767,s_county#22768,... 5 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [CheckOverflow((promote_precision(cast(sum_sales#21801 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#21802 as decimal(22,6)))), DecimalType(22,6)) ASC NULLS FIRST, s_store_name#1391 ASC NULLS FIRST], true\n      +- Project [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, avg_monthly_sales#21802, sum_sales#21801, sum_sales#22013 AS psum#21804, sum_sales#22488 AS nsum#21805]\n         +- Join Inner, (((((i_category#1184 = i_category#22593) && (i_brand#1180 = i_brand#22589)) && (s_store_name#1391 = s_store_name#22750)) && (s_company_name#1403 = s_company_name#22762)) && (rn#21803 = (rn#22299 - 1)))\n            :- Project [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, sum_sales#21801, avg_monthly_sales#21802, rn#21803, sum_sales#22013]\n            :  +- Join Inner, (((((i_category#1184 = i_category#22118) && (i_brand#1180 = i_brand#22114)) && (s_store_name#1391 = s_store_name#22275)) && (s_company_name#1403 = s_company_name#22287)) && (rn#21803 = (rn#21824 + 1)))\n            :     :- Filter (((((isnotnull(d_year#1046) && isnotnull(avg_monthly_sales#21802)) && (d_year#1046 = 1999)) && (avg_monthly_sales#21802 > 0.000000)) && (CASE WHEN (avg_monthly_sales#21802 > 0.000000) THEN CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#21801 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#21802 as decimal(22,6)))), DecimalType(22,6)))) / promote_precision(cast(avg_monthly_sales#21802 as decimal(22,6)))), DecimalType(38,16)) ELSE null END > 0.1000000000000000)) && isnotnull(rn#21803))\n            :     :  +- Window [rank(d_year#1046, d_moy#1048) windowspecdefinition(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#21803], [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403], [d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST]\n            :     :     +- Project [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, sum_sales#21801, avg_monthly_sales#21802]\n            :     :        +- Window [avg(_w0#21819) windowspecdefinition(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#21802], [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046]\n            :     :           +- Aggregate [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048], [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS sum_sales#21801, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS _w0#21819]\n            :     :              +- Project [i_brand#1180, i_category#1184, ss_sales_price#1916, d_year#1046, d_moy#1048, s_store_name#1391, s_company_name#1403]\n            :     :                 +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n            :     :                    :- Project [i_brand#1180, i_category#1184, ss_store_sk#1910, ss_sales_price#1916, d_year#1046, d_moy#1048]\n            :     :                    :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :     :                    :     :- Project [i_brand#1180, i_category#1184, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n            :     :                    :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n            :     :                    :     :     :- Project [i_item_sk#1172, i_brand#1180, i_category#1184]\n            :     :                    :     :     :  +- Filter ((isnotnull(i_item_sk#1172) && isnotnull(i_brand#1180)) && isnotnull(i_category#1184))\n            :     :                    :     :     :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :     :                    :     :     +- Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n            :     :                    :     :        +- Filter ((isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_store_sk#1910))\n            :     :                    :     :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :                    :     +- Project [d_date_sk#1040, d_year#1046, d_moy#1048]\n            :     :                    :        +- Filter ((((d_year#1046 = 1999) || ((d_year#1046 = 1998) && (d_moy#1048 = 12))) || ((d_year#1046 = 2000) && (d_moy#1048 = 1))) && isnotnull(d_date_sk#1040))\n            :     :                    :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :                    +- Project [s_store_sk#1386, s_store_name#1391, s_company_name#1403]\n            :     :                       +- Filter ((isnotnull(s_store_sk#1386) && isnotnull(s_store_name#1391)) && isnotnull(s_company_name#1403))\n            :     :                          +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n            :     +- Project [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, sum_sales#22013, rn#21824]\n            :        +- Filter isnotnull(rn#21824)\n            :           +- Window [rank(d_year#22203, d_moy#22205) windowspecdefinition(i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203 ASC NULLS FIRST, d_moy#22205 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#21824], [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287], [d_year#22203 ASC NULLS FIRST, d_moy#22205 ASC NULLS FIRST]\n            :              +- Aggregate [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203, d_moy#22205], [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203, d_moy#22205, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS sum_sales#22013]\n            :                 +- Project [i_brand#22114, i_category#22118, ss_sales_price#1916, d_year#22203, d_moy#22205, s_store_name#22275, s_company_name#22287]\n            :                    +- Join Inner, (ss_store_sk#1910 = s_store_sk#22270)\n            :                       :- Project [i_brand#22114, i_category#22118, ss_store_sk#1910, ss_sales_price#1916, d_year#22203, d_moy#22205]\n            :                       :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#22197)\n            :                       :     :- Project [i_brand#22114, i_category#22118, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n            :                       :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#22106)\n            :                       :     :     :- Project [i_item_sk#22106, i_brand#22114, i_category#22118]\n            :                       :     :     :  +- Filter ((isnotnull(i_item_sk#22106) && isnotnull(i_brand#22114)) && isnotnull(i_category#22118))\n            :                       :     :     :     +- Relation[i_item_sk#22106,i_item_id#22107,i_rec_start_date#22108,i_rec_end_date#22109,i_item_desc#22110,i_current_price#22111,i_wholesale_cost#22112,i_brand_id#22113,i_brand#22114,i_class_id#22115,i_class#22116,i_category_id#22117,i_category#22118,i_manufact_id#22119,i_manufact#22120,i_size#22121,i_formulation#22122,i_color#22123,i_units#22124,i_container#22125,i_manager_id#22126,i_product_name#22127] parquet\n            :                       :     :     +- Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n            :                       :     :        +- Filter ((isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_store_sk#1910))\n            :                       :     :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :                       :     +- Project [d_date_sk#22197, d_year#22203, d_moy#22205]\n            :                       :        +- Filter ((((d_year#22203 = 1999) || ((d_year#22203 = 1998) && (d_moy#22205 = 12))) || ((d_year#22203 = 2000) && (d_moy#22205 = 1))) && isnotnull(d_date_sk#22197))\n            :                       :           +- Relation[d_date_sk#22197,d_date_id#22198,d_date#22199,d_month_seq#22200,d_week_seq#22201,d_quarter_seq#22202,d_year#22203,d_dow#22204,d_moy#22205,d_dom#22206,d_qoy#22207,d_fy_year#22208,d_fy_quarter_seq#22209,d_fy_week_seq#22210,d_day_name#22211,d_quarter_name#22212,d_holiday#22213,d_weekend#22214,d_following_holiday#22215,d_first_dom#22216,d_last_dom#22217,d_same_day_ly#22218,d_same_day_lq#22219,d_current_day#22220,... 4 more fields] parquet\n            :                       +- Project [s_store_sk#22270, s_store_name#22275, s_company_name#22287]\n            :                          +- Filter ((isnotnull(s_store_sk#22270) && isnotnull(s_store_name#22275)) && isnotnull(s_company_name#22287))\n            :                             +- Relation[s_store_sk#22270,s_store_id#22271,s_rec_start_date#22272,s_rec_end_date#22273,s_closed_date_sk#22274,s_store_name#22275,s_number_employees#22276,s_floor_space#22277,s_hours#22278,s_manager#22279,s_market_id#22280,s_geography_class#22281,s_market_desc#22282,s_market_manager#22283,s_division_id#22284,s_division_name#22285,s_company_id#22286,s_company_name#22287,s_street_number#22288,s_street_name#22289,s_street_type#22290,s_suite_number#22291,s_city#22292,s_county#22293,... 5 more fields] parquet\n            +- Project [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, sum_sales#22488, rn#22299]\n               +- Filter isnotnull(rn#22299)\n                  +- Window [rank(d_year#22678, d_moy#22680) windowspecdefinition(i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, d_year#22678 ASC NULLS FIRST, d_moy#22680 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#22299], [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762], [d_year#22678 ASC NULLS FIRST, d_moy#22680 ASC NULLS FIRST]\n                     +- Aggregate [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, d_year#22678, d_moy#22680], [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, d_year#22678, d_moy#22680, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS sum_sales#22488]\n                        +- Project [i_brand#22589, i_category#22593, ss_sales_price#1916, d_year#22678, d_moy#22680, s_store_name#22750, s_company_name#22762]\n                           +- Join Inner, (ss_store_sk#1910 = s_store_sk#22745)\n                              :- Project [i_brand#22589, i_category#22593, ss_store_sk#1910, ss_sales_price#1916, d_year#22678, d_moy#22680]\n                              :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#22672)\n                              :     :- Project [i_brand#22589, i_category#22593, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                              :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#22581)\n                              :     :     :- Project [i_item_sk#22581, i_brand#22589, i_category#22593]\n                              :     :     :  +- Filter ((isnotnull(i_item_sk#22581) && isnotnull(i_category#22593)) && isnotnull(i_brand#22589))\n                              :     :     :     +- Relation[i_item_sk#22581,i_item_id#22582,i_rec_start_date#22583,i_rec_end_date#22584,i_item_desc#22585,i_current_price#22586,i_wholesale_cost#22587,i_brand_id#22588,i_brand#22589,i_class_id#22590,i_class#22591,i_category_id#22592,i_category#22593,i_manufact_id#22594,i_manufact#22595,i_size#22596,i_formulation#22597,i_color#22598,i_units#22599,i_container#22600,i_manager_id#22601,i_product_name#22602] parquet\n                              :     :     +- Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                              :     :        +- Filter ((isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_store_sk#1910))\n                              :     :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                              :     +- Project [d_date_sk#22672, d_year#22678, d_moy#22680]\n                              :        +- Filter ((((d_year#22678 = 1999) || ((d_year#22678 = 1998) && (d_moy#22680 = 12))) || ((d_year#22678 = 2000) && (d_moy#22680 = 1))) && isnotnull(d_date_sk#22672))\n                              :           +- Relation[d_date_sk#22672,d_date_id#22673,d_date#22674,d_month_seq#22675,d_week_seq#22676,d_quarter_seq#22677,d_year#22678,d_dow#22679,d_moy#22680,d_dom#22681,d_qoy#22682,d_fy_year#22683,d_fy_quarter_seq#22684,d_fy_week_seq#22685,d_day_name#22686,d_quarter_name#22687,d_holiday#22688,d_weekend#22689,d_following_holiday#22690,d_first_dom#22691,d_last_dom#22692,d_same_day_ly#22693,d_same_day_lq#22694,d_current_day#22695,... 4 more fields] parquet\n                              +- Project [s_store_sk#22745, s_store_name#22750, s_company_name#22762]\n                                 +- Filter ((isnotnull(s_store_sk#22745) && isnotnull(s_store_name#22750)) && isnotnull(s_company_name#22762))\n                                    +- Relation[s_store_sk#22745,s_store_id#22746,s_rec_start_date#22747,s_rec_end_date#22748,s_closed_date_sk#22749,s_store_name#22750,s_number_employees#22751,s_floor_space#22752,s_hours#22753,s_manager#22754,s_market_id#22755,s_geography_class#22756,s_market_desc#22757,s_market_manager#22758,s_division_id#22759,s_division_name#22760,s_company_id#22761,s_company_name#22762,s_street_number#22763,s_street_name#22764,s_street_type#22765,s_suite_number#22766,s_city#22767,s_county#22768,... 5 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[CheckOverflow((promote_precision(cast(sum_sales#21801 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#21802 as decimal(22,6)))), DecimalType(22,6)) ASC NULLS FIRST,s_store_name#1391 ASC NULLS FIRST], output=[i_category#1184,i_brand#1180,s_store_name#1391,s_company_name#1403,d_year#1046,d_moy#1048,avg_monthly_sales#21802,sum_sales#21801,psum#21804,nsum#21805])\n+- *(28) Project [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, avg_monthly_sales#21802, sum_sales#21801, sum_sales#22013 AS psum#21804, sum_sales#22488 AS nsum#21805]\n   +- *(28) SortMergeJoin [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, rn#21803], [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, (rn#22299 - 1)], Inner\n      :- *(19) Project [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, sum_sales#21801, avg_monthly_sales#21802, rn#21803, sum_sales#22013]\n      :  +- *(19) SortMergeJoin [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, rn#21803], [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, (rn#21824 + 1)], Inner\n      :     :- *(10) Sort [i_category#1184 ASC NULLS FIRST, i_brand#1180 ASC NULLS FIRST, s_store_name#1391 ASC NULLS FIRST, s_company_name#1403 ASC NULLS FIRST, rn#21803 ASC NULLS FIRST], false, 0\n      :     :  +- Exchange hashpartitioning(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, rn#21803, 200)\n      :     :     +- *(9) Filter (((((isnotnull(d_year#1046) && isnotnull(avg_monthly_sales#21802)) && (d_year#1046 = 1999)) && (avg_monthly_sales#21802 > 0.000000)) && (CASE WHEN (avg_monthly_sales#21802 > 0.000000) THEN CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#21801 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#21802 as decimal(22,6)))), DecimalType(22,6)))) / promote_precision(cast(avg_monthly_sales#21802 as decimal(22,6)))), DecimalType(38,16)) ELSE null END > 0.1000000000000000)) && isnotnull(rn#21803))\n      :     :        +- Window [rank(d_year#1046, d_moy#1048) windowspecdefinition(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#21803], [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403], [d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST]\n      :     :           +- *(8) Sort [i_category#1184 ASC NULLS FIRST, i_brand#1180 ASC NULLS FIRST, s_store_name#1391 ASC NULLS FIRST, s_company_name#1403 ASC NULLS FIRST, d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST], false, 0\n      :     :              +- Exchange hashpartitioning(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, 200)\n      :     :                 +- *(7) Project [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, sum_sales#21801, avg_monthly_sales#21802]\n      :     :                    +- Window [avg(_w0#21819) windowspecdefinition(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#21802], [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046]\n      :     :                       +- *(6) Sort [i_category#1184 ASC NULLS FIRST, i_brand#1180 ASC NULLS FIRST, s_store_name#1391 ASC NULLS FIRST, s_company_name#1403 ASC NULLS FIRST, d_year#1046 ASC NULLS FIRST], false, 0\n      :     :                          +- Exchange hashpartitioning(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, 200)\n      :     :                             +- *(5) HashAggregate(keys=[i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048], functions=[sum(UnscaledValue(ss_sales_price#1916))], output=[i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, sum_sales#21801, _w0#21819])\n      :     :                                +- Exchange hashpartitioning(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, 200)\n      :     :                                   +- *(4) HashAggregate(keys=[i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048], functions=[partial_sum(UnscaledValue(ss_sales_price#1916))], output=[i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, sum#22881L])\n      :     :                                      +- *(4) Project [i_brand#1180, i_category#1184, ss_sales_price#1916, d_year#1046, d_moy#1048, s_store_name#1391, s_company_name#1403]\n      :     :                                         +- *(4) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n      :     :                                            :- *(4) Project [i_brand#1180, i_category#1184, ss_store_sk#1910, ss_sales_price#1916, d_year#1046, d_moy#1048]\n      :     :                                            :  +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :     :                                            :     :- *(4) Project [i_brand#1180, i_category#1184, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n      :     :                                            :     :  +- *(4) BroadcastHashJoin [i_item_sk#1172], [ss_item_sk#1905], Inner, BuildLeft\n      :     :                                            :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                                            :     :     :  +- *(1) Project [i_item_sk#1172, i_brand#1180, i_category#1184]\n      :     :                                            :     :     :     +- *(1) Filter ((isnotnull(i_item_sk#1172) && isnotnull(i_brand#1180)) && isnotnull(i_category#1184))\n      :     :                                            :     :     :        +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand#1180,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand), IsNotNull(i_category)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>\n      :     :                                            :     :     +- *(4) Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n      :     :                                            :     :        +- *(4) Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_store_sk#1910))\n      :     :                                            :     :           +- *(4) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_store_sk#1910,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>\n      :     :                                            :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                                            :        +- *(2) Project [d_date_sk#1040, d_year#1046, d_moy#1048]\n      :     :                                            :           +- *(2) Filter ((((d_year#1046 = 1999) || ((d_year#1046 = 1998) && (d_moy#1048 = 12))) || ((d_year#1046 = 2000) && (d_moy#1048 = 1))) && isnotnull(d_date_sk#1040))\n      :     :                                            :              +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,1999),And(EqualTo(d_year,1998),EqualTo(d_moy,12))),And(EqualTo(d_year,2000)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n      :     :                                            +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                                               +- *(3) Project [s_store_sk#1386, s_store_name#1391, s_company_name#1403]\n      :     :                                                  +- *(3) Filter ((isnotnull(s_store_sk#1386) && isnotnull(s_store_name#1391)) && isnotnull(s_company_name#1403))\n      :     :                                                     +- *(3) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_name#1391,s_company_name#1403] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>\n      :     +- *(18) Sort [i_category#22118 ASC NULLS FIRST, i_brand#22114 ASC NULLS FIRST, s_store_name#22275 ASC NULLS FIRST, s_company_name#22287 ASC NULLS FIRST, (rn#21824 + 1) ASC NULLS FIRST], false, 0\n      :        +- Exchange hashpartitioning(i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, (rn#21824 + 1), 200)\n      :           +- *(17) Project [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, sum_sales#22013, rn#21824]\n      :              +- *(17) Filter isnotnull(rn#21824)\n      :                 +- Window [rank(d_year#22203, d_moy#22205) windowspecdefinition(i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203 ASC NULLS FIRST, d_moy#22205 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#21824], [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287], [d_year#22203 ASC NULLS FIRST, d_moy#22205 ASC NULLS FIRST]\n      :                    +- *(16) Sort [i_category#22118 ASC NULLS FIRST, i_brand#22114 ASC NULLS FIRST, s_store_name#22275 ASC NULLS FIRST, s_company_name#22287 ASC NULLS FIRST, d_year#22203 ASC NULLS FIRST, d_moy#22205 ASC NULLS FIRST], false, 0\n      :                       +- Exchange hashpartitioning(i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, 200)\n      :                          +- *(15) HashAggregate(keys=[i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203, d_moy#22205], functions=[sum(UnscaledValue(ss_sales_price#1916))], output=[i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203, d_moy#22205, sum_sales#22013])\n      :                             +- ReusedExchange [i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, d_year#22203, d_moy#22205, sum#22883L], Exchange hashpartitioning(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, d_year#1046, d_moy#1048, 200)\n      +- *(27) Sort [i_category#22593 ASC NULLS FIRST, i_brand#22589 ASC NULLS FIRST, s_store_name#22750 ASC NULLS FIRST, s_company_name#22762 ASC NULLS FIRST, (rn#22299 - 1) ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, (rn#22299 - 1), 200)\n            +- *(26) Project [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, sum_sales#22488, rn#22299]\n               +- *(26) Filter isnotnull(rn#22299)\n                  +- Window [rank(d_year#22678, d_moy#22680) windowspecdefinition(i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, d_year#22678 ASC NULLS FIRST, d_moy#22680 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#22299], [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762], [d_year#22678 ASC NULLS FIRST, d_moy#22680 ASC NULLS FIRST]\n                     +- *(25) Sort [i_category#22593 ASC NULLS FIRST, i_brand#22589 ASC NULLS FIRST, s_store_name#22750 ASC NULLS FIRST, s_company_name#22762 ASC NULLS FIRST, d_year#22678 ASC NULLS FIRST, d_moy#22680 ASC NULLS FIRST], false, 0\n                        +- ReusedExchange [i_category#22593, i_brand#22589, s_store_name#22750, s_company_name#22762, d_year#22678, d_moy#22680, sum_sales#22488], Exchange hashpartitioning(i_category#22118, i_brand#22114, s_store_name#22275, s_company_name#22287, 200)"},{"name":"q48-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","store","customer_demographics","customer_address","date_dim"],"parsingTime":0.003945,"analysisTime":0.001487,"optimizationTime":285.469885,"planningTime":11.424742,"executionTime":4298.28822,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'Project [unresolvedalias('sum('ss_quantity), None)]\n+- 'Filter (((('s_store_sk = 'ss_store_sk) && ('ss_sold_date_sk = 'd_date_sk)) && ('d_year = 2000)) && (((((('cd_demo_sk = 'ss_cdemo_sk) && ('cd_marital_status = M)) && (('cd_education_status = 4 yr Degree) && (('ss_sales_price >= 100.00) && ('ss_sales_price <= 150.00)))) || ((('cd_demo_sk = 'ss_cdemo_sk) && ('cd_marital_status = D)) && (('cd_education_status = 2 yr Degree) && (('ss_sales_price >= 50.00) && ('ss_sales_price <= 100.00))))) || ((('cd_demo_sk = 'ss_cdemo_sk) && ('cd_marital_status = S)) && (('cd_education_status = College) && (('ss_sales_price >= 150.00) && ('ss_sales_price <= 200.00))))) && ((((('ss_addr_sk = 'ca_address_sk) && ('ca_country = United States)) && ('ca_state IN (CO,OH,TX) && (('ss_net_profit >= 0) && ('ss_net_profit <= 2000)))) || ((('ss_addr_sk = 'ca_address_sk) && ('ca_country = United States)) && ('ca_state IN (OR,MN,KY) && (('ss_net_profit >= 150) && ('ss_net_profit <= 3000))))) || ((('ss_addr_sk = 'ca_address_sk) && ('ca_country = United States)) && ('ca_state IN (VA,CA,MS) && (('ss_net_profit >= 50) && ('ss_net_profit <= 25000)))))))\n   +- 'Join Inner\n      :- 'Join Inner\n      :  :- 'Join Inner\n      :  :  :- 'Join Inner\n      :  :  :  :- 'UnresolvedRelation `store_sales`\n      :  :  :  +- 'UnresolvedRelation `store`\n      :  :  +- 'UnresolvedRelation `customer_demographics`\n      :  +- 'UnresolvedRelation `customer_address`\n      +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nsum(ss_quantity): bigint\nAggregate [sum(cast(ss_quantity#1913 as bigint)) AS sum(ss_quantity)#24393L]\n+- Filter ((((s_store_sk#1386 = ss_store_sk#1910) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && (d_year#1046 = 2000)) && ((((((cd_demo_sk#966 = ss_cdemo_sk#1907) && (cd_marital_status#968 = M)) && ((cd_education_status#969 = 4 yr Degree) && ((cast(ss_sales_price#1916 as decimal(7,2)) >= cast(100.00 as decimal(7,2))) && (cast(ss_sales_price#1916 as decimal(7,2)) <= cast(150.00 as decimal(7,2)))))) || (((cd_demo_sk#966 = ss_cdemo_sk#1907) && (cd_marital_status#968 = D)) && ((cd_education_status#969 = 2 yr Degree) && ((cast(ss_sales_price#1916 as decimal(7,2)) >= cast(50.00 as decimal(7,2))) && (cast(ss_sales_price#1916 as decimal(7,2)) <= cast(100.00 as decimal(7,2))))))) || (((cd_demo_sk#966 = ss_cdemo_sk#1907) && (cd_marital_status#968 = S)) && ((cd_education_status#969 = College) && ((cast(ss_sales_price#1916 as decimal(7,2)) >= cast(150.00 as decimal(7,2))) && (cast(ss_sales_price#1916 as decimal(7,2)) <= cast(200.00 as decimal(7,2))))))) && (((((ss_addr_sk#1909 = ca_address_sk#922) && (ca_country#932 = United States)) && (ca_state#930 IN (CO,OH,TX) && ((cast(ss_net_profit#1925 as decimal(7,2)) >= cast(cast(0 as decimal(1,0)) as decimal(7,2))) && (cast(ss_net_profit#1925 as decimal(7,2)) <= cast(cast(2000 as decimal(4,0)) as decimal(7,2)))))) || (((ss_addr_sk#1909 = ca_address_sk#922) && (ca_country#932 = United States)) && (ca_state#930 IN (OR,MN,KY) && ((cast(ss_net_profit#1925 as decimal(7,2)) >= cast(cast(150 as decimal(3,0)) as decimal(7,2))) && (cast(ss_net_profit#1925 as decimal(7,2)) <= cast(cast(3000 as decimal(4,0)) as decimal(7,2))))))) || (((ss_addr_sk#1909 = ca_address_sk#922) && (ca_country#932 = United States)) && (ca_state#930 IN (VA,CA,MS) && ((cast(ss_net_profit#1925 as decimal(7,2)) >= cast(cast(50 as decimal(2,0)) as decimal(7,2))) && (cast(ss_net_profit#1925 as decimal(7,2)) <= cast(cast(25000 as decimal(5,0)) as decimal(7,2)))))))))\n   +- Join Inner\n      :- Join Inner\n      :  :- Join Inner\n      :  :  :- Join Inner\n      :  :  :  :- SubqueryAlias store_sales\n      :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :  :  :  +- SubqueryAlias store\n      :  :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n      :  :  +- SubqueryAlias customer_demographics\n      :  :     +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n      :  +- SubqueryAlias customer_address\n      :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n      +- SubqueryAlias date_dim\n         +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nAggregate [sum(cast(ss_quantity#1913 as bigint)) AS sum(ss_quantity)#24393L]\n+- Project [ss_quantity#1913]\n   +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n      :- Project [ss_quantity#1913, ss_sold_date_sk#1926]\n      :  +- Join Inner, ((ss_addr_sk#1909 = ca_address_sk#922) && ((((ca_state#930 IN (CO,OH,TX) && (ss_net_profit#1925 >= 0.00)) && (ss_net_profit#1925 <= 2000.00)) || ((ca_state#930 IN (OR,MN,KY) && (ss_net_profit#1925 >= 150.00)) && (ss_net_profit#1925 <= 3000.00))) || ((ca_state#930 IN (VA,CA,MS) && (ss_net_profit#1925 >= 50.00)) && (ss_net_profit#1925 <= 25000.00))))\n      :     :- Project [ss_addr_sk#1909, ss_quantity#1913, ss_net_profit#1925, ss_sold_date_sk#1926]\n      :     :  +- Join Inner, ((cd_demo_sk#966 = ss_cdemo_sk#1907) && ((((((cd_marital_status#968 = M) && (cd_education_status#969 = 4 yr Degree)) && (ss_sales_price#1916 >= 100.00)) && (ss_sales_price#1916 <= 150.00)) || ((((cd_marital_status#968 = D) && (cd_education_status#969 = 2 yr Degree)) && (ss_sales_price#1916 >= 50.00)) && (ss_sales_price#1916 <= 100.00))) || ((((cd_marital_status#968 = S) && (cd_education_status#969 = College)) && (ss_sales_price#1916 >= 150.00)) && (ss_sales_price#1916 <= 200.00))))\n      :     :     :- Project [ss_cdemo_sk#1907, ss_addr_sk#1909, ss_quantity#1913, ss_sales_price#1916, ss_net_profit#1925, ss_sold_date_sk#1926]\n      :     :     :  +- Join Inner, (s_store_sk#1386 = ss_store_sk#1910)\n      :     :     :     :- Project [ss_cdemo_sk#1907, ss_addr_sk#1909, ss_store_sk#1910, ss_quantity#1913, ss_sales_price#1916, ss_net_profit#1925, ss_sold_date_sk#1926]\n      :     :     :     :  +- Filter (((isnotnull(ss_store_sk#1910) && isnotnull(ss_cdemo_sk#1907)) && isnotnull(ss_addr_sk#1909)) && isnotnull(ss_sold_date_sk#1926))\n      :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :     :     :     +- Project [s_store_sk#1386]\n      :     :     :        +- Filter isnotnull(s_store_sk#1386)\n      :     :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n      :     :     +- Project [cd_demo_sk#966, cd_marital_status#968, cd_education_status#969]\n      :     :        +- Filter isnotnull(cd_demo_sk#966)\n      :     :           +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n      :     +- Project [ca_address_sk#922, ca_state#930]\n      :        +- Filter ((isnotnull(ca_country#932) && (ca_country#932 = United States)) && isnotnull(ca_address_sk#922))\n      :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n      +- Project [d_date_sk#1040]\n         +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n            +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\n*(6) HashAggregate(keys=[], functions=[sum(cast(ss_quantity#1913 as bigint))], output=[sum(ss_quantity)#24393L])\n+- Exchange SinglePartition\n   +- *(5) HashAggregate(keys=[], functions=[partial_sum(cast(ss_quantity#1913 as bigint))], output=[sum#24396L])\n      +- *(5) Project [ss_quantity#1913]\n         +- *(5) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n            :- *(5) Project [ss_quantity#1913, ss_sold_date_sk#1926]\n            :  +- *(5) BroadcastHashJoin [ss_addr_sk#1909], [ca_address_sk#922], Inner, BuildRight, ((((ca_state#930 IN (CO,OH,TX) && (ss_net_profit#1925 >= 0.00)) && (ss_net_profit#1925 <= 2000.00)) || ((ca_state#930 IN (OR,MN,KY) && (ss_net_profit#1925 >= 150.00)) && (ss_net_profit#1925 <= 3000.00))) || ((ca_state#930 IN (VA,CA,MS) && (ss_net_profit#1925 >= 50.00)) && (ss_net_profit#1925 <= 25000.00)))\n            :     :- *(5) Project [ss_addr_sk#1909, ss_quantity#1913, ss_net_profit#1925, ss_sold_date_sk#1926]\n            :     :  +- *(5) BroadcastHashJoin [ss_cdemo_sk#1907], [cd_demo_sk#966], Inner, BuildRight, ((((((cd_marital_status#968 = M) && (cd_education_status#969 = 4 yr Degree)) && (ss_sales_price#1916 >= 100.00)) && (ss_sales_price#1916 <= 150.00)) || ((((cd_marital_status#968 = D) && (cd_education_status#969 = 2 yr Degree)) && (ss_sales_price#1916 >= 50.00)) && (ss_sales_price#1916 <= 100.00))) || ((((cd_marital_status#968 = S) && (cd_education_status#969 = College)) && (ss_sales_price#1916 >= 150.00)) && (ss_sales_price#1916 <= 200.00)))\n            :     :     :- *(5) Project [ss_cdemo_sk#1907, ss_addr_sk#1909, ss_quantity#1913, ss_sales_price#1916, ss_net_profit#1925, ss_sold_date_sk#1926]\n            :     :     :  +- *(5) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n            :     :     :     :- *(5) Project [ss_cdemo_sk#1907, ss_addr_sk#1909, ss_store_sk#1910, ss_quantity#1913, ss_sales_price#1916, ss_net_profit#1925, ss_sold_date_sk#1926]\n            :     :     :     :  +- *(5) Filter ((isnotnull(ss_store_sk#1910) && isnotnull(ss_cdemo_sk#1907)) && isnotnull(ss_addr_sk#1909))\n            :     :     :     :     +- *(5) FileScan parquet db_tpcds.store_sales[ss_cdemo_sk#1907,ss_addr_sk#1909,ss_store_sk#1910,ss_quantity#1913,ss_sales_price#1916,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_cdemo_sk), IsNotNull(ss_addr_sk)], ReadSchema: struct<ss_cdemo_sk:int,ss_addr_sk:int,ss_store_sk:int,ss_quantity:int,ss_sales_price:decimal(7,2)...\n            :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :     :     :        +- *(1) Project [s_store_sk#1386]\n            :     :     :           +- *(1) Filter isnotnull(s_store_sk#1386)\n            :     :     :              +- *(1) FileScan parquet db_tpcds.store[s_store_sk#1386] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int>\n            :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :     :        +- *(2) Project [cd_demo_sk#966, cd_marital_status#968, cd_education_status#969]\n            :     :           +- *(2) Filter isnotnull(cd_demo_sk#966)\n            :     :              +- *(2) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_marital_status#968,cd_education_status#969] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:int,cd_marital_status:string,cd_education_status:string>\n            :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :        +- *(3) Project [ca_address_sk#922, ca_state#930]\n            :           +- *(3) Filter ((isnotnull(ca_country#932) && (ca_country#932 = United States)) && isnotnull(ca_address_sk#922))\n            :              +- *(3) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930,ca_country#932] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_country), EqualTo(ca_country,United States), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string,ca_country:string>\n            +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               +- *(4) Project [d_date_sk#1040]\n                  +- *(4) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n                     +- *(4) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>"},{"name":"q49-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","SortMergeJoin"],"tables":["web_sales","web_returns","date_dim","catalog_sales","catalog_returns","date_dim","store_sales","store_returns","date_dim"],"parsingTime":0.002075,"analysisTime":0.001191,"optimizationTime":984.799604,"planningTime":1916.366241,"executionTime":14492.107659,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort [1 ASC NULLS FIRST, 4 ASC NULLS FIRST, 5 ASC NULLS FIRST], true\n      +- 'Distinct\n         +- 'Union\n            :- 'Distinct\n            :  +- 'Union\n            :     :- 'Project [web AS channel#24555, 'web.item, 'web.return_ratio, 'web.return_rank, 'web.currency_rank]\n            :     :  +- 'Filter (('web.return_rank <= 10) || ('web.currency_rank <= 10))\n            :     :     +- 'SubqueryAlias web\n            :     :        +- 'Project ['item, 'return_ratio, 'currency_ratio, 'rank() windowspecdefinition('return_ratio ASC NULLS FIRST, unspecifiedframe$()) AS return_rank#24553, 'rank() windowspecdefinition('currency_ratio ASC NULLS FIRST, unspecifiedframe$()) AS currency_rank#24554]\n            :     :           +- 'SubqueryAlias in_web\n            :     :              +- 'Aggregate ['ws.ws_item_sk], ['ws.ws_item_sk AS item#24550, (cast('sum('coalesce('wr.wr_return_quantity, 0)) as decimal(15,4)) / cast('sum('coalesce('ws.ws_quantity, 0)) as decimal(15,4))) AS return_ratio#24551, (cast('sum('coalesce('wr.wr_return_amt, 0)) as decimal(15,4)) / cast('sum('coalesce('ws.ws_net_paid, 0)) as decimal(15,4))) AS currency_ratio#24552]\n            :     :                 +- 'Filter (((('wr.wr_return_amt > 10000) && ('ws.ws_net_profit > 1)) && (('ws.ws_net_paid > 0) && ('ws.ws_quantity > 0))) && ((('ws_sold_date_sk = 'd_date_sk) && ('d_year = 2001)) && ('d_moy = 12)))\n            :     :                    +- 'Join Inner\n            :     :                       :- 'Join LeftOuter, (('ws.ws_order_number = 'wr.wr_order_number) && ('ws.ws_item_sk = 'wr.wr_item_sk))\n            :     :                       :  :- 'SubqueryAlias ws\n            :     :                       :  :  +- 'UnresolvedRelation `web_sales`\n            :     :                       :  +- 'SubqueryAlias wr\n            :     :                       :     +- 'UnresolvedRelation `web_returns`\n            :     :                       +- 'UnresolvedRelation `date_dim`\n            :     +- 'Project [catalog AS channel#24561, 'catalog.item, 'catalog.return_ratio, 'catalog.return_rank, 'catalog.currency_rank]\n            :        +- 'Filter (('catalog.return_rank <= 10) || ('catalog.currency_rank <= 10))\n            :           +- 'SubqueryAlias catalog\n            :              +- 'Project ['item, 'return_ratio, 'currency_ratio, 'rank() windowspecdefinition('return_ratio ASC NULLS FIRST, unspecifiedframe$()) AS return_rank#24559, 'rank() windowspecdefinition('currency_ratio ASC NULLS FIRST, unspecifiedframe$()) AS currency_rank#24560]\n            :                 +- 'SubqueryAlias in_cat\n            :                    +- 'Aggregate ['cs.cs_item_sk], ['cs.cs_item_sk AS item#24556, (cast('sum('coalesce('cr.cr_return_quantity, 0)) as decimal(15,4)) / cast('sum('coalesce('cs.cs_quantity, 0)) as decimal(15,4))) AS return_ratio#24557, (cast('sum('coalesce('cr.cr_return_amount, 0)) as decimal(15,4)) / cast('sum('coalesce('cs.cs_net_paid, 0)) as decimal(15,4))) AS currency_ratio#24558]\n            :                       +- 'Filter (((('cr.cr_return_amount > 10000) && ('cs.cs_net_profit > 1)) && (('cs.cs_net_paid > 0) && ('cs.cs_quantity > 0))) && ((('cs_sold_date_sk = 'd_date_sk) && ('d_year = 2001)) && ('d_moy = 12)))\n            :                          +- 'Join Inner\n            :                             :- 'Join LeftOuter, (('cs.cs_order_number = 'cr.cr_order_number) && ('cs.cs_item_sk = 'cr.cr_item_sk))\n            :                             :  :- 'SubqueryAlias cs\n            :                             :  :  +- 'UnresolvedRelation `catalog_sales`\n            :                             :  +- 'SubqueryAlias cr\n            :                             :     +- 'UnresolvedRelation `catalog_returns`\n            :                             +- 'UnresolvedRelation `date_dim`\n            +- 'Project [store AS channel#24567, 'store.item, 'store.return_ratio, 'store.return_rank, 'store.currency_rank]\n               +- 'Filter (('store.return_rank <= 10) || ('store.currency_rank <= 10))\n                  +- 'SubqueryAlias store\n                     +- 'Project ['item, 'return_ratio, 'currency_ratio, 'rank() windowspecdefinition('return_ratio ASC NULLS FIRST, unspecifiedframe$()) AS return_rank#24565, 'rank() windowspecdefinition('currency_ratio ASC NULLS FIRST, unspecifiedframe$()) AS currency_rank#24566]\n                        +- 'SubqueryAlias in_store\n                           +- 'Aggregate ['sts.ss_item_sk], ['sts.ss_item_sk AS item#24562, (cast('sum('coalesce('sr.sr_return_quantity, 0)) as decimal(15,4)) / cast('sum('coalesce('sts.ss_quantity, 0)) as decimal(15,4))) AS return_ratio#24563, (cast('sum('coalesce('sr.sr_return_amt, 0)) as decimal(15,4)) / cast('sum('coalesce('sts.ss_net_paid, 0)) as decimal(15,4))) AS currency_ratio#24564]\n                              +- 'Filter (((('sr.sr_return_amt > 10000) && ('sts.ss_net_profit > 1)) && (('sts.ss_net_paid > 0) && ('sts.ss_quantity > 0))) && ((('ss_sold_date_sk = 'd_date_sk) && ('d_year = 2001)) && ('d_moy = 12)))\n                                 +- 'Join Inner\n                                    :- 'Join LeftOuter, (('sts.ss_ticket_number = 'sr.sr_ticket_number) && ('sts.ss_item_sk = 'sr.sr_item_sk))\n                                    :  :- 'SubqueryAlias sts\n                                    :  :  +- 'UnresolvedRelation `store_sales`\n                                    :  +- 'SubqueryAlias sr\n                                    :     +- 'UnresolvedRelation `store_returns`\n                                    +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nchannel: string, item: int, return_ratio: decimal(35,20), return_rank: int, currency_rank: int\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#24555 ASC NULLS FIRST, return_rank#24553 ASC NULLS FIRST, currency_rank#24554 ASC NULLS FIRST], true\n      +- Distinct\n         +- Union\n            :- Distinct\n            :  +- Union\n            :     :- Project [web AS channel#24555, item#24550, return_ratio#24551, return_rank#24553, currency_rank#24554]\n            :     :  +- Filter ((return_rank#24553 <= 10) || (currency_rank#24554 <= 10))\n            :     :     +- SubqueryAlias web\n            :     :        +- Project [item#24550, return_ratio#24551, currency_ratio#24552, return_rank#24553, currency_rank#24554]\n            :     :           +- Project [item#24550, return_ratio#24551, currency_ratio#24552, return_rank#24553, currency_rank#24554, return_rank#24553, currency_rank#24554]\n            :     :              +- Window [rank(currency_ratio#24552) windowspecdefinition(currency_ratio#24552 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#24554], [currency_ratio#24552 ASC NULLS FIRST]\n            :     :                 +- Window [rank(return_ratio#24551) windowspecdefinition(return_ratio#24551 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#24553], [return_ratio#24551 ASC NULLS FIRST]\n            :     :                    +- Project [item#24550, return_ratio#24551, currency_ratio#24552]\n            :     :                       +- SubqueryAlias in_web\n            :     :                          +- Aggregate [ws_item_sk#1757], [ws_item_sk#1757 AS item#24550, CheckOverflow((promote_precision(cast(cast(sum(cast(coalesce(wr_return_quantity#2130, 0) as bigint)) as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(sum(cast(coalesce(ws_quantity#1772, 0) as bigint)) as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20)) AS return_ratio#24551, CheckOverflow((promote_precision(cast(cast(sum(coalesce(cast(wr_return_amt#2131 as decimal(12,2)), cast(0 as decimal(12,2)))) as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(sum(coalesce(cast(ws_net_paid#1783 as decimal(12,2)), cast(0 as decimal(12,2)))) as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20)) AS currency_ratio#24552]\n            :     :                             +- Filter ((((cast(wr_return_amt#2131 as decimal(7,2)) > cast(cast(10000 as decimal(5,0)) as decimal(7,2))) && (cast(ws_net_profit#1787 as decimal(7,2)) > cast(cast(1 as decimal(1,0)) as decimal(7,2)))) && ((cast(ws_net_paid#1783 as decimal(7,2)) > cast(cast(0 as decimal(1,0)) as decimal(7,2))) && (ws_quantity#1772 > 0))) && (((ws_sold_date_sk#1788 = d_date_sk#1040) && (d_year#1046 = 2001)) && (d_moy#1048 = 12)))\n            :     :                                +- Join Inner\n            :     :                                   :- Join LeftOuter, ((ws_order_number#1771L = wr_order_number#2129L) && (ws_item_sk#1757 = wr_item_sk#2118))\n            :     :                                   :  :- SubqueryAlias ws\n            :     :                                   :  :  +- SubqueryAlias web_sales\n            :     :                                   :  :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :     :                                   :  +- SubqueryAlias wr\n            :     :                                   :     +- SubqueryAlias web_returns\n            :     :                                   :        +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n            :     :                                   +- SubqueryAlias date_dim\n            :     :                                      +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     +- Project [catalog AS channel#24561, item#24556, return_ratio#24557, return_rank#24559, currency_rank#24560]\n            :        +- Filter ((return_rank#24559 <= 10) || (currency_rank#24560 <= 10))\n            :           +- SubqueryAlias catalog\n            :              +- Project [item#24556, return_ratio#24557, currency_ratio#24558, return_rank#24559, currency_rank#24560]\n            :                 +- Project [item#24556, return_ratio#24557, currency_ratio#24558, return_rank#24559, currency_rank#24560, return_rank#24559, currency_rank#24560]\n            :                    +- Window [rank(currency_ratio#24558) windowspecdefinition(currency_ratio#24558 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#24560], [currency_ratio#24558 ASC NULLS FIRST]\n            :                       +- Window [rank(return_ratio#24557) windowspecdefinition(return_ratio#24557 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#24559], [return_ratio#24557 ASC NULLS FIRST]\n            :                          +- Project [item#24556, return_ratio#24557, currency_ratio#24558]\n            :                             +- SubqueryAlias in_cat\n            :                                +- Aggregate [cs_item_sk#1803], [cs_item_sk#1803 AS item#24556, CheckOverflow((promote_precision(cast(cast(sum(cast(coalesce(cr_return_quantity#2102, 0) as bigint)) as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(sum(cast(coalesce(cs_quantity#1806, 0) as bigint)) as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20)) AS return_ratio#24557, CheckOverflow((promote_precision(cast(cast(sum(coalesce(cast(cr_return_amount#2103 as decimal(12,2)), cast(0 as decimal(12,2)))) as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(sum(coalesce(cast(cs_net_paid#1817 as decimal(12,2)), cast(0 as decimal(12,2)))) as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20)) AS currency_ratio#24558]\n            :                                   +- Filter ((((cast(cr_return_amount#2103 as decimal(7,2)) > cast(cast(10000 as decimal(5,0)) as decimal(7,2))) && (cast(cs_net_profit#1821 as decimal(7,2)) > cast(cast(1 as decimal(1,0)) as decimal(7,2)))) && ((cast(cs_net_paid#1817 as decimal(7,2)) > cast(cast(0 as decimal(1,0)) as decimal(7,2))) && (cs_quantity#1806 > 0))) && (((cs_sold_date_sk#1822 = d_date_sk#1040) && (d_year#1046 = 2001)) && (d_moy#1048 = 12)))\n            :                                      +- Join Inner\n            :                                         :- Join LeftOuter, ((cs_order_number#1805L = cr_order_number#2101L) && (cs_item_sk#1803 = cr_item_sk#2087))\n            :                                         :  :- SubqueryAlias cs\n            :                                         :  :  +- SubqueryAlias catalog_sales\n            :                                         :  :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :                                         :  +- SubqueryAlias cr\n            :                                         :     +- SubqueryAlias catalog_returns\n            :                                         :        +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n            :                                         +- SubqueryAlias date_dim\n            :                                            +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Project [store AS channel#24567, item#24562, return_ratio#24563, return_rank#24565, currency_rank#24566]\n               +- Filter ((return_rank#24565 <= 10) || (currency_rank#24566 <= 10))\n                  +- SubqueryAlias store\n                     +- Project [item#24562, return_ratio#24563, currency_ratio#24564, return_rank#24565, currency_rank#24566]\n                        +- Project [item#24562, return_ratio#24563, currency_ratio#24564, return_rank#24565, currency_rank#24566, return_rank#24565, currency_rank#24566]\n                           +- Window [rank(currency_ratio#24564) windowspecdefinition(currency_ratio#24564 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#24566], [currency_ratio#24564 ASC NULLS FIRST]\n                              +- Window [rank(return_ratio#24563) windowspecdefinition(return_ratio#24563 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#24565], [return_ratio#24563 ASC NULLS FIRST]\n                                 +- Project [item#24562, return_ratio#24563, currency_ratio#24564]\n                                    +- SubqueryAlias in_store\n                                       +- Aggregate [ss_item_sk#1905], [ss_item_sk#1905 AS item#24562, CheckOverflow((promote_precision(cast(cast(sum(cast(coalesce(sr_return_quantity#1713, 0) as bigint)) as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(sum(cast(coalesce(ss_quantity#1913, 0) as bigint)) as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20)) AS return_ratio#24563, CheckOverflow((promote_precision(cast(cast(sum(coalesce(cast(sr_return_amt#1714 as decimal(12,2)), cast(0 as decimal(12,2)))) as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(sum(coalesce(cast(ss_net_paid#1923 as decimal(12,2)), cast(0 as decimal(12,2)))) as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20)) AS currency_ratio#24564]\n                                          +- Filter ((((cast(sr_return_amt#1714 as decimal(7,2)) > cast(cast(10000 as decimal(5,0)) as decimal(7,2))) && (cast(ss_net_profit#1925 as decimal(7,2)) > cast(cast(1 as decimal(1,0)) as decimal(7,2)))) && ((cast(ss_net_paid#1923 as decimal(7,2)) > cast(cast(0 as decimal(1,0)) as decimal(7,2))) && (ss_quantity#1913 > 0))) && (((ss_sold_date_sk#1926 = d_date_sk#1040) && (d_year#1046 = 2001)) && (d_moy#1048 = 12)))\n                                             +- Join Inner\n                                                :- Join LeftOuter, ((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705))\n                                                :  :- SubqueryAlias sts\n                                                :  :  +- SubqueryAlias store_sales\n                                                :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                                :  +- SubqueryAlias sr\n                                                :     +- SubqueryAlias store_returns\n                                                :        +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                                                +- SubqueryAlias date_dim\n                                                   +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#24555 ASC NULLS FIRST, return_rank#24553 ASC NULLS FIRST, currency_rank#24554 ASC NULLS FIRST], true\n      +- Aggregate [channel#24555, item#24550, return_ratio#24551, return_rank#24553, currency_rank#24554], [channel#24555, item#24550, return_ratio#24551, return_rank#24553, currency_rank#24554]\n         +- Union\n            :- Project [web AS channel#24555, item#24550, return_ratio#24551, return_rank#24553, currency_rank#24554]\n            :  +- Filter ((return_rank#24553 <= 10) || (currency_rank#24554 <= 10))\n            :     +- Window [rank(currency_ratio#24552) windowspecdefinition(currency_ratio#24552 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#24554], [currency_ratio#24552 ASC NULLS FIRST]\n            :        +- Window [rank(return_ratio#24551) windowspecdefinition(return_ratio#24551 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#24553], [return_ratio#24551 ASC NULLS FIRST]\n            :           +- Aggregate [ws_item_sk#1757], [ws_item_sk#1757 AS item#24550, CheckOverflow((promote_precision(cast(sum(cast(coalesce(wr_return_quantity#2130, 0) as bigint)) as decimal(15,4))) / promote_precision(cast(sum(cast(coalesce(ws_quantity#1772, 0) as bigint)) as decimal(15,4)))), DecimalType(35,20)) AS return_ratio#24551, CheckOverflow((promote_precision(cast(sum(coalesce(cast(wr_return_amt#2131 as decimal(12,2)), 0.00)) as decimal(15,4))) / promote_precision(cast(sum(coalesce(cast(ws_net_paid#1783 as decimal(12,2)), 0.00)) as decimal(15,4)))), DecimalType(35,20)) AS currency_ratio#24552]\n            :              +- Project [ws_item_sk#1757, ws_quantity#1772, ws_net_paid#1783, wr_return_quantity#2130, wr_return_amt#2131]\n            :                 +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n            :                    :- Project [ws_item_sk#1757, ws_quantity#1772, ws_net_paid#1783, ws_sold_date_sk#1788, wr_return_quantity#2130, wr_return_amt#2131]\n            :                    :  +- Join Inner, ((ws_order_number#1771L = wr_order_number#2129L) && (ws_item_sk#1757 = wr_item_sk#2118))\n            :                    :     :- Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_net_paid#1783, ws_sold_date_sk#1788]\n            :                    :     :  +- Filter ((((((((isnotnull(ws_net_paid#1783) && isnotnull(ws_quantity#1772)) && isnotnull(ws_net_profit#1787)) && (ws_net_profit#1787 > 1.00)) && (ws_net_paid#1783 > 0.00)) && (ws_quantity#1772 > 0)) && isnotnull(ws_order_number#1771L)) && isnotnull(ws_item_sk#1757)) && isnotnull(ws_sold_date_sk#1788))\n            :                    :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :                    :     +- Project [wr_item_sk#2118, wr_order_number#2129L, wr_return_quantity#2130, wr_return_amt#2131]\n            :                    :        +- Filter (((isnotnull(wr_return_amt#2131) && (wr_return_amt#2131 > 10000.00)) && isnotnull(wr_item_sk#2118)) && isnotnull(wr_order_number#2129L))\n            :                    :           +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n            :                    +- Project [d_date_sk#1040]\n            :                       +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 12)) && isnotnull(d_date_sk#1040))\n            :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :- Project [catalog AS channel#24561, item#24556, return_ratio#24557, return_rank#24559, currency_rank#24560]\n            :  +- Filter ((return_rank#24559 <= 10) || (currency_rank#24560 <= 10))\n            :     +- Window [rank(currency_ratio#24558) windowspecdefinition(currency_ratio#24558 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#24560], [currency_ratio#24558 ASC NULLS FIRST]\n            :        +- Window [rank(return_ratio#24557) windowspecdefinition(return_ratio#24557 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#24559], [return_ratio#24557 ASC NULLS FIRST]\n            :           +- Aggregate [cs_item_sk#1803], [cs_item_sk#1803 AS item#24556, CheckOverflow((promote_precision(cast(sum(cast(coalesce(cr_return_quantity#2102, 0) as bigint)) as decimal(15,4))) / promote_precision(cast(sum(cast(coalesce(cs_quantity#1806, 0) as bigint)) as decimal(15,4)))), DecimalType(35,20)) AS return_ratio#24557, CheckOverflow((promote_precision(cast(sum(coalesce(cast(cr_return_amount#2103 as decimal(12,2)), 0.00)) as decimal(15,4))) / promote_precision(cast(sum(coalesce(cast(cs_net_paid#1817 as decimal(12,2)), 0.00)) as decimal(15,4)))), DecimalType(35,20)) AS currency_ratio#24558]\n            :              +- Project [cs_item_sk#1803, cs_quantity#1806, cs_net_paid#1817, cr_return_quantity#2102, cr_return_amount#2103]\n            :                 +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n            :                    :- Project [cs_item_sk#1803, cs_quantity#1806, cs_net_paid#1817, cs_sold_date_sk#1822, cr_return_quantity#2102, cr_return_amount#2103]\n            :                    :  +- Join Inner, ((cs_order_number#1805L = cr_order_number#2101L) && (cs_item_sk#1803 = cr_item_sk#2087))\n            :                    :     :- Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_net_paid#1817, cs_sold_date_sk#1822]\n            :                    :     :  +- Filter ((((((((isnotnull(cs_net_profit#1821) && isnotnull(cs_quantity#1806)) && isnotnull(cs_net_paid#1817)) && (cs_net_profit#1821 > 1.00)) && (cs_net_paid#1817 > 0.00)) && (cs_quantity#1806 > 0)) && isnotnull(cs_order_number#1805L)) && isnotnull(cs_item_sk#1803)) && isnotnull(cs_sold_date_sk#1822))\n            :                    :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :                    :     +- Project [cr_item_sk#2087, cr_order_number#2101L, cr_return_quantity#2102, cr_return_amount#2103]\n            :                    :        +- Filter (((isnotnull(cr_return_amount#2103) && (cr_return_amount#2103 > 10000.00)) && isnotnull(cr_order_number#2101L)) && isnotnull(cr_item_sk#2087))\n            :                    :           +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n            :                    +- Project [d_date_sk#1040]\n            :                       +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 12)) && isnotnull(d_date_sk#1040))\n            :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Project [store AS channel#24567, item#24562, return_ratio#24563, return_rank#24565, currency_rank#24566]\n               +- Filter ((return_rank#24565 <= 10) || (currency_rank#24566 <= 10))\n                  +- Window [rank(currency_ratio#24564) windowspecdefinition(currency_ratio#24564 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#24566], [currency_ratio#24564 ASC NULLS FIRST]\n                     +- Window [rank(return_ratio#24563) windowspecdefinition(return_ratio#24563 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#24565], [return_ratio#24563 ASC NULLS FIRST]\n                        +- Aggregate [ss_item_sk#1905], [ss_item_sk#1905 AS item#24562, CheckOverflow((promote_precision(cast(sum(cast(coalesce(sr_return_quantity#1713, 0) as bigint)) as decimal(15,4))) / promote_precision(cast(sum(cast(coalesce(ss_quantity#1913, 0) as bigint)) as decimal(15,4)))), DecimalType(35,20)) AS return_ratio#24563, CheckOverflow((promote_precision(cast(sum(coalesce(cast(sr_return_amt#1714 as decimal(12,2)), 0.00)) as decimal(15,4))) / promote_precision(cast(sum(coalesce(cast(ss_net_paid#1923 as decimal(12,2)), 0.00)) as decimal(15,4)))), DecimalType(35,20)) AS currency_ratio#24564]\n                           +- Project [ss_item_sk#1905, ss_quantity#1913, ss_net_paid#1923, sr_return_quantity#1713, sr_return_amt#1714]\n                              +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                                 :- Project [ss_item_sk#1905, ss_quantity#1913, ss_net_paid#1923, ss_sold_date_sk#1926, sr_return_quantity#1713, sr_return_amt#1714]\n                                 :  +- Join Inner, ((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705))\n                                 :     :- Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_net_paid#1923, ss_sold_date_sk#1926]\n                                 :     :  +- Filter ((((((((isnotnull(ss_quantity#1913) && isnotnull(ss_net_profit#1925)) && isnotnull(ss_net_paid#1923)) && (ss_net_profit#1925 > 1.00)) && (ss_net_paid#1923 > 0.00)) && (ss_quantity#1913 > 0)) && isnotnull(ss_item_sk#1905)) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_sold_date_sk#1926))\n                                 :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                 :     +- Project [sr_item_sk#1705, sr_ticket_number#1712L, sr_return_quantity#1713, sr_return_amt#1714]\n                                 :        +- Filter (((isnotnull(sr_return_amt#1714) && (sr_return_amt#1714 > 10000.00)) && isnotnull(sr_item_sk#1705)) && isnotnull(sr_ticket_number#1712L))\n                                 :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                                 +- Project [d_date_sk#1040]\n                                    +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 12)) && isnotnull(d_date_sk#1040))\n                                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[channel#24555 ASC NULLS FIRST,return_rank#24553 ASC NULLS FIRST,currency_rank#24554 ASC NULLS FIRST], output=[channel#24555,item#24550,return_ratio#24551,return_rank#24553,currency_rank#24554])\n+- *(32) HashAggregate(keys=[channel#24555, item#24550, return_ratio#24551, return_rank#24553, currency_rank#24554], functions=[], output=[channel#24555, item#24550, return_ratio#24551, return_rank#24553, currency_rank#24554])\n   +- Exchange hashpartitioning(channel#24555, item#24550, return_ratio#24551, return_rank#24553, currency_rank#24554, 200)\n      +- *(31) HashAggregate(keys=[channel#24555, item#24550, return_ratio#24551, return_rank#24553, currency_rank#24554], functions=[], output=[channel#24555, item#24550, return_ratio#24551, return_rank#24553, currency_rank#24554])\n         +- Union\n            :- *(10) Project [web AS channel#24555, item#24550, return_ratio#24551, return_rank#24553, currency_rank#24554]\n            :  +- *(10) Filter ((return_rank#24553 <= 10) || (currency_rank#24554 <= 10))\n            :     +- Window [rank(currency_ratio#24552) windowspecdefinition(currency_ratio#24552 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#24554], [currency_ratio#24552 ASC NULLS FIRST]\n            :        +- *(9) Sort [currency_ratio#24552 ASC NULLS FIRST], false, 0\n            :           +- Window [rank(return_ratio#24551) windowspecdefinition(return_ratio#24551 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#24553], [return_ratio#24551 ASC NULLS FIRST]\n            :              +- *(8) Sort [return_ratio#24551 ASC NULLS FIRST], false, 0\n            :                 +- Exchange SinglePartition\n            :                    +- *(7) HashAggregate(keys=[ws_item_sk#1757], functions=[sum(cast(coalesce(wr_return_quantity#2130, 0) as bigint)), sum(cast(coalesce(ws_quantity#1772, 0) as bigint)), sum(coalesce(cast(wr_return_amt#2131 as decimal(12,2)), 0.00)), sum(coalesce(cast(ws_net_paid#1783 as decimal(12,2)), 0.00))], output=[item#24550, return_ratio#24551, currency_ratio#24552])\n            :                       +- Exchange hashpartitioning(ws_item_sk#1757, 200)\n            :                          +- *(6) HashAggregate(keys=[ws_item_sk#1757], functions=[partial_sum(cast(coalesce(wr_return_quantity#2130, 0) as bigint)), partial_sum(cast(coalesce(ws_quantity#1772, 0) as bigint)), partial_sum(coalesce(cast(wr_return_amt#2131 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(ws_net_paid#1783 as decimal(12,2)), 0.00))], output=[ws_item_sk#1757, sum#24655L, sum#24656L, sum#24657, sum#24658])\n            :                             +- *(6) Project [ws_item_sk#1757, ws_quantity#1772, ws_net_paid#1783, wr_return_quantity#2130, wr_return_amt#2131]\n            :                                +- *(6) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n            :                                   :- *(6) Project [ws_item_sk#1757, ws_quantity#1772, ws_net_paid#1783, ws_sold_date_sk#1788, wr_return_quantity#2130, wr_return_amt#2131]\n            :                                   :  +- *(6) SortMergeJoin [ws_order_number#1771L, ws_item_sk#1757], [wr_order_number#2129L, wr_item_sk#2118], Inner\n            :                                   :     :- *(2) Sort [ws_order_number#1771L ASC NULLS FIRST, ws_item_sk#1757 ASC NULLS FIRST], false, 0\n            :                                   :     :  +- Exchange hashpartitioning(ws_order_number#1771L, ws_item_sk#1757, 200)\n            :                                   :     :     +- *(1) Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_net_paid#1783, ws_sold_date_sk#1788]\n            :                                   :     :        +- *(1) Filter (((((((isnotnull(ws_net_paid#1783) && isnotnull(ws_quantity#1772)) && isnotnull(ws_net_profit#1787)) && (ws_net_profit#1787 > 1.00)) && (ws_net_paid#1783 > 0.00)) && (ws_quantity#1772 > 0)) && isnotnull(ws_order_number#1771L)) && isnotnull(ws_item_sk#1757))\n            :                                   :     :           +- *(1) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_order_number#1771L,ws_quantity#1772,ws_net_paid#1783,ws_net_profit#1787,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_net_paid), IsNotNull(ws_quantity), IsNotNull(ws_net_profit), GreaterThan(ws_net_pro..., ReadSchema: struct<ws_item_sk:int,ws_order_number:bigint,ws_quantity:int,ws_net_paid:decimal(7,2),ws_net_prof...\n            :                                   :     +- *(4) Sort [wr_order_number#2129L ASC NULLS FIRST, wr_item_sk#2118 ASC NULLS FIRST], false, 0\n            :                                   :        +- Exchange hashpartitioning(wr_order_number#2129L, wr_item_sk#2118, 200)\n            :                                   :           +- *(3) Project [wr_item_sk#2118, wr_order_number#2129L, wr_return_quantity#2130, wr_return_amt#2131]\n            :                                   :              +- *(3) Filter (((isnotnull(wr_return_amt#2131) && (wr_return_amt#2131 > 10000.00)) && isnotnull(wr_item_sk#2118)) && isnotnull(wr_order_number#2129L))\n            :                                   :                 +- *(3) FileScan parquet db_tpcds.web_returns[wr_item_sk#2118,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_returned_date_sk#2140] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_returns], PartitionCount: 2110, PartitionFilters: [], PushedFilters: [IsNotNull(wr_return_amt), GreaterThan(wr_return_amt,10000.00), IsNotNull(wr_item_sk), IsNotNull(..., ReadSchema: struct<wr_item_sk:int,wr_order_number:bigint,wr_return_quantity:int,wr_return_amt:decimal(7,2)>\n            :                                   +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :                                      +- *(5) Project [d_date_sk#1040]\n            :                                         +- *(5) Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 12)) && isnotnull(d_date_sk#1040))\n            :                                            +- *(5) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), EqualTo(d_moy,12), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n            :- *(20) Project [catalog AS channel#24561, item#24556, return_ratio#24557, return_rank#24559, currency_rank#24560]\n            :  +- *(20) Filter ((return_rank#24559 <= 10) || (currency_rank#24560 <= 10))\n            :     +- Window [rank(currency_ratio#24558) windowspecdefinition(currency_ratio#24558 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#24560], [currency_ratio#24558 ASC NULLS FIRST]\n            :        +- *(19) Sort [currency_ratio#24558 ASC NULLS FIRST], false, 0\n            :           +- Window [rank(return_ratio#24557) windowspecdefinition(return_ratio#24557 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#24559], [return_ratio#24557 ASC NULLS FIRST]\n            :              +- *(18) Sort [return_ratio#24557 ASC NULLS FIRST], false, 0\n            :                 +- Exchange SinglePartition\n            :                    +- *(17) HashAggregate(keys=[cs_item_sk#1803], functions=[sum(cast(coalesce(cr_return_quantity#2102, 0) as bigint)), sum(cast(coalesce(cs_quantity#1806, 0) as bigint)), sum(coalesce(cast(cr_return_amount#2103 as decimal(12,2)), 0.00)), sum(coalesce(cast(cs_net_paid#1817 as decimal(12,2)), 0.00))], output=[item#24556, return_ratio#24557, currency_ratio#24558])\n            :                       +- Exchange hashpartitioning(cs_item_sk#1803, 200)\n            :                          +- *(16) HashAggregate(keys=[cs_item_sk#1803], functions=[partial_sum(cast(coalesce(cr_return_quantity#2102, 0) as bigint)), partial_sum(cast(coalesce(cs_quantity#1806, 0) as bigint)), partial_sum(coalesce(cast(cr_return_amount#2103 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(cs_net_paid#1817 as decimal(12,2)), 0.00))], output=[cs_item_sk#1803, sum#24663L, sum#24664L, sum#24665, sum#24666])\n            :                             +- *(16) Project [cs_item_sk#1803, cs_quantity#1806, cs_net_paid#1817, cr_return_quantity#2102, cr_return_amount#2103]\n            :                                +- *(16) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n            :                                   :- *(16) Project [cs_item_sk#1803, cs_quantity#1806, cs_net_paid#1817, cs_sold_date_sk#1822, cr_return_quantity#2102, cr_return_amount#2103]\n            :                                   :  +- *(16) SortMergeJoin [cs_order_number#1805L, cs_item_sk#1803], [cr_order_number#2101L, cr_item_sk#2087], Inner\n            :                                   :     :- *(12) Sort [cs_order_number#1805L ASC NULLS FIRST, cs_item_sk#1803 ASC NULLS FIRST], false, 0\n            :                                   :     :  +- Exchange hashpartitioning(cs_order_number#1805L, cs_item_sk#1803, 200)\n            :                                   :     :     +- *(11) Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_net_paid#1817, cs_sold_date_sk#1822]\n            :                                   :     :        +- *(11) Filter (((((((isnotnull(cs_net_profit#1821) && isnotnull(cs_quantity#1806)) && isnotnull(cs_net_paid#1817)) && (cs_net_profit#1821 > 1.00)) && (cs_net_paid#1817 > 0.00)) && (cs_quantity#1806 > 0)) && isnotnull(cs_order_number#1805L)) && isnotnull(cs_item_sk#1803))\n            :                                   :     :           +- *(11) FileScan parquet db_tpcds.catalog_sales[cs_item_sk#1803,cs_order_number#1805L,cs_quantity#1806,cs_net_paid#1817,cs_net_profit#1821,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_net_profit), IsNotNull(cs_quantity), IsNotNull(cs_net_paid), GreaterThan(cs_net_pro..., ReadSchema: struct<cs_item_sk:int,cs_order_number:bigint,cs_quantity:int,cs_net_paid:decimal(7,2),cs_net_prof...\n            :                                   :     +- *(14) Sort [cr_order_number#2101L ASC NULLS FIRST, cr_item_sk#2087 ASC NULLS FIRST], false, 0\n            :                                   :        +- Exchange hashpartitioning(cr_order_number#2101L, cr_item_sk#2087, 200)\n            :                                   :           +- *(13) Project [cr_item_sk#2087, cr_order_number#2101L, cr_return_quantity#2102, cr_return_amount#2103]\n            :                                   :              +- *(13) Filter (((isnotnull(cr_return_amount#2103) && (cr_return_amount#2103 > 10000.00)) && isnotnull(cr_order_number#2101L)) && isnotnull(cr_item_sk#2087))\n            :                                   :                 +- *(13) FileScan parquet db_tpcds.catalog_returns[cr_item_sk#2087,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns], PartitionCount: 2066, PartitionFilters: [], PushedFilters: [IsNotNull(cr_return_amount), GreaterThan(cr_return_amount,10000.00), IsNotNull(cr_order_number),..., ReadSchema: struct<cr_item_sk:int,cr_order_number:bigint,cr_return_quantity:int,cr_return_amount:decimal(7,2)>\n            :                                   +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            +- *(30) Project [store AS channel#24567, item#24562, return_ratio#24563, return_rank#24565, currency_rank#24566]\n               +- *(30) Filter ((return_rank#24565 <= 10) || (currency_rank#24566 <= 10))\n                  +- Window [rank(currency_ratio#24564) windowspecdefinition(currency_ratio#24564 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#24566], [currency_ratio#24564 ASC NULLS FIRST]\n                     +- *(29) Sort [currency_ratio#24564 ASC NULLS FIRST], false, 0\n                        +- Window [rank(return_ratio#24563) windowspecdefinition(return_ratio#24563 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#24565], [return_ratio#24563 ASC NULLS FIRST]\n                           +- *(28) Sort [return_ratio#24563 ASC NULLS FIRST], false, 0\n                              +- Exchange SinglePartition\n                                 +- *(27) HashAggregate(keys=[ss_item_sk#1905], functions=[sum(cast(coalesce(sr_return_quantity#1713, 0) as bigint)), sum(cast(coalesce(ss_quantity#1913, 0) as bigint)), sum(coalesce(cast(sr_return_amt#1714 as decimal(12,2)), 0.00)), sum(coalesce(cast(ss_net_paid#1923 as decimal(12,2)), 0.00))], output=[item#24562, return_ratio#24563, currency_ratio#24564])\n                                    +- Exchange hashpartitioning(ss_item_sk#1905, 200)\n                                       +- *(26) HashAggregate(keys=[ss_item_sk#1905], functions=[partial_sum(cast(coalesce(sr_return_quantity#1713, 0) as bigint)), partial_sum(cast(coalesce(ss_quantity#1913, 0) as bigint)), partial_sum(coalesce(cast(sr_return_amt#1714 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(ss_net_paid#1923 as decimal(12,2)), 0.00))], output=[ss_item_sk#1905, sum#24671L, sum#24672L, sum#24673, sum#24674])\n                                          +- *(26) Project [ss_item_sk#1905, ss_quantity#1913, ss_net_paid#1923, sr_return_quantity#1713, sr_return_amt#1714]\n                                             +- *(26) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                                                :- *(26) Project [ss_item_sk#1905, ss_quantity#1913, ss_net_paid#1923, ss_sold_date_sk#1926, sr_return_quantity#1713, sr_return_amt#1714]\n                                                :  +- *(26) SortMergeJoin [ss_ticket_number#1912L, ss_item_sk#1905], [sr_ticket_number#1712L, sr_item_sk#1705], Inner\n                                                :     :- *(22) Sort [ss_ticket_number#1912L ASC NULLS FIRST, ss_item_sk#1905 ASC NULLS FIRST], false, 0\n                                                :     :  +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_item_sk#1905, 200)\n                                                :     :     +- *(21) Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_net_paid#1923, ss_sold_date_sk#1926]\n                                                :     :        +- *(21) Filter (((((((isnotnull(ss_quantity#1913) && isnotnull(ss_net_profit#1925)) && isnotnull(ss_net_paid#1923)) && (ss_net_profit#1925 > 1.00)) && (ss_net_paid#1923 > 0.00)) && (ss_quantity#1913 > 0)) && isnotnull(ss_item_sk#1905)) && isnotnull(ss_ticket_number#1912L))\n                                                :     :           +- *(21) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_ticket_number#1912L,ss_quantity#1913,ss_net_paid#1923,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_quantity), IsNotNull(ss_net_profit), IsNotNull(ss_net_paid), GreaterThan(ss_net_pro..., ReadSchema: struct<ss_item_sk:int,ss_ticket_number:bigint,ss_quantity:int,ss_net_paid:decimal(7,2),ss_net_pro...\n                                                :     +- *(24) Sort [sr_ticket_number#1712L ASC NULLS FIRST, sr_item_sk#1705 ASC NULLS FIRST], false, 0\n                                                :        +- Exchange hashpartitioning(sr_ticket_number#1712L, sr_item_sk#1705, 200)\n                                                :           +- *(23) Project [sr_item_sk#1705, sr_ticket_number#1712L, sr_return_quantity#1713, sr_return_amt#1714]\n                                                :              +- *(23) Filter (((isnotnull(sr_return_amt#1714) && (sr_return_amt#1714 > 10000.00)) && isnotnull(sr_item_sk#1705)) && isnotnull(sr_ticket_number#1712L))\n                                                :                 +- *(23) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns], PartitionCount: 2002, PartitionFilters: [], PushedFilters: [IsNotNull(sr_return_amt), GreaterThan(sr_return_amt,10000.00), IsNotNull(sr_item_sk), IsNotNull(..., ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint,sr_return_quantity:int,sr_return_amt:decimal(7,2)>\n                                                +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q50-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","store_returns","store","date_dim","date_dim"],"parsingTime":0.003249,"analysisTime":0.001164,"optimizationTime":575.421798,"planningTime":22.379578,"executionTime":4273.161393,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['s_store_name ASC NULLS FIRST, 's_company_id ASC NULLS FIRST, 's_street_number ASC NULLS FIRST, 's_street_name ASC NULLS FIRST, 's_street_type ASC NULLS FIRST, 's_suite_number ASC NULLS FIRST, 's_city ASC NULLS FIRST, 's_county ASC NULLS FIRST, 's_state ASC NULLS FIRST, 's_zip ASC NULLS FIRST], true\n      +- 'Aggregate ['s_store_name, 's_company_id, 's_street_number, 's_street_name, 's_street_type, 's_suite_number, 's_city, 's_county, 's_state, 's_zip], ['s_store_name, 's_company_id, 's_street_number, 's_street_name, 's_street_type, 's_suite_number, 's_city, 's_county, 's_state, 's_zip, 'sum(CASE WHEN (('sr_returned_date_sk - 'ss_sold_date_sk) <= 30) THEN 1 ELSE 0 END) AS 30 days#24874, 'sum(CASE WHEN ((('sr_returned_date_sk - 'ss_sold_date_sk) > 30) && (('sr_returned_date_sk - 'ss_sold_date_sk) <= 60)) THEN 1 ELSE 0 END) AS 31-60 days#24875, 'sum(CASE WHEN ((('sr_returned_date_sk - 'ss_sold_date_sk) > 60) && (('sr_returned_date_sk - 'ss_sold_date_sk) <= 90)) THEN 1 ELSE 0 END) AS 61-90 days#24876, 'sum(CASE WHEN ((('sr_returned_date_sk - 'ss_sold_date_sk) > 90) && (('sr_returned_date_sk - 'ss_sold_date_sk) <= 120)) THEN 1 ELSE 0 END) AS 91-120 days#24877, 'sum(CASE WHEN (('sr_returned_date_sk - 'ss_sold_date_sk) > 120) THEN 1 ELSE 0 END) AS >120 days#24878]\n         +- 'Filter (((('d2.d_year = 2001) && ('d2.d_moy = 8)) && (('ss_ticket_number = 'sr_ticket_number) && ('ss_item_sk = 'sr_item_sk))) && ((('ss_sold_date_sk = 'd1.d_date_sk) && ('sr_returned_date_sk = 'd2.d_date_sk)) && (('ss_customer_sk = 'sr_customer_sk) && ('ss_store_sk = 's_store_sk))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'UnresolvedRelation `store_sales`\n               :  :  :  +- 'UnresolvedRelation `store_returns`\n               :  :  +- 'UnresolvedRelation `store`\n               :  +- 'SubqueryAlias d1\n               :     +- 'UnresolvedRelation `date_dim`\n               +- 'SubqueryAlias d2\n                  +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\ns_store_name: string, s_company_id: int, s_street_number: string, s_street_name: string, s_street_type: string, s_suite_number: string, s_city: string, s_county: string, s_state: string, s_zip: string, 30 days: bigint, 31-60 days: bigint, 61-90 days: bigint, 91-120 days: bigint, >120 days: bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, 30 days#24874L, 31-60 days#24875L, 61-90 days#24876L, 91-120 days#24877L, >120 days#24878L]\n      +- Sort [s_store_name#1391 ASC NULLS FIRST, s_company_id#1402 ASC NULLS FIRST, s_street_number#1404 ASC NULLS FIRST, s_street_name#1405 ASC NULLS FIRST, s_street_type#1406 ASC NULLS FIRST, s_suite_number#1407 ASC NULLS FIRST, s_city#1408 ASC NULLS FIRST, s_county#1409 ASC NULLS FIRST, s_state#1410 ASC NULLS FIRST, s_zip#1411 ASC NULLS FIRST], true\n         +- Aggregate [s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411], [s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, sum(cast(CASE WHEN ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 30) THEN 1 ELSE 0 END as bigint)) AS 30 days#24874L, sum(cast(CASE WHEN (((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 30) && ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 60)) THEN 1 ELSE 0 END as bigint)) AS 31-60 days#24875L, sum(cast(CASE WHEN (((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 60) && ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 90)) THEN 1 ELSE 0 END as bigint)) AS 61-90 days#24876L, sum(cast(CASE WHEN (((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 90) && ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 120)) THEN 1 ELSE 0 END as bigint)) AS 91-120 days#24877L, sum(cast(CASE WHEN ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 120) THEN 1 ELSE 0 END as bigint)) AS >120 days#24878L]\n            +- Filter ((((d_year#24885 = 2001) && (d_moy#24887 = 8)) && ((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705))) && (((ss_sold_date_sk#1926 = d_date_sk#1040) && (sr_returned_date_sk#1723 = d_date_sk#24879)) && ((ss_customer_sk#1906 = sr_customer_sk#1706) && (ss_store_sk#1910 = s_store_sk#1386))))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- Join Inner\n                  :  :  :  :- SubqueryAlias store_sales\n                  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :  :  :  +- SubqueryAlias store_returns\n                  :  :  :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                  :  :  +- SubqueryAlias store\n                  :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                  :  +- SubqueryAlias d1\n                  :     +- SubqueryAlias date_dim\n                  :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  +- SubqueryAlias d2\n                     +- SubqueryAlias date_dim\n                        +- Relation[d_date_sk#24879,d_date_id#24880,d_date#24881,d_month_seq#24882,d_week_seq#24883,d_quarter_seq#24884,d_year#24885,d_dow#24886,d_moy#24887,d_dom#24888,d_qoy#24889,d_fy_year#24890,d_fy_quarter_seq#24891,d_fy_week_seq#24892,d_day_name#24893,d_quarter_name#24894,d_holiday#24895,d_weekend#24896,d_following_holiday#24897,d_first_dom#24898,d_last_dom#24899,d_same_day_ly#24900,d_same_day_lq#24901,d_current_day#24902,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [s_store_name#1391 ASC NULLS FIRST, s_company_id#1402 ASC NULLS FIRST, s_street_number#1404 ASC NULLS FIRST, s_street_name#1405 ASC NULLS FIRST, s_street_type#1406 ASC NULLS FIRST, s_suite_number#1407 ASC NULLS FIRST, s_city#1408 ASC NULLS FIRST, s_county#1409 ASC NULLS FIRST, s_state#1410 ASC NULLS FIRST, s_zip#1411 ASC NULLS FIRST], true\n      +- Aggregate [s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411], [s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, sum(cast(CASE WHEN ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 30) THEN 1 ELSE 0 END as bigint)) AS 30 days#24874L, sum(cast(CASE WHEN (((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 30) && ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 60)) THEN 1 ELSE 0 END as bigint)) AS 31-60 days#24875L, sum(cast(CASE WHEN (((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 60) && ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 90)) THEN 1 ELSE 0 END as bigint)) AS 61-90 days#24876L, sum(cast(CASE WHEN (((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 90) && ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 120)) THEN 1 ELSE 0 END as bigint)) AS 91-120 days#24877L, sum(cast(CASE WHEN ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 120) THEN 1 ELSE 0 END as bigint)) AS >120 days#24878L]\n         +- Project [ss_sold_date_sk#1926, sr_returned_date_sk#1723, s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411]\n            +- Join Inner, (sr_returned_date_sk#1723 = d_date_sk#24879)\n               :- Project [ss_sold_date_sk#1926, sr_returned_date_sk#1723, s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411]\n               :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :     :- Project [ss_sold_date_sk#1926, sr_returned_date_sk#1723, s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411]\n               :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n               :     :     :- Project [ss_store_sk#1910, ss_sold_date_sk#1926, sr_returned_date_sk#1723]\n               :     :     :  +- Join Inner, (((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705)) && (ss_customer_sk#1906 = sr_customer_sk#1706))\n               :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_sold_date_sk#1926]\n               :     :     :     :  +- Filter ((((isnotnull(ss_item_sk#1905) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_sold_date_sk#1926))\n               :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :     :     +- Project [sr_item_sk#1705, sr_customer_sk#1706, sr_ticket_number#1712L, sr_returned_date_sk#1723]\n               :     :     :        +- Filter (((isnotnull(sr_customer_sk#1706) && isnotnull(sr_ticket_number#1712L)) && isnotnull(sr_item_sk#1705)) && isnotnull(sr_returned_date_sk#1723))\n               :     :     :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :     :     +- Project [s_store_sk#1386, s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411]\n               :     :        +- Filter isnotnull(s_store_sk#1386)\n               :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               :     +- Project [d_date_sk#1040]\n               :        +- Filter isnotnull(d_date_sk#1040)\n               :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- Project [d_date_sk#24879]\n                  +- Filter ((((isnotnull(d_year#24885) && isnotnull(d_moy#24887)) && (d_year#24885 = 2001)) && (d_moy#24887 = 8)) && isnotnull(d_date_sk#24879))\n                     +- Relation[d_date_sk#24879,d_date_id#24880,d_date#24881,d_month_seq#24882,d_week_seq#24883,d_quarter_seq#24884,d_year#24885,d_dow#24886,d_moy#24887,d_dom#24888,d_qoy#24889,d_fy_year#24890,d_fy_quarter_seq#24891,d_fy_week_seq#24892,d_day_name#24893,d_quarter_name#24894,d_holiday#24895,d_weekend#24896,d_following_holiday#24897,d_first_dom#24898,d_last_dom#24899,d_same_day_ly#24900,d_same_day_lq#24901,d_current_day#24902,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[s_store_name#1391 ASC NULLS FIRST,s_company_id#1402 ASC NULLS FIRST,s_street_number#1404 ASC NULLS FIRST,s_street_name#1405 ASC NULLS FIRST,s_street_type#1406 ASC NULLS FIRST,s_suite_number#1407 ASC NULLS FIRST,s_city#1408 ASC NULLS FIRST,s_county#1409 ASC NULLS FIRST,s_state#1410 ASC NULLS FIRST,s_zip#1411 ASC NULLS FIRST], output=[s_store_name#1391,s_company_id#1402,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,s_state#1410,s_zip#1411,30 days#24874L,31-60 days#24875L,61-90 days#24876L,91-120 days#24877L,>120 days#24878L])\n+- *(6) HashAggregate(keys=[s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411], functions=[sum(cast(CASE WHEN ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 30) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN (((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 30) && ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 60)) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN (((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 60) && ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 90)) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN (((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 90) && ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 120)) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 120) THEN 1 ELSE 0 END as bigint))], output=[s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, 30 days#24874L, 31-60 days#24875L, 61-90 days#24876L, 91-120 days#24877L, >120 days#24878L])\n   +- Exchange hashpartitioning(s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, 200)\n      +- *(5) HashAggregate(keys=[s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411], functions=[partial_sum(cast(CASE WHEN ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 30) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN (((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 30) && ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 60)) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN (((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 60) && ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 90)) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN (((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 90) && ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) <= 120)) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN ((sr_returned_date_sk#1723 - ss_sold_date_sk#1926) > 120) THEN 1 ELSE 0 END as bigint))], output=[s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, sum#24942L, sum#24943L, sum#24944L, sum#24945L, sum#24946L])\n         +- *(5) Project [ss_sold_date_sk#1926, sr_returned_date_sk#1723, s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411]\n            +- *(5) BroadcastHashJoin [sr_returned_date_sk#1723], [d_date_sk#24879], Inner, BuildRight\n               :- *(5) Project [ss_sold_date_sk#1926, sr_returned_date_sk#1723, s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411]\n               :  +- *(5) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :- *(5) Project [ss_sold_date_sk#1926, sr_returned_date_sk#1723, s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411]\n               :     :  +- *(5) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n               :     :     :- *(5) Project [ss_store_sk#1910, ss_sold_date_sk#1926, sr_returned_date_sk#1723]\n               :     :     :  +- *(5) BroadcastHashJoin [ss_ticket_number#1912L, ss_item_sk#1905, ss_customer_sk#1906], [sr_ticket_number#1712L, sr_item_sk#1705, sr_customer_sk#1706], Inner, BuildRight\n               :     :     :     :- *(5) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ticket_number#1912L, ss_sold_date_sk#1926]\n               :     :     :     :  +- *(5) Filter (((isnotnull(ss_item_sk#1905) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910))\n               :     :     :     :     +- *(5) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_store_sk#1910,ss_ticket_number#1912L,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_stor..., ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_store_sk:int,ss_ticket_number:bigint>\n               :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[2, bigint, true], input[0, int, true], input[1, int, true]))\n               :     :     :        +- *(1) Project [sr_item_sk#1705, sr_customer_sk#1706, sr_ticket_number#1712L, sr_returned_date_sk#1723]\n               :     :     :           +- *(1) Filter ((isnotnull(sr_customer_sk#1706) && isnotnull(sr_ticket_number#1712L)) && isnotnull(sr_item_sk#1705))\n               :     :     :              +- *(1) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_customer_sk#1706,sr_ticket_number#1712L,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns/sr_..., PartitionCount: 2001, PartitionFilters: [isnotnull(sr_returned_date_sk#1723)], PushedFilters: [IsNotNull(sr_customer_sk), IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:int,sr_customer_sk:int,sr_ticket_number:bigint>\n               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(2) Project [s_store_sk#1386, s_store_name#1391, s_company_id#1402, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411]\n               :     :           +- *(2) Filter isnotnull(s_store_sk#1386)\n               :     :              +- *(2) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_name#1391,s_company_id#1402,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,s_state#1410,s_zip#1411] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_id:int,s_street_number:string,s_street_name:s...\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(3) Project [d_date_sk#1040]\n               :           +- *(3) Filter isnotnull(d_date_sk#1040)\n               :              +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(4) Project [d_date_sk#24879]\n                     +- *(4) Filter ((((isnotnull(d_year#24885) && isnotnull(d_moy#24887)) && (d_year#24885 = 2001)) && (d_moy#24887 = 8)) && isnotnull(d_date_sk#24879))\n                        +- *(4) FileScan parquet db_tpcds.date_dim[d_date_sk#24879,d_year#24885,d_moy#24887] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), EqualTo(d_moy,8), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>"},{"name":"q51-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["web_v1","store_v1"],"parsingTime":0.002412,"analysisTime":0.002152,"optimizationTime":460.847906,"planningTime":38.283059,"executionTime":24170.682398,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [web_v1, store_v1]\n:  :- 'SubqueryAlias web_v1\n:  :  +- 'Aggregate ['ws_item_sk, 'd_date], ['ws_item_sk AS item_sk#25077, 'd_date, 'sum('sum('ws_sales_price)) windowspecdefinition('ws_item_sk, 'd_date ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#25078]\n:  :     +- 'Filter ((('ws_sold_date_sk = 'd_date_sk) && (('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11)))) && isnotnull('ws_item_sk))\n:  :        +- 'Join Inner\n:  :           :- 'UnresolvedRelation `web_sales`\n:  :           +- 'UnresolvedRelation `date_dim`\n:  +- 'SubqueryAlias store_v1\n:     +- 'Aggregate ['ss_item_sk, 'd_date], ['ss_item_sk AS item_sk#25079, 'd_date, 'sum('sum('ss_sales_price)) windowspecdefinition('ss_item_sk, 'd_date ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#25080]\n:        +- 'Filter ((('ss_sold_date_sk = 'd_date_sk) && (('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11)))) && isnotnull('ss_item_sk))\n:           +- 'Join Inner\n:              :- 'UnresolvedRelation `store_sales`\n:              +- 'UnresolvedRelation `date_dim`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['item_sk ASC NULLS FIRST, 'd_date ASC NULLS FIRST], true\n         +- 'Project [*]\n            +- 'Filter ('web_cumulative > 'store_cumulative)\n               +- 'SubqueryAlias y\n                  +- 'Project ['item_sk, 'd_date, 'web_sales, 'store_sales, 'max('web_sales) windowspecdefinition('item_sk, 'd_date ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS web_cumulative#25075, 'max('store_sales) windowspecdefinition('item_sk, 'd_date ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS store_cumulative#25076]\n                     +- 'SubqueryAlias x\n                        +- 'Project [CASE WHEN isnotnull('web.item_sk) THEN 'web.item_sk ELSE 'store.item_sk END AS item_sk#25071, CASE WHEN isnotnull('web.d_date) THEN 'web.d_date ELSE 'store.d_date END AS d_date#25072, 'web.cume_sales AS web_sales#25073, 'store.cume_sales AS store_sales#25074]\n                           +- 'Join FullOuter, (('web.item_sk = 'store.item_sk) && ('web.d_date = 'store.d_date))\n                              :- 'SubqueryAlias web\n                              :  +- 'UnresolvedRelation `web_v1`\n                              +- 'SubqueryAlias store\n                                 +- 'UnresolvedRelation `store_v1`\n\n== Analyzed Logical Plan ==\nitem_sk: int, d_date: date, web_sales: decimal(27,2), store_sales: decimal(27,2), web_cumulative: decimal(27,2), store_cumulative: decimal(27,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [item_sk#25071 ASC NULLS FIRST, d_date#25072 ASC NULLS FIRST], true\n      +- Project [item_sk#25071, d_date#25072, web_sales#25073, store_sales#25074, web_cumulative#25075, store_cumulative#25076]\n         +- Filter (web_cumulative#25075 > store_cumulative#25076)\n            +- SubqueryAlias y\n               +- Project [item_sk#25071, d_date#25072, web_sales#25073, store_sales#25074, web_cumulative#25075, store_cumulative#25076]\n                  +- Project [item_sk#25071, d_date#25072, web_sales#25073, store_sales#25074, web_cumulative#25075, store_cumulative#25076, web_cumulative#25075, store_cumulative#25076]\n                     +- Window [max(web_sales#25073) windowspecdefinition(item_sk#25071, d_date#25072 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS web_cumulative#25075, max(store_sales#25074) windowspecdefinition(item_sk#25071, d_date#25072 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS store_cumulative#25076], [item_sk#25071], [d_date#25072 ASC NULLS FIRST]\n                        +- Project [item_sk#25071, d_date#25072, web_sales#25073, store_sales#25074]\n                           +- SubqueryAlias x\n                              +- Project [CASE WHEN isnotnull(item_sk#25077) THEN item_sk#25077 ELSE item_sk#25079 END AS item_sk#25071, CASE WHEN isnotnull(d_date#1042) THEN d_date#1042 ELSE d_date#25089 END AS d_date#25072, cume_sales#25078 AS web_sales#25073, cume_sales#25080 AS store_sales#25074]\n                                 +- Join FullOuter, ((item_sk#25077 = item_sk#25079) && (d_date#1042 = d_date#25089))\n                                    :- SubqueryAlias web\n                                    :  +- SubqueryAlias web_v1\n                                    :     +- Project [item_sk#25077, d_date#1042, cume_sales#25078]\n                                    :        +- Project [item_sk#25077, d_date#1042, _w0#25083, ws_item_sk#1757, cume_sales#25078, cume_sales#25078]\n                                    :           +- Window [sum(_w0#25083) windowspecdefinition(ws_item_sk#1757, d_date#1042 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#25078], [ws_item_sk#1757], [d_date#1042 ASC NULLS FIRST]\n                                    :              +- Aggregate [ws_item_sk#1757, d_date#1042], [ws_item_sk#1757 AS item_sk#25077, d_date#1042, sum(ws_sales_price#1775) AS _w0#25083, ws_item_sk#1757]\n                                    :                 +- Filter (((ws_sold_date_sk#1788 = d_date_sk#1040) && ((d_month_seq#1043 >= 1200) && (d_month_seq#1043 <= (1200 + 11)))) && isnotnull(ws_item_sk#1757))\n                                    :                    +- Join Inner\n                                    :                       :- SubqueryAlias web_sales\n                                    :                       :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                                    :                       +- SubqueryAlias date_dim\n                                    :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                    +- SubqueryAlias store\n                                       +- SubqueryAlias store_v1\n                                          +- Project [item_sk#25079, d_date#25089, cume_sales#25080]\n                                             +- Project [item_sk#25079, d_date#25089, _w0#25086, ss_item_sk#1905, cume_sales#25080, cume_sales#25080]\n                                                +- Window [sum(_w0#25086) windowspecdefinition(ss_item_sk#1905, d_date#25089 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#25080], [ss_item_sk#1905], [d_date#25089 ASC NULLS FIRST]\n                                                   +- Aggregate [ss_item_sk#1905, d_date#25089], [ss_item_sk#1905 AS item_sk#25079, d_date#25089, sum(ss_sales_price#1916) AS _w0#25086, ss_item_sk#1905]\n                                                      +- Filter (((ss_sold_date_sk#1926 = d_date_sk#25087) && ((d_month_seq#25090 >= 1200) && (d_month_seq#25090 <= (1200 + 11)))) && isnotnull(ss_item_sk#1905))\n                                                         +- Join Inner\n                                                            :- SubqueryAlias store_sales\n                                                            :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                                            +- SubqueryAlias date_dim\n                                                               +- Relation[d_date_sk#25087,d_date_id#25088,d_date#25089,d_month_seq#25090,d_week_seq#25091,d_quarter_seq#25092,d_year#25093,d_dow#25094,d_moy#25095,d_dom#25096,d_qoy#25097,d_fy_year#25098,d_fy_quarter_seq#25099,d_fy_week_seq#25100,d_day_name#25101,d_quarter_name#25102,d_holiday#25103,d_weekend#25104,d_following_holiday#25105,d_first_dom#25106,d_last_dom#25107,d_same_day_ly#25108,d_same_day_lq#25109,d_current_day#25110,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [item_sk#25071 ASC NULLS FIRST, d_date#25072 ASC NULLS FIRST], true\n      +- Filter ((isnotnull(web_cumulative#25075) && isnotnull(store_cumulative#25076)) && (web_cumulative#25075 > store_cumulative#25076))\n         +- Window [max(web_sales#25073) windowspecdefinition(item_sk#25071, d_date#25072 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS web_cumulative#25075, max(store_sales#25074) windowspecdefinition(item_sk#25071, d_date#25072 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS store_cumulative#25076], [item_sk#25071], [d_date#25072 ASC NULLS FIRST]\n            +- Project [CASE WHEN isnotnull(item_sk#25077) THEN item_sk#25077 ELSE item_sk#25079 END AS item_sk#25071, CASE WHEN isnotnull(d_date#1042) THEN d_date#1042 ELSE d_date#25089 END AS d_date#25072, cume_sales#25078 AS web_sales#25073, cume_sales#25080 AS store_sales#25074]\n               +- Join FullOuter, ((item_sk#25077 = item_sk#25079) && (d_date#1042 = d_date#25089))\n                  :- Project [item_sk#25077, d_date#1042, cume_sales#25078]\n                  :  +- Window [sum(_w0#25083) windowspecdefinition(ws_item_sk#1757, d_date#1042 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#25078], [ws_item_sk#1757], [d_date#1042 ASC NULLS FIRST]\n                  :     +- Aggregate [ws_item_sk#1757, d_date#1042], [ws_item_sk#1757 AS item_sk#25077, d_date#1042, MakeDecimal(sum(UnscaledValue(ws_sales_price#1775)),17,2) AS _w0#25083, ws_item_sk#1757]\n                  :        +- Project [ws_item_sk#1757, ws_sales_price#1775, d_date#1042]\n                  :           +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                  :              :- Project [ws_item_sk#1757, ws_sales_price#1775, ws_sold_date_sk#1788]\n                  :              :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n                  :              :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :              +- Project [d_date_sk#1040, d_date#1042]\n                  :                 +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                  :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  +- Project [item_sk#25079, d_date#25089, cume_sales#25080]\n                     +- Window [sum(_w0#25086) windowspecdefinition(ss_item_sk#1905, d_date#25089 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#25080], [ss_item_sk#1905], [d_date#25089 ASC NULLS FIRST]\n                        +- Aggregate [ss_item_sk#1905, d_date#25089], [ss_item_sk#1905 AS item_sk#25079, d_date#25089, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS _w0#25086, ss_item_sk#1905]\n                           +- Project [ss_item_sk#1905, ss_sales_price#1916, d_date#25089]\n                              +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#25087)\n                                 :- Project [ss_item_sk#1905, ss_sales_price#1916, ss_sold_date_sk#1926]\n                                 :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n                                 :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                 +- Project [d_date_sk#25087, d_date#25089]\n                                    +- Filter (((isnotnull(d_month_seq#25090) && (d_month_seq#25090 >= 1200)) && (d_month_seq#25090 <= 1211)) && isnotnull(d_date_sk#25087))\n                                       +- Relation[d_date_sk#25087,d_date_id#25088,d_date#25089,d_month_seq#25090,d_week_seq#25091,d_quarter_seq#25092,d_year#25093,d_dow#25094,d_moy#25095,d_dom#25096,d_qoy#25097,d_fy_year#25098,d_fy_quarter_seq#25099,d_fy_week_seq#25100,d_day_name#25101,d_quarter_name#25102,d_holiday#25103,d_weekend#25104,d_following_holiday#25105,d_first_dom#25106,d_last_dom#25107,d_same_day_ly#25108,d_same_day_lq#25109,d_current_day#25110,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[item_sk#25071 ASC NULLS FIRST,d_date#25072 ASC NULLS FIRST], output=[item_sk#25071,d_date#25072,web_sales#25073,store_sales#25074,web_cumulative#25075,store_cumulative#25076])\n+- *(15) Filter ((isnotnull(web_cumulative#25075) && isnotnull(store_cumulative#25076)) && (web_cumulative#25075 > store_cumulative#25076))\n   +- Window [max(web_sales#25073) windowspecdefinition(item_sk#25071, d_date#25072 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS web_cumulative#25075, max(store_sales#25074) windowspecdefinition(item_sk#25071, d_date#25072 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS store_cumulative#25076], [item_sk#25071], [d_date#25072 ASC NULLS FIRST]\n      +- *(14) Sort [item_sk#25071 ASC NULLS FIRST, d_date#25072 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(item_sk#25071, 200)\n            +- *(13) Project [CASE WHEN isnotnull(item_sk#25077) THEN item_sk#25077 ELSE item_sk#25079 END AS item_sk#25071, CASE WHEN isnotnull(d_date#1042) THEN d_date#1042 ELSE d_date#25089 END AS d_date#25072, cume_sales#25078 AS web_sales#25073, cume_sales#25080 AS store_sales#25074]\n               +- SortMergeJoin [item_sk#25077, d_date#1042], [item_sk#25079, d_date#25089], FullOuter\n                  :- *(6) Sort [item_sk#25077 ASC NULLS FIRST, d_date#1042 ASC NULLS FIRST], false, 0\n                  :  +- Exchange hashpartitioning(item_sk#25077, d_date#1042, 200)\n                  :     +- *(5) Project [item_sk#25077, d_date#1042, cume_sales#25078]\n                  :        +- Window [sum(_w0#25083) windowspecdefinition(ws_item_sk#1757, d_date#1042 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#25078], [ws_item_sk#1757], [d_date#1042 ASC NULLS FIRST]\n                  :           +- *(4) Sort [ws_item_sk#1757 ASC NULLS FIRST, d_date#1042 ASC NULLS FIRST], false, 0\n                  :              +- Exchange hashpartitioning(ws_item_sk#1757, 200)\n                  :                 +- *(3) HashAggregate(keys=[ws_item_sk#1757, d_date#1042], functions=[sum(UnscaledValue(ws_sales_price#1775))], output=[item_sk#25077, d_date#1042, _w0#25083, ws_item_sk#1757])\n                  :                    +- Exchange hashpartitioning(ws_item_sk#1757, d_date#1042, 200)\n                  :                       +- *(2) HashAggregate(keys=[ws_item_sk#1757, d_date#1042], functions=[partial_sum(UnscaledValue(ws_sales_price#1775))], output=[ws_item_sk#1757, d_date#1042, sum#25124L])\n                  :                          +- *(2) Project [ws_item_sk#1757, ws_sales_price#1775, d_date#1042]\n                  :                             +- *(2) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                  :                                :- *(2) Project [ws_item_sk#1757, ws_sales_price#1775, ws_sold_date_sk#1788]\n                  :                                :  +- *(2) Filter isnotnull(ws_item_sk#1757)\n                  :                                :     +- *(2) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_sales_price#1775,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_sales_price:decimal(7,2)>\n                  :                                +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :                                   +- *(1) Project [d_date_sk#1040, d_date#1042]\n                  :                                      +- *(1) Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                  :                                         +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042,d_month_seq#1043] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_date:date,d_month_seq:int>\n                  +- *(12) Sort [item_sk#25079 ASC NULLS FIRST, d_date#25089 ASC NULLS FIRST], false, 0\n                     +- Exchange hashpartitioning(item_sk#25079, d_date#25089, 200)\n                        +- *(11) Project [item_sk#25079, d_date#25089, cume_sales#25080]\n                           +- Window [sum(_w0#25086) windowspecdefinition(ss_item_sk#1905, d_date#25089 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS cume_sales#25080], [ss_item_sk#1905], [d_date#25089 ASC NULLS FIRST]\n                              +- *(10) Sort [ss_item_sk#1905 ASC NULLS FIRST, d_date#25089 ASC NULLS FIRST], false, 0\n                                 +- Exchange hashpartitioning(ss_item_sk#1905, 200)\n                                    +- *(9) HashAggregate(keys=[ss_item_sk#1905, d_date#25089], functions=[sum(UnscaledValue(ss_sales_price#1916))], output=[item_sk#25079, d_date#25089, _w0#25086, ss_item_sk#1905])\n                                       +- Exchange hashpartitioning(ss_item_sk#1905, d_date#25089, 200)\n                                          +- *(8) HashAggregate(keys=[ss_item_sk#1905, d_date#25089], functions=[partial_sum(UnscaledValue(ss_sales_price#1916))], output=[ss_item_sk#1905, d_date#25089, sum#25126L])\n                                             +- *(8) Project [ss_item_sk#1905, ss_sales_price#1916, d_date#25089]\n                                                +- *(8) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#25087], Inner, BuildRight\n                                                   :- *(8) Project [ss_item_sk#1905, ss_sales_price#1916, ss_sold_date_sk#1926]\n                                                   :  +- *(8) Filter isnotnull(ss_item_sk#1905)\n                                                   :     +- *(8) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_sales_price:decimal(7,2)>\n                                                   +- ReusedExchange [d_date_sk#25087, d_date#25089], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q52-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin"],"tables":["date_dim","store_sales","item"],"parsingTime":0.001955,"analysisTime":0.001148,"optimizationTime":266.43583,"planningTime":10.532501,"executionTime":1695.826556,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['dt.d_year ASC NULLS FIRST, 'ext_price DESC NULLS LAST, 'brand_id ASC NULLS FIRST], true\n      +- 'Aggregate ['dt.d_year, 'item.i_brand, 'item.i_brand_id], ['dt.d_year, 'item.i_brand_id AS brand_id#25997, 'item.i_brand AS brand#25998, 'sum('ss_ext_sales_price) AS ext_price#25999]\n         +- 'Filter (((('dt.d_date_sk = 'store_sales.ss_sold_date_sk) && ('store_sales.ss_item_sk = 'item.i_item_sk)) && ('item.i_manager_id = 1)) && (('dt.d_moy = 11) && ('dt.d_year = 2000)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'SubqueryAlias dt\n               :  :  +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `store_sales`\n               +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\nd_year: int, brand_id: int, brand: string, ext_price: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [d_year#1046 ASC NULLS FIRST, ext_price#25999 DESC NULLS LAST, brand_id#25997 ASC NULLS FIRST], true\n      +- Aggregate [d_year#1046, i_brand#1180, i_brand_id#1179], [d_year#1046, i_brand_id#1179 AS brand_id#25997, i_brand#1180 AS brand#25998, sum(ss_ext_sales_price#1918) AS ext_price#25999]\n         +- Filter ((((d_date_sk#1040 = ss_sold_date_sk#1926) && (ss_item_sk#1905 = i_item_sk#1172)) && (i_manager_id#1192 = 1)) && ((d_moy#1048 = 11) && (d_year#1046 = 2000)))\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias dt\n               :  :  +- SubqueryAlias date_dim\n               :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  +- SubqueryAlias store_sales\n               :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               +- SubqueryAlias item\n                  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [d_year#1046 ASC NULLS FIRST, ext_price#25999 DESC NULLS LAST, brand_id#25997 ASC NULLS FIRST], true\n      +- Aggregate [d_year#1046, i_brand#1180, i_brand_id#1179], [d_year#1046, i_brand_id#1179 AS brand_id#25997, i_brand#1180 AS brand#25998, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS ext_price#25999]\n         +- Project [d_year#1046, ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180]\n            +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :- Project [d_year#1046, ss_item_sk#1905, ss_ext_sales_price#1918]\n               :  +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n               :     :- Project [d_date_sk#1040, d_year#1046]\n               :     :  +- Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 11)) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n               :     :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n               :        +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_item_sk#1905))\n               :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               +- Project [i_item_sk#1172, i_brand_id#1179, i_brand#1180]\n                  +- Filter ((isnotnull(i_manager_id#1192) && (i_manager_id#1192 = 1)) && isnotnull(i_item_sk#1172))\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[d_year#1046 ASC NULLS FIRST,ext_price#25999 DESC NULLS LAST,brand_id#25997 ASC NULLS FIRST], output=[d_year#1046,brand_id#25997,brand#25998,ext_price#25999])\n+- *(4) HashAggregate(keys=[d_year#1046, i_brand#1180, i_brand_id#1179], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[d_year#1046, brand_id#25997, brand#25998, ext_price#25999])\n   +- Exchange hashpartitioning(d_year#1046, i_brand#1180, i_brand_id#1179, 200)\n      +- *(3) HashAggregate(keys=[d_year#1046, i_brand#1180, i_brand_id#1179], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[d_year#1046, i_brand#1180, i_brand_id#1179, sum#26009L])\n         +- *(3) Project [d_year#1046, ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180]\n            +- *(3) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :- *(3) Project [d_year#1046, ss_item_sk#1905, ss_ext_sales_price#1918]\n               :  +- *(3) BroadcastHashJoin [d_date_sk#1040], [ss_sold_date_sk#1926], Inner, BuildLeft\n               :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :  +- *(1) Project [d_date_sk#1040, d_year#1046]\n               :     :     +- *(1) Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 11)) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n               :     :        +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,11), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               :     +- *(3) Project [ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n               :        +- *(3) Filter isnotnull(ss_item_sk#1905)\n               :           +- *(3) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_ext_sales_price:decimal(7,2)>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(2) Project [i_item_sk#1172, i_brand_id#1179, i_brand#1180]\n                     +- *(2) Filter ((isnotnull(i_manager_id#1192) && (i_manager_id#1192 = 1)) && isnotnull(i_item_sk#1172))\n                        +- *(2) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_brand#1180,i_manager_id#1192] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_manager_id), EqualTo(i_manager_id,1), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_brand:string,i_manager_id:int>"},{"name":"q53-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["item","store_sales","date_dim","store"],"parsingTime":0.002037,"analysisTime":9.94E-4,"optimizationTime":279.696597,"planningTime":12.43965,"executionTime":3352.79517,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['avg_quarterly_sales ASC NULLS FIRST, 'sum_sales ASC NULLS FIRST, 'i_manufact_id ASC NULLS FIRST], true\n      +- 'Project [*]\n         +- 'Filter (CASE WHEN ('avg_quarterly_sales > 0) THEN ('abs(('sum_sales - 'avg_quarterly_sales)) / 'avg_quarterly_sales) ELSE null END > 0.1)\n            +- 'SubqueryAlias tmp1\n               +- 'Aggregate ['i_manufact_id, 'd_qoy], ['i_manufact_id, 'sum('ss_sales_price) AS sum_sales#26033, 'avg('sum('ss_sales_price)) windowspecdefinition('i_manufact_id, unspecifiedframe$()) AS avg_quarterly_sales#26034]\n                  +- 'Filter (((('ss_item_sk = 'i_item_sk) && ('ss_sold_date_sk = 'd_date_sk)) && ('ss_store_sk = 's_store_sk)) && ('d_month_seq IN (1200,(1200 + 1),(1200 + 2),(1200 + 3),(1200 + 4),(1200 + 5),(1200 + 6),(1200 + 7),(1200 + 8),(1200 + 9),(1200 + 10),(1200 + 11)) && ((('i_category IN (Books,Children,Electronics) && 'i_class IN (personal,portable,reference,self-help)) && 'i_brand IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) || (('i_category IN (Women,Music,Men) && 'i_class IN (accessories,classical,fragrances,pants)) && 'i_brand IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1)))))\n                     +- 'Join Inner\n                        :- 'Join Inner\n                        :  :- 'Join Inner\n                        :  :  :- 'UnresolvedRelation `item`\n                        :  :  +- 'UnresolvedRelation `store_sales`\n                        :  +- 'UnresolvedRelation `date_dim`\n                        +- 'UnresolvedRelation `store`\n\n== Analyzed Logical Plan ==\ni_manufact_id: int, sum_sales: decimal(17,2), avg_quarterly_sales: decimal(21,6)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [avg_quarterly_sales#26034 ASC NULLS FIRST, sum_sales#26033 ASC NULLS FIRST, i_manufact_id#1185 ASC NULLS FIRST], true\n      +- Project [i_manufact_id#1185, sum_sales#26033, avg_quarterly_sales#26034]\n         +- Filter (cast(CASE WHEN (cast(avg_quarterly_sales#26034 as decimal(21,6)) > cast(cast(0 as decimal(1,0)) as decimal(21,6))) THEN CheckOverflow((promote_precision(cast(abs(CheckOverflow((promote_precision(cast(sum_sales#26033 as decimal(22,6))) - promote_precision(cast(avg_quarterly_sales#26034 as decimal(22,6)))), DecimalType(22,6))) as decimal(22,6))) / promote_precision(cast(avg_quarterly_sales#26034 as decimal(22,6)))), DecimalType(38,16)) ELSE cast(null as decimal(38,16)) END as decimal(38,16)) > cast(0.1 as decimal(38,16)))\n            +- SubqueryAlias tmp1\n               +- Project [i_manufact_id#1185, sum_sales#26033, avg_quarterly_sales#26034]\n                  +- Project [i_manufact_id#1185, sum_sales#26033, _w0#26038, avg_quarterly_sales#26034, avg_quarterly_sales#26034]\n                     +- Window [avg(_w0#26038) windowspecdefinition(i_manufact_id#1185, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_quarterly_sales#26034], [i_manufact_id#1185]\n                        +- Aggregate [i_manufact_id#1185, d_qoy#1050], [i_manufact_id#1185, sum(ss_sales_price#1916) AS sum_sales#26033, sum(ss_sales_price#1916) AS _w0#26038]\n                           +- Filter ((((ss_item_sk#1905 = i_item_sk#1172) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && (ss_store_sk#1910 = s_store_sk#1386)) && (d_month_seq#1043 IN (1200,(1200 + 1),(1200 + 2),(1200 + 3),(1200 + 4),(1200 + 5),(1200 + 6),(1200 + 7),(1200 + 8),(1200 + 9),(1200 + 10),(1200 + 11)) && (((i_category#1184 IN (Books,Children,Electronics) && i_class#1182 IN (personal,portable,reference,self-help)) && i_brand#1180 IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) || ((i_category#1184 IN (Women,Music,Men) && i_class#1182 IN (accessories,classical,fragrances,pants)) && i_brand#1180 IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1)))))\n                              +- Join Inner\n                                 :- Join Inner\n                                 :  :- Join Inner\n                                 :  :  :- SubqueryAlias item\n                                 :  :  :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                                 :  :  +- SubqueryAlias store_sales\n                                 :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                 :  +- SubqueryAlias date_dim\n                                 :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                 +- SubqueryAlias store\n                                    +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [avg_quarterly_sales#26034 ASC NULLS FIRST, sum_sales#26033 ASC NULLS FIRST, i_manufact_id#1185 ASC NULLS FIRST], true\n      +- Project [i_manufact_id#1185, sum_sales#26033, avg_quarterly_sales#26034]\n         +- Filter (CASE WHEN (avg_quarterly_sales#26034 > 0.000000) THEN CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#26033 as decimal(22,6))) - promote_precision(cast(avg_quarterly_sales#26034 as decimal(22,6)))), DecimalType(22,6)))) / promote_precision(cast(avg_quarterly_sales#26034 as decimal(22,6)))), DecimalType(38,16)) ELSE null END > 0.1000000000000000)\n            +- Window [avg(_w0#26038) windowspecdefinition(i_manufact_id#1185, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_quarterly_sales#26034], [i_manufact_id#1185]\n               +- Aggregate [i_manufact_id#1185, d_qoy#1050], [i_manufact_id#1185, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS sum_sales#26033, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS _w0#26038]\n                  +- Project [i_manufact_id#1185, ss_sales_price#1916, d_qoy#1050]\n                     +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n                        :- Project [i_manufact_id#1185, ss_store_sk#1910, ss_sales_price#1916, d_qoy#1050]\n                        :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                        :     :- Project [i_manufact_id#1185, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                        :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                        :     :     :- Project [i_item_sk#1172, i_manufact_id#1185]\n                        :     :     :  +- Filter ((((i_category#1184 IN (Books,Children,Electronics) && i_class#1182 IN (personal,portable,reference,self-help)) && i_brand#1180 IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) || ((i_category#1184 IN (Women,Music,Men) && i_class#1182 IN (accessories,classical,fragrances,pants)) && i_brand#1180 IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1))) && isnotnull(i_item_sk#1172))\n                        :     :     :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :     :     +- Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                        :     :        +- Filter ((isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_store_sk#1910))\n                        :     :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :     +- Project [d_date_sk#1040, d_qoy#1050]\n                        :        +- Filter (d_month_seq#1043 INSET (1200,1211,1205,1201,1206,1210,1207,1202,1209,1203,1208,1204) && isnotnull(d_date_sk#1040))\n                        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Project [s_store_sk#1386]\n                           +- Filter isnotnull(s_store_sk#1386)\n                              +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[avg_quarterly_sales#26034 ASC NULLS FIRST,sum_sales#26033 ASC NULLS FIRST,i_manufact_id#1185 ASC NULLS FIRST], output=[i_manufact_id#1185,sum_sales#26033,avg_quarterly_sales#26034])\n+- *(7) Project [i_manufact_id#1185, sum_sales#26033, avg_quarterly_sales#26034]\n   +- *(7) Filter (CASE WHEN (avg_quarterly_sales#26034 > 0.000000) THEN CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#26033 as decimal(22,6))) - promote_precision(cast(avg_quarterly_sales#26034 as decimal(22,6)))), DecimalType(22,6)))) / promote_precision(cast(avg_quarterly_sales#26034 as decimal(22,6)))), DecimalType(38,16)) ELSE null END > 0.1000000000000000)\n      +- Window [avg(_w0#26038) windowspecdefinition(i_manufact_id#1185, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_quarterly_sales#26034], [i_manufact_id#1185]\n         +- *(6) Sort [i_manufact_id#1185 ASC NULLS FIRST], false, 0\n            +- Exchange hashpartitioning(i_manufact_id#1185, 200)\n               +- *(5) HashAggregate(keys=[i_manufact_id#1185, d_qoy#1050], functions=[sum(UnscaledValue(ss_sales_price#1916))], output=[i_manufact_id#1185, sum_sales#26033, _w0#26038])\n                  +- Exchange hashpartitioning(i_manufact_id#1185, d_qoy#1050, 200)\n                     +- *(4) HashAggregate(keys=[i_manufact_id#1185, d_qoy#1050], functions=[partial_sum(UnscaledValue(ss_sales_price#1916))], output=[i_manufact_id#1185, d_qoy#1050, sum#26043L])\n                        +- *(4) Project [i_manufact_id#1185, ss_sales_price#1916, d_qoy#1050]\n                           +- *(4) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                              :- *(4) Project [i_manufact_id#1185, ss_store_sk#1910, ss_sales_price#1916, d_qoy#1050]\n                              :  +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                              :     :- *(4) Project [i_manufact_id#1185, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                              :     :  +- *(4) BroadcastHashJoin [i_item_sk#1172], [ss_item_sk#1905], Inner, BuildLeft\n                              :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :  +- *(1) Project [i_item_sk#1172, i_manufact_id#1185]\n                              :     :     :     +- *(1) Filter ((((i_category#1184 IN (Books,Children,Electronics) && i_class#1182 IN (personal,portable,reference,self-help)) && i_brand#1180 IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) || ((i_category#1184 IN (Women,Music,Men) && i_class#1182 IN (accessories,classical,fragrances,pants)) && i_brand#1180 IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1))) && isnotnull(i_item_sk#1172))\n                              :     :     :        +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand#1180,i_class#1182,i_category#1184,i_manufact_id#1185] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [Or(And(And(In(i_category, [Books,Children,Electronics]),In(i_class, [personal,portable,reference..., ReadSchema: struct<i_item_sk:int,i_brand:string,i_class:string,i_category:string,i_manufact_id:int>\n                              :     :     +- *(4) Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                              :     :        +- *(4) Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_store_sk#1910))\n                              :     :           +- *(4) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_store_sk#1910,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>\n                              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :        +- *(2) Project [d_date_sk#1040, d_qoy#1050]\n                              :           +- *(2) Filter (d_month_seq#1043 INSET (1200,1211,1205,1201,1206,1210,1207,1202,1209,1203,1208,1204) && isnotnull(d_date_sk#1040))\n                              :              +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_month_seq#1043,d_qoy#1050] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [In(d_month_seq, [1200,1211,1205,1201,1206,1210,1207,1202,1209,1203,1208,1204]), IsNotNull(d_date..., ReadSchema: struct<d_date_sk:int,d_month_seq:int,d_qoy:int>\n                              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 +- *(3) Project [s_store_sk#1386]\n                                    +- *(3) Filter isnotnull(s_store_sk#1386)\n                                       +- *(3) FileScan parquet db_tpcds.store[s_store_sk#1386] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int>"},{"name":"q54-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["segments"],"parsingTime":0.002615,"analysisTime":0.001388,"optimizationTime":909.778553,"planningTime":98.442929,"executionTime":8852.683436,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [my_customers, my_revenue, segments]\n:  :- 'SubqueryAlias my_customers\n:  :  +- 'Distinct\n:  :     +- 'Project ['c_customer_sk, 'c_current_addr_sk]\n:  :        +- 'Filter (((('sold_date_sk = 'd_date_sk) && ('item_sk = 'i_item_sk)) && (('i_category = Women) && ('i_class = maternity))) && ((('c_customer_sk = 'cs_or_ws_sales.customer_sk) && ('d_moy = 12)) && ('d_year = 1998)))\n:  :           +- 'Join Inner\n:  :              :- 'Join Inner\n:  :              :  :- 'Join Inner\n:  :              :  :  :- 'SubqueryAlias cs_or_ws_sales\n:  :              :  :  :  +- 'Union\n:  :              :  :  :     :- 'Project ['cs_sold_date_sk AS sold_date_sk#26481, 'cs_bill_customer_sk AS customer_sk#26482, 'cs_item_sk AS item_sk#26483]\n:  :              :  :  :     :  +- 'UnresolvedRelation `catalog_sales`\n:  :              :  :  :     +- 'Project ['ws_sold_date_sk AS sold_date_sk#26484, 'ws_bill_customer_sk AS customer_sk#26485, 'ws_item_sk AS item_sk#26486]\n:  :              :  :  :        +- 'UnresolvedRelation `web_sales`\n:  :              :  :  +- 'UnresolvedRelation `item`\n:  :              :  +- 'UnresolvedRelation `date_dim`\n:  :              +- 'UnresolvedRelation `customer`\n:  :- 'SubqueryAlias my_revenue\n:  :  +- 'Aggregate ['c_customer_sk], ['c_customer_sk, 'sum('ss_ext_sales_price) AS revenue#26487]\n:  :     +- 'Filter (((('c_current_addr_sk = 'ca_address_sk) && ('ca_county = 's_county)) && ('ca_state = 's_state)) && ((('ss_sold_date_sk = 'd_date_sk) && ('c_customer_sk = 'ss_customer_sk)) && (('d_month_seq >= scalar-subquery#26488 []) && ('d_month_seq <= scalar-subquery#26489 []))))\n:  :        :  :- 'Distinct\n:  :        :  :  +- 'Project [unresolvedalias(('d_month_seq + 1), None)]\n:  :        :  :     +- 'Filter (('d_year = 1998) && ('d_moy = 12))\n:  :        :  :        +- 'UnresolvedRelation `date_dim`\n:  :        :  +- 'Distinct\n:  :        :     +- 'Project [unresolvedalias(('d_month_seq + 3), None)]\n:  :        :        +- 'Filter (('d_year = 1998) && ('d_moy = 12))\n:  :        :           +- 'UnresolvedRelation `date_dim`\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'Join Inner\n:  :           :  :  :- 'Join Inner\n:  :           :  :  :  :- 'UnresolvedRelation `my_customers`\n:  :           :  :  :  +- 'UnresolvedRelation `store_sales`\n:  :           :  :  +- 'UnresolvedRelation `customer_address`\n:  :           :  +- 'UnresolvedRelation `store`\n:  :           +- 'UnresolvedRelation `date_dim`\n:  +- 'SubqueryAlias segments\n:     +- 'Project [cast(('revenue / 50) as int) AS segment#26490]\n:        +- 'UnresolvedRelation `my_revenue`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['segment ASC NULLS FIRST, 'num_customers ASC NULLS FIRST], true\n         +- 'Aggregate ['segment], ['segment, 'count(1) AS num_customers#26479, ('segment * 50) AS segment_base#26480]\n            +- 'UnresolvedRelation `segments`\n\n== Analyzed Logical Plan ==\nsegment: int, num_customers: bigint, segment_base: int\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [segment#26490 ASC NULLS FIRST, num_customers#26479L ASC NULLS FIRST], true\n      +- Aggregate [segment#26490], [segment#26490, count(1) AS num_customers#26479L, (segment#26490 * 50) AS segment_base#26480]\n         +- SubqueryAlias segments\n            +- Project [cast(CheckOverflow((promote_precision(cast(revenue#26487 as decimal(17,2))) / promote_precision(cast(cast(50 as decimal(2,0)) as decimal(17,2)))), DecimalType(21,6)) as int) AS segment#26490]\n               +- SubqueryAlias my_revenue\n                  +- Aggregate [c_customer_sk#860], [c_customer_sk#860, sum(ss_ext_sales_price#1918) AS revenue#26487]\n                     +- Filter ((((c_current_addr_sk#864 = ca_address_sk#922) && (ca_county#929 = s_county#1409)) && (ca_state#930 = s_state#1410)) && (((ss_sold_date_sk#1926 = d_date_sk#1040) && (c_customer_sk#860 = ss_customer_sk#1906)) && ((d_month_seq#1043 >= scalar-subquery#26488 []) && (d_month_seq#1043 <= scalar-subquery#26489 []))))\n                        :  :- Distinct\n                        :  :  +- Project [(d_month_seq#1043 + 1) AS (d_month_seq + 1)#26491]\n                        :  :     +- Filter ((d_year#1046 = 1998) && (d_moy#1048 = 12))\n                        :  :        +- SubqueryAlias date_dim\n                        :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :  +- Distinct\n                        :     +- Project [(d_month_seq#1043 + 3) AS (d_month_seq + 3)#26492]\n                        :        +- Filter ((d_year#1046 = 1998) && (d_moy#1048 = 12))\n                        :           +- SubqueryAlias date_dim\n                        :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Join Inner\n                           :- Join Inner\n                           :  :- Join Inner\n                           :  :  :- Join Inner\n                           :  :  :  :- SubqueryAlias my_customers\n                           :  :  :  :  +- Distinct\n                           :  :  :  :     +- Project [c_customer_sk#860, c_current_addr_sk#864]\n                           :  :  :  :        +- Filter ((((sold_date_sk#26481 = d_date_sk#1040) && (item_sk#26483 = i_item_sk#1172)) && ((i_category#1184 = Women) && (i_class#1182 = maternity))) && (((c_customer_sk#860 = customer_sk#26482) && (d_moy#1048 = 12)) && (d_year#1046 = 1998)))\n                           :  :  :  :           +- Join Inner\n                           :  :  :  :              :- Join Inner\n                           :  :  :  :              :  :- Join Inner\n                           :  :  :  :              :  :  :- SubqueryAlias cs_or_ws_sales\n                           :  :  :  :              :  :  :  +- Union\n                           :  :  :  :              :  :  :     :- Project [cs_sold_date_sk#1822 AS sold_date_sk#26481, cs_bill_customer_sk#1791 AS customer_sk#26482, cs_item_sk#1803 AS item_sk#26483]\n                           :  :  :  :              :  :  :     :  +- SubqueryAlias catalog_sales\n                           :  :  :  :              :  :  :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                           :  :  :  :              :  :  :     +- Project [ws_sold_date_sk#1788 AS sold_date_sk#26484, ws_bill_customer_sk#1758 AS customer_sk#26485, ws_item_sk#1757 AS item_sk#26486]\n                           :  :  :  :              :  :  :        +- SubqueryAlias web_sales\n                           :  :  :  :              :  :  :           +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                           :  :  :  :              :  :  +- SubqueryAlias item\n                           :  :  :  :              :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                           :  :  :  :              :  +- SubqueryAlias date_dim\n                           :  :  :  :              :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                           :  :  :  :              +- SubqueryAlias customer\n                           :  :  :  :                 +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                           :  :  :  +- SubqueryAlias store_sales\n                           :  :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                           :  :  +- SubqueryAlias customer_address\n                           :  :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                           :  +- SubqueryAlias store\n                           :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                           +- SubqueryAlias date_dim\n                              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [segment#26490 ASC NULLS FIRST, num_customers#26479L ASC NULLS FIRST], true\n      +- Aggregate [segment#26490], [segment#26490, count(1) AS num_customers#26479L, (segment#26490 * 50) AS segment_base#26480]\n         +- Aggregate [c_customer_sk#860], [cast(CheckOverflow((promote_precision(MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2)) / 50.00), DecimalType(21,6)) as int) AS segment#26490]\n            +- Project [c_customer_sk#860, ss_ext_sales_price#1918]\n               +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                  :- Project [c_customer_sk#860, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                  :  +- Join Inner, ((ca_county#929 = s_county#1409) && (ca_state#930 = s_state#1410))\n                  :     :- Project [c_customer_sk#860, ss_ext_sales_price#1918, ss_sold_date_sk#1926, ca_county#929, ca_state#930]\n                  :     :  +- Join Inner, (c_current_addr_sk#864 = ca_address_sk#922)\n                  :     :     :- Project [c_customer_sk#860, c_current_addr_sk#864, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                  :     :     :  +- Join Inner, (c_customer_sk#860 = ss_customer_sk#1906)\n                  :     :     :     :- Aggregate [c_customer_sk#860, c_current_addr_sk#864], [c_customer_sk#860, c_current_addr_sk#864]\n                  :     :     :     :  +- Project [c_customer_sk#860, c_current_addr_sk#864]\n                  :     :     :     :     +- Join Inner, (c_customer_sk#860 = customer_sk#26482)\n                  :     :     :     :        :- Project [customer_sk#26482]\n                  :     :     :     :        :  +- Join Inner, (sold_date_sk#26481 = d_date_sk#1040)\n                  :     :     :     :        :     :- Project [sold_date_sk#26481, customer_sk#26482]\n                  :     :     :     :        :     :  +- Join Inner, (item_sk#26483 = i_item_sk#1172)\n                  :     :     :     :        :     :     :- Union\n                  :     :     :     :        :     :     :  :- Project [cs_sold_date_sk#1822 AS sold_date_sk#26481, cs_bill_customer_sk#1791 AS customer_sk#26482, cs_item_sk#1803 AS item_sk#26483]\n                  :     :     :     :        :     :     :  :  +- Filter ((isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822)) && isnotnull(cs_bill_customer_sk#1791))\n                  :     :     :     :        :     :     :  :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                  :     :     :     :        :     :     :  +- Project [ws_sold_date_sk#1788 AS sold_date_sk#26484, ws_bill_customer_sk#1758 AS customer_sk#26485, ws_item_sk#1757 AS item_sk#26486]\n                  :     :     :     :        :     :     :     +- Filter ((isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788)) && isnotnull(ws_bill_customer_sk#1758))\n                  :     :     :     :        :     :     :        +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :     :     :     :        :     :     +- Project [i_item_sk#1172]\n                  :     :     :     :        :     :        +- Filter ((((isnotnull(i_category#1184) && isnotnull(i_class#1182)) && (i_category#1184 = Women)) && (i_class#1182 = maternity)) && isnotnull(i_item_sk#1172))\n                  :     :     :     :        :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  :     :     :     :        :     +- Project [d_date_sk#1040]\n                  :     :     :     :        :        +- Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 12)) && (d_year#1046 = 1998)) && isnotnull(d_date_sk#1040))\n                  :     :     :     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :     :     :     :        +- Project [c_customer_sk#860, c_current_addr_sk#864]\n                  :     :     :     :           +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n                  :     :     :     :              +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :     :     :     +- Project [ss_customer_sk#1906, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                  :     :     :        +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n                  :     :     :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :     :     +- Project [ca_address_sk#922, ca_county#929, ca_state#930]\n                  :     :        +- Filter ((isnotnull(ca_address_sk#922) && isnotnull(ca_county#929)) && isnotnull(ca_state#930))\n                  :     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  :     +- Project [s_county#1409, s_state#1410]\n                  :        +- Filter (isnotnull(s_state#1410) && isnotnull(s_county#1409))\n                  :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                  +- Project [d_date_sk#1040]\n                     +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= scalar-subquery#26488 [])) && (d_month_seq#1043 <= scalar-subquery#26489 [])) && isnotnull(d_date_sk#1040))\n                        :  :- Aggregate [(d_month_seq + 1)#26491], [(d_month_seq + 1)#26491]\n                        :  :  +- Project [(d_month_seq#1043 + 1) AS (d_month_seq + 1)#26491]\n                        :  :     +- Filter (((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 12))\n                        :  :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :  +- Aggregate [(d_month_seq + 3)#26492], [(d_month_seq + 3)#26492]\n                        :     +- Project [(d_month_seq#1043 + 3) AS (d_month_seq + 3)#26492]\n                        :        +- Filter (((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 12))\n                        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[segment#26490 ASC NULLS FIRST,num_customers#26479L ASC NULLS FIRST], output=[segment#26490,num_customers#26479L,segment_base#26480])\n+- *(15) HashAggregate(keys=[segment#26490], functions=[count(1)], output=[segment#26490, num_customers#26479L, segment_base#26480])\n   +- Exchange hashpartitioning(segment#26490, 200)\n      +- *(14) HashAggregate(keys=[segment#26490], functions=[partial_count(1)], output=[segment#26490, count#26501L])\n         +- *(14) HashAggregate(keys=[c_customer_sk#860], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[segment#26490])\n            +- *(14) HashAggregate(keys=[c_customer_sk#860], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[c_customer_sk#860, sum#26503L])\n               +- *(14) Project [c_customer_sk#860, ss_ext_sales_price#1918]\n                  +- *(14) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                     :- *(14) Project [c_customer_sk#860, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                     :  +- *(14) BroadcastHashJoin [ca_county#929, ca_state#930], [s_county#1409, s_state#1410], Inner, BuildRight\n                     :     :- *(14) Project [c_customer_sk#860, ss_ext_sales_price#1918, ss_sold_date_sk#1926, ca_county#929, ca_state#930]\n                     :     :  +- *(14) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n                     :     :     :- *(14) Project [c_customer_sk#860, c_current_addr_sk#864, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                     :     :     :  +- *(14) SortMergeJoin [c_customer_sk#860], [ss_customer_sk#1906], Inner\n                     :     :     :     :- *(8) Sort [c_customer_sk#860 ASC NULLS FIRST], false, 0\n                     :     :     :     :  +- Exchange hashpartitioning(c_customer_sk#860, 200)\n                     :     :     :     :     +- *(7) HashAggregate(keys=[c_customer_sk#860, c_current_addr_sk#864], functions=[], output=[c_customer_sk#860, c_current_addr_sk#864])\n                     :     :     :     :        +- Exchange hashpartitioning(c_customer_sk#860, c_current_addr_sk#864, 200)\n                     :     :     :     :           +- *(6) HashAggregate(keys=[c_customer_sk#860, c_current_addr_sk#864], functions=[], output=[c_customer_sk#860, c_current_addr_sk#864])\n                     :     :     :     :              +- *(6) Project [c_customer_sk#860, c_current_addr_sk#864]\n                     :     :     :     :                 +- *(6) BroadcastHashJoin [customer_sk#26482], [c_customer_sk#860], Inner, BuildRight\n                     :     :     :     :                    :- *(6) Project [customer_sk#26482]\n                     :     :     :     :                    :  +- *(6) BroadcastHashJoin [sold_date_sk#26481], [d_date_sk#1040], Inner, BuildRight\n                     :     :     :     :                    :     :- *(6) Project [sold_date_sk#26481, customer_sk#26482]\n                     :     :     :     :                    :     :  +- *(6) BroadcastHashJoin [item_sk#26483], [i_item_sk#1172], Inner, BuildRight\n                     :     :     :     :                    :     :     :- Union\n                     :     :     :     :                    :     :     :  :- *(1) Project [cs_sold_date_sk#1822 AS sold_date_sk#26481, cs_bill_customer_sk#1791 AS customer_sk#26482, cs_item_sk#1803 AS item_sk#26483]\n                     :     :     :     :                    :     :     :  :  +- *(1) Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_bill_customer_sk#1791))\n                     :     :     :     :                    :     :     :  :     +- *(1) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_item_sk#1803,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:int,cs_item_sk:int>\n                     :     :     :     :                    :     :     :  +- *(2) Project [ws_sold_date_sk#1788 AS sold_date_sk#26484, ws_bill_customer_sk#1758 AS customer_sk#26485, ws_item_sk#1757 AS item_sk#26486]\n                     :     :     :     :                    :     :     :     +- *(2) Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_bill_customer_sk#1758))\n                     :     :     :     :                    :     :     :        +- *(2) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_bill_customer_sk#1758,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_item_sk:int,ws_bill_customer_sk:int>\n                     :     :     :     :                    :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :     :     :     :                    :     :        +- *(3) Project [i_item_sk#1172]\n                     :     :     :     :                    :     :           +- *(3) Filter ((((isnotnull(i_category#1184) && isnotnull(i_class#1182)) && (i_category#1184 = Women)) && (i_class#1182 = maternity)) && isnotnull(i_item_sk#1172))\n                     :     :     :     :                    :     :              +- *(3) FileScan parquet db_tpcds.item[i_item_sk#1172,i_class#1182,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_category), IsNotNull(i_class), EqualTo(i_category,Women), EqualTo(i_class,maternity)..., ReadSchema: struct<i_item_sk:int,i_class:string,i_category:string>\n                     :     :     :     :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :     :     :     :                    :        +- *(4) Project [d_date_sk#1040]\n                     :     :     :     :                    :           +- *(4) Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 12)) && (d_year#1046 = 1998)) && isnotnull(d_date_sk#1040))\n                     :     :     :     :                    :              +- *(4) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,12), EqualTo(d_year,1998), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n                     :     :     :     :                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :     :     :     :                       +- *(5) Project [c_customer_sk#860, c_current_addr_sk#864]\n                     :     :     :     :                          +- *(5) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n                     :     :     :     :                             +- *(5) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_addr_sk#864] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:int,c_current_addr_sk:int>\n                     :     :     :     +- *(10) Sort [ss_customer_sk#1906 ASC NULLS FIRST], false, 0\n                     :     :     :        +- Exchange hashpartitioning(ss_customer_sk#1906, 200)\n                     :     :     :           +- *(9) Project [ss_customer_sk#1906, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                     :     :     :              +- *(9) Filter isnotnull(ss_customer_sk#1906)\n                     :     :     :                 +- *(9) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_ext_sales_price:decimal(7,2)>\n                     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :     :        +- *(11) Project [ca_address_sk#922, ca_county#929, ca_state#930]\n                     :     :           +- *(11) Filter ((isnotnull(ca_address_sk#922) && isnotnull(ca_county#929)) && isnotnull(ca_state#930))\n                     :     :              +- *(11) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_county#929,ca_state#930] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_county), IsNotNull(ca_state)], ReadSchema: struct<ca_address_sk:int,ca_county:string,ca_state:string>\n                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true], input[1, string, true]))\n                     :        +- *(12) Project [s_county#1409, s_state#1410]\n                     :           +- *(12) Filter (isnotnull(s_state#1410) && isnotnull(s_county#1409))\n                     :              +- *(12) FileScan parquet db_tpcds.store[s_county#1409,s_state#1410] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_state), IsNotNull(s_county)], ReadSchema: struct<s_county:string,s_state:string>\n                     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        +- *(13) Project [d_date_sk#1040]\n                           +- *(13) Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= Subquery subquery26488)) && (d_month_seq#1043 <= Subquery subquery26489)) && isnotnull(d_date_sk#1040))\n                              :  :- Subquery subquery26488\n                              :  :  +- *(2) HashAggregate(keys=[(d_month_seq + 1)#26491], functions=[], output=[(d_month_seq + 1)#26491])\n                              :  :     +- Exchange hashpartitioning((d_month_seq + 1)#26491, 200)\n                              :  :        +- *(1) HashAggregate(keys=[(d_month_seq + 1)#26491], functions=[], output=[(d_month_seq + 1)#26491])\n                              :  :           +- *(1) Project [(d_month_seq#1043 + 1) AS (d_month_seq + 1)#26491]\n                              :  :              +- *(1) Filter (((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 12))\n                              :  :                 +- *(1) FileScan parquet db_tpcds.date_dim[d_month_seq#1043,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1998), EqualTo(d_moy,12)], ReadSchema: struct<d_month_seq:int,d_year:int,d_moy:int>\n                              :  +- Subquery subquery26489\n                              :     +- *(2) HashAggregate(keys=[(d_month_seq + 3)#26492], functions=[], output=[(d_month_seq + 3)#26492])\n                              :        +- Exchange hashpartitioning((d_month_seq + 3)#26492, 200)\n                              :           +- *(1) HashAggregate(keys=[(d_month_seq + 3)#26492], functions=[], output=[(d_month_seq + 3)#26492])\n                              :              +- *(1) Project [(d_month_seq#1043 + 3) AS (d_month_seq + 3)#26492]\n                              :                 +- *(1) Filter (((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 12))\n                              :                    +- *(1) FileScan parquet db_tpcds.date_dim[d_month_seq#1043,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1998), EqualTo(d_moy,12)], ReadSchema: struct<d_month_seq:int,d_year:int,d_moy:int>\n                              +- *(13) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_month_seq#1043] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_month_seq:int>\n                                    :- Subquery subquery26488\n                                    :  +- *(2) HashAggregate(keys=[(d_month_seq + 1)#26491], functions=[], output=[(d_month_seq + 1)#26491])\n                                    :     +- Exchange hashpartitioning((d_month_seq + 1)#26491, 200)\n                                    :        +- *(1) HashAggregate(keys=[(d_month_seq + 1)#26491], functions=[], output=[(d_month_seq + 1)#26491])\n                                    :           +- *(1) Project [(d_month_seq#1043 + 1) AS (d_month_seq + 1)#26491]\n                                    :              +- *(1) Filter (((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 12))\n                                    :                 +- *(1) FileScan parquet db_tpcds.date_dim[d_month_seq#1043,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1998), EqualTo(d_moy,12)], ReadSchema: struct<d_month_seq:int,d_year:int,d_moy:int>\n                                    +- Subquery subquery26489\n                                       +- *(2) HashAggregate(keys=[(d_month_seq + 3)#26492], functions=[], output=[(d_month_seq + 3)#26492])\n                                          +- Exchange hashpartitioning((d_month_seq + 3)#26492, 200)\n                                             +- *(1) HashAggregate(keys=[(d_month_seq + 3)#26492], functions=[], output=[(d_month_seq + 3)#26492])\n                                                +- *(1) Project [(d_month_seq#1043 + 3) AS (d_month_seq + 3)#26492]\n                                                   +- *(1) Filter (((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 12))\n                                                      +- *(1) FileScan parquet db_tpcds.date_dim[d_month_seq#1043,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1998), EqualTo(d_moy,12)], ReadSchema: struct<d_month_seq:int,d_year:int,d_moy:int>"},{"name":"q55-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin"],"tables":["date_dim","store_sales","item"],"parsingTime":0.002047,"analysisTime":0.001264,"optimizationTime":272.835294,"planningTime":13.23896,"executionTime":1672.539085,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['ext_price DESC NULLS LAST, 'brand_id ASC NULLS FIRST], true\n      +- 'Aggregate ['i_brand, 'i_brand_id], ['i_brand_id AS brand_id#26537, 'i_brand AS brand#26538, 'sum('ss_ext_sales_price) AS ext_price#26539]\n         +- 'Filter (((('d_date_sk = 'ss_sold_date_sk) && ('ss_item_sk = 'i_item_sk)) && ('i_manager_id = 28)) && (('d_moy = 11) && ('d_year = 1999)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `store_sales`\n               +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\nbrand_id: int, brand: string, ext_price: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [ext_price#26539 DESC NULLS LAST, brand_id#26537 ASC NULLS FIRST], true\n      +- Aggregate [i_brand#1180, i_brand_id#1179], [i_brand_id#1179 AS brand_id#26537, i_brand#1180 AS brand#26538, sum(ss_ext_sales_price#1918) AS ext_price#26539]\n         +- Filter ((((d_date_sk#1040 = ss_sold_date_sk#1926) && (ss_item_sk#1905 = i_item_sk#1172)) && (i_manager_id#1192 = 28)) && ((d_moy#1048 = 11) && (d_year#1046 = 1999)))\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias date_dim\n               :  :  +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  +- SubqueryAlias store_sales\n               :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               +- SubqueryAlias item\n                  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [ext_price#26539 DESC NULLS LAST, brand_id#26537 ASC NULLS FIRST], true\n      +- Aggregate [i_brand#1180, i_brand_id#1179], [i_brand_id#1179 AS brand_id#26537, i_brand#1180 AS brand#26538, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS ext_price#26539]\n         +- Project [ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180]\n            +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :- Project [ss_item_sk#1905, ss_ext_sales_price#1918]\n               :  +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n               :     :- Project [d_date_sk#1040]\n               :     :  +- Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 11)) && (d_year#1046 = 1999)) && isnotnull(d_date_sk#1040))\n               :     :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n               :        +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_item_sk#1905))\n               :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               +- Project [i_item_sk#1172, i_brand_id#1179, i_brand#1180]\n                  +- Filter ((isnotnull(i_manager_id#1192) && (i_manager_id#1192 = 28)) && isnotnull(i_item_sk#1172))\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[ext_price#26539 DESC NULLS LAST,brand_id#26537 ASC NULLS FIRST], output=[brand_id#26537,brand#26538,ext_price#26539])\n+- *(4) HashAggregate(keys=[i_brand#1180, i_brand_id#1179], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[brand_id#26537, brand#26538, ext_price#26539])\n   +- Exchange hashpartitioning(i_brand#1180, i_brand_id#1179, 200)\n      +- *(3) HashAggregate(keys=[i_brand#1180, i_brand_id#1179], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[i_brand#1180, i_brand_id#1179, sum#26547L])\n         +- *(3) Project [ss_ext_sales_price#1918, i_brand_id#1179, i_brand#1180]\n            +- *(3) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :- *(3) Project [ss_item_sk#1905, ss_ext_sales_price#1918]\n               :  +- *(3) BroadcastHashJoin [d_date_sk#1040], [ss_sold_date_sk#1926], Inner, BuildLeft\n               :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :  +- *(1) Project [d_date_sk#1040]\n               :     :     +- *(1) Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 11)) && (d_year#1046 = 1999)) && isnotnull(d_date_sk#1040))\n               :     :        +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,11), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               :     +- *(3) Project [ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n               :        +- *(3) Filter isnotnull(ss_item_sk#1905)\n               :           +- *(3) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_ext_sales_price:decimal(7,2)>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(2) Project [i_item_sk#1172, i_brand_id#1179, i_brand#1180]\n                     +- *(2) Filter ((isnotnull(i_manager_id#1192) && (i_manager_id#1192 = 28)) && isnotnull(i_item_sk#1172))\n                        +- *(2) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_brand#1180,i_manager_id#1192] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_manager_id), EqualTo(i_manager_id,28), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_brand:string,i_manager_id:int>"},{"name":"q56-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["ss","cs","ws"],"parsingTime":0.002208,"analysisTime":0.001375,"optimizationTime":746.382487,"planningTime":59.798142,"executionTime":7112.783331,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ss, cs, ws]\n:  :- 'SubqueryAlias ss\n:  :  +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('ss_ext_sales_price) AS total_sales#26587]\n:  :     +- 'Filter ((('i_item_id IN (list#26588 []) && ('ss_item_sk = 'i_item_sk)) && (('ss_sold_date_sk = 'd_date_sk) && ('d_year = 2001))) && ((('d_moy = 2) && ('ss_addr_sk = 'ca_address_sk)) && ('ca_gmt_offset = -5)))\n:  :        :  +- 'Project ['i_item_id]\n:  :        :     +- 'Filter 'i_color IN (slate,blanched,burnished)\n:  :        :        +- 'UnresolvedRelation `item`\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'Join Inner\n:  :           :  :  :- 'UnresolvedRelation `store_sales`\n:  :           :  :  +- 'UnresolvedRelation `date_dim`\n:  :           :  +- 'UnresolvedRelation `customer_address`\n:  :           +- 'UnresolvedRelation `item`\n:  :- 'SubqueryAlias cs\n:  :  +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('cs_ext_sales_price) AS total_sales#26589]\n:  :     +- 'Filter ((('i_item_id IN (list#26590 []) && ('cs_item_sk = 'i_item_sk)) && (('cs_sold_date_sk = 'd_date_sk) && ('d_year = 2001))) && ((('d_moy = 2) && ('cs_bill_addr_sk = 'ca_address_sk)) && ('ca_gmt_offset = -5)))\n:  :        :  +- 'Project ['i_item_id]\n:  :        :     +- 'Filter 'i_color IN (slate,blanched,burnished)\n:  :        :        +- 'UnresolvedRelation `item`\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'Join Inner\n:  :           :  :  :- 'UnresolvedRelation `catalog_sales`\n:  :           :  :  +- 'UnresolvedRelation `date_dim`\n:  :           :  +- 'UnresolvedRelation `customer_address`\n:  :           +- 'UnresolvedRelation `item`\n:  +- 'SubqueryAlias ws\n:     +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('ws_ext_sales_price) AS total_sales#26591]\n:        +- 'Filter ((('i_item_id IN (list#26592 []) && ('ws_item_sk = 'i_item_sk)) && (('ws_sold_date_sk = 'd_date_sk) && ('d_year = 2001))) && ((('d_moy = 2) && ('ws_bill_addr_sk = 'ca_address_sk)) && ('ca_gmt_offset = -5)))\n:           :  +- 'Project ['i_item_id]\n:           :     +- 'Filter 'i_color IN (slate,blanched,burnished)\n:           :        +- 'UnresolvedRelation `item`\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'Join Inner\n:              :  :  :- 'UnresolvedRelation `web_sales`\n:              :  :  +- 'UnresolvedRelation `date_dim`\n:              :  +- 'UnresolvedRelation `customer_address`\n:              +- 'UnresolvedRelation `item`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['total_sales ASC NULLS FIRST], true\n         +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('total_sales) AS total_sales#26586]\n            +- 'SubqueryAlias tmp1\n               +- 'Union\n                  :- 'Union\n                  :  :- 'Project [*]\n                  :  :  +- 'UnresolvedRelation `ss`\n                  :  +- 'Project [*]\n                  :     +- 'UnresolvedRelation `cs`\n                  +- 'Project [*]\n                     +- 'UnresolvedRelation `ws`\n\n== Analyzed Logical Plan ==\ni_item_id: string, total_sales: decimal(27,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [total_sales#26586 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173], [i_item_id#1173, sum(total_sales#26587) AS total_sales#26586]\n         +- SubqueryAlias tmp1\n            +- Union\n               :- Union\n               :  :- Project [i_item_id#1173, total_sales#26587]\n               :  :  +- SubqueryAlias ss\n               :  :     +- Aggregate [i_item_id#1173], [i_item_id#1173, sum(ss_ext_sales_price#1918) AS total_sales#26587]\n               :  :        +- Filter (((i_item_id#1173 IN (list#26588 []) && (ss_item_sk#1905 = i_item_sk#1172)) && ((ss_sold_date_sk#1926 = d_date_sk#1040) && (d_year#1046 = 2001))) && (((d_moy#1048 = 2) && (ss_addr_sk#1909 = ca_address_sk#922)) && (cast(ca_gmt_offset#933 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2)))))\n               :  :           :  +- Project [i_item_id#1173]\n               :  :           :     +- Filter i_color#1189 IN (slate,blanched,burnished)\n               :  :           :        +- SubqueryAlias item\n               :  :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  :           +- Join Inner\n               :  :              :- Join Inner\n               :  :              :  :- Join Inner\n               :  :              :  :  :- SubqueryAlias store_sales\n               :  :              :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :              :  :  +- SubqueryAlias date_dim\n               :  :              :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :              :  +- SubqueryAlias customer_address\n               :  :              :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               :  :              +- SubqueryAlias item\n               :  :                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  +- Project [i_item_id#1173, total_sales#26589]\n               :     +- SubqueryAlias cs\n               :        +- Aggregate [i_item_id#1173], [i_item_id#1173, sum(cs_ext_sales_price#1811) AS total_sales#26589]\n               :           +- Filter (((i_item_id#1173 IN (list#26590 []) && (cs_item_sk#1803 = i_item_sk#1172)) && ((cs_sold_date_sk#1822 = d_date_sk#1040) && (d_year#1046 = 2001))) && (((d_moy#1048 = 2) && (cs_bill_addr_sk#1794 = ca_address_sk#922)) && (cast(ca_gmt_offset#933 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2)))))\n               :              :  +- Project [i_item_id#1173]\n               :              :     +- Filter i_color#1189 IN (slate,blanched,burnished)\n               :              :        +- SubqueryAlias item\n               :              :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              +- Join Inner\n               :                 :- Join Inner\n               :                 :  :- Join Inner\n               :                 :  :  :- SubqueryAlias catalog_sales\n               :                 :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :                 :  :  +- SubqueryAlias date_dim\n               :                 :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :                 :  +- SubqueryAlias customer_address\n               :                 :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               :                 +- SubqueryAlias item\n               :                    +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               +- Project [i_item_id#1173, total_sales#26591]\n                  +- SubqueryAlias ws\n                     +- Aggregate [i_item_id#1173], [i_item_id#1173, sum(ws_ext_sales_price#1777) AS total_sales#26591]\n                        +- Filter (((i_item_id#1173 IN (list#26592 []) && (ws_item_sk#1757 = i_item_sk#1172)) && ((ws_sold_date_sk#1788 = d_date_sk#1040) && (d_year#1046 = 2001))) && (((d_moy#1048 = 2) && (ws_bill_addr_sk#1761 = ca_address_sk#922)) && (cast(ca_gmt_offset#933 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2)))))\n                           :  +- Project [i_item_id#1173]\n                           :     +- Filter i_color#1189 IN (slate,blanched,burnished)\n                           :        +- SubqueryAlias item\n                           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                           +- Join Inner\n                              :- Join Inner\n                              :  :- Join Inner\n                              :  :  :- SubqueryAlias web_sales\n                              :  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                              :  :  +- SubqueryAlias date_dim\n                              :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :  +- SubqueryAlias customer_address\n                              :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                              +- SubqueryAlias item\n                                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [total_sales#26586 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173], [i_item_id#1173, sum(total_sales#26587) AS total_sales#26586]\n         +- Union\n            :- Aggregate [i_item_id#1173], [i_item_id#1173, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS total_sales#26587]\n            :  +- Project [ss_ext_sales_price#1918, i_item_id#1173]\n            :     +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n            :        :- Project [ss_item_sk#1905, ss_ext_sales_price#1918]\n            :        :  +- Join Inner, (ss_addr_sk#1909 = ca_address_sk#922)\n            :        :     :- Project [ss_item_sk#1905, ss_addr_sk#1909, ss_ext_sales_price#1918]\n            :        :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :        :     :     :- Project [ss_item_sk#1905, ss_addr_sk#1909, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :        :     :     :  +- Filter ((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_addr_sk#1909)) && isnotnull(ss_item_sk#1905))\n            :        :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :        :     :     +- Project [d_date_sk#1040]\n            :        :     :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 2)) && isnotnull(d_date_sk#1040))\n            :        :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :        :     +- Project [ca_address_sk#922]\n            :        :        +- Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n            :        :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :        +- Join LeftSemi, (i_item_id#1173 = i_item_id#1173#26600)\n            :           :- Project [i_item_sk#1172, i_item_id#1173]\n            :           :  +- Filter isnotnull(i_item_sk#1172)\n            :           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :           +- Project [i_item_id#1173 AS i_item_id#1173#26600]\n            :              +- Filter i_color#1189 IN (slate,blanched,burnished)\n            :                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :- Aggregate [i_item_id#1173], [i_item_id#1173, MakeDecimal(sum(UnscaledValue(cs_ext_sales_price#1811)),17,2) AS total_sales#26589]\n            :  +- Project [cs_ext_sales_price#1811, i_item_id#1173]\n            :     +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n            :        :- Project [cs_item_sk#1803, cs_ext_sales_price#1811]\n            :        :  +- Join Inner, (cs_bill_addr_sk#1794 = ca_address_sk#922)\n            :        :     :- Project [cs_bill_addr_sk#1794, cs_item_sk#1803, cs_ext_sales_price#1811]\n            :        :     :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n            :        :     :     :- Project [cs_bill_addr_sk#1794, cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n            :        :     :     :  +- Filter ((isnotnull(cs_sold_date_sk#1822) && isnotnull(cs_bill_addr_sk#1794)) && isnotnull(cs_item_sk#1803))\n            :        :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :        :     :     +- Project [d_date_sk#1040]\n            :        :     :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 2)) && isnotnull(d_date_sk#1040))\n            :        :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :        :     +- Project [ca_address_sk#922]\n            :        :        +- Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n            :        :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :        +- Join LeftSemi, (i_item_id#1173 = i_item_id#1173#26601)\n            :           :- Project [i_item_sk#1172, i_item_id#1173]\n            :           :  +- Filter isnotnull(i_item_sk#1172)\n            :           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :           +- Project [i_item_id#1173 AS i_item_id#1173#26601]\n            :              +- Filter i_color#1189 IN (slate,blanched,burnished)\n            :                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            +- Aggregate [i_item_id#1173], [i_item_id#1173, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#1777)),17,2) AS total_sales#26591]\n               +- Project [ws_ext_sales_price#1777, i_item_id#1173]\n                  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n                     :- Project [ws_item_sk#1757, ws_ext_sales_price#1777]\n                     :  +- Join Inner, (ws_bill_addr_sk#1761 = ca_address_sk#922)\n                     :     :- Project [ws_item_sk#1757, ws_bill_addr_sk#1761, ws_ext_sales_price#1777]\n                     :     :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                     :     :     :- Project [ws_item_sk#1757, ws_bill_addr_sk#1761, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                     :     :     :  +- Filter ((isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_bill_addr_sk#1761)) && isnotnull(ws_item_sk#1757))\n                     :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :     :     +- Project [d_date_sk#1040]\n                     :     :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 2)) && isnotnull(d_date_sk#1040))\n                     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :     +- Project [ca_address_sk#922]\n                     :        +- Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n                     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                     +- Join LeftSemi, (i_item_id#1173 = i_item_id#1173#26602)\n                        :- Project [i_item_sk#1172, i_item_id#1173]\n                        :  +- Filter isnotnull(i_item_sk#1172)\n                        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        +- Project [i_item_id#1173 AS i_item_id#1173#26602]\n                           +- Filter i_color#1189 IN (slate,blanched,burnished)\n                              +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[total_sales#26586 ASC NULLS FIRST], output=[i_item_id#1173,total_sales#26586])\n+- *(20) HashAggregate(keys=[i_item_id#1173], functions=[sum(total_sales#26587)], output=[i_item_id#1173, total_sales#26586])\n   +- Exchange hashpartitioning(i_item_id#1173, 200)\n      +- *(19) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(total_sales#26587)], output=[i_item_id#1173, sum#26604])\n         +- Union\n            :- *(6) HashAggregate(keys=[i_item_id#1173], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[i_item_id#1173, total_sales#26587])\n            :  +- Exchange hashpartitioning(i_item_id#1173, 200)\n            :     +- *(5) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[i_item_id#1173, sum#26606L])\n            :        +- *(5) Project [ss_ext_sales_price#1918, i_item_id#1173]\n            :           +- *(5) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n            :              :- *(5) Project [ss_item_sk#1905, ss_ext_sales_price#1918]\n            :              :  +- *(5) BroadcastHashJoin [ss_addr_sk#1909], [ca_address_sk#922], Inner, BuildRight\n            :              :     :- *(5) Project [ss_item_sk#1905, ss_addr_sk#1909, ss_ext_sales_price#1918]\n            :              :     :  +- *(5) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n            :              :     :     :- *(5) Project [ss_item_sk#1905, ss_addr_sk#1909, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :              :     :     :  +- *(5) Filter (isnotnull(ss_addr_sk#1909) && isnotnull(ss_item_sk#1905))\n            :              :     :     :     +- *(5) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_addr_sk#1909,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_addr_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_addr_sk:int,ss_ext_sales_price:decimal(7,2)>\n            :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              :     :        +- *(1) Project [d_date_sk#1040]\n            :              :     :           +- *(1) Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 = 2)) && isnotnull(d_date_sk#1040))\n            :              :     :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), EqualTo(d_moy,2), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n            :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              :        +- *(2) Project [ca_address_sk#922]\n            :              :           +- *(2) Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n            :              :              +- *(2) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_gmt_offset#933] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-5.00), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_gmt_offset:decimal(5,2)>\n            :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :                 +- *(4) BroadcastHashJoin [i_item_id#1173], [i_item_id#1173#26600], LeftSemi, BuildRight\n            :                    :- *(4) Project [i_item_sk#1172, i_item_id#1173]\n            :                    :  +- *(4) Filter isnotnull(i_item_sk#1172)\n            :                    :     +- *(4) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string>\n            :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]))\n            :                       +- *(3) Project [i_item_id#1173 AS i_item_id#1173#26600]\n            :                          +- *(3) Filter i_color#1189 IN (slate,blanched,burnished)\n            :                             +- *(3) FileScan parquet db_tpcds.item[i_item_id#1173,i_color#1189] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [In(i_color, [slate,blanched,burnished])], ReadSchema: struct<i_item_id:string,i_color:string>\n            :- *(12) HashAggregate(keys=[i_item_id#1173], functions=[sum(UnscaledValue(cs_ext_sales_price#1811))], output=[i_item_id#1173, total_sales#26589])\n            :  +- Exchange hashpartitioning(i_item_id#1173, 200)\n            :     +- *(11) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(UnscaledValue(cs_ext_sales_price#1811))], output=[i_item_id#1173, sum#26608L])\n            :        +- *(11) Project [cs_ext_sales_price#1811, i_item_id#1173]\n            :           +- *(11) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n            :              :- *(11) Project [cs_item_sk#1803, cs_ext_sales_price#1811]\n            :              :  +- *(11) BroadcastHashJoin [cs_bill_addr_sk#1794], [ca_address_sk#922], Inner, BuildRight\n            :              :     :- *(11) Project [cs_bill_addr_sk#1794, cs_item_sk#1803, cs_ext_sales_price#1811]\n            :              :     :  +- *(11) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n            :              :     :     :- *(11) Project [cs_bill_addr_sk#1794, cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n            :              :     :     :  +- *(11) Filter (isnotnull(cs_bill_addr_sk#1794) && isnotnull(cs_item_sk#1803))\n            :              :     :     :     +- *(11) FileScan parquet db_tpcds.catalog_sales[cs_bill_addr_sk#1794,cs_item_sk#1803,cs_ext_sales_price#1811,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_bill_addr_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_bill_addr_sk:int,cs_item_sk:int,cs_ext_sales_price:decimal(7,2)>\n            :              :     :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              :     +- ReusedExchange [ca_address_sk#922], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              +- ReusedExchange [i_item_sk#1172, i_item_id#1173], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            +- *(18) HashAggregate(keys=[i_item_id#1173], functions=[sum(UnscaledValue(ws_ext_sales_price#1777))], output=[i_item_id#1173, total_sales#26591])\n               +- Exchange hashpartitioning(i_item_id#1173, 200)\n                  +- *(17) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(UnscaledValue(ws_ext_sales_price#1777))], output=[i_item_id#1173, sum#26610L])\n                     +- *(17) Project [ws_ext_sales_price#1777, i_item_id#1173]\n                        +- *(17) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n                           :- *(17) Project [ws_item_sk#1757, ws_ext_sales_price#1777]\n                           :  +- *(17) BroadcastHashJoin [ws_bill_addr_sk#1761], [ca_address_sk#922], Inner, BuildRight\n                           :     :- *(17) Project [ws_item_sk#1757, ws_bill_addr_sk#1761, ws_ext_sales_price#1777]\n                           :     :  +- *(17) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                           :     :     :- *(17) Project [ws_item_sk#1757, ws_bill_addr_sk#1761, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                           :     :     :  +- *(17) Filter (isnotnull(ws_bill_addr_sk#1761) && isnotnull(ws_item_sk#1757))\n                           :     :     :     +- *(17) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_bill_addr_sk#1761,ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_addr_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_bill_addr_sk:int,ws_ext_sales_price:decimal(7,2)>\n                           :     :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :     +- ReusedExchange [ca_address_sk#922], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           +- ReusedExchange [i_item_sk#1172, i_item_id#1173], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q57-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["v2"],"parsingTime":0.001977,"analysisTime":0.001113,"optimizationTime":960.823507,"planningTime":76.225503,"executionTime":17186.585521,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [v1, v2]\n:  :- 'SubqueryAlias v1\n:  :  +- 'Aggregate ['i_category, 'i_brand, 'cc_name, 'd_year, 'd_moy], ['i_category, 'i_brand, 'cc_name, 'd_year, 'd_moy, 'sum('cs_sales_price) AS sum_sales#27758, 'avg('sum('cs_sales_price)) windowspecdefinition('i_category, 'i_brand, 'cc_name, 'd_year, unspecifiedframe$()) AS avg_monthly_sales#27759, 'rank() windowspecdefinition('i_category, 'i_brand, 'cc_name, 'd_year ASC NULLS FIRST, 'd_moy ASC NULLS FIRST, unspecifiedframe$()) AS rn#27760]\n:  :     +- 'Filter ((('cs_item_sk = 'i_item_sk) && ('cs_sold_date_sk = 'd_date_sk)) && (('cc_call_center_sk = 'cs_call_center_sk) && ((('d_year = 1999) || (('d_year = (1999 - 1)) && ('d_moy = 12))) || (('d_year = (1999 + 1)) && ('d_moy = 1)))))\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'Join Inner\n:  :           :  :  :- 'UnresolvedRelation `item`\n:  :           :  :  +- 'UnresolvedRelation `catalog_sales`\n:  :           :  +- 'UnresolvedRelation `date_dim`\n:  :           +- 'UnresolvedRelation `call_center`\n:  +- 'SubqueryAlias v2\n:     +- 'Project ['v1.i_category, 'v1.i_brand, 'v1.cc_name, 'v1.d_year, 'v1.d_moy, 'v1.avg_monthly_sales, 'v1.sum_sales, 'v1_lag.sum_sales AS psum#27761, 'v1_lead.sum_sales AS nsum#27762]\n:        +- 'Filter (((('v1.i_category = 'v1_lag.i_category) && ('v1.i_category = 'v1_lead.i_category)) && (('v1.i_brand = 'v1_lag.i_brand) && ('v1.i_brand = 'v1_lead.i_brand))) && ((('v1.cc_name = 'v1_lag.cc_name) && ('v1.cc_name = 'v1_lead.cc_name)) && (('v1.rn = ('v1_lag.rn + 1)) && ('v1.rn = ('v1_lead.rn - 1)))))\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'UnresolvedRelation `v1`\n:              :  +- 'SubqueryAlias v1_lag\n:              :     +- 'UnresolvedRelation `v1`\n:              +- 'SubqueryAlias v1_lead\n:                 +- 'UnresolvedRelation `v1`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort [('sum_sales - 'avg_monthly_sales) ASC NULLS FIRST, 3 ASC NULLS FIRST], true\n         +- 'Project [*]\n            +- 'Filter ((('d_year = 1999) && ('avg_monthly_sales > 0)) && (CASE WHEN ('avg_monthly_sales > 0) THEN ('abs(('sum_sales - 'avg_monthly_sales)) / 'avg_monthly_sales) ELSE null END > 0.1))\n               +- 'UnresolvedRelation `v2`\n\n== Analyzed Logical Plan ==\ni_category: string, i_brand: string, cc_name: string, d_year: int, d_moy: int, avg_monthly_sales: decimal(21,6), sum_sales: decimal(17,2), psum: decimal(17,2), nsum: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [CheckOverflow((promote_precision(cast(sum_sales#27758 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#27759 as decimal(22,6)))), DecimalType(22,6)) ASC NULLS FIRST, cc_name#732 ASC NULLS FIRST], true\n      +- Project [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, avg_monthly_sales#27759, sum_sales#27758, psum#27761, nsum#27762]\n         +- Filter (((d_year#1046 = 1999) && (cast(avg_monthly_sales#27759 as decimal(21,6)) > cast(cast(0 as decimal(1,0)) as decimal(21,6)))) && (cast(CASE WHEN (cast(avg_monthly_sales#27759 as decimal(21,6)) > cast(cast(0 as decimal(1,0)) as decimal(21,6))) THEN CheckOverflow((promote_precision(cast(abs(CheckOverflow((promote_precision(cast(sum_sales#27758 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#27759 as decimal(22,6)))), DecimalType(22,6))) as decimal(22,6))) / promote_precision(cast(avg_monthly_sales#27759 as decimal(22,6)))), DecimalType(38,16)) ELSE cast(null as decimal(38,16)) END as decimal(38,16)) > cast(0.1 as decimal(38,16))))\n            +- SubqueryAlias v2\n               +- Project [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, avg_monthly_sales#27759, sum_sales#27758, sum_sales#27974 AS psum#27761, sum_sales#28461 AS nsum#27762]\n                  +- Filter ((((i_category#1184 = i_category#28081) && (i_category#1184 = i_category#28568)) && ((i_brand#1180 = i_brand#28077) && (i_brand#1180 = i_brand#28564))) && (((cc_name#732 = cc_name#28243) && (cc_name#732 = cc_name#28730)) && ((rn#27760 = (rn#27878 + 1)) && (rn#27760 = (rn#28365 - 1)))))\n                     +- Join Inner\n                        :- Join Inner\n                        :  :- SubqueryAlias v1\n                        :  :  +- Project [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, sum_sales#27758, avg_monthly_sales#27759, rn#27760]\n                        :  :     +- Project [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, sum_sales#27758, _w0#27776, rn#27760, avg_monthly_sales#27759, avg_monthly_sales#27759, rn#27760]\n                        :  :        +- Window [avg(_w0#27776) windowspecdefinition(i_category#1184, i_brand#1180, cc_name#732, d_year#1046, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#27759], [i_category#1184, i_brand#1180, cc_name#732, d_year#1046]\n                        :  :           +- Window [rank(d_year#1046, d_moy#1048) windowspecdefinition(i_category#1184, i_brand#1180, cc_name#732, d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#27760], [i_category#1184, i_brand#1180, cc_name#732], [d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST]\n                        :  :              +- Aggregate [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048], [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, sum(cs_sales_price#1809) AS sum_sales#27758, sum(cs_sales_price#1809) AS _w0#27776]\n                        :  :                 +- Filter (((cs_item_sk#1803 = i_item_sk#1172) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && ((cc_call_center_sk#726 = cs_call_center_sk#1799) && (((d_year#1046 = 1999) || ((d_year#1046 = (1999 - 1)) && (d_moy#1048 = 12))) || ((d_year#1046 = (1999 + 1)) && (d_moy#1048 = 1)))))\n                        :  :                    +- Join Inner\n                        :  :                       :- Join Inner\n                        :  :                       :  :- Join Inner\n                        :  :                       :  :  :- SubqueryAlias item\n                        :  :                       :  :  :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :  :                       :  :  +- SubqueryAlias catalog_sales\n                        :  :                       :  :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                        :  :                       :  +- SubqueryAlias date_dim\n                        :  :                       :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :  :                       +- SubqueryAlias call_center\n                        :  :                          +- Relation[cc_call_center_sk#726,cc_call_center_id#727,cc_rec_start_date#728,cc_rec_end_date#729,cc_closed_date_sk#730,cc_open_date_sk#731,cc_name#732,cc_class#733,cc_employees#734,cc_sq_ft#735,cc_hours#736,cc_manager#737,cc_mkt_id#738,cc_mkt_class#739,cc_mkt_desc#740,cc_market_manager#741,cc_division#742,cc_division_name#743,cc_company#744,cc_company_name#745,cc_street_number#746,cc_street_name#747,cc_street_type#748,cc_suite_number#749,... 7 more fields] parquet\n                        :  +- SubqueryAlias v1_lag\n                        :     +- SubqueryAlias v1\n                        :        +- Project [i_category#28081, i_brand#28077, cc_name#28243, d_year#28168, d_moy#28170, sum_sales#27974, avg_monthly_sales#27781, rn#27878]\n                        :           +- Project [i_category#28081, i_brand#28077, cc_name#28243, d_year#28168, d_moy#28170, sum_sales#27974, _w0#27975, rn#27878, avg_monthly_sales#27781, avg_monthly_sales#27781, rn#27878]\n                        :              +- Window [avg(_w0#27975) windowspecdefinition(i_category#28081, i_brand#28077, cc_name#28243, d_year#28168, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#27781], [i_category#28081, i_brand#28077, cc_name#28243, d_year#28168]\n                        :                 +- Window [rank(d_year#28168, d_moy#28170) windowspecdefinition(i_category#28081, i_brand#28077, cc_name#28243, d_year#28168 ASC NULLS FIRST, d_moy#28170 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#27878], [i_category#28081, i_brand#28077, cc_name#28243], [d_year#28168 ASC NULLS FIRST, d_moy#28170 ASC NULLS FIRST]\n                        :                    +- Aggregate [i_category#28081, i_brand#28077, cc_name#28243, d_year#28168, d_moy#28170], [i_category#28081, i_brand#28077, cc_name#28243, d_year#28168, d_moy#28170, sum(cs_sales_price#1809) AS sum_sales#27974, sum(cs_sales_price#1809) AS _w0#27975]\n                        :                       +- Filter (((cs_item_sk#1803 = i_item_sk#28069) && (cs_sold_date_sk#1822 = d_date_sk#28162)) && ((cc_call_center_sk#28237 = cs_call_center_sk#1799) && (((d_year#28168 = 1999) || ((d_year#28168 = (1999 - 1)) && (d_moy#28170 = 12))) || ((d_year#28168 = (1999 + 1)) && (d_moy#28170 = 1)))))\n                        :                          +- Join Inner\n                        :                             :- Join Inner\n                        :                             :  :- Join Inner\n                        :                             :  :  :- SubqueryAlias item\n                        :                             :  :  :  +- Relation[i_item_sk#28069,i_item_id#28070,i_rec_start_date#28071,i_rec_end_date#28072,i_item_desc#28073,i_current_price#28074,i_wholesale_cost#28075,i_brand_id#28076,i_brand#28077,i_class_id#28078,i_class#28079,i_category_id#28080,i_category#28081,i_manufact_id#28082,i_manufact#28083,i_size#28084,i_formulation#28085,i_color#28086,i_units#28087,i_container#28088,i_manager_id#28089,i_product_name#28090] parquet\n                        :                             :  :  +- SubqueryAlias catalog_sales\n                        :                             :  :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                        :                             :  +- SubqueryAlias date_dim\n                        :                             :     +- Relation[d_date_sk#28162,d_date_id#28163,d_date#28164,d_month_seq#28165,d_week_seq#28166,d_quarter_seq#28167,d_year#28168,d_dow#28169,d_moy#28170,d_dom#28171,d_qoy#28172,d_fy_year#28173,d_fy_quarter_seq#28174,d_fy_week_seq#28175,d_day_name#28176,d_quarter_name#28177,d_holiday#28178,d_weekend#28179,d_following_holiday#28180,d_first_dom#28181,d_last_dom#28182,d_same_day_ly#28183,d_same_day_lq#28184,d_current_day#28185,... 4 more fields] parquet\n                        :                             +- SubqueryAlias call_center\n                        :                                +- Relation[cc_call_center_sk#28237,cc_call_center_id#28238,cc_rec_start_date#28239,cc_rec_end_date#28240,cc_closed_date_sk#28241,cc_open_date_sk#28242,cc_name#28243,cc_class#28244,cc_employees#28245,cc_sq_ft#28246,cc_hours#28247,cc_manager#28248,cc_mkt_id#28249,cc_mkt_class#28250,cc_mkt_desc#28251,cc_market_manager#28252,cc_division#28253,cc_division_name#28254,cc_company#28255,cc_company_name#28256,cc_street_number#28257,cc_street_name#28258,cc_street_type#28259,cc_suite_number#28260,... 7 more fields] parquet\n                        +- SubqueryAlias v1_lead\n                           +- SubqueryAlias v1\n                              +- Project [i_category#28568, i_brand#28564, cc_name#28730, d_year#28655, d_moy#28657, sum_sales#28461, avg_monthly_sales#28268, rn#28365]\n                                 +- Project [i_category#28568, i_brand#28564, cc_name#28730, d_year#28655, d_moy#28657, sum_sales#28461, _w0#28462, rn#28365, avg_monthly_sales#28268, avg_monthly_sales#28268, rn#28365]\n                                    +- Window [avg(_w0#28462) windowspecdefinition(i_category#28568, i_brand#28564, cc_name#28730, d_year#28655, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#28268], [i_category#28568, i_brand#28564, cc_name#28730, d_year#28655]\n                                       +- Window [rank(d_year#28655, d_moy#28657) windowspecdefinition(i_category#28568, i_brand#28564, cc_name#28730, d_year#28655 ASC NULLS FIRST, d_moy#28657 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#28365], [i_category#28568, i_brand#28564, cc_name#28730], [d_year#28655 ASC NULLS FIRST, d_moy#28657 ASC NULLS FIRST]\n                                          +- Aggregate [i_category#28568, i_brand#28564, cc_name#28730, d_year#28655, d_moy#28657], [i_category#28568, i_brand#28564, cc_name#28730, d_year#28655, d_moy#28657, sum(cs_sales_price#1809) AS sum_sales#28461, sum(cs_sales_price#1809) AS _w0#28462]\n                                             +- Filter (((cs_item_sk#1803 = i_item_sk#28556) && (cs_sold_date_sk#1822 = d_date_sk#28649)) && ((cc_call_center_sk#28724 = cs_call_center_sk#1799) && (((d_year#28655 = 1999) || ((d_year#28655 = (1999 - 1)) && (d_moy#28657 = 12))) || ((d_year#28655 = (1999 + 1)) && (d_moy#28657 = 1)))))\n                                                +- Join Inner\n                                                   :- Join Inner\n                                                   :  :- Join Inner\n                                                   :  :  :- SubqueryAlias item\n                                                   :  :  :  +- Relation[i_item_sk#28556,i_item_id#28557,i_rec_start_date#28558,i_rec_end_date#28559,i_item_desc#28560,i_current_price#28561,i_wholesale_cost#28562,i_brand_id#28563,i_brand#28564,i_class_id#28565,i_class#28566,i_category_id#28567,i_category#28568,i_manufact_id#28569,i_manufact#28570,i_size#28571,i_formulation#28572,i_color#28573,i_units#28574,i_container#28575,i_manager_id#28576,i_product_name#28577] parquet\n                                                   :  :  +- SubqueryAlias catalog_sales\n                                                   :  :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                                                   :  +- SubqueryAlias date_dim\n                                                   :     +- Relation[d_date_sk#28649,d_date_id#28650,d_date#28651,d_month_seq#28652,d_week_seq#28653,d_quarter_seq#28654,d_year#28655,d_dow#28656,d_moy#28657,d_dom#28658,d_qoy#28659,d_fy_year#28660,d_fy_quarter_seq#28661,d_fy_week_seq#28662,d_day_name#28663,d_quarter_name#28664,d_holiday#28665,d_weekend#28666,d_following_holiday#28667,d_first_dom#28668,d_last_dom#28669,d_same_day_ly#28670,d_same_day_lq#28671,d_current_day#28672,... 4 more fields] parquet\n                                                   +- SubqueryAlias call_center\n                                                      +- Relation[cc_call_center_sk#28724,cc_call_center_id#28725,cc_rec_start_date#28726,cc_rec_end_date#28727,cc_closed_date_sk#28728,cc_open_date_sk#28729,cc_name#28730,cc_class#28731,cc_employees#28732,cc_sq_ft#28733,cc_hours#28734,cc_manager#28735,cc_mkt_id#28736,cc_mkt_class#28737,cc_mkt_desc#28738,cc_market_manager#28739,cc_division#28740,cc_division_name#28741,cc_company#28742,cc_company_name#28743,cc_street_number#28744,cc_street_name#28745,cc_street_type#28746,cc_suite_number#28747,... 7 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [CheckOverflow((promote_precision(cast(sum_sales#27758 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#27759 as decimal(22,6)))), DecimalType(22,6)) ASC NULLS FIRST, cc_name#732 ASC NULLS FIRST], true\n      +- Project [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, avg_monthly_sales#27759, sum_sales#27758, sum_sales#27974 AS psum#27761, sum_sales#28461 AS nsum#27762]\n         +- Join Inner, ((((i_category#1184 = i_category#28568) && (i_brand#1180 = i_brand#28564)) && (cc_name#732 = cc_name#28730)) && (rn#27760 = (rn#28365 - 1)))\n            :- Project [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, sum_sales#27758, avg_monthly_sales#27759, rn#27760, sum_sales#27974]\n            :  +- Join Inner, ((((i_category#1184 = i_category#28081) && (i_brand#1180 = i_brand#28077)) && (cc_name#732 = cc_name#28243)) && (rn#27760 = (rn#27878 + 1)))\n            :     :- Project [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, sum_sales#27758, avg_monthly_sales#27759, rn#27760]\n            :     :  +- Filter (((isnotnull(avg_monthly_sales#27759) && (avg_monthly_sales#27759 > 0.000000)) && (CASE WHEN (avg_monthly_sales#27759 > 0.000000) THEN CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#27758 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#27759 as decimal(22,6)))), DecimalType(22,6)))) / promote_precision(cast(avg_monthly_sales#27759 as decimal(22,6)))), DecimalType(38,16)) ELSE null END > 0.1000000000000000)) && isnotnull(rn#27760))\n            :     :     +- Window [avg(_w0#27776) windowspecdefinition(i_category#1184, i_brand#1180, cc_name#732, d_year#1046, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#27759], [i_category#1184, i_brand#1180, cc_name#732, d_year#1046]\n            :     :        +- Filter (isnotnull(d_year#1046) && (d_year#1046 = 1999))\n            :     :           +- Window [rank(d_year#1046, d_moy#1048) windowspecdefinition(i_category#1184, i_brand#1180, cc_name#732, d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#27760], [i_category#1184, i_brand#1180, cc_name#732], [d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST]\n            :     :              +- Aggregate [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048], [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, MakeDecimal(sum(UnscaledValue(cs_sales_price#1809)),17,2) AS sum_sales#27758, MakeDecimal(sum(UnscaledValue(cs_sales_price#1809)),17,2) AS _w0#27776]\n            :     :                 +- Project [i_brand#1180, i_category#1184, cs_sales_price#1809, d_year#1046, d_moy#1048, cc_name#732]\n            :     :                    +- Join Inner, (cc_call_center_sk#726 = cs_call_center_sk#1799)\n            :     :                       :- Project [i_brand#1180, i_category#1184, cs_call_center_sk#1799, cs_sales_price#1809, d_year#1046, d_moy#1048]\n            :     :                       :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n            :     :                       :     :- Project [i_brand#1180, i_category#1184, cs_call_center_sk#1799, cs_sales_price#1809, cs_sold_date_sk#1822]\n            :     :                       :     :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n            :     :                       :     :     :- Project [i_item_sk#1172, i_brand#1180, i_category#1184]\n            :     :                       :     :     :  +- Filter ((isnotnull(i_item_sk#1172) && isnotnull(i_brand#1180)) && isnotnull(i_category#1184))\n            :     :                       :     :     :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :     :                       :     :     +- Project [cs_call_center_sk#1799, cs_item_sk#1803, cs_sales_price#1809, cs_sold_date_sk#1822]\n            :     :                       :     :        +- Filter ((isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822)) && isnotnull(cs_call_center_sk#1799))\n            :     :                       :     :           +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :     :                       :     +- Project [d_date_sk#1040, d_year#1046, d_moy#1048]\n            :     :                       :        +- Filter ((((d_year#1046 = 1999) || ((d_year#1046 = 1998) && (d_moy#1048 = 12))) || ((d_year#1046 = 2000) && (d_moy#1048 = 1))) && isnotnull(d_date_sk#1040))\n            :     :                       :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :                       +- Project [cc_call_center_sk#726, cc_name#732]\n            :     :                          +- Filter (isnotnull(cc_call_center_sk#726) && isnotnull(cc_name#732))\n            :     :                             +- Relation[cc_call_center_sk#726,cc_call_center_id#727,cc_rec_start_date#728,cc_rec_end_date#729,cc_closed_date_sk#730,cc_open_date_sk#731,cc_name#732,cc_class#733,cc_employees#734,cc_sq_ft#735,cc_hours#736,cc_manager#737,cc_mkt_id#738,cc_mkt_class#739,cc_mkt_desc#740,cc_market_manager#741,cc_division#742,cc_division_name#743,cc_company#744,cc_company_name#745,cc_street_number#746,cc_street_name#747,cc_street_type#748,cc_suite_number#749,... 7 more fields] parquet\n            :     +- Project [i_category#28081, i_brand#28077, cc_name#28243, sum_sales#27974, rn#27878]\n            :        +- Filter isnotnull(rn#27878)\n            :           +- Window [rank(d_year#28168, d_moy#28170) windowspecdefinition(i_category#28081, i_brand#28077, cc_name#28243, d_year#28168 ASC NULLS FIRST, d_moy#28170 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#27878], [i_category#28081, i_brand#28077, cc_name#28243], [d_year#28168 ASC NULLS FIRST, d_moy#28170 ASC NULLS FIRST]\n            :              +- Aggregate [i_category#28081, i_brand#28077, cc_name#28243, d_year#28168, d_moy#28170], [i_category#28081, i_brand#28077, cc_name#28243, d_year#28168, d_moy#28170, MakeDecimal(sum(UnscaledValue(cs_sales_price#1809)),17,2) AS sum_sales#27974]\n            :                 +- Project [i_brand#28077, i_category#28081, cs_sales_price#1809, d_year#28168, d_moy#28170, cc_name#28243]\n            :                    +- Join Inner, (cc_call_center_sk#28237 = cs_call_center_sk#1799)\n            :                       :- Project [i_brand#28077, i_category#28081, cs_call_center_sk#1799, cs_sales_price#1809, d_year#28168, d_moy#28170]\n            :                       :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#28162)\n            :                       :     :- Project [i_brand#28077, i_category#28081, cs_call_center_sk#1799, cs_sales_price#1809, cs_sold_date_sk#1822]\n            :                       :     :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#28069)\n            :                       :     :     :- Project [i_item_sk#28069, i_brand#28077, i_category#28081]\n            :                       :     :     :  +- Filter ((isnotnull(i_item_sk#28069) && isnotnull(i_brand#28077)) && isnotnull(i_category#28081))\n            :                       :     :     :     +- Relation[i_item_sk#28069,i_item_id#28070,i_rec_start_date#28071,i_rec_end_date#28072,i_item_desc#28073,i_current_price#28074,i_wholesale_cost#28075,i_brand_id#28076,i_brand#28077,i_class_id#28078,i_class#28079,i_category_id#28080,i_category#28081,i_manufact_id#28082,i_manufact#28083,i_size#28084,i_formulation#28085,i_color#28086,i_units#28087,i_container#28088,i_manager_id#28089,i_product_name#28090] parquet\n            :                       :     :     +- Project [cs_call_center_sk#1799, cs_item_sk#1803, cs_sales_price#1809, cs_sold_date_sk#1822]\n            :                       :     :        +- Filter ((isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822)) && isnotnull(cs_call_center_sk#1799))\n            :                       :     :           +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :                       :     +- Project [d_date_sk#28162, d_year#28168, d_moy#28170]\n            :                       :        +- Filter ((((d_year#28168 = 1999) || ((d_year#28168 = 1998) && (d_moy#28170 = 12))) || ((d_year#28168 = 2000) && (d_moy#28170 = 1))) && isnotnull(d_date_sk#28162))\n            :                       :           +- Relation[d_date_sk#28162,d_date_id#28163,d_date#28164,d_month_seq#28165,d_week_seq#28166,d_quarter_seq#28167,d_year#28168,d_dow#28169,d_moy#28170,d_dom#28171,d_qoy#28172,d_fy_year#28173,d_fy_quarter_seq#28174,d_fy_week_seq#28175,d_day_name#28176,d_quarter_name#28177,d_holiday#28178,d_weekend#28179,d_following_holiday#28180,d_first_dom#28181,d_last_dom#28182,d_same_day_ly#28183,d_same_day_lq#28184,d_current_day#28185,... 4 more fields] parquet\n            :                       +- Project [cc_call_center_sk#28237, cc_name#28243]\n            :                          +- Filter (isnotnull(cc_call_center_sk#28237) && isnotnull(cc_name#28243))\n            :                             +- Relation[cc_call_center_sk#28237,cc_call_center_id#28238,cc_rec_start_date#28239,cc_rec_end_date#28240,cc_closed_date_sk#28241,cc_open_date_sk#28242,cc_name#28243,cc_class#28244,cc_employees#28245,cc_sq_ft#28246,cc_hours#28247,cc_manager#28248,cc_mkt_id#28249,cc_mkt_class#28250,cc_mkt_desc#28251,cc_market_manager#28252,cc_division#28253,cc_division_name#28254,cc_company#28255,cc_company_name#28256,cc_street_number#28257,cc_street_name#28258,cc_street_type#28259,cc_suite_number#28260,... 7 more fields] parquet\n            +- Project [i_category#28568, i_brand#28564, cc_name#28730, sum_sales#28461, rn#28365]\n               +- Filter isnotnull(rn#28365)\n                  +- Window [rank(d_year#28655, d_moy#28657) windowspecdefinition(i_category#28568, i_brand#28564, cc_name#28730, d_year#28655 ASC NULLS FIRST, d_moy#28657 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#28365], [i_category#28568, i_brand#28564, cc_name#28730], [d_year#28655 ASC NULLS FIRST, d_moy#28657 ASC NULLS FIRST]\n                     +- Aggregate [i_category#28568, i_brand#28564, cc_name#28730, d_year#28655, d_moy#28657], [i_category#28568, i_brand#28564, cc_name#28730, d_year#28655, d_moy#28657, MakeDecimal(sum(UnscaledValue(cs_sales_price#1809)),17,2) AS sum_sales#28461]\n                        +- Project [i_brand#28564, i_category#28568, cs_sales_price#1809, d_year#28655, d_moy#28657, cc_name#28730]\n                           +- Join Inner, (cc_call_center_sk#28724 = cs_call_center_sk#1799)\n                              :- Project [i_brand#28564, i_category#28568, cs_call_center_sk#1799, cs_sales_price#1809, d_year#28655, d_moy#28657]\n                              :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#28649)\n                              :     :- Project [i_brand#28564, i_category#28568, cs_call_center_sk#1799, cs_sales_price#1809, cs_sold_date_sk#1822]\n                              :     :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#28556)\n                              :     :     :- Project [i_item_sk#28556, i_brand#28564, i_category#28568]\n                              :     :     :  +- Filter ((isnotnull(i_item_sk#28556) && isnotnull(i_category#28568)) && isnotnull(i_brand#28564))\n                              :     :     :     +- Relation[i_item_sk#28556,i_item_id#28557,i_rec_start_date#28558,i_rec_end_date#28559,i_item_desc#28560,i_current_price#28561,i_wholesale_cost#28562,i_brand_id#28563,i_brand#28564,i_class_id#28565,i_class#28566,i_category_id#28567,i_category#28568,i_manufact_id#28569,i_manufact#28570,i_size#28571,i_formulation#28572,i_color#28573,i_units#28574,i_container#28575,i_manager_id#28576,i_product_name#28577] parquet\n                              :     :     +- Project [cs_call_center_sk#1799, cs_item_sk#1803, cs_sales_price#1809, cs_sold_date_sk#1822]\n                              :     :        +- Filter ((isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822)) && isnotnull(cs_call_center_sk#1799))\n                              :     :           +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                              :     +- Project [d_date_sk#28649, d_year#28655, d_moy#28657]\n                              :        +- Filter ((((d_year#28655 = 1999) || ((d_year#28655 = 1998) && (d_moy#28657 = 12))) || ((d_year#28655 = 2000) && (d_moy#28657 = 1))) && isnotnull(d_date_sk#28649))\n                              :           +- Relation[d_date_sk#28649,d_date_id#28650,d_date#28651,d_month_seq#28652,d_week_seq#28653,d_quarter_seq#28654,d_year#28655,d_dow#28656,d_moy#28657,d_dom#28658,d_qoy#28659,d_fy_year#28660,d_fy_quarter_seq#28661,d_fy_week_seq#28662,d_day_name#28663,d_quarter_name#28664,d_holiday#28665,d_weekend#28666,d_following_holiday#28667,d_first_dom#28668,d_last_dom#28669,d_same_day_ly#28670,d_same_day_lq#28671,d_current_day#28672,... 4 more fields] parquet\n                              +- Project [cc_call_center_sk#28724, cc_name#28730]\n                                 +- Filter (isnotnull(cc_call_center_sk#28724) && isnotnull(cc_name#28730))\n                                    +- Relation[cc_call_center_sk#28724,cc_call_center_id#28725,cc_rec_start_date#28726,cc_rec_end_date#28727,cc_closed_date_sk#28728,cc_open_date_sk#28729,cc_name#28730,cc_class#28731,cc_employees#28732,cc_sq_ft#28733,cc_hours#28734,cc_manager#28735,cc_mkt_id#28736,cc_mkt_class#28737,cc_mkt_desc#28738,cc_market_manager#28739,cc_division#28740,cc_division_name#28741,cc_company#28742,cc_company_name#28743,cc_street_number#28744,cc_street_name#28745,cc_street_type#28746,cc_suite_number#28747,... 7 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[CheckOverflow((promote_precision(cast(sum_sales#27758 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#27759 as decimal(22,6)))), DecimalType(22,6)) ASC NULLS FIRST,cc_name#732 ASC NULLS FIRST], output=[i_category#1184,i_brand#1180,cc_name#732,d_year#1046,d_moy#1048,avg_monthly_sales#27759,sum_sales#27758,psum#27761,nsum#27762])\n+- *(27) Project [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, avg_monthly_sales#27759, sum_sales#27758, sum_sales#27974 AS psum#27761, sum_sales#28461 AS nsum#27762]\n   +- *(27) SortMergeJoin [i_category#1184, i_brand#1180, cc_name#732, rn#27760], [i_category#28568, i_brand#28564, cc_name#28730, (rn#28365 - 1)], Inner\n      :- *(18) Project [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, sum_sales#27758, avg_monthly_sales#27759, rn#27760, sum_sales#27974]\n      :  +- *(18) SortMergeJoin [i_category#1184, i_brand#1180, cc_name#732, rn#27760], [i_category#28081, i_brand#28077, cc_name#28243, (rn#27878 + 1)], Inner\n      :     :- *(9) Sort [i_category#1184 ASC NULLS FIRST, i_brand#1180 ASC NULLS FIRST, cc_name#732 ASC NULLS FIRST, rn#27760 ASC NULLS FIRST], false, 0\n      :     :  +- Exchange hashpartitioning(i_category#1184, i_brand#1180, cc_name#732, rn#27760, 200)\n      :     :     +- *(8) Project [i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, sum_sales#27758, avg_monthly_sales#27759, rn#27760]\n      :     :        +- *(8) Filter (((isnotnull(avg_monthly_sales#27759) && (avg_monthly_sales#27759 > 0.000000)) && (CASE WHEN (avg_monthly_sales#27759 > 0.000000) THEN CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#27758 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#27759 as decimal(22,6)))), DecimalType(22,6)))) / promote_precision(cast(avg_monthly_sales#27759 as decimal(22,6)))), DecimalType(38,16)) ELSE null END > 0.1000000000000000)) && isnotnull(rn#27760))\n      :     :           +- Window [avg(_w0#27776) windowspecdefinition(i_category#1184, i_brand#1180, cc_name#732, d_year#1046, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#27759], [i_category#1184, i_brand#1180, cc_name#732, d_year#1046]\n      :     :              +- *(7) Filter (isnotnull(d_year#1046) && (d_year#1046 = 1999))\n      :     :                 +- Window [rank(d_year#1046, d_moy#1048) windowspecdefinition(i_category#1184, i_brand#1180, cc_name#732, d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#27760], [i_category#1184, i_brand#1180, cc_name#732], [d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST]\n      :     :                    +- *(6) Sort [i_category#1184 ASC NULLS FIRST, i_brand#1180 ASC NULLS FIRST, cc_name#732 ASC NULLS FIRST, d_year#1046 ASC NULLS FIRST, d_moy#1048 ASC NULLS FIRST], false, 0\n      :     :                       +- Exchange hashpartitioning(i_category#1184, i_brand#1180, cc_name#732, 200)\n      :     :                          +- *(5) HashAggregate(keys=[i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048], functions=[sum(UnscaledValue(cs_sales_price#1809))], output=[i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, sum_sales#27758, _w0#27776])\n      :     :                             +- Exchange hashpartitioning(i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, 200)\n      :     :                                +- *(4) HashAggregate(keys=[i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048], functions=[partial_sum(UnscaledValue(cs_sales_price#1809))], output=[i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, sum#28861L])\n      :     :                                   +- *(4) Project [i_brand#1180, i_category#1184, cs_sales_price#1809, d_year#1046, d_moy#1048, cc_name#732]\n      :     :                                      +- *(4) BroadcastHashJoin [cs_call_center_sk#1799], [cc_call_center_sk#726], Inner, BuildRight\n      :     :                                         :- *(4) Project [i_brand#1180, i_category#1184, cs_call_center_sk#1799, cs_sales_price#1809, d_year#1046, d_moy#1048]\n      :     :                                         :  +- *(4) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n      :     :                                         :     :- *(4) Project [i_brand#1180, i_category#1184, cs_call_center_sk#1799, cs_sales_price#1809, cs_sold_date_sk#1822]\n      :     :                                         :     :  +- *(4) BroadcastHashJoin [i_item_sk#1172], [cs_item_sk#1803], Inner, BuildLeft\n      :     :                                         :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                                         :     :     :  +- *(1) Project [i_item_sk#1172, i_brand#1180, i_category#1184]\n      :     :                                         :     :     :     +- *(1) Filter ((isnotnull(i_item_sk#1172) && isnotnull(i_brand#1180)) && isnotnull(i_category#1184))\n      :     :                                         :     :     :        +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand#1180,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_brand), IsNotNull(i_category)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>\n      :     :                                         :     :     +- *(4) Project [cs_call_center_sk#1799, cs_item_sk#1803, cs_sales_price#1809, cs_sold_date_sk#1822]\n      :     :                                         :     :        +- *(4) Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_call_center_sk#1799))\n      :     :                                         :     :           +- *(4) FileScan parquet db_tpcds.catalog_sales[cs_call_center_sk#1799,cs_item_sk#1803,cs_sales_price#1809,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_call_center_sk)], ReadSchema: struct<cs_call_center_sk:int,cs_item_sk:int,cs_sales_price:decimal(7,2)>\n      :     :                                         :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                                         :        +- *(2) Project [d_date_sk#1040, d_year#1046, d_moy#1048]\n      :     :                                         :           +- *(2) Filter ((((d_year#1046 = 1999) || ((d_year#1046 = 1998) && (d_moy#1048 = 12))) || ((d_year#1046 = 2000) && (d_moy#1048 = 1))) && isnotnull(d_date_sk#1040))\n      :     :                                         :              +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,1999),And(EqualTo(d_year,1998),EqualTo(d_moy,12))),And(EqualTo(d_year,2000)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n      :     :                                         +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                                            +- *(3) Project [cc_call_center_sk#726, cc_name#732]\n      :     :                                               +- *(3) Filter (isnotnull(cc_call_center_sk#726) && isnotnull(cc_name#732))\n      :     :                                                  +- *(3) FileScan parquet db_tpcds.call_center[cc_call_center_sk#726,cc_name#732] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/call_center], PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk), IsNotNull(cc_name)], ReadSchema: struct<cc_call_center_sk:int,cc_name:string>\n      :     +- *(17) Sort [i_category#28081 ASC NULLS FIRST, i_brand#28077 ASC NULLS FIRST, cc_name#28243 ASC NULLS FIRST, (rn#27878 + 1) ASC NULLS FIRST], false, 0\n      :        +- Exchange hashpartitioning(i_category#28081, i_brand#28077, cc_name#28243, (rn#27878 + 1), 200)\n      :           +- *(16) Project [i_category#28081, i_brand#28077, cc_name#28243, sum_sales#27974, rn#27878]\n      :              +- *(16) Filter isnotnull(rn#27878)\n      :                 +- Window [rank(d_year#28168, d_moy#28170) windowspecdefinition(i_category#28081, i_brand#28077, cc_name#28243, d_year#28168 ASC NULLS FIRST, d_moy#28170 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#27878], [i_category#28081, i_brand#28077, cc_name#28243], [d_year#28168 ASC NULLS FIRST, d_moy#28170 ASC NULLS FIRST]\n      :                    +- *(15) Sort [i_category#28081 ASC NULLS FIRST, i_brand#28077 ASC NULLS FIRST, cc_name#28243 ASC NULLS FIRST, d_year#28168 ASC NULLS FIRST, d_moy#28170 ASC NULLS FIRST], false, 0\n      :                       +- Exchange hashpartitioning(i_category#28081, i_brand#28077, cc_name#28243, 200)\n      :                          +- *(14) HashAggregate(keys=[i_category#28081, i_brand#28077, cc_name#28243, d_year#28168, d_moy#28170], functions=[sum(UnscaledValue(cs_sales_price#1809))], output=[i_category#28081, i_brand#28077, cc_name#28243, d_year#28168, d_moy#28170, sum_sales#27974])\n      :                             +- ReusedExchange [i_category#28081, i_brand#28077, cc_name#28243, d_year#28168, d_moy#28170, sum#28863L], Exchange hashpartitioning(i_category#1184, i_brand#1180, cc_name#732, d_year#1046, d_moy#1048, 200)\n      +- *(26) Sort [i_category#28568 ASC NULLS FIRST, i_brand#28564 ASC NULLS FIRST, cc_name#28730 ASC NULLS FIRST, (rn#28365 - 1) ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(i_category#28568, i_brand#28564, cc_name#28730, (rn#28365 - 1), 200)\n            +- *(25) Project [i_category#28568, i_brand#28564, cc_name#28730, sum_sales#28461, rn#28365]\n               +- *(25) Filter isnotnull(rn#28365)\n                  +- Window [rank(d_year#28655, d_moy#28657) windowspecdefinition(i_category#28568, i_brand#28564, cc_name#28730, d_year#28655 ASC NULLS FIRST, d_moy#28657 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#28365], [i_category#28568, i_brand#28564, cc_name#28730], [d_year#28655 ASC NULLS FIRST, d_moy#28657 ASC NULLS FIRST]\n                     +- *(24) Sort [i_category#28568 ASC NULLS FIRST, i_brand#28564 ASC NULLS FIRST, cc_name#28730 ASC NULLS FIRST, d_year#28655 ASC NULLS FIRST, d_moy#28657 ASC NULLS FIRST], false, 0\n                        +- ReusedExchange [i_category#28568, i_brand#28564, cc_name#28730, d_year#28655, d_moy#28657, sum_sales#28461], Exchange hashpartitioning(i_category#28081, i_brand#28077, cc_name#28243, 200)"},{"name":"q58-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["ss_items","cs_items","ws_items"],"parsingTime":0.002124,"analysisTime":0.001907,"optimizationTime":886.003864,"planningTime":106.421311,"executionTime":6822.929684,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ss_items, cs_items, ws_items]\n:  :- 'SubqueryAlias ss_items\n:  :  +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#30433, 'sum('ss_ext_sales_price) AS ss_item_rev#30434]\n:  :     +- 'Filter ((('ss_item_sk = 'i_item_sk) && 'd_date IN (list#30436 [])) && ('ss_sold_date_sk = 'd_date_sk))\n:  :        :  +- 'Project ['d_date]\n:  :        :     +- 'Filter ('d_week_seq = scalar-subquery#30435 [])\n:  :        :        :  +- 'Project ['d_week_seq]\n:  :        :        :     +- 'Filter ('d_date = cast(2000-01-03 as date))\n:  :        :        :        +- 'UnresolvedRelation `date_dim`\n:  :        :        +- 'UnresolvedRelation `date_dim`\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'UnresolvedRelation `store_sales`\n:  :           :  +- 'UnresolvedRelation `item`\n:  :           +- 'UnresolvedRelation `date_dim`\n:  :- 'SubqueryAlias cs_items\n:  :  +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#30437, 'sum('cs_ext_sales_price) AS cs_item_rev#30438]\n:  :     +- 'Filter ((('cs_item_sk = 'i_item_sk) && 'd_date IN (list#30440 [])) && ('cs_sold_date_sk = 'd_date_sk))\n:  :        :  +- 'Project ['d_date]\n:  :        :     +- 'Filter ('d_week_seq = scalar-subquery#30439 [])\n:  :        :        :  +- 'Project ['d_week_seq]\n:  :        :        :     +- 'Filter ('d_date = cast(2000-01-03 as date))\n:  :        :        :        +- 'UnresolvedRelation `date_dim`\n:  :        :        +- 'UnresolvedRelation `date_dim`\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'UnresolvedRelation `catalog_sales`\n:  :           :  +- 'UnresolvedRelation `item`\n:  :           +- 'UnresolvedRelation `date_dim`\n:  +- 'SubqueryAlias ws_items\n:     +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#30441, 'sum('ws_ext_sales_price) AS ws_item_rev#30442]\n:        +- 'Filter ((('ws_item_sk = 'i_item_sk) && 'd_date IN (list#30444 [])) && ('ws_sold_date_sk = 'd_date_sk))\n:           :  +- 'Project ['d_date]\n:           :     +- 'Filter ('d_week_seq = scalar-subquery#30443 [])\n:           :        :  +- 'Project ['d_week_seq]\n:           :        :     +- 'Filter ('d_date = cast(2000-01-03 as date))\n:           :        :        +- 'UnresolvedRelation `date_dim`\n:           :        +- 'UnresolvedRelation `date_dim`\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'UnresolvedRelation `web_sales`\n:              :  +- 'UnresolvedRelation `item`\n:              +- 'UnresolvedRelation `date_dim`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['ss_items.item_id ASC NULLS FIRST, 'ss_item_rev ASC NULLS FIRST], true\n         +- 'Project ['ss_items.item_id, 'ss_item_rev, ((('ss_item_rev / (('ss_item_rev + 'cs_item_rev) + 'ws_item_rev)) / 3) * 100) AS ss_dev#30429, 'cs_item_rev, ((('cs_item_rev / (('ss_item_rev + 'cs_item_rev) + 'ws_item_rev)) / 3) * 100) AS cs_dev#30430, 'ws_item_rev, ((('ws_item_rev / (('ss_item_rev + 'cs_item_rev) + 'ws_item_rev)) / 3) * 100) AS ws_dev#30431, ((('ss_item_rev + 'cs_item_rev) + 'ws_item_rev) / 3) AS average#30432]\n            +- 'Filter (((('ss_items.item_id = 'cs_items.item_id) && ('ss_items.item_id = 'ws_items.item_id)) && ((('ss_item_rev >= (0.9 * 'cs_item_rev)) && ('ss_item_rev <= (1.1 * 'cs_item_rev))) && (('ss_item_rev >= (0.9 * 'ws_item_rev)) && ('ss_item_rev <= (1.1 * 'ws_item_rev))))) && (((('cs_item_rev >= (0.9 * 'ss_item_rev)) && ('cs_item_rev <= (1.1 * 'ss_item_rev))) && (('cs_item_rev >= (0.9 * 'ws_item_rev)) && ('cs_item_rev <= (1.1 * 'ws_item_rev)))) && ((('ws_item_rev >= (0.9 * 'ss_item_rev)) && ('ws_item_rev <= (1.1 * 'ss_item_rev))) && (('ws_item_rev >= (0.9 * 'cs_item_rev)) && ('ws_item_rev <= (1.1 * 'cs_item_rev))))))\n               +- 'Join Inner\n                  :- 'Join Inner\n                  :  :- 'UnresolvedRelation `ss_items`\n                  :  +- 'UnresolvedRelation `cs_items`\n                  +- 'UnresolvedRelation `ws_items`\n\n== Analyzed Logical Plan ==\nitem_id: string, ss_item_rev: decimal(17,2), ss_dev: decimal(38,17), cs_item_rev: decimal(17,2), cs_dev: decimal(38,17), ws_item_rev: decimal(17,2), ws_dev: decimal(38,17), average: decimal(23,6)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [item_id#30433 ASC NULLS FIRST, ss_item_rev#30434 ASC NULLS FIRST], true\n      +- Project [item_id#30433, ss_item_rev#30434, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(19,2))) / promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(18,2))) + promote_precision(cast(cs_item_rev#30438 as decimal(18,2)))), DecimalType(18,2)) as decimal(19,2))) + promote_precision(cast(ws_item_rev#30442 as decimal(19,2)))), DecimalType(19,2)) as decimal(19,2)))), DecimalType(38,21)) as decimal(38,21))) / promote_precision(cast(cast(3 as decimal(1,0)) as decimal(38,21)))), DecimalType(38,21)) as decimal(38,21))) * promote_precision(cast(cast(100 as decimal(3,0)) as decimal(38,21)))), DecimalType(38,17)) AS ss_dev#30429, cs_item_rev#30438, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cs_item_rev#30438 as decimal(19,2))) / promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(18,2))) + promote_precision(cast(cs_item_rev#30438 as decimal(18,2)))), DecimalType(18,2)) as decimal(19,2))) + promote_precision(cast(ws_item_rev#30442 as decimal(19,2)))), DecimalType(19,2)) as decimal(19,2)))), DecimalType(38,21)) as decimal(38,21))) / promote_precision(cast(cast(3 as decimal(1,0)) as decimal(38,21)))), DecimalType(38,21)) as decimal(38,21))) * promote_precision(cast(cast(100 as decimal(3,0)) as decimal(38,21)))), DecimalType(38,17)) AS cs_dev#30430, ws_item_rev#30442, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ws_item_rev#30442 as decimal(19,2))) / promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(18,2))) + promote_precision(cast(cs_item_rev#30438 as decimal(18,2)))), DecimalType(18,2)) as decimal(19,2))) + promote_precision(cast(ws_item_rev#30442 as decimal(19,2)))), DecimalType(19,2)) as decimal(19,2)))), DecimalType(38,21)) as decimal(38,21))) / promote_precision(cast(cast(3 as decimal(1,0)) as decimal(38,21)))), DecimalType(38,21)) as decimal(38,21))) * promote_precision(cast(cast(100 as decimal(3,0)) as decimal(38,21)))), DecimalType(38,17)) AS ws_dev#30431, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(18,2))) + promote_precision(cast(cs_item_rev#30438 as decimal(18,2)))), DecimalType(18,2)) as decimal(19,2))) + promote_precision(cast(ws_item_rev#30442 as decimal(19,2)))), DecimalType(19,2)) as decimal(19,2))) / promote_precision(cast(cast(3 as decimal(1,0)) as decimal(19,2)))), DecimalType(23,6)) AS average#30432]\n         +- Filter ((((item_id#30433 = item_id#30437) && (item_id#30433 = item_id#30441)) && (((cast(ss_item_rev#30434 as decimal(19,3)) >= cast(CheckOverflow((promote_precision(cast(0.9 as decimal(17,2))) * promote_precision(cast(cs_item_rev#30438 as decimal(17,2)))), DecimalType(19,3)) as decimal(19,3))) && (cast(ss_item_rev#30434 as decimal(20,3)) <= cast(CheckOverflow((promote_precision(cast(1.1 as decimal(17,2))) * promote_precision(cast(cs_item_rev#30438 as decimal(17,2)))), DecimalType(20,3)) as decimal(20,3)))) && ((cast(ss_item_rev#30434 as decimal(19,3)) >= cast(CheckOverflow((promote_precision(cast(0.9 as decimal(17,2))) * promote_precision(cast(ws_item_rev#30442 as decimal(17,2)))), DecimalType(19,3)) as decimal(19,3))) && (cast(ss_item_rev#30434 as decimal(20,3)) <= cast(CheckOverflow((promote_precision(cast(1.1 as decimal(17,2))) * promote_precision(cast(ws_item_rev#30442 as decimal(17,2)))), DecimalType(20,3)) as decimal(20,3)))))) && ((((cast(cs_item_rev#30438 as decimal(19,3)) >= cast(CheckOverflow((promote_precision(cast(0.9 as decimal(17,2))) * promote_precision(cast(ss_item_rev#30434 as decimal(17,2)))), DecimalType(19,3)) as decimal(19,3))) && (cast(cs_item_rev#30438 as decimal(20,3)) <= cast(CheckOverflow((promote_precision(cast(1.1 as decimal(17,2))) * promote_precision(cast(ss_item_rev#30434 as decimal(17,2)))), DecimalType(20,3)) as decimal(20,3)))) && ((cast(cs_item_rev#30438 as decimal(19,3)) >= cast(CheckOverflow((promote_precision(cast(0.9 as decimal(17,2))) * promote_precision(cast(ws_item_rev#30442 as decimal(17,2)))), DecimalType(19,3)) as decimal(19,3))) && (cast(cs_item_rev#30438 as decimal(20,3)) <= cast(CheckOverflow((promote_precision(cast(1.1 as decimal(17,2))) * promote_precision(cast(ws_item_rev#30442 as decimal(17,2)))), DecimalType(20,3)) as decimal(20,3))))) && (((cast(ws_item_rev#30442 as decimal(19,3)) >= cast(CheckOverflow((promote_precision(cast(0.9 as decimal(17,2))) * promote_precision(cast(ss_item_rev#30434 as decimal(17,2)))), DecimalType(19,3)) as decimal(19,3))) && (cast(ws_item_rev#30442 as decimal(20,3)) <= cast(CheckOverflow((promote_precision(cast(1.1 as decimal(17,2))) * promote_precision(cast(ss_item_rev#30434 as decimal(17,2)))), DecimalType(20,3)) as decimal(20,3)))) && ((cast(ws_item_rev#30442 as decimal(19,3)) >= cast(CheckOverflow((promote_precision(cast(0.9 as decimal(17,2))) * promote_precision(cast(cs_item_rev#30438 as decimal(17,2)))), DecimalType(19,3)) as decimal(19,3))) && (cast(ws_item_rev#30442 as decimal(20,3)) <= cast(CheckOverflow((promote_precision(cast(1.1 as decimal(17,2))) * promote_precision(cast(cs_item_rev#30438 as decimal(17,2)))), DecimalType(20,3)) as decimal(20,3)))))))\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias ss_items\n               :  :  +- Aggregate [i_item_id#1173], [i_item_id#1173 AS item_id#30433, sum(ss_ext_sales_price#1918) AS ss_item_rev#30434]\n               :  :     +- Filter (((ss_item_sk#1905 = i_item_sk#1172) && d_date#1042 IN (list#30436 [])) && (ss_sold_date_sk#1926 = d_date_sk#1040))\n               :  :        :  +- Project [d_date#1042]\n               :  :        :     +- Filter (d_week_seq#1044 = scalar-subquery#30435 [])\n               :  :        :        :  +- Project [d_week_seq#1044]\n               :  :        :        :     +- Filter (d_date#1042 = cast(2000-01-03 as date))\n               :  :        :        :        +- SubqueryAlias date_dim\n               :  :        :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :        :        +- SubqueryAlias date_dim\n               :  :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :        +- Join Inner\n               :  :           :- Join Inner\n               :  :           :  :- SubqueryAlias store_sales\n               :  :           :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :           :  +- SubqueryAlias item\n               :  :           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  :           +- SubqueryAlias date_dim\n               :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  +- SubqueryAlias cs_items\n               :     +- Aggregate [i_item_id#1173], [i_item_id#1173 AS item_id#30437, sum(cs_ext_sales_price#1811) AS cs_item_rev#30438]\n               :        +- Filter (((cs_item_sk#1803 = i_item_sk#1172) && d_date#1042 IN (list#30440 [])) && (cs_sold_date_sk#1822 = d_date_sk#1040))\n               :           :  +- Project [d_date#1042]\n               :           :     +- Filter (d_week_seq#1044 = scalar-subquery#30439 [])\n               :           :        :  +- Project [d_week_seq#1044]\n               :           :        :     +- Filter (d_date#1042 = cast(2000-01-03 as date))\n               :           :        :        +- SubqueryAlias date_dim\n               :           :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :           :        +- SubqueryAlias date_dim\n               :           :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :           +- Join Inner\n               :              :- Join Inner\n               :              :  :- SubqueryAlias catalog_sales\n               :              :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :              :  +- SubqueryAlias item\n               :              :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              +- SubqueryAlias date_dim\n               :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- SubqueryAlias ws_items\n                  +- Aggregate [i_item_id#1173], [i_item_id#1173 AS item_id#30441, sum(ws_ext_sales_price#1777) AS ws_item_rev#30442]\n                     +- Filter (((ws_item_sk#1757 = i_item_sk#1172) && d_date#1042 IN (list#30444 [])) && (ws_sold_date_sk#1788 = d_date_sk#1040))\n                        :  +- Project [d_date#1042]\n                        :     +- Filter (d_week_seq#1044 = scalar-subquery#30443 [])\n                        :        :  +- Project [d_week_seq#1044]\n                        :        :     +- Filter (d_date#1042 = cast(2000-01-03 as date))\n                        :        :        +- SubqueryAlias date_dim\n                        :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :        +- SubqueryAlias date_dim\n                        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Join Inner\n                           :- Join Inner\n                           :  :- SubqueryAlias web_sales\n                           :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                           :  +- SubqueryAlias item\n                           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                           +- SubqueryAlias date_dim\n                              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [item_id#30433 ASC NULLS FIRST, ss_item_rev#30434 ASC NULLS FIRST], true\n      +- Project [item_id#30433, ss_item_rev#30434, CheckOverflow((promote_precision(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(19,2))) / promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(18,2))) + promote_precision(cast(cs_item_rev#30438 as decimal(18,2)))), DecimalType(18,2)) as decimal(19,2))) + promote_precision(cast(ws_item_rev#30442 as decimal(19,2)))), DecimalType(19,2)))), DecimalType(38,21))) / 3.000000000000000000000), DecimalType(38,21))) * 100.000000000000000000000), DecimalType(38,17)) AS ss_dev#30429, cs_item_rev#30438, CheckOverflow((promote_precision(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(cs_item_rev#30438 as decimal(19,2))) / promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(18,2))) + promote_precision(cast(cs_item_rev#30438 as decimal(18,2)))), DecimalType(18,2)) as decimal(19,2))) + promote_precision(cast(ws_item_rev#30442 as decimal(19,2)))), DecimalType(19,2)))), DecimalType(38,21))) / 3.000000000000000000000), DecimalType(38,21))) * 100.000000000000000000000), DecimalType(38,17)) AS cs_dev#30430, ws_item_rev#30442, CheckOverflow((promote_precision(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(ws_item_rev#30442 as decimal(19,2))) / promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(18,2))) + promote_precision(cast(cs_item_rev#30438 as decimal(18,2)))), DecimalType(18,2)) as decimal(19,2))) + promote_precision(cast(ws_item_rev#30442 as decimal(19,2)))), DecimalType(19,2)))), DecimalType(38,21))) / 3.000000000000000000000), DecimalType(38,21))) * 100.000000000000000000000), DecimalType(38,17)) AS ws_dev#30431, CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(18,2))) + promote_precision(cast(cs_item_rev#30438 as decimal(18,2)))), DecimalType(18,2)) as decimal(19,2))) + promote_precision(cast(ws_item_rev#30442 as decimal(19,2)))), DecimalType(19,2))) / 3.00), DecimalType(23,6)) AS average#30432]\n         +- Join Inner, (((((((((item_id#30433 = item_id#30441) && (cast(ss_item_rev#30434 as decimal(19,3)) >= CheckOverflow((0.90 * promote_precision(ws_item_rev#30442)), DecimalType(19,3)))) && (cast(ss_item_rev#30434 as decimal(20,3)) <= CheckOverflow((1.10 * promote_precision(ws_item_rev#30442)), DecimalType(20,3)))) && (cast(cs_item_rev#30438 as decimal(19,3)) >= CheckOverflow((0.90 * promote_precision(ws_item_rev#30442)), DecimalType(19,3)))) && (cast(cs_item_rev#30438 as decimal(20,3)) <= CheckOverflow((1.10 * promote_precision(ws_item_rev#30442)), DecimalType(20,3)))) && (cast(ws_item_rev#30442 as decimal(19,3)) >= CheckOverflow((0.90 * promote_precision(ss_item_rev#30434)), DecimalType(19,3)))) && (cast(ws_item_rev#30442 as decimal(20,3)) <= CheckOverflow((1.10 * promote_precision(ss_item_rev#30434)), DecimalType(20,3)))) && (cast(ws_item_rev#30442 as decimal(19,3)) >= CheckOverflow((0.90 * promote_precision(cs_item_rev#30438)), DecimalType(19,3)))) && (cast(ws_item_rev#30442 as decimal(20,3)) <= CheckOverflow((1.10 * promote_precision(cs_item_rev#30438)), DecimalType(20,3))))\n            :- Project [item_id#30433, ss_item_rev#30434, cs_item_rev#30438]\n            :  +- Join Inner, (((((item_id#30433 = item_id#30437) && (cast(ss_item_rev#30434 as decimal(19,3)) >= CheckOverflow((0.90 * promote_precision(cs_item_rev#30438)), DecimalType(19,3)))) && (cast(ss_item_rev#30434 as decimal(20,3)) <= CheckOverflow((1.10 * promote_precision(cs_item_rev#30438)), DecimalType(20,3)))) && (cast(cs_item_rev#30438 as decimal(19,3)) >= CheckOverflow((0.90 * promote_precision(ss_item_rev#30434)), DecimalType(19,3)))) && (cast(cs_item_rev#30438 as decimal(20,3)) <= CheckOverflow((1.10 * promote_precision(ss_item_rev#30434)), DecimalType(20,3))))\n            :     :- Filter isnotnull(ss_item_rev#30434)\n            :     :  +- Aggregate [i_item_id#1173], [i_item_id#1173 AS item_id#30433, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS ss_item_rev#30434]\n            :     :     +- Project [ss_ext_sales_price#1918, i_item_id#1173]\n            :     :        +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :     :           :- Project [ss_ext_sales_price#1918, ss_sold_date_sk#1926, i_item_id#1173]\n            :     :           :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n            :     :           :     :- Project [ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :     :           :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n            :     :           :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :           :     +- Project [i_item_sk#1172, i_item_id#1173]\n            :     :           :        +- Filter (isnotnull(i_item_sk#1172) && isnotnull(i_item_id#1173))\n            :     :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :     :           +- Project [d_date_sk#1040]\n            :     :              +- Join LeftSemi, (d_date#1042 = d_date#1042#30456)\n            :     :                 :- Project [d_date_sk#1040, d_date#1042]\n            :     :                 :  +- Filter isnotnull(d_date_sk#1040)\n            :     :                 :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :                 +- Project [d_date#1042 AS d_date#1042#30456]\n            :     :                    +- Filter (isnotnull(d_week_seq#1044) && (d_week_seq#1044 = scalar-subquery#30435 []))\n            :     :                       :  +- Project [d_week_seq#1044]\n            :     :                       :     +- Filter (isnotnull(d_date#1042) && (d_date#1042 = 10959))\n            :     :                       :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     +- Filter isnotnull(cs_item_rev#30438)\n            :        +- Aggregate [i_item_id#1173], [i_item_id#1173 AS item_id#30437, MakeDecimal(sum(UnscaledValue(cs_ext_sales_price#1811)),17,2) AS cs_item_rev#30438]\n            :           +- Project [cs_ext_sales_price#1811, i_item_id#1173]\n            :              +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n            :                 :- Project [cs_ext_sales_price#1811, cs_sold_date_sk#1822, i_item_id#1173]\n            :                 :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n            :                 :     :- Project [cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n            :                 :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n            :                 :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :                 :     +- Project [i_item_sk#1172, i_item_id#1173]\n            :                 :        +- Filter (isnotnull(i_item_sk#1172) && isnotnull(i_item_id#1173))\n            :                 :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :                 +- Project [d_date_sk#1040]\n            :                    +- Join LeftSemi, (d_date#1042 = d_date#1042#30457)\n            :                       :- Project [d_date_sk#1040, d_date#1042]\n            :                       :  +- Filter isnotnull(d_date_sk#1040)\n            :                       :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :                       +- Project [d_date#1042 AS d_date#1042#30457]\n            :                          +- Filter (isnotnull(d_week_seq#1044) && (d_week_seq#1044 = scalar-subquery#30439 []))\n            :                             :  +- Project [d_week_seq#1044]\n            :                             :     +- Filter (isnotnull(d_date#1042) && (d_date#1042 = 10959))\n            :                             :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :                             +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Filter isnotnull(ws_item_rev#30442)\n               +- Aggregate [i_item_id#1173], [i_item_id#1173 AS item_id#30441, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#1777)),17,2) AS ws_item_rev#30442]\n                  +- Project [ws_ext_sales_price#1777, i_item_id#1173]\n                     +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                        :- Project [ws_ext_sales_price#1777, ws_sold_date_sk#1788, i_item_id#1173]\n                        :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n                        :     :- Project [ws_item_sk#1757, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                        :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n                        :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        :     +- Project [i_item_sk#1172, i_item_id#1173]\n                        :        +- Filter (isnotnull(i_item_sk#1172) && isnotnull(i_item_id#1173))\n                        :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        +- Project [d_date_sk#1040]\n                           +- Join LeftSemi, (d_date#1042 = d_date#1042#30458)\n                              :- Project [d_date_sk#1040, d_date#1042]\n                              :  +- Filter isnotnull(d_date_sk#1040)\n                              :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              +- Project [d_date#1042 AS d_date#1042#30458]\n                                 +- Filter (isnotnull(d_week_seq#1044) && (d_week_seq#1044 = scalar-subquery#30443 []))\n                                    :  +- Project [d_week_seq#1044]\n                                    :     +- Filter (isnotnull(d_date#1042) && (d_date#1042 = 10959))\n                                    :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[item_id#30433 ASC NULLS FIRST,ss_item_rev#30434 ASC NULLS FIRST], output=[item_id#30433,ss_item_rev#30434,ss_dev#30429,cs_item_rev#30438,cs_dev#30430,ws_item_rev#30442,ws_dev#30431,average#30432])\n+- *(20) Project [item_id#30433, ss_item_rev#30434, CheckOverflow((promote_precision(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(19,2))) / promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(18,2))) + promote_precision(cast(cs_item_rev#30438 as decimal(18,2)))), DecimalType(18,2)) as decimal(19,2))) + promote_precision(cast(ws_item_rev#30442 as decimal(19,2)))), DecimalType(19,2)))), DecimalType(38,21))) / 3.000000000000000000000), DecimalType(38,21))) * 100.000000000000000000000), DecimalType(38,17)) AS ss_dev#30429, cs_item_rev#30438, CheckOverflow((promote_precision(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(cs_item_rev#30438 as decimal(19,2))) / promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(18,2))) + promote_precision(cast(cs_item_rev#30438 as decimal(18,2)))), DecimalType(18,2)) as decimal(19,2))) + promote_precision(cast(ws_item_rev#30442 as decimal(19,2)))), DecimalType(19,2)))), DecimalType(38,21))) / 3.000000000000000000000), DecimalType(38,21))) * 100.000000000000000000000), DecimalType(38,17)) AS cs_dev#30430, ws_item_rev#30442, CheckOverflow((promote_precision(CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(ws_item_rev#30442 as decimal(19,2))) / promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(18,2))) + promote_precision(cast(cs_item_rev#30438 as decimal(18,2)))), DecimalType(18,2)) as decimal(19,2))) + promote_precision(cast(ws_item_rev#30442 as decimal(19,2)))), DecimalType(19,2)))), DecimalType(38,21))) / 3.000000000000000000000), DecimalType(38,21))) * 100.000000000000000000000), DecimalType(38,17)) AS ws_dev#30431, CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(ss_item_rev#30434 as decimal(18,2))) + promote_precision(cast(cs_item_rev#30438 as decimal(18,2)))), DecimalType(18,2)) as decimal(19,2))) + promote_precision(cast(ws_item_rev#30442 as decimal(19,2)))), DecimalType(19,2))) / 3.00), DecimalType(23,6)) AS average#30432]\n   +- *(20) SortMergeJoin [item_id#30433], [item_id#30441], Inner, ((((((((cast(ss_item_rev#30434 as decimal(19,3)) >= CheckOverflow((0.90 * promote_precision(ws_item_rev#30442)), DecimalType(19,3))) && (cast(ss_item_rev#30434 as decimal(20,3)) <= CheckOverflow((1.10 * promote_precision(ws_item_rev#30442)), DecimalType(20,3)))) && (cast(cs_item_rev#30438 as decimal(19,3)) >= CheckOverflow((0.90 * promote_precision(ws_item_rev#30442)), DecimalType(19,3)))) && (cast(cs_item_rev#30438 as decimal(20,3)) <= CheckOverflow((1.10 * promote_precision(ws_item_rev#30442)), DecimalType(20,3)))) && (cast(ws_item_rev#30442 as decimal(19,3)) >= CheckOverflow((0.90 * promote_precision(ss_item_rev#30434)), DecimalType(19,3)))) && (cast(ws_item_rev#30442 as decimal(20,3)) <= CheckOverflow((1.10 * promote_precision(ss_item_rev#30434)), DecimalType(20,3)))) && (cast(ws_item_rev#30442 as decimal(19,3)) >= CheckOverflow((0.90 * promote_precision(cs_item_rev#30438)), DecimalType(19,3)))) && (cast(ws_item_rev#30442 as decimal(20,3)) <= CheckOverflow((1.10 * promote_precision(cs_item_rev#30438)), DecimalType(20,3))))\n      :- *(13) Project [item_id#30433, ss_item_rev#30434, cs_item_rev#30438]\n      :  +- *(13) SortMergeJoin [item_id#30433], [item_id#30437], Inner, ((((cast(ss_item_rev#30434 as decimal(19,3)) >= CheckOverflow((0.90 * promote_precision(cs_item_rev#30438)), DecimalType(19,3))) && (cast(ss_item_rev#30434 as decimal(20,3)) <= CheckOverflow((1.10 * promote_precision(cs_item_rev#30438)), DecimalType(20,3)))) && (cast(cs_item_rev#30438 as decimal(19,3)) >= CheckOverflow((0.90 * promote_precision(ss_item_rev#30434)), DecimalType(19,3)))) && (cast(cs_item_rev#30438 as decimal(20,3)) <= CheckOverflow((1.10 * promote_precision(ss_item_rev#30434)), DecimalType(20,3))))\n      :     :- *(6) Sort [item_id#30433 ASC NULLS FIRST], false, 0\n      :     :  +- Exchange hashpartitioning(item_id#30433, 200)\n      :     :     +- *(5) Filter isnotnull(ss_item_rev#30434)\n      :     :        +- *(5) HashAggregate(keys=[i_item_id#1173], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[item_id#30433, ss_item_rev#30434])\n      :     :           +- Exchange hashpartitioning(i_item_id#1173, 200)\n      :     :              +- *(4) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[i_item_id#1173, sum#30460L])\n      :     :                 +- *(4) Project [ss_ext_sales_price#1918, i_item_id#1173]\n      :     :                    +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :     :                       :- *(4) Project [ss_ext_sales_price#1918, ss_sold_date_sk#1926, i_item_id#1173]\n      :     :                       :  +- *(4) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n      :     :                       :     :- *(4) Project [ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n      :     :                       :     :  +- *(4) Filter isnotnull(ss_item_sk#1905)\n      :     :                       :     :     +- *(4) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_ext_sales_price:decimal(7,2)>\n      :     :                       :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                       :        +- *(1) Project [i_item_sk#1172, i_item_id#1173]\n      :     :                       :           +- *(1) Filter (isnotnull(i_item_sk#1172) && isnotnull(i_item_id#1173))\n      :     :                       :              +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_item_id)], ReadSchema: struct<i_item_sk:int,i_item_id:string>\n      :     :                       +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                          +- *(3) Project [d_date_sk#1040]\n      :     :                             +- *(3) BroadcastHashJoin [d_date#1042], [d_date#1042#30456], LeftSemi, BuildRight\n      :     :                                :- *(3) Project [d_date_sk#1040, d_date#1042]\n      :     :                                :  +- *(3) Filter isnotnull(d_date_sk#1040)\n      :     :                                :     +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_date:date>\n      :     :                                +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]))\n      :     :                                   +- *(2) Project [d_date#1042 AS d_date#1042#30456]\n      :     :                                      +- *(2) Filter (isnotnull(d_week_seq#1044) && (d_week_seq#1044 = Subquery subquery30435))\n      :     :                                         :  +- Subquery subquery30435\n      :     :                                         :     +- *(1) Project [d_week_seq#1044]\n      :     :                                         :        +- *(1) Filter (isnotnull(d_date#1042) && (d_date#1042 = 10959))\n      :     :                                         :           +- *(1) FileScan parquet db_tpcds.date_dim[d_date#1042,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), EqualTo(d_date,2000-01-03)], ReadSchema: struct<d_date:date,d_week_seq:int>\n      :     :                                         +- *(2) FileScan parquet db_tpcds.date_dim[d_date#1042,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq)], ReadSchema: struct<d_date:date,d_week_seq:int>\n      :     :                                               +- Subquery subquery30435\n      :     :                                                  +- *(1) Project [d_week_seq#1044]\n      :     :                                                     +- *(1) Filter (isnotnull(d_date#1042) && (d_date#1042 = 10959))\n      :     :                                                        +- *(1) FileScan parquet db_tpcds.date_dim[d_date#1042,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), EqualTo(d_date,2000-01-03)], ReadSchema: struct<d_date:date,d_week_seq:int>\n      :     +- *(12) Sort [item_id#30437 ASC NULLS FIRST], false, 0\n      :        +- Exchange hashpartitioning(item_id#30437, 200)\n      :           +- *(11) Filter isnotnull(cs_item_rev#30438)\n      :              +- *(11) HashAggregate(keys=[i_item_id#1173], functions=[sum(UnscaledValue(cs_ext_sales_price#1811))], output=[item_id#30437, cs_item_rev#30438])\n      :                 +- Exchange hashpartitioning(i_item_id#1173, 200)\n      :                    +- *(10) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(UnscaledValue(cs_ext_sales_price#1811))], output=[i_item_id#1173, sum#30462L])\n      :                       +- *(10) Project [cs_ext_sales_price#1811, i_item_id#1173]\n      :                          +- *(10) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n      :                             :- *(10) Project [cs_ext_sales_price#1811, cs_sold_date_sk#1822, i_item_id#1173]\n      :                             :  +- *(10) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n      :                             :     :- *(10) Project [cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n      :                             :     :  +- *(10) Filter isnotnull(cs_item_sk#1803)\n      :                             :     :     +- *(10) FileScan parquet db_tpcds.catalog_sales[cs_item_sk#1803,cs_ext_sales_price#1811,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:int,cs_ext_sales_price:decimal(7,2)>\n      :                             :     +- ReusedExchange [i_item_sk#1172, i_item_id#1173], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                                +- *(9) Project [d_date_sk#1040]\n      :                                   +- *(9) BroadcastHashJoin [d_date#1042], [d_date#1042#30457], LeftSemi, BuildRight\n      :                                      :- *(9) Project [d_date_sk#1040, d_date#1042]\n      :                                      :  +- *(9) Filter isnotnull(d_date_sk#1040)\n      :                                      :     +- *(9) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_date:date>\n      :                                      +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]))\n      :                                         +- *(8) Project [d_date#1042 AS d_date#1042#30457]\n      :                                            +- *(8) Filter (isnotnull(d_week_seq#1044) && (d_week_seq#1044 = Subquery subquery30439))\n      :                                               :  +- Subquery subquery30439\n      :                                               :     +- *(1) Project [d_week_seq#1044]\n      :                                               :        +- *(1) Filter (isnotnull(d_date#1042) && (d_date#1042 = 10959))\n      :                                               :           +- *(1) FileScan parquet db_tpcds.date_dim[d_date#1042,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), EqualTo(d_date,2000-01-03)], ReadSchema: struct<d_date:date,d_week_seq:int>\n      :                                               +- *(8) FileScan parquet db_tpcds.date_dim[d_date#1042,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq)], ReadSchema: struct<d_date:date,d_week_seq:int>\n      :                                                     +- Subquery subquery30439\n      :                                                        +- *(1) Project [d_week_seq#1044]\n      :                                                           +- *(1) Filter (isnotnull(d_date#1042) && (d_date#1042 = 10959))\n      :                                                              +- *(1) FileScan parquet db_tpcds.date_dim[d_date#1042,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), EqualTo(d_date,2000-01-03)], ReadSchema: struct<d_date:date,d_week_seq:int>\n      +- *(19) Sort [item_id#30441 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(item_id#30441, 200)\n            +- *(18) Filter isnotnull(ws_item_rev#30442)\n               +- *(18) HashAggregate(keys=[i_item_id#1173], functions=[sum(UnscaledValue(ws_ext_sales_price#1777))], output=[item_id#30441, ws_item_rev#30442])\n                  +- Exchange hashpartitioning(i_item_id#1173, 200)\n                     +- *(17) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(UnscaledValue(ws_ext_sales_price#1777))], output=[i_item_id#1173, sum#30464L])\n                        +- *(17) Project [ws_ext_sales_price#1777, i_item_id#1173]\n                           +- *(17) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                              :- *(17) Project [ws_ext_sales_price#1777, ws_sold_date_sk#1788, i_item_id#1173]\n                              :  +- *(17) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n                              :     :- *(17) Project [ws_item_sk#1757, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                              :     :  +- *(17) Filter isnotnull(ws_item_sk#1757)\n                              :     :     +- *(17) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_ext_sales_price:decimal(7,2)>\n                              :     +- ReusedExchange [i_item_sk#1172, i_item_id#1173], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 +- *(16) Project [d_date_sk#1040]\n                                    +- *(16) BroadcastHashJoin [d_date#1042], [d_date#1042#30458], LeftSemi, BuildRight\n                                       :- *(16) Project [d_date_sk#1040, d_date#1042]\n                                       :  +- *(16) Filter isnotnull(d_date_sk#1040)\n                                       :     +- *(16) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_date:date>\n                                       +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]))\n                                          +- *(15) Project [d_date#1042 AS d_date#1042#30458]\n                                             +- *(15) Filter (isnotnull(d_week_seq#1044) && (d_week_seq#1044 = Subquery subquery30443))\n                                                :  +- Subquery subquery30443\n                                                :     +- *(1) Project [d_week_seq#1044]\n                                                :        +- *(1) Filter (isnotnull(d_date#1042) && (d_date#1042 = 10959))\n                                                :           +- *(1) FileScan parquet db_tpcds.date_dim[d_date#1042,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), EqualTo(d_date,2000-01-03)], ReadSchema: struct<d_date:date,d_week_seq:int>\n                                                +- *(15) FileScan parquet db_tpcds.date_dim[d_date#1042,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_week_seq)], ReadSchema: struct<d_date:date,d_week_seq:int>\n                                                      +- Subquery subquery30443\n                                                         +- *(1) Project [d_week_seq#1044]\n                                                            +- *(1) Filter (isnotnull(d_date#1042) && (d_date#1042 = 10959))\n                                                               +- *(1) FileScan parquet db_tpcds.date_dim[d_date#1042,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), EqualTo(d_date,2000-01-03)], ReadSchema: struct<d_date:date,d_week_seq:int>"},{"name":"q59-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["wss","store","date_dim","wss","store","date_dim"],"parsingTime":0.003377,"analysisTime":9.81E-4,"optimizationTime":552.419788,"planningTime":44.313894,"executionTime":4882.214174,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [wss]\n:  +- 'SubqueryAlias wss\n:     +- 'Aggregate ['d_week_seq, 'ss_store_sk], ['d_week_seq, 'ss_store_sk, 'sum(CASE WHEN ('d_day_name = Sunday) THEN 'ss_sales_price ELSE null END) AS sun_sales#30665, 'sum(CASE WHEN ('d_day_name = Monday) THEN 'ss_sales_price ELSE null END) AS mon_sales#30666, 'sum(CASE WHEN ('d_day_name = Tuesday) THEN 'ss_sales_price ELSE null END) AS tue_sales#30667, 'sum(CASE WHEN ('d_day_name = Wednesday) THEN 'ss_sales_price ELSE null END) AS wed_sales#30668, 'sum(CASE WHEN ('d_day_name = Thursday) THEN 'ss_sales_price ELSE null END) AS thu_sales#30669, 'sum(CASE WHEN ('d_day_name = Friday) THEN 'ss_sales_price ELSE null END) AS fri_sales#30670, 'sum(CASE WHEN ('d_day_name = Saturday) THEN 'ss_sales_price ELSE null END) AS sat_sales#30671]\n:        +- 'Filter ('d_date_sk = 'ss_sold_date_sk)\n:           +- 'Join Inner\n:              :- 'UnresolvedRelation `store_sales`\n:              +- 'UnresolvedRelation `date_dim`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['s_store_name1 ASC NULLS FIRST, 's_store_id1 ASC NULLS FIRST, 'd_week_seq1 ASC NULLS FIRST], true\n         +- 'Project ['s_store_name1, 's_store_id1, 'd_week_seq1, unresolvedalias(('sun_sales1 / 'sun_sales2), None), unresolvedalias(('mon_sales1 / 'mon_sales2), None), unresolvedalias(('tue_sales1 / 'tue_sales2), None), unresolvedalias(('wed_sales1 / 'wed_sales2), None), unresolvedalias(('thu_sales1 / 'thu_sales2), None), unresolvedalias(('fri_sales1 / 'fri_sales2), None), unresolvedalias(('sat_sales1 / 'sat_sales2), None)]\n            +- 'Filter (('s_store_id1 = 's_store_id2) && ('d_week_seq1 = ('d_week_seq2 - 52)))\n               +- 'Join Inner\n                  :- 'SubqueryAlias y\n                  :  +- 'Project ['s_store_name AS s_store_name1#30645, 'wss.d_week_seq AS d_week_seq1#30646, 's_store_id AS s_store_id1#30647, 'sun_sales AS sun_sales1#30648, 'mon_sales AS mon_sales1#30649, 'tue_sales AS tue_sales1#30650, 'wed_sales AS wed_sales1#30651, 'thu_sales AS thu_sales1#30652, 'fri_sales AS fri_sales1#30653, 'sat_sales AS sat_sales1#30654]\n                  :     +- 'Filter ((('d.d_week_seq = 'wss.d_week_seq) && ('ss_store_sk = 's_store_sk)) && (('d_month_seq >= 1212) && ('d_month_seq <= (1212 + 11))))\n                  :        +- 'Join Inner\n                  :           :- 'Join Inner\n                  :           :  :- 'UnresolvedRelation `wss`\n                  :           :  +- 'UnresolvedRelation `store`\n                  :           +- 'SubqueryAlias d\n                  :              +- 'UnresolvedRelation `date_dim`\n                  +- 'SubqueryAlias x\n                     +- 'Project ['s_store_name AS s_store_name2#30655, 'wss.d_week_seq AS d_week_seq2#30656, 's_store_id AS s_store_id2#30657, 'sun_sales AS sun_sales2#30658, 'mon_sales AS mon_sales2#30659, 'tue_sales AS tue_sales2#30660, 'wed_sales AS wed_sales2#30661, 'thu_sales AS thu_sales2#30662, 'fri_sales AS fri_sales2#30663, 'sat_sales AS sat_sales2#30664]\n                        +- 'Filter ((('d.d_week_seq = 'wss.d_week_seq) && ('ss_store_sk = 's_store_sk)) && (('d_month_seq >= (1212 + 12)) && ('d_month_seq <= (1212 + 23))))\n                           +- 'Join Inner\n                              :- 'Join Inner\n                              :  :- 'UnresolvedRelation `wss`\n                              :  +- 'UnresolvedRelation `store`\n                              +- 'SubqueryAlias d\n                                 +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\ns_store_name1: string, s_store_id1: string, d_week_seq1: int, (sun_sales1 / sun_sales2): decimal(37,20), (mon_sales1 / mon_sales2): decimal(37,20), (tue_sales1 / tue_sales2): decimal(37,20), (wed_sales1 / wed_sales2): decimal(37,20), (thu_sales1 / thu_sales2): decimal(37,20), (fri_sales1 / fri_sales2): decimal(37,20), (sat_sales1 / sat_sales2): decimal(37,20)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [s_store_name1#30645 ASC NULLS FIRST, s_store_id1#30647 ASC NULLS FIRST, d_week_seq1#30646 ASC NULLS FIRST], true\n      +- Project [s_store_name1#30645, s_store_id1#30647, d_week_seq1#30646, CheckOverflow((promote_precision(cast(sun_sales1#30648 as decimal(17,2))) / promote_precision(cast(sun_sales2#30658 as decimal(17,2)))), DecimalType(37,20)) AS (sun_sales1 / sun_sales2)#30735, CheckOverflow((promote_precision(cast(mon_sales1#30649 as decimal(17,2))) / promote_precision(cast(mon_sales2#30659 as decimal(17,2)))), DecimalType(37,20)) AS (mon_sales1 / mon_sales2)#30736, CheckOverflow((promote_precision(cast(tue_sales1#30650 as decimal(17,2))) / promote_precision(cast(tue_sales2#30660 as decimal(17,2)))), DecimalType(37,20)) AS (tue_sales1 / tue_sales2)#30737, CheckOverflow((promote_precision(cast(wed_sales1#30651 as decimal(17,2))) / promote_precision(cast(wed_sales2#30661 as decimal(17,2)))), DecimalType(37,20)) AS (wed_sales1 / wed_sales2)#30738, CheckOverflow((promote_precision(cast(thu_sales1#30652 as decimal(17,2))) / promote_precision(cast(thu_sales2#30662 as decimal(17,2)))), DecimalType(37,20)) AS (thu_sales1 / thu_sales2)#30739, CheckOverflow((promote_precision(cast(fri_sales1#30653 as decimal(17,2))) / promote_precision(cast(fri_sales2#30663 as decimal(17,2)))), DecimalType(37,20)) AS (fri_sales1 / fri_sales2)#30740, CheckOverflow((promote_precision(cast(sat_sales1#30654 as decimal(17,2))) / promote_precision(cast(sat_sales2#30664 as decimal(17,2)))), DecimalType(37,20)) AS (sat_sales1 / sat_sales2)#30741]\n         +- Filter ((s_store_id1#30647 = s_store_id2#30657) && (d_week_seq1#30646 = (d_week_seq2#30656 - 52)))\n            +- Join Inner\n               :- SubqueryAlias y\n               :  +- Project [s_store_name#1391 AS s_store_name1#30645, d_week_seq#1044 AS d_week_seq1#30646, s_store_id#1387 AS s_store_id1#30647, sun_sales#30665 AS sun_sales1#30648, mon_sales#30666 AS mon_sales1#30649, tue_sales#30667 AS tue_sales1#30650, wed_sales#30668 AS wed_sales1#30651, thu_sales#30669 AS thu_sales1#30652, fri_sales#30670 AS fri_sales1#30653, sat_sales#30671 AS sat_sales1#30654]\n               :     +- Filter (((d_week_seq#30683 = d_week_seq#1044) && (ss_store_sk#1910 = s_store_sk#1386)) && ((d_month_seq#30682 >= 1212) && (d_month_seq#30682 <= (1212 + 11))))\n               :        +- Join Inner\n               :           :- Join Inner\n               :           :  :- SubqueryAlias wss\n               :           :  :  +- Aggregate [d_week_seq#1044, ss_store_sk#1910], [d_week_seq#1044, ss_store_sk#1910, sum(CASE WHEN (d_day_name#1054 = Sunday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS sun_sales#30665, sum(CASE WHEN (d_day_name#1054 = Monday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS mon_sales#30666, sum(CASE WHEN (d_day_name#1054 = Tuesday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS tue_sales#30667, sum(CASE WHEN (d_day_name#1054 = Wednesday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS wed_sales#30668, sum(CASE WHEN (d_day_name#1054 = Thursday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS thu_sales#30669, sum(CASE WHEN (d_day_name#1054 = Friday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS fri_sales#30670, sum(CASE WHEN (d_day_name#1054 = Saturday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS sat_sales#30671]\n               :           :  :     +- Filter (d_date_sk#1040 = ss_sold_date_sk#1926)\n               :           :  :        +- Join Inner\n               :           :  :           :- SubqueryAlias store_sales\n               :           :  :           :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :           :  :           +- SubqueryAlias date_dim\n               :           :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :           :  +- SubqueryAlias store\n               :           :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               :           +- SubqueryAlias d\n               :              +- SubqueryAlias date_dim\n               :                 +- Relation[d_date_sk#30679,d_date_id#30680,d_date#30681,d_month_seq#30682,d_week_seq#30683,d_quarter_seq#30684,d_year#30685,d_dow#30686,d_moy#30687,d_dom#30688,d_qoy#30689,d_fy_year#30690,d_fy_quarter_seq#30691,d_fy_week_seq#30692,d_day_name#30693,d_quarter_name#30694,d_holiday#30695,d_weekend#30696,d_following_holiday#30697,d_first_dom#30698,d_last_dom#30699,d_same_day_ly#30700,d_same_day_lq#30701,d_current_day#30702,... 4 more fields] parquet\n               +- SubqueryAlias x\n                  +- Project [s_store_name#1391 AS s_store_name2#30655, d_week_seq#1044 AS d_week_seq2#30656, s_store_id#1387 AS s_store_id2#30657, sun_sales#30665 AS sun_sales2#30658, mon_sales#30666 AS mon_sales2#30659, tue_sales#30667 AS tue_sales2#30660, wed_sales#30668 AS wed_sales2#30661, thu_sales#30669 AS thu_sales2#30662, fri_sales#30670 AS fri_sales2#30663, sat_sales#30671 AS sat_sales2#30664]\n                     +- Filter (((d_week_seq#30711 = d_week_seq#1044) && (ss_store_sk#1910 = s_store_sk#1386)) && ((d_month_seq#30710 >= (1212 + 12)) && (d_month_seq#30710 <= (1212 + 23))))\n                        +- Join Inner\n                           :- Join Inner\n                           :  :- SubqueryAlias wss\n                           :  :  +- Aggregate [d_week_seq#1044, ss_store_sk#1910], [d_week_seq#1044, ss_store_sk#1910, sum(CASE WHEN (d_day_name#1054 = Sunday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS sun_sales#30665, sum(CASE WHEN (d_day_name#1054 = Monday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS mon_sales#30666, sum(CASE WHEN (d_day_name#1054 = Tuesday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS tue_sales#30667, sum(CASE WHEN (d_day_name#1054 = Wednesday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS wed_sales#30668, sum(CASE WHEN (d_day_name#1054 = Thursday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS thu_sales#30669, sum(CASE WHEN (d_day_name#1054 = Friday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS fri_sales#30670, sum(CASE WHEN (d_day_name#1054 = Saturday) THEN ss_sales_price#1916 ELSE cast(null as decimal(7,2)) END) AS sat_sales#30671]\n                           :  :     +- Filter (d_date_sk#1040 = ss_sold_date_sk#1926)\n                           :  :        +- Join Inner\n                           :  :           :- SubqueryAlias store_sales\n                           :  :           :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                           :  :           +- SubqueryAlias date_dim\n                           :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                           :  +- SubqueryAlias store\n                           :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                           +- SubqueryAlias d\n                              +- SubqueryAlias date_dim\n                                 +- Relation[d_date_sk#30707,d_date_id#30708,d_date#30709,d_month_seq#30710,d_week_seq#30711,d_quarter_seq#30712,d_year#30713,d_dow#30714,d_moy#30715,d_dom#30716,d_qoy#30717,d_fy_year#30718,d_fy_quarter_seq#30719,d_fy_week_seq#30720,d_day_name#30721,d_quarter_name#30722,d_holiday#30723,d_weekend#30724,d_following_holiday#30725,d_first_dom#30726,d_last_dom#30727,d_same_day_ly#30728,d_same_day_lq#30729,d_current_day#30730,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [s_store_name1#30645 ASC NULLS FIRST, s_store_id1#30647 ASC NULLS FIRST, d_week_seq1#30646 ASC NULLS FIRST], true\n      +- Project [s_store_name1#30645, s_store_id1#30647, d_week_seq1#30646, CheckOverflow((promote_precision(sun_sales1#30648) / promote_precision(sun_sales2#30658)), DecimalType(37,20)) AS (sun_sales1 / sun_sales2)#30735, CheckOverflow((promote_precision(mon_sales1#30649) / promote_precision(mon_sales2#30659)), DecimalType(37,20)) AS (mon_sales1 / mon_sales2)#30736, CheckOverflow((promote_precision(tue_sales1#30650) / promote_precision(tue_sales2#30660)), DecimalType(37,20)) AS (tue_sales1 / tue_sales2)#30737, CheckOverflow((promote_precision(wed_sales1#30651) / promote_precision(wed_sales2#30661)), DecimalType(37,20)) AS (wed_sales1 / wed_sales2)#30738, CheckOverflow((promote_precision(thu_sales1#30652) / promote_precision(thu_sales2#30662)), DecimalType(37,20)) AS (thu_sales1 / thu_sales2)#30739, CheckOverflow((promote_precision(fri_sales1#30653) / promote_precision(fri_sales2#30663)), DecimalType(37,20)) AS (fri_sales1 / fri_sales2)#30740, CheckOverflow((promote_precision(sat_sales1#30654) / promote_precision(sat_sales2#30664)), DecimalType(37,20)) AS (sat_sales1 / sat_sales2)#30741]\n         +- Join Inner, ((s_store_id1#30647 = s_store_id2#30657) && (d_week_seq1#30646 = (d_week_seq2#30656 - 52)))\n            :- Project [s_store_name#1391 AS s_store_name1#30645, d_week_seq#1044 AS d_week_seq1#30646, s_store_id#1387 AS s_store_id1#30647, sun_sales#30665 AS sun_sales1#30648, mon_sales#30666 AS mon_sales1#30649, tue_sales#30667 AS tue_sales1#30650, wed_sales#30668 AS wed_sales1#30651, thu_sales#30669 AS thu_sales1#30652, fri_sales#30670 AS fri_sales1#30653, sat_sales#30671 AS sat_sales1#30654]\n            :  +- Join Inner, (d_week_seq#30683 = d_week_seq#1044)\n            :     :- Project [d_week_seq#1044, sun_sales#30665, mon_sales#30666, tue_sales#30667, wed_sales#30668, thu_sales#30669, fri_sales#30670, sat_sales#30671, s_store_id#1387, s_store_name#1391]\n            :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n            :     :     :- Aggregate [d_week_seq#1044, ss_store_sk#1910], [d_week_seq#1044, ss_store_sk#1910, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS sun_sales#30665, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS mon_sales#30666, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS tue_sales#30667, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS wed_sales#30668, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS thu_sales#30669, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS fri_sales#30670, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS sat_sales#30671]\n            :     :     :  +- Project [ss_store_sk#1910, ss_sales_price#1916, d_week_seq#1044, d_day_name#1054]\n            :     :     :     +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n            :     :     :        :- Project [ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n            :     :     :        :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910))\n            :     :     :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :     :        +- Project [d_date_sk#1040, d_week_seq#1044, d_day_name#1054]\n            :     :     :           +- Filter (isnotnull(d_date_sk#1040) && isnotnull(d_week_seq#1044))\n            :     :     :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :     +- Project [s_store_sk#1386, s_store_id#1387, s_store_name#1391]\n            :     :        +- Filter (isnotnull(s_store_sk#1386) && isnotnull(s_store_id#1387))\n            :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n            :     +- Project [d_week_seq#30683]\n            :        +- Filter (((isnotnull(d_month_seq#30682) && (d_month_seq#30682 >= 1212)) && (d_month_seq#30682 <= 1223)) && isnotnull(d_week_seq#30683))\n            :           +- Relation[d_date_sk#30679,d_date_id#30680,d_date#30681,d_month_seq#30682,d_week_seq#30683,d_quarter_seq#30684,d_year#30685,d_dow#30686,d_moy#30687,d_dom#30688,d_qoy#30689,d_fy_year#30690,d_fy_quarter_seq#30691,d_fy_week_seq#30692,d_day_name#30693,d_quarter_name#30694,d_holiday#30695,d_weekend#30696,d_following_holiday#30697,d_first_dom#30698,d_last_dom#30699,d_same_day_ly#30700,d_same_day_lq#30701,d_current_day#30702,... 4 more fields] parquet\n            +- Project [d_week_seq#1044 AS d_week_seq2#30656, s_store_id#1387 AS s_store_id2#30657, sun_sales#30665 AS sun_sales2#30658, mon_sales#30666 AS mon_sales2#30659, tue_sales#30667 AS tue_sales2#30660, wed_sales#30668 AS wed_sales2#30661, thu_sales#30669 AS thu_sales2#30662, fri_sales#30670 AS fri_sales2#30663, sat_sales#30671 AS sat_sales2#30664]\n               +- Join Inner, (d_week_seq#30711 = d_week_seq#1044)\n                  :- Project [d_week_seq#1044, sun_sales#30665, mon_sales#30666, tue_sales#30667, wed_sales#30668, thu_sales#30669, fri_sales#30670, sat_sales#30671, s_store_id#1387]\n                  :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n                  :     :- Aggregate [d_week_seq#1044, ss_store_sk#1910], [d_week_seq#1044, ss_store_sk#1910, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS sun_sales#30665, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS mon_sales#30666, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS tue_sales#30667, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS wed_sales#30668, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS thu_sales#30669, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS fri_sales#30670, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN ss_sales_price#1916 ELSE null END)),17,2) AS sat_sales#30671]\n                  :     :  +- Project [ss_store_sk#1910, ss_sales_price#1916, d_week_seq#1044, d_day_name#1054]\n                  :     :     +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n                  :     :        :- Project [ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                  :     :        :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910))\n                  :     :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :     :        +- Project [d_date_sk#1040, d_week_seq#1044, d_day_name#1054]\n                  :     :           +- Filter (isnotnull(d_date_sk#1040) && isnotnull(d_week_seq#1044))\n                  :     :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :     +- Project [s_store_sk#1386, s_store_id#1387]\n                  :        +- Filter (isnotnull(s_store_sk#1386) && isnotnull(s_store_id#1387))\n                  :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                  +- Project [d_week_seq#30711]\n                     +- Filter (((isnotnull(d_month_seq#30710) && (d_month_seq#30710 >= 1224)) && (d_month_seq#30710 <= 1235)) && isnotnull(d_week_seq#30711))\n                        +- Relation[d_date_sk#30707,d_date_id#30708,d_date#30709,d_month_seq#30710,d_week_seq#30711,d_quarter_seq#30712,d_year#30713,d_dow#30714,d_moy#30715,d_dom#30716,d_qoy#30717,d_fy_year#30718,d_fy_quarter_seq#30719,d_fy_week_seq#30720,d_day_name#30721,d_quarter_name#30722,d_holiday#30723,d_weekend#30724,d_following_holiday#30725,d_first_dom#30726,d_last_dom#30727,d_same_day_ly#30728,d_same_day_lq#30729,d_current_day#30730,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[s_store_name1#30645 ASC NULLS FIRST,s_store_id1#30647 ASC NULLS FIRST,d_week_seq1#30646 ASC NULLS FIRST], output=[s_store_name1#30645,s_store_id1#30647,d_week_seq1#30646,(sun_sales1 / sun_sales2)#30735,(mon_sales1 / mon_sales2)#30736,(tue_sales1 / tue_sales2)#30737,(wed_sales1 / wed_sales2)#30738,(thu_sales1 / thu_sales2)#30739,(fri_sales1 / fri_sales2)#30740,(sat_sales1 / sat_sales2)#30741])\n+- *(13) Project [s_store_name1#30645, s_store_id1#30647, d_week_seq1#30646, CheckOverflow((promote_precision(sun_sales1#30648) / promote_precision(sun_sales2#30658)), DecimalType(37,20)) AS (sun_sales1 / sun_sales2)#30735, CheckOverflow((promote_precision(mon_sales1#30649) / promote_precision(mon_sales2#30659)), DecimalType(37,20)) AS (mon_sales1 / mon_sales2)#30736, CheckOverflow((promote_precision(tue_sales1#30650) / promote_precision(tue_sales2#30660)), DecimalType(37,20)) AS (tue_sales1 / tue_sales2)#30737, CheckOverflow((promote_precision(wed_sales1#30651) / promote_precision(wed_sales2#30661)), DecimalType(37,20)) AS (wed_sales1 / wed_sales2)#30738, CheckOverflow((promote_precision(thu_sales1#30652) / promote_precision(thu_sales2#30662)), DecimalType(37,20)) AS (thu_sales1 / thu_sales2)#30739, CheckOverflow((promote_precision(fri_sales1#30653) / promote_precision(fri_sales2#30663)), DecimalType(37,20)) AS (fri_sales1 / fri_sales2)#30740, CheckOverflow((promote_precision(sat_sales1#30654) / promote_precision(sat_sales2#30664)), DecimalType(37,20)) AS (sat_sales1 / sat_sales2)#30741]\n   +- *(13) SortMergeJoin [s_store_id1#30647, d_week_seq1#30646], [s_store_id2#30657, (d_week_seq2#30656 - 52)], Inner\n      :- *(6) Sort [s_store_id1#30647 ASC NULLS FIRST, d_week_seq1#30646 ASC NULLS FIRST], false, 0\n      :  +- Exchange hashpartitioning(s_store_id1#30647, d_week_seq1#30646, 200)\n      :     +- *(5) Project [s_store_name#1391 AS s_store_name1#30645, d_week_seq#1044 AS d_week_seq1#30646, s_store_id#1387 AS s_store_id1#30647, sun_sales#30665 AS sun_sales1#30648, mon_sales#30666 AS mon_sales1#30649, tue_sales#30667 AS tue_sales1#30650, wed_sales#30668 AS wed_sales1#30651, thu_sales#30669 AS thu_sales1#30652, fri_sales#30670 AS fri_sales1#30653, sat_sales#30671 AS sat_sales1#30654]\n      :        +- *(5) BroadcastHashJoin [d_week_seq#1044], [d_week_seq#30683], Inner, BuildRight\n      :           :- *(5) Project [d_week_seq#1044, sun_sales#30665, mon_sales#30666, tue_sales#30667, wed_sales#30668, thu_sales#30669, fri_sales#30670, sat_sales#30671, s_store_id#1387, s_store_name#1391]\n      :           :  +- *(5) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n      :           :     :- *(5) HashAggregate(keys=[d_week_seq#1044, ss_store_sk#1910], functions=[sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN ss_sales_price#1916 ELSE null END))], output=[d_week_seq#1044, ss_store_sk#1910, sun_sales#30665, mon_sales#30666, tue_sales#30667, wed_sales#30668, thu_sales#30669, fri_sales#30670, sat_sales#30671])\n      :           :     :  +- Exchange hashpartitioning(d_week_seq#1044, ss_store_sk#1910, 200)\n      :           :     :     +- *(2) HashAggregate(keys=[d_week_seq#1044, ss_store_sk#1910], functions=[partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN ss_sales_price#1916 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN ss_sales_price#1916 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN ss_sales_price#1916 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN ss_sales_price#1916 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN ss_sales_price#1916 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN ss_sales_price#1916 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN ss_sales_price#1916 ELSE null END))], output=[d_week_seq#1044, ss_store_sk#1910, sum#30759L, sum#30760L, sum#30761L, sum#30762L, sum#30763L, sum#30764L, sum#30765L])\n      :           :     :        +- *(2) Project [ss_store_sk#1910, ss_sales_price#1916, d_week_seq#1044, d_day_name#1054]\n      :           :     :           +- *(2) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :           :     :              :- *(2) Project [ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n      :           :     :              :  +- *(2) Filter isnotnull(ss_store_sk#1910)\n      :           :     :              :     +- *(2) FileScan parquet db_tpcds.store_sales[ss_store_sk#1910,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:int,ss_sales_price:decimal(7,2)>\n      :           :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :           :     :                 +- *(1) Project [d_date_sk#1040, d_week_seq#1044, d_day_name#1054]\n      :           :     :                    +- *(1) Filter (isnotnull(d_date_sk#1040) && isnotnull(d_week_seq#1044))\n      :           :     :                       +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_week_seq#1044,d_day_name#1054] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), IsNotNull(d_week_seq)], ReadSchema: struct<d_date_sk:int,d_week_seq:int,d_day_name:string>\n      :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :           :        +- *(3) Project [s_store_sk#1386, s_store_id#1387, s_store_name#1391]\n      :           :           +- *(3) Filter (isnotnull(s_store_sk#1386) && isnotnull(s_store_id#1387))\n      :           :              +- *(3) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_id#1387,s_store_name#1391] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_id)], ReadSchema: struct<s_store_sk:int,s_store_id:string,s_store_name:string>\n      :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :              +- *(4) Project [d_week_seq#30683]\n      :                 +- *(4) Filter (((isnotnull(d_month_seq#30682) && (d_month_seq#30682 >= 1212)) && (d_month_seq#30682 <= 1223)) && isnotnull(d_week_seq#30683))\n      :                    +- *(4) FileScan parquet db_tpcds.date_dim[d_month_seq#30682,d_week_seq#30683] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1212), LessThanOrEqual(d_month_seq,1223),..., ReadSchema: struct<d_month_seq:int,d_week_seq:int>\n      +- *(12) Sort [s_store_id2#30657 ASC NULLS FIRST, (d_week_seq2#30656 - 52) ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(s_store_id2#30657, (d_week_seq2#30656 - 52), 200)\n            +- *(11) Project [d_week_seq#1044 AS d_week_seq2#30656, s_store_id#1387 AS s_store_id2#30657, sun_sales#30665 AS sun_sales2#30658, mon_sales#30666 AS mon_sales2#30659, tue_sales#30667 AS tue_sales2#30660, wed_sales#30668 AS wed_sales2#30661, thu_sales#30669 AS thu_sales2#30662, fri_sales#30670 AS fri_sales2#30663, sat_sales#30671 AS sat_sales2#30664]\n               +- *(11) BroadcastHashJoin [d_week_seq#1044], [d_week_seq#30711], Inner, BuildRight\n                  :- *(11) Project [d_week_seq#1044, sun_sales#30665, mon_sales#30666, tue_sales#30667, wed_sales#30668, thu_sales#30669, fri_sales#30670, sat_sales#30671, s_store_id#1387]\n                  :  +- *(11) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                  :     :- *(11) HashAggregate(keys=[d_week_seq#1044, ss_store_sk#1910], functions=[sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Sunday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Monday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Tuesday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Wednesday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Thursday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Friday) THEN ss_sales_price#1916 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#1054 = Saturday) THEN ss_sales_price#1916 ELSE null END))], output=[d_week_seq#1044, ss_store_sk#1910, sun_sales#30665, mon_sales#30666, tue_sales#30667, wed_sales#30668, thu_sales#30669, fri_sales#30670, sat_sales#30671])\n                  :     :  +- ReusedExchange [d_week_seq#1044, ss_store_sk#1910, sum#30773L, sum#30774L, sum#30775L, sum#30776L, sum#30777L, sum#30778L, sum#30779L], Exchange hashpartitioning(d_week_seq#1044, ss_store_sk#1910, 200)\n                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :        +- *(9) Project [s_store_sk#1386, s_store_id#1387]\n                  :           +- *(9) Filter (isnotnull(s_store_sk#1386) && isnotnull(s_store_id#1387))\n                  :              +- *(9) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_id#1387] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_id)], ReadSchema: struct<s_store_sk:int,s_store_id:string>\n                  +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     +- *(10) Project [d_week_seq#30711]\n                        +- *(10) Filter (((isnotnull(d_month_seq#30710) && (d_month_seq#30710 >= 1224)) && (d_month_seq#30710 <= 1235)) && isnotnull(d_week_seq#30711))\n                           +- *(10) FileScan parquet db_tpcds.date_dim[d_month_seq#30710,d_week_seq#30711] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1224), LessThanOrEqual(d_month_seq,1235),..., ReadSchema: struct<d_month_seq:int,d_week_seq:int>"},{"name":"q60-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["ss","cs","ws"],"parsingTime":0.002033,"analysisTime":0.001076,"optimizationTime":777.387176,"planningTime":61.170962,"executionTime":7380.09472,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ss, cs, ws]\n:  :- 'SubqueryAlias ss\n:  :  +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('ss_ext_sales_price) AS total_sales#30932]\n:  :     +- 'Filter ((('i_item_id IN (list#30933 []) && ('ss_item_sk = 'i_item_sk)) && (('ss_sold_date_sk = 'd_date_sk) && ('d_year = 1998))) && ((('d_moy = 9) && ('ss_addr_sk = 'ca_address_sk)) && ('ca_gmt_offset = -5)))\n:  :        :  +- 'Project ['i_item_id]\n:  :        :     +- 'Filter 'i_category IN (Music)\n:  :        :        +- 'UnresolvedRelation `item`\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'Join Inner\n:  :           :  :  :- 'UnresolvedRelation `store_sales`\n:  :           :  :  +- 'UnresolvedRelation `date_dim`\n:  :           :  +- 'UnresolvedRelation `customer_address`\n:  :           +- 'UnresolvedRelation `item`\n:  :- 'SubqueryAlias cs\n:  :  +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('cs_ext_sales_price) AS total_sales#30934]\n:  :     +- 'Filter ((('i_item_id IN (list#30935 []) && ('cs_item_sk = 'i_item_sk)) && (('cs_sold_date_sk = 'd_date_sk) && ('d_year = 1998))) && ((('d_moy = 9) && ('cs_bill_addr_sk = 'ca_address_sk)) && ('ca_gmt_offset = -5)))\n:  :        :  +- 'Project ['i_item_id]\n:  :        :     +- 'Filter 'i_category IN (Music)\n:  :        :        +- 'UnresolvedRelation `item`\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'Join Inner\n:  :           :  :  :- 'UnresolvedRelation `catalog_sales`\n:  :           :  :  +- 'UnresolvedRelation `date_dim`\n:  :           :  +- 'UnresolvedRelation `customer_address`\n:  :           +- 'UnresolvedRelation `item`\n:  +- 'SubqueryAlias ws\n:     +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('ws_ext_sales_price) AS total_sales#30936]\n:        +- 'Filter ((('i_item_id IN (list#30937 []) && ('ws_item_sk = 'i_item_sk)) && (('ws_sold_date_sk = 'd_date_sk) && ('d_year = 1998))) && ((('d_moy = 9) && ('ws_bill_addr_sk = 'ca_address_sk)) && ('ca_gmt_offset = -5)))\n:           :  +- 'Project ['i_item_id]\n:           :     +- 'Filter 'i_category IN (Music)\n:           :        +- 'UnresolvedRelation `item`\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'Join Inner\n:              :  :  :- 'UnresolvedRelation `web_sales`\n:              :  :  +- 'UnresolvedRelation `date_dim`\n:              :  +- 'UnresolvedRelation `customer_address`\n:              +- 'UnresolvedRelation `item`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['i_item_id ASC NULLS FIRST, 'total_sales ASC NULLS FIRST], true\n         +- 'Aggregate ['i_item_id], ['i_item_id, 'sum('total_sales) AS total_sales#30931]\n            +- 'SubqueryAlias tmp1\n               +- 'Union\n                  :- 'Union\n                  :  :- 'Project [*]\n                  :  :  +- 'UnresolvedRelation `ss`\n                  :  +- 'Project [*]\n                  :     +- 'UnresolvedRelation `cs`\n                  +- 'Project [*]\n                     +- 'UnresolvedRelation `ws`\n\n== Analyzed Logical Plan ==\ni_item_id: string, total_sales: decimal(27,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#1173 ASC NULLS FIRST, total_sales#30931 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173], [i_item_id#1173, sum(total_sales#30932) AS total_sales#30931]\n         +- SubqueryAlias tmp1\n            +- Union\n               :- Union\n               :  :- Project [i_item_id#1173, total_sales#30932]\n               :  :  +- SubqueryAlias ss\n               :  :     +- Aggregate [i_item_id#1173], [i_item_id#1173, sum(ss_ext_sales_price#1918) AS total_sales#30932]\n               :  :        +- Filter (((i_item_id#1173 IN (list#30933 []) && (ss_item_sk#1905 = i_item_sk#1172)) && ((ss_sold_date_sk#1926 = d_date_sk#1040) && (d_year#1046 = 1998))) && (((d_moy#1048 = 9) && (ss_addr_sk#1909 = ca_address_sk#922)) && (cast(ca_gmt_offset#933 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2)))))\n               :  :           :  +- Project [i_item_id#1173]\n               :  :           :     +- Filter i_category#1184 IN (Music)\n               :  :           :        +- SubqueryAlias item\n               :  :           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  :           +- Join Inner\n               :  :              :- Join Inner\n               :  :              :  :- Join Inner\n               :  :              :  :  :- SubqueryAlias store_sales\n               :  :              :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :              :  :  +- SubqueryAlias date_dim\n               :  :              :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :              :  +- SubqueryAlias customer_address\n               :  :              :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               :  :              +- SubqueryAlias item\n               :  :                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  +- Project [i_item_id#1173, total_sales#30934]\n               :     +- SubqueryAlias cs\n               :        +- Aggregate [i_item_id#1173], [i_item_id#1173, sum(cs_ext_sales_price#1811) AS total_sales#30934]\n               :           +- Filter (((i_item_id#1173 IN (list#30935 []) && (cs_item_sk#1803 = i_item_sk#1172)) && ((cs_sold_date_sk#1822 = d_date_sk#1040) && (d_year#1046 = 1998))) && (((d_moy#1048 = 9) && (cs_bill_addr_sk#1794 = ca_address_sk#922)) && (cast(ca_gmt_offset#933 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2)))))\n               :              :  +- Project [i_item_id#1173]\n               :              :     +- Filter i_category#1184 IN (Music)\n               :              :        +- SubqueryAlias item\n               :              :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              +- Join Inner\n               :                 :- Join Inner\n               :                 :  :- Join Inner\n               :                 :  :  :- SubqueryAlias catalog_sales\n               :                 :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :                 :  :  +- SubqueryAlias date_dim\n               :                 :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :                 :  +- SubqueryAlias customer_address\n               :                 :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               :                 +- SubqueryAlias item\n               :                    +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               +- Project [i_item_id#1173, total_sales#30936]\n                  +- SubqueryAlias ws\n                     +- Aggregate [i_item_id#1173], [i_item_id#1173, sum(ws_ext_sales_price#1777) AS total_sales#30936]\n                        +- Filter (((i_item_id#1173 IN (list#30937 []) && (ws_item_sk#1757 = i_item_sk#1172)) && ((ws_sold_date_sk#1788 = d_date_sk#1040) && (d_year#1046 = 1998))) && (((d_moy#1048 = 9) && (ws_bill_addr_sk#1761 = ca_address_sk#922)) && (cast(ca_gmt_offset#933 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2)))))\n                           :  +- Project [i_item_id#1173]\n                           :     +- Filter i_category#1184 IN (Music)\n                           :        +- SubqueryAlias item\n                           :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                           +- Join Inner\n                              :- Join Inner\n                              :  :- Join Inner\n                              :  :  :- SubqueryAlias web_sales\n                              :  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                              :  :  +- SubqueryAlias date_dim\n                              :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :  +- SubqueryAlias customer_address\n                              :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                              +- SubqueryAlias item\n                                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#1173 ASC NULLS FIRST, total_sales#30931 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173], [i_item_id#1173, sum(total_sales#30932) AS total_sales#30931]\n         +- Union\n            :- Aggregate [i_item_id#1173], [i_item_id#1173, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS total_sales#30932]\n            :  +- Project [ss_ext_sales_price#1918, i_item_id#1173]\n            :     +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n            :        :- Project [ss_item_sk#1905, ss_ext_sales_price#1918]\n            :        :  +- Join Inner, (ss_addr_sk#1909 = ca_address_sk#922)\n            :        :     :- Project [ss_item_sk#1905, ss_addr_sk#1909, ss_ext_sales_price#1918]\n            :        :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :        :     :     :- Project [ss_item_sk#1905, ss_addr_sk#1909, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :        :     :     :  +- Filter ((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_addr_sk#1909)) && isnotnull(ss_item_sk#1905))\n            :        :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :        :     :     +- Project [d_date_sk#1040]\n            :        :     :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 9)) && isnotnull(d_date_sk#1040))\n            :        :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :        :     +- Project [ca_address_sk#922]\n            :        :        +- Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n            :        :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :        +- Join LeftSemi, (i_item_id#1173 = i_item_id#1173#30946)\n            :           :- Project [i_item_sk#1172, i_item_id#1173]\n            :           :  +- Filter isnotnull(i_item_sk#1172)\n            :           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :           +- Project [i_item_id#1173 AS i_item_id#1173#30946]\n            :              +- Filter i_category#1184 IN (Music)\n            :                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :- Aggregate [i_item_id#1173], [i_item_id#1173, MakeDecimal(sum(UnscaledValue(cs_ext_sales_price#1811)),17,2) AS total_sales#30934]\n            :  +- Project [cs_ext_sales_price#1811, i_item_id#1173]\n            :     +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n            :        :- Project [cs_item_sk#1803, cs_ext_sales_price#1811]\n            :        :  +- Join Inner, (cs_bill_addr_sk#1794 = ca_address_sk#922)\n            :        :     :- Project [cs_bill_addr_sk#1794, cs_item_sk#1803, cs_ext_sales_price#1811]\n            :        :     :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n            :        :     :     :- Project [cs_bill_addr_sk#1794, cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n            :        :     :     :  +- Filter ((isnotnull(cs_sold_date_sk#1822) && isnotnull(cs_bill_addr_sk#1794)) && isnotnull(cs_item_sk#1803))\n            :        :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :        :     :     +- Project [d_date_sk#1040]\n            :        :     :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 9)) && isnotnull(d_date_sk#1040))\n            :        :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :        :     +- Project [ca_address_sk#922]\n            :        :        +- Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n            :        :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :        +- Join LeftSemi, (i_item_id#1173 = i_item_id#1173#30947)\n            :           :- Project [i_item_sk#1172, i_item_id#1173]\n            :           :  +- Filter isnotnull(i_item_sk#1172)\n            :           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :           +- Project [i_item_id#1173 AS i_item_id#1173#30947]\n            :              +- Filter i_category#1184 IN (Music)\n            :                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            +- Aggregate [i_item_id#1173], [i_item_id#1173, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#1777)),17,2) AS total_sales#30936]\n               +- Project [ws_ext_sales_price#1777, i_item_id#1173]\n                  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n                     :- Project [ws_item_sk#1757, ws_ext_sales_price#1777]\n                     :  +- Join Inner, (ws_bill_addr_sk#1761 = ca_address_sk#922)\n                     :     :- Project [ws_item_sk#1757, ws_bill_addr_sk#1761, ws_ext_sales_price#1777]\n                     :     :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                     :     :     :- Project [ws_item_sk#1757, ws_bill_addr_sk#1761, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                     :     :     :  +- Filter ((isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_bill_addr_sk#1761)) && isnotnull(ws_item_sk#1757))\n                     :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :     :     +- Project [d_date_sk#1040]\n                     :     :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 9)) && isnotnull(d_date_sk#1040))\n                     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :     +- Project [ca_address_sk#922]\n                     :        +- Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n                     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                     +- Join LeftSemi, (i_item_id#1173 = i_item_id#1173#30948)\n                        :- Project [i_item_sk#1172, i_item_id#1173]\n                        :  +- Filter isnotnull(i_item_sk#1172)\n                        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        +- Project [i_item_id#1173 AS i_item_id#1173#30948]\n                           +- Filter i_category#1184 IN (Music)\n                              +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_item_id#1173 ASC NULLS FIRST,total_sales#30931 ASC NULLS FIRST], output=[i_item_id#1173,total_sales#30931])\n+- *(20) HashAggregate(keys=[i_item_id#1173], functions=[sum(total_sales#30932)], output=[i_item_id#1173, total_sales#30931])\n   +- Exchange hashpartitioning(i_item_id#1173, 200)\n      +- *(19) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(total_sales#30932)], output=[i_item_id#1173, sum#30950])\n         +- Union\n            :- *(6) HashAggregate(keys=[i_item_id#1173], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[i_item_id#1173, total_sales#30932])\n            :  +- Exchange hashpartitioning(i_item_id#1173, 200)\n            :     +- *(5) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[i_item_id#1173, sum#30952L])\n            :        +- *(5) Project [ss_ext_sales_price#1918, i_item_id#1173]\n            :           +- *(5) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n            :              :- *(5) Project [ss_item_sk#1905, ss_ext_sales_price#1918]\n            :              :  +- *(5) BroadcastHashJoin [ss_addr_sk#1909], [ca_address_sk#922], Inner, BuildRight\n            :              :     :- *(5) Project [ss_item_sk#1905, ss_addr_sk#1909, ss_ext_sales_price#1918]\n            :              :     :  +- *(5) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n            :              :     :     :- *(5) Project [ss_item_sk#1905, ss_addr_sk#1909, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :              :     :     :  +- *(5) Filter (isnotnull(ss_addr_sk#1909) && isnotnull(ss_item_sk#1905))\n            :              :     :     :     +- *(5) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_addr_sk#1909,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_addr_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_addr_sk:int,ss_ext_sales_price:decimal(7,2)>\n            :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              :     :        +- *(1) Project [d_date_sk#1040]\n            :              :     :           +- *(1) Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 9)) && isnotnull(d_date_sk#1040))\n            :              :     :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1998), EqualTo(d_moy,9), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n            :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              :        +- *(2) Project [ca_address_sk#922]\n            :              :           +- *(2) Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n            :              :              +- *(2) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_gmt_offset#933] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-5.00), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_gmt_offset:decimal(5,2)>\n            :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :                 +- *(4) BroadcastHashJoin [i_item_id#1173], [i_item_id#1173#30946], LeftSemi, BuildRight\n            :                    :- *(4) Project [i_item_sk#1172, i_item_id#1173]\n            :                    :  +- *(4) Filter isnotnull(i_item_sk#1172)\n            :                    :     +- *(4) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string>\n            :                    +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, string, true]))\n            :                       +- *(3) Project [i_item_id#1173 AS i_item_id#1173#30946]\n            :                          +- *(3) Filter i_category#1184 IN (Music)\n            :                             +- *(3) FileScan parquet db_tpcds.item[i_item_id#1173,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [In(i_category, [Music])], ReadSchema: struct<i_item_id:string,i_category:string>\n            :- *(12) HashAggregate(keys=[i_item_id#1173], functions=[sum(UnscaledValue(cs_ext_sales_price#1811))], output=[i_item_id#1173, total_sales#30934])\n            :  +- Exchange hashpartitioning(i_item_id#1173, 200)\n            :     +- *(11) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(UnscaledValue(cs_ext_sales_price#1811))], output=[i_item_id#1173, sum#30954L])\n            :        +- *(11) Project [cs_ext_sales_price#1811, i_item_id#1173]\n            :           +- *(11) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n            :              :- *(11) Project [cs_item_sk#1803, cs_ext_sales_price#1811]\n            :              :  +- *(11) BroadcastHashJoin [cs_bill_addr_sk#1794], [ca_address_sk#922], Inner, BuildRight\n            :              :     :- *(11) Project [cs_bill_addr_sk#1794, cs_item_sk#1803, cs_ext_sales_price#1811]\n            :              :     :  +- *(11) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n            :              :     :     :- *(11) Project [cs_bill_addr_sk#1794, cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n            :              :     :     :  +- *(11) Filter (isnotnull(cs_bill_addr_sk#1794) && isnotnull(cs_item_sk#1803))\n            :              :     :     :     +- *(11) FileScan parquet db_tpcds.catalog_sales[cs_bill_addr_sk#1794,cs_item_sk#1803,cs_ext_sales_price#1811,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_bill_addr_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_bill_addr_sk:int,cs_item_sk:int,cs_ext_sales_price:decimal(7,2)>\n            :              :     :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              :     +- ReusedExchange [ca_address_sk#922], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              +- ReusedExchange [i_item_sk#1172, i_item_id#1173], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            +- *(18) HashAggregate(keys=[i_item_id#1173], functions=[sum(UnscaledValue(ws_ext_sales_price#1777))], output=[i_item_id#1173, total_sales#30936])\n               +- Exchange hashpartitioning(i_item_id#1173, 200)\n                  +- *(17) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(UnscaledValue(ws_ext_sales_price#1777))], output=[i_item_id#1173, sum#30956L])\n                     +- *(17) Project [ws_ext_sales_price#1777, i_item_id#1173]\n                        +- *(17) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n                           :- *(17) Project [ws_item_sk#1757, ws_ext_sales_price#1777]\n                           :  +- *(17) BroadcastHashJoin [ws_bill_addr_sk#1761], [ca_address_sk#922], Inner, BuildRight\n                           :     :- *(17) Project [ws_item_sk#1757, ws_bill_addr_sk#1761, ws_ext_sales_price#1777]\n                           :     :  +- *(17) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                           :     :     :- *(17) Project [ws_item_sk#1757, ws_bill_addr_sk#1761, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                           :     :     :  +- *(17) Filter (isnotnull(ws_bill_addr_sk#1761) && isnotnull(ws_item_sk#1757))\n                           :     :     :     +- *(17) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_bill_addr_sk#1761,ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_addr_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_bill_addr_sk:int,ws_ext_sales_price:decimal(7,2)>\n                           :     :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :     +- ReusedExchange [ca_address_sk#922], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           +- ReusedExchange [i_item_sk#1172, i_item_id#1173], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q61-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastNestedLoopJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","store","promotion","date_dim","customer","customer_address","item","store_sales","store","date_dim","customer","customer_address","item"],"parsingTime":0.00243,"analysisTime":0.00154,"optimizationTime":595.123975,"planningTime":42.004718,"executionTime":2902.196462,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['promotions ASC NULLS FIRST, 'total ASC NULLS FIRST], true\n      +- 'Project ['promotions, 'total, unresolvedalias(((cast('promotions as decimal(15,4)) / cast('total as decimal(15,4))) * 100), None)]\n         +- 'Join Cross\n            :- 'SubqueryAlias promotional_sales\n            :  +- 'Project ['sum('ss_ext_sales_price) AS promotions#30990]\n            :     +- 'Filter ((((('ss_sold_date_sk = 'd_date_sk) && ('ss_store_sk = 's_store_sk)) && ('ss_promo_sk = 'p_promo_sk)) && ((('ss_customer_sk = 'c_customer_sk) && ('ca_address_sk = 'c_current_addr_sk)) && ('ss_item_sk = 'i_item_sk))) && (((('ca_gmt_offset = -5) && ('i_category = Jewelry)) && ((('p_channel_dmail = Y) || ('p_channel_email = Y)) || ('p_channel_tv = Y))) && ((('s_gmt_offset = -5) && ('d_year = 1998)) && ('d_moy = 11))))\n            :        +- 'Join Inner\n            :           :- 'Join Inner\n            :           :  :- 'Join Inner\n            :           :  :  :- 'Join Inner\n            :           :  :  :  :- 'Join Inner\n            :           :  :  :  :  :- 'Join Inner\n            :           :  :  :  :  :  :- 'UnresolvedRelation `store_sales`\n            :           :  :  :  :  :  +- 'UnresolvedRelation `store`\n            :           :  :  :  :  +- 'UnresolvedRelation `promotion`\n            :           :  :  :  +- 'UnresolvedRelation `date_dim`\n            :           :  :  +- 'UnresolvedRelation `customer`\n            :           :  +- 'UnresolvedRelation `customer_address`\n            :           +- 'UnresolvedRelation `item`\n            +- 'SubqueryAlias all_sales\n               +- 'Project ['sum('ss_ext_sales_price) AS total#30991]\n                  +- 'Filter ((((('ss_sold_date_sk = 'd_date_sk) && ('ss_store_sk = 's_store_sk)) && ('ss_customer_sk = 'c_customer_sk)) && (('ca_address_sk = 'c_current_addr_sk) && ('ss_item_sk = 'i_item_sk))) && (((('ca_gmt_offset = -5) && ('i_category = Jewelry)) && ('s_gmt_offset = -5)) && (('d_year = 1998) && ('d_moy = 11))))\n                     +- 'Join Inner\n                        :- 'Join Inner\n                        :  :- 'Join Inner\n                        :  :  :- 'Join Inner\n                        :  :  :  :- 'Join Inner\n                        :  :  :  :  :- 'UnresolvedRelation `store_sales`\n                        :  :  :  :  +- 'UnresolvedRelation `store`\n                        :  :  :  +- 'UnresolvedRelation `date_dim`\n                        :  :  +- 'UnresolvedRelation `customer`\n                        :  +- 'UnresolvedRelation `customer_address`\n                        +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\npromotions: decimal(17,2), total: decimal(17,2), (CAST((CAST(CAST(promotions AS DECIMAL(15,4)) AS DECIMAL(15,4)) / CAST(CAST(total AS DECIMAL(15,4)) AS DECIMAL(15,4))) AS DECIMAL(35,20)) * CAST(CAST(100 AS DECIMAL(3,0)) AS DECIMAL(35,20))): decimal(38,19)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [promotions#30990 ASC NULLS FIRST, total#30991 ASC NULLS FIRST], true\n      +- Project [promotions#30990, total#30991, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cast(promotions#30990 as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(total#30991 as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20)) as decimal(35,20))) * promote_precision(cast(cast(100 as decimal(3,0)) as decimal(35,20)))), DecimalType(38,19)) AS (CAST((CAST(CAST(promotions AS DECIMAL(15,4)) AS DECIMAL(15,4)) / CAST(CAST(total AS DECIMAL(15,4)) AS DECIMAL(15,4))) AS DECIMAL(35,20)) * CAST(CAST(100 AS DECIMAL(3,0)) AS DECIMAL(35,20)))#30994]\n         +- Join Cross\n            :- SubqueryAlias promotional_sales\n            :  +- Aggregate [sum(ss_ext_sales_price#1918) AS promotions#30990]\n            :     +- Filter (((((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_store_sk#1910 = s_store_sk#1386)) && (ss_promo_sk#1911 = p_promo_sk#1254)) && (((ss_customer_sk#1906 = c_customer_sk#860) && (ca_address_sk#922 = c_current_addr_sk#864)) && (ss_item_sk#1905 = i_item_sk#1172))) && ((((cast(ca_gmt_offset#933 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2))) && (i_category#1184 = Jewelry)) && (((p_channel_dmail#1262 = Y) || (p_channel_email#1263 = Y)) || (p_channel_tv#1265 = Y))) && (((cast(s_gmt_offset#1413 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2))) && (d_year#1046 = 1998)) && (d_moy#1048 = 11))))\n            :        +- Join Inner\n            :           :- Join Inner\n            :           :  :- Join Inner\n            :           :  :  :- Join Inner\n            :           :  :  :  :- Join Inner\n            :           :  :  :  :  :- Join Inner\n            :           :  :  :  :  :  :- SubqueryAlias store_sales\n            :           :  :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :           :  :  :  :  :  +- SubqueryAlias store\n            :           :  :  :  :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n            :           :  :  :  :  +- SubqueryAlias promotion\n            :           :  :  :  :     +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n            :           :  :  :  +- SubqueryAlias date_dim\n            :           :  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :           :  :  +- SubqueryAlias customer\n            :           :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :           :  +- SubqueryAlias customer_address\n            :           :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :           +- SubqueryAlias item\n            :              +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            +- SubqueryAlias all_sales\n               +- Aggregate [sum(ss_ext_sales_price#1918) AS total#30991]\n                  +- Filter (((((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_store_sk#1910 = s_store_sk#1386)) && (ss_customer_sk#1906 = c_customer_sk#860)) && ((ca_address_sk#922 = c_current_addr_sk#864) && (ss_item_sk#1905 = i_item_sk#1172))) && ((((cast(ca_gmt_offset#933 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2))) && (i_category#1184 = Jewelry)) && (cast(s_gmt_offset#1413 as decimal(5,2)) = cast(cast(-5 as decimal(1,0)) as decimal(5,2)))) && ((d_year#1046 = 1998) && (d_moy#1048 = 11))))\n                     +- Join Inner\n                        :- Join Inner\n                        :  :- Join Inner\n                        :  :  :- Join Inner\n                        :  :  :  :- Join Inner\n                        :  :  :  :  :- SubqueryAlias store_sales\n                        :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :  :  :  :  +- SubqueryAlias store\n                        :  :  :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                        :  :  :  +- SubqueryAlias date_dim\n                        :  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :  :  +- SubqueryAlias customer\n                        :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                        :  +- SubqueryAlias customer_address\n                        :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                        +- SubqueryAlias item\n                           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [promotions#30990 ASC NULLS FIRST, total#30991 ASC NULLS FIRST], true\n      +- Project [promotions#30990, total#30991, CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(promotions#30990 as decimal(15,4))) / promote_precision(cast(total#30991 as decimal(15,4)))), DecimalType(35,20))) * 100.00000000000000000000), DecimalType(38,19)) AS (CAST((CAST(CAST(promotions AS DECIMAL(15,4)) AS DECIMAL(15,4)) / CAST(CAST(total AS DECIMAL(15,4)) AS DECIMAL(15,4))) AS DECIMAL(35,20)) * CAST(CAST(100 AS DECIMAL(3,0)) AS DECIMAL(35,20)))#30994]\n         +- Join Cross\n            :- Aggregate [MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS promotions#30990]\n            :  +- Project [ss_ext_sales_price#1918]\n            :     +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n            :        :- Project [ss_item_sk#1905, ss_ext_sales_price#1918]\n            :        :  +- Join Inner, (ca_address_sk#922 = c_current_addr_sk#864)\n            :        :     :- Project [ss_item_sk#1905, ss_ext_sales_price#1918, c_current_addr_sk#864]\n            :        :     :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n            :        :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_ext_sales_price#1918]\n            :        :     :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :        :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :        :     :     :     :  +- Join Inner, (ss_promo_sk#1911 = p_promo_sk#1254)\n            :        :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_promo_sk#1911, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :        :     :     :     :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n            :        :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_promo_sk#1911, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :        :     :     :     :     :     :  +- Filter ((((isnotnull(ss_store_sk#1910) && isnotnull(ss_promo_sk#1911)) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_item_sk#1905))\n            :        :     :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :        :     :     :     :     :     +- Project [s_store_sk#1386]\n            :        :     :     :     :     :        +- Filter ((isnotnull(s_gmt_offset#1413) && (s_gmt_offset#1413 = -5.00)) && isnotnull(s_store_sk#1386))\n            :        :     :     :     :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n            :        :     :     :     :     +- Project [p_promo_sk#1254]\n            :        :     :     :     :        +- Filter ((((p_channel_dmail#1262 = Y) || (p_channel_email#1263 = Y)) || (p_channel_tv#1265 = Y)) && isnotnull(p_promo_sk#1254))\n            :        :     :     :     :           +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n            :        :     :     :     +- Project [d_date_sk#1040]\n            :        :     :     :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 11)) && isnotnull(d_date_sk#1040))\n            :        :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :        :     :     +- Project [c_customer_sk#860, c_current_addr_sk#864]\n            :        :     :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n            :        :     :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :        :     +- Project [ca_address_sk#922]\n            :        :        +- Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n            :        :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :        +- Project [i_item_sk#1172]\n            :           +- Filter ((isnotnull(i_category#1184) && (i_category#1184 = Jewelry)) && isnotnull(i_item_sk#1172))\n            :              +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            +- Aggregate [MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS total#30991]\n               +- Project [ss_ext_sales_price#1918]\n                  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                     :- Project [ss_item_sk#1905, ss_ext_sales_price#1918]\n                     :  +- Join Inner, (ca_address_sk#922 = c_current_addr_sk#864)\n                     :     :- Project [ss_item_sk#1905, ss_ext_sales_price#1918, c_current_addr_sk#864]\n                     :     :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n                     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_ext_sales_price#1918]\n                     :     :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                     :     :     :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n                     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                     :     :     :     :     :  +- Filter (((isnotnull(ss_store_sk#1910) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_item_sk#1905))\n                     :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :     :     :     :     +- Project [s_store_sk#1386]\n                     :     :     :     :        +- Filter ((isnotnull(s_gmt_offset#1413) && (s_gmt_offset#1413 = -5.00)) && isnotnull(s_store_sk#1386))\n                     :     :     :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                     :     :     :     +- Project [d_date_sk#1040]\n                     :     :     :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 11)) && isnotnull(d_date_sk#1040))\n                     :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :     :     +- Project [c_customer_sk#860, c_current_addr_sk#864]\n                     :     :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n                     :     :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                     :     +- Project [ca_address_sk#922]\n                     :        +- Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n                     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                     +- Project [i_item_sk#1172]\n                        +- Filter ((isnotnull(i_category#1184) && (i_category#1184 = Jewelry)) && isnotnull(i_item_sk#1172))\n                           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[promotions#30990 ASC NULLS FIRST,total#30991 ASC NULLS FIRST], output=[promotions#30990,total#30991,(CAST((CAST(CAST(promotions AS DECIMAL(15,4)) AS DECIMAL(15,4)) / CAST(CAST(total AS DECIMAL(15,4)) AS DECIMAL(15,4))) AS DECIMAL(35,20)) * CAST(CAST(100 AS DECIMAL(3,0)) AS DECIMAL(35,20)))#30994])\n+- *(16) Project [promotions#30990, total#30991, CheckOverflow((promote_precision(CheckOverflow((promote_precision(cast(promotions#30990 as decimal(15,4))) / promote_precision(cast(total#30991 as decimal(15,4)))), DecimalType(35,20))) * 100.00000000000000000000), DecimalType(38,19)) AS (CAST((CAST(CAST(promotions AS DECIMAL(15,4)) AS DECIMAL(15,4)) / CAST(CAST(total AS DECIMAL(15,4)) AS DECIMAL(15,4))) AS DECIMAL(35,20)) * CAST(CAST(100 AS DECIMAL(3,0)) AS DECIMAL(35,20)))#30994]\n   +- BroadcastNestedLoopJoin BuildRight, Cross\n      :- *(8) HashAggregate(keys=[], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[promotions#30990])\n      :  +- Exchange SinglePartition\n      :     +- *(7) HashAggregate(keys=[], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[sum#30999L])\n      :        +- *(7) Project [ss_ext_sales_price#1918]\n      :           +- *(7) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n      :              :- *(7) Project [ss_item_sk#1905, ss_ext_sales_price#1918]\n      :              :  +- *(7) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n      :              :     :- *(7) Project [ss_item_sk#1905, ss_ext_sales_price#1918, c_current_addr_sk#864]\n      :              :     :  +- *(7) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n      :              :     :     :- *(7) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_ext_sales_price#1918]\n      :              :     :     :  +- *(7) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :              :     :     :     :- *(7) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n      :              :     :     :     :  +- *(7) BroadcastHashJoin [ss_promo_sk#1911], [p_promo_sk#1254], Inner, BuildRight\n      :              :     :     :     :     :- *(7) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_promo_sk#1911, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n      :              :     :     :     :     :  +- *(7) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n      :              :     :     :     :     :     :- *(7) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_promo_sk#1911, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n      :              :     :     :     :     :     :  +- *(7) Filter (((isnotnull(ss_store_sk#1910) && isnotnull(ss_promo_sk#1911)) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_item_sk#1905))\n      :              :     :     :     :     :     :     +- *(7) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_store_sk#1910,ss_promo_sk#1911,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_promo_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_store_sk:int,ss_promo_sk:int,ss_ext_sales_price:decim...\n      :              :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :              :     :     :     :     :        +- *(1) Project [s_store_sk#1386]\n      :              :     :     :     :     :           +- *(1) Filter ((isnotnull(s_gmt_offset#1413) && (s_gmt_offset#1413 = -5.00)) && isnotnull(s_store_sk#1386))\n      :              :     :     :     :     :              +- *(1) FileScan parquet db_tpcds.store[s_store_sk#1386,s_gmt_offset#1413] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_gmt_offset), EqualTo(s_gmt_offset,-5.00), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_gmt_offset:decimal(5,2)>\n      :              :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :              :     :     :     :        +- *(2) Project [p_promo_sk#1254]\n      :              :     :     :     :           +- *(2) Filter ((((p_channel_dmail#1262 = Y) || (p_channel_email#1263 = Y)) || (p_channel_tv#1265 = Y)) && isnotnull(p_promo_sk#1254))\n      :              :     :     :     :              +- *(2) FileScan parquet db_tpcds.promotion[p_promo_sk#1254,p_channel_dmail#1262,p_channel_email#1263,p_channel_tv#1265] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/promotion], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(p_channel_dmail,Y),EqualTo(p_channel_email,Y)),EqualTo(p_channel_tv,Y)), IsNotNull..., ReadSchema: struct<p_promo_sk:int,p_channel_dmail:string,p_channel_email:string,p_channel_tv:string>\n      :              :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :              :     :     :        +- *(3) Project [d_date_sk#1040]\n      :              :     :     :           +- *(3) Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 11)) && isnotnull(d_date_sk#1040))\n      :              :     :     :              +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1998), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n      :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :              :     :        +- *(4) Project [c_customer_sk#860, c_current_addr_sk#864]\n      :              :     :           +- *(4) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n      :              :     :              +- *(4) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_addr_sk#864] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:int,c_current_addr_sk:int>\n      :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :              :        +- *(5) Project [ca_address_sk#922]\n      :              :           +- *(5) Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -5.00)) && isnotnull(ca_address_sk#922))\n      :              :              +- *(5) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_gmt_offset#933] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-5.00), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_gmt_offset:decimal(5,2)>\n      :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                 +- *(6) Project [i_item_sk#1172]\n      :                    +- *(6) Filter ((isnotnull(i_category#1184) && (i_category#1184 = Jewelry)) && isnotnull(i_item_sk#1172))\n      :                       +- *(6) FileScan parquet db_tpcds.item[i_item_sk#1172,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Jewelry), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_category:string>\n      +- BroadcastExchange IdentityBroadcastMode\n         +- *(15) HashAggregate(keys=[], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[total#30991])\n            +- Exchange SinglePartition\n               +- *(14) HashAggregate(keys=[], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[sum#31001L])\n                  +- *(14) Project [ss_ext_sales_price#1918]\n                     +- *(14) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n                        :- *(14) Project [ss_item_sk#1905, ss_ext_sales_price#1918]\n                        :  +- *(14) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n                        :     :- *(14) Project [ss_item_sk#1905, ss_ext_sales_price#1918, c_current_addr_sk#864]\n                        :     :  +- *(14) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n                        :     :     :- *(14) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_ext_sales_price#1918]\n                        :     :     :  +- *(14) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                        :     :     :     :- *(14) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                        :     :     :     :  +- *(14) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                        :     :     :     :     :- *(14) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_store_sk#1910, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                        :     :     :     :     :  +- *(14) Filter ((isnotnull(ss_store_sk#1910) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_item_sk#1905))\n                        :     :     :     :     :     +- *(14) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_store_sk#1910,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_store_sk:int,ss_ext_sales_price:decimal(7,2)>\n                        :     :     :     :     +- ReusedExchange [s_store_sk#1386], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        :     :     :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        :     :     +- ReusedExchange [c_customer_sk#860, c_current_addr_sk#864], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        :     +- ReusedExchange [ca_address_sk#922], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        +- ReusedExchange [i_item_sk#1172], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q62-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["web_sales","warehouse","ship_mode","web_site","date_dim"],"parsingTime":0.002215,"analysisTime":0.00111,"optimizationTime":78.18418,"planningTime":281.066233,"executionTime":2652.846087,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['substr('w_warehouse_name, 1, 20) ASC NULLS FIRST, 'sm_type ASC NULLS FIRST, 'web_name ASC NULLS FIRST], true\n      +- 'Aggregate ['substr('w_warehouse_name, 1, 20), 'sm_type, 'web_name], [unresolvedalias('substr('w_warehouse_name, 1, 20), None), 'sm_type, 'web_name, 'sum(CASE WHEN (('ws_ship_date_sk - 'ws_sold_date_sk) <= 30) THEN 1 ELSE 0 END) AS 30 days#31046, 'sum(CASE WHEN ((('ws_ship_date_sk - 'ws_sold_date_sk) > 30) && (('ws_ship_date_sk - 'ws_sold_date_sk) <= 60)) THEN 1 ELSE 0 END) AS 31-60 days#31047, 'sum(CASE WHEN ((('ws_ship_date_sk - 'ws_sold_date_sk) > 60) && (('ws_ship_date_sk - 'ws_sold_date_sk) <= 90)) THEN 1 ELSE 0 END) AS 61-90 days#31048, 'sum(CASE WHEN ((('ws_ship_date_sk - 'ws_sold_date_sk) > 90) && (('ws_ship_date_sk - 'ws_sold_date_sk) <= 120)) THEN 1 ELSE 0 END) AS 91-120 days#31049, 'sum(CASE WHEN (('ws_ship_date_sk - 'ws_sold_date_sk) > 120) THEN 1 ELSE 0 END) AS >120 days#31050]\n         +- 'Filter ((((('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11))) && ('ws_ship_date_sk = 'd_date_sk)) && ('ws_warehouse_sk = 'w_warehouse_sk)) && (('ws_ship_mode_sk = 'sm_ship_mode_sk) && ('ws_web_site_sk = 'web_site_sk)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'UnresolvedRelation `web_sales`\n               :  :  :  +- 'UnresolvedRelation `warehouse`\n               :  :  +- 'UnresolvedRelation `ship_mode`\n               :  +- 'UnresolvedRelation `web_site`\n               +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nsubstring(w_warehouse_name, 1, 20): string, sm_type: string, web_name: string, 30 days: bigint, 31-60 days: bigint, 61-90 days: bigint, 91-120 days: bigint, >120 days: bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [substring(w_warehouse_name, 1, 20)#31056, sm_type#1318, web_name#1652, 30 days#31046L, 31-60 days#31047L, 61-90 days#31048L, 91-120 days#31049L, >120 days#31050L]\n      +- Sort [substring(w_warehouse_name, 1, 20)#31056 ASC NULLS FIRST, sm_type#1318 ASC NULLS FIRST, web_name#1652 ASC NULLS FIRST], true\n         +- Aggregate [substring(w_warehouse_name#1514, 1, 20), sm_type#1318, web_name#1652], [substring(w_warehouse_name#1514, 1, 20) AS substring(w_warehouse_name, 1, 20)#31056, sm_type#1318, web_name#1652, sum(cast(CASE WHEN ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 30) THEN 1 ELSE 0 END as bigint)) AS 30 days#31046L, sum(cast(CASE WHEN (((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 30) && ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 60)) THEN 1 ELSE 0 END as bigint)) AS 31-60 days#31047L, sum(cast(CASE WHEN (((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 60) && ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 90)) THEN 1 ELSE 0 END as bigint)) AS 61-90 days#31048L, sum(cast(CASE WHEN (((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 90) && ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 120)) THEN 1 ELSE 0 END as bigint)) AS 91-120 days#31049L, sum(cast(CASE WHEN ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 120) THEN 1 ELSE 0 END as bigint)) AS >120 days#31050L]\n            +- Filter (((((d_month_seq#1043 >= 1200) && (d_month_seq#1043 <= (1200 + 11))) && (ws_ship_date_sk#1756 = d_date_sk#1040)) && (ws_warehouse_sk#1769 = w_warehouse_sk#1512)) && ((ws_ship_mode_sk#1768 = sm_ship_mode_sk#1316) && (ws_web_site_sk#1767 = web_site_sk#1648)))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- Join Inner\n                  :  :  :  :- SubqueryAlias web_sales\n                  :  :  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :  :  :  +- SubqueryAlias warehouse\n                  :  :  :     +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n                  :  :  +- SubqueryAlias ship_mode\n                  :  :     +- Relation[sm_ship_mode_sk#1316,sm_ship_mode_id#1317,sm_type#1318,sm_code#1319,sm_carrier#1320,sm_contract#1321] parquet\n                  :  +- SubqueryAlias web_site\n                  :     +- Relation[web_site_sk#1648,web_site_id#1649,web_rec_start_date#1650,web_rec_end_date#1651,web_name#1652,web_open_date_sk#1653,web_close_date_sk#1654,web_class#1655,web_manager#1656,web_mkt_id#1657,web_mkt_class#1658,web_mkt_desc#1659,web_market_manager#1660,web_company_id#1661,web_company_name#1662,web_street_number#1663,web_street_name#1664,web_street_type#1665,web_suite_number#1666,web_city#1667,web_county#1668,web_state#1669,web_zip#1670,web_country#1671,... 2 more fields] parquet\n                  +- SubqueryAlias date_dim\n                     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [substring(w_warehouse_name, 1, 20)#31056 ASC NULLS FIRST, sm_type#1318 ASC NULLS FIRST, web_name#1652 ASC NULLS FIRST], true\n      +- Aggregate [substring(w_warehouse_name#1514, 1, 20), sm_type#1318, web_name#1652], [substring(w_warehouse_name#1514, 1, 20) AS substring(w_warehouse_name, 1, 20)#31056, sm_type#1318, web_name#1652, sum(cast(CASE WHEN ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 30) THEN 1 ELSE 0 END as bigint)) AS 30 days#31046L, sum(cast(CASE WHEN (((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 30) && ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 60)) THEN 1 ELSE 0 END as bigint)) AS 31-60 days#31047L, sum(cast(CASE WHEN (((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 60) && ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 90)) THEN 1 ELSE 0 END as bigint)) AS 61-90 days#31048L, sum(cast(CASE WHEN (((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 90) && ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 120)) THEN 1 ELSE 0 END as bigint)) AS 91-120 days#31049L, sum(cast(CASE WHEN ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 120) THEN 1 ELSE 0 END as bigint)) AS >120 days#31050L]\n         +- Project [ws_ship_date_sk#1756, ws_sold_date_sk#1788, w_warehouse_name#1514, sm_type#1318, web_name#1652]\n            +- Join Inner, (ws_ship_date_sk#1756 = d_date_sk#1040)\n               :- Project [ws_ship_date_sk#1756, ws_sold_date_sk#1788, w_warehouse_name#1514, sm_type#1318, web_name#1652]\n               :  +- Join Inner, (ws_web_site_sk#1767 = web_site_sk#1648)\n               :     :- Project [ws_ship_date_sk#1756, ws_web_site_sk#1767, ws_sold_date_sk#1788, w_warehouse_name#1514, sm_type#1318]\n               :     :  +- Join Inner, (ws_ship_mode_sk#1768 = sm_ship_mode_sk#1316)\n               :     :     :- Project [ws_ship_date_sk#1756, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_sold_date_sk#1788, w_warehouse_name#1514]\n               :     :     :  +- Join Inner, (ws_warehouse_sk#1769 = w_warehouse_sk#1512)\n               :     :     :     :- Project [ws_ship_date_sk#1756, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_sold_date_sk#1788]\n               :     :     :     :  +- Filter (((isnotnull(ws_warehouse_sk#1769) && isnotnull(ws_ship_mode_sk#1768)) && isnotnull(ws_web_site_sk#1767)) && isnotnull(ws_ship_date_sk#1756))\n               :     :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :     :     +- Project [w_warehouse_sk#1512, w_warehouse_name#1514]\n               :     :     :        +- Filter isnotnull(w_warehouse_sk#1512)\n               :     :     :           +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n               :     :     +- Project [sm_ship_mode_sk#1316, sm_type#1318]\n               :     :        +- Filter isnotnull(sm_ship_mode_sk#1316)\n               :     :           +- Relation[sm_ship_mode_sk#1316,sm_ship_mode_id#1317,sm_type#1318,sm_code#1319,sm_carrier#1320,sm_contract#1321] parquet\n               :     +- Project [web_site_sk#1648, web_name#1652]\n               :        +- Filter isnotnull(web_site_sk#1648)\n               :           +- Relation[web_site_sk#1648,web_site_id#1649,web_rec_start_date#1650,web_rec_end_date#1651,web_name#1652,web_open_date_sk#1653,web_close_date_sk#1654,web_class#1655,web_manager#1656,web_mkt_id#1657,web_mkt_class#1658,web_mkt_desc#1659,web_market_manager#1660,web_company_id#1661,web_company_name#1662,web_street_number#1663,web_street_name#1664,web_street_type#1665,web_suite_number#1666,web_city#1667,web_county#1668,web_state#1669,web_zip#1670,web_country#1671,... 2 more fields] parquet\n               +- Project [d_date_sk#1040]\n                  +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[substring(w_warehouse_name, 1, 20)#31056 ASC NULLS FIRST,sm_type#1318 ASC NULLS FIRST,web_name#1652 ASC NULLS FIRST], output=[substring(w_warehouse_name, 1, 20)#31056,sm_type#1318,web_name#1652,30 days#31046L,31-60 days#31047L,61-90 days#31048L,91-120 days#31049L,>120 days#31050L])\n+- *(6) HashAggregate(keys=[substring(w_warehouse_name#1514, 1, 20)#31068, sm_type#1318, web_name#1652], functions=[sum(cast(CASE WHEN ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 30) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN (((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 30) && ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 60)) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN (((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 60) && ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 90)) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN (((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 90) && ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 120)) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 120) THEN 1 ELSE 0 END as bigint))], output=[substring(w_warehouse_name, 1, 20)#31056, sm_type#1318, web_name#1652, 30 days#31046L, 31-60 days#31047L, 61-90 days#31048L, 91-120 days#31049L, >120 days#31050L])\n   +- Exchange hashpartitioning(substring(w_warehouse_name#1514, 1, 20)#31068, sm_type#1318, web_name#1652, 200)\n      +- *(5) HashAggregate(keys=[substring(w_warehouse_name#1514, 1, 20) AS substring(w_warehouse_name#1514, 1, 20)#31068, sm_type#1318, web_name#1652], functions=[partial_sum(cast(CASE WHEN ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 30) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN (((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 30) && ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 60)) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN (((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 60) && ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 90)) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN (((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 90) && ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) <= 120)) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN ((ws_ship_date_sk#1756 - ws_sold_date_sk#1788) > 120) THEN 1 ELSE 0 END as bigint))], output=[substring(w_warehouse_name#1514, 1, 20)#31068, sm_type#1318, web_name#1652, sum#31074L, sum#31075L, sum#31076L, sum#31077L, sum#31078L])\n         +- *(5) Project [ws_ship_date_sk#1756, ws_sold_date_sk#1788, w_warehouse_name#1514, sm_type#1318, web_name#1652]\n            +- *(5) BroadcastHashJoin [ws_ship_date_sk#1756], [d_date_sk#1040], Inner, BuildRight\n               :- *(5) Project [ws_ship_date_sk#1756, ws_sold_date_sk#1788, w_warehouse_name#1514, sm_type#1318, web_name#1652]\n               :  +- *(5) BroadcastHashJoin [ws_web_site_sk#1767], [web_site_sk#1648], Inner, BuildRight\n               :     :- *(5) Project [ws_ship_date_sk#1756, ws_web_site_sk#1767, ws_sold_date_sk#1788, w_warehouse_name#1514, sm_type#1318]\n               :     :  +- *(5) BroadcastHashJoin [ws_ship_mode_sk#1768], [sm_ship_mode_sk#1316], Inner, BuildRight\n               :     :     :- *(5) Project [ws_ship_date_sk#1756, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_sold_date_sk#1788, w_warehouse_name#1514]\n               :     :     :  +- *(5) BroadcastHashJoin [ws_warehouse_sk#1769], [w_warehouse_sk#1512], Inner, BuildRight\n               :     :     :     :- *(5) Project [ws_ship_date_sk#1756, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_sold_date_sk#1788]\n               :     :     :     :  +- *(5) Filter (((isnotnull(ws_warehouse_sk#1769) && isnotnull(ws_ship_mode_sk#1768)) && isnotnull(ws_web_site_sk#1767)) && isnotnull(ws_ship_date_sk#1756))\n               :     :     :     :     +- *(5) FileScan parquet db_tpcds.web_sales[ws_ship_date_sk#1756,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ws_warehouse_sk), IsNotNull(ws_ship_mode_sk), IsNotNull(ws_web_site_sk), IsNotNull(ws_..., ReadSchema: struct<ws_ship_date_sk:int,ws_web_site_sk:int,ws_ship_mode_sk:int,ws_warehouse_sk:int>\n               :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :        +- *(1) Project [w_warehouse_sk#1512, w_warehouse_name#1514]\n               :     :     :           +- *(1) Filter isnotnull(w_warehouse_sk#1512)\n               :     :     :              +- *(1) FileScan parquet db_tpcds.warehouse[w_warehouse_sk#1512,w_warehouse_name#1514] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/warehouse], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>\n               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(2) Project [sm_ship_mode_sk#1316, sm_type#1318]\n               :     :           +- *(2) Filter isnotnull(sm_ship_mode_sk#1316)\n               :     :              +- *(2) FileScan parquet db_tpcds.ship_mode[sm_ship_mode_sk#1316,sm_type#1318] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/ship_mode], PartitionFilters: [], PushedFilters: [IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:int,sm_type:string>\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(3) Project [web_site_sk#1648, web_name#1652]\n               :           +- *(3) Filter isnotnull(web_site_sk#1648)\n               :              +- *(3) FileScan parquet db_tpcds.web_site[web_site_sk#1648,web_name#1652] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_site], PartitionFilters: [], PushedFilters: [IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:int,web_name:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(4) Project [d_date_sk#1040]\n                     +- *(4) Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                        +- *(4) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_month_seq#1043] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>"},{"name":"q63-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["item","store_sales","date_dim","store"],"parsingTime":0.002285,"analysisTime":0.001437,"optimizationTime":271.576887,"planningTime":11.944845,"executionTime":3225.846311,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_manager_id ASC NULLS FIRST, 'avg_monthly_sales ASC NULLS FIRST, 'sum_sales ASC NULLS FIRST], true\n      +- 'Project [*]\n         +- 'Filter (CASE WHEN ('avg_monthly_sales > 0) THEN ('abs(('sum_sales - 'avg_monthly_sales)) / 'avg_monthly_sales) ELSE null END > 0.1)\n            +- 'SubqueryAlias tmp1\n               +- 'Aggregate ['i_manager_id, 'd_moy], ['i_manager_id, 'sum('ss_sales_price) AS sum_sales#31113, 'avg('sum('ss_sales_price)) windowspecdefinition('i_manager_id, unspecifiedframe$()) AS avg_monthly_sales#31114]\n                  +- 'Filter (((('ss_item_sk = 'i_item_sk) && ('ss_sold_date_sk = 'd_date_sk)) && ('ss_store_sk = 's_store_sk)) && ('d_month_seq IN (1200,(1200 + 1),(1200 + 2),(1200 + 3),(1200 + 4),(1200 + 5),(1200 + 6),(1200 + 7),(1200 + 8),(1200 + 9),(1200 + 10),(1200 + 11)) && ((('i_category IN (Books,Children,Electronics) && 'i_class IN (personal,portable,reference,self-help)) && 'i_brand IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) || (('i_category IN (Women,Music,Men) && 'i_class IN (accessories,classical,fragrances,pants)) && 'i_brand IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1)))))\n                     +- 'Join Inner\n                        :- 'Join Inner\n                        :  :- 'Join Inner\n                        :  :  :- 'UnresolvedRelation `item`\n                        :  :  +- 'UnresolvedRelation `store_sales`\n                        :  +- 'UnresolvedRelation `date_dim`\n                        +- 'UnresolvedRelation `store`\n\n== Analyzed Logical Plan ==\ni_manager_id: int, sum_sales: decimal(17,2), avg_monthly_sales: decimal(21,6)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_manager_id#1192 ASC NULLS FIRST, avg_monthly_sales#31114 ASC NULLS FIRST, sum_sales#31113 ASC NULLS FIRST], true\n      +- Project [i_manager_id#1192, sum_sales#31113, avg_monthly_sales#31114]\n         +- Filter (cast(CASE WHEN (cast(avg_monthly_sales#31114 as decimal(21,6)) > cast(cast(0 as decimal(1,0)) as decimal(21,6))) THEN CheckOverflow((promote_precision(cast(abs(CheckOverflow((promote_precision(cast(sum_sales#31113 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#31114 as decimal(22,6)))), DecimalType(22,6))) as decimal(22,6))) / promote_precision(cast(avg_monthly_sales#31114 as decimal(22,6)))), DecimalType(38,16)) ELSE cast(null as decimal(38,16)) END as decimal(38,16)) > cast(0.1 as decimal(38,16)))\n            +- SubqueryAlias tmp1\n               +- Project [i_manager_id#1192, sum_sales#31113, avg_monthly_sales#31114]\n                  +- Project [i_manager_id#1192, sum_sales#31113, _w0#31118, avg_monthly_sales#31114, avg_monthly_sales#31114]\n                     +- Window [avg(_w0#31118) windowspecdefinition(i_manager_id#1192, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#31114], [i_manager_id#1192]\n                        +- Aggregate [i_manager_id#1192, d_moy#1048], [i_manager_id#1192, sum(ss_sales_price#1916) AS sum_sales#31113, sum(ss_sales_price#1916) AS _w0#31118]\n                           +- Filter ((((ss_item_sk#1905 = i_item_sk#1172) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && (ss_store_sk#1910 = s_store_sk#1386)) && (d_month_seq#1043 IN (1200,(1200 + 1),(1200 + 2),(1200 + 3),(1200 + 4),(1200 + 5),(1200 + 6),(1200 + 7),(1200 + 8),(1200 + 9),(1200 + 10),(1200 + 11)) && (((i_category#1184 IN (Books,Children,Electronics) && i_class#1182 IN (personal,portable,reference,self-help)) && i_brand#1180 IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) || ((i_category#1184 IN (Women,Music,Men) && i_class#1182 IN (accessories,classical,fragrances,pants)) && i_brand#1180 IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1)))))\n                              +- Join Inner\n                                 :- Join Inner\n                                 :  :- Join Inner\n                                 :  :  :- SubqueryAlias item\n                                 :  :  :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                                 :  :  +- SubqueryAlias store_sales\n                                 :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                 :  +- SubqueryAlias date_dim\n                                 :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                 +- SubqueryAlias store\n                                    +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_manager_id#1192 ASC NULLS FIRST, avg_monthly_sales#31114 ASC NULLS FIRST, sum_sales#31113 ASC NULLS FIRST], true\n      +- Project [i_manager_id#1192, sum_sales#31113, avg_monthly_sales#31114]\n         +- Filter (CASE WHEN (avg_monthly_sales#31114 > 0.000000) THEN CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#31113 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#31114 as decimal(22,6)))), DecimalType(22,6)))) / promote_precision(cast(avg_monthly_sales#31114 as decimal(22,6)))), DecimalType(38,16)) ELSE null END > 0.1000000000000000)\n            +- Window [avg(_w0#31118) windowspecdefinition(i_manager_id#1192, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#31114], [i_manager_id#1192]\n               +- Aggregate [i_manager_id#1192, d_moy#1048], [i_manager_id#1192, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS sum_sales#31113, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS _w0#31118]\n                  +- Project [i_manager_id#1192, ss_sales_price#1916, d_moy#1048]\n                     +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n                        :- Project [i_manager_id#1192, ss_store_sk#1910, ss_sales_price#1916, d_moy#1048]\n                        :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                        :     :- Project [i_manager_id#1192, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                        :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                        :     :     :- Project [i_item_sk#1172, i_manager_id#1192]\n                        :     :     :  +- Filter ((((i_category#1184 IN (Books,Children,Electronics) && i_class#1182 IN (personal,portable,reference,self-help)) && i_brand#1180 IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) || ((i_category#1184 IN (Women,Music,Men) && i_class#1182 IN (accessories,classical,fragrances,pants)) && i_brand#1180 IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1))) && isnotnull(i_item_sk#1172))\n                        :     :     :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :     :     +- Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                        :     :        +- Filter ((isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_store_sk#1910))\n                        :     :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :     +- Project [d_date_sk#1040, d_moy#1048]\n                        :        +- Filter (d_month_seq#1043 INSET (1200,1211,1205,1201,1206,1210,1207,1202,1209,1203,1208,1204) && isnotnull(d_date_sk#1040))\n                        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Project [s_store_sk#1386]\n                           +- Filter isnotnull(s_store_sk#1386)\n                              +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_manager_id#1192 ASC NULLS FIRST,avg_monthly_sales#31114 ASC NULLS FIRST,sum_sales#31113 ASC NULLS FIRST], output=[i_manager_id#1192,sum_sales#31113,avg_monthly_sales#31114])\n+- *(7) Project [i_manager_id#1192, sum_sales#31113, avg_monthly_sales#31114]\n   +- *(7) Filter (CASE WHEN (avg_monthly_sales#31114 > 0.000000) THEN CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#31113 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#31114 as decimal(22,6)))), DecimalType(22,6)))) / promote_precision(cast(avg_monthly_sales#31114 as decimal(22,6)))), DecimalType(38,16)) ELSE null END > 0.1000000000000000)\n      +- Window [avg(_w0#31118) windowspecdefinition(i_manager_id#1192, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#31114], [i_manager_id#1192]\n         +- *(6) Sort [i_manager_id#1192 ASC NULLS FIRST], false, 0\n            +- Exchange hashpartitioning(i_manager_id#1192, 200)\n               +- *(5) HashAggregate(keys=[i_manager_id#1192, d_moy#1048], functions=[sum(UnscaledValue(ss_sales_price#1916))], output=[i_manager_id#1192, sum_sales#31113, _w0#31118])\n                  +- Exchange hashpartitioning(i_manager_id#1192, d_moy#1048, 200)\n                     +- *(4) HashAggregate(keys=[i_manager_id#1192, d_moy#1048], functions=[partial_sum(UnscaledValue(ss_sales_price#1916))], output=[i_manager_id#1192, d_moy#1048, sum#31123L])\n                        +- *(4) Project [i_manager_id#1192, ss_sales_price#1916, d_moy#1048]\n                           +- *(4) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                              :- *(4) Project [i_manager_id#1192, ss_store_sk#1910, ss_sales_price#1916, d_moy#1048]\n                              :  +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                              :     :- *(4) Project [i_manager_id#1192, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                              :     :  +- *(4) BroadcastHashJoin [i_item_sk#1172], [ss_item_sk#1905], Inner, BuildLeft\n                              :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :  +- *(1) Project [i_item_sk#1172, i_manager_id#1192]\n                              :     :     :     +- *(1) Filter ((((i_category#1184 IN (Books,Children,Electronics) && i_class#1182 IN (personal,portable,reference,self-help)) && i_brand#1180 IN (scholaramalgamalg #14,scholaramalgamalg #7,exportiunivamalg #9,scholaramalgamalg #9)) || ((i_category#1184 IN (Women,Music,Men) && i_class#1182 IN (accessories,classical,fragrances,pants)) && i_brand#1180 IN (amalgimporto #1,edu packscholar #1,exportiimporto #1,importoamalg #1))) && isnotnull(i_item_sk#1172))\n                              :     :     :        +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand#1180,i_class#1182,i_category#1184,i_manager_id#1192] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [Or(And(And(In(i_category, [Books,Children,Electronics]),In(i_class, [personal,portable,reference..., ReadSchema: struct<i_item_sk:int,i_brand:string,i_class:string,i_category:string,i_manager_id:int>\n                              :     :     +- *(4) Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                              :     :        +- *(4) Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_store_sk#1910))\n                              :     :           +- *(4) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_store_sk#1910,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>\n                              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :        +- *(2) Project [d_date_sk#1040, d_moy#1048]\n                              :           +- *(2) Filter (d_month_seq#1043 INSET (1200,1211,1205,1201,1206,1210,1207,1202,1209,1203,1208,1204) && isnotnull(d_date_sk#1040))\n                              :              +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_month_seq#1043,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [In(d_month_seq, [1200,1211,1205,1201,1206,1210,1207,1202,1209,1203,1208,1204]), IsNotNull(d_date..., ReadSchema: struct<d_date_sk:int,d_month_seq:int,d_moy:int>\n                              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 +- *(3) Project [s_store_sk#1386]\n                                    +- *(3) Filter isnotnull(s_store_sk#1386)\n                                       +- *(3) FileScan parquet db_tpcds.store[s_store_sk#1386] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int>"},{"name":"q64-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin"],"tables":["cross_sales","cross_sales"],"parsingTime":0.001919,"analysisTime":0.001291,"optimizationTime":2717.387141,"planningTime":3660.078128,"executionTime":29241.181157,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [cs_ui, cross_sales]\n:  :- 'SubqueryAlias cs_ui\n:  :  +- 'Filter ('sum('cs_ext_list_price) > (2 * 'sum((('cr_refunded_cash + 'cr_reversed_charge) + 'cr_store_credit))))\n:  :     +- 'Aggregate ['cs_item_sk], ['cs_item_sk, 'sum('cs_ext_list_price) AS sale#31737, 'sum((('cr_refunded_cash + 'cr_reversed_charge) + 'cr_store_credit)) AS refund#31738]\n:  :        +- 'Filter (('cs_item_sk = 'cr_item_sk) && ('cs_order_number = 'cr_order_number))\n:  :           +- 'Join Inner\n:  :              :- 'UnresolvedRelation `catalog_sales`\n:  :              +- 'UnresolvedRelation `catalog_returns`\n:  +- 'SubqueryAlias cross_sales\n:     +- 'Aggregate ['i_product_name, 'i_item_sk, 's_store_name, 's_zip, 'ad1.ca_street_number, 'ad1.ca_street_name, 'ad1.ca_city, 'ad1.ca_zip, 'ad2.ca_street_number, 'ad2.ca_street_name, 'ad2.ca_city, 'ad2.ca_zip, 'd1.d_year, 'd2.d_year, 'd3.d_year], ['i_product_name AS product_name#31739, 'i_item_sk AS item_sk#31740, 's_store_name AS store_name#31741, 's_zip AS store_zip#31742, 'ad1.ca_street_number AS b_street_number#31743, 'ad1.ca_street_name AS b_streen_name#31744, 'ad1.ca_city AS b_city#31745, 'ad1.ca_zip AS b_zip#31746, 'ad2.ca_street_number AS c_street_number#31747, 'ad2.ca_street_name AS c_street_name#31748, 'ad2.ca_city AS c_city#31749, 'ad2.ca_zip AS c_zip#31750, 'd1.d_year AS syear#31751, 'd2.d_year AS fsyear#31752, 'd3.d_year AS s2year#31753, 'count(1) AS cnt#31754, 'sum('ss_wholesale_cost) AS s1#31755, 'sum('ss_list_price) AS s2#31756, 'sum('ss_coupon_amt) AS s3#31757]\n:        +- 'Filter (((((('ss_store_sk = 's_store_sk) && ('ss_sold_date_sk = 'd1.d_date_sk)) && ('ss_customer_sk = 'c_customer_sk)) && ((('ss_cdemo_sk = 'cd1.cd_demo_sk) && ('ss_hdemo_sk = 'hd1.hd_demo_sk)) && ('ss_addr_sk = 'ad1.ca_address_sk))) && (((('ss_item_sk = 'i_item_sk) && ('ss_item_sk = 'sr_item_sk)) && ('ss_ticket_number = 'sr_ticket_number)) && (('ss_item_sk = 'cs_ui.cs_item_sk) && ('c_current_cdemo_sk = 'cd2.cd_demo_sk)))) && ((((('c_current_hdemo_sk = 'hd2.hd_demo_sk) && ('c_current_addr_sk = 'ad2.ca_address_sk)) && ('c_first_sales_date_sk = 'd2.d_date_sk)) && ((('c_first_shipto_date_sk = 'd3.d_date_sk) && ('ss_promo_sk = 'p_promo_sk)) && ('hd1.hd_income_band_sk = 'ib1.ib_income_band_sk))) && (((('hd2.hd_income_band_sk = 'ib2.ib_income_band_sk) && NOT ('cd1.cd_marital_status = 'cd2.cd_marital_status)) && 'i_color IN (purple,burlywood,indian,spring,floral,medium)) && ((('i_current_price >= 64) && ('i_current_price <= (64 + 10))) && (('i_current_price >= (64 + 1)) && ('i_current_price <= (64 + 15)))))))\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'Join Inner\n:              :  :  :- 'Join Inner\n:              :  :  :  :- 'Join Inner\n:              :  :  :  :  :- 'Join Inner\n:              :  :  :  :  :  :- 'Join Inner\n:              :  :  :  :  :  :  :- 'Join Inner\n:              :  :  :  :  :  :  :  :- 'Join Inner\n:              :  :  :  :  :  :  :  :  :- 'Join Inner\n:              :  :  :  :  :  :  :  :  :  :- 'Join Inner\n:              :  :  :  :  :  :  :  :  :  :  :- 'Join Inner\n:              :  :  :  :  :  :  :  :  :  :  :  :- 'Join Inner\n:              :  :  :  :  :  :  :  :  :  :  :  :  :- 'Join Inner\n:              :  :  :  :  :  :  :  :  :  :  :  :  :  :- 'Join Inner\n:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- 'Join Inner\n:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- 'Join Inner\n:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- 'UnresolvedRelation `store_sales`\n:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- 'UnresolvedRelation `store_returns`\n:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- 'UnresolvedRelation `cs_ui`\n:              :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- 'SubqueryAlias d1\n:              :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- 'UnresolvedRelation `date_dim`\n:              :  :  :  :  :  :  :  :  :  :  :  :  :  +- 'SubqueryAlias d2\n:              :  :  :  :  :  :  :  :  :  :  :  :  :     +- 'UnresolvedRelation `date_dim`\n:              :  :  :  :  :  :  :  :  :  :  :  :  +- 'SubqueryAlias d3\n:              :  :  :  :  :  :  :  :  :  :  :  :     +- 'UnresolvedRelation `date_dim`\n:              :  :  :  :  :  :  :  :  :  :  :  +- 'UnresolvedRelation `store`\n:              :  :  :  :  :  :  :  :  :  :  +- 'UnresolvedRelation `customer`\n:              :  :  :  :  :  :  :  :  :  +- 'SubqueryAlias cd1\n:              :  :  :  :  :  :  :  :  :     +- 'UnresolvedRelation `customer_demographics`\n:              :  :  :  :  :  :  :  :  +- 'SubqueryAlias cd2\n:              :  :  :  :  :  :  :  :     +- 'UnresolvedRelation `customer_demographics`\n:              :  :  :  :  :  :  :  +- 'UnresolvedRelation `promotion`\n:              :  :  :  :  :  :  +- 'SubqueryAlias hd1\n:              :  :  :  :  :  :     +- 'UnresolvedRelation `household_demographics`\n:              :  :  :  :  :  +- 'SubqueryAlias hd2\n:              :  :  :  :  :     +- 'UnresolvedRelation `household_demographics`\n:              :  :  :  :  +- 'SubqueryAlias ad1\n:              :  :  :  :     +- 'UnresolvedRelation `customer_address`\n:              :  :  :  +- 'SubqueryAlias ad2\n:              :  :  :     +- 'UnresolvedRelation `customer_address`\n:              :  :  +- 'SubqueryAlias ib1\n:              :  :     +- 'UnresolvedRelation `income_band`\n:              :  +- 'SubqueryAlias ib2\n:              :     +- 'UnresolvedRelation `income_band`\n:              +- 'UnresolvedRelation `item`\n+- 'Sort ['cs1.product_name ASC NULLS FIRST, 'cs1.store_name ASC NULLS FIRST, 'cs2.cnt ASC NULLS FIRST], true\n   +- 'Project ['cs1.product_name, 'cs1.store_name, 'cs1.store_zip, 'cs1.b_street_number, 'cs1.b_streen_name, 'cs1.b_city, 'cs1.b_zip, 'cs1.c_street_number, 'cs1.c_street_name, 'cs1.c_city, 'cs1.c_zip, 'cs1.syear, 'cs1.cnt, 'cs1.s1, 'cs1.s2, 'cs1.s3, 'cs2.s1, 'cs2.s2, 'cs2.s3, 'cs2.syear, 'cs2.cnt]\n      +- 'Filter (((('cs1.item_sk = 'cs2.item_sk) && ('cs1.syear = 1999)) && ('cs2.syear = (1999 + 1))) && ((('cs2.cnt <= 'cs1.cnt) && ('cs1.store_name = 'cs2.store_name)) && ('cs1.store_zip = 'cs2.store_zip)))\n         +- 'Join Inner\n            :- 'SubqueryAlias cs1\n            :  +- 'UnresolvedRelation `cross_sales`\n            +- 'SubqueryAlias cs2\n               +- 'UnresolvedRelation `cross_sales`\n\n== Analyzed Logical Plan ==\nproduct_name: string, store_name: string, store_zip: string, b_street_number: string, b_streen_name: string, b_city: string, b_zip: string, c_street_number: string, c_street_name: string, c_city: string, c_zip: string, syear: int, cnt: bigint, s1: decimal(17,2), s2: decimal(17,2), s3: decimal(17,2), s1: decimal(17,2), s2: decimal(17,2), s3: decimal(17,2), syear: int, cnt: bigint\nSort [product_name#31739 ASC NULLS FIRST, store_name#31741 ASC NULLS FIRST, cnt#31877L ASC NULLS FIRST], true\n+- Project [product_name#31739, store_name#31741, store_zip#31742, b_street_number#31743, b_streen_name#31744, b_city#31745, b_zip#31746, c_street_number#31747, c_street_name#31748, c_city#31749, c_zip#31750, syear#31751, cnt#31754L, s1#31755, s2#31756, s3#31757, s1#31878, s2#31879, s3#31880, syear#31874, cnt#31877L]\n   +- Filter ((((item_sk#31740 = item_sk#31863) && (syear#31751 = 1999)) && (syear#31874 = (1999 + 1))) && (((cnt#31877L <= cnt#31754L) && (store_name#31741 = store_name#31864)) && (store_zip#31742 = store_zip#31865)))\n      +- Join Inner\n         :- SubqueryAlias cs1\n         :  +- SubqueryAlias cross_sales\n         :     +- Aggregate [i_product_name#1193, i_item_sk#1172, s_store_name#1391, s_zip#1411, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, d_year#1046, d_year#31775, d_year#31803], [i_product_name#1193 AS product_name#31739, i_item_sk#1172 AS item_sk#31740, s_store_name#1391 AS store_name#31741, s_zip#1411 AS store_zip#31742, ca_street_number#924 AS b_street_number#31743, ca_street_name#925 AS b_streen_name#31744, ca_city#928 AS b_city#31745, ca_zip#931 AS b_zip#31746, ca_street_number#31841 AS c_street_number#31747, ca_street_name#31842 AS c_street_name#31748, ca_city#31845 AS c_city#31749, ca_zip#31848 AS c_zip#31750, d_year#1046 AS syear#31751, d_year#31775 AS fsyear#31752, d_year#31803 AS s2year#31753, count(1) AS cnt#31754L, sum(ss_wholesale_cost#1914) AS s1#31755, sum(ss_list_price#1915) AS s2#31756, sum(ss_coupon_amt#1922) AS s3#31757]\n         :        +- Filter ((((((ss_store_sk#1910 = s_store_sk#1386) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && (ss_customer_sk#1906 = c_customer_sk#860)) && (((ss_cdemo_sk#1907 = cd_demo_sk#966) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && (ss_addr_sk#1909 = ca_address_sk#922))) && ((((ss_item_sk#1905 = i_item_sk#1172) && (ss_item_sk#1905 = sr_item_sk#1705)) && (ss_ticket_number#1912L = sr_ticket_number#1712L)) && ((ss_item_sk#1905 = cs_item_sk#1803) && (c_current_cdemo_sk#862 = cd_demo_sk#31825)))) && (((((c_current_hdemo_sk#863 = hd_demo_sk#31834) && (c_current_addr_sk#864 = ca_address_sk#31839)) && (c_first_sales_date_sk#866 = d_date_sk#31769)) && (((c_first_shipto_date_sk#865 = d_date_sk#31797) && (ss_promo_sk#1911 = p_promo_sk#1254)) && (hd_income_band_sk#1107 = ib_income_band_sk#1122))) && ((((hd_income_band_sk#31835 = ib_income_band_sk#31852) && NOT (cd_marital_status#968 = cd_marital_status#31827)) && i_color#1189 IN (purple,burlywood,indian,spring,floral,medium)) && (((cast(i_current_price#1177 as decimal(7,2)) >= cast(cast(64 as decimal(2,0)) as decimal(7,2))) && (cast(i_current_price#1177 as decimal(12,2)) <= cast(cast((64 + 10) as decimal(10,0)) as decimal(12,2)))) && ((cast(i_current_price#1177 as decimal(12,2)) >= cast(cast((64 + 1) as decimal(10,0)) as decimal(12,2))) && (cast(i_current_price#1177 as decimal(12,2)) <= cast(cast((64 + 15) as decimal(10,0)) as decimal(12,2))))))))\n         :           +- Join Inner\n         :              :- Join Inner\n         :              :  :- Join Inner\n         :              :  :  :- Join Inner\n         :              :  :  :  :- Join Inner\n         :              :  :  :  :  :- Join Inner\n         :              :  :  :  :  :  :- Join Inner\n         :              :  :  :  :  :  :  :- Join Inner\n         :              :  :  :  :  :  :  :  :- Join Inner\n         :              :  :  :  :  :  :  :  :  :- Join Inner\n         :              :  :  :  :  :  :  :  :  :  :- Join Inner\n         :              :  :  :  :  :  :  :  :  :  :  :- Join Inner\n         :              :  :  :  :  :  :  :  :  :  :  :  :- Join Inner\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :- Join Inner\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :- Join Inner\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Join Inner\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Join Inner\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- SubqueryAlias store_sales\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias store_returns\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias cs_ui\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Project [cs_item_sk#1803, sale#31737, refund#31738]\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :        +- Filter (cast(sum(cs_ext_list_price#1813)#31763 as decimal(21,2)) > cast(CheckOverflow((promote_precision(cast(cast(2 as decimal(1,0)) as decimal(19,2))) * promote_precision(cast(sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))#31764 as decimal(19,2)))), DecimalType(21,2)) as decimal(21,2)))\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :           +- Aggregate [cs_item_sk#1803], [cs_item_sk#1803, sum(cs_ext_list_price#1813) AS sale#31737, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2))) AS refund#31738, sum(cs_ext_list_price#1813) AS sum(cs_ext_list_price#1813)#31763, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2))) AS sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))#31764]\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :              +- Filter ((cs_item_sk#1803 = cr_item_sk#2087) && (cs_order_number#1805L = cr_order_number#2101L))\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :                 +- Join Inner\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :                    :- SubqueryAlias catalog_sales\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :                    :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :                    +- SubqueryAlias catalog_returns\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  :                       +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias d1\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- SubqueryAlias date_dim\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias d2\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :     +- SubqueryAlias date_dim\n         :              :  :  :  :  :  :  :  :  :  :  :  :  :        +- Relation[d_date_sk#31769,d_date_id#31770,d_date#31771,d_month_seq#31772,d_week_seq#31773,d_quarter_seq#31774,d_year#31775,d_dow#31776,d_moy#31777,d_dom#31778,d_qoy#31779,d_fy_year#31780,d_fy_quarter_seq#31781,d_fy_week_seq#31782,d_day_name#31783,d_quarter_name#31784,d_holiday#31785,d_weekend#31786,d_following_holiday#31787,d_first_dom#31788,d_last_dom#31789,d_same_day_ly#31790,d_same_day_lq#31791,d_current_day#31792,... 4 more fields] parquet\n         :              :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias d3\n         :              :  :  :  :  :  :  :  :  :  :  :  :     +- SubqueryAlias date_dim\n         :              :  :  :  :  :  :  :  :  :  :  :  :        +- Relation[d_date_sk#31797,d_date_id#31798,d_date#31799,d_month_seq#31800,d_week_seq#31801,d_quarter_seq#31802,d_year#31803,d_dow#31804,d_moy#31805,d_dom#31806,d_qoy#31807,d_fy_year#31808,d_fy_quarter_seq#31809,d_fy_week_seq#31810,d_day_name#31811,d_quarter_name#31812,d_holiday#31813,d_weekend#31814,d_following_holiday#31815,d_first_dom#31816,d_last_dom#31817,d_same_day_ly#31818,d_same_day_lq#31819,d_current_day#31820,... 4 more fields] parquet\n         :              :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias store\n         :              :  :  :  :  :  :  :  :  :  :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n         :              :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias customer\n         :              :  :  :  :  :  :  :  :  :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n         :              :  :  :  :  :  :  :  :  :  +- SubqueryAlias cd1\n         :              :  :  :  :  :  :  :  :  :     +- SubqueryAlias customer_demographics\n         :              :  :  :  :  :  :  :  :  :        +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n         :              :  :  :  :  :  :  :  :  +- SubqueryAlias cd2\n         :              :  :  :  :  :  :  :  :     +- SubqueryAlias customer_demographics\n         :              :  :  :  :  :  :  :  :        +- Relation[cd_demo_sk#31825,cd_gender#31826,cd_marital_status#31827,cd_education_status#31828,cd_purchase_estimate#31829,cd_credit_rating#31830,cd_dep_count#31831,cd_dep_employed_count#31832,cd_dep_college_count#31833] parquet\n         :              :  :  :  :  :  :  :  +- SubqueryAlias promotion\n         :              :  :  :  :  :  :  :     +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n         :              :  :  :  :  :  :  +- SubqueryAlias hd1\n         :              :  :  :  :  :  :     +- SubqueryAlias household_demographics\n         :              :  :  :  :  :  :        +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n         :              :  :  :  :  :  +- SubqueryAlias hd2\n         :              :  :  :  :  :     +- SubqueryAlias household_demographics\n         :              :  :  :  :  :        +- Relation[hd_demo_sk#31834,hd_income_band_sk#31835,hd_buy_potential#31836,hd_dep_count#31837,hd_vehicle_count#31838] parquet\n         :              :  :  :  :  +- SubqueryAlias ad1\n         :              :  :  :  :     +- SubqueryAlias customer_address\n         :              :  :  :  :        +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n         :              :  :  :  +- SubqueryAlias ad2\n         :              :  :  :     +- SubqueryAlias customer_address\n         :              :  :  :        +- Relation[ca_address_sk#31839,ca_address_id#31840,ca_street_number#31841,ca_street_name#31842,ca_street_type#31843,ca_suite_number#31844,ca_city#31845,ca_county#31846,ca_state#31847,ca_zip#31848,ca_country#31849,ca_gmt_offset#31850,ca_location_type#31851] parquet\n         :              :  :  +- SubqueryAlias ib1\n         :              :  :     +- SubqueryAlias income_band\n         :              :  :        +- Relation[ib_income_band_sk#1122,ib_lower_bound#1123,ib_upper_bound#1124] parquet\n         :              :  +- SubqueryAlias ib2\n         :              :     +- SubqueryAlias income_band\n         :              :        +- Relation[ib_income_band_sk#31852,ib_lower_bound#31853,ib_upper_bound#31854] parquet\n         :              +- SubqueryAlias item\n         :                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         +- SubqueryAlias cs2\n            +- SubqueryAlias cross_sales\n               +- Aggregate [i_product_name#1193, i_item_sk#1172, s_store_name#1391, s_zip#1411, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, d_year#1046, d_year#31775, d_year#31803], [i_product_name#1193 AS product_name#31862, i_item_sk#1172 AS item_sk#31863, s_store_name#1391 AS store_name#31864, s_zip#1411 AS store_zip#31865, ca_street_number#924 AS b_street_number#31866, ca_street_name#925 AS b_streen_name#31867, ca_city#928 AS b_city#31868, ca_zip#931 AS b_zip#31869, ca_street_number#31841 AS c_street_number#31870, ca_street_name#31842 AS c_street_name#31871, ca_city#31845 AS c_city#31872, ca_zip#31848 AS c_zip#31873, d_year#1046 AS syear#31874, d_year#31775 AS fsyear#31875, d_year#31803 AS s2year#31876, count(1) AS cnt#31877L, sum(ss_wholesale_cost#1914) AS s1#31878, sum(ss_list_price#1915) AS s2#31879, sum(ss_coupon_amt#1922) AS s3#31880]\n                  +- Filter ((((((ss_store_sk#1910 = s_store_sk#1386) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && (ss_customer_sk#1906 = c_customer_sk#860)) && (((ss_cdemo_sk#1907 = cd_demo_sk#966) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && (ss_addr_sk#1909 = ca_address_sk#922))) && ((((ss_item_sk#1905 = i_item_sk#1172) && (ss_item_sk#1905 = sr_item_sk#1705)) && (ss_ticket_number#1912L = sr_ticket_number#1712L)) && ((ss_item_sk#1905 = cs_item_sk#1803) && (c_current_cdemo_sk#862 = cd_demo_sk#31825)))) && (((((c_current_hdemo_sk#863 = hd_demo_sk#31834) && (c_current_addr_sk#864 = ca_address_sk#31839)) && (c_first_sales_date_sk#866 = d_date_sk#31769)) && (((c_first_shipto_date_sk#865 = d_date_sk#31797) && (ss_promo_sk#1911 = p_promo_sk#1254)) && (hd_income_band_sk#1107 = ib_income_band_sk#1122))) && ((((hd_income_band_sk#31835 = ib_income_band_sk#31852) && NOT (cd_marital_status#968 = cd_marital_status#31827)) && i_color#1189 IN (purple,burlywood,indian,spring,floral,medium)) && (((cast(i_current_price#1177 as decimal(7,2)) >= cast(cast(64 as decimal(2,0)) as decimal(7,2))) && (cast(i_current_price#1177 as decimal(12,2)) <= cast(cast((64 + 10) as decimal(10,0)) as decimal(12,2)))) && ((cast(i_current_price#1177 as decimal(12,2)) >= cast(cast((64 + 1) as decimal(10,0)) as decimal(12,2))) && (cast(i_current_price#1177 as decimal(12,2)) <= cast(cast((64 + 15) as decimal(10,0)) as decimal(12,2))))))))\n                     +- Join Inner\n                        :- Join Inner\n                        :  :- Join Inner\n                        :  :  :- Join Inner\n                        :  :  :  :- Join Inner\n                        :  :  :  :  :- Join Inner\n                        :  :  :  :  :  :- Join Inner\n                        :  :  :  :  :  :  :- Join Inner\n                        :  :  :  :  :  :  :  :- Join Inner\n                        :  :  :  :  :  :  :  :  :- Join Inner\n                        :  :  :  :  :  :  :  :  :  :- Join Inner\n                        :  :  :  :  :  :  :  :  :  :  :- Join Inner\n                        :  :  :  :  :  :  :  :  :  :  :  :- Join Inner\n                        :  :  :  :  :  :  :  :  :  :  :  :  :- Join Inner\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :- Join Inner\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Join Inner\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Join Inner\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- SubqueryAlias store_sales\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias store_returns\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias cs_ui\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Project [cs_item_sk#1803, sale#31737, refund#31738]\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :        +- Filter (cast(sum(cs_ext_list_price#1813)#31763 as decimal(21,2)) > cast(CheckOverflow((promote_precision(cast(cast(2 as decimal(1,0)) as decimal(19,2))) * promote_precision(cast(sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))#31764 as decimal(19,2)))), DecimalType(21,2)) as decimal(21,2)))\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :           +- Aggregate [cs_item_sk#1803], [cs_item_sk#1803, sum(cs_ext_list_price#1813) AS sale#31737, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2))) AS refund#31738, sum(cs_ext_list_price#1813) AS sum(cs_ext_list_price#1813)#31763, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2))) AS sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))#31764]\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :              +- Filter ((cs_item_sk#1803 = cr_item_sk#2087) && (cs_order_number#1805L = cr_order_number#2101L))\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :                 +- Join Inner\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :                    :- SubqueryAlias catalog_sales\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :                    :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :                    +- SubqueryAlias catalog_returns\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  :                       +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias d1\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- SubqueryAlias date_dim\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :  :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias d2\n                        :  :  :  :  :  :  :  :  :  :  :  :  :     +- SubqueryAlias date_dim\n                        :  :  :  :  :  :  :  :  :  :  :  :  :        +- Relation[d_date_sk#31769,d_date_id#31770,d_date#31771,d_month_seq#31772,d_week_seq#31773,d_quarter_seq#31774,d_year#31775,d_dow#31776,d_moy#31777,d_dom#31778,d_qoy#31779,d_fy_year#31780,d_fy_quarter_seq#31781,d_fy_week_seq#31782,d_day_name#31783,d_quarter_name#31784,d_holiday#31785,d_weekend#31786,d_following_holiday#31787,d_first_dom#31788,d_last_dom#31789,d_same_day_ly#31790,d_same_day_lq#31791,d_current_day#31792,... 4 more fields] parquet\n                        :  :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias d3\n                        :  :  :  :  :  :  :  :  :  :  :  :     +- SubqueryAlias date_dim\n                        :  :  :  :  :  :  :  :  :  :  :  :        +- Relation[d_date_sk#31797,d_date_id#31798,d_date#31799,d_month_seq#31800,d_week_seq#31801,d_quarter_seq#31802,d_year#31803,d_dow#31804,d_moy#31805,d_dom#31806,d_qoy#31807,d_fy_year#31808,d_fy_quarter_seq#31809,d_fy_week_seq#31810,d_day_name#31811,d_quarter_name#31812,d_holiday#31813,d_weekend#31814,d_following_holiday#31815,d_first_dom#31816,d_last_dom#31817,d_same_day_ly#31818,d_same_day_lq#31819,d_current_day#31820,... 4 more fields] parquet\n                        :  :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias store\n                        :  :  :  :  :  :  :  :  :  :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                        :  :  :  :  :  :  :  :  :  :  +- SubqueryAlias customer\n                        :  :  :  :  :  :  :  :  :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                        :  :  :  :  :  :  :  :  :  +- SubqueryAlias cd1\n                        :  :  :  :  :  :  :  :  :     +- SubqueryAlias customer_demographics\n                        :  :  :  :  :  :  :  :  :        +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n                        :  :  :  :  :  :  :  :  +- SubqueryAlias cd2\n                        :  :  :  :  :  :  :  :     +- SubqueryAlias customer_demographics\n                        :  :  :  :  :  :  :  :        +- Relation[cd_demo_sk#31825,cd_gender#31826,cd_marital_status#31827,cd_education_status#31828,cd_purchase_estimate#31829,cd_credit_rating#31830,cd_dep_count#31831,cd_dep_employed_count#31832,cd_dep_college_count#31833] parquet\n                        :  :  :  :  :  :  :  +- SubqueryAlias promotion\n                        :  :  :  :  :  :  :     +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n                        :  :  :  :  :  :  +- SubqueryAlias hd1\n                        :  :  :  :  :  :     +- SubqueryAlias household_demographics\n                        :  :  :  :  :  :        +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n                        :  :  :  :  :  +- SubqueryAlias hd2\n                        :  :  :  :  :     +- SubqueryAlias household_demographics\n                        :  :  :  :  :        +- Relation[hd_demo_sk#31834,hd_income_band_sk#31835,hd_buy_potential#31836,hd_dep_count#31837,hd_vehicle_count#31838] parquet\n                        :  :  :  :  +- SubqueryAlias ad1\n                        :  :  :  :     +- SubqueryAlias customer_address\n                        :  :  :  :        +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                        :  :  :  +- SubqueryAlias ad2\n                        :  :  :     +- SubqueryAlias customer_address\n                        :  :  :        +- Relation[ca_address_sk#31839,ca_address_id#31840,ca_street_number#31841,ca_street_name#31842,ca_street_type#31843,ca_suite_number#31844,ca_city#31845,ca_county#31846,ca_state#31847,ca_zip#31848,ca_country#31849,ca_gmt_offset#31850,ca_location_type#31851] parquet\n                        :  :  +- SubqueryAlias ib1\n                        :  :     +- SubqueryAlias income_band\n                        :  :        +- Relation[ib_income_band_sk#1122,ib_lower_bound#1123,ib_upper_bound#1124] parquet\n                        :  +- SubqueryAlias ib2\n                        :     +- SubqueryAlias income_band\n                        :        +- Relation[ib_income_band_sk#31852,ib_lower_bound#31853,ib_upper_bound#31854] parquet\n                        +- SubqueryAlias item\n                           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nSort [product_name#31739 ASC NULLS FIRST, store_name#31741 ASC NULLS FIRST, cnt#31877L ASC NULLS FIRST], true\n+- Project [product_name#31739, store_name#31741, store_zip#31742, b_street_number#31743, b_streen_name#31744, b_city#31745, b_zip#31746, c_street_number#31747, c_street_name#31748, c_city#31749, c_zip#31750, syear#31751, cnt#31754L, s1#31755, s2#31756, s3#31757, s1#31878, s2#31879, s3#31880, syear#31874, cnt#31877L]\n   +- Join Inner, ((((item_sk#31740 = item_sk#31863) && (cnt#31877L <= cnt#31754L)) && (store_name#31741 = store_name#31864)) && (store_zip#31742 = store_zip#31865))\n      :- Aggregate [i_product_name#1193, i_item_sk#1172, s_store_name#1391, s_zip#1411, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, d_year#1046, d_year#31775, d_year#31803], [i_product_name#1193 AS product_name#31739, i_item_sk#1172 AS item_sk#31740, s_store_name#1391 AS store_name#31741, s_zip#1411 AS store_zip#31742, ca_street_number#924 AS b_street_number#31743, ca_street_name#925 AS b_streen_name#31744, ca_city#928 AS b_city#31745, ca_zip#931 AS b_zip#31746, ca_street_number#31841 AS c_street_number#31747, ca_street_name#31842 AS c_street_name#31748, ca_city#31845 AS c_city#31749, ca_zip#31848 AS c_zip#31750, d_year#1046 AS syear#31751, count(1) AS cnt#31754L, MakeDecimal(sum(UnscaledValue(ss_wholesale_cost#1914)),17,2) AS s1#31755, MakeDecimal(sum(UnscaledValue(ss_list_price#1915)),17,2) AS s2#31756, MakeDecimal(sum(UnscaledValue(ss_coupon_amt#1922)),17,2) AS s3#31757]\n      :  +- Project [ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, i_item_sk#1172, i_product_name#1193]\n      :     +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n      :        :- Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n      :        :  +- Join Inner, (hd_income_band_sk#31835 = ib_income_band_sk#31852)\n      :        :     :- Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, hd_income_band_sk#31835, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n      :        :     :  +- Join Inner, (hd_income_band_sk#1107 = ib_income_band_sk#1122)\n      :        :     :     :- Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, hd_income_band_sk#1107, hd_income_band_sk#31835, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n      :        :     :     :  +- Join Inner, (c_current_addr_sk#864 = ca_address_sk#31839)\n      :        :     :     :     :- Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_addr_sk#864, d_year#31775, d_year#31803, hd_income_band_sk#1107, hd_income_band_sk#31835, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931]\n      :        :     :     :     :  +- Join Inner, (ss_addr_sk#1909 = ca_address_sk#922)\n      :        :     :     :     :     :- Project [ss_item_sk#1905, ss_addr_sk#1909, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_addr_sk#864, d_year#31775, d_year#31803, hd_income_band_sk#1107, hd_income_band_sk#31835]\n      :        :     :     :     :     :  +- Join Inner, (c_current_hdemo_sk#863 = hd_demo_sk#31834)\n      :        :     :     :     :     :     :- Project [ss_item_sk#1905, ss_addr_sk#1909, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803, hd_income_band_sk#1107]\n      :        :     :     :     :     :     :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n      :        :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803]\n      :        :     :     :     :     :     :     :  +- Join Inner, (ss_promo_sk#1911 = p_promo_sk#1254)\n      :        :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803]\n      :        :     :     :     :     :     :     :     :  +- Join Inner, ((c_current_cdemo_sk#862 = cd_demo_sk#31825) && NOT (cd_marital_status#968 = cd_marital_status#31827))\n      :        :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803, cd_marital_status#968]\n      :        :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_cdemo_sk#1907 = cd_demo_sk#966)\n      :        :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803]\n      :        :     :     :     :     :     :     :     :     :     :  +- Join Inner, (c_first_shipto_date_sk#865 = d_date_sk#31797)\n      :        :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, d_year#31775]\n      :        :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (c_first_sales_date_sk#866 = d_date_sk#31769)\n      :        :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866]\n      :        :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_item_sk#1905 = cs_item_sk#1803)\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, ((ss_item_sk#1905 = sr_item_sk#1705) && (ss_ticket_number#1912L = sr_ticket_number#1712L))\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Filter ((((((((isnotnull(ss_item_sk#1905) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_cdemo_sk#1907)) && isnotnull(ss_promo_sk#1911)) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_addr_sk#1909))\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [sr_item_sk#1705, sr_ticket_number#1712L]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter (isnotnull(sr_ticket_number#1712L) && isnotnull(sr_item_sk#1705))\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [cs_item_sk#1803]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter (isnotnull(sum(cs_ext_list_price#1813)#31763) && (cast(sum(cs_ext_list_price#1813)#31763 as decimal(21,2)) > CheckOverflow((2.00 * promote_precision(sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))#31764)), DecimalType(21,2))))\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- Aggregate [cs_item_sk#1803], [cs_item_sk#1803, MakeDecimal(sum(UnscaledValue(cs_ext_list_price#1813)),17,2) AS sum(cs_ext_list_price#1813)#31763, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2))) AS sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))#31764]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :              +- Project [cs_item_sk#1803, cs_ext_list_price#1813, cr_refunded_cash#2108, cr_reversed_charge#2109, cr_store_credit#2110]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                 +- Join Inner, ((cs_item_sk#1803 = cr_item_sk#2087) && (cs_order_number#1805L = cr_order_number#2101L))\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    :- Project [cs_item_sk#1803, cs_order_number#1805L, cs_ext_list_price#1813]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_order_number#1805L))\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    +- Project [cr_item_sk#2087, cr_order_number#2101L, cr_refunded_cash#2108, cr_reversed_charge#2109, cr_store_credit#2110]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                       +- Filter (isnotnull(cr_item_sk#2087) && isnotnull(cr_order_number#2101L))\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                          +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [d_date_sk#1040, d_year#1046]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 1999)) && isnotnull(d_date_sk#1040))\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [s_store_sk#1386, s_store_name#1391, s_zip#1411]\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter ((isnotnull(s_store_sk#1386) && isnotnull(s_store_name#1391)) && isnotnull(s_zip#1411))\n      :        :     :     :     :     :     :     :     :     :     :     :     :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n      :        :     :     :     :     :     :     :     :     :     :     :     :     +- Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866]\n      :        :     :     :     :     :     :     :     :     :     :     :     :        +- Filter (((((isnotnull(c_customer_sk#860) && isnotnull(c_first_sales_date_sk#866)) && isnotnull(c_first_shipto_date_sk#865)) && isnotnull(c_current_cdemo_sk#862)) && isnotnull(c_current_hdemo_sk#863)) && isnotnull(c_current_addr_sk#864))\n      :        :     :     :     :     :     :     :     :     :     :     :     :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n      :        :     :     :     :     :     :     :     :     :     :     :     +- Project [d_date_sk#31769, d_year#31775]\n      :        :     :     :     :     :     :     :     :     :     :     :        +- Filter isnotnull(d_date_sk#31769)\n      :        :     :     :     :     :     :     :     :     :     :     :           +- Relation[d_date_sk#31769,d_date_id#31770,d_date#31771,d_month_seq#31772,d_week_seq#31773,d_quarter_seq#31774,d_year#31775,d_dow#31776,d_moy#31777,d_dom#31778,d_qoy#31779,d_fy_year#31780,d_fy_quarter_seq#31781,d_fy_week_seq#31782,d_day_name#31783,d_quarter_name#31784,d_holiday#31785,d_weekend#31786,d_following_holiday#31787,d_first_dom#31788,d_last_dom#31789,d_same_day_ly#31790,d_same_day_lq#31791,d_current_day#31792,... 4 more fields] parquet\n      :        :     :     :     :     :     :     :     :     :     :     +- Project [d_date_sk#31797, d_year#31803]\n      :        :     :     :     :     :     :     :     :     :     :        +- Filter isnotnull(d_date_sk#31797)\n      :        :     :     :     :     :     :     :     :     :     :           +- Relation[d_date_sk#31797,d_date_id#31798,d_date#31799,d_month_seq#31800,d_week_seq#31801,d_quarter_seq#31802,d_year#31803,d_dow#31804,d_moy#31805,d_dom#31806,d_qoy#31807,d_fy_year#31808,d_fy_quarter_seq#31809,d_fy_week_seq#31810,d_day_name#31811,d_quarter_name#31812,d_holiday#31813,d_weekend#31814,d_following_holiday#31815,d_first_dom#31816,d_last_dom#31817,d_same_day_ly#31818,d_same_day_lq#31819,d_current_day#31820,... 4 more fields] parquet\n      :        :     :     :     :     :     :     :     :     :     +- Project [cd_demo_sk#966, cd_marital_status#968]\n      :        :     :     :     :     :     :     :     :     :        +- Filter (isnotnull(cd_demo_sk#966) && isnotnull(cd_marital_status#968))\n      :        :     :     :     :     :     :     :     :     :           +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n      :        :     :     :     :     :     :     :     :     +- Project [cd_demo_sk#31825, cd_marital_status#31827]\n      :        :     :     :     :     :     :     :     :        +- Filter (isnotnull(cd_demo_sk#31825) && isnotnull(cd_marital_status#31827))\n      :        :     :     :     :     :     :     :     :           +- Relation[cd_demo_sk#31825,cd_gender#31826,cd_marital_status#31827,cd_education_status#31828,cd_purchase_estimate#31829,cd_credit_rating#31830,cd_dep_count#31831,cd_dep_employed_count#31832,cd_dep_college_count#31833] parquet\n      :        :     :     :     :     :     :     :     +- Project [p_promo_sk#1254]\n      :        :     :     :     :     :     :     :        +- Filter isnotnull(p_promo_sk#1254)\n      :        :     :     :     :     :     :     :           +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n      :        :     :     :     :     :     :     +- Project [hd_demo_sk#1106, hd_income_band_sk#1107]\n      :        :     :     :     :     :     :        +- Filter (isnotnull(hd_demo_sk#1106) && isnotnull(hd_income_band_sk#1107))\n      :        :     :     :     :     :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n      :        :     :     :     :     :     +- Project [hd_demo_sk#31834, hd_income_band_sk#31835]\n      :        :     :     :     :     :        +- Filter (isnotnull(hd_demo_sk#31834) && isnotnull(hd_income_band_sk#31835))\n      :        :     :     :     :     :           +- Relation[hd_demo_sk#31834,hd_income_band_sk#31835,hd_buy_potential#31836,hd_dep_count#31837,hd_vehicle_count#31838] parquet\n      :        :     :     :     :     +- Project [ca_address_sk#922, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931]\n      :        :     :     :     :        +- Filter isnotnull(ca_address_sk#922)\n      :        :     :     :     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n      :        :     :     :     +- Project [ca_address_sk#31839, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n      :        :     :     :        +- Filter isnotnull(ca_address_sk#31839)\n      :        :     :     :           +- Relation[ca_address_sk#31839,ca_address_id#31840,ca_street_number#31841,ca_street_name#31842,ca_street_type#31843,ca_suite_number#31844,ca_city#31845,ca_county#31846,ca_state#31847,ca_zip#31848,ca_country#31849,ca_gmt_offset#31850,ca_location_type#31851] parquet\n      :        :     :     +- Project [ib_income_band_sk#1122]\n      :        :     :        +- Filter isnotnull(ib_income_band_sk#1122)\n      :        :     :           +- Relation[ib_income_band_sk#1122,ib_lower_bound#1123,ib_upper_bound#1124] parquet\n      :        :     +- Project [ib_income_band_sk#31852]\n      :        :        +- Filter isnotnull(ib_income_band_sk#31852)\n      :        :           +- Relation[ib_income_band_sk#31852,ib_lower_bound#31853,ib_upper_bound#31854] parquet\n      :        +- Project [i_item_sk#1172, i_product_name#1193]\n      :           +- Filter ((((((isnotnull(i_current_price#1177) && i_color#1189 IN (purple,burlywood,indian,spring,floral,medium)) && (i_current_price#1177 >= 64.00)) && (cast(i_current_price#1177 as decimal(12,2)) <= 74.00)) && (cast(i_current_price#1177 as decimal(12,2)) >= 65.00)) && (cast(i_current_price#1177 as decimal(12,2)) <= 79.00)) && isnotnull(i_item_sk#1172))\n      :              +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n      +- Aggregate [i_product_name#1193, i_item_sk#1172, s_store_name#1391, s_zip#1411, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, d_year#1046, d_year#31775, d_year#31803], [i_item_sk#1172 AS item_sk#31863, s_store_name#1391 AS store_name#31864, s_zip#1411 AS store_zip#31865, d_year#1046 AS syear#31874, count(1) AS cnt#31877L, MakeDecimal(sum(UnscaledValue(ss_wholesale_cost#1914)),17,2) AS s1#31878, MakeDecimal(sum(UnscaledValue(ss_list_price#1915)),17,2) AS s2#31879, MakeDecimal(sum(UnscaledValue(ss_coupon_amt#1922)),17,2) AS s3#31880]\n         +- Project [ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, i_item_sk#1172, i_product_name#1193]\n            +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :- Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n               :  +- Join Inner, (hd_income_band_sk#31835 = ib_income_band_sk#31852)\n               :     :- Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, hd_income_band_sk#31835, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n               :     :  +- Join Inner, (hd_income_band_sk#1107 = ib_income_band_sk#1122)\n               :     :     :- Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, hd_income_band_sk#1107, hd_income_band_sk#31835, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n               :     :     :  +- Join Inner, (c_current_addr_sk#864 = ca_address_sk#31839)\n               :     :     :     :- Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_addr_sk#864, d_year#31775, d_year#31803, hd_income_band_sk#1107, hd_income_band_sk#31835, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931]\n               :     :     :     :  +- Join Inner, (ss_addr_sk#1909 = ca_address_sk#922)\n               :     :     :     :     :- Project [ss_item_sk#1905, ss_addr_sk#1909, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_addr_sk#864, d_year#31775, d_year#31803, hd_income_band_sk#1107, hd_income_band_sk#31835]\n               :     :     :     :     :  +- Join Inner, (c_current_hdemo_sk#863 = hd_demo_sk#31834)\n               :     :     :     :     :     :- Project [ss_item_sk#1905, ss_addr_sk#1909, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803, hd_income_band_sk#1107]\n               :     :     :     :     :     :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n               :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803]\n               :     :     :     :     :     :     :  +- Join Inner, (ss_promo_sk#1911 = p_promo_sk#1254)\n               :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803]\n               :     :     :     :     :     :     :     :  +- Join Inner, ((c_current_cdemo_sk#862 = cd_demo_sk#31825) && NOT (cd_marital_status#968 = cd_marital_status#31827))\n               :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803, cd_marital_status#968]\n               :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_cdemo_sk#1907 = cd_demo_sk#966)\n               :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803]\n               :     :     :     :     :     :     :     :     :     :  +- Join Inner, (c_first_shipto_date_sk#865 = d_date_sk#31797)\n               :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, d_year#31775]\n               :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (c_first_sales_date_sk#866 = d_date_sk#31769)\n               :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866]\n               :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n               :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411]\n               :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046]\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, (ss_item_sk#1905 = cs_item_sk#1803)\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Join Inner, ((ss_item_sk#1905 = sr_item_sk#1705) && (ss_ticket_number#1912L = sr_ticket_number#1712L))\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Filter ((((((((isnotnull(ss_item_sk#1905) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_cdemo_sk#1907)) && isnotnull(ss_promo_sk#1911)) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_addr_sk#1909))\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [sr_item_sk#1705, sr_ticket_number#1712L]\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter (isnotnull(sr_ticket_number#1712L) && isnotnull(sr_item_sk#1705))\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [cs_item_sk#1803]\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter (isnotnull(sum(cs_ext_list_price#1813)#31763) && (cast(sum(cs_ext_list_price#1813)#31763 as decimal(21,2)) > CheckOverflow((2.00 * promote_precision(sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))#31764)), DecimalType(21,2))))\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- Aggregate [cs_item_sk#1803], [cs_item_sk#1803, MakeDecimal(sum(UnscaledValue(cs_ext_list_price#1813)),17,2) AS sum(cs_ext_list_price#1813)#31763, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2))) AS sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))#31764]\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :              +- Project [cs_item_sk#1803, cs_ext_list_price#1813, cr_refunded_cash#2108, cr_reversed_charge#2109, cr_store_credit#2110]\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                 +- Join Inner, ((cs_item_sk#1803 = cr_item_sk#2087) && (cs_order_number#1805L = cr_order_number#2101L))\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    :- Project [cs_item_sk#1803, cs_order_number#1805L, cs_ext_list_price#1813]\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_order_number#1805L))\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    +- Project [cr_item_sk#2087, cr_order_number#2101L, cr_refunded_cash#2108, cr_reversed_charge#2109, cr_store_credit#2110]\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                       +- Filter (isnotnull(cr_item_sk#2087) && isnotnull(cr_order_number#2101L))\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                          +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [d_date_sk#1040, d_year#1046]\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n               :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :     :     :     :     :     :     :     :     :     :     :     :     +- Project [s_store_sk#1386, s_store_name#1391, s_zip#1411]\n               :     :     :     :     :     :     :     :     :     :     :     :     :        +- Filter ((isnotnull(s_store_sk#1386) && isnotnull(s_zip#1411)) && isnotnull(s_store_name#1391))\n               :     :     :     :     :     :     :     :     :     :     :     :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               :     :     :     :     :     :     :     :     :     :     :     :     +- Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866]\n               :     :     :     :     :     :     :     :     :     :     :     :        +- Filter (((((isnotnull(c_customer_sk#860) && isnotnull(c_first_sales_date_sk#866)) && isnotnull(c_first_shipto_date_sk#865)) && isnotnull(c_current_cdemo_sk#862)) && isnotnull(c_current_hdemo_sk#863)) && isnotnull(c_current_addr_sk#864))\n               :     :     :     :     :     :     :     :     :     :     :     :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :     :     :     :     :     :     :     :     :     :     :     +- Project [d_date_sk#31769, d_year#31775]\n               :     :     :     :     :     :     :     :     :     :     :        +- Filter isnotnull(d_date_sk#31769)\n               :     :     :     :     :     :     :     :     :     :     :           +- Relation[d_date_sk#31769,d_date_id#31770,d_date#31771,d_month_seq#31772,d_week_seq#31773,d_quarter_seq#31774,d_year#31775,d_dow#31776,d_moy#31777,d_dom#31778,d_qoy#31779,d_fy_year#31780,d_fy_quarter_seq#31781,d_fy_week_seq#31782,d_day_name#31783,d_quarter_name#31784,d_holiday#31785,d_weekend#31786,d_following_holiday#31787,d_first_dom#31788,d_last_dom#31789,d_same_day_ly#31790,d_same_day_lq#31791,d_current_day#31792,... 4 more fields] parquet\n               :     :     :     :     :     :     :     :     :     :     +- Project [d_date_sk#31797, d_year#31803]\n               :     :     :     :     :     :     :     :     :     :        +- Filter isnotnull(d_date_sk#31797)\n               :     :     :     :     :     :     :     :     :     :           +- Relation[d_date_sk#31797,d_date_id#31798,d_date#31799,d_month_seq#31800,d_week_seq#31801,d_quarter_seq#31802,d_year#31803,d_dow#31804,d_moy#31805,d_dom#31806,d_qoy#31807,d_fy_year#31808,d_fy_quarter_seq#31809,d_fy_week_seq#31810,d_day_name#31811,d_quarter_name#31812,d_holiday#31813,d_weekend#31814,d_following_holiday#31815,d_first_dom#31816,d_last_dom#31817,d_same_day_ly#31818,d_same_day_lq#31819,d_current_day#31820,... 4 more fields] parquet\n               :     :     :     :     :     :     :     :     :     +- Project [cd_demo_sk#966, cd_marital_status#968]\n               :     :     :     :     :     :     :     :     :        +- Filter (isnotnull(cd_demo_sk#966) && isnotnull(cd_marital_status#968))\n               :     :     :     :     :     :     :     :     :           +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n               :     :     :     :     :     :     :     :     +- Project [cd_demo_sk#31825, cd_marital_status#31827]\n               :     :     :     :     :     :     :     :        +- Filter (isnotnull(cd_demo_sk#31825) && isnotnull(cd_marital_status#31827))\n               :     :     :     :     :     :     :     :           +- Relation[cd_demo_sk#31825,cd_gender#31826,cd_marital_status#31827,cd_education_status#31828,cd_purchase_estimate#31829,cd_credit_rating#31830,cd_dep_count#31831,cd_dep_employed_count#31832,cd_dep_college_count#31833] parquet\n               :     :     :     :     :     :     :     +- Project [p_promo_sk#1254]\n               :     :     :     :     :     :     :        +- Filter isnotnull(p_promo_sk#1254)\n               :     :     :     :     :     :     :           +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n               :     :     :     :     :     :     +- Project [hd_demo_sk#1106, hd_income_band_sk#1107]\n               :     :     :     :     :     :        +- Filter (isnotnull(hd_demo_sk#1106) && isnotnull(hd_income_band_sk#1107))\n               :     :     :     :     :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n               :     :     :     :     :     +- Project [hd_demo_sk#31834, hd_income_band_sk#31835]\n               :     :     :     :     :        +- Filter (isnotnull(hd_demo_sk#31834) && isnotnull(hd_income_band_sk#31835))\n               :     :     :     :     :           +- Relation[hd_demo_sk#31834,hd_income_band_sk#31835,hd_buy_potential#31836,hd_dep_count#31837,hd_vehicle_count#31838] parquet\n               :     :     :     :     +- Project [ca_address_sk#922, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931]\n               :     :     :     :        +- Filter isnotnull(ca_address_sk#922)\n               :     :     :     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               :     :     :     +- Project [ca_address_sk#31839, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n               :     :     :        +- Filter isnotnull(ca_address_sk#31839)\n               :     :     :           +- Relation[ca_address_sk#31839,ca_address_id#31840,ca_street_number#31841,ca_street_name#31842,ca_street_type#31843,ca_suite_number#31844,ca_city#31845,ca_county#31846,ca_state#31847,ca_zip#31848,ca_country#31849,ca_gmt_offset#31850,ca_location_type#31851] parquet\n               :     :     +- Project [ib_income_band_sk#1122]\n               :     :        +- Filter isnotnull(ib_income_band_sk#1122)\n               :     :           +- Relation[ib_income_band_sk#1122,ib_lower_bound#1123,ib_upper_bound#1124] parquet\n               :     +- Project [ib_income_band_sk#31852]\n               :        +- Filter isnotnull(ib_income_band_sk#31852)\n               :           +- Relation[ib_income_band_sk#31852,ib_lower_bound#31853,ib_upper_bound#31854] parquet\n               +- Project [i_item_sk#1172, i_product_name#1193]\n                  +- Filter ((((((isnotnull(i_current_price#1177) && i_color#1189 IN (purple,burlywood,indian,spring,floral,medium)) && (i_current_price#1177 >= 64.00)) && (cast(i_current_price#1177 as decimal(12,2)) <= 74.00)) && (cast(i_current_price#1177 as decimal(12,2)) >= 65.00)) && (cast(i_current_price#1177 as decimal(12,2)) <= 79.00)) && isnotnull(i_item_sk#1172))\n                     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\n*(62) Sort [product_name#31739 ASC NULLS FIRST, store_name#31741 ASC NULLS FIRST, cnt#31877L ASC NULLS FIRST], true, 0\n+- Exchange rangepartitioning(product_name#31739 ASC NULLS FIRST, store_name#31741 ASC NULLS FIRST, cnt#31877L ASC NULLS FIRST, 200)\n   +- *(61) Project [product_name#31739, store_name#31741, store_zip#31742, b_street_number#31743, b_streen_name#31744, b_city#31745, b_zip#31746, c_street_number#31747, c_street_name#31748, c_city#31749, c_zip#31750, syear#31751, cnt#31754L, s1#31755, s2#31756, s3#31757, s1#31878, s2#31879, s3#31880, syear#31874, cnt#31877L]\n      +- *(61) SortMergeJoin [item_sk#31740, store_name#31741, store_zip#31742], [item_sk#31863, store_name#31864, store_zip#31865], Inner, (cnt#31877L <= cnt#31754L)\n         :- *(30) Sort [item_sk#31740 ASC NULLS FIRST, store_name#31741 ASC NULLS FIRST, store_zip#31742 ASC NULLS FIRST], false, 0\n         :  +- Exchange hashpartitioning(item_sk#31740, store_name#31741, store_zip#31742, 200)\n         :     +- *(29) HashAggregate(keys=[i_product_name#1193, i_item_sk#1172, s_store_name#1391, s_zip#1411, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, d_year#1046, d_year#31775, d_year#31803], functions=[count(1), sum(UnscaledValue(ss_wholesale_cost#1914)), sum(UnscaledValue(ss_list_price#1915)), sum(UnscaledValue(ss_coupon_amt#1922))], output=[product_name#31739, item_sk#31740, store_name#31741, store_zip#31742, b_street_number#31743, b_streen_name#31744, b_city#31745, b_zip#31746, c_street_number#31747, c_street_name#31748, c_city#31749, c_zip#31750, syear#31751, cnt#31754L, s1#31755, s2#31756, s3#31757])\n         :        +- Exchange hashpartitioning(i_product_name#1193, i_item_sk#1172, s_store_name#1391, s_zip#1411, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, d_year#1046, d_year#31775, d_year#31803, 200)\n         :           +- *(28) HashAggregate(keys=[i_product_name#1193, i_item_sk#1172, s_store_name#1391, s_zip#1411, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, d_year#1046, d_year#31775, d_year#31803], functions=[partial_count(1), partial_sum(UnscaledValue(ss_wholesale_cost#1914)), partial_sum(UnscaledValue(ss_list_price#1915)), partial_sum(UnscaledValue(ss_coupon_amt#1922))], output=[i_product_name#1193, i_item_sk#1172, s_store_name#1391, s_zip#1411, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, d_year#1046, d_year#31775, d_year#31803, count#31910L, sum#31911L, sum#31912L, sum#31913L])\n         :              +- *(28) Project [ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, i_item_sk#1172, i_product_name#1193]\n         :                 +- *(28) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n         :                    :- *(28) Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n         :                    :  +- *(28) BroadcastHashJoin [hd_income_band_sk#31835], [ib_income_band_sk#31852], Inner, BuildRight\n         :                    :     :- *(28) Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, hd_income_band_sk#31835, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n         :                    :     :  +- *(28) BroadcastHashJoin [hd_income_band_sk#1107], [ib_income_band_sk#1122], Inner, BuildRight\n         :                    :     :     :- *(28) Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, hd_income_band_sk#1107, hd_income_band_sk#31835, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n         :                    :     :     :  +- *(28) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#31839], Inner, BuildRight\n         :                    :     :     :     :- *(28) Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_addr_sk#864, d_year#31775, d_year#31803, hd_income_band_sk#1107, hd_income_band_sk#31835, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931]\n         :                    :     :     :     :  +- *(28) BroadcastHashJoin [ss_addr_sk#1909], [ca_address_sk#922], Inner, BuildRight\n         :                    :     :     :     :     :- *(28) Project [ss_item_sk#1905, ss_addr_sk#1909, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_addr_sk#864, d_year#31775, d_year#31803, hd_income_band_sk#1107, hd_income_band_sk#31835]\n         :                    :     :     :     :     :  +- *(28) BroadcastHashJoin [c_current_hdemo_sk#863], [hd_demo_sk#31834], Inner, BuildRight\n         :                    :     :     :     :     :     :- *(28) Project [ss_item_sk#1905, ss_addr_sk#1909, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803, hd_income_band_sk#1107]\n         :                    :     :     :     :     :     :  +- *(28) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n         :                    :     :     :     :     :     :     :- *(28) Project [ss_item_sk#1905, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803]\n         :                    :     :     :     :     :     :     :  +- *(28) BroadcastHashJoin [ss_promo_sk#1911], [p_promo_sk#1254], Inner, BuildRight\n         :                    :     :     :     :     :     :     :     :- *(28) Project [ss_item_sk#1905, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803]\n         :                    :     :     :     :     :     :     :     :  +- *(28) BroadcastHashJoin [c_current_cdemo_sk#862], [cd_demo_sk#31825], Inner, BuildRight, NOT (cd_marital_status#968 = cd_marital_status#31827)\n         :                    :     :     :     :     :     :     :     :     :- *(28) Project [ss_item_sk#1905, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803, cd_marital_status#968]\n         :                    :     :     :     :     :     :     :     :     :  +- *(28) BroadcastHashJoin [ss_cdemo_sk#1907], [cd_demo_sk#966], Inner, BuildRight\n         :                    :     :     :     :     :     :     :     :     :     :- *(28) Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803]\n         :                    :     :     :     :     :     :     :     :     :     :  +- *(28) BroadcastHashJoin [c_first_shipto_date_sk#865], [d_date_sk#31797], Inner, BuildRight\n         :                    :     :     :     :     :     :     :     :     :     :     :- *(28) Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, d_year#31775]\n         :                    :     :     :     :     :     :     :     :     :     :     :  +- *(28) BroadcastHashJoin [c_first_sales_date_sk#866], [d_date_sk#31769], Inner, BuildRight\n         :                    :     :     :     :     :     :     :     :     :     :     :     :- *(28) Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :  +- *(28) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :- *(28) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :  +- *(28) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :- *(28) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- *(28) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- *(28) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- *(28) SortMergeJoin [ss_item_sk#1905], [cs_item_sk#1803], Inner\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- *(6) Sort [ss_item_sk#1905 ASC NULLS FIRST], false, 0\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- Exchange hashpartitioning(ss_item_sk#1905, 200)\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- *(5) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- *(5) SortMergeJoin [ss_item_sk#1905, ss_ticket_number#1912L], [sr_item_sk#1705, sr_ticket_number#1712L], Inner\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           :- *(2) Sort [ss_item_sk#1905 ASC NULLS FIRST, ss_ticket_number#1912L ASC NULLS FIRST], false, 0\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           :  +- Exchange hashpartitioning(ss_item_sk#1905, ss_ticket_number#1912L, 200)\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           :     +- *(1) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           :        +- *(1) Filter (((((((isnotnull(ss_item_sk#1905) && isnotnull(ss_ticket_number#1912L)) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_customer_sk#1906)) && isnotnull(ss_cdemo_sk#1907)) && isnotnull(ss_promo_sk#1911)) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_addr_sk#1909))\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           :           +- *(1) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_wholesale_cost#1914,ss_list_price#1915,ss_coupon_amt#1922,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_ticket_number), IsNotNull(ss_store_sk), IsNotNull(ss_custome..., ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_cdemo_sk:int,ss_hdemo_sk:int,ss_addr_sk:int,ss_store_...\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- *(4) Sort [sr_item_sk#1705 ASC NULLS FIRST, sr_ticket_number#1712L ASC NULLS FIRST], false, 0\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :              +- Exchange hashpartitioning(sr_item_sk#1705, sr_ticket_number#1712L, 200)\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                 +- *(3) Project [sr_item_sk#1705, sr_ticket_number#1712L]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    +- *(3) Filter (isnotnull(sr_ticket_number#1712L) && isnotnull(sr_item_sk#1705))\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                       +- *(3) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_ticket_number#1712L,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns], PartitionCount: 2002, PartitionFilters: [], PushedFilters: [IsNotNull(sr_ticket_number), IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint>\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- *(12) Sort [cs_item_sk#1803 ASC NULLS FIRST], false, 0\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- *(12) Project [cs_item_sk#1803]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- *(12) Filter (isnotnull(sum(cs_ext_list_price#1813)#31763) && (cast(sum(cs_ext_list_price#1813)#31763 as decimal(21,2)) > CheckOverflow((2.00 * promote_precision(sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))#31764)), DecimalType(21,2))))\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :              +- *(12) HashAggregate(keys=[cs_item_sk#1803], functions=[sum(UnscaledValue(cs_ext_list_price#1813)), sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))], output=[cs_item_sk#1803, sum(cs_ext_list_price#1813)#31763, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))#31764])\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                 +- Exchange hashpartitioning(cs_item_sk#1803, 200)\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                    +- *(11) HashAggregate(keys=[cs_item_sk#1803], functions=[partial_sum(UnscaledValue(cs_ext_list_price#1813)), partial_sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))], output=[cs_item_sk#1803, sum#31916L, sum#31917])\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                       +- *(11) Project [cs_item_sk#1803, cs_ext_list_price#1813, cr_refunded_cash#2108, cr_reversed_charge#2109, cr_store_credit#2110]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                          +- *(11) SortMergeJoin [cs_item_sk#1803, cs_order_number#1805L], [cr_item_sk#2087, cr_order_number#2101L], Inner\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                             :- *(8) Sort [cs_item_sk#1803 ASC NULLS FIRST, cs_order_number#1805L ASC NULLS FIRST], false, 0\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                             :  +- Exchange hashpartitioning(cs_item_sk#1803, cs_order_number#1805L, 200)\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                             :     +- *(7) Project [cs_item_sk#1803, cs_order_number#1805L, cs_ext_list_price#1813]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                             :        +- *(7) Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_order_number#1805L))\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                             :           +- *(7) FileScan parquet db_tpcds.catalog_sales[cs_item_sk#1803,cs_order_number#1805L,cs_ext_list_price#1813,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales], PartitionCount: 1831, PartitionFilters: [], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_order_number)], ReadSchema: struct<cs_item_sk:int,cs_order_number:bigint,cs_ext_list_price:decimal(7,2)>\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                             +- *(10) Sort [cr_item_sk#2087 ASC NULLS FIRST, cr_order_number#2101L ASC NULLS FIRST], false, 0\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                                +- Exchange hashpartitioning(cr_item_sk#2087, cr_order_number#2101L, 200)\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                                   +- *(9) Project [cr_item_sk#2087, cr_order_number#2101L, cr_refunded_cash#2108, cr_reversed_charge#2109, cr_store_credit#2110]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                                      +- *(9) Filter (isnotnull(cr_item_sk#2087) && isnotnull(cr_order_number#2101L))\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                                         +- *(9) FileScan parquet db_tpcds.catalog_returns[cr_item_sk#2087,cr_order_number#2101L,cr_refunded_cash#2108,cr_reversed_charge#2109,cr_store_credit#2110,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns], PartitionCount: 2066, PartitionFilters: [], PushedFilters: [IsNotNull(cr_item_sk), IsNotNull(cr_order_number)], ReadSchema: struct<cr_item_sk:int,cr_order_number:bigint,cr_refunded_cash:decimal(7,2),cr_reversed_charge:dec...\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- *(13) Project [d_date_sk#1040, d_year#1046]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- *(13) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 1999)) && isnotnull(d_date_sk#1040))\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     :              +- *(13) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :        +- *(14) Project [s_store_sk#1386, s_store_name#1391, s_zip#1411]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :           +- *(14) Filter ((isnotnull(s_store_sk#1386) && isnotnull(s_store_name#1391)) && isnotnull(s_zip#1411))\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     :              +- *(14) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_name#1391,s_zip#1411] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_zip)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_zip:string>\n         :                    :     :     :     :     :     :     :     :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :     :     :     :     :     :     :     :     :     :     :        +- *(15) Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866]\n         :                    :     :     :     :     :     :     :     :     :     :     :     :           +- *(15) Filter (((((isnotnull(c_customer_sk#860) && isnotnull(c_first_sales_date_sk#866)) && isnotnull(c_first_shipto_date_sk#865)) && isnotnull(c_current_cdemo_sk#862)) && isnotnull(c_current_hdemo_sk#863)) && isnotnull(c_current_addr_sk#864))\n         :                    :     :     :     :     :     :     :     :     :     :     :     :              +- *(15) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_first_sales_date_sk), IsNotNull(c_first_shipto_date_sk), I..., ReadSchema: struct<c_customer_sk:int,c_current_cdemo_sk:int,c_current_hdemo_sk:int,c_current_addr_sk:int,c_fi...\n         :                    :     :     :     :     :     :     :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :     :     :     :     :     :     :     :     :     :        +- *(16) Project [d_date_sk#31769, d_year#31775]\n         :                    :     :     :     :     :     :     :     :     :     :     :           +- *(16) Filter isnotnull(d_date_sk#31769)\n         :                    :     :     :     :     :     :     :     :     :     :     :              +- *(16) FileScan parquet db_tpcds.date_dim[d_date_sk#31769,d_year#31775] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n         :                    :     :     :     :     :     :     :     :     :     :     +- ReusedExchange [d_date_sk#31797, d_year#31803], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :     :     :     :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :     :     :     :     :     :     :     :        +- *(18) Project [cd_demo_sk#966, cd_marital_status#968]\n         :                    :     :     :     :     :     :     :     :     :           +- *(18) Filter (isnotnull(cd_demo_sk#966) && isnotnull(cd_marital_status#968))\n         :                    :     :     :     :     :     :     :     :     :              +- *(18) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_marital_status#968] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk), IsNotNull(cd_marital_status)], ReadSchema: struct<cd_demo_sk:int,cd_marital_status:string>\n         :                    :     :     :     :     :     :     :     :     +- ReusedExchange [cd_demo_sk#31825, cd_marital_status#31827], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :     :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :     :     :     :     :     :        +- *(20) Project [p_promo_sk#1254]\n         :                    :     :     :     :     :     :     :           +- *(20) Filter isnotnull(p_promo_sk#1254)\n         :                    :     :     :     :     :     :     :              +- *(20) FileScan parquet db_tpcds.promotion[p_promo_sk#1254] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/promotion], PartitionFilters: [], PushedFilters: [IsNotNull(p_promo_sk)], ReadSchema: struct<p_promo_sk:int>\n         :                    :     :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :     :     :     :     :        +- *(21) Project [hd_demo_sk#1106, hd_income_band_sk#1107]\n         :                    :     :     :     :     :     :           +- *(21) Filter (isnotnull(hd_demo_sk#1106) && isnotnull(hd_income_band_sk#1107))\n         :                    :     :     :     :     :     :              +- *(21) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_income_band_sk#1107] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(hd_demo_sk), IsNotNull(hd_income_band_sk)], ReadSchema: struct<hd_demo_sk:int,hd_income_band_sk:int>\n         :                    :     :     :     :     :     +- ReusedExchange [hd_demo_sk#31834, hd_income_band_sk#31835], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :     :     :        +- *(23) Project [ca_address_sk#922, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931]\n         :                    :     :     :     :           +- *(23) Filter isnotnull(ca_address_sk#922)\n         :                    :     :     :     :              +- *(23) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_street_number#924,ca_street_name#925,ca_city#928,ca_zip#931] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_street_number:string,ca_street_name:string,ca_city:string,ca_zip:string>\n         :                    :     :     :     +- ReusedExchange [ca_address_sk#31839, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    :     :        +- *(25) Project [ib_income_band_sk#1122]\n         :                    :     :           +- *(25) Filter isnotnull(ib_income_band_sk#1122)\n         :                    :     :              +- *(25) FileScan parquet db_tpcds.income_band[ib_income_band_sk#1122] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/income_band], PartitionFilters: [], PushedFilters: [IsNotNull(ib_income_band_sk)], ReadSchema: struct<ib_income_band_sk:int>\n         :                    :     +- ReusedExchange [ib_income_band_sk#31852], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                       +- *(27) Project [i_item_sk#1172, i_product_name#1193]\n         :                          +- *(27) Filter ((((((isnotnull(i_current_price#1177) && i_color#1189 IN (purple,burlywood,indian,spring,floral,medium)) && (i_current_price#1177 >= 64.00)) && (cast(i_current_price#1177 as decimal(12,2)) <= 74.00)) && (cast(i_current_price#1177 as decimal(12,2)) >= 65.00)) && (cast(i_current_price#1177 as decimal(12,2)) <= 79.00)) && isnotnull(i_item_sk#1172))\n         :                             +- *(27) FileScan parquet db_tpcds.item[i_item_sk#1172,i_current_price#1177,i_color#1189,i_product_name#1193] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), In(i_color, [purple,burlywood,indian,spring,floral,medium]), Greater..., ReadSchema: struct<i_item_sk:int,i_current_price:decimal(7,2),i_color:string,i_product_name:string>\n         +- *(60) Sort [item_sk#31863 ASC NULLS FIRST, store_name#31864 ASC NULLS FIRST, store_zip#31865 ASC NULLS FIRST], false, 0\n            +- Exchange hashpartitioning(item_sk#31863, store_name#31864, store_zip#31865, 200)\n               +- *(59) HashAggregate(keys=[i_product_name#1193, i_item_sk#1172, s_store_name#1391, s_zip#1411, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, d_year#1046, d_year#31775, d_year#31803], functions=[count(1), sum(UnscaledValue(ss_wholesale_cost#1914)), sum(UnscaledValue(ss_list_price#1915)), sum(UnscaledValue(ss_coupon_amt#1922))], output=[item_sk#31863, store_name#31864, store_zip#31865, syear#31874, cnt#31877L, s1#31878, s2#31879, s3#31880])\n                  +- Exchange hashpartitioning(i_product_name#1193, i_item_sk#1172, s_store_name#1391, s_zip#1411, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, d_year#1046, d_year#31775, d_year#31803, 200)\n                     +- *(58) HashAggregate(keys=[i_product_name#1193, i_item_sk#1172, s_store_name#1391, s_zip#1411, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, d_year#1046, d_year#31775, d_year#31803], functions=[partial_count(1), partial_sum(UnscaledValue(ss_wholesale_cost#1914)), partial_sum(UnscaledValue(ss_list_price#1915)), partial_sum(UnscaledValue(ss_coupon_amt#1922))], output=[i_product_name#1193, i_item_sk#1172, s_store_name#1391, s_zip#1411, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, d_year#1046, d_year#31775, d_year#31803, count#31910L, sum#31921L, sum#31922L, sum#31923L])\n                        +- *(58) Project [ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848, i_item_sk#1172, i_product_name#1193]\n                           +- *(58) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n                              :- *(58) Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n                              :  +- *(58) BroadcastHashJoin [hd_income_band_sk#31835], [ib_income_band_sk#31852], Inner, BuildRight\n                              :     :- *(58) Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, hd_income_band_sk#31835, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n                              :     :  +- *(58) BroadcastHashJoin [hd_income_band_sk#1107], [ib_income_band_sk#1122], Inner, BuildRight\n                              :     :     :- *(58) Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, d_year#31775, d_year#31803, hd_income_band_sk#1107, hd_income_band_sk#31835, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848]\n                              :     :     :  +- *(58) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#31839], Inner, BuildRight\n                              :     :     :     :- *(58) Project [ss_item_sk#1905, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_addr_sk#864, d_year#31775, d_year#31803, hd_income_band_sk#1107, hd_income_band_sk#31835, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931]\n                              :     :     :     :  +- *(58) BroadcastHashJoin [ss_addr_sk#1909], [ca_address_sk#922], Inner, BuildRight\n                              :     :     :     :     :- *(58) Project [ss_item_sk#1905, ss_addr_sk#1909, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_addr_sk#864, d_year#31775, d_year#31803, hd_income_band_sk#1107, hd_income_band_sk#31835]\n                              :     :     :     :     :  +- *(58) BroadcastHashJoin [c_current_hdemo_sk#863], [hd_demo_sk#31834], Inner, BuildRight\n                              :     :     :     :     :     :- *(58) Project [ss_item_sk#1905, ss_addr_sk#1909, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803, hd_income_band_sk#1107]\n                              :     :     :     :     :     :  +- *(58) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n                              :     :     :     :     :     :     :- *(58) Project [ss_item_sk#1905, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803]\n                              :     :     :     :     :     :     :  +- *(58) BroadcastHashJoin [ss_promo_sk#1911], [p_promo_sk#1254], Inner, BuildRight\n                              :     :     :     :     :     :     :     :- *(58) Project [ss_item_sk#1905, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803]\n                              :     :     :     :     :     :     :     :  +- *(58) BroadcastHashJoin [c_current_cdemo_sk#862], [cd_demo_sk#31825], Inner, BuildRight, NOT (cd_marital_status#968 = cd_marital_status#31827)\n                              :     :     :     :     :     :     :     :     :- *(58) Project [ss_item_sk#1905, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803, cd_marital_status#968]\n                              :     :     :     :     :     :     :     :     :  +- *(58) BroadcastHashJoin [ss_cdemo_sk#1907], [cd_demo_sk#966], Inner, BuildRight\n                              :     :     :     :     :     :     :     :     :     :- *(58) Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, d_year#31775, d_year#31803]\n                              :     :     :     :     :     :     :     :     :     :  +- *(58) BroadcastHashJoin [c_first_shipto_date_sk#865], [d_date_sk#31797], Inner, BuildRight\n                              :     :     :     :     :     :     :     :     :     :     :- *(58) Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, d_year#31775]\n                              :     :     :     :     :     :     :     :     :     :     :  +- *(58) BroadcastHashJoin [c_first_sales_date_sk#866], [d_date_sk#31769], Inner, BuildRight\n                              :     :     :     :     :     :     :     :     :     :     :     :- *(58) Project [ss_item_sk#1905, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866]\n                              :     :     :     :     :     :     :     :     :     :     :     :  +- *(58) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n                              :     :     :     :     :     :     :     :     :     :     :     :     :- *(58) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046, s_store_name#1391, s_zip#1411]\n                              :     :     :     :     :     :     :     :     :     :     :     :     :  +- *(58) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :- *(58) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, d_year#1046]\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- *(58) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- *(58) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, ss_sold_date_sk#1926]\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- *(58) SortMergeJoin [ss_item_sk#1905], [cs_item_sk#1803], Inner\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :- *(36) Sort [ss_item_sk#1905 ASC NULLS FIRST], false, 0\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     :  +- ReusedExchange [ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_wholesale_cost#1914, ss_list_price#1915, ss_coupon_amt#1922, ss_sold_date_sk#1926], Exchange hashpartitioning(ss_item_sk#1905, 200)\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- *(42) Sort [cs_item_sk#1803 ASC NULLS FIRST], false, 0\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- *(42) Project [cs_item_sk#1803]\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- *(42) Filter (isnotnull(sum(cs_ext_list_price#1813)#31763) && (cast(sum(cs_ext_list_price#1813)#31763 as decimal(21,2)) > CheckOverflow((2.00 * promote_precision(sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))#31764)), DecimalType(21,2))))\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :     :              +- *(42) HashAggregate(keys=[cs_item_sk#1803], functions=[sum(UnscaledValue(cs_ext_list_price#1813)), sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))], output=[cs_item_sk#1803, sum(cs_ext_list_price#1813)#31763, sum(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cr_refunded_cash#2108 as decimal(8,2))) + promote_precision(cast(cr_reversed_charge#2109 as decimal(8,2)))), DecimalType(8,2)) as decimal(9,2))) + promote_precision(cast(cr_store_credit#2110 as decimal(9,2)))), DecimalType(9,2)))#31764])\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :     :                 +- ReusedExchange [cs_item_sk#1803, sum#31925L, sum#31917], Exchange hashpartitioning(cs_item_sk#1803, 200)\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :        +- *(43) Project [d_date_sk#1040, d_year#1046]\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :           +- *(43) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     :              +- *(43) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n                              :     :     :     :     :     :     :     :     :     :     :     :     :     +- ReusedExchange [s_store_sk#1386, s_store_name#1391, s_zip#1411], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :     :     :     :     :     :     :     :     :     :     +- ReusedExchange [c_customer_sk#860, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864, c_first_shipto_date_sk#865, c_first_sales_date_sk#866], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :     :     :     :     :     :     :     :     :     +- ReusedExchange [d_date_sk#31769, d_year#31775], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :     :     :     :     :     :     :     :     +- ReusedExchange [d_date_sk#31797, d_year#31803], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :     :     :     :     :     :     :     +- ReusedExchange [cd_demo_sk#966, cd_marital_status#968], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :     :     :     :     :     :     +- ReusedExchange [cd_demo_sk#31825, cd_marital_status#31827], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :     :     :     :     :     +- ReusedExchange [p_promo_sk#1254], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :     :     :     :     +- ReusedExchange [hd_demo_sk#1106, hd_income_band_sk#1107], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :     :     :     +- ReusedExchange [hd_demo_sk#31834, hd_income_band_sk#31835], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :     :     +- ReusedExchange [ca_address_sk#922, ca_street_number#924, ca_street_name#925, ca_city#928, ca_zip#931], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :     +- ReusedExchange [ca_address_sk#31839, ca_street_number#31841, ca_street_name#31842, ca_city#31845, ca_zip#31848], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     +- ReusedExchange [ib_income_band_sk#1122], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     +- ReusedExchange [ib_income_band_sk#31852], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              +- ReusedExchange [i_item_sk#1172, i_product_name#1193], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q65-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store","item","store_sales","date_dim","store_sales","date_dim"],"parsingTime":0.002467,"analysisTime":0.001408,"optimizationTime":455.99862,"planningTime":31.588901,"executionTime":7602.926835,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['s_store_name ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST], true\n      +- 'Project ['s_store_name, 'i_item_desc, 'sc.revenue, 'i_current_price, 'i_wholesale_cost, 'i_brand]\n         +- 'Filter ((('sb.ss_store_sk = 'sc.ss_store_sk) && ('sc.revenue <= (0.1 * 'sb.ave))) && (('s_store_sk = 'sc.ss_store_sk) && ('i_item_sk = 'sc.ss_item_sk)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'UnresolvedRelation `store`\n               :  :  +- 'UnresolvedRelation `item`\n               :  +- 'SubqueryAlias sb\n               :     +- 'Aggregate ['ss_store_sk], ['ss_store_sk, 'avg('revenue) AS ave#32156]\n               :        +- 'SubqueryAlias sa\n               :           +- 'Aggregate ['ss_store_sk, 'ss_item_sk], ['ss_store_sk, 'ss_item_sk, 'sum('ss_sales_price) AS revenue#32155]\n               :              +- 'Filter (('ss_sold_date_sk = 'd_date_sk) && (('d_month_seq >= 1176) && ('d_month_seq <= (1176 + 11))))\n               :                 +- 'Join Inner\n               :                    :- 'UnresolvedRelation `store_sales`\n               :                    +- 'UnresolvedRelation `date_dim`\n               +- 'SubqueryAlias sc\n                  +- 'Aggregate ['ss_store_sk, 'ss_item_sk], ['ss_store_sk, 'ss_item_sk, 'sum('ss_sales_price) AS revenue#32157]\n                     +- 'Filter (('ss_sold_date_sk = 'd_date_sk) && (('d_month_seq >= 1176) && ('d_month_seq <= (1176 + 11))))\n                        +- 'Join Inner\n                           :- 'UnresolvedRelation `store_sales`\n                           +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\ns_store_name: string, i_item_desc: string, revenue: decimal(17,2), i_current_price: decimal(7,2), i_wholesale_cost: decimal(7,2), i_brand: string\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [s_store_name#1391 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST], true\n      +- Project [s_store_name#1391, i_item_desc#1176, revenue#32157, i_current_price#1177, i_wholesale_cost#1178, i_brand#1180]\n         +- Filter (((ss_store_sk#1910 = ss_store_sk#32167) && (cast(revenue#32157 as decimal(23,7)) <= cast(CheckOverflow((promote_precision(cast(0.1 as decimal(21,6))) * promote_precision(cast(ave#32156 as decimal(21,6)))), DecimalType(23,7)) as decimal(23,7)))) && ((s_store_sk#1386 = ss_store_sk#32167) && (i_item_sk#1172 = ss_item_sk#32162)))\n            +- Join Inner\n               :- Join Inner\n               :  :- Join Inner\n               :  :  :- SubqueryAlias store\n               :  :  :  +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               :  :  +- SubqueryAlias item\n               :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  +- SubqueryAlias sb\n               :     +- Aggregate [ss_store_sk#1910], [ss_store_sk#1910, avg(revenue#32155) AS ave#32156]\n               :        +- SubqueryAlias sa\n               :           +- Aggregate [ss_store_sk#1910, ss_item_sk#1905], [ss_store_sk#1910, ss_item_sk#1905, sum(ss_sales_price#1916) AS revenue#32155]\n               :              +- Filter ((ss_sold_date_sk#1926 = d_date_sk#1040) && ((d_month_seq#1043 >= 1176) && (d_month_seq#1043 <= (1176 + 11))))\n               :                 +- Join Inner\n               :                    :- SubqueryAlias store_sales\n               :                    :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :                    +- SubqueryAlias date_dim\n               :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- SubqueryAlias sc\n                  +- Aggregate [ss_store_sk#32167, ss_item_sk#32162], [ss_store_sk#32167, ss_item_sk#32162, sum(ss_sales_price#32173) AS revenue#32157]\n                     +- Filter ((ss_sold_date_sk#32183 = d_date_sk#1040) && ((d_month_seq#1043 >= 1176) && (d_month_seq#1043 <= (1176 + 11))))\n                        +- Join Inner\n                           :- SubqueryAlias store_sales\n                           :  +- Relation[ss_sold_time_sk#32161,ss_item_sk#32162,ss_customer_sk#32163,ss_cdemo_sk#32164,ss_hdemo_sk#32165,ss_addr_sk#32166,ss_store_sk#32167,ss_promo_sk#32168,ss_ticket_number#32169L,ss_quantity#32170,ss_wholesale_cost#32171,ss_list_price#32172,ss_sales_price#32173,ss_ext_discount_amt#32174,ss_ext_sales_price#32175,ss_ext_wholesale_cost#32176,ss_ext_list_price#32177,ss_ext_tax#32178,ss_coupon_amt#32179,ss_net_paid#32180,ss_net_paid_inc_tax#32181,ss_net_profit#32182,ss_sold_date_sk#32183] parquet\n                           +- SubqueryAlias date_dim\n                              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [s_store_name#1391 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST], true\n      +- Project [s_store_name#1391, i_item_desc#1176, revenue#32157, i_current_price#1177, i_wholesale_cost#1178, i_brand#1180]\n         +- Join Inner, ((ss_store_sk#1910 = ss_store_sk#32167) && (cast(revenue#32157 as decimal(23,7)) <= CheckOverflow((0.100000 * promote_precision(ave#32156)), DecimalType(23,7))))\n            :- Project [s_store_name#1391, ss_store_sk#32167, revenue#32157, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand#1180]\n            :  +- Join Inner, (i_item_sk#1172 = ss_item_sk#32162)\n            :     :- Project [s_store_name#1391, ss_store_sk#32167, ss_item_sk#32162, revenue#32157]\n            :     :  +- Join Inner, (s_store_sk#1386 = ss_store_sk#32167)\n            :     :     :- Project [s_store_sk#1386, s_store_name#1391]\n            :     :     :  +- Filter isnotnull(s_store_sk#1386)\n            :     :     :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n            :     :     +- Filter isnotnull(revenue#32157)\n            :     :        +- Aggregate [ss_store_sk#32167, ss_item_sk#32162], [ss_store_sk#32167, ss_item_sk#32162, MakeDecimal(sum(UnscaledValue(ss_sales_price#32173)),17,2) AS revenue#32157]\n            :     :           +- Project [ss_item_sk#32162, ss_store_sk#32167, ss_sales_price#32173]\n            :     :              +- Join Inner, (ss_sold_date_sk#32183 = d_date_sk#1040)\n            :     :                 :- Project [ss_item_sk#32162, ss_store_sk#32167, ss_sales_price#32173, ss_sold_date_sk#32183]\n            :     :                 :  +- Filter ((isnotnull(ss_sold_date_sk#32183) && isnotnull(ss_store_sk#32167)) && isnotnull(ss_item_sk#32162))\n            :     :                 :     +- Relation[ss_sold_time_sk#32161,ss_item_sk#32162,ss_customer_sk#32163,ss_cdemo_sk#32164,ss_hdemo_sk#32165,ss_addr_sk#32166,ss_store_sk#32167,ss_promo_sk#32168,ss_ticket_number#32169L,ss_quantity#32170,ss_wholesale_cost#32171,ss_list_price#32172,ss_sales_price#32173,ss_ext_discount_amt#32174,ss_ext_sales_price#32175,ss_ext_wholesale_cost#32176,ss_ext_list_price#32177,ss_ext_tax#32178,ss_coupon_amt#32179,ss_net_paid#32180,ss_net_paid_inc_tax#32181,ss_net_profit#32182,ss_sold_date_sk#32183] parquet\n            :     :                 +- Project [d_date_sk#1040]\n            :     :                    +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1176)) && (d_month_seq#1043 <= 1187)) && isnotnull(d_date_sk#1040))\n            :     :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     +- Project [i_item_sk#1172, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand#1180]\n            :        +- Filter isnotnull(i_item_sk#1172)\n            :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            +- Aggregate [ss_store_sk#1910], [ss_store_sk#1910, avg(revenue#32155) AS ave#32156]\n               +- Aggregate [ss_store_sk#1910, ss_item_sk#1905], [ss_store_sk#1910, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS revenue#32155]\n                  +- Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916]\n                     +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                        :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                        :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910))\n                        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        +- Project [d_date_sk#1040]\n                           +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1176)) && (d_month_seq#1043 <= 1187)) && isnotnull(d_date_sk#1040))\n                              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[s_store_name#1391 ASC NULLS FIRST,i_item_desc#1176 ASC NULLS FIRST], output=[s_store_name#1391,i_item_desc#1176,revenue#32157,i_current_price#1177,i_wholesale_cost#1178,i_brand#1180])\n+- *(11) Project [s_store_name#1391, i_item_desc#1176, revenue#32157, i_current_price#1177, i_wholesale_cost#1178, i_brand#1180]\n   +- *(11) SortMergeJoin [ss_store_sk#32167], [ss_store_sk#1910], Inner, (cast(revenue#32157 as decimal(23,7)) <= CheckOverflow((0.100000 * promote_precision(ave#32156)), DecimalType(23,7)))\n      :- *(6) Sort [ss_store_sk#32167 ASC NULLS FIRST], false, 0\n      :  +- Exchange hashpartitioning(ss_store_sk#32167, 200)\n      :     +- *(5) Project [s_store_name#1391, ss_store_sk#32167, revenue#32157, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand#1180]\n      :        +- *(5) BroadcastHashJoin [ss_item_sk#32162], [i_item_sk#1172], Inner, BuildRight\n      :           :- *(5) Project [s_store_name#1391, ss_store_sk#32167, ss_item_sk#32162, revenue#32157]\n      :           :  +- *(5) BroadcastHashJoin [s_store_sk#1386], [ss_store_sk#32167], Inner, BuildLeft\n      :           :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :           :     :  +- *(1) Project [s_store_sk#1386, s_store_name#1391]\n      :           :     :     +- *(1) Filter isnotnull(s_store_sk#1386)\n      :           :     :        +- *(1) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_name#1391] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_store_name:string>\n      :           :     +- *(5) Filter isnotnull(revenue#32157)\n      :           :        +- *(5) HashAggregate(keys=[ss_store_sk#32167, ss_item_sk#32162], functions=[sum(UnscaledValue(ss_sales_price#32173))], output=[ss_store_sk#32167, ss_item_sk#32162, revenue#32157])\n      :           :           +- Exchange hashpartitioning(ss_store_sk#32167, ss_item_sk#32162, 200)\n      :           :              +- *(3) HashAggregate(keys=[ss_store_sk#32167, ss_item_sk#32162], functions=[partial_sum(UnscaledValue(ss_sales_price#32173))], output=[ss_store_sk#32167, ss_item_sk#32162, sum#32191L])\n      :           :                 +- *(3) Project [ss_item_sk#32162, ss_store_sk#32167, ss_sales_price#32173]\n      :           :                    +- *(3) BroadcastHashJoin [ss_sold_date_sk#32183], [d_date_sk#1040], Inner, BuildRight\n      :           :                       :- *(3) Project [ss_item_sk#32162, ss_store_sk#32167, ss_sales_price#32173, ss_sold_date_sk#32183]\n      :           :                       :  +- *(3) Filter (isnotnull(ss_store_sk#32167) && isnotnull(ss_item_sk#32162))\n      :           :                       :     +- *(3) FileScan parquet db_tpcds.store_sales[ss_item_sk#32162,ss_store_sk#32167,ss_sales_price#32173,ss_sold_date_sk#32183] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#32183)], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>\n      :           :                       +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :           :                          +- *(2) Project [d_date_sk#1040]\n      :           :                             +- *(2) Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1176)) && (d_month_seq#1043 <= 1187)) && isnotnull(d_date_sk#1040))\n      :           :                                +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_month_seq#1043] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1176), LessThanOrEqual(d_month_seq,1187),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>\n      :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :              +- *(4) Project [i_item_sk#1172, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand#1180]\n      :                 +- *(4) Filter isnotnull(i_item_sk#1172)\n      :                    +- *(4) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand#1180] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_desc:string,i_current_price:decimal(7,2),i_wholesale_cost:decimal(7,2...\n      +- *(10) Sort [ss_store_sk#1910 ASC NULLS FIRST], false, 0\n         +- *(10) HashAggregate(keys=[ss_store_sk#1910], functions=[avg(revenue#32155)], output=[ss_store_sk#1910, ave#32156])\n            +- Exchange hashpartitioning(ss_store_sk#1910, 200)\n               +- *(9) HashAggregate(keys=[ss_store_sk#1910], functions=[partial_avg(revenue#32155)], output=[ss_store_sk#1910, sum#32194, count#32195L])\n                  +- *(9) HashAggregate(keys=[ss_store_sk#1910, ss_item_sk#1905], functions=[sum(UnscaledValue(ss_sales_price#1916))], output=[ss_store_sk#1910, revenue#32155])\n                     +- Exchange hashpartitioning(ss_store_sk#1910, ss_item_sk#1905, 200)\n                        +- *(8) HashAggregate(keys=[ss_store_sk#1910, ss_item_sk#1905], functions=[partial_sum(UnscaledValue(ss_sales_price#1916))], output=[ss_store_sk#1910, ss_item_sk#1905, sum#32197L])\n                           +- *(8) Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916]\n                              +- *(8) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                                 :- *(8) Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                                 :  +- *(8) Filter isnotnull(ss_store_sk#1910)\n                                 :     +- *(8) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_store_sk#1910,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>\n                                 +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q66-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["web_sales","warehouse","date_dim","time_dim","ship_mode","catalog_sales","warehouse","date_dim","time_dim","ship_mode"],"parsingTime":0.002299,"analysisTime":0.001058,"optimizationTime":659.85563,"planningTime":56.322478,"executionTime":8543.460237,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['w_warehouse_name ASC NULLS FIRST], true\n      +- 'Aggregate ['w_warehouse_name, 'w_warehouse_sq_ft, 'w_city, 'w_county, 'w_state, 'w_country, 'ship_carriers, 'year], ['w_warehouse_name, 'w_warehouse_sq_ft, 'w_city, 'w_county, 'w_state, 'w_country, 'ship_carriers, 'year, 'sum('jan_sales) AS jan_sales#32721, 'sum('feb_sales) AS feb_sales#32722, 'sum('mar_sales) AS mar_sales#32723, 'sum('apr_sales) AS apr_sales#32724, 'sum('may_sales) AS may_sales#32725, 'sum('jun_sales) AS jun_sales#32726, 'sum('jul_sales) AS jul_sales#32727, 'sum('aug_sales) AS aug_sales#32728, 'sum('sep_sales) AS sep_sales#32729, 'sum('oct_sales) AS oct_sales#32730, 'sum('nov_sales) AS nov_sales#32731, 'sum('dec_sales) AS dec_sales#32732, 'sum(('jan_sales / 'w_warehouse_sq_ft)) AS jan_sales_per_sq_foot#32733, 'sum(('feb_sales / 'w_warehouse_sq_ft)) AS feb_sales_per_sq_foot#32734, 'sum(('mar_sales / 'w_warehouse_sq_ft)) AS mar_sales_per_sq_foot#32735, 'sum(('apr_sales / 'w_warehouse_sq_ft)) AS apr_sales_per_sq_foot#32736, ... 20 more fields]\n         +- 'SubqueryAlias x\n            +- 'Union\n               :- 'Aggregate ['w_warehouse_name, 'w_warehouse_sq_ft, 'w_city, 'w_county, 'w_state, 'w_country, 'd_year], ['w_warehouse_name, 'w_warehouse_sq_ft, 'w_city, 'w_county, 'w_state, 'w_country, 'concat(DHL, ,, BARIAN) AS ship_carriers#32669, 'd_year AS year#32670, 'sum(CASE WHEN ('d_moy = 1) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS jan_sales#32671, 'sum(CASE WHEN ('d_moy = 2) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS feb_sales#32672, 'sum(CASE WHEN ('d_moy = 3) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS mar_sales#32673, 'sum(CASE WHEN ('d_moy = 4) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS apr_sales#32674, 'sum(CASE WHEN ('d_moy = 5) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS may_sales#32675, 'sum(CASE WHEN ('d_moy = 6) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS jun_sales#32676, 'sum(CASE WHEN ('d_moy = 7) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS jul_sales#32677, 'sum(CASE WHEN ('d_moy = 8) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS aug_sales#32678, 'sum(CASE WHEN ('d_moy = 9) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS sep_sales#32679, 'sum(CASE WHEN ('d_moy = 10) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS oct_sales#32680, 'sum(CASE WHEN ('d_moy = 11) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS nov_sales#32681, 'sum(CASE WHEN ('d_moy = 12) THEN ('ws_ext_sales_price * 'ws_quantity) ELSE 0 END) AS dec_sales#32682, 'sum(CASE WHEN ('d_moy = 1) THEN ('ws_net_paid * 'ws_quantity) ELSE 0 END) AS jan_net#32683, 'sum(CASE WHEN ('d_moy = 2) THEN ('ws_net_paid * 'ws_quantity) ELSE 0 END) AS feb_net#32684, 'sum(CASE WHEN ('d_moy = 3) THEN ('ws_net_paid * 'ws_quantity) ELSE 0 END) AS mar_net#32685, 'sum(CASE WHEN ('d_moy = 4) THEN ('ws_net_paid * 'ws_quantity) ELSE 0 END) AS apr_net#32686, ... 8 more fields]\n               :  +- 'Filter (((('ws_warehouse_sk = 'w_warehouse_sk) && ('ws_sold_date_sk = 'd_date_sk)) && (('ws_sold_time_sk = 't_time_sk) && ('ws_ship_mode_sk = 'sm_ship_mode_sk))) && ((('d_year = 2001) && (('t_time >= 30838) && ('t_time <= (30838 + 28800)))) && 'sm_carrier IN (DHL,BARIAN)))\n               :     +- 'Join Inner\n               :        :- 'Join Inner\n               :        :  :- 'Join Inner\n               :        :  :  :- 'Join Inner\n               :        :  :  :  :- 'UnresolvedRelation `web_sales`\n               :        :  :  :  +- 'UnresolvedRelation `warehouse`\n               :        :  :  +- 'UnresolvedRelation `date_dim`\n               :        :  +- 'UnresolvedRelation `time_dim`\n               :        +- 'UnresolvedRelation `ship_mode`\n               +- 'Aggregate ['w_warehouse_name, 'w_warehouse_sq_ft, 'w_city, 'w_county, 'w_state, 'w_country, 'd_year], ['w_warehouse_name, 'w_warehouse_sq_ft, 'w_city, 'w_county, 'w_state, 'w_country, 'concat(DHL, ,, BARIAN) AS ship_carriers#32695, 'd_year AS year#32696, 'sum(CASE WHEN ('d_moy = 1) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS jan_sales#32697, 'sum(CASE WHEN ('d_moy = 2) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS feb_sales#32698, 'sum(CASE WHEN ('d_moy = 3) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS mar_sales#32699, 'sum(CASE WHEN ('d_moy = 4) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS apr_sales#32700, 'sum(CASE WHEN ('d_moy = 5) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS may_sales#32701, 'sum(CASE WHEN ('d_moy = 6) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS jun_sales#32702, 'sum(CASE WHEN ('d_moy = 7) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS jul_sales#32703, 'sum(CASE WHEN ('d_moy = 8) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS aug_sales#32704, 'sum(CASE WHEN ('d_moy = 9) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS sep_sales#32705, 'sum(CASE WHEN ('d_moy = 10) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS oct_sales#32706, 'sum(CASE WHEN ('d_moy = 11) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS nov_sales#32707, 'sum(CASE WHEN ('d_moy = 12) THEN ('cs_sales_price * 'cs_quantity) ELSE 0 END) AS dec_sales#32708, 'sum(CASE WHEN ('d_moy = 1) THEN ('cs_net_paid_inc_tax * 'cs_quantity) ELSE 0 END) AS jan_net#32709, 'sum(CASE WHEN ('d_moy = 2) THEN ('cs_net_paid_inc_tax * 'cs_quantity) ELSE 0 END) AS feb_net#32710, 'sum(CASE WHEN ('d_moy = 3) THEN ('cs_net_paid_inc_tax * 'cs_quantity) ELSE 0 END) AS mar_net#32711, 'sum(CASE WHEN ('d_moy = 4) THEN ('cs_net_paid_inc_tax * 'cs_quantity) ELSE 0 END) AS apr_net#32712, ... 8 more fields]\n                  +- 'Filter (((('cs_warehouse_sk = 'w_warehouse_sk) && ('cs_sold_date_sk = 'd_date_sk)) && (('cs_sold_time_sk = 't_time_sk) && ('cs_ship_mode_sk = 'sm_ship_mode_sk))) && ((('d_year = 2001) && (('t_time >= 30838) && ('t_time <= (30838 + 28800)))) && 'sm_carrier IN (DHL,BARIAN)))\n                     +- 'Join Inner\n                        :- 'Join Inner\n                        :  :- 'Join Inner\n                        :  :  :- 'Join Inner\n                        :  :  :  :- 'UnresolvedRelation `catalog_sales`\n                        :  :  :  +- 'UnresolvedRelation `warehouse`\n                        :  :  +- 'UnresolvedRelation `date_dim`\n                        :  +- 'UnresolvedRelation `time_dim`\n                        +- 'UnresolvedRelation `ship_mode`\n\n== Analyzed Logical Plan ==\nw_warehouse_name: string, w_warehouse_sq_ft: int, w_city: string, w_county: string, w_state: string, w_country: string, ship_carriers: string, year: int, jan_sales: decimal(38,2), feb_sales: decimal(38,2), mar_sales: decimal(38,2), apr_sales: decimal(38,2), may_sales: decimal(38,2), jun_sales: decimal(38,2), jul_sales: decimal(38,2), aug_sales: decimal(38,2), sep_sales: decimal(38,2), oct_sales: decimal(38,2), nov_sales: decimal(38,2), dec_sales: decimal(38,2), jan_sales_per_sq_foot: decimal(38,12), feb_sales_per_sq_foot: decimal(38,12), mar_sales_per_sq_foot: decimal(38,12), apr_sales_per_sq_foot: decimal(38,12), ... 20 more fields\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, ship_carriers#32669, year#32670, jan_sales#32721, feb_sales#32722, mar_sales#32723, apr_sales#32724, may_sales#32725, jun_sales#32726, jul_sales#32727, aug_sales#32728, sep_sales#32729, oct_sales#32730, nov_sales#32731, dec_sales#32732, jan_sales_per_sq_foot#32733, feb_sales_per_sq_foot#32734, mar_sales_per_sq_foot#32735, apr_sales_per_sq_foot#32736, ... 20 more fields]\n      +- Sort [w_warehouse_name#1514 ASC NULLS FIRST], true\n         +- Aggregate [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, ship_carriers#32669, year#32670], [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, ship_carriers#32669, year#32670, sum(jan_sales#32671) AS jan_sales#32721, sum(feb_sales#32672) AS feb_sales#32722, sum(mar_sales#32673) AS mar_sales#32723, sum(apr_sales#32674) AS apr_sales#32724, sum(may_sales#32675) AS may_sales#32725, sum(jun_sales#32676) AS jun_sales#32726, sum(jul_sales#32677) AS jul_sales#32727, sum(aug_sales#32678) AS aug_sales#32728, sum(sep_sales#32679) AS sep_sales#32729, sum(oct_sales#32680) AS oct_sales#32730, sum(nov_sales#32681) AS nov_sales#32731, sum(dec_sales#32682) AS dec_sales#32732, sum(CheckOverflow((promote_precision(cast(jan_sales#32671 as decimal(28,2))) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))) AS jan_sales_per_sq_foot#32733, sum(CheckOverflow((promote_precision(cast(feb_sales#32672 as decimal(28,2))) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))) AS feb_sales_per_sq_foot#32734, sum(CheckOverflow((promote_precision(cast(mar_sales#32673 as decimal(28,2))) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))) AS mar_sales_per_sq_foot#32735, sum(CheckOverflow((promote_precision(cast(apr_sales#32674 as decimal(28,2))) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))) AS apr_sales_per_sq_foot#32736, ... 20 more fields]\n            +- SubqueryAlias x\n               +- Union\n                  :- Aggregate [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046], [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, concat(DHL, ,, BARIAN) AS ship_carriers#32669, d_year#1046 AS year#32670, sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS jan_sales#32671, sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS feb_sales#32672, sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS mar_sales#32673, sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS apr_sales#32674, sum(CASE WHEN (d_moy#1048 = 5) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS may_sales#32675, sum(CASE WHEN (d_moy#1048 = 6) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS jun_sales#32676, sum(CASE WHEN (d_moy#1048 = 7) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS jul_sales#32677, sum(CASE WHEN (d_moy#1048 = 8) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS aug_sales#32678, sum(CASE WHEN (d_moy#1048 = 9) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS sep_sales#32679, sum(CASE WHEN (d_moy#1048 = 10) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS oct_sales#32680, sum(CASE WHEN (d_moy#1048 = 11) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS nov_sales#32681, sum(CASE WHEN (d_moy#1048 = 12) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS dec_sales#32682, sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS jan_net#32683, sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS feb_net#32684, sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS mar_net#32685, sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS apr_net#32686, ... 8 more fields]\n                  :  +- Filter ((((ws_warehouse_sk#1769 = w_warehouse_sk#1512) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && ((ws_sold_time_sk#1755 = t_time_sk#1464) && (ws_ship_mode_sk#1768 = sm_ship_mode_sk#1316))) && (((d_year#1046 = 2001) && ((t_time#1466 >= 30838) && (t_time#1466 <= (30838 + 28800)))) && sm_carrier#1320 IN (DHL,BARIAN)))\n                  :     +- Join Inner\n                  :        :- Join Inner\n                  :        :  :- Join Inner\n                  :        :  :  :- Join Inner\n                  :        :  :  :  :- SubqueryAlias web_sales\n                  :        :  :  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :        :  :  :  +- SubqueryAlias warehouse\n                  :        :  :  :     +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n                  :        :  :  +- SubqueryAlias date_dim\n                  :        :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :        :  +- SubqueryAlias time_dim\n                  :        :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n                  :        +- SubqueryAlias ship_mode\n                  :           +- Relation[sm_ship_mode_sk#1316,sm_ship_mode_id#1317,sm_type#1318,sm_code#1319,sm_carrier#1320,sm_contract#1321] parquet\n                  +- Aggregate [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046], [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, concat(DHL, ,, BARIAN) AS ship_carriers#32695, d_year#1046 AS year#32696, sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS jan_sales#32697, sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS feb_sales#32698, sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS mar_sales#32699, sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS apr_sales#32700, sum(CASE WHEN (d_moy#1048 = 5) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS may_sales#32701, sum(CASE WHEN (d_moy#1048 = 6) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS jun_sales#32702, sum(CASE WHEN (d_moy#1048 = 7) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS jul_sales#32703, sum(CASE WHEN (d_moy#1048 = 8) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS aug_sales#32704, sum(CASE WHEN (d_moy#1048 = 9) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS sep_sales#32705, sum(CASE WHEN (d_moy#1048 = 10) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS oct_sales#32706, sum(CASE WHEN (d_moy#1048 = 11) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS nov_sales#32707, sum(CASE WHEN (d_moy#1048 = 12) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS dec_sales#32708, sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS jan_net#32709, sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS feb_net#32710, sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS mar_net#32711, sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE cast(0 as decimal(18,2)) END) AS apr_net#32712, ... 8 more fields]\n                     +- Filter ((((cs_warehouse_sk#1802 = w_warehouse_sk#1512) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && ((cs_sold_time_sk#1789 = t_time_sk#1464) && (cs_ship_mode_sk#1801 = sm_ship_mode_sk#1316))) && (((d_year#1046 = 2001) && ((t_time#1466 >= 30838) && (t_time#1466 <= (30838 + 28800)))) && sm_carrier#1320 IN (DHL,BARIAN)))\n                        +- Join Inner\n                           :- Join Inner\n                           :  :- Join Inner\n                           :  :  :- Join Inner\n                           :  :  :  :- SubqueryAlias catalog_sales\n                           :  :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                           :  :  :  +- SubqueryAlias warehouse\n                           :  :  :     +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n                           :  :  +- SubqueryAlias date_dim\n                           :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                           :  +- SubqueryAlias time_dim\n                           :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n                           +- SubqueryAlias ship_mode\n                              +- Relation[sm_ship_mode_sk#1316,sm_ship_mode_id#1317,sm_type#1318,sm_code#1319,sm_carrier#1320,sm_contract#1321] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [w_warehouse_name#1514 ASC NULLS FIRST], true\n      +- Aggregate [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, ship_carriers#32669, year#32670], [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, ship_carriers#32669, year#32670, sum(jan_sales#32671) AS jan_sales#32721, sum(feb_sales#32672) AS feb_sales#32722, sum(mar_sales#32673) AS mar_sales#32723, sum(apr_sales#32674) AS apr_sales#32724, sum(may_sales#32675) AS may_sales#32725, sum(jun_sales#32676) AS jun_sales#32726, sum(jul_sales#32677) AS jul_sales#32727, sum(aug_sales#32678) AS aug_sales#32728, sum(sep_sales#32679) AS sep_sales#32729, sum(oct_sales#32680) AS oct_sales#32730, sum(nov_sales#32681) AS nov_sales#32731, sum(dec_sales#32682) AS dec_sales#32732, sum(CheckOverflow((promote_precision(jan_sales#32671) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))) AS jan_sales_per_sq_foot#32733, sum(CheckOverflow((promote_precision(feb_sales#32672) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))) AS feb_sales_per_sq_foot#32734, sum(CheckOverflow((promote_precision(mar_sales#32673) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))) AS mar_sales_per_sq_foot#32735, sum(CheckOverflow((promote_precision(apr_sales#32674) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))) AS apr_sales_per_sq_foot#32736, ... 20 more fields]\n         +- Union\n            :- Aggregate [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046], [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, DHL,BARIAN AS ship_carriers#32669, d_year#1046 AS year#32670, sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS jan_sales#32671, sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS feb_sales#32672, sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS mar_sales#32673, sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS apr_sales#32674, sum(CASE WHEN (d_moy#1048 = 5) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS may_sales#32675, sum(CASE WHEN (d_moy#1048 = 6) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS jun_sales#32676, sum(CASE WHEN (d_moy#1048 = 7) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS jul_sales#32677, sum(CASE WHEN (d_moy#1048 = 8) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS aug_sales#32678, sum(CASE WHEN (d_moy#1048 = 9) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS sep_sales#32679, sum(CASE WHEN (d_moy#1048 = 10) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS oct_sales#32680, sum(CASE WHEN (d_moy#1048 = 11) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS nov_sales#32681, sum(CASE WHEN (d_moy#1048 = 12) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS dec_sales#32682, sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS jan_net#32683, sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS feb_net#32684, sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS mar_net#32685, sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS apr_net#32686, ... 8 more fields]\n            :  +- Project [ws_quantity#1772, ws_ext_sales_price#1777, ws_net_paid#1783, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, d_moy#1048]\n            :     +- Join Inner, (ws_ship_mode_sk#1768 = sm_ship_mode_sk#1316)\n            :        :- Project [ws_ship_mode_sk#1768, ws_quantity#1772, ws_ext_sales_price#1777, ws_net_paid#1783, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, d_moy#1048]\n            :        :  +- Join Inner, (ws_sold_time_sk#1755 = t_time_sk#1464)\n            :        :     :- Project [ws_sold_time_sk#1755, ws_ship_mode_sk#1768, ws_quantity#1772, ws_ext_sales_price#1777, ws_net_paid#1783, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, d_moy#1048]\n            :        :     :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n            :        :     :     :- Project [ws_sold_time_sk#1755, ws_ship_mode_sk#1768, ws_quantity#1772, ws_ext_sales_price#1777, ws_net_paid#1783, ws_sold_date_sk#1788, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524]\n            :        :     :     :  +- Join Inner, (ws_warehouse_sk#1769 = w_warehouse_sk#1512)\n            :        :     :     :     :- Project [ws_sold_time_sk#1755, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_quantity#1772, ws_ext_sales_price#1777, ws_net_paid#1783, ws_sold_date_sk#1788]\n            :        :     :     :     :  +- Filter (((isnotnull(ws_warehouse_sk#1769) && isnotnull(ws_sold_date_sk#1788)) && isnotnull(ws_sold_time_sk#1755)) && isnotnull(ws_ship_mode_sk#1768))\n            :        :     :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :        :     :     :     +- Project [w_warehouse_sk#1512, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524]\n            :        :     :     :        +- Filter isnotnull(w_warehouse_sk#1512)\n            :        :     :     :           +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n            :        :     :     +- Project [d_date_sk#1040, d_year#1046, d_moy#1048]\n            :        :     :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n            :        :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :        :     +- Project [t_time_sk#1464]\n            :        :        +- Filter (((isnotnull(t_time#1466) && (t_time#1466 >= 30838)) && (t_time#1466 <= 59638)) && isnotnull(t_time_sk#1464))\n            :        :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n            :        +- Project [sm_ship_mode_sk#1316]\n            :           +- Filter (sm_carrier#1320 IN (DHL,BARIAN) && isnotnull(sm_ship_mode_sk#1316))\n            :              +- Relation[sm_ship_mode_sk#1316,sm_ship_mode_id#1317,sm_type#1318,sm_code#1319,sm_carrier#1320,sm_contract#1321] parquet\n            +- Aggregate [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046], [w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, DHL,BARIAN AS ship_carriers#32695, d_year#1046 AS year#32696, sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS jan_sales#32697, sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS feb_sales#32698, sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS mar_sales#32699, sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS apr_sales#32700, sum(CASE WHEN (d_moy#1048 = 5) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS may_sales#32701, sum(CASE WHEN (d_moy#1048 = 6) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS jun_sales#32702, sum(CASE WHEN (d_moy#1048 = 7) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS jul_sales#32703, sum(CASE WHEN (d_moy#1048 = 8) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS aug_sales#32704, sum(CASE WHEN (d_moy#1048 = 9) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS sep_sales#32705, sum(CASE WHEN (d_moy#1048 = 10) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS oct_sales#32706, sum(CASE WHEN (d_moy#1048 = 11) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS nov_sales#32707, sum(CASE WHEN (d_moy#1048 = 12) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS dec_sales#32708, sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS jan_net#32709, sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS feb_net#32710, sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS mar_net#32711, sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END) AS apr_net#32712, ... 8 more fields]\n               +- Project [cs_quantity#1806, cs_sales_price#1809, cs_net_paid_inc_tax#1818, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, d_moy#1048]\n                  +- Join Inner, (cs_ship_mode_sk#1801 = sm_ship_mode_sk#1316)\n                     :- Project [cs_ship_mode_sk#1801, cs_quantity#1806, cs_sales_price#1809, cs_net_paid_inc_tax#1818, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, d_moy#1048]\n                     :  +- Join Inner, (cs_sold_time_sk#1789 = t_time_sk#1464)\n                     :     :- Project [cs_sold_time_sk#1789, cs_ship_mode_sk#1801, cs_quantity#1806, cs_sales_price#1809, cs_net_paid_inc_tax#1818, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, d_moy#1048]\n                     :     :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n                     :     :     :- Project [cs_sold_time_sk#1789, cs_ship_mode_sk#1801, cs_quantity#1806, cs_sales_price#1809, cs_net_paid_inc_tax#1818, cs_sold_date_sk#1822, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524]\n                     :     :     :  +- Join Inner, (cs_warehouse_sk#1802 = w_warehouse_sk#1512)\n                     :     :     :     :- Project [cs_sold_time_sk#1789, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_quantity#1806, cs_sales_price#1809, cs_net_paid_inc_tax#1818, cs_sold_date_sk#1822]\n                     :     :     :     :  +- Filter (((isnotnull(cs_warehouse_sk#1802) && isnotnull(cs_sold_date_sk#1822)) && isnotnull(cs_sold_time_sk#1789)) && isnotnull(cs_ship_mode_sk#1801))\n                     :     :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :     :     :     +- Project [w_warehouse_sk#1512, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524]\n                     :     :     :        +- Filter isnotnull(w_warehouse_sk#1512)\n                     :     :     :           +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n                     :     :     +- Project [d_date_sk#1040, d_year#1046, d_moy#1048]\n                     :     :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n                     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :     +- Project [t_time_sk#1464]\n                     :        +- Filter (((isnotnull(t_time#1466) && (t_time#1466 >= 30838)) && (t_time#1466 <= 59638)) && isnotnull(t_time_sk#1464))\n                     :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n                     +- Project [sm_ship_mode_sk#1316]\n                        +- Filter (sm_carrier#1320 IN (DHL,BARIAN) && isnotnull(sm_ship_mode_sk#1316))\n                           +- Relation[sm_ship_mode_sk#1316,sm_ship_mode_id#1317,sm_type#1318,sm_code#1319,sm_carrier#1320,sm_contract#1321] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[w_warehouse_name#1514 ASC NULLS FIRST], output=[w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_city#1520,w_county#1521,w_state#1522,w_country#1524,ship_carriers#32669,year#32670,jan_sales#32721,feb_sales#32722,mar_sales#32723,apr_sales#32724,may_sales#32725,jun_sales#32726,jul_sales#32727,aug_sales#32728,sep_sales#32729,oct_sales#32730,nov_sales#32731,dec_sales#32732,jan_sales_per_sq_foot#32733,feb_sales_per_sq_foot#32734,mar_sales_per_sq_foot#32735,apr_sales_per_sq_foot#32736,... 20 more fields])\n+- *(14) HashAggregate(keys=[w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, ship_carriers#32669, year#32670], functions=[sum(jan_sales#32671), sum(feb_sales#32672), sum(mar_sales#32673), sum(apr_sales#32674), sum(may_sales#32675), sum(jun_sales#32676), sum(jul_sales#32677), sum(aug_sales#32678), sum(sep_sales#32679), sum(oct_sales#32680), sum(nov_sales#32681), sum(dec_sales#32682), sum(CheckOverflow((promote_precision(jan_sales#32671) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), sum(CheckOverflow((promote_precision(feb_sales#32672) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), sum(CheckOverflow((promote_precision(mar_sales#32673) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), sum(CheckOverflow((promote_precision(apr_sales#32674) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), sum(CheckOverflow((promote_precision(may_sales#32675) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), sum(CheckOverflow((promote_precision(jun_sales#32676) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), sum(CheckOverflow((promote_precision(jul_sales#32677) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), sum(CheckOverflow((promote_precision(aug_sales#32678) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), sum(CheckOverflow((promote_precision(sep_sales#32679) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), sum(CheckOverflow((promote_precision(oct_sales#32680) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), sum(CheckOverflow((promote_precision(nov_sales#32681) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), sum(CheckOverflow((promote_precision(dec_sales#32682) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), ... 12 more fields], output=[w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, ship_carriers#32669, year#32670, jan_sales#32721, feb_sales#32722, mar_sales#32723, apr_sales#32724, may_sales#32725, jun_sales#32726, jul_sales#32727, aug_sales#32728, sep_sales#32729, oct_sales#32730, nov_sales#32731, dec_sales#32732, jan_sales_per_sq_foot#32733, feb_sales_per_sq_foot#32734, mar_sales_per_sq_foot#32735, apr_sales_per_sq_foot#32736, ... 20 more fields])\n   +- Exchange hashpartitioning(w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, ship_carriers#32669, year#32670, 200)\n      +- *(13) HashAggregate(keys=[w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, ship_carriers#32669, year#32670], functions=[partial_sum(jan_sales#32671), partial_sum(feb_sales#32672), partial_sum(mar_sales#32673), partial_sum(apr_sales#32674), partial_sum(may_sales#32675), partial_sum(jun_sales#32676), partial_sum(jul_sales#32677), partial_sum(aug_sales#32678), partial_sum(sep_sales#32679), partial_sum(oct_sales#32680), partial_sum(nov_sales#32681), partial_sum(dec_sales#32682), partial_sum(CheckOverflow((promote_precision(jan_sales#32671) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), partial_sum(CheckOverflow((promote_precision(feb_sales#32672) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), partial_sum(CheckOverflow((promote_precision(mar_sales#32673) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), partial_sum(CheckOverflow((promote_precision(apr_sales#32674) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), partial_sum(CheckOverflow((promote_precision(may_sales#32675) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), partial_sum(CheckOverflow((promote_precision(jun_sales#32676) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), partial_sum(CheckOverflow((promote_precision(jul_sales#32677) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), partial_sum(CheckOverflow((promote_precision(aug_sales#32678) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), partial_sum(CheckOverflow((promote_precision(sep_sales#32679) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), partial_sum(CheckOverflow((promote_precision(oct_sales#32680) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), partial_sum(CheckOverflow((promote_precision(nov_sales#32681) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), partial_sum(CheckOverflow((promote_precision(dec_sales#32682) / promote_precision(cast(cast(w_warehouse_sq_ft#1515 as decimal(10,0)) as decimal(28,2)))), DecimalType(38,12))), ... 12 more fields], output=[w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, ship_carriers#32669, year#32670, sum#32922, sum#32923, sum#32924, sum#32925, sum#32926, sum#32927, sum#32928, sum#32929, sum#32930, sum#32931, sum#32932, sum#32933, sum#32934, sum#32935, sum#32936, sum#32937, ... 20 more fields])\n         +- Union\n            :- *(6) HashAggregate(keys=[w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046], functions=[sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 5) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 6) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 7) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 8) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 9) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 10) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 11) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 12) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 5) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 6) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 7) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 8) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 9) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 10) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 11) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 12) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END)], output=[w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, ship_carriers#32669, year#32670, jan_sales#32671, feb_sales#32672, mar_sales#32673, apr_sales#32674, may_sales#32675, jun_sales#32676, jul_sales#32677, aug_sales#32678, sep_sales#32679, oct_sales#32680, nov_sales#32681, dec_sales#32682, jan_net#32683, feb_net#32684, mar_net#32685, apr_net#32686, ... 8 more fields])\n            :  +- Exchange hashpartitioning(w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, 200)\n            :     +- *(5) HashAggregate(keys=[w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046], functions=[partial_sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 5) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 6) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 7) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 8) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 9) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 10) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 11) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 12) THEN CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 5) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 6) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 7) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 8) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 9) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 10) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 11) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 12) THEN CheckOverflow((promote_precision(cast(ws_net_paid#1783 as decimal(12,2))) * promote_precision(cast(cast(ws_quantity#1772 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END)], output=[w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, sum#32982, sum#32983, sum#32984, sum#32985, sum#32986, sum#32987, sum#32988, sum#32989, sum#32990, sum#32991, sum#32992, sum#32993, sum#32994, sum#32995, sum#32996, sum#32997, sum#32998, ... 7 more fields])\n            :        +- *(5) Project [ws_quantity#1772, ws_ext_sales_price#1777, ws_net_paid#1783, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, d_moy#1048]\n            :           +- *(5) BroadcastHashJoin [ws_ship_mode_sk#1768], [sm_ship_mode_sk#1316], Inner, BuildRight\n            :              :- *(5) Project [ws_ship_mode_sk#1768, ws_quantity#1772, ws_ext_sales_price#1777, ws_net_paid#1783, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, d_moy#1048]\n            :              :  +- *(5) BroadcastHashJoin [ws_sold_time_sk#1755], [t_time_sk#1464], Inner, BuildRight\n            :              :     :- *(5) Project [ws_sold_time_sk#1755, ws_ship_mode_sk#1768, ws_quantity#1772, ws_ext_sales_price#1777, ws_net_paid#1783, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, d_moy#1048]\n            :              :     :  +- *(5) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n            :              :     :     :- *(5) Project [ws_sold_time_sk#1755, ws_ship_mode_sk#1768, ws_quantity#1772, ws_ext_sales_price#1777, ws_net_paid#1783, ws_sold_date_sk#1788, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524]\n            :              :     :     :  +- *(5) BroadcastHashJoin [ws_warehouse_sk#1769], [w_warehouse_sk#1512], Inner, BuildRight\n            :              :     :     :     :- *(5) Project [ws_sold_time_sk#1755, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_quantity#1772, ws_ext_sales_price#1777, ws_net_paid#1783, ws_sold_date_sk#1788]\n            :              :     :     :     :  +- *(5) Filter ((isnotnull(ws_warehouse_sk#1769) && isnotnull(ws_sold_time_sk#1755)) && isnotnull(ws_ship_mode_sk#1768))\n            :              :     :     :     :     +- *(5) FileScan parquet db_tpcds.web_sales[ws_sold_time_sk#1755,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_quantity#1772,ws_ext_sales_price#1777,ws_net_paid#1783,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_warehouse_sk), IsNotNull(ws_sold_time_sk), IsNotNull(ws_ship_mode_sk)], ReadSchema: struct<ws_sold_time_sk:int,ws_ship_mode_sk:int,ws_warehouse_sk:int,ws_quantity:int,ws_ext_sales_p...\n            :              :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              :     :     :        +- *(1) Project [w_warehouse_sk#1512, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524]\n            :              :     :     :           +- *(1) Filter isnotnull(w_warehouse_sk#1512)\n            :              :     :     :              +- *(1) FileScan parquet db_tpcds.warehouse[w_warehouse_sk#1512,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_city#1520,w_county#1521,w_state#1522,w_country#1524] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/warehouse], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string,w_warehouse_sq_ft:int,w_city:string,w_county:st...\n            :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              :     :        +- *(2) Project [d_date_sk#1040, d_year#1046, d_moy#1048]\n            :              :     :           +- *(2) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n            :              :     :              +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n            :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :              :        +- *(3) Project [t_time_sk#1464]\n            :              :           +- *(3) Filter (((isnotnull(t_time#1466) && (t_time#1466 >= 30838)) && (t_time#1466 <= 59638)) && isnotnull(t_time_sk#1464))\n            :              :              +- *(3) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_time#1466] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [IsNotNull(t_time), GreaterThanOrEqual(t_time,30838), LessThanOrEqual(t_time,59638), IsNotNull(t_..., ReadSchema: struct<t_time_sk:int,t_time:int>\n            :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :                 +- *(4) Project [sm_ship_mode_sk#1316]\n            :                    +- *(4) Filter (sm_carrier#1320 IN (DHL,BARIAN) && isnotnull(sm_ship_mode_sk#1316))\n            :                       +- *(4) FileScan parquet db_tpcds.ship_mode[sm_ship_mode_sk#1316,sm_carrier#1320] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/ship_mode], PartitionFilters: [], PushedFilters: [In(sm_carrier, [DHL,BARIAN]), IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:int,sm_carrier:string>\n            +- *(12) HashAggregate(keys=[w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046], functions=[sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 5) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 6) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 7) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 8) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 9) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 10) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 11) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 12) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 5) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 6) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 7) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 8) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 9) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 10) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 11) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), sum(CASE WHEN (d_moy#1048 = 12) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END)], output=[w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, ship_carriers#32695, year#32696, jan_sales#32697, feb_sales#32698, mar_sales#32699, apr_sales#32700, may_sales#32701, jun_sales#32702, jul_sales#32703, aug_sales#32704, sep_sales#32705, oct_sales#32706, nov_sales#32707, dec_sales#32708, jan_net#32709, feb_net#32710, mar_net#32711, apr_net#32712, ... 8 more fields])\n               +- Exchange hashpartitioning(w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, 200)\n                  +- *(11) HashAggregate(keys=[w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046], functions=[partial_sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 5) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 6) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 7) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 8) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 9) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 10) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 11) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 12) THEN CheckOverflow((promote_precision(cast(cs_sales_price#1809 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 1) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 2) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 3) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 4) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 5) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 6) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 7) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 8) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 9) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 10) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 11) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END), partial_sum(CASE WHEN (d_moy#1048 = 12) THEN CheckOverflow((promote_precision(cast(cs_net_paid_inc_tax#1818 as decimal(12,2))) * promote_precision(cast(cast(cs_quantity#1806 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) ELSE 0.00 END)], output=[w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, sum#33030, sum#33031, sum#33032, sum#33033, sum#33034, sum#33035, sum#33036, sum#33037, sum#33038, sum#33039, sum#33040, sum#33041, sum#33042, sum#33043, sum#33044, sum#33045, sum#33046, ... 7 more fields])\n                     +- *(11) Project [cs_quantity#1806, cs_sales_price#1809, cs_net_paid_inc_tax#1818, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, d_moy#1048]\n                        +- *(11) BroadcastHashJoin [cs_ship_mode_sk#1801], [sm_ship_mode_sk#1316], Inner, BuildRight\n                           :- *(11) Project [cs_ship_mode_sk#1801, cs_quantity#1806, cs_sales_price#1809, cs_net_paid_inc_tax#1818, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, d_moy#1048]\n                           :  +- *(11) BroadcastHashJoin [cs_sold_time_sk#1789], [t_time_sk#1464], Inner, BuildRight\n                           :     :- *(11) Project [cs_sold_time_sk#1789, cs_ship_mode_sk#1801, cs_quantity#1806, cs_sales_price#1809, cs_net_paid_inc_tax#1818, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524, d_year#1046, d_moy#1048]\n                           :     :  +- *(11) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n                           :     :     :- *(11) Project [cs_sold_time_sk#1789, cs_ship_mode_sk#1801, cs_quantity#1806, cs_sales_price#1809, cs_net_paid_inc_tax#1818, cs_sold_date_sk#1822, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524]\n                           :     :     :  +- *(11) BroadcastHashJoin [cs_warehouse_sk#1802], [w_warehouse_sk#1512], Inner, BuildRight\n                           :     :     :     :- *(11) Project [cs_sold_time_sk#1789, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_quantity#1806, cs_sales_price#1809, cs_net_paid_inc_tax#1818, cs_sold_date_sk#1822]\n                           :     :     :     :  +- *(11) Filter ((isnotnull(cs_warehouse_sk#1802) && isnotnull(cs_sold_time_sk#1789)) && isnotnull(cs_ship_mode_sk#1801))\n                           :     :     :     :     +- *(11) FileScan parquet db_tpcds.catalog_sales[cs_sold_time_sk#1789,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_quantity#1806,cs_sales_price#1809,cs_net_paid_inc_tax#1818,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_warehouse_sk), IsNotNull(cs_sold_time_sk), IsNotNull(cs_ship_mode_sk)], ReadSchema: struct<cs_sold_time_sk:int,cs_ship_mode_sk:int,cs_warehouse_sk:int,cs_quantity:int,cs_sales_price...\n                           :     :     :     +- ReusedExchange [w_warehouse_sk#1512, w_warehouse_name#1514, w_warehouse_sq_ft#1515, w_city#1520, w_county#1521, w_state#1522, w_country#1524], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :     :     +- ReusedExchange [d_date_sk#1040, d_year#1046, d_moy#1048], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           :     +- ReusedExchange [t_time_sk#1464], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           +- ReusedExchange [sm_ship_mode_sk#1316], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q67-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","date_dim","store","item"],"parsingTime":0.002722,"analysisTime":0.001149,"optimizationTime":271.16142,"planningTime":12.358038,"executionTime":10697.313129,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_category ASC NULLS FIRST, 'i_class ASC NULLS FIRST, 'i_brand ASC NULLS FIRST, 'i_product_name ASC NULLS FIRST, 'd_year ASC NULLS FIRST, 'd_qoy ASC NULLS FIRST, 'd_moy ASC NULLS FIRST, 's_store_id ASC NULLS FIRST, 'sumsales ASC NULLS FIRST, 'rk ASC NULLS FIRST], true\n      +- 'Project [*]\n         +- 'Filter ('rk <= 100)\n            +- 'SubqueryAlias dw2\n               +- 'Project ['i_category, 'i_class, 'i_brand, 'i_product_name, 'd_year, 'd_qoy, 'd_moy, 's_store_id, 'sumsales, 'rank() windowspecdefinition('i_category, 'sumsales DESC NULLS LAST, unspecifiedframe$()) AS rk#33364]\n                  +- 'SubqueryAlias dw1\n                     +- 'Aggregate ['rollup('i_category, 'i_class, 'i_brand, 'i_product_name, 'd_year, 'd_qoy, 'd_moy, 's_store_id)], ['i_category, 'i_class, 'i_brand, 'i_product_name, 'd_year, 'd_qoy, 'd_moy, 's_store_id, 'sum('coalesce(('ss_sales_price * 'ss_quantity), 0)) AS sumsales#33363]\n                        +- 'Filter ((('ss_sold_date_sk = 'd_date_sk) && ('ss_item_sk = 'i_item_sk)) && (('ss_store_sk = 's_store_sk) && (('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11)))))\n                           +- 'Join Inner\n                              :- 'Join Inner\n                              :  :- 'Join Inner\n                              :  :  :- 'UnresolvedRelation `store_sales`\n                              :  :  +- 'UnresolvedRelation `date_dim`\n                              :  +- 'UnresolvedRelation `store`\n                              +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\ni_category: string, i_class: string, i_brand: string, i_product_name: string, d_year: int, d_qoy: int, d_moy: int, s_store_id: string, sumsales: decimal(28,2), rk: int\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_category#33377 ASC NULLS FIRST, i_class#33378 ASC NULLS FIRST, i_brand#33379 ASC NULLS FIRST, i_product_name#33380 ASC NULLS FIRST, d_year#33381 ASC NULLS FIRST, d_qoy#33382 ASC NULLS FIRST, d_moy#33383 ASC NULLS FIRST, s_store_id#33384 ASC NULLS FIRST, sumsales#33363 ASC NULLS FIRST, rk#33364 ASC NULLS FIRST], true\n      +- Project [i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, sumsales#33363, rk#33364]\n         +- Filter (rk#33364 <= 100)\n            +- SubqueryAlias dw2\n               +- Project [i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, sumsales#33363, rk#33364]\n                  +- Project [i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, sumsales#33363, rk#33364, rk#33364]\n                     +- Window [rank(sumsales#33363) windowspecdefinition(i_category#33377, sumsales#33363 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rk#33364], [i_category#33377], [sumsales#33363 DESC NULLS LAST]\n                        +- Project [i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, sumsales#33363]\n                           +- SubqueryAlias dw1\n                              +- Aggregate [i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, spark_grouping_id#33368], [i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, sum(coalesce(cast(CheckOverflow((promote_precision(cast(ss_sales_price#1916 as decimal(12,2))) * promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)) as decimal(18,2)), cast(0 as decimal(18,2)))) AS sumsales#33363]\n                                 +- Expand [List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_category#33369, i_class#33370, i_brand#33371, i_product_name#33372, d_year#33373, d_qoy#33374, d_moy#33375, s_store_id#33376, 0), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_category#33369, i_class#33370, i_brand#33371, i_product_name#33372, d_year#33373, d_qoy#33374, d_moy#33375, null, 1), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_category#33369, i_class#33370, i_brand#33371, i_product_name#33372, d_year#33373, d_qoy#33374, null, null, 3), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_category#33369, i_class#33370, i_brand#33371, i_product_name#33372, d_year#33373, null, null, null, 7), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_category#33369, i_class#33370, i_brand#33371, i_product_name#33372, null, null, null, null, 15), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_category#33369, i_class#33370, i_brand#33371, null, null, null, null, null, 31), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_category#33369, i_class#33370, null, null, null, null, null, null, 63), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_category#33369, null, null, null, null, null, null, null, 127), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, null, null, null, null, null, null, null, null, 255)], [ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, ... 87 more fields]\n                                    +- Project [ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, ... 86 more fields]\n                                       +- Filter (((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_item_sk#1905 = i_item_sk#1172)) && ((ss_store_sk#1910 = s_store_sk#1386) && ((d_month_seq#1043 >= 1200) && (d_month_seq#1043 <= (1200 + 11)))))\n                                          +- Join Inner\n                                             :- Join Inner\n                                             :  :- Join Inner\n                                             :  :  :- SubqueryAlias store_sales\n                                             :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                             :  :  +- SubqueryAlias date_dim\n                                             :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                             :  +- SubqueryAlias store\n                                             :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                                             +- SubqueryAlias item\n                                                +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_category#33377 ASC NULLS FIRST, i_class#33378 ASC NULLS FIRST, i_brand#33379 ASC NULLS FIRST, i_product_name#33380 ASC NULLS FIRST, d_year#33381 ASC NULLS FIRST, d_qoy#33382 ASC NULLS FIRST, d_moy#33383 ASC NULLS FIRST, s_store_id#33384 ASC NULLS FIRST, sumsales#33363 ASC NULLS FIRST, rk#33364 ASC NULLS FIRST], true\n      +- Filter (isnotnull(rk#33364) && (rk#33364 <= 100))\n         +- Window [rank(sumsales#33363) windowspecdefinition(i_category#33377, sumsales#33363 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rk#33364], [i_category#33377], [sumsales#33363 DESC NULLS LAST]\n            +- Aggregate [i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, spark_grouping_id#33368], [i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, sum(coalesce(CheckOverflow((promote_precision(cast(ss_sales_price#1916 as decimal(12,2))) * promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)), 0.00)) AS sumsales#33363]\n               +- Expand [List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, i_brand#1180, i_product_name#1193, d_year#1046, d_qoy#1050, d_moy#1048, s_store_id#1387, 0), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, i_brand#1180, i_product_name#1193, d_year#1046, d_qoy#1050, d_moy#1048, null, 1), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, i_brand#1180, i_product_name#1193, d_year#1046, d_qoy#1050, null, null, 3), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, i_brand#1180, i_product_name#1193, d_year#1046, null, null, null, 7), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, i_brand#1180, i_product_name#1193, null, null, null, null, 15), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, i_brand#1180, null, null, null, null, null, 31), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, null, null, null, null, null, null, 63), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, null, null, null, null, null, null, null, 127), List(ss_quantity#1913, ss_sales_price#1916, null, null, null, null, null, null, null, null, 255)], [ss_quantity#1913, ss_sales_price#1916, i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, spark_grouping_id#33368]\n                  +- Project [ss_quantity#1913, ss_sales_price#1916, d_year#1046, d_moy#1048, d_qoy#1050, s_store_id#1387, i_brand#1180, i_class#1182, i_category#1184, i_product_name#1193, i_category#1184, i_class#1182, i_brand#1180, i_product_name#1193, d_year#1046, d_qoy#1050, d_moy#1048, s_store_id#1387]\n                     +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                        :- Project [ss_item_sk#1905, ss_quantity#1913, ss_sales_price#1916, d_year#1046, d_moy#1048, d_qoy#1050, s_store_id#1387]\n                        :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n                        :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_sales_price#1916, d_year#1046, d_moy#1048, d_qoy#1050]\n                        :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                        :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926]\n                        :     :     :  +- Filter ((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_item_sk#1905))\n                        :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :     :     +- Project [d_date_sk#1040, d_year#1046, d_moy#1048, d_qoy#1050]\n                        :     :        +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                        :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :     +- Project [s_store_sk#1386, s_store_id#1387]\n                        :        +- Filter isnotnull(s_store_sk#1386)\n                        :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                        +- Project [i_item_sk#1172, i_brand#1180, i_class#1182, i_category#1184, i_product_name#1193]\n                           +- Filter isnotnull(i_item_sk#1172)\n                              +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_category#33377 ASC NULLS FIRST,i_class#33378 ASC NULLS FIRST,i_brand#33379 ASC NULLS FIRST,i_product_name#33380 ASC NULLS FIRST,d_year#33381 ASC NULLS FIRST,d_qoy#33382 ASC NULLS FIRST,d_moy#33383 ASC NULLS FIRST,s_store_id#33384 ASC NULLS FIRST,sumsales#33363 ASC NULLS FIRST,rk#33364 ASC NULLS FIRST], output=[i_category#33377,i_class#33378,i_brand#33379,i_product_name#33380,d_year#33381,d_qoy#33382,d_moy#33383,s_store_id#33384,sumsales#33363,rk#33364])\n+- *(7) Filter (isnotnull(rk#33364) && (rk#33364 <= 100))\n   +- Window [rank(sumsales#33363) windowspecdefinition(i_category#33377, sumsales#33363 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rk#33364], [i_category#33377], [sumsales#33363 DESC NULLS LAST]\n      +- *(6) Sort [i_category#33377 ASC NULLS FIRST, sumsales#33363 DESC NULLS LAST], false, 0\n         +- Exchange hashpartitioning(i_category#33377, 200)\n            +- *(5) HashAggregate(keys=[i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, spark_grouping_id#33368], functions=[sum(coalesce(CheckOverflow((promote_precision(cast(ss_sales_price#1916 as decimal(12,2))) * promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)), 0.00))], output=[i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, sumsales#33363])\n               +- Exchange hashpartitioning(i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, spark_grouping_id#33368, 200)\n                  +- *(4) HashAggregate(keys=[i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, spark_grouping_id#33368], functions=[partial_sum(coalesce(CheckOverflow((promote_precision(cast(ss_sales_price#1916 as decimal(12,2))) * promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2)))), DecimalType(18,2)), 0.00))], output=[i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, spark_grouping_id#33368, sum#33405])\n                     +- *(4) Expand [List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, i_brand#1180, i_product_name#1193, d_year#1046, d_qoy#1050, d_moy#1048, s_store_id#1387, 0), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, i_brand#1180, i_product_name#1193, d_year#1046, d_qoy#1050, d_moy#1048, null, 1), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, i_brand#1180, i_product_name#1193, d_year#1046, d_qoy#1050, null, null, 3), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, i_brand#1180, i_product_name#1193, d_year#1046, null, null, null, 7), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, i_brand#1180, i_product_name#1193, null, null, null, null, 15), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, i_brand#1180, null, null, null, null, null, 31), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, i_class#1182, null, null, null, null, null, null, 63), List(ss_quantity#1913, ss_sales_price#1916, i_category#1184, null, null, null, null, null, null, null, 127), List(ss_quantity#1913, ss_sales_price#1916, null, null, null, null, null, null, null, null, 255)], [ss_quantity#1913, ss_sales_price#1916, i_category#33377, i_class#33378, i_brand#33379, i_product_name#33380, d_year#33381, d_qoy#33382, d_moy#33383, s_store_id#33384, spark_grouping_id#33368]\n                        +- *(4) Project [ss_quantity#1913, ss_sales_price#1916, d_year#1046, d_moy#1048, d_qoy#1050, s_store_id#1387, i_brand#1180, i_class#1182, i_category#1184, i_product_name#1193, i_category#1184, i_class#1182, i_brand#1180, i_product_name#1193, d_year#1046, d_qoy#1050, d_moy#1048, s_store_id#1387]\n                           +- *(4) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n                              :- *(4) Project [ss_item_sk#1905, ss_quantity#1913, ss_sales_price#1916, d_year#1046, d_moy#1048, d_qoy#1050, s_store_id#1387]\n                              :  +- *(4) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                              :     :- *(4) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_sales_price#1916, d_year#1046, d_moy#1048, d_qoy#1050]\n                              :     :  +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                              :     :     :- *(4) Project [ss_item_sk#1905, ss_store_sk#1910, ss_quantity#1913, ss_sales_price#1916, ss_sold_date_sk#1926]\n                              :     :     :  +- *(4) Filter (isnotnull(ss_store_sk#1910) && isnotnull(ss_item_sk#1905))\n                              :     :     :     +- *(4) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_store_sk#1910,ss_quantity#1913,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_store_sk:int,ss_quantity:int,ss_sales_price:decimal(7,2)>\n                              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :        +- *(1) Project [d_date_sk#1040, d_year#1046, d_moy#1048, d_qoy#1050]\n                              :     :           +- *(1) Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                              :     :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_month_seq#1043,d_year#1046,d_moy#1048,d_qoy#1050] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int,d_year:int,d_moy:int,d_qoy:int>\n                              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :        +- *(2) Project [s_store_sk#1386, s_store_id#1387]\n                              :           +- *(2) Filter isnotnull(s_store_sk#1386)\n                              :              +- *(2) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_id#1387] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_store_id:string>\n                              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 +- *(3) Project [i_item_sk#1172, i_brand#1180, i_class#1182, i_category#1184, i_product_name#1193]\n                                    +- *(3) Filter isnotnull(i_item_sk#1172)\n                                       +- *(3) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand#1180,i_class#1182,i_category#1184,i_product_name#1193] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_class:string,i_category:string,i_product_name:string>"},{"name":"q68-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","date_dim","store","household_demographics","customer_address","customer","customer_address"],"parsingTime":0.002202,"analysisTime":0.001037,"optimizationTime":293.767843,"planningTime":15.140674,"executionTime":2878.18865,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['c_last_name ASC NULLS FIRST, 'ss_ticket_number ASC NULLS FIRST], true\n      +- 'Project ['c_last_name, 'c_first_name, 'ca_city, 'bought_city, 'ss_ticket_number, 'extended_price, 'extended_tax, 'list_price]\n         +- 'Filter ((('ss_customer_sk = 'c_customer_sk) && ('customer.c_current_addr_sk = 'current_addr.ca_address_sk)) && NOT ('current_addr.ca_city = 'bought_city))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'SubqueryAlias dn\n               :  :  +- 'Aggregate ['ss_ticket_number, 'ss_customer_sk, 'ss_addr_sk, 'ca_city], ['ss_ticket_number, 'ss_customer_sk, 'ca_city AS bought_city#33469, 'sum('ss_ext_sales_price) AS extended_price#33470, 'sum('ss_ext_list_price) AS list_price#33471, 'sum('ss_ext_tax) AS extended_tax#33472]\n               :  :     +- 'Filter (((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) && ('store_sales.ss_store_sk = 'store.s_store_sk)) && (('store_sales.ss_hdemo_sk = 'household_demographics.hd_demo_sk) && ('store_sales.ss_addr_sk = 'customer_address.ca_address_sk))) && (((('date_dim.d_dom >= 1) && ('date_dim.d_dom <= 2)) && (('household_demographics.hd_dep_count = 4) || ('household_demographics.hd_vehicle_count = 3))) && ('date_dim.d_year IN (1999,(1999 + 1),(1999 + 2)) && 'store.s_city IN (Midway,Fairview))))\n               :  :        +- 'Join Inner\n               :  :           :- 'Join Inner\n               :  :           :  :- 'Join Inner\n               :  :           :  :  :- 'Join Inner\n               :  :           :  :  :  :- 'UnresolvedRelation `store_sales`\n               :  :           :  :  :  +- 'UnresolvedRelation `date_dim`\n               :  :           :  :  +- 'UnresolvedRelation `store`\n               :  :           :  +- 'UnresolvedRelation `household_demographics`\n               :  :           +- 'UnresolvedRelation `customer_address`\n               :  +- 'UnresolvedRelation `customer`\n               +- 'SubqueryAlias current_addr\n                  +- 'UnresolvedRelation `customer_address`\n\n== Analyzed Logical Plan ==\nc_last_name: string, c_first_name: string, ca_city: string, bought_city: string, ss_ticket_number: bigint, extended_price: decimal(17,2), extended_tax: decimal(17,2), list_price: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [c_last_name#869 ASC NULLS FIRST, ss_ticket_number#1912L ASC NULLS FIRST], true\n      +- Project [c_last_name#869, c_first_name#868, ca_city#928, bought_city#33469, ss_ticket_number#1912L, extended_price#33470, extended_tax#33472, list_price#33471]\n         +- Filter (((ss_customer_sk#1906 = c_customer_sk#860) && (c_current_addr_sk#864 = ca_address_sk#922)) && NOT (ca_city#928 = bought_city#33469))\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias dn\n               :  :  +- Aggregate [ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, ca_city#928], [ss_ticket_number#1912L, ss_customer_sk#1906, ca_city#928 AS bought_city#33469, sum(ss_ext_sales_price#1918) AS extended_price#33470, sum(ss_ext_list_price#1920) AS list_price#33471, sum(ss_ext_tax#1921) AS extended_tax#33472]\n               :  :     +- Filter ((((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_store_sk#1910 = s_store_sk#1386)) && ((ss_hdemo_sk#1908 = hd_demo_sk#1106) && (ss_addr_sk#1909 = ca_address_sk#922))) && ((((d_dom#1049 >= 1) && (d_dom#1049 <= 2)) && ((hd_dep_count#1109 = 4) || (hd_vehicle_count#1110 = 3))) && (d_year#1046 IN (1999,(1999 + 1),(1999 + 2)) && s_city#1408 IN (Midway,Fairview))))\n               :  :        +- Join Inner\n               :  :           :- Join Inner\n               :  :           :  :- Join Inner\n               :  :           :  :  :- Join Inner\n               :  :           :  :  :  :- SubqueryAlias store_sales\n               :  :           :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :           :  :  :  +- SubqueryAlias date_dim\n               :  :           :  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :           :  :  +- SubqueryAlias store\n               :  :           :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               :  :           :  +- SubqueryAlias household_demographics\n               :  :           :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n               :  :           +- SubqueryAlias customer_address\n               :  :              +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               :  +- SubqueryAlias customer\n               :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               +- SubqueryAlias current_addr\n                  +- SubqueryAlias customer_address\n                     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [c_last_name#869 ASC NULLS FIRST, ss_ticket_number#1912L ASC NULLS FIRST], true\n      +- Project [c_last_name#869, c_first_name#868, ca_city#928, bought_city#33469, ss_ticket_number#1912L, extended_price#33470, extended_tax#33472, list_price#33471]\n         +- Join Inner, ((c_current_addr_sk#864 = ca_address_sk#922) && NOT (ca_city#928 = bought_city#33469))\n            :- Project [ss_ticket_number#1912L, bought_city#33469, extended_price#33470, list_price#33471, extended_tax#33472, c_current_addr_sk#864, c_first_name#868, c_last_name#869]\n            :  +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n            :     :- Aggregate [ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, ca_city#928], [ss_ticket_number#1912L, ss_customer_sk#1906, ca_city#928 AS bought_city#33469, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS extended_price#33470, MakeDecimal(sum(UnscaledValue(ss_ext_list_price#1920)),17,2) AS list_price#33471, MakeDecimal(sum(UnscaledValue(ss_ext_tax#1921)),17,2) AS extended_tax#33472]\n            :     :  +- Project [ss_customer_sk#1906, ss_addr_sk#1909, ss_ticket_number#1912L, ss_ext_sales_price#1918, ss_ext_list_price#1920, ss_ext_tax#1921, ca_city#928]\n            :     :     +- Join Inner, (ss_addr_sk#1909 = ca_address_sk#922)\n            :     :        :- Project [ss_customer_sk#1906, ss_addr_sk#1909, ss_ticket_number#1912L, ss_ext_sales_price#1918, ss_ext_list_price#1920, ss_ext_tax#1921]\n            :     :        :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n            :     :        :     :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_ticket_number#1912L, ss_ext_sales_price#1918, ss_ext_list_price#1920, ss_ext_tax#1921]\n            :     :        :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n            :     :        :     :     :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_ticket_number#1912L, ss_ext_sales_price#1918, ss_ext_list_price#1920, ss_ext_tax#1921]\n            :     :        :     :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :     :        :     :     :     :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_ticket_number#1912L, ss_ext_sales_price#1918, ss_ext_list_price#1920, ss_ext_tax#1921, ss_sold_date_sk#1926]\n            :     :        :     :     :     :  +- Filter ((((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_addr_sk#1909)) && isnotnull(ss_customer_sk#1906))\n            :     :        :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :        :     :     :     +- Project [d_date_sk#1040]\n            :     :        :     :     :        +- Filter ((((isnotnull(d_dom#1049) && (d_dom#1049 >= 1)) && (d_dom#1049 <= 2)) && d_year#1046 IN (1999,2000,2001)) && isnotnull(d_date_sk#1040))\n            :     :        :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :        :     :     +- Project [s_store_sk#1386]\n            :     :        :     :        +- Filter (s_city#1408 IN (Midway,Fairview) && isnotnull(s_store_sk#1386))\n            :     :        :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n            :     :        :     +- Project [hd_demo_sk#1106]\n            :     :        :        +- Filter (((hd_dep_count#1109 = 4) || (hd_vehicle_count#1110 = 3)) && isnotnull(hd_demo_sk#1106))\n            :     :        :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n            :     :        +- Project [ca_address_sk#922, ca_city#928]\n            :     :           +- Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_city#928))\n            :     :              +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :     +- Project [c_customer_sk#860, c_current_addr_sk#864, c_first_name#868, c_last_name#869]\n            :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n            :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            +- Project [ca_address_sk#922, ca_city#928]\n               +- Filter (isnotnull(ca_city#928) && isnotnull(ca_address_sk#922))\n                  +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[c_last_name#869 ASC NULLS FIRST,ss_ticket_number#1912L ASC NULLS FIRST], output=[c_last_name#869,c_first_name#868,ca_city#928,bought_city#33469,ss_ticket_number#1912L,extended_price#33470,extended_tax#33472,list_price#33471])\n+- *(8) Project [c_last_name#869, c_first_name#868, ca_city#928, bought_city#33469, ss_ticket_number#1912L, extended_price#33470, extended_tax#33472, list_price#33471]\n   +- *(8) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight, NOT (ca_city#928 = bought_city#33469)\n      :- *(8) Project [ss_ticket_number#1912L, bought_city#33469, extended_price#33470, list_price#33471, extended_tax#33472, c_current_addr_sk#864, c_first_name#868, c_last_name#869]\n      :  +- *(8) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n      :     :- *(8) HashAggregate(keys=[ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, ca_city#928], functions=[sum(UnscaledValue(ss_ext_sales_price#1918)), sum(UnscaledValue(ss_ext_list_price#1920)), sum(UnscaledValue(ss_ext_tax#1921))], output=[ss_ticket_number#1912L, ss_customer_sk#1906, bought_city#33469, extended_price#33470, list_price#33471, extended_tax#33472])\n      :     :  +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, ca_city#928, 200)\n      :     :     +- *(5) HashAggregate(keys=[ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, ca_city#928], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918)), partial_sum(UnscaledValue(ss_ext_list_price#1920)), partial_sum(UnscaledValue(ss_ext_tax#1921))], output=[ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, ca_city#928, sum#33487L, sum#33488L, sum#33489L])\n      :     :        +- *(5) Project [ss_customer_sk#1906, ss_addr_sk#1909, ss_ticket_number#1912L, ss_ext_sales_price#1918, ss_ext_list_price#1920, ss_ext_tax#1921, ca_city#928]\n      :     :           +- *(5) BroadcastHashJoin [ss_addr_sk#1909], [ca_address_sk#922], Inner, BuildRight\n      :     :              :- *(5) Project [ss_customer_sk#1906, ss_addr_sk#1909, ss_ticket_number#1912L, ss_ext_sales_price#1918, ss_ext_list_price#1920, ss_ext_tax#1921]\n      :     :              :  +- *(5) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n      :     :              :     :- *(5) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_ticket_number#1912L, ss_ext_sales_price#1918, ss_ext_list_price#1920, ss_ext_tax#1921]\n      :     :              :     :  +- *(5) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n      :     :              :     :     :- *(5) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_ticket_number#1912L, ss_ext_sales_price#1918, ss_ext_list_price#1920, ss_ext_tax#1921]\n      :     :              :     :     :  +- *(5) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :     :              :     :     :     :- *(5) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_ticket_number#1912L, ss_ext_sales_price#1918, ss_ext_list_price#1920, ss_ext_tax#1921, ss_sold_date_sk#1926]\n      :     :              :     :     :     :  +- *(5) Filter (((isnotnull(ss_store_sk#1910) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_addr_sk#1909)) && isnotnull(ss_customer_sk#1906))\n      :     :              :     :     :     :     +- *(5) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_ticket_number#1912L,ss_ext_sales_price#1918,ss_ext_list_price#1920,ss_ext_tax#1921,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_addr_sk), IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_hdemo_sk:int,ss_addr_sk:int,ss_store_sk:int,ss_ticket_number:bigint,...\n      :     :              :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :              :     :     :        +- *(1) Project [d_date_sk#1040]\n      :     :              :     :     :           +- *(1) Filter ((((isnotnull(d_dom#1049) && (d_dom#1049 >= 1)) && (d_dom#1049 <= 2)) && d_year#1046 IN (1999,2000,2001)) && isnotnull(d_date_sk#1040))\n      :     :              :     :     :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_dom#1049] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_dom), GreaterThanOrEqual(d_dom,1), LessThanOrEqual(d_dom,2), In(d_year, [1999,2000,2..., ReadSchema: struct<d_date_sk:int,d_year:int,d_dom:int>\n      :     :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :              :     :        +- *(2) Project [s_store_sk#1386]\n      :     :              :     :           +- *(2) Filter (s_city#1408 IN (Midway,Fairview) && isnotnull(s_store_sk#1386))\n      :     :              :     :              +- *(2) FileScan parquet db_tpcds.store[s_store_sk#1386,s_city#1408] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [In(s_city, [Midway,Fairview]), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_city:string>\n      :     :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :              :        +- *(3) Project [hd_demo_sk#1106]\n      :     :              :           +- *(3) Filter (((hd_dep_count#1109 = 4) || (hd_vehicle_count#1110 = 3)) && isnotnull(hd_demo_sk#1106))\n      :     :              :              +- *(3) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_dep_count#1109,hd_vehicle_count#1110] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [Or(EqualTo(hd_dep_count,4),EqualTo(hd_vehicle_count,3)), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:int,hd_dep_count:int,hd_vehicle_count:int>\n      :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                 +- *(4) Project [ca_address_sk#922, ca_city#928]\n      :     :                    +- *(4) Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_city#928))\n      :     :                       +- *(4) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_city#928] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_city)], ReadSchema: struct<ca_address_sk:int,ca_city:string>\n      :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :        +- *(6) Project [c_customer_sk#860, c_current_addr_sk#864, c_first_name#868, c_last_name#869]\n      :           +- *(6) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n      :              +- *(6) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_addr_sk#864,c_first_name#868,c_last_name#869] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:int,c_current_addr_sk:int,c_first_name:string,c_last_name:string>\n      +- ReusedExchange [ca_address_sk#922, ca_city#928], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q69-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["customer","customer_address","customer_demographics"],"parsingTime":0.002561,"analysisTime":0.001077,"optimizationTime":827.433239,"planningTime":34.447235,"executionTime":8632.644686,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['cd_gender ASC NULLS FIRST, 'cd_marital_status ASC NULLS FIRST, 'cd_education_status ASC NULLS FIRST, 'cd_purchase_estimate ASC NULLS FIRST, 'cd_credit_rating ASC NULLS FIRST], true\n      +- 'Aggregate ['cd_gender, 'cd_marital_status, 'cd_education_status, 'cd_purchase_estimate, 'cd_credit_rating], ['cd_gender, 'cd_marital_status, 'cd_education_status, 'count(1) AS cnt1#33525, 'cd_purchase_estimate, 'count(1) AS cnt2#33526, 'cd_credit_rating, 'count(1) AS cnt3#33527]\n         +- 'Filter (((('c.c_current_addr_sk = 'ca.ca_address_sk) && 'ca_state IN (KY,GA,NM)) && ('cd_demo_sk = 'c.c_current_cdemo_sk)) && (exists#33528 [] && (NOT exists#33529 [] && NOT exists#33530 [])))\n            :  :- 'Project [*]\n            :  :  +- 'Filter ((('c.c_customer_sk = 'ss_customer_sk) && ('ss_sold_date_sk = 'd_date_sk)) && (('d_year = 2001) && (('d_moy >= 4) && ('d_moy <= (4 + 2)))))\n            :  :     +- 'Join Inner\n            :  :        :- 'UnresolvedRelation `store_sales`\n            :  :        +- 'UnresolvedRelation `date_dim`\n            :  :- 'Project [*]\n            :  :  +- 'Filter ((('c.c_customer_sk = 'ws_bill_customer_sk) && ('ws_sold_date_sk = 'd_date_sk)) && (('d_year = 2001) && (('d_moy >= 4) && ('d_moy <= (4 + 2)))))\n            :  :     +- 'Join Inner\n            :  :        :- 'UnresolvedRelation `web_sales`\n            :  :        +- 'UnresolvedRelation `date_dim`\n            :  +- 'Project [*]\n            :     +- 'Filter ((('c.c_customer_sk = 'cs_ship_customer_sk) && ('cs_sold_date_sk = 'd_date_sk)) && (('d_year = 2001) && (('d_moy >= 4) && ('d_moy <= (4 + 2)))))\n            :        +- 'Join Inner\n            :           :- 'UnresolvedRelation `catalog_sales`\n            :           +- 'UnresolvedRelation `date_dim`\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'SubqueryAlias c\n               :  :  +- 'UnresolvedRelation `customer`\n               :  +- 'SubqueryAlias ca\n               :     +- 'UnresolvedRelation `customer_address`\n               +- 'UnresolvedRelation `customer_demographics`\n\n== Analyzed Logical Plan ==\ncd_gender: string, cd_marital_status: string, cd_education_status: string, cnt1: bigint, cd_purchase_estimate: int, cnt2: bigint, cd_credit_rating: string, cnt3: bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [cd_gender#967 ASC NULLS FIRST, cd_marital_status#968 ASC NULLS FIRST, cd_education_status#969 ASC NULLS FIRST, cd_purchase_estimate#970 ASC NULLS FIRST, cd_credit_rating#971 ASC NULLS FIRST], true\n      +- Aggregate [cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971], [cd_gender#967, cd_marital_status#968, cd_education_status#969, count(1) AS cnt1#33525L, cd_purchase_estimate#970, count(1) AS cnt2#33526L, cd_credit_rating#971, count(1) AS cnt3#33527L]\n         +- Filter ((((c_current_addr_sk#864 = ca_address_sk#922) && ca_state#930 IN (KY,GA,NM)) && (cd_demo_sk#966 = c_current_cdemo_sk#862)) && (exists#33528 [c_customer_sk#860] && (NOT exists#33529 [c_customer_sk#860] && NOT exists#33530 [c_customer_sk#860])))\n            :  :- Project [ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, ... 27 more fields]\n            :  :  +- Filter (((outer(c_customer_sk#860) = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && ((d_year#1046 = 2001) && ((d_moy#1048 >= 4) && (d_moy#1048 <= (4 + 2)))))\n            :  :     +- Join Inner\n            :  :        :- SubqueryAlias store_sales\n            :  :        :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :  :        +- SubqueryAlias date_dim\n            :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :  :- Project [ws_sold_time_sk#1755, ws_ship_date_sk#1756, ws_item_sk#1757, ws_bill_customer_sk#1758, ws_bill_cdemo_sk#1759, ws_bill_hdemo_sk#1760, ws_bill_addr_sk#1761, ws_ship_customer_sk#1762, ws_ship_cdemo_sk#1763, ws_ship_hdemo_sk#1764, ws_ship_addr_sk#1765, ws_web_page_sk#1766, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_promo_sk#1770, ws_order_number#1771L, ws_quantity#1772, ws_wholesale_cost#1773, ws_list_price#1774, ws_sales_price#1775, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ... 38 more fields]\n            :  :  +- Filter (((outer(c_customer_sk#860) = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && ((d_year#1046 = 2001) && ((d_moy#1048 >= 4) && (d_moy#1048 <= (4 + 2)))))\n            :  :     +- Join Inner\n            :  :        :- SubqueryAlias web_sales\n            :  :        :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :  :        +- SubqueryAlias date_dim\n            :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :  +- Project [cs_sold_time_sk#1789, cs_ship_date_sk#1790, cs_bill_customer_sk#1791, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_bill_addr_sk#1794, cs_ship_customer_sk#1795, cs_ship_cdemo_sk#1796, cs_ship_hdemo_sk#1797, cs_ship_addr_sk#1798, cs_call_center_sk#1799, cs_catalog_page_sk#1800, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_wholesale_cost#1807, cs_list_price#1808, cs_sales_price#1809, cs_ext_discount_amt#1810, cs_ext_sales_price#1811, cs_ext_wholesale_cost#1812, ... 38 more fields]\n            :     +- Filter (((outer(c_customer_sk#860) = cs_ship_customer_sk#1795) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && ((d_year#1046 = 2001) && ((d_moy#1048 >= 4) && (d_moy#1048 <= (4 + 2)))))\n            :        +- Join Inner\n            :           :- SubqueryAlias catalog_sales\n            :           :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :           +- SubqueryAlias date_dim\n            :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias c\n               :  :  +- SubqueryAlias customer\n               :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  +- SubqueryAlias ca\n               :     +- SubqueryAlias customer_address\n               :        +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- SubqueryAlias customer_demographics\n                  +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [cd_gender#967 ASC NULLS FIRST, cd_marital_status#968 ASC NULLS FIRST, cd_education_status#969 ASC NULLS FIRST, cd_purchase_estimate#970 ASC NULLS FIRST, cd_credit_rating#971 ASC NULLS FIRST], true\n      +- Aggregate [cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971], [cd_gender#967, cd_marital_status#968, cd_education_status#969, count(1) AS cnt1#33525L, cd_purchase_estimate#970, count(1) AS cnt2#33526L, cd_credit_rating#971, count(1) AS cnt3#33527L]\n         +- Project [cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971]\n            +- Join Inner, (cd_demo_sk#966 = c_current_cdemo_sk#862)\n               :- Project [c_current_cdemo_sk#862]\n               :  +- Join Inner, (c_current_addr_sk#864 = ca_address_sk#922)\n               :     :- Project [c_current_cdemo_sk#862, c_current_addr_sk#864]\n               :     :  +- Join LeftAnti, (c_customer_sk#860 = cs_ship_customer_sk#1795)\n               :     :     :- Join LeftAnti, (c_customer_sk#860 = ws_bill_customer_sk#1758)\n               :     :     :  :- Join LeftSemi, (c_customer_sk#860 = ss_customer_sk#1906)\n               :     :     :  :  :- Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_addr_sk#864]\n               :     :     :  :  :  +- Filter (isnotnull(c_current_addr_sk#864) && isnotnull(c_current_cdemo_sk#862))\n               :     :     :  :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :     :     :  :  +- Project [ss_customer_sk#1906]\n               :     :     :  :     +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :     :     :  :        :- Project [ss_customer_sk#1906, ss_sold_date_sk#1926]\n               :     :     :  :        :  +- Filter isnotnull(ss_sold_date_sk#1926)\n               :     :     :  :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :     :  :        +- Project [d_date_sk#1040]\n               :     :     :  :           +- Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 >= 4)) && (d_moy#1048 <= 6)) && isnotnull(d_date_sk#1040))\n               :     :     :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :     :  +- Project [ws_bill_customer_sk#1758]\n               :     :     :     +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n               :     :     :        :- Project [ws_bill_customer_sk#1758, ws_sold_date_sk#1788]\n               :     :     :        :  +- Filter isnotnull(ws_sold_date_sk#1788)\n               :     :     :        :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :     :        +- Project [d_date_sk#1040]\n               :     :     :           +- Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 >= 4)) && (d_moy#1048 <= 6)) && isnotnull(d_date_sk#1040))\n               :     :     :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :     +- Project [cs_ship_customer_sk#1795]\n               :     :        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :     :           :- Project [cs_ship_customer_sk#1795, cs_sold_date_sk#1822]\n               :     :           :  +- Filter isnotnull(cs_sold_date_sk#1822)\n               :     :           :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :           +- Project [d_date_sk#1040]\n               :     :              +- Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 >= 4)) && (d_moy#1048 <= 6)) && isnotnull(d_date_sk#1040))\n               :     :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [ca_address_sk#922]\n               :        +- Filter (ca_state#930 IN (KY,GA,NM) && isnotnull(ca_address_sk#922))\n               :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- Project [cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971]\n                  +- Filter isnotnull(cd_demo_sk#966)\n                     +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[cd_gender#967 ASC NULLS FIRST,cd_marital_status#968 ASC NULLS FIRST,cd_education_status#969 ASC NULLS FIRST,cd_purchase_estimate#970 ASC NULLS FIRST,cd_credit_rating#971 ASC NULLS FIRST], output=[cd_gender#967,cd_marital_status#968,cd_education_status#969,cnt1#33525L,cd_purchase_estimate#970,cnt2#33526L,cd_credit_rating#971,cnt3#33527L])\n+- *(15) HashAggregate(keys=[cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971], functions=[count(1)], output=[cd_gender#967, cd_marital_status#968, cd_education_status#969, cnt1#33525L, cd_purchase_estimate#970, cnt2#33526L, cd_credit_rating#971, cnt3#33527L])\n   +- Exchange hashpartitioning(cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, 200)\n      +- *(14) HashAggregate(keys=[cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971], functions=[partial_count(1)], output=[cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971, count#33543L])\n         +- *(14) Project [cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971]\n            +- *(14) BroadcastHashJoin [c_current_cdemo_sk#862], [cd_demo_sk#966], Inner, BuildRight\n               :- *(14) Project [c_current_cdemo_sk#862]\n               :  +- *(14) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n               :     :- *(14) Project [c_current_cdemo_sk#862, c_current_addr_sk#864]\n               :     :  +- SortMergeJoin [c_customer_sk#860], [cs_ship_customer_sk#1795], LeftAnti\n               :     :     :- SortMergeJoin [c_customer_sk#860], [ws_bill_customer_sk#1758], LeftAnti\n               :     :     :  :- SortMergeJoin [c_customer_sk#860], [ss_customer_sk#1906], LeftSemi\n               :     :     :  :  :- *(2) Sort [c_customer_sk#860 ASC NULLS FIRST], false, 0\n               :     :     :  :  :  +- Exchange hashpartitioning(c_customer_sk#860, 200)\n               :     :     :  :  :     +- *(1) Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_addr_sk#864]\n               :     :     :  :  :        +- *(1) Filter (isnotnull(c_current_addr_sk#864) && isnotnull(c_current_cdemo_sk#862))\n               :     :     :  :  :           +- *(1) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_cdemo_sk#862,c_current_addr_sk#864] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_current_addr_sk), IsNotNull(c_current_cdemo_sk)], ReadSchema: struct<c_customer_sk:int,c_current_cdemo_sk:int,c_current_addr_sk:int>\n               :     :     :  :  +- *(5) Sort [ss_customer_sk#1906 ASC NULLS FIRST], false, 0\n               :     :     :  :     +- Exchange hashpartitioning(ss_customer_sk#1906, 200)\n               :     :     :  :        +- *(4) Project [ss_customer_sk#1906]\n               :     :     :  :           +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :     :  :              :- *(4) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [], ReadSchema: struct<ss_customer_sk:int>\n               :     :     :  :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :  :                 +- *(3) Project [d_date_sk#1040]\n               :     :     :  :                    +- *(3) Filter (((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 2001)) && (d_moy#1048 >= 4)) && (d_moy#1048 <= 6)) && isnotnull(d_date_sk#1040))\n               :     :     :  :                       +- *(3) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2001), GreaterThanOrEqual(d_moy,4), LessThan..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n               :     :     :  +- *(8) Sort [ws_bill_customer_sk#1758 ASC NULLS FIRST], false, 0\n               :     :     :     +- Exchange hashpartitioning(ws_bill_customer_sk#1758, 200)\n               :     :     :        +- *(7) Project [ws_bill_customer_sk#1758]\n               :     :     :           +- *(7) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n               :     :     :              :- *(7) FileScan parquet db_tpcds.web_sales[ws_bill_customer_sk#1758,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [], ReadSchema: struct<ws_bill_customer_sk:int>\n               :     :     :              +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     +- *(11) Sort [cs_ship_customer_sk#1795 ASC NULLS FIRST], false, 0\n               :     :        +- Exchange hashpartitioning(cs_ship_customer_sk#1795, 200)\n               :     :           +- *(10) Project [cs_ship_customer_sk#1795]\n               :     :              +- *(10) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :     :                 :- *(10) FileScan parquet db_tpcds.catalog_sales[cs_ship_customer_sk#1795,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_ship_customer_sk:int>\n               :     :                 +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(12) Project [ca_address_sk#922]\n               :           +- *(12) Filter (ca_state#930 IN (KY,GA,NM) && isnotnull(ca_address_sk#922))\n               :              +- *(12) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [In(ca_state, [KY,GA,NM]), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(13) Project [cd_demo_sk#966, cd_gender#967, cd_marital_status#968, cd_education_status#969, cd_purchase_estimate#970, cd_credit_rating#971]\n                     +- *(13) Filter isnotnull(cd_demo_sk#966)\n                        +- *(13) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:int,cd_gender:string,cd_marital_status:string,cd_education_status:string,cd_pur..."},{"name":"q70-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","date_dim","store"],"parsingTime":0.002793,"analysisTime":0.001147,"optimizationTime":671.787439,"planningTime":37.575742,"executionTime":5737.574278,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['lochierarchy DESC NULLS LAST, CASE WHEN ('lochierarchy = 0) THEN 's_state END ASC NULLS FIRST, 'rank_within_parent ASC NULLS FIRST], true\n      +- 'Aggregate ['rollup('s_state, 's_county)], ['sum('ss_net_profit) AS total_sum#33641, 's_state, 's_county, ('grouping('s_state) + 'grouping('s_county)) AS lochierarchy#33642, 'rank() windowspecdefinition(('grouping('s_state) + 'grouping('s_county)), CASE WHEN ('grouping('s_county) = 0) THEN 's_state END, 'sum('ss_net_profit) DESC NULLS LAST, unspecifiedframe$()) AS rank_within_parent#33643]\n         +- 'Filter (((('d1.d_month_seq >= 1200) && ('d1.d_month_seq <= (1200 + 11))) && ('d1.d_date_sk = 'ss_sold_date_sk)) && (('s_store_sk = 'ss_store_sk) && 's_state IN (list#33646 [])))\n            :  +- 'Project ['s_state]\n            :     +- 'Filter ('ranking <= 5)\n            :        +- 'SubqueryAlias tmp1\n            :           +- 'Aggregate ['s_state], ['s_state AS s_state#33644, 'rank() windowspecdefinition('s_state, 'sum('ss_net_profit) DESC NULLS LAST, unspecifiedframe$()) AS ranking#33645]\n            :              +- 'Filter (((('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11))) && ('d_date_sk = 'ss_sold_date_sk)) && ('s_store_sk = 'ss_store_sk))\n            :                 +- 'Join Inner\n            :                    :- 'Join Inner\n            :                    :  :- 'UnresolvedRelation `store_sales`\n            :                    :  +- 'UnresolvedRelation `store`\n            :                    +- 'UnresolvedRelation `date_dim`\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'UnresolvedRelation `store_sales`\n               :  +- 'SubqueryAlias d1\n               :     +- 'UnresolvedRelation `date_dim`\n               +- 'UnresolvedRelation `store`\n\n== Analyzed Logical Plan ==\ntotal_sum: decimal(17,2), s_state: string, s_county: string, lochierarchy: tinyint, rank_within_parent: int\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [lochierarchy#33642 DESC NULLS LAST, CASE WHEN (cast(lochierarchy#33642 as int) = 0) THEN s_state#33671 END ASC NULLS FIRST, rank_within_parent#33643 ASC NULLS FIRST], true\n      +- Project [total_sum#33641, s_state#33671, s_county#33672, lochierarchy#33642, rank_within_parent#33643]\n         +- Project [total_sum#33641, s_state#33671, s_county#33672, lochierarchy#33642, _w0#33681, _w1#33685, _w2#33686, _w3#33687, rank_within_parent#33643, rank_within_parent#33643]\n            +- Window [rank(_w3#33687) windowspecdefinition(_w1#33685, _w2#33686, _w3#33687 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#33643], [_w1#33685, _w2#33686], [_w3#33687 DESC NULLS LAST]\n               +- Aggregate [s_state#33671, s_county#33672, spark_grouping_id#33668], [sum(ss_net_profit#1925) AS total_sum#33641, s_state#33671, s_county#33672, (cast((shiftright(spark_grouping_id#33668, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#33668, 0) & 1) as tinyint)) AS lochierarchy#33642, sum(ss_net_profit#1925) AS _w0#33681, (cast((shiftright(spark_grouping_id#33668, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#33668, 0) & 1) as tinyint)) AS _w1#33685, CASE WHEN (cast(cast((shiftright(spark_grouping_id#33668, 0) & 1) as tinyint) as int) = 0) THEN s_state#33671 END AS _w2#33686, sum(ss_net_profit#1925) AS _w3#33687]\n                  +- Expand [List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, s_state#33669, s_county#33670, 0), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, s_state#33669, null, 1), List(ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, s_store_sk#1386, s_store_id#1387, s_rec_start_date#1388, s_rec_end_date#1389, s_closed_date_sk#1390, s_store_name#1391, s_number_employees#1392, s_floor_space#1393, s_hours#1394, s_manager#1395, s_market_id#1396, s_geography_class#1397, s_market_desc#1398, s_market_manager#1399, s_division_id#1400, s_division_name#1401, s_company_id#1402, s_company_name#1403, s_street_number#1404, s_street_name#1405, s_street_type#1406, s_suite_number#1407, s_city#1408, s_county#1409, s_state#1410, s_zip#1411, s_country#1412, s_gmt_offset#1413, s_tax_precentage#1414, null, null, 3)], [ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, ... 59 more fields]\n                     +- Project [ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_list_price#1915, ss_sales_price#1916, ss_ext_discount_amt#1917, ss_ext_sales_price#1918, ss_ext_wholesale_cost#1919, ss_ext_list_price#1920, ss_ext_tax#1921, ss_coupon_amt#1922, ss_net_paid#1923, ss_net_paid_inc_tax#1924, ss_net_profit#1925, ss_sold_date_sk#1926, d_date_sk#1040, ... 58 more fields]\n                        +- Filter ((((d_month_seq#1043 >= 1200) && (d_month_seq#1043 <= (1200 + 11))) && (d_date_sk#1040 = ss_sold_date_sk#1926)) && ((s_store_sk#1386 = ss_store_sk#1910) && s_state#1410 IN (list#33646 [])))\n                           :  +- Project [s_state#33644]\n                           :     +- Filter (ranking#33645 <= 5)\n                           :        +- SubqueryAlias tmp1\n                           :           +- Project [s_state#33644, ranking#33645]\n                           :              +- Project [s_state#33644, _w0#33655, s_state#1410, _w2#33659, ranking#33645, ranking#33645]\n                           :                 +- Window [rank(_w2#33659) windowspecdefinition(s_state#1410, _w2#33659 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS ranking#33645], [s_state#1410], [_w2#33659 DESC NULLS LAST]\n                           :                    +- Aggregate [s_state#1410], [s_state#1410 AS s_state#33644, sum(ss_net_profit#1925) AS _w0#33655, s_state#1410, sum(ss_net_profit#1925) AS _w2#33659]\n                           :                       +- Filter ((((d_month_seq#1043 >= 1200) && (d_month_seq#1043 <= (1200 + 11))) && (d_date_sk#1040 = ss_sold_date_sk#1926)) && (s_store_sk#1386 = ss_store_sk#1910))\n                           :                          +- Join Inner\n                           :                             :- Join Inner\n                           :                             :  :- SubqueryAlias store_sales\n                           :                             :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                           :                             :  +- SubqueryAlias store\n                           :                             :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                           :                             +- SubqueryAlias date_dim\n                           :                                +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                           +- Join Inner\n                              :- Join Inner\n                              :  :- SubqueryAlias store_sales\n                              :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                              :  +- SubqueryAlias d1\n                              :     +- SubqueryAlias date_dim\n                              :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              +- SubqueryAlias store\n                                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [lochierarchy#33642 DESC NULLS LAST, CASE WHEN (cast(lochierarchy#33642 as int) = 0) THEN s_state#33671 END ASC NULLS FIRST, rank_within_parent#33643 ASC NULLS FIRST], true\n      +- Project [total_sum#33641, s_state#33671, s_county#33672, lochierarchy#33642, rank_within_parent#33643]\n         +- Window [rank(_w3#33687) windowspecdefinition(_w1#33685, _w2#33686, _w3#33687 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#33643], [_w1#33685, _w2#33686], [_w3#33687 DESC NULLS LAST]\n            +- Aggregate [s_state#33671, s_county#33672, spark_grouping_id#33668], [MakeDecimal(sum(UnscaledValue(ss_net_profit#1925)),17,2) AS total_sum#33641, s_state#33671, s_county#33672, (cast((shiftright(spark_grouping_id#33668, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#33668, 0) & 1) as tinyint)) AS lochierarchy#33642, (cast((shiftright(spark_grouping_id#33668, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#33668, 0) & 1) as tinyint)) AS _w1#33685, CASE WHEN (cast(cast((shiftright(spark_grouping_id#33668, 0) & 1) as tinyint) as int) = 0) THEN s_state#33671 END AS _w2#33686, MakeDecimal(sum(UnscaledValue(ss_net_profit#1925)),17,2) AS _w3#33687]\n               +- Expand [List(ss_net_profit#1925, s_state#1410, s_county#1409, 0), List(ss_net_profit#1925, s_state#1410, null, 1), List(ss_net_profit#1925, null, null, 3)], [ss_net_profit#1925, s_state#33671, s_county#33672, spark_grouping_id#33668]\n                  +- Project [ss_net_profit#1925, s_state#1410, s_county#1409]\n                     +- Join Inner, (s_store_sk#1386 = ss_store_sk#1910)\n                        :- Project [ss_store_sk#1910, ss_net_profit#1925]\n                        :  +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n                        :     :- Project [ss_store_sk#1910, ss_net_profit#1925, ss_sold_date_sk#1926]\n                        :     :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910))\n                        :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :     +- Project [d_date_sk#1040]\n                        :        +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Join LeftSemi, (s_state#1410 = s_state#33644)\n                           :- Project [s_store_sk#1386, s_county#1409, s_state#1410]\n                           :  +- Filter isnotnull(s_store_sk#1386)\n                           :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                           +- Project [s_state#33644]\n                              +- Filter (isnotnull(ranking#33645) && (ranking#33645 <= 5))\n                                 +- Window [rank(_w2#33659) windowspecdefinition(s_state#1410, _w2#33659 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS ranking#33645], [s_state#1410], [_w2#33659 DESC NULLS LAST]\n                                    +- Aggregate [s_state#1410], [s_state#1410 AS s_state#33644, s_state#1410, MakeDecimal(sum(UnscaledValue(ss_net_profit#1925)),17,2) AS _w2#33659]\n                                       +- Project [ss_net_profit#1925, s_state#1410]\n                                          +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n                                             :- Project [ss_net_profit#1925, ss_sold_date_sk#1926, s_state#1410]\n                                             :  +- Join Inner, (s_store_sk#1386 = ss_store_sk#1910)\n                                             :     :- Project [ss_store_sk#1910, ss_net_profit#1925, ss_sold_date_sk#1926]\n                                             :     :  +- Filter (isnotnull(ss_store_sk#1910) && isnotnull(ss_sold_date_sk#1926))\n                                             :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                             :     +- Project [s_store_sk#1386, s_state#1410]\n                                             :        +- Filter isnotnull(s_store_sk#1386)\n                                             :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                                             +- Project [d_date_sk#1040]\n                                                +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                                                   +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[lochierarchy#33642 DESC NULLS LAST,CASE WHEN (cast(lochierarchy#33642 as int) = 0) THEN s_state#33671 END ASC NULLS FIRST,rank_within_parent#33643 ASC NULLS FIRST], output=[total_sum#33641,s_state#33671,s_county#33672,lochierarchy#33642,rank_within_parent#33643])\n+- *(13) Project [total_sum#33641, s_state#33671, s_county#33672, lochierarchy#33642, rank_within_parent#33643]\n   +- Window [rank(_w3#33687) windowspecdefinition(_w1#33685, _w2#33686, _w3#33687 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#33643], [_w1#33685, _w2#33686], [_w3#33687 DESC NULLS LAST]\n      +- *(12) Sort [_w1#33685 ASC NULLS FIRST, _w2#33686 ASC NULLS FIRST, _w3#33687 DESC NULLS LAST], false, 0\n         +- Exchange hashpartitioning(_w1#33685, _w2#33686, 200)\n            +- *(11) HashAggregate(keys=[s_state#33671, s_county#33672, spark_grouping_id#33668], functions=[sum(UnscaledValue(ss_net_profit#1925))], output=[total_sum#33641, s_state#33671, s_county#33672, lochierarchy#33642, _w1#33685, _w2#33686, _w3#33687])\n               +- Exchange hashpartitioning(s_state#33671, s_county#33672, spark_grouping_id#33668, 200)\n                  +- *(10) HashAggregate(keys=[s_state#33671, s_county#33672, spark_grouping_id#33668], functions=[partial_sum(UnscaledValue(ss_net_profit#1925))], output=[s_state#33671, s_county#33672, spark_grouping_id#33668, sum#33709L])\n                     +- *(10) Expand [List(ss_net_profit#1925, s_state#1410, s_county#1409, 0), List(ss_net_profit#1925, s_state#1410, null, 1), List(ss_net_profit#1925, null, null, 3)], [ss_net_profit#1925, s_state#33671, s_county#33672, spark_grouping_id#33668]\n                        +- *(10) Project [ss_net_profit#1925, s_state#1410, s_county#1409]\n                           +- *(10) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                              :- *(10) Project [ss_store_sk#1910, ss_net_profit#1925]\n                              :  +- *(10) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                              :     :- *(10) Project [ss_store_sk#1910, ss_net_profit#1925, ss_sold_date_sk#1926]\n                              :     :  +- *(10) Filter isnotnull(ss_store_sk#1910)\n                              :     :     +- *(10) FileScan parquet db_tpcds.store_sales[ss_store_sk#1910,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:int,ss_net_profit:decimal(7,2)>\n                              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :        +- *(1) Project [d_date_sk#1040]\n                              :           +- *(1) Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                              :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_month_seq#1043] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>\n                              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 +- SortMergeJoin [s_state#1410], [s_state#33644], LeftSemi\n                                    :- *(3) Sort [s_state#1410 ASC NULLS FIRST], false, 0\n                                    :  +- Exchange hashpartitioning(s_state#1410, 200)\n                                    :     +- *(2) Project [s_store_sk#1386, s_county#1409, s_state#1410]\n                                    :        +- *(2) Filter isnotnull(s_store_sk#1386)\n                                    :           +- *(2) FileScan parquet db_tpcds.store[s_store_sk#1386,s_county#1409,s_state#1410] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_county:string,s_state:string>\n                                    +- *(9) Sort [s_state#33644 ASC NULLS FIRST], false, 0\n                                       +- Exchange hashpartitioning(s_state#33644, 200)\n                                          +- *(8) Project [s_state#33644]\n                                             +- *(8) Filter (isnotnull(ranking#33645) && (ranking#33645 <= 5))\n                                                +- Window [rank(_w2#33659) windowspecdefinition(s_state#1410, _w2#33659 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS ranking#33645], [s_state#1410], [_w2#33659 DESC NULLS LAST]\n                                                   +- *(7) Sort [s_state#1410 ASC NULLS FIRST, _w2#33659 DESC NULLS LAST], false, 0\n                                                      +- *(7) HashAggregate(keys=[s_state#1410], functions=[sum(UnscaledValue(ss_net_profit#1925))], output=[s_state#33644, s_state#1410, _w2#33659])\n                                                         +- Exchange hashpartitioning(s_state#1410, 200)\n                                                            +- *(6) HashAggregate(keys=[s_state#1410], functions=[partial_sum(UnscaledValue(ss_net_profit#1925))], output=[s_state#1410, sum#33711L])\n                                                               +- *(6) Project [ss_net_profit#1925, s_state#1410]\n                                                                  +- *(6) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                                                                     :- *(6) Project [ss_net_profit#1925, ss_sold_date_sk#1926, s_state#1410]\n                                                                     :  +- *(6) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                                                                     :     :- *(6) Project [ss_store_sk#1910, ss_net_profit#1925, ss_sold_date_sk#1926]\n                                                                     :     :  +- *(6) Filter isnotnull(ss_store_sk#1910)\n                                                                     :     :     +- *(6) FileScan parquet db_tpcds.store_sales[ss_store_sk#1910,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:int,ss_net_profit:decimal(7,2)>\n                                                                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                                                     :        +- *(4) Project [s_store_sk#1386, s_state#1410]\n                                                                     :           +- *(4) Filter isnotnull(s_store_sk#1386)\n                                                                     :              +- *(4) FileScan parquet db_tpcds.store[s_store_sk#1386,s_state#1410] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_state:string>\n                                                                     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q71-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["item","web_sales","date_dim","catalog_sales","date_dim","store_sales","date_dim","time_dim"],"parsingTime":0.002663,"analysisTime":0.00137,"optimizationTime":672.781087,"planningTime":29.519209,"executionTime":5994.203807,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'Sort ['ext_price DESC NULLS LAST, 'i_brand_id ASC NULLS FIRST], true\n+- 'Aggregate ['i_brand, 'i_brand_id, 't_hour, 't_minute], ['i_brand_id AS brand_id#33820, 'i_brand AS brand#33821, 't_hour, 't_minute, 'sum('ext_price) AS ext_price#33822]\n   +- 'Filter ((('sold_item_sk = 'i_item_sk) && ('i_manager_id = 1)) && (('time_sk = 't_time_sk) && (('t_meal_time = breakfast) || ('t_meal_time = dinner))))\n      +- 'Join Inner\n         :- 'Join Inner\n         :  :- 'UnresolvedRelation `item`\n         :  +- 'SubqueryAlias tmp\n         :     +- 'Union\n         :        :- 'Union\n         :        :  :- 'Project ['ws_ext_sales_price AS ext_price#33808, 'ws_sold_date_sk AS sold_date_sk#33809, 'ws_item_sk AS sold_item_sk#33810, 'ws_sold_time_sk AS time_sk#33811]\n         :        :  :  +- 'Filter ((('d_date_sk = 'ws_sold_date_sk) && ('d_moy = 11)) && ('d_year = 1999))\n         :        :  :     +- 'Join Inner\n         :        :  :        :- 'UnresolvedRelation `web_sales`\n         :        :  :        +- 'UnresolvedRelation `date_dim`\n         :        :  +- 'Project ['cs_ext_sales_price AS ext_price#33812, 'cs_sold_date_sk AS sold_date_sk#33813, 'cs_item_sk AS sold_item_sk#33814, 'cs_sold_time_sk AS time_sk#33815]\n         :        :     +- 'Filter ((('d_date_sk = 'cs_sold_date_sk) && ('d_moy = 11)) && ('d_year = 1999))\n         :        :        +- 'Join Inner\n         :        :           :- 'UnresolvedRelation `catalog_sales`\n         :        :           +- 'UnresolvedRelation `date_dim`\n         :        +- 'Project ['ss_ext_sales_price AS ext_price#33816, 'ss_sold_date_sk AS sold_date_sk#33817, 'ss_item_sk AS sold_item_sk#33818, 'ss_sold_time_sk AS time_sk#33819]\n         :           +- 'Filter ((('d_date_sk = 'ss_sold_date_sk) && ('d_moy = 11)) && ('d_year = 1999))\n         :              +- 'Join Inner\n         :                 :- 'UnresolvedRelation `store_sales`\n         :                 +- 'UnresolvedRelation `date_dim`\n         +- 'UnresolvedRelation `time_dim`\n\n== Analyzed Logical Plan ==\nbrand_id: int, brand: string, t_hour: int, t_minute: int, ext_price: decimal(17,2)\nProject [brand_id#33820, brand#33821, t_hour#1467, t_minute#1468, ext_price#33822]\n+- Sort [ext_price#33822 DESC NULLS LAST, brand_id#33820 ASC NULLS FIRST], true\n   +- Aggregate [i_brand#1180, i_brand_id#1179, t_hour#1467, t_minute#1468], [i_brand_id#1179 AS brand_id#33820, i_brand#1180 AS brand#33821, t_hour#1467, t_minute#1468, sum(ext_price#33808) AS ext_price#33822]\n      +- Filter (((sold_item_sk#33810 = i_item_sk#1172) && (i_manager_id#1192 = 1)) && ((time_sk#33811 = t_time_sk#1464) && ((t_meal_time#1473 = breakfast) || (t_meal_time#1473 = dinner))))\n         +- Join Inner\n            :- Join Inner\n            :  :- SubqueryAlias item\n            :  :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :  +- SubqueryAlias tmp\n            :     +- Union\n            :        :- Union\n            :        :  :- Project [ws_ext_sales_price#1777 AS ext_price#33808, ws_sold_date_sk#1788 AS sold_date_sk#33809, ws_item_sk#1757 AS sold_item_sk#33810, ws_sold_time_sk#1755 AS time_sk#33811]\n            :        :  :  +- Filter (((d_date_sk#1040 = ws_sold_date_sk#1788) && (d_moy#1048 = 11)) && (d_year#1046 = 1999))\n            :        :  :     +- Join Inner\n            :        :  :        :- SubqueryAlias web_sales\n            :        :  :        :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :        :  :        +- SubqueryAlias date_dim\n            :        :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :        :  +- Project [cs_ext_sales_price#1811 AS ext_price#33812, cs_sold_date_sk#1822 AS sold_date_sk#33813, cs_item_sk#1803 AS sold_item_sk#33814, cs_sold_time_sk#1789 AS time_sk#33815]\n            :        :     +- Filter (((d_date_sk#1040 = cs_sold_date_sk#1822) && (d_moy#1048 = 11)) && (d_year#1046 = 1999))\n            :        :        +- Join Inner\n            :        :           :- SubqueryAlias catalog_sales\n            :        :           :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :        :           +- SubqueryAlias date_dim\n            :        :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :        +- Project [ss_ext_sales_price#1918 AS ext_price#33816, ss_sold_date_sk#1926 AS sold_date_sk#33817, ss_item_sk#1905 AS sold_item_sk#33818, ss_sold_time_sk#1904 AS time_sk#33819]\n            :           +- Filter (((d_date_sk#1040 = ss_sold_date_sk#1926) && (d_moy#1048 = 11)) && (d_year#1046 = 1999))\n            :              +- Join Inner\n            :                 :- SubqueryAlias store_sales\n            :                 :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :                 +- SubqueryAlias date_dim\n            :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- SubqueryAlias time_dim\n               +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n\n== Optimized Logical Plan ==\nSort [ext_price#33822 DESC NULLS LAST, brand_id#33820 ASC NULLS FIRST], true\n+- Aggregate [i_brand#1180, i_brand_id#1179, t_hour#1467, t_minute#1468], [i_brand_id#1179 AS brand_id#33820, i_brand#1180 AS brand#33821, t_hour#1467, t_minute#1468, MakeDecimal(sum(UnscaledValue(ext_price#33808)),17,2) AS ext_price#33822]\n   +- Project [i_brand_id#1179, i_brand#1180, ext_price#33808, t_hour#1467, t_minute#1468]\n      +- Join Inner, (time_sk#33811 = t_time_sk#1464)\n         :- Project [i_brand_id#1179, i_brand#1180, ext_price#33808, time_sk#33811]\n         :  +- Join Inner, (sold_item_sk#33810 = i_item_sk#1172)\n         :     :- Project [i_item_sk#1172, i_brand_id#1179, i_brand#1180]\n         :     :  +- Filter ((isnotnull(i_manager_id#1192) && (i_manager_id#1192 = 1)) && isnotnull(i_item_sk#1172))\n         :     :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n         :     +- Union\n         :        :- Project [ws_ext_sales_price#1777 AS ext_price#33808, ws_item_sk#1757 AS sold_item_sk#33810, ws_sold_time_sk#1755 AS time_sk#33811]\n         :        :  +- Join Inner, (d_date_sk#1040 = ws_sold_date_sk#1788)\n         :        :     :- Project [ws_sold_time_sk#1755, ws_item_sk#1757, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n         :        :     :  +- Filter ((isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_item_sk#1757)) && isnotnull(ws_sold_time_sk#1755))\n         :        :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n         :        :     +- Project [d_date_sk#1040]\n         :        :        +- Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 11)) && (d_year#1046 = 1999)) && isnotnull(d_date_sk#1040))\n         :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :        :- Project [cs_ext_sales_price#1811 AS ext_price#33812, cs_item_sk#1803 AS sold_item_sk#33814, cs_sold_time_sk#1789 AS time_sk#33815]\n         :        :  +- Join Inner, (d_date_sk#1040 = cs_sold_date_sk#1822)\n         :        :     :- Project [cs_sold_time_sk#1789, cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n         :        :     :  +- Filter ((isnotnull(cs_sold_date_sk#1822) && isnotnull(cs_item_sk#1803)) && isnotnull(cs_sold_time_sk#1789))\n         :        :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n         :        :     +- Project [d_date_sk#1040]\n         :        :        +- Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 11)) && (d_year#1046 = 1999)) && isnotnull(d_date_sk#1040))\n         :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :        +- Project [ss_ext_sales_price#1918 AS ext_price#33816, ss_item_sk#1905 AS sold_item_sk#33818, ss_sold_time_sk#1904 AS time_sk#33819]\n         :           +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n         :              :- Project [ss_sold_time_sk#1904, ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n         :              :  +- Filter ((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_item_sk#1905)) && isnotnull(ss_sold_time_sk#1904))\n         :              :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :              +- Project [d_date_sk#1040]\n         :                 +- Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 11)) && (d_year#1046 = 1999)) && isnotnull(d_date_sk#1040))\n         :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         +- Project [t_time_sk#1464, t_hour#1467, t_minute#1468]\n            +- Filter (((t_meal_time#1473 = breakfast) || (t_meal_time#1473 = dinner)) && isnotnull(t_time_sk#1464))\n               +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n\n== Physical Plan ==\n*(11) Sort [ext_price#33822 DESC NULLS LAST, brand_id#33820 ASC NULLS FIRST], true, 0\n+- Exchange rangepartitioning(ext_price#33822 DESC NULLS LAST, brand_id#33820 ASC NULLS FIRST, 200)\n   +- *(10) HashAggregate(keys=[i_brand#1180, i_brand_id#1179, t_hour#1467, t_minute#1468], functions=[sum(UnscaledValue(ext_price#33808))], output=[brand_id#33820, brand#33821, t_hour#1467, t_minute#1468, ext_price#33822])\n      +- Exchange hashpartitioning(i_brand#1180, i_brand_id#1179, t_hour#1467, t_minute#1468, 200)\n         +- *(9) HashAggregate(keys=[i_brand#1180, i_brand_id#1179, t_hour#1467, t_minute#1468], functions=[partial_sum(UnscaledValue(ext_price#33808))], output=[i_brand#1180, i_brand_id#1179, t_hour#1467, t_minute#1468, sum#33833L])\n            +- *(9) Project [i_brand_id#1179, i_brand#1180, ext_price#33808, t_hour#1467, t_minute#1468]\n               +- *(9) BroadcastHashJoin [time_sk#33811], [t_time_sk#1464], Inner, BuildRight\n                  :- *(9) Project [i_brand_id#1179, i_brand#1180, ext_price#33808, time_sk#33811]\n                  :  +- *(9) BroadcastHashJoin [i_item_sk#1172], [sold_item_sk#33810], Inner, BuildLeft\n                  :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :  +- *(1) Project [i_item_sk#1172, i_brand_id#1179, i_brand#1180]\n                  :     :     +- *(1) Filter ((isnotnull(i_manager_id#1192) && (i_manager_id#1192 = 1)) && isnotnull(i_item_sk#1172))\n                  :     :        +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_brand#1180,i_manager_id#1192] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_manager_id), EqualTo(i_manager_id,1), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_brand:string,i_manager_id:int>\n                  :     +- Union\n                  :        :- *(3) Project [ws_ext_sales_price#1777 AS ext_price#33808, ws_item_sk#1757 AS sold_item_sk#33810, ws_sold_time_sk#1755 AS time_sk#33811]\n                  :        :  +- *(3) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                  :        :     :- *(3) Project [ws_sold_time_sk#1755, ws_item_sk#1757, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                  :        :     :  +- *(3) Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_time_sk#1755))\n                  :        :     :     +- *(3) FileScan parquet db_tpcds.web_sales[ws_sold_time_sk#1755,ws_item_sk#1757,ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_sold_time_sk)], ReadSchema: struct<ws_sold_time_sk:int,ws_item_sk:int,ws_ext_sales_price:decimal(7,2)>\n                  :        :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :        :        +- *(2) Project [d_date_sk#1040]\n                  :        :           +- *(2) Filter ((((isnotnull(d_moy#1048) && isnotnull(d_year#1046)) && (d_moy#1048 = 11)) && (d_year#1046 = 1999)) && isnotnull(d_date_sk#1040))\n                  :        :              +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_moy), IsNotNull(d_year), EqualTo(d_moy,11), EqualTo(d_year,1999), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n                  :        :- *(5) Project [cs_ext_sales_price#1811 AS ext_price#33812, cs_item_sk#1803 AS sold_item_sk#33814, cs_sold_time_sk#1789 AS time_sk#33815]\n                  :        :  +- *(5) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n                  :        :     :- *(5) Project [cs_sold_time_sk#1789, cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n                  :        :     :  +- *(5) Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_time_sk#1789))\n                  :        :     :     +- *(5) FileScan parquet db_tpcds.catalog_sales[cs_sold_time_sk#1789,cs_item_sk#1803,cs_ext_sales_price#1811,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_sold_time_sk)], ReadSchema: struct<cs_sold_time_sk:int,cs_item_sk:int,cs_ext_sales_price:decimal(7,2)>\n                  :        :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :        +- *(7) Project [ss_ext_sales_price#1918 AS ext_price#33816, ss_item_sk#1905 AS sold_item_sk#33818, ss_sold_time_sk#1904 AS time_sk#33819]\n                  :           +- *(7) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                  :              :- *(7) Project [ss_sold_time_sk#1904, ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                  :              :  +- *(7) Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_time_sk#1904))\n                  :              :     +- *(7) FileScan parquet db_tpcds.store_sales[ss_sold_time_sk#1904,ss_item_sk#1905,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_sold_time_sk)], ReadSchema: struct<ss_sold_time_sk:int,ss_item_sk:int,ss_ext_sales_price:decimal(7,2)>\n                  :              +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     +- *(8) Project [t_time_sk#1464, t_hour#1467, t_minute#1468]\n                        +- *(8) Filter (((t_meal_time#1473 = breakfast) || (t_meal_time#1473 = dinner)) && isnotnull(t_time_sk#1464))\n                           +- *(8) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_hour#1467,t_minute#1468,t_meal_time#1473] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [Or(EqualTo(t_meal_time,breakfast),EqualTo(t_meal_time,dinner)), IsNotNull(t_time_sk)], ReadSchema: struct<t_time_sk:int,t_hour:int,t_minute:int,t_meal_time:string>"},{"name":"q72-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin"],"tables":["catalog_sales","inventory","warehouse","item","customer_demographics","household_demographics","date_dim","date_dim","date_dim","promotion","catalog_returns"],"parsingTime":0.002022,"analysisTime":0.001638,"optimizationTime":617.15883,"planningTime":282.573957,"executionTime":20076.290946,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['total_cnt DESC NULLS LAST, 'i_item_desc ASC NULLS FIRST, 'w_warehouse_name ASC NULLS FIRST, 'd1.d_week_seq ASC NULLS FIRST], true\n      +- 'Aggregate ['i_item_desc, 'w_warehouse_name, 'd1.d_week_seq], ['i_item_desc, 'w_warehouse_name, 'd1.d_week_seq, 'sum(CASE WHEN isnull('p_promo_sk) THEN 1 ELSE 0 END) AS no_promo#33937, 'sum(CASE WHEN isnotnull('p_promo_sk) THEN 1 ELSE 0 END) AS promo#33938, 'count(1) AS total_cnt#33939]\n         +- 'Filter (((('d1.d_week_seq = 'd2.d_week_seq) && ('inv_quantity_on_hand < 'cs_quantity)) && ('d3.d_date > (cast('d1.d_date as date) + interval 5 days))) && ((('hd_buy_potential = >10000) && ('d1.d_year = 1999)) && ('cd_marital_status = D)))\n            +- 'Join LeftOuter, (('cr_item_sk = 'cs_item_sk) && ('cr_order_number = 'cs_order_number))\n               :- 'Join LeftOuter, ('cs_promo_sk = 'p_promo_sk)\n               :  :- 'Join Inner, ('cs_ship_date_sk = 'd3.d_date_sk)\n               :  :  :- 'Join Inner, ('inv_date_sk = 'd2.d_date_sk)\n               :  :  :  :- 'Join Inner, ('cs_sold_date_sk = 'd1.d_date_sk)\n               :  :  :  :  :- 'Join Inner, ('cs_bill_hdemo_sk = 'hd_demo_sk)\n               :  :  :  :  :  :- 'Join Inner, ('cs_bill_cdemo_sk = 'cd_demo_sk)\n               :  :  :  :  :  :  :- 'Join Inner, ('i_item_sk = 'cs_item_sk)\n               :  :  :  :  :  :  :  :- 'Join Inner, ('w_warehouse_sk = 'inv_warehouse_sk)\n               :  :  :  :  :  :  :  :  :- 'Join Inner, ('cs_item_sk = 'inv_item_sk)\n               :  :  :  :  :  :  :  :  :  :- 'UnresolvedRelation `catalog_sales`\n               :  :  :  :  :  :  :  :  :  +- 'UnresolvedRelation `inventory`\n               :  :  :  :  :  :  :  :  +- 'UnresolvedRelation `warehouse`\n               :  :  :  :  :  :  :  +- 'UnresolvedRelation `item`\n               :  :  :  :  :  :  +- 'UnresolvedRelation `customer_demographics`\n               :  :  :  :  :  +- 'UnresolvedRelation `household_demographics`\n               :  :  :  :  +- 'SubqueryAlias d1\n               :  :  :  :     +- 'UnresolvedRelation `date_dim`\n               :  :  :  +- 'SubqueryAlias d2\n               :  :  :     +- 'UnresolvedRelation `date_dim`\n               :  :  +- 'SubqueryAlias d3\n               :  :     +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `promotion`\n               +- 'UnresolvedRelation `catalog_returns`\n\n== Analyzed Logical Plan ==\ni_item_desc: string, w_warehouse_name: string, d_week_seq: int, no_promo: bigint, promo: bigint, total_cnt: bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [total_cnt#33939L DESC NULLS LAST, i_item_desc#1176 ASC NULLS FIRST, w_warehouse_name#1514 ASC NULLS FIRST, d_week_seq#1044 ASC NULLS FIRST], true\n      +- Aggregate [i_item_desc#1176, w_warehouse_name#1514, d_week_seq#1044], [i_item_desc#1176, w_warehouse_name#1514, d_week_seq#1044, sum(cast(CASE WHEN isnull(p_promo_sk#1254) THEN 1 ELSE 0 END as bigint)) AS no_promo#33937L, sum(cast(CASE WHEN isnotnull(p_promo_sk#1254) THEN 1 ELSE 0 END as bigint)) AS promo#33938L, count(1) AS total_cnt#33939L]\n         +- Filter ((((d_week_seq#1044 = d_week_seq#33945) && (inv_quantity_on_hand#2867 < cs_quantity#1806)) && (d_date#33971 > cast(cast(cast(d_date#1042 as date) as timestamp) + interval 5 days as date))) && (((hd_buy_potential#1108 = >10000) && (d_year#1046 = 1999)) && (cd_marital_status#968 = D)))\n            +- Join LeftOuter, ((cr_item_sk#2087 = cs_item_sk#1803) && (cr_order_number#2101L = cs_order_number#1805L))\n               :- Join LeftOuter, (cs_promo_sk#1804 = p_promo_sk#1254)\n               :  :- Join Inner, (cs_ship_date_sk#1790 = d_date_sk#33969)\n               :  :  :- Join Inner, (inv_date_sk#2868 = d_date_sk#33941)\n               :  :  :  :- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :  :  :  :  :- Join Inner, (cs_bill_hdemo_sk#1793 = hd_demo_sk#1106)\n               :  :  :  :  :  :- Join Inner, (cs_bill_cdemo_sk#1792 = cd_demo_sk#966)\n               :  :  :  :  :  :  :- Join Inner, (i_item_sk#1172 = cs_item_sk#1803)\n               :  :  :  :  :  :  :  :- Join Inner, (w_warehouse_sk#1512 = inv_warehouse_sk#2866)\n               :  :  :  :  :  :  :  :  :- Join Inner, (cs_item_sk#1803 = inv_item_sk#2865)\n               :  :  :  :  :  :  :  :  :  :- SubqueryAlias catalog_sales\n               :  :  :  :  :  :  :  :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :  :  :  :  :  :  :  :  :  +- SubqueryAlias inventory\n               :  :  :  :  :  :  :  :  :     +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n               :  :  :  :  :  :  :  :  +- SubqueryAlias warehouse\n               :  :  :  :  :  :  :  :     +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n               :  :  :  :  :  :  :  +- SubqueryAlias item\n               :  :  :  :  :  :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  :  :  :  :  :  +- SubqueryAlias customer_demographics\n               :  :  :  :  :  :     +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n               :  :  :  :  :  +- SubqueryAlias household_demographics\n               :  :  :  :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n               :  :  :  :  +- SubqueryAlias d1\n               :  :  :  :     +- SubqueryAlias date_dim\n               :  :  :  :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :  +- SubqueryAlias d2\n               :  :  :     +- SubqueryAlias date_dim\n               :  :  :        +- Relation[d_date_sk#33941,d_date_id#33942,d_date#33943,d_month_seq#33944,d_week_seq#33945,d_quarter_seq#33946,d_year#33947,d_dow#33948,d_moy#33949,d_dom#33950,d_qoy#33951,d_fy_year#33952,d_fy_quarter_seq#33953,d_fy_week_seq#33954,d_day_name#33955,d_quarter_name#33956,d_holiday#33957,d_weekend#33958,d_following_holiday#33959,d_first_dom#33960,d_last_dom#33961,d_same_day_ly#33962,d_same_day_lq#33963,d_current_day#33964,... 4 more fields] parquet\n               :  :  +- SubqueryAlias d3\n               :  :     +- SubqueryAlias date_dim\n               :  :        +- Relation[d_date_sk#33969,d_date_id#33970,d_date#33971,d_month_seq#33972,d_week_seq#33973,d_quarter_seq#33974,d_year#33975,d_dow#33976,d_moy#33977,d_dom#33978,d_qoy#33979,d_fy_year#33980,d_fy_quarter_seq#33981,d_fy_week_seq#33982,d_day_name#33983,d_quarter_name#33984,d_holiday#33985,d_weekend#33986,d_following_holiday#33987,d_first_dom#33988,d_last_dom#33989,d_same_day_ly#33990,d_same_day_lq#33991,d_current_day#33992,... 4 more fields] parquet\n               :  +- SubqueryAlias promotion\n               :     +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n               +- SubqueryAlias catalog_returns\n                  +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [total_cnt#33939L DESC NULLS LAST, i_item_desc#1176 ASC NULLS FIRST, w_warehouse_name#1514 ASC NULLS FIRST, d_week_seq#1044 ASC NULLS FIRST], true\n      +- Aggregate [i_item_desc#1176, w_warehouse_name#1514, d_week_seq#1044], [i_item_desc#1176, w_warehouse_name#1514, d_week_seq#1044, sum(cast(CASE WHEN isnull(p_promo_sk#1254) THEN 1 ELSE 0 END as bigint)) AS no_promo#33937L, sum(cast(CASE WHEN isnotnull(p_promo_sk#1254) THEN 1 ELSE 0 END as bigint)) AS promo#33938L, count(1) AS total_cnt#33939L]\n         +- Project [w_warehouse_name#1514, i_item_desc#1176, d_week_seq#1044, p_promo_sk#1254]\n            +- Join LeftOuter, ((cr_item_sk#2087 = cs_item_sk#1803) && (cr_order_number#2101L = cs_order_number#1805L))\n               :- Project [cs_item_sk#1803, cs_order_number#1805L, w_warehouse_name#1514, i_item_desc#1176, d_week_seq#1044, p_promo_sk#1254]\n               :  +- Join LeftOuter, (cs_promo_sk#1804 = p_promo_sk#1254)\n               :     :- Project [cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, w_warehouse_name#1514, i_item_desc#1176, d_week_seq#1044]\n               :     :  +- Join Inner, ((d_date#33971 > cast(cast(d_date#1042 as timestamp) + interval 5 days as date)) && (cs_ship_date_sk#1790 = d_date_sk#33969))\n               :     :     :- Project [cs_ship_date_sk#1790, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, w_warehouse_name#1514, i_item_desc#1176, d_date#1042, d_week_seq#1044]\n               :     :     :  +- Join Inner, ((d_week_seq#1044 = d_week_seq#33945) && (inv_date_sk#2868 = d_date_sk#33941))\n               :     :     :     :- Project [cs_ship_date_sk#1790, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, inv_date_sk#2868, w_warehouse_name#1514, i_item_desc#1176, d_date#1042, d_week_seq#1044]\n               :     :     :     :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :     :     :     :     :- Project [cs_ship_date_sk#1790, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_sold_date_sk#1822, inv_date_sk#2868, w_warehouse_name#1514, i_item_desc#1176]\n               :     :     :     :     :  +- Join Inner, (cs_bill_hdemo_sk#1793 = hd_demo_sk#1106)\n               :     :     :     :     :     :- Project [cs_ship_date_sk#1790, cs_bill_hdemo_sk#1793, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_sold_date_sk#1822, inv_date_sk#2868, w_warehouse_name#1514, i_item_desc#1176]\n               :     :     :     :     :     :  +- Join Inner, (cs_bill_cdemo_sk#1792 = cd_demo_sk#966)\n               :     :     :     :     :     :     :- Project [cs_ship_date_sk#1790, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_sold_date_sk#1822, inv_date_sk#2868, w_warehouse_name#1514, i_item_desc#1176]\n               :     :     :     :     :     :     :  +- Join Inner, (i_item_sk#1172 = cs_item_sk#1803)\n               :     :     :     :     :     :     :     :- Project [cs_ship_date_sk#1790, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_sold_date_sk#1822, inv_date_sk#2868, w_warehouse_name#1514]\n               :     :     :     :     :     :     :     :  +- Join Inner, (w_warehouse_sk#1512 = inv_warehouse_sk#2866)\n               :     :     :     :     :     :     :     :     :- Project [cs_ship_date_sk#1790, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_sold_date_sk#1822, inv_warehouse_sk#2866, inv_date_sk#2868]\n               :     :     :     :     :     :     :     :     :  +- Join Inner, ((inv_quantity_on_hand#2867 < cs_quantity#1806) && (cs_item_sk#1803 = inv_item_sk#2865))\n               :     :     :     :     :     :     :     :     :     :- Project [cs_ship_date_sk#1790, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_sold_date_sk#1822]\n               :     :     :     :     :     :     :     :     :     :  +- Filter (((((isnotnull(cs_item_sk#1803) && isnotnull(cs_quantity#1806)) && isnotnull(cs_bill_cdemo_sk#1792)) && isnotnull(cs_bill_hdemo_sk#1793)) && isnotnull(cs_sold_date_sk#1822)) && isnotnull(cs_ship_date_sk#1790))\n               :     :     :     :     :     :     :     :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :     :     :     :     :     :     :     :     +- Filter (((isnotnull(inv_item_sk#2865) && isnotnull(inv_quantity_on_hand#2867)) && isnotnull(inv_warehouse_sk#2866)) && isnotnull(inv_date_sk#2868))\n               :     :     :     :     :     :     :     :     :        +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n               :     :     :     :     :     :     :     :     +- Project [w_warehouse_sk#1512, w_warehouse_name#1514]\n               :     :     :     :     :     :     :     :        +- Filter isnotnull(w_warehouse_sk#1512)\n               :     :     :     :     :     :     :     :           +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n               :     :     :     :     :     :     :     +- Project [i_item_sk#1172, i_item_desc#1176]\n               :     :     :     :     :     :     :        +- Filter isnotnull(i_item_sk#1172)\n               :     :     :     :     :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :     :     :     :     :     :     +- Project [cd_demo_sk#966]\n               :     :     :     :     :     :        +- Filter ((isnotnull(cd_marital_status#968) && (cd_marital_status#968 = D)) && isnotnull(cd_demo_sk#966))\n               :     :     :     :     :     :           +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n               :     :     :     :     :     +- Project [hd_demo_sk#1106]\n               :     :     :     :     :        +- Filter ((isnotnull(hd_buy_potential#1108) && (hd_buy_potential#1108 = >10000)) && isnotnull(hd_demo_sk#1106))\n               :     :     :     :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n               :     :     :     :     +- Project [d_date_sk#1040, d_date#1042, d_week_seq#1044]\n               :     :     :     :        +- Filter (((isnotnull(d_year#1046) && (d_year#1046 = 1999)) && isnotnull(d_date_sk#1040)) && isnotnull(d_week_seq#1044))\n               :     :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :     :     +- Project [d_date_sk#33941, d_week_seq#33945]\n               :     :     :        +- Filter (isnotnull(d_date_sk#33941) && isnotnull(d_week_seq#33945))\n               :     :     :           +- Relation[d_date_sk#33941,d_date_id#33942,d_date#33943,d_month_seq#33944,d_week_seq#33945,d_quarter_seq#33946,d_year#33947,d_dow#33948,d_moy#33949,d_dom#33950,d_qoy#33951,d_fy_year#33952,d_fy_quarter_seq#33953,d_fy_week_seq#33954,d_day_name#33955,d_quarter_name#33956,d_holiday#33957,d_weekend#33958,d_following_holiday#33959,d_first_dom#33960,d_last_dom#33961,d_same_day_ly#33962,d_same_day_lq#33963,d_current_day#33964,... 4 more fields] parquet\n               :     :     +- Project [d_date_sk#33969, d_date#33971]\n               :     :        +- Filter (isnotnull(d_date_sk#33969) && isnotnull(d_date#33971))\n               :     :           +- Relation[d_date_sk#33969,d_date_id#33970,d_date#33971,d_month_seq#33972,d_week_seq#33973,d_quarter_seq#33974,d_year#33975,d_dow#33976,d_moy#33977,d_dom#33978,d_qoy#33979,d_fy_year#33980,d_fy_quarter_seq#33981,d_fy_week_seq#33982,d_day_name#33983,d_quarter_name#33984,d_holiday#33985,d_weekend#33986,d_following_holiday#33987,d_first_dom#33988,d_last_dom#33989,d_same_day_ly#33990,d_same_day_lq#33991,d_current_day#33992,... 4 more fields] parquet\n               :     +- Project [p_promo_sk#1254]\n               :        +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n               +- Project [cr_item_sk#2087, cr_order_number#2101L]\n                  +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[total_cnt#33939L DESC NULLS LAST,i_item_desc#1176 ASC NULLS FIRST,w_warehouse_name#1514 ASC NULLS FIRST,d_week_seq#1044 ASC NULLS FIRST], output=[i_item_desc#1176,w_warehouse_name#1514,d_week_seq#1044,no_promo#33937L,promo#33938L,total_cnt#33939L])\n+- *(18) HashAggregate(keys=[i_item_desc#1176, w_warehouse_name#1514, d_week_seq#1044], functions=[sum(cast(CASE WHEN isnull(p_promo_sk#1254) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN isnotnull(p_promo_sk#1254) THEN 1 ELSE 0 END as bigint)), count(1)], output=[i_item_desc#1176, w_warehouse_name#1514, d_week_seq#1044, no_promo#33937L, promo#33938L, total_cnt#33939L])\n   +- Exchange hashpartitioning(i_item_desc#1176, w_warehouse_name#1514, d_week_seq#1044, 200)\n      +- *(17) HashAggregate(keys=[i_item_desc#1176, w_warehouse_name#1514, d_week_seq#1044], functions=[partial_sum(cast(CASE WHEN isnull(p_promo_sk#1254) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN isnotnull(p_promo_sk#1254) THEN 1 ELSE 0 END as bigint)), partial_count(1)], output=[i_item_desc#1176, w_warehouse_name#1514, d_week_seq#1044, sum#34012L, sum#34013L, count#34014L])\n         +- *(17) Project [w_warehouse_name#1514, i_item_desc#1176, d_week_seq#1044, p_promo_sk#1254]\n            +- SortMergeJoin [cs_item_sk#1803, cs_order_number#1805L], [cr_item_sk#2087, cr_order_number#2101L], LeftOuter\n               :- *(14) Sort [cs_item_sk#1803 ASC NULLS FIRST, cs_order_number#1805L ASC NULLS FIRST], false, 0\n               :  +- Exchange hashpartitioning(cs_item_sk#1803, cs_order_number#1805L, 200)\n               :     +- *(13) Project [cs_item_sk#1803, cs_order_number#1805L, w_warehouse_name#1514, i_item_desc#1176, d_week_seq#1044, p_promo_sk#1254]\n               :        +- *(13) BroadcastHashJoin [cs_promo_sk#1804], [p_promo_sk#1254], LeftOuter, BuildRight\n               :           :- *(13) Project [cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, w_warehouse_name#1514, i_item_desc#1176, d_week_seq#1044]\n               :           :  +- *(13) BroadcastHashJoin [cs_ship_date_sk#1790], [d_date_sk#33969], Inner, BuildRight, (d_date#33971 > cast(cast(d_date#1042 as timestamp) + interval 5 days as date))\n               :           :     :- *(13) Project [cs_ship_date_sk#1790, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, w_warehouse_name#1514, i_item_desc#1176, d_date#1042, d_week_seq#1044]\n               :           :     :  +- *(13) BroadcastHashJoin [d_week_seq#1044, inv_date_sk#2868], [d_week_seq#33945, d_date_sk#33941], Inner, BuildRight\n               :           :     :     :- *(13) Project [cs_ship_date_sk#1790, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, inv_date_sk#2868, w_warehouse_name#1514, i_item_desc#1176, d_date#1042, d_week_seq#1044]\n               :           :     :     :  +- *(13) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :           :     :     :     :- *(13) Project [cs_ship_date_sk#1790, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_sold_date_sk#1822, inv_date_sk#2868, w_warehouse_name#1514, i_item_desc#1176]\n               :           :     :     :     :  +- *(13) BroadcastHashJoin [cs_bill_hdemo_sk#1793], [hd_demo_sk#1106], Inner, BuildRight\n               :           :     :     :     :     :- *(13) Project [cs_ship_date_sk#1790, cs_bill_hdemo_sk#1793, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_sold_date_sk#1822, inv_date_sk#2868, w_warehouse_name#1514, i_item_desc#1176]\n               :           :     :     :     :     :  +- *(13) BroadcastHashJoin [cs_bill_cdemo_sk#1792], [cd_demo_sk#966], Inner, BuildRight\n               :           :     :     :     :     :     :- *(13) Project [cs_ship_date_sk#1790, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_sold_date_sk#1822, inv_date_sk#2868, w_warehouse_name#1514, i_item_desc#1176]\n               :           :     :     :     :     :     :  +- *(13) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n               :           :     :     :     :     :     :     :- *(13) Project [cs_ship_date_sk#1790, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_sold_date_sk#1822, inv_date_sk#2868, w_warehouse_name#1514]\n               :           :     :     :     :     :     :     :  +- *(13) BroadcastHashJoin [inv_warehouse_sk#2866], [w_warehouse_sk#1512], Inner, BuildRight\n               :           :     :     :     :     :     :     :     :- *(13) Project [cs_ship_date_sk#1790, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_sold_date_sk#1822, inv_warehouse_sk#2866, inv_date_sk#2868]\n               :           :     :     :     :     :     :     :     :  +- *(13) SortMergeJoin [cs_item_sk#1803], [inv_item_sk#2865], Inner, (inv_quantity_on_hand#2867 < cs_quantity#1806)\n               :           :     :     :     :     :     :     :     :     :- *(2) Sort [cs_item_sk#1803 ASC NULLS FIRST], false, 0\n               :           :     :     :     :     :     :     :     :     :  +- Exchange hashpartitioning(cs_item_sk#1803, 200)\n               :           :     :     :     :     :     :     :     :     :     +- *(1) Project [cs_ship_date_sk#1790, cs_bill_cdemo_sk#1792, cs_bill_hdemo_sk#1793, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_quantity#1806, cs_sold_date_sk#1822]\n               :           :     :     :     :     :     :     :     :     :        +- *(1) Filter ((((isnotnull(cs_item_sk#1803) && isnotnull(cs_quantity#1806)) && isnotnull(cs_bill_cdemo_sk#1792)) && isnotnull(cs_bill_hdemo_sk#1793)) && isnotnull(cs_ship_date_sk#1790))\n               :           :     :     :     :     :     :     :     :     :           +- *(1) FileScan parquet db_tpcds.catalog_sales[cs_ship_date_sk#1790,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk), IsNotNull(cs_quantity), IsNotNull(cs_bill_cdemo_sk), IsNotNull(cs_bill_hd..., ReadSchema: struct<cs_ship_date_sk:int,cs_bill_cdemo_sk:int,cs_bill_hdemo_sk:int,cs_item_sk:int,cs_promo_sk:i...\n               :           :     :     :     :     :     :     :     :     +- *(4) Sort [inv_item_sk#2865 ASC NULLS FIRST], false, 0\n               :           :     :     :     :     :     :     :     :        +- Exchange hashpartitioning(inv_item_sk#2865, 200)\n               :           :     :     :     :     :     :     :     :           +- *(3) Project [inv_item_sk#2865, inv_warehouse_sk#2866, inv_quantity_on_hand#2867, inv_date_sk#2868]\n               :           :     :     :     :     :     :     :     :              +- *(3) Filter ((isnotnull(inv_item_sk#2865) && isnotnull(inv_quantity_on_hand#2867)) && isnotnull(inv_warehouse_sk#2866))\n               :           :     :     :     :     :     :     :     :                 +- *(3) FileScan parquet db_tpcds.inventory[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/inventory/inv_dat..., PartitionCount: 261, PartitionFilters: [isnotnull(inv_date_sk#2868)], PushedFilters: [IsNotNull(inv_item_sk), IsNotNull(inv_quantity_on_hand), IsNotNull(inv_warehouse_sk)], ReadSchema: struct<inv_item_sk:int,inv_warehouse_sk:int,inv_quantity_on_hand:int>\n               :           :     :     :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :           :     :     :     :     :     :     :        +- *(5) Project [w_warehouse_sk#1512, w_warehouse_name#1514]\n               :           :     :     :     :     :     :     :           +- *(5) Filter isnotnull(w_warehouse_sk#1512)\n               :           :     :     :     :     :     :     :              +- *(5) FileScan parquet db_tpcds.warehouse[w_warehouse_sk#1512,w_warehouse_name#1514] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/warehouse], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>\n               :           :     :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :           :     :     :     :     :     :        +- *(6) Project [i_item_sk#1172, i_item_desc#1176]\n               :           :     :     :     :     :     :           +- *(6) Filter isnotnull(i_item_sk#1172)\n               :           :     :     :     :     :     :              +- *(6) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_desc#1176] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_desc:string>\n               :           :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :           :     :     :     :     :        +- *(7) Project [cd_demo_sk#966]\n               :           :     :     :     :     :           +- *(7) Filter ((isnotnull(cd_marital_status#968) && (cd_marital_status#968 = D)) && isnotnull(cd_demo_sk#966))\n               :           :     :     :     :     :              +- *(7) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_marital_status#968] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_marital_status), EqualTo(cd_marital_status,D), IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:int,cd_marital_status:string>\n               :           :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :           :     :     :     :        +- *(8) Project [hd_demo_sk#1106]\n               :           :     :     :     :           +- *(8) Filter ((isnotnull(hd_buy_potential#1108) && (hd_buy_potential#1108 = >10000)) && isnotnull(hd_demo_sk#1106))\n               :           :     :     :     :              +- *(8) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_buy_potential#1108] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(hd_buy_potential), EqualTo(hd_buy_potential,>10000), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:int,hd_buy_potential:string>\n               :           :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :           :     :     :        +- *(9) Project [d_date_sk#1040, d_date#1042, d_week_seq#1044]\n               :           :     :     :           +- *(9) Filter (((isnotnull(d_year#1046) && (d_year#1046 = 1999)) && isnotnull(d_date_sk#1040)) && isnotnull(d_week_seq#1044))\n               :           :     :     :              +- *(9) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042,d_week_seq#1044,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,1999), IsNotNull(d_date_sk), IsNotNull(d_week_seq)], ReadSchema: struct<d_date_sk:int,d_date:date,d_week_seq:int,d_year:int>\n               :           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List((shiftleft(cast(input[1, int, true] as bigint), 32) | (cast(input[0, int, true] as bigint) & 4294967295))))\n               :           :     :        +- *(10) Project [d_date_sk#33941, d_week_seq#33945]\n               :           :     :           +- *(10) Filter (isnotnull(d_date_sk#33941) && isnotnull(d_week_seq#33945))\n               :           :     :              +- *(10) FileScan parquet db_tpcds.date_dim[d_date_sk#33941,d_week_seq#33945] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), IsNotNull(d_week_seq)], ReadSchema: struct<d_date_sk:int,d_week_seq:int>\n               :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :           :        +- *(11) Project [d_date_sk#33969, d_date#33971]\n               :           :           +- *(11) Filter (isnotnull(d_date_sk#33969) && isnotnull(d_date#33971))\n               :           :              +- *(11) FileScan parquet db_tpcds.date_dim[d_date_sk#33969,d_date#33971] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), IsNotNull(d_date)], ReadSchema: struct<d_date_sk:int,d_date:date>\n               :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :              +- *(12) FileScan parquet db_tpcds.promotion[p_promo_sk#1254] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/promotion], PartitionFilters: [], PushedFilters: [], ReadSchema: struct<p_promo_sk:int>\n               +- *(16) Sort [cr_item_sk#2087 ASC NULLS FIRST, cr_order_number#2101L ASC NULLS FIRST], false, 0\n                  +- Exchange hashpartitioning(cr_item_sk#2087, cr_order_number#2101L, 200)\n                     +- *(15) Project [cr_item_sk#2087, cr_order_number#2101L]\n                        +- *(15) FileScan parquet db_tpcds.catalog_returns[cr_item_sk#2087,cr_order_number#2101L,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns], PartitionCount: 2066, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<cr_item_sk:int,cr_order_number:bigint>"},{"name":"q73-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","date_dim","store","household_demographics","customer"],"parsingTime":0.002626,"analysisTime":9.2E-4,"optimizationTime":273.464546,"planningTime":12.715282,"executionTime":2746.877215,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'Sort ['cnt DESC NULLS LAST, 'c_last_name ASC NULLS FIRST], true\n+- 'Project ['c_last_name, 'c_first_name, 'c_salutation, 'c_preferred_cust_flag, 'ss_ticket_number, 'cnt]\n   +- 'Filter (('ss_customer_sk = 'c_customer_sk) && (('cnt >= 1) && ('cnt <= 5)))\n      +- 'Join Inner\n         :- 'SubqueryAlias dj\n         :  +- 'Aggregate ['ss_ticket_number, 'ss_customer_sk], ['ss_ticket_number, 'ss_customer_sk, 'count(1) AS cnt#34098]\n         :     +- 'Filter ((((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) && ('store_sales.ss_store_sk = 'store.s_store_sk)) && ('store_sales.ss_hdemo_sk = 'household_demographics.hd_demo_sk)) && ((('date_dim.d_dom >= 1) && ('date_dim.d_dom <= 2)) && (('household_demographics.hd_buy_potential = >10000) || ('household_demographics.hd_buy_potential = unknown)))) && ((('household_demographics.hd_vehicle_count > 0) && (CASE WHEN ('household_demographics.hd_vehicle_count > 0) THEN ('household_demographics.hd_dep_count / 'household_demographics.hd_vehicle_count) ELSE null END > 1)) && ('date_dim.d_year IN (1999,(1999 + 1),(1999 + 2)) && 'store.s_county IN (Williamson County,Franklin Parish,Bronx County,Orange County))))\n         :        +- 'Join Inner\n         :           :- 'Join Inner\n         :           :  :- 'Join Inner\n         :           :  :  :- 'UnresolvedRelation `store_sales`\n         :           :  :  +- 'UnresolvedRelation `date_dim`\n         :           :  +- 'UnresolvedRelation `store`\n         :           +- 'UnresolvedRelation `household_demographics`\n         +- 'UnresolvedRelation `customer`\n\n== Analyzed Logical Plan ==\nc_last_name: string, c_first_name: string, c_salutation: string, c_preferred_cust_flag: string, ss_ticket_number: bigint, cnt: bigint\nSort [cnt#34098L DESC NULLS LAST, c_last_name#869 ASC NULLS FIRST], true\n+- Project [c_last_name#869, c_first_name#868, c_salutation#867, c_preferred_cust_flag#870, ss_ticket_number#1912L, cnt#34098L]\n   +- Filter ((ss_customer_sk#1906 = c_customer_sk#860) && ((cnt#34098L >= cast(1 as bigint)) && (cnt#34098L <= cast(5 as bigint))))\n      +- Join Inner\n         :- SubqueryAlias dj\n         :  +- Aggregate [ss_ticket_number#1912L, ss_customer_sk#1906], [ss_ticket_number#1912L, ss_customer_sk#1906, count(1) AS cnt#34098L]\n         :     +- Filter (((((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_store_sk#1910 = s_store_sk#1386)) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && (((d_dom#1049 >= 1) && (d_dom#1049 <= 2)) && ((hd_buy_potential#1108 = >10000) || (hd_buy_potential#1108 = unknown)))) && (((hd_vehicle_count#1110 > 0) && (CASE WHEN (hd_vehicle_count#1110 > 0) THEN (cast(hd_dep_count#1109 as double) / cast(hd_vehicle_count#1110 as double)) ELSE cast(null as double) END > cast(1 as double))) && (d_year#1046 IN (1999,(1999 + 1),(1999 + 2)) && s_county#1409 IN (Williamson County,Franklin Parish,Bronx County,Orange County))))\n         :        +- Join Inner\n         :           :- Join Inner\n         :           :  :- Join Inner\n         :           :  :  :- SubqueryAlias store_sales\n         :           :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :           :  :  +- SubqueryAlias date_dim\n         :           :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :           :  +- SubqueryAlias store\n         :           :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n         :           +- SubqueryAlias household_demographics\n         :              +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n         +- SubqueryAlias customer\n            +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n\n== Optimized Logical Plan ==\nSort [cnt#34098L DESC NULLS LAST, c_last_name#869 ASC NULLS FIRST], true\n+- Project [c_last_name#869, c_first_name#868, c_salutation#867, c_preferred_cust_flag#870, ss_ticket_number#1912L, cnt#34098L]\n   +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n      :- Filter ((cnt#34098L >= 1) && (cnt#34098L <= 5))\n      :  +- Aggregate [ss_ticket_number#1912L, ss_customer_sk#1906], [ss_ticket_number#1912L, ss_customer_sk#1906, count(1) AS cnt#34098L]\n      :     +- Project [ss_customer_sk#1906, ss_ticket_number#1912L]\n      :        +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n      :           :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_ticket_number#1912L]\n      :           :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n      :           :     :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_store_sk#1910, ss_ticket_number#1912L]\n      :           :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n      :           :     :     :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_store_sk#1910, ss_ticket_number#1912L, ss_sold_date_sk#1926]\n      :           :     :     :  +- Filter (((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_customer_sk#1906))\n      :           :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :           :     :     +- Project [d_date_sk#1040]\n      :           :     :        +- Filter ((((isnotnull(d_dom#1049) && (d_dom#1049 >= 1)) && (d_dom#1049 <= 2)) && d_year#1046 IN (1999,2000,2001)) && isnotnull(d_date_sk#1040))\n      :           :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n      :           :     +- Project [s_store_sk#1386]\n      :           :        +- Filter (s_county#1409 IN (Williamson County,Franklin Parish,Bronx County,Orange County) && isnotnull(s_store_sk#1386))\n      :           :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n      :           +- Project [hd_demo_sk#1106]\n      :              +- Filter ((((isnotnull(hd_vehicle_count#1110) && ((hd_buy_potential#1108 = >10000) || (hd_buy_potential#1108 = unknown))) && (hd_vehicle_count#1110 > 0)) && (CASE WHEN (hd_vehicle_count#1110 > 0) THEN (cast(hd_dep_count#1109 as double) / cast(hd_vehicle_count#1110 as double)) ELSE null END > 1.0)) && isnotnull(hd_demo_sk#1106))\n      :                 +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n      +- Project [c_customer_sk#860, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870]\n         +- Filter isnotnull(c_customer_sk#860)\n            +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n\n== Physical Plan ==\n*(7) Sort [cnt#34098L DESC NULLS LAST, c_last_name#869 ASC NULLS FIRST], true, 0\n+- Exchange rangepartitioning(cnt#34098L DESC NULLS LAST, c_last_name#869 ASC NULLS FIRST, 200)\n   +- *(6) Project [c_last_name#869, c_first_name#868, c_salutation#867, c_preferred_cust_flag#870, ss_ticket_number#1912L, cnt#34098L]\n      +- *(6) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n         :- *(6) Filter ((cnt#34098L >= 1) && (cnt#34098L <= 5))\n         :  +- *(6) HashAggregate(keys=[ss_ticket_number#1912L, ss_customer_sk#1906], functions=[count(1)], output=[ss_ticket_number#1912L, ss_customer_sk#1906, cnt#34098L])\n         :     +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_customer_sk#1906, 200)\n         :        +- *(4) HashAggregate(keys=[ss_ticket_number#1912L, ss_customer_sk#1906], functions=[partial_count(1)], output=[ss_ticket_number#1912L, ss_customer_sk#1906, count#34107L])\n         :           +- *(4) Project [ss_customer_sk#1906, ss_ticket_number#1912L]\n         :              +- *(4) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n         :                 :- *(4) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_ticket_number#1912L]\n         :                 :  +- *(4) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n         :                 :     :- *(4) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_store_sk#1910, ss_ticket_number#1912L]\n         :                 :     :  +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n         :                 :     :     :- *(4) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_store_sk#1910, ss_ticket_number#1912L, ss_sold_date_sk#1926]\n         :                 :     :     :  +- *(4) Filter ((isnotnull(ss_store_sk#1910) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_customer_sk#1906))\n         :                 :     :     :     +- *(4) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_hdemo_sk#1908,ss_store_sk#1910,ss_ticket_number#1912L,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_hdemo_sk:int,ss_store_sk:int,ss_ticket_number:bigint>\n         :                 :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                 :     :        +- *(1) Project [d_date_sk#1040]\n         :                 :     :           +- *(1) Filter ((((isnotnull(d_dom#1049) && (d_dom#1049 >= 1)) && (d_dom#1049 <= 2)) && d_year#1046 IN (1999,2000,2001)) && isnotnull(d_date_sk#1040))\n         :                 :     :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_dom#1049] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_dom), GreaterThanOrEqual(d_dom,1), LessThanOrEqual(d_dom,2), In(d_year, [1999,2000,2..., ReadSchema: struct<d_date_sk:int,d_year:int,d_dom:int>\n         :                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                 :        +- *(2) Project [s_store_sk#1386]\n         :                 :           +- *(2) Filter (s_county#1409 IN (Williamson County,Franklin Parish,Bronx County,Orange County) && isnotnull(s_store_sk#1386))\n         :                 :              +- *(2) FileScan parquet db_tpcds.store[s_store_sk#1386,s_county#1409] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [In(s_county, [Williamson County,Franklin Parish,Bronx County,Orange County]), IsNotNull(s_store_..., ReadSchema: struct<s_store_sk:int,s_county:string>\n         :                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                    +- *(3) Project [hd_demo_sk#1106]\n         :                       +- *(3) Filter ((((isnotnull(hd_vehicle_count#1110) && ((hd_buy_potential#1108 = >10000) || (hd_buy_potential#1108 = unknown))) && (hd_vehicle_count#1110 > 0)) && (CASE WHEN (hd_vehicle_count#1110 > 0) THEN (cast(hd_dep_count#1109 as double) / cast(hd_vehicle_count#1110 as double)) ELSE null END > 1.0)) && isnotnull(hd_demo_sk#1106))\n         :                          +- *(3) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(hd_vehicle_count), Or(EqualTo(hd_buy_potential,>10000),EqualTo(hd_buy_potential,unknow..., ReadSchema: struct<hd_demo_sk:int,hd_buy_potential:string,hd_dep_count:int,hd_vehicle_count:int>\n         +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            +- *(5) Project [c_customer_sk#860, c_salutation#867, c_first_name#868, c_last_name#869, c_preferred_cust_flag#870]\n               +- *(5) Filter isnotnull(c_customer_sk#860)\n                  +- *(5) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int,c_salutation:string,c_first_name:string,c_last_name:string,c_preferred_c..."},{"name":"q74-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["year_total","year_total","year_total","year_total"],"parsingTime":0.002602,"analysisTime":0.001729,"optimizationTime":1129.876947,"planningTime":96.579768,"executionTime":17333.510696,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [year_total]\n:  +- 'SubqueryAlias year_total\n:     +- 'Union\n:        :- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'd_year], ['c_customer_id AS customer_id#34167, 'c_first_name AS customer_first_name#34168, 'c_last_name AS customer_last_name#34169, 'd_year AS year#34170, 'sum('ss_net_paid) AS year_total#34171, s AS sale_type#34172]\n:        :  +- 'Filter ((('c_customer_sk = 'ss_customer_sk) && ('ss_sold_date_sk = 'd_date_sk)) && 'd_year IN (2001,(2001 + 1)))\n:        :     +- 'Join Inner\n:        :        :- 'Join Inner\n:        :        :  :- 'UnresolvedRelation `customer`\n:        :        :  +- 'UnresolvedRelation `store_sales`\n:        :        +- 'UnresolvedRelation `date_dim`\n:        +- 'Aggregate ['c_customer_id, 'c_first_name, 'c_last_name, 'd_year], ['c_customer_id AS customer_id#34173, 'c_first_name AS customer_first_name#34174, 'c_last_name AS customer_last_name#34175, 'd_year AS year#34176, 'sum('ws_net_paid) AS year_total#34177, w AS sale_type#34178]\n:           +- 'Filter ((('c_customer_sk = 'ws_bill_customer_sk) && ('ws_sold_date_sk = 'd_date_sk)) && 'd_year IN (2001,(2001 + 1)))\n:              +- 'Join Inner\n:                 :- 'Join Inner\n:                 :  :- 'UnresolvedRelation `customer`\n:                 :  +- 'UnresolvedRelation `web_sales`\n:                 +- 'UnresolvedRelation `date_dim`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort [1 ASC NULLS FIRST, 1 ASC NULLS FIRST, 1 ASC NULLS FIRST], true\n         +- 'Project ['t_s_secyear.customer_id, 't_s_secyear.customer_first_name, 't_s_secyear.customer_last_name]\n            +- 'Filter ((((('t_s_secyear.customer_id = 't_s_firstyear.customer_id) && ('t_s_firstyear.customer_id = 't_w_secyear.customer_id)) && (('t_s_firstyear.customer_id = 't_w_firstyear.customer_id) && ('t_s_firstyear.sale_type = s))) && ((('t_w_firstyear.sale_type = w) && ('t_s_secyear.sale_type = s)) && ('t_w_secyear.sale_type = w))) && (((('t_s_firstyear.year = 2001) && ('t_s_secyear.year = (2001 + 1))) && (('t_w_firstyear.year = 2001) && ('t_w_secyear.year = (2001 + 1)))) && ((('t_s_firstyear.year_total > 0) && ('t_w_firstyear.year_total > 0)) && (CASE WHEN ('t_w_firstyear.year_total > 0) THEN ('t_w_secyear.year_total / 't_w_firstyear.year_total) ELSE null END > CASE WHEN ('t_s_firstyear.year_total > 0) THEN ('t_s_secyear.year_total / 't_s_firstyear.year_total) ELSE null END))))\n               +- 'Join Inner\n                  :- 'Join Inner\n                  :  :- 'Join Inner\n                  :  :  :- 'SubqueryAlias t_s_firstyear\n                  :  :  :  +- 'UnresolvedRelation `year_total`\n                  :  :  +- 'SubqueryAlias t_s_secyear\n                  :  :     +- 'UnresolvedRelation `year_total`\n                  :  +- 'SubqueryAlias t_w_firstyear\n                  :     +- 'UnresolvedRelation `year_total`\n                  +- 'SubqueryAlias t_w_secyear\n                     +- 'UnresolvedRelation `year_total`\n\n== Analyzed Logical Plan ==\ncustomer_id: string, customer_first_name: string, customer_last_name: string\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [customer_id#34181 ASC NULLS FIRST, customer_id#34181 ASC NULLS FIRST, customer_id#34181 ASC NULLS FIRST], true\n      +- Project [customer_id#34181, customer_first_name#34182, customer_last_name#34183]\n         +- Filter (((((customer_id#34181 = customer_id#34167) && (customer_id#34167 = customer_id#34193)) && ((customer_id#34167 = customer_id#34187) && (sale_type#34172 = s))) && (((sale_type#34192 = w) && (sale_type#34186 = s)) && (sale_type#34198 = w))) && ((((year#34170 = 2001) && (year#34184 = (2001 + 1))) && ((year#34190 = 2001) && (year#34196 = (2001 + 1)))) && (((cast(year_total#34171 as decimal(17,2)) > cast(cast(0 as decimal(1,0)) as decimal(17,2))) && (cast(year_total#34191 as decimal(17,2)) > cast(cast(0 as decimal(1,0)) as decimal(17,2)))) && (CASE WHEN (cast(year_total#34191 as decimal(17,2)) > cast(cast(0 as decimal(1,0)) as decimal(17,2))) THEN CheckOverflow((promote_precision(cast(year_total#34197 as decimal(17,2))) / promote_precision(cast(year_total#34191 as decimal(17,2)))), DecimalType(37,20)) ELSE cast(null as decimal(37,20)) END > CASE WHEN (cast(year_total#34171 as decimal(17,2)) > cast(cast(0 as decimal(1,0)) as decimal(17,2))) THEN CheckOverflow((promote_precision(cast(year_total#34185 as decimal(17,2))) / promote_precision(cast(year_total#34171 as decimal(17,2)))), DecimalType(37,20)) ELSE cast(null as decimal(37,20)) END))))\n            +- Join Inner\n               :- Join Inner\n               :  :- Join Inner\n               :  :  :- SubqueryAlias t_s_firstyear\n               :  :  :  +- SubqueryAlias year_total\n               :  :  :     +- Union\n               :  :  :        :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], [c_customer_id#861 AS customer_id#34167, c_first_name#868 AS customer_first_name#34168, c_last_name#869 AS customer_last_name#34169, d_year#1046 AS year#34170, sum(ss_net_paid#1923) AS year_total#34171, s AS sale_type#34172]\n               :  :  :        :  +- Filter (((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && d_year#1046 IN (2001,(2001 + 1)))\n               :  :  :        :     +- Join Inner\n               :  :  :        :        :- Join Inner\n               :  :  :        :        :  :- SubqueryAlias customer\n               :  :  :        :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :        :        :  +- SubqueryAlias store_sales\n               :  :  :        :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :  :        :        +- SubqueryAlias date_dim\n               :  :  :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  :        +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], [c_customer_id#861 AS customer_id#34173, c_first_name#868 AS customer_first_name#34174, c_last_name#869 AS customer_last_name#34175, d_year#1046 AS year#34176, sum(ws_net_paid#1783) AS year_total#34177, w AS sale_type#34178]\n               :  :  :           +- Filter (((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && d_year#1046 IN (2001,(2001 + 1)))\n               :  :  :              +- Join Inner\n               :  :  :                 :- Join Inner\n               :  :  :                 :  :- SubqueryAlias customer\n               :  :  :                 :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :  :                 :  +- SubqueryAlias web_sales\n               :  :  :                 :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :  :  :                 +- SubqueryAlias date_dim\n               :  :  :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :  +- SubqueryAlias t_s_secyear\n               :  :     +- SubqueryAlias year_total\n               :  :        +- Union\n               :  :           :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], [c_customer_id#861 AS customer_id#34181, c_first_name#868 AS customer_first_name#34182, c_last_name#869 AS customer_last_name#34183, d_year#1046 AS year#34184, sum(ss_net_paid#1923) AS year_total#34185, s AS sale_type#34186]\n               :  :           :  +- Filter (((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && d_year#1046 IN (2001,(2001 + 1)))\n               :  :           :     +- Join Inner\n               :  :           :        :- Join Inner\n               :  :           :        :  :- SubqueryAlias customer\n               :  :           :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :           :        :  +- SubqueryAlias store_sales\n               :  :           :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :           :        +- SubqueryAlias date_dim\n               :  :           :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :           +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], [c_customer_id#861 AS customer_id#34173, c_first_name#868 AS customer_first_name#34174, c_last_name#869 AS customer_last_name#34175, d_year#1046 AS year#34176, sum(ws_net_paid#1783) AS year_total#34177, w AS sale_type#34178]\n               :  :              +- Filter (((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && d_year#1046 IN (2001,(2001 + 1)))\n               :  :                 +- Join Inner\n               :  :                    :- Join Inner\n               :  :                    :  :- SubqueryAlias customer\n               :  :                    :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :  :                    :  +- SubqueryAlias web_sales\n               :  :                    :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :  :                    +- SubqueryAlias date_dim\n               :  :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  +- SubqueryAlias t_w_firstyear\n               :     +- SubqueryAlias year_total\n               :        +- Union\n               :           :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], [c_customer_id#861 AS customer_id#34187, c_first_name#868 AS customer_first_name#34188, c_last_name#869 AS customer_last_name#34189, d_year#1046 AS year#34190, sum(ss_net_paid#1923) AS year_total#34191, s AS sale_type#34192]\n               :           :  +- Filter (((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && d_year#1046 IN (2001,(2001 + 1)))\n               :           :     +- Join Inner\n               :           :        :- Join Inner\n               :           :        :  :- SubqueryAlias customer\n               :           :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :           :        :  +- SubqueryAlias store_sales\n               :           :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :           :        +- SubqueryAlias date_dim\n               :           :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :           +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], [c_customer_id#861 AS customer_id#34173, c_first_name#868 AS customer_first_name#34174, c_last_name#869 AS customer_last_name#34175, d_year#1046 AS year#34176, sum(ws_net_paid#1783) AS year_total#34177, w AS sale_type#34178]\n               :              +- Filter (((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && d_year#1046 IN (2001,(2001 + 1)))\n               :                 +- Join Inner\n               :                    :- Join Inner\n               :                    :  :- SubqueryAlias customer\n               :                    :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :                    :  +- SubqueryAlias web_sales\n               :                    :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :                    +- SubqueryAlias date_dim\n               :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- SubqueryAlias t_w_secyear\n                  +- SubqueryAlias year_total\n                     +- Union\n                        :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], [c_customer_id#861 AS customer_id#34193, c_first_name#868 AS customer_first_name#34194, c_last_name#869 AS customer_last_name#34195, d_year#1046 AS year#34196, sum(ss_net_paid#1923) AS year_total#34197, s AS sale_type#34198]\n                        :  +- Filter (((c_customer_sk#860 = ss_customer_sk#1906) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && d_year#1046 IN (2001,(2001 + 1)))\n                        :     +- Join Inner\n                        :        :- Join Inner\n                        :        :  :- SubqueryAlias customer\n                        :        :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                        :        :  +- SubqueryAlias store_sales\n                        :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :        +- SubqueryAlias date_dim\n                        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], [c_customer_id#861 AS customer_id#34173, c_first_name#868 AS customer_first_name#34174, c_last_name#869 AS customer_last_name#34175, d_year#1046 AS year#34176, sum(ws_net_paid#1783) AS year_total#34177, w AS sale_type#34178]\n                           +- Filter (((c_customer_sk#860 = ws_bill_customer_sk#1758) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && d_year#1046 IN (2001,(2001 + 1)))\n                              +- Join Inner\n                                 :- Join Inner\n                                 :  :- SubqueryAlias customer\n                                 :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                                 :  +- SubqueryAlias web_sales\n                                 :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                                 +- SubqueryAlias date_dim\n                                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [customer_id#34181 ASC NULLS FIRST, customer_id#34181 ASC NULLS FIRST, customer_id#34181 ASC NULLS FIRST], true\n      +- Project [customer_id#34181, customer_first_name#34182, customer_last_name#34183]\n         +- Join Inner, ((customer_id#34167 = customer_id#34193) && (CASE WHEN (year_total#34191 > 0.00) THEN CheckOverflow((promote_precision(year_total#34197) / promote_precision(year_total#34191)), DecimalType(37,20)) ELSE null END > CASE WHEN (year_total#34171 > 0.00) THEN CheckOverflow((promote_precision(year_total#34185) / promote_precision(year_total#34171)), DecimalType(37,20)) ELSE null END))\n            :- Project [customer_id#34167, year_total#34171, customer_id#34181, customer_first_name#34182, customer_last_name#34183, year_total#34185, year_total#34191]\n            :  +- Join Inner, (customer_id#34167 = customer_id#34187)\n            :     :- Join Inner, (customer_id#34181 = customer_id#34167)\n            :     :  :- Union\n            :     :  :  :- Filter (isnotnull(year_total#34171) && (year_total#34171 > 0.00))\n            :     :  :  :  +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], [c_customer_id#861 AS customer_id#34167, MakeDecimal(sum(UnscaledValue(ss_net_paid#1923)),17,2) AS year_total#34171]\n            :     :  :  :     +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, ss_net_paid#1923, d_year#1046]\n            :     :  :  :        +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :     :  :  :           :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, ss_net_paid#1923, ss_sold_date_sk#1926]\n            :     :  :  :           :  +- Join Inner, (c_customer_sk#860 = ss_customer_sk#1906)\n            :     :  :  :           :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869]\n            :     :  :  :           :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n            :     :  :  :           :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :     :  :  :           :     +- Project [ss_customer_sk#1906, ss_net_paid#1923, ss_sold_date_sk#1926]\n            :     :  :  :           :        +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n            :     :  :  :           :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :  :  :           +- Project [d_date_sk#1040, d_year#1046]\n            :     :  :  :              +- Filter (((isnotnull(d_year#1046) && d_year#1046 IN (2001,2002)) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n            :     :  :  :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :  :  +- LocalRelation <empty>, [customer_id#34173, year_total#34177]\n            :     :  +- Union\n            :     :     :- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], [c_customer_id#861 AS customer_id#34181, c_first_name#868 AS customer_first_name#34182, c_last_name#869 AS customer_last_name#34183, MakeDecimal(sum(UnscaledValue(ss_net_paid#1923)),17,2) AS year_total#34185]\n            :     :     :  +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, ss_net_paid#1923, d_year#1046]\n            :     :     :     +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :     :     :        :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, ss_net_paid#1923, ss_sold_date_sk#1926]\n            :     :     :        :  +- Join Inner, (c_customer_sk#860 = ss_customer_sk#1906)\n            :     :     :        :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869]\n            :     :     :        :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n            :     :     :        :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :     :     :        :     +- Project [ss_customer_sk#1906, ss_net_paid#1923, ss_sold_date_sk#1926]\n            :     :     :        :        +- Filter (isnotnull(ss_customer_sk#1906) && isnotnull(ss_sold_date_sk#1926))\n            :     :     :        :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :     :        +- Project [d_date_sk#1040, d_year#1046]\n            :     :     :           +- Filter (((isnotnull(d_year#1046) && d_year#1046 IN (2001,2002)) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n            :     :     :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :     +- LocalRelation <empty>, [customer_id#34173, customer_first_name#34174, customer_last_name#34175, year_total#34177]\n            :     +- Union\n            :        :- LocalRelation <empty>, [customer_id#34187, year_total#34191]\n            :        +- Filter (isnotnull(year_total#34177) && (year_total#34177 > 0.00))\n            :           +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], [c_customer_id#861 AS customer_id#34173, MakeDecimal(sum(UnscaledValue(ws_net_paid#1783)),17,2) AS year_total#34177]\n            :              +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, ws_net_paid#1783, d_year#1046]\n            :                 +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n            :                    :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, ws_net_paid#1783, ws_sold_date_sk#1788]\n            :                    :  +- Join Inner, (c_customer_sk#860 = ws_bill_customer_sk#1758)\n            :                    :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869]\n            :                    :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n            :                    :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :                    :     +- Project [ws_bill_customer_sk#1758, ws_net_paid#1783, ws_sold_date_sk#1788]\n            :                    :        +- Filter (isnotnull(ws_bill_customer_sk#1758) && isnotnull(ws_sold_date_sk#1788))\n            :                    :           +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :                    +- Project [d_date_sk#1040, d_year#1046]\n            :                       +- Filter (((isnotnull(d_year#1046) && d_year#1046 IN (2001,2002)) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n            :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Union\n               :- LocalRelation <empty>, [customer_id#34193, year_total#34197]\n               +- Aggregate [c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], [c_customer_id#861 AS customer_id#34173, MakeDecimal(sum(UnscaledValue(ws_net_paid#1783)),17,2) AS year_total#34177]\n                  +- Project [c_customer_id#861, c_first_name#868, c_last_name#869, ws_net_paid#1783, d_year#1046]\n                     +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                        :- Project [c_customer_id#861, c_first_name#868, c_last_name#869, ws_net_paid#1783, ws_sold_date_sk#1788]\n                        :  +- Join Inner, (c_customer_sk#860 = ws_bill_customer_sk#1758)\n                        :     :- Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869]\n                        :     :  +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n                        :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                        :     +- Project [ws_bill_customer_sk#1758, ws_net_paid#1783, ws_sold_date_sk#1788]\n                        :        +- Filter (isnotnull(ws_bill_customer_sk#1758) && isnotnull(ws_sold_date_sk#1788))\n                        :           +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        +- Project [d_date_sk#1040, d_year#1046]\n                           +- Filter (((isnotnull(d_year#1046) && d_year#1046 IN (2001,2002)) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n                              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[customer_id#34181 ASC NULLS FIRST,customer_id#34181 ASC NULLS FIRST,customer_id#34181 ASC NULLS FIRST], output=[customer_id#34181,customer_first_name#34182,customer_last_name#34183])\n+- *(23) Project [customer_id#34181, customer_first_name#34182, customer_last_name#34183]\n   +- *(23) SortMergeJoin [customer_id#34167], [customer_id#34193], Inner, (CASE WHEN (year_total#34191 > 0.00) THEN CheckOverflow((promote_precision(year_total#34197) / promote_precision(year_total#34191)), DecimalType(37,20)) ELSE null END > CASE WHEN (year_total#34171 > 0.00) THEN CheckOverflow((promote_precision(year_total#34185) / promote_precision(year_total#34171)), DecimalType(37,20)) ELSE null END)\n      :- *(17) Project [customer_id#34167, year_total#34171, customer_id#34181, customer_first_name#34182, customer_last_name#34183, year_total#34185, year_total#34191]\n      :  +- *(17) SortMergeJoin [customer_id#34167], [customer_id#34187], Inner\n      :     :- *(11) SortMergeJoin [customer_id#34167], [customer_id#34181], Inner\n      :     :  :- *(5) Sort [customer_id#34167 ASC NULLS FIRST], false, 0\n      :     :  :  +- Exchange hashpartitioning(customer_id#34167, 200)\n      :     :  :     +- Union\n      :     :  :        :- *(4) Filter (isnotnull(year_total#34171) && (year_total#34171 > 0.00))\n      :     :  :        :  +- *(4) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], functions=[sum(UnscaledValue(ss_net_paid#1923))], output=[customer_id#34167, year_total#34171])\n      :     :  :        :     +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046, 200)\n      :     :  :        :        +- *(3) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], functions=[partial_sum(UnscaledValue(ss_net_paid#1923))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046, sum#34203L])\n      :     :  :        :           +- *(3) Project [c_customer_id#861, c_first_name#868, c_last_name#869, ss_net_paid#1923, d_year#1046]\n      :     :  :        :              +- *(3) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :     :  :        :                 :- *(3) Project [c_customer_id#861, c_first_name#868, c_last_name#869, ss_net_paid#1923, ss_sold_date_sk#1926]\n      :     :  :        :                 :  +- *(3) BroadcastHashJoin [c_customer_sk#860], [ss_customer_sk#1906], Inner, BuildLeft\n      :     :  :        :                 :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :  :        :                 :     :  +- *(1) Project [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869]\n      :     :  :        :                 :     :     +- *(1) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_customer_id#861))\n      :     :  :        :                 :     :        +- *(1) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_customer_id#861,c_first_name#868,c_last_name#869] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_customer_id)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string>\n      :     :  :        :                 :     +- *(3) Project [ss_customer_sk#1906, ss_net_paid#1923, ss_sold_date_sk#1926]\n      :     :  :        :                 :        +- *(3) Filter isnotnull(ss_customer_sk#1906)\n      :     :  :        :                 :           +- *(3) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_net_paid#1923,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_net_paid:decimal(7,2)>\n      :     :  :        :                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :  :        :                    +- *(2) Project [d_date_sk#1040, d_year#1046]\n      :     :  :        :                       +- *(2) Filter (((isnotnull(d_year#1046) && d_year#1046 IN (2001,2002)) && (d_year#1046 = 2001)) && isnotnull(d_date_sk#1040))\n      :     :  :        :                          +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), In(d_year, [2001,2002]), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n      :     :  :        +- LocalTableScan <empty>, [customer_id#34173, year_total#34177]\n      :     :  +- *(10) Sort [customer_id#34181 ASC NULLS FIRST], false, 0\n      :     :     +- Exchange hashpartitioning(customer_id#34181, 200)\n      :     :        +- Union\n      :     :           :- *(9) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], functions=[sum(UnscaledValue(ss_net_paid#1923))], output=[customer_id#34181, customer_first_name#34182, customer_last_name#34183, year_total#34185])\n      :     :           :  +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046, 200)\n      :     :           :     +- *(8) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], functions=[partial_sum(UnscaledValue(ss_net_paid#1923))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046, sum#34205L])\n      :     :           :        +- *(8) Project [c_customer_id#861, c_first_name#868, c_last_name#869, ss_net_paid#1923, d_year#1046]\n      :     :           :           +- *(8) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :     :           :              :- *(8) Project [c_customer_id#861, c_first_name#868, c_last_name#869, ss_net_paid#1923, ss_sold_date_sk#1926]\n      :     :           :              :  +- *(8) BroadcastHashJoin [c_customer_sk#860], [ss_customer_sk#1906], Inner, BuildLeft\n      :     :           :              :     :- ReusedExchange [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :           :              :     +- *(8) Project [ss_customer_sk#1906, ss_net_paid#1923, ss_sold_date_sk#1926]\n      :     :           :              :        +- *(8) Filter isnotnull(ss_customer_sk#1906)\n      :     :           :              :           +- *(8) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_net_paid#1923,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_net_paid:decimal(7,2)>\n      :     :           :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :           :                 +- *(7) Project [d_date_sk#1040, d_year#1046]\n      :     :           :                    +- *(7) Filter (((isnotnull(d_year#1046) && d_year#1046 IN (2001,2002)) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n      :     :           :                       +- *(7) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), In(d_year, [2001,2002]), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n      :     :           +- LocalTableScan <empty>, [customer_id#34173, customer_first_name#34174, customer_last_name#34175, year_total#34177]\n      :     +- *(16) Sort [customer_id#34187 ASC NULLS FIRST], false, 0\n      :        +- Exchange hashpartitioning(customer_id#34187, 200)\n      :           +- Union\n      :              :- LocalTableScan <empty>, [customer_id#34187, year_total#34191]\n      :              +- *(15) Filter (isnotnull(year_total#34177) && (year_total#34177 > 0.00))\n      :                 +- *(15) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], functions=[sum(UnscaledValue(ws_net_paid#1783))], output=[customer_id#34173, year_total#34177])\n      :                    +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046, 200)\n      :                       +- *(14) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], functions=[partial_sum(UnscaledValue(ws_net_paid#1783))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046, sum#34207L])\n      :                          +- *(14) Project [c_customer_id#861, c_first_name#868, c_last_name#869, ws_net_paid#1783, d_year#1046]\n      :                             +- *(14) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n      :                                :- *(14) Project [c_customer_id#861, c_first_name#868, c_last_name#869, ws_net_paid#1783, ws_sold_date_sk#1788]\n      :                                :  +- *(14) BroadcastHashJoin [c_customer_sk#860], [ws_bill_customer_sk#1758], Inner, BuildLeft\n      :                                :     :- ReusedExchange [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                                :     +- *(14) Project [ws_bill_customer_sk#1758, ws_net_paid#1783, ws_sold_date_sk#1788]\n      :                                :        +- *(14) Filter isnotnull(ws_bill_customer_sk#1758)\n      :                                :           +- *(14) FileScan parquet db_tpcds.web_sales[ws_bill_customer_sk#1758,ws_net_paid#1783,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:int,ws_net_paid:decimal(7,2)>\n      :                                +- ReusedExchange [d_date_sk#1040, d_year#1046], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      +- *(22) Sort [customer_id#34193 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(customer_id#34193, 200)\n            +- Union\n               :- LocalTableScan <empty>, [customer_id#34193, year_total#34197]\n               +- *(21) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], functions=[sum(UnscaledValue(ws_net_paid#1783))], output=[customer_id#34173, year_total#34177])\n                  +- Exchange hashpartitioning(c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046, 200)\n                     +- *(20) HashAggregate(keys=[c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046], functions=[partial_sum(UnscaledValue(ws_net_paid#1783))], output=[c_customer_id#861, c_first_name#868, c_last_name#869, d_year#1046, sum#34209L])\n                        +- *(20) Project [c_customer_id#861, c_first_name#868, c_last_name#869, ws_net_paid#1783, d_year#1046]\n                           +- *(20) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                              :- *(20) Project [c_customer_id#861, c_first_name#868, c_last_name#869, ws_net_paid#1783, ws_sold_date_sk#1788]\n                              :  +- *(20) BroadcastHashJoin [c_customer_sk#860], [ws_bill_customer_sk#1758], Inner, BuildLeft\n                              :     :- ReusedExchange [c_customer_sk#860, c_customer_id#861, c_first_name#868, c_last_name#869], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     +- *(20) Project [ws_bill_customer_sk#1758, ws_net_paid#1783, ws_sold_date_sk#1788]\n                              :        +- *(20) Filter isnotnull(ws_bill_customer_sk#1758)\n                              :           +- *(20) FileScan parquet db_tpcds.web_sales[ws_bill_customer_sk#1758,ws_net_paid#1783,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:int,ws_net_paid:decimal(7,2)>\n                              +- ReusedExchange [d_date_sk#1040, d_year#1046], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q75-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["all_sales","all_sales"],"parsingTime":0.00227,"analysisTime":0.008018,"optimizationTime":1873.601432,"planningTime":3000.719467,"executionTime":42226.914474,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [all_sales]\n:  +- 'SubqueryAlias all_sales\n:     +- 'Aggregate ['d_year, 'i_brand_id, 'i_class_id, 'i_category_id, 'i_manufact_id], ['d_year, 'i_brand_id, 'i_class_id, 'i_category_id, 'i_manufact_id, 'SUM('sales_cnt) AS sales_cnt#34691, 'SUM('sales_amt) AS sales_amt#34692]\n:        +- 'SubqueryAlias sales_detail\n:           +- 'Distinct\n:              +- 'Union\n:                 :- 'Distinct\n:                 :  +- 'Union\n:                 :     :- 'Project ['d_year, 'i_brand_id, 'i_class_id, 'i_category_id, 'i_manufact_id, ('cs_quantity - 'COALESCE('cr_return_quantity, 0)) AS sales_cnt#34685, ('cs_ext_sales_price - 'COALESCE('cr_return_amount, 0.0)) AS sales_amt#34686]\n:                 :     :  +- 'Filter ('i_category = Books)\n:                 :     :     +- 'Join LeftOuter, (('cs_order_number = 'cr_order_number) && ('cs_item_sk = 'cr_item_sk))\n:                 :     :        :- 'Join Inner, ('d_date_sk = 'cs_sold_date_sk)\n:                 :     :        :  :- 'Join Inner, ('i_item_sk = 'cs_item_sk)\n:                 :     :        :  :  :- 'UnresolvedRelation `catalog_sales`\n:                 :     :        :  :  +- 'UnresolvedRelation `item`\n:                 :     :        :  +- 'UnresolvedRelation `date_dim`\n:                 :     :        +- 'UnresolvedRelation `catalog_returns`\n:                 :     +- 'Project ['d_year, 'i_brand_id, 'i_class_id, 'i_category_id, 'i_manufact_id, ('ss_quantity - 'COALESCE('sr_return_quantity, 0)) AS sales_cnt#34687, ('ss_ext_sales_price - 'COALESCE('sr_return_amt, 0.0)) AS sales_amt#34688]\n:                 :        +- 'Filter ('i_category = Books)\n:                 :           +- 'Join LeftOuter, (('ss_ticket_number = 'sr_ticket_number) && ('ss_item_sk = 'sr_item_sk))\n:                 :              :- 'Join Inner, ('d_date_sk = 'ss_sold_date_sk)\n:                 :              :  :- 'Join Inner, ('i_item_sk = 'ss_item_sk)\n:                 :              :  :  :- 'UnresolvedRelation `store_sales`\n:                 :              :  :  +- 'UnresolvedRelation `item`\n:                 :              :  +- 'UnresolvedRelation `date_dim`\n:                 :              +- 'UnresolvedRelation `store_returns`\n:                 +- 'Project ['d_year, 'i_brand_id, 'i_class_id, 'i_category_id, 'i_manufact_id, ('ws_quantity - 'COALESCE('wr_return_quantity, 0)) AS sales_cnt#34689, ('ws_ext_sales_price - 'COALESCE('wr_return_amt, 0.0)) AS sales_amt#34690]\n:                    +- 'Filter ('i_category = Books)\n:                       +- 'Join LeftOuter, (('ws_order_number = 'wr_order_number) && ('ws_item_sk = 'wr_item_sk))\n:                          :- 'Join Inner, ('d_date_sk = 'ws_sold_date_sk)\n:                          :  :- 'Join Inner, ('i_item_sk = 'ws_item_sk)\n:                          :  :  :- 'UnresolvedRelation `web_sales`\n:                          :  :  +- 'UnresolvedRelation `item`\n:                          :  +- 'UnresolvedRelation `date_dim`\n:                          +- 'UnresolvedRelation `web_returns`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['sales_cnt_diff ASC NULLS FIRST], true\n         +- 'Project ['prev_yr.d_year AS prev_year#34679, 'curr_yr.d_year AS year#34680, 'curr_yr.i_brand_id, 'curr_yr.i_class_id, 'curr_yr.i_category_id, 'curr_yr.i_manufact_id, 'prev_yr.sales_cnt AS prev_yr_cnt#34681, 'curr_yr.sales_cnt AS curr_yr_cnt#34682, ('curr_yr.sales_cnt - 'prev_yr.sales_cnt) AS sales_cnt_diff#34683, ('curr_yr.sales_amt - 'prev_yr.sales_amt) AS sales_amt_diff#34684]\n            +- 'Filter (((('curr_yr.i_brand_id = 'prev_yr.i_brand_id) && ('curr_yr.i_class_id = 'prev_yr.i_class_id)) && (('curr_yr.i_category_id = 'prev_yr.i_category_id) && ('curr_yr.i_manufact_id = 'prev_yr.i_manufact_id))) && ((('curr_yr.d_year = 2002) && ('prev_yr.d_year = (2002 - 1))) && ((cast('curr_yr.sales_cnt as decimal(17,2)) / cast('prev_yr.sales_cnt as decimal(17,2))) < 0.9)))\n               +- 'Join Inner\n                  :- 'SubqueryAlias curr_yr\n                  :  +- 'UnresolvedRelation `all_sales`\n                  +- 'SubqueryAlias prev_yr\n                     +- 'UnresolvedRelation `all_sales`\n\n== Analyzed Logical Plan ==\nprev_year: int, year: int, i_brand_id: int, i_class_id: int, i_category_id: int, i_manufact_id: int, prev_yr_cnt: bigint, curr_yr_cnt: bigint, sales_cnt_diff: bigint, sales_amt_diff: decimal(19,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [sales_cnt_diff#34683L ASC NULLS FIRST], true\n      +- Project [d_year#35003 AS prev_year#34679, d_year#1046 AS year#34680, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sales_cnt#34695L AS prev_yr_cnt#34681L, sales_cnt#34691L AS curr_yr_cnt#34682L, (sales_cnt#34691L - sales_cnt#34695L) AS sales_cnt_diff#34683L, CheckOverflow((promote_precision(cast(sales_amt#34692 as decimal(19,2))) - promote_precision(cast(sales_amt#34696 as decimal(19,2)))), DecimalType(19,2)) AS sales_amt_diff#34684]\n         +- Filter ((((i_brand_id#1179 = i_brand_id#34854) && (i_class_id#1181 = i_class_id#34856)) && ((i_category_id#1183 = i_category_id#34858) && (i_manufact_id#1185 = i_manufact_id#34860))) && (((d_year#1046 = 2002) && (d_year#35003 = (2002 - 1))) && (cast(CheckOverflow((promote_precision(cast(cast(sales_cnt#34691L as decimal(17,2)) as decimal(17,2))) / promote_precision(cast(cast(sales_cnt#34695L as decimal(17,2)) as decimal(17,2)))), DecimalType(37,20)) as decimal(37,20)) < cast(0.9 as decimal(37,20)))))\n            +- Join Inner\n               :- SubqueryAlias curr_yr\n               :  +- SubqueryAlias all_sales\n               :     +- Aggregate [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185], [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sum(cast(sales_cnt#34685 as bigint)) AS sales_cnt#34691L, sum(sales_amt#34686) AS sales_amt#34692]\n               :        +- SubqueryAlias sales_detail\n               :           +- Distinct\n               :              +- Union\n               :                 :- Distinct\n               :                 :  +- Union\n               :                 :     :- Project [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, (cs_quantity#1806 - coalesce(cr_return_quantity#2102, 0)) AS sales_cnt#34685, CheckOverflow((promote_precision(cast(cs_ext_sales_price#1811 as decimal(8,2))) - promote_precision(cast(coalesce(cast(cr_return_amount#2103 as decimal(7,2)), cast(0.0 as decimal(7,2))) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34686]\n               :                 :     :  +- Filter (i_category#1184 = Books)\n               :                 :     :     +- Join LeftOuter, ((cs_order_number#1805L = cr_order_number#2101L) && (cs_item_sk#1803 = cr_item_sk#2087))\n               :                 :     :        :- Join Inner, (d_date_sk#1040 = cs_sold_date_sk#1822)\n               :                 :     :        :  :- Join Inner, (i_item_sk#1172 = cs_item_sk#1803)\n               :                 :     :        :  :  :- SubqueryAlias catalog_sales\n               :                 :     :        :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :                 :     :        :  :  +- SubqueryAlias item\n               :                 :     :        :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :                 :     :        :  +- SubqueryAlias date_dim\n               :                 :     :        :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :                 :     :        +- SubqueryAlias catalog_returns\n               :                 :     :           +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n               :                 :     +- Project [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, (ss_quantity#1913 - coalesce(sr_return_quantity#1713, 0)) AS sales_cnt#34687, CheckOverflow((promote_precision(cast(ss_ext_sales_price#1918 as decimal(8,2))) - promote_precision(cast(coalesce(cast(sr_return_amt#1714 as decimal(7,2)), cast(0.0 as decimal(7,2))) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34688]\n               :                 :        +- Filter (i_category#1184 = Books)\n               :                 :           +- Join LeftOuter, ((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705))\n               :                 :              :- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n               :                 :              :  :- Join Inner, (i_item_sk#1172 = ss_item_sk#1905)\n               :                 :              :  :  :- SubqueryAlias store_sales\n               :                 :              :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :                 :              :  :  +- SubqueryAlias item\n               :                 :              :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :                 :              :  +- SubqueryAlias date_dim\n               :                 :              :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :                 :              +- SubqueryAlias store_returns\n               :                 :                 +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :                 +- Project [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, (ws_quantity#1772 - coalesce(wr_return_quantity#2130, 0)) AS sales_cnt#34689, CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(8,2))) - promote_precision(cast(coalesce(cast(wr_return_amt#2131 as decimal(7,2)), cast(0.0 as decimal(7,2))) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34690]\n               :                    +- Filter (i_category#1184 = Books)\n               :                       +- Join LeftOuter, ((ws_order_number#1771L = wr_order_number#2129L) && (ws_item_sk#1757 = wr_item_sk#2118))\n               :                          :- Join Inner, (d_date_sk#1040 = ws_sold_date_sk#1788)\n               :                          :  :- Join Inner, (i_item_sk#1172 = ws_item_sk#1757)\n               :                          :  :  :- SubqueryAlias web_sales\n               :                          :  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :                          :  :  +- SubqueryAlias item\n               :                          :  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :                          :  +- SubqueryAlias date_dim\n               :                          :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :                          +- SubqueryAlias web_returns\n               :                             +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n               +- SubqueryAlias prev_yr\n                  +- SubqueryAlias all_sales\n                     +- Aggregate [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860], [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, sum(cast(sales_cnt#34685 as bigint)) AS sales_cnt#34695L, sum(sales_amt#34686) AS sales_amt#34696]\n                        +- SubqueryAlias sales_detail\n                           +- Distinct\n                              +- Union\n                                 :- Distinct\n                                 :  +- Union\n                                 :     :- Project [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, (cs_quantity#1806 - coalesce(cr_return_quantity#2102, 0)) AS sales_cnt#34685, CheckOverflow((promote_precision(cast(cs_ext_sales_price#1811 as decimal(8,2))) - promote_precision(cast(coalesce(cast(cr_return_amount#2103 as decimal(7,2)), cast(0.0 as decimal(7,2))) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34686]\n                                 :     :  +- Filter (i_category#34859 = Books)\n                                 :     :     +- Join LeftOuter, ((cs_order_number#1805L = cr_order_number#2101L) && (cs_item_sk#1803 = cr_item_sk#2087))\n                                 :     :        :- Join Inner, (d_date_sk#34997 = cs_sold_date_sk#1822)\n                                 :     :        :  :- Join Inner, (i_item_sk#34847 = cs_item_sk#1803)\n                                 :     :        :  :  :- SubqueryAlias catalog_sales\n                                 :     :        :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                                 :     :        :  :  +- SubqueryAlias item\n                                 :     :        :  :     +- Relation[i_item_sk#34847,i_item_id#34848,i_rec_start_date#34849,i_rec_end_date#34850,i_item_desc#34851,i_current_price#34852,i_wholesale_cost#34853,i_brand_id#34854,i_brand#34855,i_class_id#34856,i_class#34857,i_category_id#34858,i_category#34859,i_manufact_id#34860,i_manufact#34861,i_size#34862,i_formulation#34863,i_color#34864,i_units#34865,i_container#34866,i_manager_id#34867,i_product_name#34868] parquet\n                                 :     :        :  +- SubqueryAlias date_dim\n                                 :     :        :     +- Relation[d_date_sk#34997,d_date_id#34998,d_date#34999,d_month_seq#35000,d_week_seq#35001,d_quarter_seq#35002,d_year#35003,d_dow#35004,d_moy#35005,d_dom#35006,d_qoy#35007,d_fy_year#35008,d_fy_quarter_seq#35009,d_fy_week_seq#35010,d_day_name#35011,d_quarter_name#35012,d_holiday#35013,d_weekend#35014,d_following_holiday#35015,d_first_dom#35016,d_last_dom#35017,d_same_day_ly#35018,d_same_day_lq#35019,d_current_day#35020,... 4 more fields] parquet\n                                 :     :        +- SubqueryAlias catalog_returns\n                                 :     :           +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n                                 :     +- Project [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, (ss_quantity#1913 - coalesce(sr_return_quantity#1713, 0)) AS sales_cnt#34687, CheckOverflow((promote_precision(cast(ss_ext_sales_price#1918 as decimal(8,2))) - promote_precision(cast(coalesce(cast(sr_return_amt#1714 as decimal(7,2)), cast(0.0 as decimal(7,2))) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34688]\n                                 :        +- Filter (i_category#34859 = Books)\n                                 :           +- Join LeftOuter, ((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705))\n                                 :              :- Join Inner, (d_date_sk#34997 = ss_sold_date_sk#1926)\n                                 :              :  :- Join Inner, (i_item_sk#34847 = ss_item_sk#1905)\n                                 :              :  :  :- SubqueryAlias store_sales\n                                 :              :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                 :              :  :  +- SubqueryAlias item\n                                 :              :  :     +- Relation[i_item_sk#34847,i_item_id#34848,i_rec_start_date#34849,i_rec_end_date#34850,i_item_desc#34851,i_current_price#34852,i_wholesale_cost#34853,i_brand_id#34854,i_brand#34855,i_class_id#34856,i_class#34857,i_category_id#34858,i_category#34859,i_manufact_id#34860,i_manufact#34861,i_size#34862,i_formulation#34863,i_color#34864,i_units#34865,i_container#34866,i_manager_id#34867,i_product_name#34868] parquet\n                                 :              :  +- SubqueryAlias date_dim\n                                 :              :     +- Relation[d_date_sk#34997,d_date_id#34998,d_date#34999,d_month_seq#35000,d_week_seq#35001,d_quarter_seq#35002,d_year#35003,d_dow#35004,d_moy#35005,d_dom#35006,d_qoy#35007,d_fy_year#35008,d_fy_quarter_seq#35009,d_fy_week_seq#35010,d_day_name#35011,d_quarter_name#35012,d_holiday#35013,d_weekend#35014,d_following_holiday#35015,d_first_dom#35016,d_last_dom#35017,d_same_day_ly#35018,d_same_day_lq#35019,d_current_day#35020,... 4 more fields] parquet\n                                 :              +- SubqueryAlias store_returns\n                                 :                 +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                                 +- Project [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, (ws_quantity#1772 - coalesce(wr_return_quantity#2130, 0)) AS sales_cnt#34689, CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(8,2))) - promote_precision(cast(coalesce(cast(wr_return_amt#2131 as decimal(7,2)), cast(0.0 as decimal(7,2))) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34690]\n                                    +- Filter (i_category#34859 = Books)\n                                       +- Join LeftOuter, ((ws_order_number#1771L = wr_order_number#2129L) && (ws_item_sk#1757 = wr_item_sk#2118))\n                                          :- Join Inner, (d_date_sk#34997 = ws_sold_date_sk#1788)\n                                          :  :- Join Inner, (i_item_sk#34847 = ws_item_sk#1757)\n                                          :  :  :- SubqueryAlias web_sales\n                                          :  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                                          :  :  +- SubqueryAlias item\n                                          :  :     +- Relation[i_item_sk#34847,i_item_id#34848,i_rec_start_date#34849,i_rec_end_date#34850,i_item_desc#34851,i_current_price#34852,i_wholesale_cost#34853,i_brand_id#34854,i_brand#34855,i_class_id#34856,i_class#34857,i_category_id#34858,i_category#34859,i_manufact_id#34860,i_manufact#34861,i_size#34862,i_formulation#34863,i_color#34864,i_units#34865,i_container#34866,i_manager_id#34867,i_product_name#34868] parquet\n                                          :  +- SubqueryAlias date_dim\n                                          :     +- Relation[d_date_sk#34997,d_date_id#34998,d_date#34999,d_month_seq#35000,d_week_seq#35001,d_quarter_seq#35002,d_year#35003,d_dow#35004,d_moy#35005,d_dom#35006,d_qoy#35007,d_fy_year#35008,d_fy_quarter_seq#35009,d_fy_week_seq#35010,d_day_name#35011,d_quarter_name#35012,d_holiday#35013,d_weekend#35014,d_following_holiday#35015,d_first_dom#35016,d_last_dom#35017,d_same_day_ly#35018,d_same_day_lq#35019,d_current_day#35020,... 4 more fields] parquet\n                                          +- SubqueryAlias web_returns\n                                             +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [sales_cnt_diff#34683L ASC NULLS FIRST], true\n      +- Project [d_year#35003 AS prev_year#34679, d_year#1046 AS year#34680, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sales_cnt#34695L AS prev_yr_cnt#34681L, sales_cnt#34691L AS curr_yr_cnt#34682L, (sales_cnt#34691L - sales_cnt#34695L) AS sales_cnt_diff#34683L, CheckOverflow((promote_precision(cast(sales_amt#34692 as decimal(19,2))) - promote_precision(cast(sales_amt#34696 as decimal(19,2)))), DecimalType(19,2)) AS sales_amt_diff#34684]\n         +- Join Inner, (((((i_brand_id#1179 = i_brand_id#34854) && (i_class_id#1181 = i_class_id#34856)) && (i_category_id#1183 = i_category_id#34858)) && (i_manufact_id#1185 = i_manufact_id#34860)) && (CheckOverflow((promote_precision(cast(sales_cnt#34691L as decimal(17,2))) / promote_precision(cast(sales_cnt#34695L as decimal(17,2)))), DecimalType(37,20)) < 0.90000000000000000000))\n            :- Aggregate [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185], [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sum(cast(sales_cnt#34685 as bigint)) AS sales_cnt#34691L, MakeDecimal(sum(UnscaledValue(sales_amt#34686)),18,2) AS sales_amt#34692]\n            :  +- Aggregate [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sales_cnt#34685, sales_amt#34686], [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sales_cnt#34685, sales_amt#34686]\n            :     +- Union\n            :        :- Project [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, (cs_quantity#1806 - coalesce(cr_return_quantity#2102, 0)) AS sales_cnt#34685, CheckOverflow((promote_precision(cast(cs_ext_sales_price#1811 as decimal(8,2))) - promote_precision(cast(coalesce(cr_return_amount#2103, 0.00) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34686]\n            :        :  +- Join LeftOuter, ((cs_order_number#1805L = cr_order_number#2101L) && (cs_item_sk#1803 = cr_item_sk#2087))\n            :        :     :- Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_ext_sales_price#1811, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, d_year#1046]\n            :        :     :  +- Join Inner, (d_date_sk#1040 = cs_sold_date_sk#1822)\n            :        :     :     :- Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_ext_sales_price#1811, cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185]\n            :        :     :     :  +- Join Inner, (i_item_sk#1172 = cs_item_sk#1803)\n            :        :     :     :     :- Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n            :        :     :     :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n            :        :     :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n            :        :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185]\n            :        :     :     :        +- Filter ((((((isnotnull(i_category#1184) && (i_category#1184 = Books)) && isnotnull(i_item_sk#1172)) && isnotnull(i_manufact_id#1185)) && isnotnull(i_category_id#1183)) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179))\n            :        :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :        :     :     +- Project [d_date_sk#1040, d_year#1046]\n            :        :     :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n            :        :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :        :     +- Project [cr_item_sk#2087, cr_order_number#2101L, cr_return_quantity#2102, cr_return_amount#2103]\n            :        :        +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n            :        :- Project [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, (ss_quantity#1913 - coalesce(sr_return_quantity#1713, 0)) AS sales_cnt#34687, CheckOverflow((promote_precision(cast(ss_ext_sales_price#1918 as decimal(8,2))) - promote_precision(cast(coalesce(sr_return_amt#1714, 0.00) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34688]\n            :        :  +- Join LeftOuter, ((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705))\n            :        :     :- Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_ext_sales_price#1918, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, d_year#1046]\n            :        :     :  +- Join Inner, (d_date_sk#1040 = ss_sold_date_sk#1926)\n            :        :     :     :- Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_ext_sales_price#1918, ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185]\n            :        :     :     :  +- Join Inner, (i_item_sk#1172 = ss_item_sk#1905)\n            :        :     :     :     :- Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :        :     :     :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n            :        :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :        :     :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185]\n            :        :     :     :        +- Filter ((((((isnotnull(i_category#1184) && (i_category#1184 = Books)) && isnotnull(i_item_sk#1172)) && isnotnull(i_manufact_id#1185)) && isnotnull(i_category_id#1183)) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179))\n            :        :     :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :        :     :     +- Project [d_date_sk#1040, d_year#1046]\n            :        :     :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n            :        :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :        :     +- Project [sr_item_sk#1705, sr_ticket_number#1712L, sr_return_quantity#1713, sr_return_amt#1714]\n            :        :        +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n            :        +- Project [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, (ws_quantity#1772 - coalesce(wr_return_quantity#2130, 0)) AS sales_cnt#34689, CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(8,2))) - promote_precision(cast(coalesce(wr_return_amt#2131, 0.00) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34690]\n            :           +- Join LeftOuter, ((ws_order_number#1771L = wr_order_number#2129L) && (ws_item_sk#1757 = wr_item_sk#2118))\n            :              :- Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_ext_sales_price#1777, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, d_year#1046]\n            :              :  +- Join Inner, (d_date_sk#1040 = ws_sold_date_sk#1788)\n            :              :     :- Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_ext_sales_price#1777, ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185]\n            :              :     :  +- Join Inner, (i_item_sk#1172 = ws_item_sk#1757)\n            :              :     :     :- Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n            :              :     :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n            :              :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :              :     :     +- Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185]\n            :              :     :        +- Filter ((((((isnotnull(i_category#1184) && (i_category#1184 = Books)) && isnotnull(i_item_sk#1172)) && isnotnull(i_manufact_id#1185)) && isnotnull(i_category_id#1183)) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179))\n            :              :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :              :     +- Project [d_date_sk#1040, d_year#1046]\n            :              :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n            :              :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :              +- Project [wr_item_sk#2118, wr_order_number#2129L, wr_return_quantity#2130, wr_return_amt#2131]\n            :                 +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n            +- Aggregate [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860], [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, sum(cast(sales_cnt#34685 as bigint)) AS sales_cnt#34695L, MakeDecimal(sum(UnscaledValue(sales_amt#34686)),18,2) AS sales_amt#34696]\n               +- Aggregate [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, sales_cnt#34685, sales_amt#34686], [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, sales_cnt#34685, sales_amt#34686]\n                  +- Union\n                     :- Project [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, (cs_quantity#1806 - coalesce(cr_return_quantity#2102, 0)) AS sales_cnt#34685, CheckOverflow((promote_precision(cast(cs_ext_sales_price#1811 as decimal(8,2))) - promote_precision(cast(coalesce(cr_return_amount#2103, 0.00) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34686]\n                     :  +- Join LeftOuter, ((cs_order_number#1805L = cr_order_number#2101L) && (cs_item_sk#1803 = cr_item_sk#2087))\n                     :     :- Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_ext_sales_price#1811, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, d_year#35003]\n                     :     :  +- Join Inner, (d_date_sk#34997 = cs_sold_date_sk#1822)\n                     :     :     :- Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_ext_sales_price#1811, cs_sold_date_sk#1822, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860]\n                     :     :     :  +- Join Inner, (i_item_sk#34847 = cs_item_sk#1803)\n                     :     :     :     :- Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n                     :     :     :     :  +- Filter (isnotnull(cs_item_sk#1803) && isnotnull(cs_sold_date_sk#1822))\n                     :     :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :     :     :     +- Project [i_item_sk#34847, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860]\n                     :     :     :        +- Filter ((((((isnotnull(i_category#34859) && (i_category#34859 = Books)) && isnotnull(i_item_sk#34847)) && isnotnull(i_category_id#34858)) && isnotnull(i_brand_id#34854)) && isnotnull(i_class_id#34856)) && isnotnull(i_manufact_id#34860))\n                     :     :     :           +- Relation[i_item_sk#34847,i_item_id#34848,i_rec_start_date#34849,i_rec_end_date#34850,i_item_desc#34851,i_current_price#34852,i_wholesale_cost#34853,i_brand_id#34854,i_brand#34855,i_class_id#34856,i_class#34857,i_category_id#34858,i_category#34859,i_manufact_id#34860,i_manufact#34861,i_size#34862,i_formulation#34863,i_color#34864,i_units#34865,i_container#34866,i_manager_id#34867,i_product_name#34868] parquet\n                     :     :     +- Project [d_date_sk#34997, d_year#35003]\n                     :     :        +- Filter ((isnotnull(d_year#35003) && (d_year#35003 = 2001)) && isnotnull(d_date_sk#34997))\n                     :     :           +- Relation[d_date_sk#34997,d_date_id#34998,d_date#34999,d_month_seq#35000,d_week_seq#35001,d_quarter_seq#35002,d_year#35003,d_dow#35004,d_moy#35005,d_dom#35006,d_qoy#35007,d_fy_year#35008,d_fy_quarter_seq#35009,d_fy_week_seq#35010,d_day_name#35011,d_quarter_name#35012,d_holiday#35013,d_weekend#35014,d_following_holiday#35015,d_first_dom#35016,d_last_dom#35017,d_same_day_ly#35018,d_same_day_lq#35019,d_current_day#35020,... 4 more fields] parquet\n                     :     +- Project [cr_item_sk#2087, cr_order_number#2101L, cr_return_quantity#2102, cr_return_amount#2103]\n                     :        +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n                     :- Project [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, (ss_quantity#1913 - coalesce(sr_return_quantity#1713, 0)) AS sales_cnt#34687, CheckOverflow((promote_precision(cast(ss_ext_sales_price#1918 as decimal(8,2))) - promote_precision(cast(coalesce(sr_return_amt#1714, 0.00) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34688]\n                     :  +- Join LeftOuter, ((ss_ticket_number#1912L = sr_ticket_number#1712L) && (ss_item_sk#1905 = sr_item_sk#1705))\n                     :     :- Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_ext_sales_price#1918, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, d_year#35003]\n                     :     :  +- Join Inner, (d_date_sk#34997 = ss_sold_date_sk#1926)\n                     :     :     :- Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_ext_sales_price#1918, ss_sold_date_sk#1926, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860]\n                     :     :     :  +- Join Inner, (i_item_sk#34847 = ss_item_sk#1905)\n                     :     :     :     :- Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                     :     :     :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n                     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :     :     :     +- Project [i_item_sk#34847, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860]\n                     :     :     :        +- Filter ((((((isnotnull(i_category#34859) && (i_category#34859 = Books)) && isnotnull(i_item_sk#34847)) && isnotnull(i_category_id#34858)) && isnotnull(i_brand_id#34854)) && isnotnull(i_class_id#34856)) && isnotnull(i_manufact_id#34860))\n                     :     :     :           +- Relation[i_item_sk#34847,i_item_id#34848,i_rec_start_date#34849,i_rec_end_date#34850,i_item_desc#34851,i_current_price#34852,i_wholesale_cost#34853,i_brand_id#34854,i_brand#34855,i_class_id#34856,i_class#34857,i_category_id#34858,i_category#34859,i_manufact_id#34860,i_manufact#34861,i_size#34862,i_formulation#34863,i_color#34864,i_units#34865,i_container#34866,i_manager_id#34867,i_product_name#34868] parquet\n                     :     :     +- Project [d_date_sk#34997, d_year#35003]\n                     :     :        +- Filter ((isnotnull(d_year#35003) && (d_year#35003 = 2001)) && isnotnull(d_date_sk#34997))\n                     :     :           +- Relation[d_date_sk#34997,d_date_id#34998,d_date#34999,d_month_seq#35000,d_week_seq#35001,d_quarter_seq#35002,d_year#35003,d_dow#35004,d_moy#35005,d_dom#35006,d_qoy#35007,d_fy_year#35008,d_fy_quarter_seq#35009,d_fy_week_seq#35010,d_day_name#35011,d_quarter_name#35012,d_holiday#35013,d_weekend#35014,d_following_holiday#35015,d_first_dom#35016,d_last_dom#35017,d_same_day_ly#35018,d_same_day_lq#35019,d_current_day#35020,... 4 more fields] parquet\n                     :     +- Project [sr_item_sk#1705, sr_ticket_number#1712L, sr_return_quantity#1713, sr_return_amt#1714]\n                     :        +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                     +- Project [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, (ws_quantity#1772 - coalesce(wr_return_quantity#2130, 0)) AS sales_cnt#34689, CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(8,2))) - promote_precision(cast(coalesce(wr_return_amt#2131, 0.00) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34690]\n                        +- Join LeftOuter, ((ws_order_number#1771L = wr_order_number#2129L) && (ws_item_sk#1757 = wr_item_sk#2118))\n                           :- Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_ext_sales_price#1777, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, d_year#35003]\n                           :  +- Join Inner, (d_date_sk#34997 = ws_sold_date_sk#1788)\n                           :     :- Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_ext_sales_price#1777, ws_sold_date_sk#1788, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860]\n                           :     :  +- Join Inner, (i_item_sk#34847 = ws_item_sk#1757)\n                           :     :     :- Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                           :     :     :  +- Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_sold_date_sk#1788))\n                           :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                           :     :     +- Project [i_item_sk#34847, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860]\n                           :     :        +- Filter ((((((isnotnull(i_category#34859) && (i_category#34859 = Books)) && isnotnull(i_item_sk#34847)) && isnotnull(i_category_id#34858)) && isnotnull(i_brand_id#34854)) && isnotnull(i_class_id#34856)) && isnotnull(i_manufact_id#34860))\n                           :     :           +- Relation[i_item_sk#34847,i_item_id#34848,i_rec_start_date#34849,i_rec_end_date#34850,i_item_desc#34851,i_current_price#34852,i_wholesale_cost#34853,i_brand_id#34854,i_brand#34855,i_class_id#34856,i_class#34857,i_category_id#34858,i_category#34859,i_manufact_id#34860,i_manufact#34861,i_size#34862,i_formulation#34863,i_color#34864,i_units#34865,i_container#34866,i_manager_id#34867,i_product_name#34868] parquet\n                           :     +- Project [d_date_sk#34997, d_year#35003]\n                           :        +- Filter ((isnotnull(d_year#35003) && (d_year#35003 = 2001)) && isnotnull(d_date_sk#34997))\n                           :           +- Relation[d_date_sk#34997,d_date_id#34998,d_date#34999,d_month_seq#35000,d_week_seq#35001,d_quarter_seq#35002,d_year#35003,d_dow#35004,d_moy#35005,d_dom#35006,d_qoy#35007,d_fy_year#35008,d_fy_quarter_seq#35009,d_fy_week_seq#35010,d_day_name#35011,d_quarter_name#35012,d_holiday#35013,d_weekend#35014,d_following_holiday#35015,d_first_dom#35016,d_last_dom#35017,d_same_day_ly#35018,d_same_day_lq#35019,d_current_day#35020,... 4 more fields] parquet\n                           +- Project [wr_item_sk#2118, wr_order_number#2129L, wr_return_quantity#2130, wr_return_amt#2131]\n                              +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[sales_cnt_diff#34683L ASC NULLS FIRST], output=[prev_year#34679,year#34680,i_brand_id#1179,i_class_id#1181,i_category_id#1183,i_manufact_id#1185,prev_yr_cnt#34681L,curr_yr_cnt#34682L,sales_cnt_diff#34683L,sales_amt_diff#34684])\n+- *(51) Project [d_year#35003 AS prev_year#34679, d_year#1046 AS year#34680, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sales_cnt#34695L AS prev_yr_cnt#34681L, sales_cnt#34691L AS curr_yr_cnt#34682L, (sales_cnt#34691L - sales_cnt#34695L) AS sales_cnt_diff#34683L, CheckOverflow((promote_precision(cast(sales_amt#34692 as decimal(19,2))) - promote_precision(cast(sales_amt#34696 as decimal(19,2)))), DecimalType(19,2)) AS sales_amt_diff#34684]\n   +- *(51) SortMergeJoin [i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185], [i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860], Inner, (CheckOverflow((promote_precision(cast(sales_cnt#34691L as decimal(17,2))) / promote_precision(cast(sales_cnt#34695L as decimal(17,2)))), DecimalType(37,20)) < 0.90000000000000000000)\n      :- *(25) Sort [i_brand_id#1179 ASC NULLS FIRST, i_class_id#1181 ASC NULLS FIRST, i_category_id#1183 ASC NULLS FIRST, i_manufact_id#1185 ASC NULLS FIRST], false, 0\n      :  +- Exchange hashpartitioning(i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, 200)\n      :     +- *(24) HashAggregate(keys=[d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185], functions=[sum(cast(sales_cnt#34685 as bigint)), sum(UnscaledValue(sales_amt#34686))], output=[d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sales_cnt#34691L, sales_amt#34692])\n      :        +- Exchange hashpartitioning(d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, 200)\n      :           +- *(23) HashAggregate(keys=[d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185], functions=[partial_sum(cast(sales_cnt#34685 as bigint)), partial_sum(UnscaledValue(sales_amt#34686))], output=[d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sum#35093L, sum#35094L])\n      :              +- *(23) HashAggregate(keys=[d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sales_cnt#34685, sales_amt#34686], functions=[], output=[d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sales_cnt#34685, sales_amt#34686])\n      :                 +- Exchange hashpartitioning(d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sales_cnt#34685, sales_amt#34686, 200)\n      :                    +- *(22) HashAggregate(keys=[d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sales_cnt#34685, sales_amt#34686], functions=[], output=[d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, sales_cnt#34685, sales_amt#34686])\n      :                       +- Union\n      :                          :- *(7) Project [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, (cs_quantity#1806 - coalesce(cr_return_quantity#2102, 0)) AS sales_cnt#34685, CheckOverflow((promote_precision(cast(cs_ext_sales_price#1811 as decimal(8,2))) - promote_precision(cast(coalesce(cr_return_amount#2103, 0.00) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34686]\n      :                          :  +- SortMergeJoin [cs_order_number#1805L, cs_item_sk#1803], [cr_order_number#2101L, cr_item_sk#2087], LeftOuter\n      :                          :     :- *(4) Sort [cs_order_number#1805L ASC NULLS FIRST, cs_item_sk#1803 ASC NULLS FIRST], false, 0\n      :                          :     :  +- Exchange hashpartitioning(cs_order_number#1805L, cs_item_sk#1803, 200)\n      :                          :     :     +- *(3) Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_ext_sales_price#1811, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, d_year#1046]\n      :                          :     :        +- *(3) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n      :                          :     :           :- *(3) Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_ext_sales_price#1811, cs_sold_date_sk#1822, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185]\n      :                          :     :           :  +- *(3) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n      :                          :     :           :     :- *(3) Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n      :                          :     :           :     :  +- *(3) Filter isnotnull(cs_item_sk#1803)\n      :                          :     :           :     :     +- *(3) FileScan parquet db_tpcds.catalog_sales[cs_item_sk#1803,cs_order_number#1805L,cs_quantity#1806,cs_ext_sales_price#1811,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:int,cs_order_number:bigint,cs_quantity:int,cs_ext_sales_price:decimal(7,2)>\n      :                          :     :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                          :     :           :        +- *(1) Project [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185]\n      :                          :     :           :           +- *(1) Filter ((((((isnotnull(i_category#1184) && (i_category#1184 = Books)) && isnotnull(i_item_sk#1172)) && isnotnull(i_manufact_id#1185)) && isnotnull(i_category_id#1183)) && isnotnull(i_class_id#1181)) && isnotnull(i_brand_id#1179))\n      :                          :     :           :              +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand_id#1179,i_class_id#1181,i_category_id#1183,i_category#1184,i_manufact_id#1185] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_category), EqualTo(i_category,Books), IsNotNull(i_item_sk), IsNotNull(i_manufact_id)..., ReadSchema: struct<i_item_sk:int,i_brand_id:int,i_class_id:int,i_category_id:int,i_category:string,i_manufact...\n      :                          :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                          :     :              +- *(2) Project [d_date_sk#1040, d_year#1046]\n      :                          :     :                 +- *(2) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2002)) && isnotnull(d_date_sk#1040))\n      :                          :     :                    +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n      :                          :     +- *(6) Sort [cr_order_number#2101L ASC NULLS FIRST, cr_item_sk#2087 ASC NULLS FIRST], false, 0\n      :                          :        +- Exchange hashpartitioning(cr_order_number#2101L, cr_item_sk#2087, 200)\n      :                          :           +- *(5) Project [cr_item_sk#2087, cr_order_number#2101L, cr_return_quantity#2102, cr_return_amount#2103]\n      :                          :              +- *(5) FileScan parquet db_tpcds.catalog_returns[cr_item_sk#2087,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns], PartitionCount: 2066, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<cr_item_sk:int,cr_order_number:bigint,cr_return_quantity:int,cr_return_amount:decimal(7,2)>\n      :                          :- *(14) Project [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, (ss_quantity#1913 - coalesce(sr_return_quantity#1713, 0)) AS sales_cnt#34687, CheckOverflow((promote_precision(cast(ss_ext_sales_price#1918 as decimal(8,2))) - promote_precision(cast(coalesce(sr_return_amt#1714, 0.00) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34688]\n      :                          :  +- SortMergeJoin [ss_ticket_number#1912L, ss_item_sk#1905], [sr_ticket_number#1712L, sr_item_sk#1705], LeftOuter\n      :                          :     :- *(11) Sort [ss_ticket_number#1912L ASC NULLS FIRST, ss_item_sk#1905 ASC NULLS FIRST], false, 0\n      :                          :     :  +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_item_sk#1905, 200)\n      :                          :     :     +- *(10) Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_ext_sales_price#1918, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, d_year#1046]\n      :                          :     :        +- *(10) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :                          :     :           :- *(10) Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_ext_sales_price#1918, ss_sold_date_sk#1926, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185]\n      :                          :     :           :  +- *(10) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n      :                          :     :           :     :- *(10) Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n      :                          :     :           :     :  +- *(10) Filter isnotnull(ss_item_sk#1905)\n      :                          :     :           :     :     +- *(10) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_ticket_number#1912L,ss_quantity#1913,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_ticket_number:bigint,ss_quantity:int,ss_ext_sales_price:decimal(7,2)>\n      :                          :     :           :     +- ReusedExchange [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                          :     :           +- ReusedExchange [d_date_sk#1040, d_year#1046], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                          :     +- *(13) Sort [sr_ticket_number#1712L ASC NULLS FIRST, sr_item_sk#1705 ASC NULLS FIRST], false, 0\n      :                          :        +- Exchange hashpartitioning(sr_ticket_number#1712L, sr_item_sk#1705, 200)\n      :                          :           +- *(12) Project [sr_item_sk#1705, sr_ticket_number#1712L, sr_return_quantity#1713, sr_return_amt#1714]\n      :                          :              +- *(12) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns], PartitionCount: 2002, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint,sr_return_quantity:int,sr_return_amt:decimal(7,2)>\n      :                          +- *(21) Project [d_year#1046, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, (ws_quantity#1772 - coalesce(wr_return_quantity#2130, 0)) AS sales_cnt#34689, CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(8,2))) - promote_precision(cast(coalesce(wr_return_amt#2131, 0.00) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34690]\n      :                             +- SortMergeJoin [ws_order_number#1771L, ws_item_sk#1757], [wr_order_number#2129L, wr_item_sk#2118], LeftOuter\n      :                                :- *(18) Sort [ws_order_number#1771L ASC NULLS FIRST, ws_item_sk#1757 ASC NULLS FIRST], false, 0\n      :                                :  +- Exchange hashpartitioning(ws_order_number#1771L, ws_item_sk#1757, 200)\n      :                                :     +- *(17) Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_ext_sales_price#1777, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185, d_year#1046]\n      :                                :        +- *(17) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n      :                                :           :- *(17) Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_ext_sales_price#1777, ws_sold_date_sk#1788, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185]\n      :                                :           :  +- *(17) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n      :                                :           :     :- *(17) Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n      :                                :           :     :  +- *(17) Filter isnotnull(ws_item_sk#1757)\n      :                                :           :     :     +- *(17) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_order_number#1771L,ws_quantity#1772,ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_order_number:bigint,ws_quantity:int,ws_ext_sales_price:decimal(7,2)>\n      :                                :           :     +- ReusedExchange [i_item_sk#1172, i_brand_id#1179, i_class_id#1181, i_category_id#1183, i_manufact_id#1185], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                                :           +- ReusedExchange [d_date_sk#1040, d_year#1046], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                                +- *(20) Sort [wr_order_number#2129L ASC NULLS FIRST, wr_item_sk#2118 ASC NULLS FIRST], false, 0\n      :                                   +- Exchange hashpartitioning(wr_order_number#2129L, wr_item_sk#2118, 200)\n      :                                      +- *(19) Project [wr_item_sk#2118, wr_order_number#2129L, wr_return_quantity#2130, wr_return_amt#2131]\n      :                                         +- *(19) FileScan parquet db_tpcds.web_returns[wr_item_sk#2118,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_returned_date_sk#2140] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_returns], PartitionCount: 2110, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<wr_item_sk:int,wr_order_number:bigint,wr_return_quantity:int,wr_return_amt:decimal(7,2)>\n      +- *(50) Sort [i_brand_id#34854 ASC NULLS FIRST, i_class_id#34856 ASC NULLS FIRST, i_category_id#34858 ASC NULLS FIRST, i_manufact_id#34860 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, 200)\n            +- *(49) HashAggregate(keys=[d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860], functions=[sum(cast(sales_cnt#34685 as bigint)), sum(UnscaledValue(sales_amt#34686))], output=[d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, sales_cnt#34695L, sales_amt#34696])\n               +- Exchange hashpartitioning(d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, 200)\n                  +- *(48) HashAggregate(keys=[d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860], functions=[partial_sum(cast(sales_cnt#34685 as bigint)), partial_sum(UnscaledValue(sales_amt#34686))], output=[d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, sum#35093L, sum#35096L])\n                     +- *(48) HashAggregate(keys=[d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, sales_cnt#34685, sales_amt#34686], functions=[], output=[d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, sales_cnt#34685, sales_amt#34686])\n                        +- Exchange hashpartitioning(d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, sales_cnt#34685, sales_amt#34686, 200)\n                           +- *(47) HashAggregate(keys=[d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, sales_cnt#34685, sales_amt#34686], functions=[], output=[d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, sales_cnt#34685, sales_amt#34686])\n                              +- Union\n                                 :- *(32) Project [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, (cs_quantity#1806 - coalesce(cr_return_quantity#2102, 0)) AS sales_cnt#34685, CheckOverflow((promote_precision(cast(cs_ext_sales_price#1811 as decimal(8,2))) - promote_precision(cast(coalesce(cr_return_amount#2103, 0.00) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34686]\n                                 :  +- SortMergeJoin [cs_order_number#1805L, cs_item_sk#1803], [cr_order_number#2101L, cr_item_sk#2087], LeftOuter\n                                 :     :- *(29) Sort [cs_order_number#1805L ASC NULLS FIRST, cs_item_sk#1803 ASC NULLS FIRST], false, 0\n                                 :     :  +- Exchange hashpartitioning(cs_order_number#1805L, cs_item_sk#1803, 200)\n                                 :     :     +- *(28) Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_ext_sales_price#1811, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, d_year#35003]\n                                 :     :        +- *(28) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#34997], Inner, BuildRight\n                                 :     :           :- *(28) Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_ext_sales_price#1811, cs_sold_date_sk#1822, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860]\n                                 :     :           :  +- *(28) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#34847], Inner, BuildRight\n                                 :     :           :     :- *(28) Project [cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n                                 :     :           :     :  +- *(28) Filter isnotnull(cs_item_sk#1803)\n                                 :     :           :     :     +- *(28) FileScan parquet db_tpcds.catalog_sales[cs_item_sk#1803,cs_order_number#1805L,cs_quantity#1806,cs_ext_sales_price#1811,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_item_sk)], ReadSchema: struct<cs_item_sk:int,cs_order_number:bigint,cs_quantity:int,cs_ext_sales_price:decimal(7,2)>\n                                 :     :           :     +- ReusedExchange [i_item_sk#34847, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 :     :              +- *(27) Project [d_date_sk#34997, d_year#35003]\n                                 :     :                 +- *(27) Filter ((isnotnull(d_year#35003) && (d_year#35003 = 2001)) && isnotnull(d_date_sk#34997))\n                                 :     :                    +- *(27) FileScan parquet db_tpcds.date_dim[d_date_sk#34997,d_year#35003] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n                                 :     +- *(31) Sort [cr_order_number#2101L ASC NULLS FIRST, cr_item_sk#2087 ASC NULLS FIRST], false, 0\n                                 :        +- ReusedExchange [cr_item_sk#2087, cr_order_number#2101L, cr_return_quantity#2102, cr_return_amount#2103], Exchange hashpartitioning(cr_order_number#2101L, cr_item_sk#2087, 200)\n                                 :- *(39) Project [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, (ss_quantity#1913 - coalesce(sr_return_quantity#1713, 0)) AS sales_cnt#34687, CheckOverflow((promote_precision(cast(ss_ext_sales_price#1918 as decimal(8,2))) - promote_precision(cast(coalesce(sr_return_amt#1714, 0.00) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34688]\n                                 :  +- SortMergeJoin [ss_ticket_number#1912L, ss_item_sk#1905], [sr_ticket_number#1712L, sr_item_sk#1705], LeftOuter\n                                 :     :- *(36) Sort [ss_ticket_number#1912L ASC NULLS FIRST, ss_item_sk#1905 ASC NULLS FIRST], false, 0\n                                 :     :  +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_item_sk#1905, 200)\n                                 :     :     +- *(35) Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_ext_sales_price#1918, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, d_year#35003]\n                                 :     :        +- *(35) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#34997], Inner, BuildRight\n                                 :     :           :- *(35) Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_ext_sales_price#1918, ss_sold_date_sk#1926, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860]\n                                 :     :           :  +- *(35) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#34847], Inner, BuildRight\n                                 :     :           :     :- *(35) Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_quantity#1913, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                                 :     :           :     :  +- *(35) Filter isnotnull(ss_item_sk#1905)\n                                 :     :           :     :     +- *(35) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_ticket_number#1912L,ss_quantity#1913,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_ticket_number:bigint,ss_quantity:int,ss_ext_sales_price:decimal(7,2)>\n                                 :     :           :     +- ReusedExchange [i_item_sk#34847, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 :     :           +- ReusedExchange [d_date_sk#34997, d_year#35003], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 :     +- *(38) Sort [sr_ticket_number#1712L ASC NULLS FIRST, sr_item_sk#1705 ASC NULLS FIRST], false, 0\n                                 :        +- ReusedExchange [sr_item_sk#1705, sr_ticket_number#1712L, sr_return_quantity#1713, sr_return_amt#1714], Exchange hashpartitioning(sr_ticket_number#1712L, sr_item_sk#1705, 200)\n                                 +- *(46) Project [d_year#35003, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, (ws_quantity#1772 - coalesce(wr_return_quantity#2130, 0)) AS sales_cnt#34689, CheckOverflow((promote_precision(cast(ws_ext_sales_price#1777 as decimal(8,2))) - promote_precision(cast(coalesce(wr_return_amt#2131, 0.00) as decimal(8,2)))), DecimalType(8,2)) AS sales_amt#34690]\n                                    +- SortMergeJoin [ws_order_number#1771L, ws_item_sk#1757], [wr_order_number#2129L, wr_item_sk#2118], LeftOuter\n                                       :- *(43) Sort [ws_order_number#1771L ASC NULLS FIRST, ws_item_sk#1757 ASC NULLS FIRST], false, 0\n                                       :  +- Exchange hashpartitioning(ws_order_number#1771L, ws_item_sk#1757, 200)\n                                       :     +- *(42) Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_ext_sales_price#1777, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860, d_year#35003]\n                                       :        +- *(42) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#34997], Inner, BuildRight\n                                       :           :- *(42) Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_ext_sales_price#1777, ws_sold_date_sk#1788, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860]\n                                       :           :  +- *(42) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#34847], Inner, BuildRight\n                                       :           :     :- *(42) Project [ws_item_sk#1757, ws_order_number#1771L, ws_quantity#1772, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n                                       :           :     :  +- *(42) Filter isnotnull(ws_item_sk#1757)\n                                       :           :     :     +- *(42) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_order_number#1771L,ws_quantity#1772,ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_order_number:bigint,ws_quantity:int,ws_ext_sales_price:decimal(7,2)>\n                                       :           :     +- ReusedExchange [i_item_sk#34847, i_brand_id#34854, i_class_id#34856, i_category_id#34858, i_manufact_id#34860], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                       :           +- ReusedExchange [d_date_sk#34997, d_year#35003], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                       +- *(45) Sort [wr_order_number#2129L ASC NULLS FIRST, wr_item_sk#2118 ASC NULLS FIRST], false, 0\n                                          +- ReusedExchange [wr_item_sk#2118, wr_order_number#2129L, wr_return_quantity#2130, wr_return_amt#2131], Exchange hashpartitioning(wr_order_number#2129L, wr_item_sk#2118, 200)"},{"name":"q76-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","item","date_dim","web_sales","item","date_dim","catalog_sales","item","date_dim"],"parsingTime":0.002708,"analysisTime":0.001592,"optimizationTime":761.203195,"planningTime":32.57826,"executionTime":5143.478445,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['channel ASC NULLS FIRST, 'col_name ASC NULLS FIRST, 'd_year ASC NULLS FIRST, 'd_qoy ASC NULLS FIRST, 'i_category ASC NULLS FIRST], true\n      +- 'Aggregate ['channel, 'col_name, 'd_year, 'd_qoy, 'i_category], ['channel, 'col_name, 'd_year, 'd_qoy, 'i_category, 'COUNT(1) AS sales_cnt#35556, 'SUM('ext_sales_price) AS sales_amt#35557]\n         +- 'SubqueryAlias foo\n            +- 'Union\n               :- 'Union\n               :  :- 'Project [store AS channel#35547, 'ss_store_sk AS col_name#35548, 'd_year, 'd_qoy, 'i_category, 'ss_ext_sales_price AS ext_sales_price#35549]\n               :  :  +- 'Filter ((isnull('ss_store_sk) && ('ss_sold_date_sk = 'd_date_sk)) && ('ss_item_sk = 'i_item_sk))\n               :  :     +- 'Join Inner\n               :  :        :- 'Join Inner\n               :  :        :  :- 'UnresolvedRelation `store_sales`\n               :  :        :  +- 'UnresolvedRelation `item`\n               :  :        +- 'UnresolvedRelation `date_dim`\n               :  +- 'Project [web AS channel#35550, 'ws_ship_customer_sk AS col_name#35551, 'd_year, 'd_qoy, 'i_category, 'ws_ext_sales_price AS ext_sales_price#35552]\n               :     +- 'Filter ((isnull('ws_ship_customer_sk) && ('ws_sold_date_sk = 'd_date_sk)) && ('ws_item_sk = 'i_item_sk))\n               :        +- 'Join Inner\n               :           :- 'Join Inner\n               :           :  :- 'UnresolvedRelation `web_sales`\n               :           :  +- 'UnresolvedRelation `item`\n               :           +- 'UnresolvedRelation `date_dim`\n               +- 'Project [catalog AS channel#35553, 'cs_ship_addr_sk AS col_name#35554, 'd_year, 'd_qoy, 'i_category, 'cs_ext_sales_price AS ext_sales_price#35555]\n                  +- 'Filter ((isnull('cs_ship_addr_sk) && ('cs_sold_date_sk = 'd_date_sk)) && ('cs_item_sk = 'i_item_sk))\n                     +- 'Join Inner\n                        :- 'Join Inner\n                        :  :- 'UnresolvedRelation `catalog_sales`\n                        :  +- 'UnresolvedRelation `item`\n                        +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nchannel: string, col_name: int, d_year: int, d_qoy: int, i_category: string, sales_cnt: bigint, sales_amt: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [channel#35547, col_name#35548, d_year#1046, d_qoy#1050, i_category#1184, sales_cnt#35556L, sales_amt#35557]\n      +- Sort [channel#35547 ASC NULLS FIRST, col_name#35548 ASC NULLS FIRST, d_year#1046 ASC NULLS FIRST, d_qoy#1050 ASC NULLS FIRST, i_category#1184 ASC NULLS FIRST], true\n         +- Aggregate [channel#35547, col_name#35548, d_year#1046, d_qoy#1050, i_category#1184], [channel#35547, col_name#35548, d_year#1046, d_qoy#1050, i_category#1184, count(1) AS sales_cnt#35556L, sum(ext_sales_price#35549) AS sales_amt#35557]\n            +- SubqueryAlias foo\n               +- Union\n                  :- Union\n                  :  :- Project [store AS channel#35547, ss_store_sk#1910 AS col_name#35548, d_year#1046, d_qoy#1050, i_category#1184, ss_ext_sales_price#1918 AS ext_sales_price#35549]\n                  :  :  +- Filter ((isnull(ss_store_sk#1910) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && (ss_item_sk#1905 = i_item_sk#1172))\n                  :  :     +- Join Inner\n                  :  :        :- Join Inner\n                  :  :        :  :- SubqueryAlias store_sales\n                  :  :        :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :  :        :  +- SubqueryAlias item\n                  :  :        :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  :  :        +- SubqueryAlias date_dim\n                  :  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :  +- Project [web AS channel#35550, ws_ship_customer_sk#1762 AS col_name#35551, d_year#1046, d_qoy#1050, i_category#1184, ws_ext_sales_price#1777 AS ext_sales_price#35552]\n                  :     +- Filter ((isnull(ws_ship_customer_sk#1762) && (ws_sold_date_sk#1788 = d_date_sk#1040)) && (ws_item_sk#1757 = i_item_sk#1172))\n                  :        +- Join Inner\n                  :           :- Join Inner\n                  :           :  :- SubqueryAlias web_sales\n                  :           :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :           :  +- SubqueryAlias item\n                  :           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  :           +- SubqueryAlias date_dim\n                  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  +- Project [catalog AS channel#35553, cs_ship_addr_sk#1798 AS col_name#35554, d_year#1046, d_qoy#1050, i_category#1184, cs_ext_sales_price#1811 AS ext_sales_price#35555]\n                     +- Filter ((isnull(cs_ship_addr_sk#1798) && (cs_sold_date_sk#1822 = d_date_sk#1040)) && (cs_item_sk#1803 = i_item_sk#1172))\n                        +- Join Inner\n                           :- Join Inner\n                           :  :- SubqueryAlias catalog_sales\n                           :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                           :  +- SubqueryAlias item\n                           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                           +- SubqueryAlias date_dim\n                              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#35547 ASC NULLS FIRST, col_name#35548 ASC NULLS FIRST, d_year#1046 ASC NULLS FIRST, d_qoy#1050 ASC NULLS FIRST, i_category#1184 ASC NULLS FIRST], true\n      +- Aggregate [channel#35547, col_name#35548, d_year#1046, d_qoy#1050, i_category#1184], [channel#35547, col_name#35548, d_year#1046, d_qoy#1050, i_category#1184, count(1) AS sales_cnt#35556L, MakeDecimal(sum(UnscaledValue(ext_sales_price#35549)),17,2) AS sales_amt#35557]\n         +- Union\n            :- Project [store AS channel#35547, ss_store_sk#1910 AS col_name#35548, d_year#1046, d_qoy#1050, i_category#1184, ss_ext_sales_price#1918 AS ext_sales_price#35549]\n            :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :     :- Project [ss_store_sk#1910, ss_ext_sales_price#1918, ss_sold_date_sk#1926, i_category#1184]\n            :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n            :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :     :     :  +- Filter ((isnull(ss_store_sk#1910) && isnotnull(ss_item_sk#1905)) && isnotnull(ss_sold_date_sk#1926))\n            :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :     :     +- Project [i_item_sk#1172, i_category#1184]\n            :     :        +- Filter isnotnull(i_item_sk#1172)\n            :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :     +- Project [d_date_sk#1040, d_year#1046, d_qoy#1050]\n            :        +- Filter isnotnull(d_date_sk#1040)\n            :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :- Project [web AS channel#35550, ws_ship_customer_sk#1762 AS col_name#35551, d_year#1046, d_qoy#1050, i_category#1184, ws_ext_sales_price#1777 AS ext_sales_price#35552]\n            :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n            :     :- Project [ws_ship_customer_sk#1762, ws_ext_sales_price#1777, ws_sold_date_sk#1788, i_category#1184]\n            :     :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n            :     :     :- Project [ws_item_sk#1757, ws_ship_customer_sk#1762, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n            :     :     :  +- Filter ((isnull(ws_ship_customer_sk#1762) && isnotnull(ws_item_sk#1757)) && isnotnull(ws_sold_date_sk#1788))\n            :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :     :     +- Project [i_item_sk#1172, i_category#1184]\n            :     :        +- Filter isnotnull(i_item_sk#1172)\n            :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :     +- Project [d_date_sk#1040, d_year#1046, d_qoy#1050]\n            :        +- Filter isnotnull(d_date_sk#1040)\n            :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Project [catalog AS channel#35553, cs_ship_addr_sk#1798 AS col_name#35554, d_year#1046, d_qoy#1050, i_category#1184, cs_ext_sales_price#1811 AS ext_sales_price#35555]\n               +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n                  :- Project [cs_ship_addr_sk#1798, cs_ext_sales_price#1811, cs_sold_date_sk#1822, i_category#1184]\n                  :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n                  :     :- Project [cs_ship_addr_sk#1798, cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n                  :     :  +- Filter ((isnull(cs_ship_addr_sk#1798) && isnotnull(cs_item_sk#1803)) && isnotnull(cs_sold_date_sk#1822))\n                  :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                  :     +- Project [i_item_sk#1172, i_category#1184]\n                  :        +- Filter isnotnull(i_item_sk#1172)\n                  :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  +- Project [d_date_sk#1040, d_year#1046, d_qoy#1050]\n                     +- Filter isnotnull(d_date_sk#1040)\n                        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[channel#35547 ASC NULLS FIRST,col_name#35548 ASC NULLS FIRST,d_year#1046 ASC NULLS FIRST,d_qoy#1050 ASC NULLS FIRST,i_category#1184 ASC NULLS FIRST], output=[channel#35547,col_name#35548,d_year#1046,d_qoy#1050,i_category#1184,sales_cnt#35556L,sales_amt#35557])\n+- *(11) HashAggregate(keys=[channel#35547, col_name#35548, d_year#1046, d_qoy#1050, i_category#1184], functions=[count(1), sum(UnscaledValue(ext_sales_price#35549))], output=[channel#35547, col_name#35548, d_year#1046, d_qoy#1050, i_category#1184, sales_cnt#35556L, sales_amt#35557])\n   +- Exchange hashpartitioning(channel#35547, col_name#35548, d_year#1046, d_qoy#1050, i_category#1184, 200)\n      +- *(10) HashAggregate(keys=[channel#35547, col_name#35548, d_year#1046, d_qoy#1050, i_category#1184], functions=[partial_count(1), partial_sum(UnscaledValue(ext_sales_price#35549))], output=[channel#35547, col_name#35548, d_year#1046, d_qoy#1050, i_category#1184, count#35574L, sum#35575L])\n         +- Union\n            :- *(3) Project [store AS channel#35547, ss_store_sk#1910 AS col_name#35548, d_year#1046, d_qoy#1050, i_category#1184, ss_ext_sales_price#1918 AS ext_sales_price#35549]\n            :  +- *(3) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n            :     :- *(3) Project [ss_store_sk#1910, ss_ext_sales_price#1918, ss_sold_date_sk#1926, i_category#1184]\n            :     :  +- *(3) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n            :     :     :- *(3) Project [ss_item_sk#1905, ss_store_sk#1910, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n            :     :     :  +- *(3) Filter (isnull(ss_store_sk#1910) && isnotnull(ss_item_sk#1905))\n            :     :     :     +- *(3) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_store_sk#1910,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNull(ss_store_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_store_sk:int,ss_ext_sales_price:decimal(7,2)>\n            :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :     :        +- *(1) Project [i_item_sk#1172, i_category#1184]\n            :     :           +- *(1) Filter isnotnull(i_item_sk#1172)\n            :     :              +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_category:string>\n            :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :        +- *(2) Project [d_date_sk#1040, d_year#1046, d_qoy#1050]\n            :           +- *(2) Filter isnotnull(d_date_sk#1040)\n            :              +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_qoy#1050] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_qoy:int>\n            :- *(6) Project [web AS channel#35550, ws_ship_customer_sk#1762 AS col_name#35551, d_year#1046, d_qoy#1050, i_category#1184, ws_ext_sales_price#1777 AS ext_sales_price#35552]\n            :  +- *(6) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n            :     :- *(6) Project [ws_ship_customer_sk#1762, ws_ext_sales_price#1777, ws_sold_date_sk#1788, i_category#1184]\n            :     :  +- *(6) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n            :     :     :- *(6) Project [ws_item_sk#1757, ws_ship_customer_sk#1762, ws_ext_sales_price#1777, ws_sold_date_sk#1788]\n            :     :     :  +- *(6) Filter (isnull(ws_ship_customer_sk#1762) && isnotnull(ws_item_sk#1757))\n            :     :     :     +- *(6) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_ship_customer_sk#1762,ws_ext_sales_price#1777,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNull(ws_ship_customer_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_ship_customer_sk:int,ws_ext_sales_price:decimal(7,2)>\n            :     :     +- ReusedExchange [i_item_sk#1172, i_category#1184], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            :     +- ReusedExchange [d_date_sk#1040, d_year#1046, d_qoy#1050], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n            +- *(9) Project [catalog AS channel#35553, cs_ship_addr_sk#1798 AS col_name#35554, d_year#1046, d_qoy#1050, i_category#1184, cs_ext_sales_price#1811 AS ext_sales_price#35555]\n               +- *(9) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n                  :- *(9) Project [cs_ship_addr_sk#1798, cs_ext_sales_price#1811, cs_sold_date_sk#1822, i_category#1184]\n                  :  +- *(9) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n                  :     :- *(9) Project [cs_ship_addr_sk#1798, cs_item_sk#1803, cs_ext_sales_price#1811, cs_sold_date_sk#1822]\n                  :     :  +- *(9) Filter (isnull(cs_ship_addr_sk#1798) && isnotnull(cs_item_sk#1803))\n                  :     :     +- *(9) FileScan parquet db_tpcds.catalog_sales[cs_ship_addr_sk#1798,cs_item_sk#1803,cs_ext_sales_price#1811,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNull(cs_ship_addr_sk), IsNotNull(cs_item_sk)], ReadSchema: struct<cs_ship_addr_sk:int,cs_item_sk:int,cs_ext_sales_price:decimal(7,2)>\n                  :     +- ReusedExchange [i_item_sk#1172, i_category#1184], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- ReusedExchange [d_date_sk#1040, d_year#1046, d_qoy#1050], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q77-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["ss","sr","cs","cr","ws","wr"],"parsingTime":0.002981,"analysisTime":0.001341,"optimizationTime":1727.673122,"planningTime":112.348052,"executionTime":249115.422647,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ss, sr, cs, cr, ws, wr]\n:  :- 'SubqueryAlias ss\n:  :  +- 'Aggregate ['s_store_sk], ['s_store_sk, 'sum('ss_ext_sales_price) AS sales#35752, 'sum('ss_net_profit) AS profit#35753]\n:  :     +- 'Filter ((('ss_sold_date_sk = 'd_date_sk) && (('d_date >= cast(2000-08-23 as date)) && ('d_date <= (cast(2000-08-23 as date) + interval 4 weeks 2 days)))) && ('ss_store_sk = 's_store_sk))\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'UnresolvedRelation `store_sales`\n:  :           :  +- 'UnresolvedRelation `date_dim`\n:  :           +- 'UnresolvedRelation `store`\n:  :- 'SubqueryAlias sr\n:  :  +- 'Aggregate ['s_store_sk], ['s_store_sk, 'sum('sr_return_amt) AS returns#35754, 'sum('sr_net_loss) AS profit_loss#35755]\n:  :     +- 'Filter ((('sr_returned_date_sk = 'd_date_sk) && (('d_date >= cast(2000-08-23 as date)) && ('d_date <= (cast(2000-08-23 as date) + interval 4 weeks 2 days)))) && ('sr_store_sk = 's_store_sk))\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'UnresolvedRelation `store_returns`\n:  :           :  +- 'UnresolvedRelation `date_dim`\n:  :           +- 'UnresolvedRelation `store`\n:  :- 'SubqueryAlias cs\n:  :  +- 'Aggregate ['cs_call_center_sk], ['cs_call_center_sk, 'sum('cs_ext_sales_price) AS sales#35756, 'sum('cs_net_profit) AS profit#35757]\n:  :     +- 'Filter (('cs_sold_date_sk = 'd_date_sk) && (('d_date >= cast(2000-08-23 as date)) && ('d_date <= (cast(2000-08-23 as date) + interval 4 weeks 2 days))))\n:  :        +- 'Join Inner\n:  :           :- 'UnresolvedRelation `catalog_sales`\n:  :           +- 'UnresolvedRelation `date_dim`\n:  :- 'SubqueryAlias cr\n:  :  +- 'Aggregate ['cr_call_center_sk], ['cr_call_center_sk, 'sum('cr_return_amount) AS returns#35758, 'sum('cr_net_loss) AS profit_loss#35759]\n:  :     +- 'Filter (('cr_returned_date_sk = 'd_date_sk) && (('d_date >= cast(2000-08-23 as date)) && ('d_date <= (cast(2000-08-23 as date) + interval 4 weeks 2 days))))\n:  :        +- 'Join Inner\n:  :           :- 'UnresolvedRelation `catalog_returns`\n:  :           +- 'UnresolvedRelation `date_dim`\n:  :- 'SubqueryAlias ws\n:  :  +- 'Aggregate ['wp_web_page_sk], ['wp_web_page_sk, 'sum('ws_ext_sales_price) AS sales#35760, 'sum('ws_net_profit) AS profit#35761]\n:  :     +- 'Filter ((('ws_sold_date_sk = 'd_date_sk) && (('d_date >= cast(2000-08-23 as date)) && ('d_date <= (cast(2000-08-23 as date) + interval 4 weeks 2 days)))) && ('ws_web_page_sk = 'wp_web_page_sk))\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'UnresolvedRelation `web_sales`\n:  :           :  +- 'UnresolvedRelation `date_dim`\n:  :           +- 'UnresolvedRelation `web_page`\n:  +- 'SubqueryAlias wr\n:     +- 'Aggregate ['wp_web_page_sk], ['wp_web_page_sk, 'sum('wr_return_amt) AS returns#35762, 'sum('wr_net_loss) AS profit_loss#35763]\n:        +- 'Filter ((('wr_returned_date_sk = 'd_date_sk) && (('d_date >= cast(2000-08-23 as date)) && ('d_date <= (cast(2000-08-23 as date) + interval 4 weeks 2 days)))) && ('wr_web_page_sk = 'wp_web_page_sk))\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'UnresolvedRelation `web_returns`\n:              :  +- 'UnresolvedRelation `date_dim`\n:              +- 'UnresolvedRelation `web_page`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['channel ASC NULLS FIRST, 'id ASC NULLS FIRST], true\n         +- 'Aggregate ['rollup('channel, 'id)], ['channel, 'id, 'sum('sales) AS sales#35749, 'sum('returns) AS returns#35750, 'sum('profit) AS profit#35751]\n            +- 'SubqueryAlias x\n               +- 'Union\n                  :- 'Union\n                  :  :- 'Project [store channel AS channel#35738, 'ss.s_store_sk AS id#35739, 'sales, 'coalesce('returns, 0) AS returns#35740, ('profit - 'coalesce('profit_loss, 0)) AS profit#35741]\n                  :  :  +- 'Join LeftOuter, ('ss.s_store_sk = 'sr.s_store_sk)\n                  :  :     :- 'UnresolvedRelation `ss`\n                  :  :     +- 'UnresolvedRelation `sr`\n                  :  +- 'Project [catalog channel AS channel#35742, 'cs_call_center_sk AS id#35743, 'sales, 'returns, ('profit - 'profit_loss) AS profit#35744]\n                  :     +- 'Join Cross\n                  :        :- 'UnresolvedRelation `cs`\n                  :        +- 'UnresolvedRelation `cr`\n                  +- 'Project [web channel AS channel#35745, 'ws.wp_web_page_sk AS id#35746, 'sales, 'coalesce('returns, 0) AS returns#35747, ('profit - 'coalesce('profit_loss, 0)) AS profit#35748]\n                     +- 'Join LeftOuter, ('ws.wp_web_page_sk = 'wr.wp_web_page_sk)\n                        :- 'UnresolvedRelation `ws`\n                        +- 'UnresolvedRelation `wr`\n\n== Analyzed Logical Plan ==\nchannel: string, id: int, sales: decimal(27,2), returns: decimal(27,2), profit: decimal(28,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#35827 ASC NULLS FIRST, id#35828 ASC NULLS FIRST], true\n      +- Aggregate [channel#35827, id#35828, spark_grouping_id#35824], [channel#35827, id#35828, sum(sales#35752) AS sales#35749, sum(returns#35740) AS returns#35750, sum(profit#35819) AS profit#35751]\n         +- Expand [List(channel#35738, id#35739, sales#35752, returns#35740, profit#35819, channel#35825, id#35826, 0), List(channel#35738, id#35739, sales#35752, returns#35740, profit#35819, channel#35825, null, 1), List(channel#35738, id#35739, sales#35752, returns#35740, profit#35819, null, null, 3)], [channel#35738, id#35739, sales#35752, returns#35740, profit#35819, channel#35827, id#35828, spark_grouping_id#35824]\n            +- Project [channel#35738, id#35739, sales#35752, returns#35740, profit#35819, channel#35738 AS channel#35825, id#35739 AS id#35826]\n               +- SubqueryAlias x\n                  +- Union\n                     :- Project [channel#35738, id#35739, sales#35752, returns#35740, profit#35819]\n                     :  +- Union\n                     :     :- Project [channel#35738, id#35739, sales#35752, returns#35740, cast(profit#35741 as decimal(18,2)) AS profit#35819]\n                     :     :  +- Project [store channel AS channel#35738, s_store_sk#1386 AS id#35739, sales#35752, coalesce(cast(returns#35754 as decimal(17,2)), cast(0 as decimal(17,2))) AS returns#35740, CheckOverflow((promote_precision(cast(profit#35753 as decimal(18,2))) - promote_precision(cast(coalesce(cast(profit_loss#35755 as decimal(17,2)), cast(0 as decimal(17,2))) as decimal(18,2)))), DecimalType(18,2)) AS profit#35741]\n                     :     :     +- Join LeftOuter, (s_store_sk#1386 = s_store_sk#35776)\n                     :     :        :- SubqueryAlias ss\n                     :     :        :  +- Aggregate [s_store_sk#1386], [s_store_sk#1386, sum(ss_ext_sales_price#1918) AS sales#35752, sum(ss_net_profit#1925) AS profit#35753]\n                     :     :        :     +- Filter (((ss_sold_date_sk#1926 = d_date_sk#1040) && ((d_date#1042 >= cast(2000-08-23 as date)) && (d_date#1042 <= cast(cast(cast(2000-08-23 as date) as timestamp) + interval 4 weeks 2 days as date)))) && (ss_store_sk#1910 = s_store_sk#1386))\n                     :     :        :        +- Join Inner\n                     :     :        :           :- Join Inner\n                     :     :        :           :  :- SubqueryAlias store_sales\n                     :     :        :           :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :     :        :           :  +- SubqueryAlias date_dim\n                     :     :        :           :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :     :        :           +- SubqueryAlias store\n                     :     :        :              +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                     :     :        +- SubqueryAlias sr\n                     :     :           +- Aggregate [s_store_sk#35776], [s_store_sk#35776, sum(sr_return_amt#1714) AS returns#35754, sum(sr_net_loss#1722) AS profit_loss#35755]\n                     :     :              +- Filter (((sr_returned_date_sk#1723 = d_date_sk#1040) && ((d_date#1042 >= cast(2000-08-23 as date)) && (d_date#1042 <= cast(cast(cast(2000-08-23 as date) as timestamp) + interval 4 weeks 2 days as date)))) && (sr_store_sk#1710 = s_store_sk#35776))\n                     :     :                 +- Join Inner\n                     :     :                    :- Join Inner\n                     :     :                    :  :- SubqueryAlias store_returns\n                     :     :                    :  :  +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                     :     :                    :  +- SubqueryAlias date_dim\n                     :     :                    :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :     :                    +- SubqueryAlias store\n                     :     :                       +- Relation[s_store_sk#35776,s_store_id#35777,s_rec_start_date#35778,s_rec_end_date#35779,s_closed_date_sk#35780,s_store_name#35781,s_number_employees#35782,s_floor_space#35783,s_hours#35784,s_manager#35785,s_market_id#35786,s_geography_class#35787,s_market_desc#35788,s_market_manager#35789,s_division_id#35790,s_division_name#35791,s_company_id#35792,s_company_name#35793,s_street_number#35794,s_street_name#35795,s_street_type#35796,s_suite_number#35797,s_city#35798,s_county#35799,... 5 more fields] parquet\n                     :     +- Project [channel#35742, id#35743, sales#35756, returns#35758, profit#35744]\n                     :        +- Project [catalog channel AS channel#35742, cs_call_center_sk#1799 AS id#35743, sales#35756, returns#35758, CheckOverflow((promote_precision(cast(profit#35757 as decimal(18,2))) - promote_precision(cast(profit_loss#35759 as decimal(18,2)))), DecimalType(18,2)) AS profit#35744]\n                     :           +- Join Cross\n                     :              :- SubqueryAlias cs\n                     :              :  +- Aggregate [cs_call_center_sk#1799], [cs_call_center_sk#1799, sum(cs_ext_sales_price#1811) AS sales#35756, sum(cs_net_profit#1821) AS profit#35757]\n                     :              :     +- Filter ((cs_sold_date_sk#1822 = d_date_sk#1040) && ((d_date#1042 >= cast(2000-08-23 as date)) && (d_date#1042 <= cast(cast(cast(2000-08-23 as date) as timestamp) + interval 4 weeks 2 days as date))))\n                     :              :        +- Join Inner\n                     :              :           :- SubqueryAlias catalog_sales\n                     :              :           :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :              :           +- SubqueryAlias date_dim\n                     :              :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :              +- SubqueryAlias cr\n                     :                 +- Aggregate [cr_call_center_sk#2096], [cr_call_center_sk#2096, sum(cr_return_amount#2103) AS returns#35758, sum(cr_net_loss#2111) AS profit_loss#35759]\n                     :                    +- Filter ((cr_returned_date_sk#2112 = d_date_sk#1040) && ((d_date#1042 >= cast(2000-08-23 as date)) && (d_date#1042 <= cast(cast(cast(2000-08-23 as date) as timestamp) + interval 4 weeks 2 days as date))))\n                     :                       +- Join Inner\n                     :                          :- SubqueryAlias catalog_returns\n                     :                          :  +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n                     :                          +- SubqueryAlias date_dim\n                     :                             +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     +- Project [channel#35745, id#35746, sales#35760, returns#35747, cast(profit#35748 as decimal(18,2)) AS profit#35820]\n                        +- Project [web channel AS channel#35745, wp_web_page_sk#1568 AS id#35746, sales#35760, coalesce(cast(returns#35762 as decimal(17,2)), cast(0 as decimal(17,2))) AS returns#35747, CheckOverflow((promote_precision(cast(profit#35761 as decimal(18,2))) - promote_precision(cast(coalesce(cast(profit_loss#35763 as decimal(17,2)), cast(0 as decimal(17,2))) as decimal(18,2)))), DecimalType(18,2)) AS profit#35748]\n                           +- Join LeftOuter, (wp_web_page_sk#1568 = wp_web_page_sk#35805)\n                              :- SubqueryAlias ws\n                              :  +- Aggregate [wp_web_page_sk#1568], [wp_web_page_sk#1568, sum(ws_ext_sales_price#1777) AS sales#35760, sum(ws_net_profit#1787) AS profit#35761]\n                              :     +- Filter (((ws_sold_date_sk#1788 = d_date_sk#1040) && ((d_date#1042 >= cast(2000-08-23 as date)) && (d_date#1042 <= cast(cast(cast(2000-08-23 as date) as timestamp) + interval 4 weeks 2 days as date)))) && (ws_web_page_sk#1766 = wp_web_page_sk#1568))\n                              :        +- Join Inner\n                              :           :- Join Inner\n                              :           :  :- SubqueryAlias web_sales\n                              :           :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                              :           :  +- SubqueryAlias date_dim\n                              :           :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              :           +- SubqueryAlias web_page\n                              :              +- Relation[wp_web_page_sk#1568,wp_web_page_id#1569,wp_rec_start_date#1570,wp_rec_end_date#1571,wp_creation_date_sk#1572,wp_access_date_sk#1573,wp_autogen_flag#1574,wp_customer_sk#1575,wp_url#1576,wp_type#1577,wp_char_count#1578,wp_link_count#1579,wp_image_count#1580,wp_max_ad_count#1581] parquet\n                              +- SubqueryAlias wr\n                                 +- Aggregate [wp_web_page_sk#35805], [wp_web_page_sk#35805, sum(wr_return_amt#2131) AS returns#35762, sum(wr_net_loss#2139) AS profit_loss#35763]\n                                    +- Filter (((wr_returned_date_sk#2140 = d_date_sk#1040) && ((d_date#1042 >= cast(2000-08-23 as date)) && (d_date#1042 <= cast(cast(cast(2000-08-23 as date) as timestamp) + interval 4 weeks 2 days as date)))) && (wr_web_page_sk#2127 = wp_web_page_sk#35805))\n                                       +- Join Inner\n                                          :- Join Inner\n                                          :  :- SubqueryAlias web_returns\n                                          :  :  +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n                                          :  +- SubqueryAlias date_dim\n                                          :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                          +- SubqueryAlias web_page\n                                             +- Relation[wp_web_page_sk#35805,wp_web_page_id#35806,wp_rec_start_date#35807,wp_rec_end_date#35808,wp_creation_date_sk#35809,wp_access_date_sk#35810,wp_autogen_flag#35811,wp_customer_sk#35812,wp_url#35813,wp_type#35814,wp_char_count#35815,wp_link_count#35816,wp_image_count#35817,wp_max_ad_count#35818] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#35827 ASC NULLS FIRST, id#35828 ASC NULLS FIRST], true\n      +- Aggregate [channel#35827, id#35828, spark_grouping_id#35824], [channel#35827, id#35828, sum(sales#35752) AS sales#35749, sum(returns#35740) AS returns#35750, sum(profit#35819) AS profit#35751]\n         +- Expand [List(sales#35752, returns#35740, profit#35819, channel#35738, id#35739, 0), List(sales#35752, returns#35740, profit#35819, channel#35738, null, 1), List(sales#35752, returns#35740, profit#35819, null, null, 3)], [sales#35752, returns#35740, profit#35819, channel#35827, id#35828, spark_grouping_id#35824]\n            +- Union\n               :- Project [sales#35752, coalesce(returns#35754, 0.00) AS returns#35740, CheckOverflow((promote_precision(cast(profit#35753 as decimal(18,2))) - promote_precision(cast(coalesce(profit_loss#35755, 0.00) as decimal(18,2)))), DecimalType(18,2)) AS profit#35819, store channel AS channel#35738, s_store_sk#1386 AS id#35739]\n               :  +- Join LeftOuter, (s_store_sk#1386 = s_store_sk#35776)\n               :     :- Aggregate [s_store_sk#1386], [s_store_sk#1386, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS sales#35752, MakeDecimal(sum(UnscaledValue(ss_net_profit#1925)),17,2) AS profit#35753]\n               :     :  +- Project [ss_ext_sales_price#1918, ss_net_profit#1925, s_store_sk#1386]\n               :     :     +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n               :     :        :- Project [ss_store_sk#1910, ss_ext_sales_price#1918, ss_net_profit#1925]\n               :     :        :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :     :        :     :- Project [ss_store_sk#1910, ss_ext_sales_price#1918, ss_net_profit#1925, ss_sold_date_sk#1926]\n               :     :        :     :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910))\n               :     :        :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :        :     +- Project [d_date_sk#1040]\n               :     :        :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11222)) && isnotnull(d_date_sk#1040))\n               :     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     :        +- Project [s_store_sk#1386]\n               :     :           +- Filter isnotnull(s_store_sk#1386)\n               :     :              +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               :     +- Aggregate [s_store_sk#35776], [s_store_sk#35776, MakeDecimal(sum(UnscaledValue(sr_return_amt#1714)),17,2) AS returns#35754, MakeDecimal(sum(UnscaledValue(sr_net_loss#1722)),17,2) AS profit_loss#35755]\n               :        +- Project [sr_return_amt#1714, sr_net_loss#1722, s_store_sk#35776]\n               :           +- Join Inner, (sr_store_sk#1710 = s_store_sk#35776)\n               :              :- Project [sr_store_sk#1710, sr_return_amt#1714, sr_net_loss#1722]\n               :              :  +- Join Inner, (sr_returned_date_sk#1723 = d_date_sk#1040)\n               :              :     :- Project [sr_store_sk#1710, sr_return_amt#1714, sr_net_loss#1722, sr_returned_date_sk#1723]\n               :              :     :  +- Filter (isnotnull(sr_returned_date_sk#1723) && isnotnull(sr_store_sk#1710))\n               :              :     :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :              :     +- Project [d_date_sk#1040]\n               :              :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11222)) && isnotnull(d_date_sk#1040))\n               :              :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :              +- Project [s_store_sk#35776]\n               :                 +- Filter isnotnull(s_store_sk#35776)\n               :                    +- Relation[s_store_sk#35776,s_store_id#35777,s_rec_start_date#35778,s_rec_end_date#35779,s_closed_date_sk#35780,s_store_name#35781,s_number_employees#35782,s_floor_space#35783,s_hours#35784,s_manager#35785,s_market_id#35786,s_geography_class#35787,s_market_desc#35788,s_market_manager#35789,s_division_id#35790,s_division_name#35791,s_company_id#35792,s_company_name#35793,s_street_number#35794,s_street_name#35795,s_street_type#35796,s_suite_number#35797,s_city#35798,s_county#35799,... 5 more fields] parquet\n               :- Project [sales#35756, returns#35758, CheckOverflow((promote_precision(cast(profit#35757 as decimal(18,2))) - promote_precision(cast(profit_loss#35759 as decimal(18,2)))), DecimalType(18,2)) AS profit#35744, catalog channel AS channel#35742, cs_call_center_sk#1799 AS id#35743]\n               :  +- Join Cross\n               :     :- Aggregate [cs_call_center_sk#1799], [cs_call_center_sk#1799, MakeDecimal(sum(UnscaledValue(cs_ext_sales_price#1811)),17,2) AS sales#35756, MakeDecimal(sum(UnscaledValue(cs_net_profit#1821)),17,2) AS profit#35757]\n               :     :  +- Project [cs_call_center_sk#1799, cs_ext_sales_price#1811, cs_net_profit#1821]\n               :     :     +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :     :        :- Project [cs_call_center_sk#1799, cs_ext_sales_price#1811, cs_net_profit#1821, cs_sold_date_sk#1822]\n               :     :        :  +- Filter isnotnull(cs_sold_date_sk#1822)\n               :     :        :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :        +- Project [d_date_sk#1040]\n               :     :           +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11222)) && isnotnull(d_date_sk#1040))\n               :     :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Aggregate [cr_call_center_sk#2096], [MakeDecimal(sum(UnscaledValue(cr_return_amount#2103)),17,2) AS returns#35758, MakeDecimal(sum(UnscaledValue(cr_net_loss#2111)),17,2) AS profit_loss#35759]\n               :        +- Project [cr_call_center_sk#2096, cr_return_amount#2103, cr_net_loss#2111]\n               :           +- Join Inner, (cr_returned_date_sk#2112 = d_date_sk#1040)\n               :              :- Project [cr_call_center_sk#2096, cr_return_amount#2103, cr_net_loss#2111, cr_returned_date_sk#2112]\n               :              :  +- Filter isnotnull(cr_returned_date_sk#2112)\n               :              :     +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n               :              +- Project [d_date_sk#1040]\n               :                 +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11222)) && isnotnull(d_date_sk#1040))\n               :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- Project [sales#35760, coalesce(returns#35762, 0.00) AS returns#35747, CheckOverflow((promote_precision(cast(profit#35761 as decimal(18,2))) - promote_precision(cast(coalesce(profit_loss#35763, 0.00) as decimal(18,2)))), DecimalType(18,2)) AS profit#35820, web channel AS channel#35825, wp_web_page_sk#1568 AS id#35826]\n                  +- Join LeftOuter, (wp_web_page_sk#1568 = wp_web_page_sk#35805)\n                     :- Aggregate [wp_web_page_sk#1568], [wp_web_page_sk#1568, MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#1777)),17,2) AS sales#35760, MakeDecimal(sum(UnscaledValue(ws_net_profit#1787)),17,2) AS profit#35761]\n                     :  +- Project [ws_ext_sales_price#1777, ws_net_profit#1787, wp_web_page_sk#1568]\n                     :     +- Join Inner, (ws_web_page_sk#1766 = wp_web_page_sk#1568)\n                     :        :- Project [ws_web_page_sk#1766, ws_ext_sales_price#1777, ws_net_profit#1787]\n                     :        :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                     :        :     :- Project [ws_web_page_sk#1766, ws_ext_sales_price#1777, ws_net_profit#1787, ws_sold_date_sk#1788]\n                     :        :     :  +- Filter (isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_web_page_sk#1766))\n                     :        :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :        :     +- Project [d_date_sk#1040]\n                     :        :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11222)) && isnotnull(d_date_sk#1040))\n                     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :        +- Project [wp_web_page_sk#1568]\n                     :           +- Filter isnotnull(wp_web_page_sk#1568)\n                     :              +- Relation[wp_web_page_sk#1568,wp_web_page_id#1569,wp_rec_start_date#1570,wp_rec_end_date#1571,wp_creation_date_sk#1572,wp_access_date_sk#1573,wp_autogen_flag#1574,wp_customer_sk#1575,wp_url#1576,wp_type#1577,wp_char_count#1578,wp_link_count#1579,wp_image_count#1580,wp_max_ad_count#1581] parquet\n                     +- Aggregate [wp_web_page_sk#35805], [wp_web_page_sk#35805, MakeDecimal(sum(UnscaledValue(wr_return_amt#2131)),17,2) AS returns#35762, MakeDecimal(sum(UnscaledValue(wr_net_loss#2139)),17,2) AS profit_loss#35763]\n                        +- Project [wr_return_amt#2131, wr_net_loss#2139, wp_web_page_sk#35805]\n                           +- Join Inner, (wr_web_page_sk#2127 = wp_web_page_sk#35805)\n                              :- Project [wr_web_page_sk#2127, wr_return_amt#2131, wr_net_loss#2139]\n                              :  +- Join Inner, (wr_returned_date_sk#2140 = d_date_sk#1040)\n                              :     :- Project [wr_web_page_sk#2127, wr_return_amt#2131, wr_net_loss#2139, wr_returned_date_sk#2140]\n                              :     :  +- Filter (isnotnull(wr_returned_date_sk#2140) && isnotnull(wr_web_page_sk#2127))\n                              :     :     +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n                              :     +- Project [d_date_sk#1040]\n                              :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11222)) && isnotnull(d_date_sk#1040))\n                              :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              +- Project [wp_web_page_sk#35805]\n                                 +- Filter isnotnull(wp_web_page_sk#35805)\n                                    +- Relation[wp_web_page_sk#35805,wp_web_page_id#35806,wp_rec_start_date#35807,wp_rec_end_date#35808,wp_creation_date_sk#35809,wp_access_date_sk#35810,wp_autogen_flag#35811,wp_customer_sk#35812,wp_url#35813,wp_type#35814,wp_char_count#35815,wp_link_count#35816,wp_image_count#35817,wp_max_ad_count#35818] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[channel#35827 ASC NULLS FIRST,id#35828 ASC NULLS FIRST], output=[channel#35827,id#35828,sales#35749,returns#35750,profit#35751])\n+- *(27) HashAggregate(keys=[channel#35827, id#35828, spark_grouping_id#35824], functions=[sum(sales#35752), sum(returns#35740), sum(profit#35819)], output=[channel#35827, id#35828, sales#35749, returns#35750, profit#35751])\n   +- Exchange hashpartitioning(channel#35827, id#35828, spark_grouping_id#35824, 200)\n      +- *(26) HashAggregate(keys=[channel#35827, id#35828, spark_grouping_id#35824], functions=[partial_sum(sales#35752), partial_sum(returns#35740), partial_sum(profit#35819)], output=[channel#35827, id#35828, spark_grouping_id#35824, sum#35839, sum#35840, sum#35841])\n         +- *(26) Expand [List(sales#35752, returns#35740, profit#35819, channel#35738, id#35739, 0), List(sales#35752, returns#35740, profit#35819, channel#35738, null, 1), List(sales#35752, returns#35740, profit#35819, null, null, 3)], [sales#35752, returns#35740, profit#35819, channel#35827, id#35828, spark_grouping_id#35824]\n            +- Union\n               :- *(9) Project [sales#35752, coalesce(returns#35754, 0.00) AS returns#35740, CheckOverflow((promote_precision(cast(profit#35753 as decimal(18,2))) - promote_precision(cast(coalesce(profit_loss#35755, 0.00) as decimal(18,2)))), DecimalType(18,2)) AS profit#35819, store channel AS channel#35738, s_store_sk#1386 AS id#35739]\n               :  +- SortMergeJoin [s_store_sk#1386], [s_store_sk#35776], LeftOuter\n               :     :- *(4) Sort [s_store_sk#1386 ASC NULLS FIRST], false, 0\n               :     :  +- *(4) HashAggregate(keys=[s_store_sk#1386], functions=[sum(UnscaledValue(ss_ext_sales_price#1918)), sum(UnscaledValue(ss_net_profit#1925))], output=[s_store_sk#1386, sales#35752, profit#35753])\n               :     :     +- Exchange hashpartitioning(s_store_sk#1386, 200)\n               :     :        +- *(3) HashAggregate(keys=[s_store_sk#1386], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918)), partial_sum(UnscaledValue(ss_net_profit#1925))], output=[s_store_sk#1386, sum#35844L, sum#35845L])\n               :     :           +- *(3) Project [ss_ext_sales_price#1918, ss_net_profit#1925, s_store_sk#1386]\n               :     :              +- *(3) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n               :     :                 :- *(3) Project [ss_store_sk#1910, ss_ext_sales_price#1918, ss_net_profit#1925]\n               :     :                 :  +- *(3) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :     :                 :     :- *(3) Project [ss_store_sk#1910, ss_ext_sales_price#1918, ss_net_profit#1925, ss_sold_date_sk#1926]\n               :     :                 :     :  +- *(3) Filter isnotnull(ss_store_sk#1910)\n               :     :                 :     :     +- *(3) FileScan parquet db_tpcds.store_sales[ss_store_sk#1910,ss_ext_sales_price#1918,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk)], ReadSchema: struct<ss_store_sk:int,ss_ext_sales_price:decimal(7,2),ss_net_profit:decimal(7,2)>\n               :     :                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :                 :        +- *(1) Project [d_date_sk#1040]\n               :     :                 :           +- *(1) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11222)) && isnotnull(d_date_sk#1040))\n               :     :                 :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2000-08-23), LessThanOrEqual(d_date,2000-09-22), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>\n               :     :                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :                    +- *(2) Project [s_store_sk#1386]\n               :     :                       +- *(2) Filter isnotnull(s_store_sk#1386)\n               :     :                          +- *(2) FileScan parquet db_tpcds.store[s_store_sk#1386] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int>\n               :     +- *(8) Sort [s_store_sk#35776 ASC NULLS FIRST], false, 0\n               :        +- *(8) HashAggregate(keys=[s_store_sk#35776], functions=[sum(UnscaledValue(sr_return_amt#1714)), sum(UnscaledValue(sr_net_loss#1722))], output=[s_store_sk#35776, returns#35754, profit_loss#35755])\n               :           +- Exchange hashpartitioning(s_store_sk#35776, 200)\n               :              +- *(7) HashAggregate(keys=[s_store_sk#35776], functions=[partial_sum(UnscaledValue(sr_return_amt#1714)), partial_sum(UnscaledValue(sr_net_loss#1722))], output=[s_store_sk#35776, sum#35848L, sum#35849L])\n               :                 +- *(7) Project [sr_return_amt#1714, sr_net_loss#1722, s_store_sk#35776]\n               :                    +- *(7) BroadcastHashJoin [sr_store_sk#1710], [s_store_sk#35776], Inner, BuildRight\n               :                       :- *(7) Project [sr_store_sk#1710, sr_return_amt#1714, sr_net_loss#1722]\n               :                       :  +- *(7) BroadcastHashJoin [sr_returned_date_sk#1723], [d_date_sk#1040], Inner, BuildRight\n               :                       :     :- *(7) Project [sr_store_sk#1710, sr_return_amt#1714, sr_net_loss#1722, sr_returned_date_sk#1723]\n               :                       :     :  +- *(7) Filter isnotnull(sr_store_sk#1710)\n               :                       :     :     +- *(7) FileScan parquet db_tpcds.store_returns[sr_store_sk#1710,sr_return_amt#1714,sr_net_loss#1722,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns/sr_..., PartitionCount: 2001, PartitionFilters: [isnotnull(sr_returned_date_sk#1723)], PushedFilters: [IsNotNull(sr_store_sk)], ReadSchema: struct<sr_store_sk:int,sr_return_amt:decimal(7,2),sr_net_loss:decimal(7,2)>\n               :                       :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                       +- ReusedExchange [s_store_sk#35776], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :- *(16) Project [sales#35756, returns#35758, CheckOverflow((promote_precision(cast(profit#35757 as decimal(18,2))) - promote_precision(cast(profit_loss#35759 as decimal(18,2)))), DecimalType(18,2)) AS profit#35744, catalog channel AS channel#35742, cs_call_center_sk#1799 AS id#35743]\n               :  +- CartesianProduct\n               :     :- *(12) HashAggregate(keys=[cs_call_center_sk#1799], functions=[sum(UnscaledValue(cs_ext_sales_price#1811)), sum(UnscaledValue(cs_net_profit#1821))], output=[cs_call_center_sk#1799, sales#35756, profit#35757])\n               :     :  +- Exchange hashpartitioning(cs_call_center_sk#1799, 200)\n               :     :     +- *(11) HashAggregate(keys=[cs_call_center_sk#1799], functions=[partial_sum(UnscaledValue(cs_ext_sales_price#1811)), partial_sum(UnscaledValue(cs_net_profit#1821))], output=[cs_call_center_sk#1799, sum#35852L, sum#35853L])\n               :     :        +- *(11) Project [cs_call_center_sk#1799, cs_ext_sales_price#1811, cs_net_profit#1821]\n               :     :           +- *(11) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :     :              :- *(11) FileScan parquet db_tpcds.catalog_sales[cs_call_center_sk#1799,cs_ext_sales_price#1811,cs_net_profit#1821,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_call_center_sk:int,cs_ext_sales_price:decimal(7,2),cs_net_profit:decimal(7,2)>\n               :     :              +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     +- *(15) HashAggregate(keys=[cr_call_center_sk#2096], functions=[sum(UnscaledValue(cr_return_amount#2103)), sum(UnscaledValue(cr_net_loss#2111))], output=[returns#35758, profit_loss#35759])\n               :        +- Exchange hashpartitioning(cr_call_center_sk#2096, 200)\n               :           +- *(14) HashAggregate(keys=[cr_call_center_sk#2096], functions=[partial_sum(UnscaledValue(cr_return_amount#2103)), partial_sum(UnscaledValue(cr_net_loss#2111))], output=[cr_call_center_sk#2096, sum#35856L, sum#35857L])\n               :              +- *(14) Project [cr_call_center_sk#2096, cr_return_amount#2103, cr_net_loss#2111]\n               :                 +- *(14) BroadcastHashJoin [cr_returned_date_sk#2112], [d_date_sk#1040], Inner, BuildRight\n               :                    :- *(14) FileScan parquet db_tpcds.catalog_returns[cr_call_center_sk#2096,cr_return_amount#2103,cr_net_loss#2111,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns/c..., PartitionCount: 2066, PartitionFilters: [isnotnull(cr_returned_date_sk#2112)], PushedFilters: [], ReadSchema: struct<cr_call_center_sk:int,cr_return_amount:decimal(7,2),cr_net_loss:decimal(7,2)>\n               :                    +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               +- *(25) Project [sales#35760, coalesce(returns#35762, 0.00) AS returns#35747, CheckOverflow((promote_precision(cast(profit#35761 as decimal(18,2))) - promote_precision(cast(coalesce(profit_loss#35763, 0.00) as decimal(18,2)))), DecimalType(18,2)) AS profit#35820, web channel AS channel#35825, wp_web_page_sk#1568 AS id#35826]\n                  +- SortMergeJoin [wp_web_page_sk#1568], [wp_web_page_sk#35805], LeftOuter\n                     :- *(20) Sort [wp_web_page_sk#1568 ASC NULLS FIRST], false, 0\n                     :  +- *(20) HashAggregate(keys=[wp_web_page_sk#1568], functions=[sum(UnscaledValue(ws_ext_sales_price#1777)), sum(UnscaledValue(ws_net_profit#1787))], output=[wp_web_page_sk#1568, sales#35760, profit#35761])\n                     :     +- Exchange hashpartitioning(wp_web_page_sk#1568, 200)\n                     :        +- *(19) HashAggregate(keys=[wp_web_page_sk#1568], functions=[partial_sum(UnscaledValue(ws_ext_sales_price#1777)), partial_sum(UnscaledValue(ws_net_profit#1787))], output=[wp_web_page_sk#1568, sum#35860L, sum#35861L])\n                     :           +- *(19) Project [ws_ext_sales_price#1777, ws_net_profit#1787, wp_web_page_sk#1568]\n                     :              +- *(19) BroadcastHashJoin [ws_web_page_sk#1766], [wp_web_page_sk#1568], Inner, BuildRight\n                     :                 :- *(19) Project [ws_web_page_sk#1766, ws_ext_sales_price#1777, ws_net_profit#1787]\n                     :                 :  +- *(19) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                     :                 :     :- *(19) Project [ws_web_page_sk#1766, ws_ext_sales_price#1777, ws_net_profit#1787, ws_sold_date_sk#1788]\n                     :                 :     :  +- *(19) Filter isnotnull(ws_web_page_sk#1766)\n                     :                 :     :     +- *(19) FileScan parquet db_tpcds.web_sales[ws_web_page_sk#1766,ws_ext_sales_price#1777,ws_net_profit#1787,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_web_page_sk)], ReadSchema: struct<ws_web_page_sk:int,ws_ext_sales_price:decimal(7,2),ws_net_profit:decimal(7,2)>\n                     :                 :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :                    +- *(18) Project [wp_web_page_sk#1568]\n                     :                       +- *(18) Filter isnotnull(wp_web_page_sk#1568)\n                     :                          +- *(18) FileScan parquet db_tpcds.web_page[wp_web_page_sk#1568] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_page], PartitionFilters: [], PushedFilters: [IsNotNull(wp_web_page_sk)], ReadSchema: struct<wp_web_page_sk:int>\n                     +- *(24) Sort [wp_web_page_sk#35805 ASC NULLS FIRST], false, 0\n                        +- *(24) HashAggregate(keys=[wp_web_page_sk#35805], functions=[sum(UnscaledValue(wr_return_amt#2131)), sum(UnscaledValue(wr_net_loss#2139))], output=[wp_web_page_sk#35805, returns#35762, profit_loss#35763])\n                           +- Exchange hashpartitioning(wp_web_page_sk#35805, 200)\n                              +- *(23) HashAggregate(keys=[wp_web_page_sk#35805], functions=[partial_sum(UnscaledValue(wr_return_amt#2131)), partial_sum(UnscaledValue(wr_net_loss#2139))], output=[wp_web_page_sk#35805, sum#35864L, sum#35865L])\n                                 +- *(23) Project [wr_return_amt#2131, wr_net_loss#2139, wp_web_page_sk#35805]\n                                    +- *(23) BroadcastHashJoin [wr_web_page_sk#2127], [wp_web_page_sk#35805], Inner, BuildRight\n                                       :- *(23) Project [wr_web_page_sk#2127, wr_return_amt#2131, wr_net_loss#2139]\n                                       :  +- *(23) BroadcastHashJoin [wr_returned_date_sk#2140], [d_date_sk#1040], Inner, BuildRight\n                                       :     :- *(23) Project [wr_web_page_sk#2127, wr_return_amt#2131, wr_net_loss#2139, wr_returned_date_sk#2140]\n                                       :     :  +- *(23) Filter isnotnull(wr_web_page_sk#2127)\n                                       :     :     +- *(23) FileScan parquet db_tpcds.web_returns[wr_web_page_sk#2127,wr_return_amt#2131,wr_net_loss#2139,wr_returned_date_sk#2140] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_returns/wr_re..., PartitionCount: 2109, PartitionFilters: [isnotnull(wr_returned_date_sk#2140)], PushedFilters: [IsNotNull(wr_web_page_sk)], ReadSchema: struct<wr_web_page_sk:int,wr_return_amt:decimal(7,2),wr_net_loss:decimal(7,2)>\n                                       :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                       +- ReusedExchange [wp_web_page_sk#35805], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q78-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","SortMergeJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","SortMergeJoin"],"tables":["ss","ws","cs"],"parsingTime":0.002988,"analysisTime":0.001093,"optimizationTime":736.95639,"planningTime":796.916108,"executionTime":33209.790822,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ws, cs, ss]\n:  :- 'SubqueryAlias ws\n:  :  +- 'Aggregate ['d_year, 'ws_item_sk, 'ws_bill_customer_sk], ['d_year AS ws_sold_year#36038, 'ws_item_sk, 'ws_bill_customer_sk AS ws_customer_sk#36039, 'sum('ws_quantity) AS ws_qty#36040, 'sum('ws_wholesale_cost) AS ws_wc#36041, 'sum('ws_sales_price) AS ws_sp#36042]\n:  :     +- 'Filter isnull('wr_order_number)\n:  :        +- 'Join Inner, ('ws_sold_date_sk = 'd_date_sk)\n:  :           :- 'Join LeftOuter, (('wr_order_number = 'ws_order_number) && ('ws_item_sk = 'wr_item_sk))\n:  :           :  :- 'UnresolvedRelation `web_sales`\n:  :           :  +- 'UnresolvedRelation `web_returns`\n:  :           +- 'UnresolvedRelation `date_dim`\n:  :- 'SubqueryAlias cs\n:  :  +- 'Aggregate ['d_year, 'cs_item_sk, 'cs_bill_customer_sk], ['d_year AS cs_sold_year#36043, 'cs_item_sk, 'cs_bill_customer_sk AS cs_customer_sk#36044, 'sum('cs_quantity) AS cs_qty#36045, 'sum('cs_wholesale_cost) AS cs_wc#36046, 'sum('cs_sales_price) AS cs_sp#36047]\n:  :     +- 'Filter isnull('cr_order_number)\n:  :        +- 'Join Inner, ('cs_sold_date_sk = 'd_date_sk)\n:  :           :- 'Join LeftOuter, (('cr_order_number = 'cs_order_number) && ('cs_item_sk = 'cr_item_sk))\n:  :           :  :- 'UnresolvedRelation `catalog_sales`\n:  :           :  +- 'UnresolvedRelation `catalog_returns`\n:  :           +- 'UnresolvedRelation `date_dim`\n:  +- 'SubqueryAlias ss\n:     +- 'Aggregate ['d_year, 'ss_item_sk, 'ss_customer_sk], ['d_year AS ss_sold_year#36048, 'ss_item_sk, 'ss_customer_sk, 'sum('ss_quantity) AS ss_qty#36049, 'sum('ss_wholesale_cost) AS ss_wc#36050, 'sum('ss_sales_price) AS ss_sp#36051]\n:        +- 'Filter isnull('sr_ticket_number)\n:           +- 'Join Inner, ('ss_sold_date_sk = 'd_date_sk)\n:              :- 'Join LeftOuter, (('sr_ticket_number = 'ss_ticket_number) && ('ss_item_sk = 'sr_item_sk))\n:              :  :- 'UnresolvedRelation `store_sales`\n:              :  +- 'UnresolvedRelation `store_returns`\n:              +- 'UnresolvedRelation `date_dim`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['ss_sold_year ASC NULLS FIRST, 'ss_item_sk ASC NULLS FIRST, 'ss_customer_sk ASC NULLS FIRST, 'ss_qty DESC NULLS LAST, 'ss_wc DESC NULLS LAST, 'ss_sp DESC NULLS LAST, 'other_chan_qty ASC NULLS FIRST, 'other_chan_wholesale_cost ASC NULLS FIRST, 'other_chan_sales_price ASC NULLS FIRST, 'round(('ss_qty / 'coalesce(('ws_qty + 'cs_qty), 1)), 2) ASC NULLS FIRST], true\n         +- 'Project ['ss_sold_year, 'ss_item_sk, 'ss_customer_sk, 'round(('ss_qty / ('coalesce('ws_qty, 0) + 'coalesce('cs_qty, 0))), 2) AS ratio#36031, 'ss_qty AS store_qty#36032, 'ss_wc AS store_wholesale_cost#36033, 'ss_sp AS store_sales_price#36034, ('coalesce('ws_qty, 0) + 'coalesce('cs_qty, 0)) AS other_chan_qty#36035, ('coalesce('ws_wc, 0) + 'coalesce('cs_wc, 0)) AS other_chan_wholesale_cost#36036, ('coalesce('ws_sp, 0) + 'coalesce('cs_sp, 0)) AS other_chan_sales_price#36037]\n            +- 'Filter ((('coalesce('ws_qty, 0) > 0) || ('coalesce('cs_qty, 0) > 0)) && ('ss_sold_year = 2000))\n               +- 'Join LeftOuter, ((('cs_sold_year = 'ss_sold_year) && ('cs_item_sk = 'ss_item_sk)) && ('cs_customer_sk = 'ss_customer_sk))\n                  :- 'Join LeftOuter, ((('ws_sold_year = 'ss_sold_year) && ('ws_item_sk = 'ss_item_sk)) && ('ws_customer_sk = 'ss_customer_sk))\n                  :  :- 'UnresolvedRelation `ss`\n                  :  +- 'UnresolvedRelation `ws`\n                  +- 'UnresolvedRelation `cs`\n\n== Analyzed Logical Plan ==\nss_sold_year: int, ss_item_sk: int, ss_customer_sk: int, ratio: double, store_qty: bigint, store_wholesale_cost: decimal(17,2), store_sales_price: decimal(17,2), other_chan_qty: bigint, other_chan_wholesale_cost: decimal(18,2), other_chan_sales_price: decimal(18,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906, ratio#36031, store_qty#36032L, store_wholesale_cost#36033, store_sales_price#36034, other_chan_qty#36035L, other_chan_wholesale_cost#36036, other_chan_sales_price#36037]\n      +- Sort [ss_sold_year#36048 ASC NULLS FIRST, ss_item_sk#1905 ASC NULLS FIRST, ss_customer_sk#1906 ASC NULLS FIRST, ss_qty#36049L DESC NULLS LAST, ss_wc#36050 DESC NULLS LAST, ss_sp#36051 DESC NULLS LAST, other_chan_qty#36035L ASC NULLS FIRST, other_chan_wholesale_cost#36036 ASC NULLS FIRST, other_chan_sales_price#36037 ASC NULLS FIRST, round((cast(ss_qty#36049L as double) / cast(coalesce(cast((ws_qty#36040L + cs_qty#36045L) as bigint), cast(1 as bigint)) as double)), 2) ASC NULLS FIRST], true\n         +- Project [ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906, round((cast(ss_qty#36049L as double) / cast((coalesce(cast(ws_qty#36040L as bigint), cast(0 as bigint)) + coalesce(cast(cs_qty#36045L as bigint), cast(0 as bigint))) as double)), 2) AS ratio#36031, ss_qty#36049L AS store_qty#36032L, ss_wc#36050 AS store_wholesale_cost#36033, ss_sp#36051 AS store_sales_price#36034, (coalesce(cast(ws_qty#36040L as bigint), cast(0 as bigint)) + coalesce(cast(cs_qty#36045L as bigint), cast(0 as bigint))) AS other_chan_qty#36035L, CheckOverflow((promote_precision(cast(coalesce(cast(ws_wc#36041 as decimal(17,2)), cast(0 as decimal(17,2))) as decimal(18,2))) + promote_precision(cast(coalesce(cast(cs_wc#36046 as decimal(17,2)), cast(0 as decimal(17,2))) as decimal(18,2)))), DecimalType(18,2)) AS other_chan_wholesale_cost#36036, CheckOverflow((promote_precision(cast(coalesce(cast(ws_sp#36042 as decimal(17,2)), cast(0 as decimal(17,2))) as decimal(18,2))) + promote_precision(cast(coalesce(cast(cs_sp#36047 as decimal(17,2)), cast(0 as decimal(17,2))) as decimal(18,2)))), DecimalType(18,2)) AS other_chan_sales_price#36037, ss_sp#36051, ss_qty#36049L, cs_qty#36045L, ws_qty#36040L, ss_wc#36050]\n            +- Filter (((coalesce(cast(ws_qty#36040L as bigint), cast(0 as bigint)) > cast(0 as bigint)) || (coalesce(cast(cs_qty#36045L as bigint), cast(0 as bigint)) > cast(0 as bigint))) && (ss_sold_year#36048 = 2000))\n               +- Join LeftOuter, (((cs_sold_year#36043 = ss_sold_year#36048) && (cs_item_sk#1803 = ss_item_sk#1905)) && (cs_customer_sk#36044 = ss_customer_sk#1906))\n                  :- Join LeftOuter, (((ws_sold_year#36038 = ss_sold_year#36048) && (ws_item_sk#1757 = ss_item_sk#1905)) && (ws_customer_sk#36039 = ss_customer_sk#1906))\n                  :  :- SubqueryAlias ss\n                  :  :  +- Aggregate [d_year#1046, ss_item_sk#1905, ss_customer_sk#1906], [d_year#1046 AS ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906, sum(cast(ss_quantity#1913 as bigint)) AS ss_qty#36049L, sum(ss_wholesale_cost#1914) AS ss_wc#36050, sum(ss_sales_price#1916) AS ss_sp#36051]\n                  :  :     +- Filter isnull(sr_ticket_number#1712L)\n                  :  :        +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                  :  :           :- Join LeftOuter, ((sr_ticket_number#1712L = ss_ticket_number#1912L) && (ss_item_sk#1905 = sr_item_sk#1705))\n                  :  :           :  :- SubqueryAlias store_sales\n                  :  :           :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :  :           :  +- SubqueryAlias store_returns\n                  :  :           :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                  :  :           +- SubqueryAlias date_dim\n                  :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :  +- SubqueryAlias ws\n                  :     +- Aggregate [d_year#1046, ws_item_sk#1757, ws_bill_customer_sk#1758], [d_year#1046 AS ws_sold_year#36038, ws_item_sk#1757, ws_bill_customer_sk#1758 AS ws_customer_sk#36039, sum(cast(ws_quantity#1772 as bigint)) AS ws_qty#36040L, sum(ws_wholesale_cost#1773) AS ws_wc#36041, sum(ws_sales_price#1775) AS ws_sp#36042]\n                  :        +- Filter isnull(wr_order_number#2129L)\n                  :           +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                  :              :- Join LeftOuter, ((wr_order_number#2129L = ws_order_number#1771L) && (ws_item_sk#1757 = wr_item_sk#2118))\n                  :              :  :- SubqueryAlias web_sales\n                  :              :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :              :  +- SubqueryAlias web_returns\n                  :              :     +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n                  :              +- SubqueryAlias date_dim\n                  :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  +- SubqueryAlias cs\n                     +- Aggregate [d_year#1046, cs_item_sk#1803, cs_bill_customer_sk#1791], [d_year#1046 AS cs_sold_year#36043, cs_item_sk#1803, cs_bill_customer_sk#1791 AS cs_customer_sk#36044, sum(cast(cs_quantity#1806 as bigint)) AS cs_qty#36045L, sum(cs_wholesale_cost#1807) AS cs_wc#36046, sum(cs_sales_price#1809) AS cs_sp#36047]\n                        +- Filter isnull(cr_order_number#2101L)\n                           +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n                              :- Join LeftOuter, ((cr_order_number#2101L = cs_order_number#1805L) && (cs_item_sk#1803 = cr_item_sk#2087))\n                              :  :- SubqueryAlias catalog_sales\n                              :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                              :  +- SubqueryAlias catalog_returns\n                              :     +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n                              +- SubqueryAlias date_dim\n                                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906, ratio#36031, store_qty#36032L, store_wholesale_cost#36033, store_sales_price#36034, other_chan_qty#36035L, other_chan_wholesale_cost#36036, other_chan_sales_price#36037]\n      +- Sort [ss_sold_year#36048 ASC NULLS FIRST, ss_item_sk#1905 ASC NULLS FIRST, ss_customer_sk#1906 ASC NULLS FIRST, ss_qty#36049L DESC NULLS LAST, ss_wc#36050 DESC NULLS LAST, ss_sp#36051 DESC NULLS LAST, other_chan_qty#36035L ASC NULLS FIRST, other_chan_wholesale_cost#36036 ASC NULLS FIRST, other_chan_sales_price#36037 ASC NULLS FIRST, round((cast(ss_qty#36049L as double) / cast(coalesce((ws_qty#36040L + cs_qty#36045L), 1) as double)), 2) ASC NULLS FIRST], true\n         +- Project [ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906, round((cast(ss_qty#36049L as double) / cast((coalesce(ws_qty#36040L, 0) + coalesce(cs_qty#36045L, 0)) as double)), 2) AS ratio#36031, ss_qty#36049L AS store_qty#36032L, ss_wc#36050 AS store_wholesale_cost#36033, ss_sp#36051 AS store_sales_price#36034, (coalesce(ws_qty#36040L, 0) + coalesce(cs_qty#36045L, 0)) AS other_chan_qty#36035L, CheckOverflow((promote_precision(cast(coalesce(ws_wc#36041, 0.00) as decimal(18,2))) + promote_precision(cast(coalesce(cs_wc#36046, 0.00) as decimal(18,2)))), DecimalType(18,2)) AS other_chan_wholesale_cost#36036, CheckOverflow((promote_precision(cast(coalesce(ws_sp#36042, 0.00) as decimal(18,2))) + promote_precision(cast(coalesce(cs_sp#36047, 0.00) as decimal(18,2)))), DecimalType(18,2)) AS other_chan_sales_price#36037, ss_sp#36051, ss_qty#36049L, cs_qty#36045L, ws_qty#36040L, ss_wc#36050]\n            +- Filter ((coalesce(ws_qty#36040L, 0) > 0) || (coalesce(cs_qty#36045L, 0) > 0))\n               +- Join LeftOuter, (((cs_sold_year#36043 = ss_sold_year#36048) && (cs_item_sk#1803 = ss_item_sk#1905)) && (cs_customer_sk#36044 = ss_customer_sk#1906))\n                  :- Project [ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906, ss_qty#36049L, ss_wc#36050, ss_sp#36051, ws_qty#36040L, ws_wc#36041, ws_sp#36042]\n                  :  +- Join LeftOuter, (((ws_sold_year#36038 = ss_sold_year#36048) && (ws_item_sk#1757 = ss_item_sk#1905)) && (ws_customer_sk#36039 = ss_customer_sk#1906))\n                  :     :- Aggregate [d_year#1046, ss_item_sk#1905, ss_customer_sk#1906], [d_year#1046 AS ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906, sum(cast(ss_quantity#1913 as bigint)) AS ss_qty#36049L, MakeDecimal(sum(UnscaledValue(ss_wholesale_cost#1914)),17,2) AS ss_wc#36050, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS ss_sp#36051]\n                  :     :  +- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_quantity#1913, ss_wholesale_cost#1914, ss_sales_price#1916, d_year#1046]\n                  :     :     +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                  :     :        :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_quantity#1913, ss_wholesale_cost#1914, ss_sales_price#1916, ss_sold_date_sk#1926]\n                  :     :        :  +- Filter isnull(sr_ticket_number#1712L)\n                  :     :        :     +- Join LeftOuter, ((sr_ticket_number#1712L = ss_ticket_number#1912L) && (ss_item_sk#1905 = sr_item_sk#1705))\n                  :     :        :        :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_ticket_number#1912L, ss_quantity#1913, ss_wholesale_cost#1914, ss_sales_price#1916, ss_sold_date_sk#1926]\n                  :     :        :        :  +- Filter isnotnull(ss_sold_date_sk#1926)\n                  :     :        :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :     :        :        +- Project [sr_item_sk#1705, sr_ticket_number#1712L]\n                  :     :        :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                  :     :        +- Project [d_date_sk#1040, d_year#1046]\n                  :     :           +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n                  :     :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :     +- Aggregate [d_year#1046, ws_item_sk#1757, ws_bill_customer_sk#1758], [d_year#1046 AS ws_sold_year#36038, ws_item_sk#1757, ws_bill_customer_sk#1758 AS ws_customer_sk#36039, sum(cast(ws_quantity#1772 as bigint)) AS ws_qty#36040L, MakeDecimal(sum(UnscaledValue(ws_wholesale_cost#1773)),17,2) AS ws_wc#36041, MakeDecimal(sum(UnscaledValue(ws_sales_price#1775)),17,2) AS ws_sp#36042]\n                  :        +- Project [ws_item_sk#1757, ws_bill_customer_sk#1758, ws_quantity#1772, ws_wholesale_cost#1773, ws_sales_price#1775, d_year#1046]\n                  :           +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                  :              :- Project [ws_item_sk#1757, ws_bill_customer_sk#1758, ws_quantity#1772, ws_wholesale_cost#1773, ws_sales_price#1775, ws_sold_date_sk#1788]\n                  :              :  +- Filter isnull(wr_order_number#2129L)\n                  :              :     +- Join LeftOuter, ((wr_order_number#2129L = ws_order_number#1771L) && (ws_item_sk#1757 = wr_item_sk#2118))\n                  :              :        :- Project [ws_item_sk#1757, ws_bill_customer_sk#1758, ws_order_number#1771L, ws_quantity#1772, ws_wholesale_cost#1773, ws_sales_price#1775, ws_sold_date_sk#1788]\n                  :              :        :  +- Filter isnotnull(ws_sold_date_sk#1788)\n                  :              :        :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :              :        +- Project [wr_item_sk#2118, wr_order_number#2129L]\n                  :              :           +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n                  :              +- Project [d_date_sk#1040, d_year#1046]\n                  :                 +- Filter isnotnull(d_date_sk#1040)\n                  :                    +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  +- Aggregate [d_year#1046, cs_item_sk#1803, cs_bill_customer_sk#1791], [d_year#1046 AS cs_sold_year#36043, cs_item_sk#1803, cs_bill_customer_sk#1791 AS cs_customer_sk#36044, sum(cast(cs_quantity#1806 as bigint)) AS cs_qty#36045L, MakeDecimal(sum(UnscaledValue(cs_wholesale_cost#1807)),17,2) AS cs_wc#36046, MakeDecimal(sum(UnscaledValue(cs_sales_price#1809)),17,2) AS cs_sp#36047]\n                     +- Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_wholesale_cost#1807, cs_sales_price#1809, d_year#1046]\n                        +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n                           :- Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_wholesale_cost#1807, cs_sales_price#1809, cs_sold_date_sk#1822]\n                           :  +- Filter isnull(cr_order_number#2101L)\n                           :     +- Join LeftOuter, ((cr_order_number#2101L = cs_order_number#1805L) && (cs_item_sk#1803 = cr_item_sk#2087))\n                           :        :- Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_order_number#1805L, cs_quantity#1806, cs_wholesale_cost#1807, cs_sales_price#1809, cs_sold_date_sk#1822]\n                           :        :  +- Filter isnotnull(cs_sold_date_sk#1822)\n                           :        :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                           :        +- Project [cr_item_sk#2087, cr_order_number#2101L]\n                           :           +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n                           +- Project [d_date_sk#1040, d_year#1046]\n                              +- Filter isnotnull(d_date_sk#1040)\n                                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[ss_sold_year#36048 ASC NULLS FIRST,ss_item_sk#1905 ASC NULLS FIRST,ss_customer_sk#1906 ASC NULLS FIRST,ss_qty#36049L DESC NULLS LAST,ss_wc#36050 DESC NULLS LAST,ss_sp#36051 DESC NULLS LAST,other_chan_qty#36035L ASC NULLS FIRST,other_chan_wholesale_cost#36036 ASC NULLS FIRST,other_chan_sales_price#36037 ASC NULLS FIRST,round((cast(ss_qty#36049L as double) / cast(coalesce((ws_qty#36040L + cs_qty#36045L), 1) as double)), 2) ASC NULLS FIRST], output=[ss_sold_year#36048,ss_item_sk#1905,ss_customer_sk#1906,ratio#36031,store_qty#36032L,store_wholesale_cost#36033,store_sales_price#36034,other_chan_qty#36035L,other_chan_wholesale_cost#36036,other_chan_sales_price#36037])\n+- *(26) Project [ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906, round((cast(ss_qty#36049L as double) / cast((coalesce(ws_qty#36040L, 0) + coalesce(cs_qty#36045L, 0)) as double)), 2) AS ratio#36031, ss_qty#36049L AS store_qty#36032L, ss_wc#36050 AS store_wholesale_cost#36033, ss_sp#36051 AS store_sales_price#36034, (coalesce(ws_qty#36040L, 0) + coalesce(cs_qty#36045L, 0)) AS other_chan_qty#36035L, CheckOverflow((promote_precision(cast(coalesce(ws_wc#36041, 0.00) as decimal(18,2))) + promote_precision(cast(coalesce(cs_wc#36046, 0.00) as decimal(18,2)))), DecimalType(18,2)) AS other_chan_wholesale_cost#36036, CheckOverflow((promote_precision(cast(coalesce(ws_sp#36042, 0.00) as decimal(18,2))) + promote_precision(cast(coalesce(cs_sp#36047, 0.00) as decimal(18,2)))), DecimalType(18,2)) AS other_chan_sales_price#36037, ss_sp#36051, ss_qty#36049L, cs_qty#36045L, ws_qty#36040L, ss_wc#36050]\n   +- *(26) Filter ((coalesce(ws_qty#36040L, 0) > 0) || (coalesce(cs_qty#36045L, 0) > 0))\n      +- SortMergeJoin [ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906], [cs_sold_year#36043, cs_item_sk#1803, cs_customer_sk#36044], LeftOuter\n         :- *(17) Project [ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906, ss_qty#36049L, ss_wc#36050, ss_sp#36051, ws_qty#36040L, ws_wc#36041, ws_sp#36042]\n         :  +- SortMergeJoin [ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906], [ws_sold_year#36038, ws_item_sk#1757, ws_customer_sk#36039], LeftOuter\n         :     :- *(8) Sort [ss_sold_year#36048 ASC NULLS FIRST, ss_item_sk#1905 ASC NULLS FIRST, ss_customer_sk#1906 ASC NULLS FIRST], false, 0\n         :     :  +- Exchange hashpartitioning(ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906, 200)\n         :     :     +- *(7) HashAggregate(keys=[d_year#1046, ss_item_sk#1905, ss_customer_sk#1906], functions=[sum(cast(ss_quantity#1913 as bigint)), sum(UnscaledValue(ss_wholesale_cost#1914)), sum(UnscaledValue(ss_sales_price#1916))], output=[ss_sold_year#36048, ss_item_sk#1905, ss_customer_sk#1906, ss_qty#36049L, ss_wc#36050, ss_sp#36051])\n         :     :        +- Exchange hashpartitioning(d_year#1046, ss_item_sk#1905, ss_customer_sk#1906, 200)\n         :     :           +- *(6) HashAggregate(keys=[d_year#1046, ss_item_sk#1905, ss_customer_sk#1906], functions=[partial_sum(cast(ss_quantity#1913 as bigint)), partial_sum(UnscaledValue(ss_wholesale_cost#1914)), partial_sum(UnscaledValue(ss_sales_price#1916))], output=[d_year#1046, ss_item_sk#1905, ss_customer_sk#1906, sum#36074L, sum#36075L, sum#36076L])\n         :     :              +- *(6) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_quantity#1913, ss_wholesale_cost#1914, ss_sales_price#1916, d_year#1046]\n         :     :                 +- *(6) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n         :     :                    :- *(6) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_quantity#1913, ss_wholesale_cost#1914, ss_sales_price#1916, ss_sold_date_sk#1926]\n         :     :                    :  +- *(6) Filter isnull(sr_ticket_number#1712L)\n         :     :                    :     +- SortMergeJoin [ss_ticket_number#1912L, ss_item_sk#1905], [sr_ticket_number#1712L, sr_item_sk#1705], LeftOuter\n         :     :                    :        :- *(2) Sort [ss_ticket_number#1912L ASC NULLS FIRST, ss_item_sk#1905 ASC NULLS FIRST], false, 0\n         :     :                    :        :  +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_item_sk#1905, 200)\n         :     :                    :        :     +- *(1) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [], ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_ticket_number:bigint,ss_quantity:int,ss_wholesale_cos...\n         :     :                    :        +- *(4) Sort [sr_ticket_number#1712L ASC NULLS FIRST, sr_item_sk#1705 ASC NULLS FIRST], false, 0\n         :     :                    :           +- Exchange hashpartitioning(sr_ticket_number#1712L, sr_item_sk#1705, 200)\n         :     :                    :              +- *(3) Project [sr_item_sk#1705, sr_ticket_number#1712L]\n         :     :                    :                 +- *(3) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_ticket_number#1712L,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns], PartitionCount: 2002, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint>\n         :     :                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :     :                       +- *(5) Project [d_date_sk#1040, d_year#1046]\n         :     :                          +- *(5) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n         :     :                             +- *(5) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n         :     +- *(16) Sort [ws_sold_year#36038 ASC NULLS FIRST, ws_item_sk#1757 ASC NULLS FIRST, ws_customer_sk#36039 ASC NULLS FIRST], false, 0\n         :        +- Exchange hashpartitioning(ws_sold_year#36038, ws_item_sk#1757, ws_customer_sk#36039, 200)\n         :           +- *(15) HashAggregate(keys=[d_year#1046, ws_item_sk#1757, ws_bill_customer_sk#1758], functions=[sum(cast(ws_quantity#1772 as bigint)), sum(UnscaledValue(ws_wholesale_cost#1773)), sum(UnscaledValue(ws_sales_price#1775))], output=[ws_sold_year#36038, ws_item_sk#1757, ws_customer_sk#36039, ws_qty#36040L, ws_wc#36041, ws_sp#36042])\n         :              +- Exchange hashpartitioning(d_year#1046, ws_item_sk#1757, ws_bill_customer_sk#1758, 200)\n         :                 +- *(14) HashAggregate(keys=[d_year#1046, ws_item_sk#1757, ws_bill_customer_sk#1758], functions=[partial_sum(cast(ws_quantity#1772 as bigint)), partial_sum(UnscaledValue(ws_wholesale_cost#1773)), partial_sum(UnscaledValue(ws_sales_price#1775))], output=[d_year#1046, ws_item_sk#1757, ws_bill_customer_sk#1758, sum#36080L, sum#36081L, sum#36082L])\n         :                    +- *(14) Project [ws_item_sk#1757, ws_bill_customer_sk#1758, ws_quantity#1772, ws_wholesale_cost#1773, ws_sales_price#1775, d_year#1046]\n         :                       +- *(14) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n         :                          :- *(14) Project [ws_item_sk#1757, ws_bill_customer_sk#1758, ws_quantity#1772, ws_wholesale_cost#1773, ws_sales_price#1775, ws_sold_date_sk#1788]\n         :                          :  +- *(14) Filter isnull(wr_order_number#2129L)\n         :                          :     +- SortMergeJoin [ws_order_number#1771L, ws_item_sk#1757], [wr_order_number#2129L, wr_item_sk#2118], LeftOuter\n         :                          :        :- *(10) Sort [ws_order_number#1771L ASC NULLS FIRST, ws_item_sk#1757 ASC NULLS FIRST], false, 0\n         :                          :        :  +- Exchange hashpartitioning(ws_order_number#1771L, ws_item_sk#1757, 200)\n         :                          :        :     +- *(9) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_bill_customer_sk#1758,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_sales_price#1775,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [], ReadSchema: struct<ws_item_sk:int,ws_bill_customer_sk:int,ws_order_number:bigint,ws_quantity:int,ws_wholesale...\n         :                          :        +- *(12) Sort [wr_order_number#2129L ASC NULLS FIRST, wr_item_sk#2118 ASC NULLS FIRST], false, 0\n         :                          :           +- Exchange hashpartitioning(wr_order_number#2129L, wr_item_sk#2118, 200)\n         :                          :              +- *(11) Project [wr_item_sk#2118, wr_order_number#2129L]\n         :                          :                 +- *(11) FileScan parquet db_tpcds.web_returns[wr_item_sk#2118,wr_order_number#2129L,wr_returned_date_sk#2140] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_returns], PartitionCount: 2110, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<wr_item_sk:int,wr_order_number:bigint>\n         :                          +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         :                             +- *(13) Project [d_date_sk#1040, d_year#1046]\n         :                                +- *(13) Filter isnotnull(d_date_sk#1040)\n         :                                   +- *(13) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n         +- *(25) Sort [cs_sold_year#36043 ASC NULLS FIRST, cs_item_sk#1803 ASC NULLS FIRST, cs_customer_sk#36044 ASC NULLS FIRST], false, 0\n            +- Exchange hashpartitioning(cs_sold_year#36043, cs_item_sk#1803, cs_customer_sk#36044, 200)\n               +- *(24) HashAggregate(keys=[d_year#1046, cs_item_sk#1803, cs_bill_customer_sk#1791], functions=[sum(cast(cs_quantity#1806 as bigint)), sum(UnscaledValue(cs_wholesale_cost#1807)), sum(UnscaledValue(cs_sales_price#1809))], output=[cs_sold_year#36043, cs_item_sk#1803, cs_customer_sk#36044, cs_qty#36045L, cs_wc#36046, cs_sp#36047])\n                  +- Exchange hashpartitioning(d_year#1046, cs_item_sk#1803, cs_bill_customer_sk#1791, 200)\n                     +- *(23) HashAggregate(keys=[d_year#1046, cs_item_sk#1803, cs_bill_customer_sk#1791], functions=[partial_sum(cast(cs_quantity#1806 as bigint)), partial_sum(UnscaledValue(cs_wholesale_cost#1807)), partial_sum(UnscaledValue(cs_sales_price#1809))], output=[d_year#1046, cs_item_sk#1803, cs_bill_customer_sk#1791, sum#36086L, sum#36087L, sum#36088L])\n                        +- *(23) Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_wholesale_cost#1807, cs_sales_price#1809, d_year#1046]\n                           +- *(23) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n                              :- *(23) Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_quantity#1806, cs_wholesale_cost#1807, cs_sales_price#1809, cs_sold_date_sk#1822]\n                              :  +- *(23) Filter isnull(cr_order_number#2101L)\n                              :     +- SortMergeJoin [cs_order_number#1805L, cs_item_sk#1803], [cr_order_number#2101L, cr_item_sk#2087], LeftOuter\n                              :        :- *(19) Sort [cs_order_number#1805L ASC NULLS FIRST, cs_item_sk#1803 ASC NULLS FIRST], false, 0\n                              :        :  +- Exchange hashpartitioning(cs_order_number#1805L, cs_item_sk#1803, 200)\n                              :        :     +- *(18) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_item_sk#1803,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_sales_price#1809,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_bill_customer_sk:int,cs_item_sk:int,cs_order_number:bigint,cs_quantity:int,cs_wholesale...\n                              :        +- *(21) Sort [cr_order_number#2101L ASC NULLS FIRST, cr_item_sk#2087 ASC NULLS FIRST], false, 0\n                              :           +- Exchange hashpartitioning(cr_order_number#2101L, cr_item_sk#2087, 200)\n                              :              +- *(20) Project [cr_item_sk#2087, cr_order_number#2101L]\n                              :                 +- *(20) FileScan parquet db_tpcds.catalog_returns[cr_item_sk#2087,cr_order_number#2101L,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns], PartitionCount: 2066, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<cr_item_sk:int,cr_order_number:bigint>\n                              +- ReusedExchange [d_date_sk#1040, d_year#1046], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q79-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","date_dim","store","household_demographics","customer"],"parsingTime":0.002326,"analysisTime":0.001254,"optimizationTime":285.924341,"planningTime":12.809941,"executionTime":2925.027404,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['c_last_name ASC NULLS FIRST, 'c_first_name ASC NULLS FIRST, 'substr('s_city, 1, 30) ASC NULLS FIRST, 'profit ASC NULLS FIRST], true\n      +- 'Project ['c_last_name, 'c_first_name, unresolvedalias('substr('s_city, 1, 30), None), 'ss_ticket_number, 'amt, 'profit]\n         +- 'Filter ('ss_customer_sk = 'c_customer_sk)\n            +- 'Join Inner\n               :- 'SubqueryAlias ms\n               :  +- 'Aggregate ['ss_ticket_number, 'ss_customer_sk, 'ss_addr_sk, 'store.s_city], ['ss_ticket_number, 'ss_customer_sk, 'store.s_city, 'sum('ss_coupon_amt) AS amt#36145, 'sum('ss_net_profit) AS profit#36146]\n               :     +- 'Filter (((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) && ('store_sales.ss_store_sk = 'store.s_store_sk)) && (('store_sales.ss_hdemo_sk = 'household_demographics.hd_demo_sk) && (('household_demographics.hd_dep_count = 6) || ('household_demographics.hd_vehicle_count > 2)))) && ((('date_dim.d_dow = 1) && 'date_dim.d_year IN (1999,(1999 + 1),(1999 + 2))) && (('store.s_number_employees >= 200) && ('store.s_number_employees <= 295))))\n               :        +- 'Join Inner\n               :           :- 'Join Inner\n               :           :  :- 'Join Inner\n               :           :  :  :- 'UnresolvedRelation `store_sales`\n               :           :  :  +- 'UnresolvedRelation `date_dim`\n               :           :  +- 'UnresolvedRelation `store`\n               :           +- 'UnresolvedRelation `household_demographics`\n               +- 'UnresolvedRelation `customer`\n\n== Analyzed Logical Plan ==\nc_last_name: string, c_first_name: string, substring(s_city, 1, 30): string, ss_ticket_number: bigint, amt: decimal(17,2), profit: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [c_last_name#869, c_first_name#868, substring(s_city, 1, 30)#36149, ss_ticket_number#1912L, amt#36145, profit#36146]\n      +- Sort [c_last_name#869 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, substring(s_city#1408, 1, 30) ASC NULLS FIRST, profit#36146 ASC NULLS FIRST], true\n         +- Project [c_last_name#869, c_first_name#868, substring(s_city#1408, 1, 30) AS substring(s_city, 1, 30)#36149, ss_ticket_number#1912L, amt#36145, profit#36146, s_city#1408]\n            +- Filter (ss_customer_sk#1906 = c_customer_sk#860)\n               +- Join Inner\n                  :- SubqueryAlias ms\n                  :  +- Aggregate [ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, s_city#1408], [ss_ticket_number#1912L, ss_customer_sk#1906, s_city#1408, sum(ss_coupon_amt#1922) AS amt#36145, sum(ss_net_profit#1925) AS profit#36146]\n                  :     +- Filter ((((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_store_sk#1910 = s_store_sk#1386)) && ((ss_hdemo_sk#1908 = hd_demo_sk#1106) && ((hd_dep_count#1109 = 6) || (hd_vehicle_count#1110 > 2)))) && (((d_dow#1047 = 1) && d_year#1046 IN (1999,(1999 + 1),(1999 + 2))) && ((s_number_employees#1392 >= 200) && (s_number_employees#1392 <= 295))))\n                  :        +- Join Inner\n                  :           :- Join Inner\n                  :           :  :- Join Inner\n                  :           :  :  :- SubqueryAlias store_sales\n                  :           :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :           :  :  +- SubqueryAlias date_dim\n                  :           :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :           :  +- SubqueryAlias store\n                  :           :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                  :           +- SubqueryAlias household_demographics\n                  :              +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n                  +- SubqueryAlias customer\n                     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [c_last_name#869, c_first_name#868, substring(s_city, 1, 30)#36149, ss_ticket_number#1912L, amt#36145, profit#36146]\n      +- Sort [c_last_name#869 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, substring(s_city#1408, 1, 30) ASC NULLS FIRST, profit#36146 ASC NULLS FIRST], true\n         +- Project [c_last_name#869, c_first_name#868, substring(s_city#1408, 1, 30) AS substring(s_city, 1, 30)#36149, ss_ticket_number#1912L, amt#36145, profit#36146, s_city#1408]\n            +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n               :- Aggregate [ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, s_city#1408], [ss_ticket_number#1912L, ss_customer_sk#1906, s_city#1408, MakeDecimal(sum(UnscaledValue(ss_coupon_amt#1922)),17,2) AS amt#36145, MakeDecimal(sum(UnscaledValue(ss_net_profit#1925)),17,2) AS profit#36146]\n               :  +- Project [ss_customer_sk#1906, ss_addr_sk#1909, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925, s_city#1408]\n               :     +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n               :        :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925, s_city#1408]\n               :        :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n               :        :     :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925]\n               :        :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :        :     :     :- Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925, ss_sold_date_sk#1926]\n               :        :     :     :  +- Filter (((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_customer_sk#1906))\n               :        :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :        :     :     +- Project [d_date_sk#1040]\n               :        :     :        +- Filter (((isnotnull(d_dow#1047) && (d_dow#1047 = 1)) && d_year#1046 IN (1999,2000,2001)) && isnotnull(d_date_sk#1040))\n               :        :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :        :     +- Project [s_store_sk#1386, s_city#1408]\n               :        :        +- Filter (((isnotnull(s_number_employees#1392) && (s_number_employees#1392 >= 200)) && (s_number_employees#1392 <= 295)) && isnotnull(s_store_sk#1386))\n               :        :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               :        +- Project [hd_demo_sk#1106]\n               :           +- Filter (((hd_dep_count#1109 = 6) || (hd_vehicle_count#1110 > 2)) && isnotnull(hd_demo_sk#1106))\n               :              +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n               +- Project [c_customer_sk#860, c_first_name#868, c_last_name#869]\n                  +- Filter isnotnull(c_customer_sk#860)\n                     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[c_last_name#869 ASC NULLS FIRST,c_first_name#868 ASC NULLS FIRST,substring(s_city#1408, 1, 30) ASC NULLS FIRST,profit#36146 ASC NULLS FIRST], output=[c_last_name#869,c_first_name#868,substring(s_city, 1, 30)#36149,ss_ticket_number#1912L,amt#36145,profit#36146])\n+- *(6) Project [c_last_name#869, c_first_name#868, substring(s_city#1408, 1, 30) AS substring(s_city, 1, 30)#36149, ss_ticket_number#1912L, amt#36145, profit#36146, s_city#1408]\n   +- *(6) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n      :- *(6) HashAggregate(keys=[ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, s_city#1408], functions=[sum(UnscaledValue(ss_coupon_amt#1922)), sum(UnscaledValue(ss_net_profit#1925))], output=[ss_ticket_number#1912L, ss_customer_sk#1906, s_city#1408, amt#36145, profit#36146])\n      :  +- Exchange hashpartitioning(ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, s_city#1408, 200)\n      :     +- *(4) HashAggregate(keys=[ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, s_city#1408], functions=[partial_sum(UnscaledValue(ss_coupon_amt#1922)), partial_sum(UnscaledValue(ss_net_profit#1925))], output=[ss_ticket_number#1912L, ss_customer_sk#1906, ss_addr_sk#1909, s_city#1408, sum#36158L, sum#36159L])\n      :        +- *(4) Project [ss_customer_sk#1906, ss_addr_sk#1909, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925, s_city#1408]\n      :           +- *(4) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n      :              :- *(4) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925, s_city#1408]\n      :              :  +- *(4) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n      :              :     :- *(4) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925]\n      :              :     :  +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n      :              :     :     :- *(4) Project [ss_customer_sk#1906, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_ticket_number#1912L, ss_coupon_amt#1922, ss_net_profit#1925, ss_sold_date_sk#1926]\n      :              :     :     :  +- *(4) Filter ((isnotnull(ss_store_sk#1910) && isnotnull(ss_hdemo_sk#1908)) && isnotnull(ss_customer_sk#1906))\n      :              :     :     :     +- *(4) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_ticket_number#1912L,ss_coupon_amt#1922,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_hdemo_sk:int,ss_addr_sk:int,ss_store_sk:int,ss_ticket_number:bigint,...\n      :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :              :     :        +- *(1) Project [d_date_sk#1040]\n      :              :     :           +- *(1) Filter (((isnotnull(d_dow#1047) && (d_dow#1047 = 1)) && d_year#1046 IN (1999,2000,2001)) && isnotnull(d_date_sk#1040))\n      :              :     :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_dow#1047] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_dow), EqualTo(d_dow,1), In(d_year, [1999,2000,2001]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_dow:int>\n      :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :              :        +- *(2) Project [s_store_sk#1386, s_city#1408]\n      :              :           +- *(2) Filter (((isnotnull(s_number_employees#1392) && (s_number_employees#1392 >= 200)) && (s_number_employees#1392 <= 295)) && isnotnull(s_store_sk#1386))\n      :              :              +- *(2) FileScan parquet db_tpcds.store[s_store_sk#1386,s_number_employees#1392,s_city#1408] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_number_employees), GreaterThanOrEqual(s_number_employees,200), LessThanOrEqual(s_num..., ReadSchema: struct<s_store_sk:int,s_number_employees:int,s_city:string>\n      :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                 +- *(3) Project [hd_demo_sk#1106]\n      :                    +- *(3) Filter (((hd_dep_count#1109 = 6) || (hd_vehicle_count#1110 > 2)) && isnotnull(hd_demo_sk#1106))\n      :                       +- *(3) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_dep_count#1109,hd_vehicle_count#1110] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [Or(EqualTo(hd_dep_count,6),GreaterThan(hd_vehicle_count,2)), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:int,hd_dep_count:int,hd_vehicle_count:int>\n      +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         +- *(5) Project [c_customer_sk#860, c_first_name#868, c_last_name#869]\n            +- *(5) Filter isnotnull(c_customer_sk#860)\n               +- *(5) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_first_name#868,c_last_name#869] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int,c_first_name:string,c_last_name:string>"},{"name":"q80-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin"],"tables":["ssr","csr","wsr"],"parsingTime":0.00336,"analysisTime":0.001405,"optimizationTime":885.887693,"planningTime":769.750827,"executionTime":22221.532719,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ssr, csr, wsr]\n:  :- 'SubqueryAlias ssr\n:  :  +- 'Aggregate ['s_store_id], ['s_store_id AS store_id#36249, 'sum('ss_ext_sales_price) AS sales#36250, 'sum('coalesce('sr_return_amt, 0)) AS returns#36251, 'sum(('ss_net_profit - 'coalesce('sr_net_loss, 0))) AS profit#36252]\n:  :     +- 'Filter (((('ss_sold_date_sk = 'd_date_sk) && (('d_date >= cast(2000-08-23 as date)) && ('d_date <= (cast(2000-08-23 as date) + interval 4 weeks 2 days)))) && (('ss_store_sk = 's_store_sk) && ('ss_item_sk = 'i_item_sk))) && ((('i_current_price > 50) && ('ss_promo_sk = 'p_promo_sk)) && ('p_channel_tv = N)))\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'Join Inner\n:  :           :  :  :- 'Join Inner\n:  :           :  :  :  :- 'Join LeftOuter, (('ss_item_sk = 'sr_item_sk) && ('ss_ticket_number = 'sr_ticket_number))\n:  :           :  :  :  :  :- 'UnresolvedRelation `store_sales`\n:  :           :  :  :  :  +- 'UnresolvedRelation `store_returns`\n:  :           :  :  :  +- 'UnresolvedRelation `date_dim`\n:  :           :  :  +- 'UnresolvedRelation `store`\n:  :           :  +- 'UnresolvedRelation `item`\n:  :           +- 'UnresolvedRelation `promotion`\n:  :- 'SubqueryAlias csr\n:  :  +- 'Aggregate ['cp_catalog_page_id], ['cp_catalog_page_id AS catalog_page_id#36253, 'sum('cs_ext_sales_price) AS sales#36254, 'sum('coalesce('cr_return_amount, 0)) AS returns#36255, 'sum(('cs_net_profit - 'coalesce('cr_net_loss, 0))) AS profit#36256]\n:  :     +- 'Filter (((('cs_sold_date_sk = 'd_date_sk) && (('d_date >= cast(2000-08-23 as date)) && ('d_date <= (cast(2000-08-23 as date) + interval 4 weeks 2 days)))) && (('cs_catalog_page_sk = 'cp_catalog_page_sk) && ('cs_item_sk = 'i_item_sk))) && ((('i_current_price > 50) && ('cs_promo_sk = 'p_promo_sk)) && ('p_channel_tv = N)))\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'Join Inner\n:  :           :  :  :- 'Join Inner\n:  :           :  :  :  :- 'Join LeftOuter, (('cs_item_sk = 'cr_item_sk) && ('cs_order_number = 'cr_order_number))\n:  :           :  :  :  :  :- 'UnresolvedRelation `catalog_sales`\n:  :           :  :  :  :  +- 'UnresolvedRelation `catalog_returns`\n:  :           :  :  :  +- 'UnresolvedRelation `date_dim`\n:  :           :  :  +- 'UnresolvedRelation `catalog_page`\n:  :           :  +- 'UnresolvedRelation `item`\n:  :           +- 'UnresolvedRelation `promotion`\n:  +- 'SubqueryAlias wsr\n:     +- 'Aggregate ['web_site_id], ['web_site_id, 'sum('ws_ext_sales_price) AS sales#36257, 'sum('coalesce('wr_return_amt, 0)) AS returns#36258, 'sum(('ws_net_profit - 'coalesce('wr_net_loss, 0))) AS profit#36259]\n:        +- 'Filter (((('ws_sold_date_sk = 'd_date_sk) && (('d_date >= cast(2000-08-23 as date)) && ('d_date <= (cast(2000-08-23 as date) + interval 4 weeks 2 days)))) && (('ws_web_site_sk = 'web_site_sk) && ('ws_item_sk = 'i_item_sk))) && ((('i_current_price > 50) && ('ws_promo_sk = 'p_promo_sk)) && ('p_channel_tv = N)))\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'Join Inner\n:              :  :  :- 'Join Inner\n:              :  :  :  :- 'Join LeftOuter, (('ws_item_sk = 'wr_item_sk) && ('ws_order_number = 'wr_order_number))\n:              :  :  :  :  :- 'UnresolvedRelation `web_sales`\n:              :  :  :  :  +- 'UnresolvedRelation `web_returns`\n:              :  :  :  +- 'UnresolvedRelation `date_dim`\n:              :  :  +- 'UnresolvedRelation `web_site`\n:              :  +- 'UnresolvedRelation `item`\n:              +- 'UnresolvedRelation `promotion`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['channel ASC NULLS FIRST, 'id ASC NULLS FIRST], true\n         +- 'Aggregate ['rollup('channel, 'id)], ['channel, 'id, 'sum('sales) AS sales#36246, 'sum('returns) AS returns#36247, 'sum('profit) AS profit#36248]\n            +- 'SubqueryAlias x\n               +- 'Union\n                  :- 'Union\n                  :  :- 'Project [store channel AS channel#36240, 'concat(store, 'store_id) AS id#36241, 'sales, 'returns, 'profit]\n                  :  :  +- 'UnresolvedRelation `ssr`\n                  :  +- 'Project [catalog channel AS channel#36242, 'concat(catalog_page, 'catalog_page_id) AS id#36243, 'sales, 'returns, 'profit]\n                  :     +- 'UnresolvedRelation `csr`\n                  +- 'Project [web channel AS channel#36244, 'concat(web_site, 'web_site_id) AS id#36245, 'sales, 'returns, 'profit]\n                     +- 'UnresolvedRelation `wsr`\n\n== Analyzed Logical Plan ==\nchannel: string, id: string, sales: decimal(27,2), returns: decimal(32,2), profit: decimal(33,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#36275 ASC NULLS FIRST, id#36276 ASC NULLS FIRST], true\n      +- Aggregate [channel#36275, id#36276, spark_grouping_id#36272], [channel#36275, id#36276, sum(sales#36250) AS sales#36246, sum(returns#36251) AS returns#36247, sum(profit#36252) AS profit#36248]\n         +- Expand [List(channel#36240, id#36241, sales#36250, returns#36251, profit#36252, channel#36273, id#36274, 0), List(channel#36240, id#36241, sales#36250, returns#36251, profit#36252, channel#36273, null, 1), List(channel#36240, id#36241, sales#36250, returns#36251, profit#36252, null, null, 3)], [channel#36240, id#36241, sales#36250, returns#36251, profit#36252, channel#36275, id#36276, spark_grouping_id#36272]\n            +- Project [channel#36240, id#36241, sales#36250, returns#36251, profit#36252, channel#36240 AS channel#36273, id#36241 AS id#36274]\n               +- SubqueryAlias x\n                  +- Union\n                     :- Union\n                     :  :- Project [store channel AS channel#36240, concat(store, store_id#36249) AS id#36241, sales#36250, returns#36251, profit#36252]\n                     :  :  +- SubqueryAlias ssr\n                     :  :     +- Aggregate [s_store_id#1387], [s_store_id#1387 AS store_id#36249, sum(ss_ext_sales_price#1918) AS sales#36250, sum(coalesce(cast(sr_return_amt#1714 as decimal(12,2)), cast(0 as decimal(12,2)))) AS returns#36251, sum(CheckOverflow((promote_precision(cast(ss_net_profit#1925 as decimal(13,2))) - promote_precision(cast(coalesce(cast(sr_net_loss#1722 as decimal(12,2)), cast(0 as decimal(12,2))) as decimal(13,2)))), DecimalType(13,2))) AS profit#36252]\n                     :  :        +- Filter ((((ss_sold_date_sk#1926 = d_date_sk#1040) && ((d_date#1042 >= cast(2000-08-23 as date)) && (d_date#1042 <= cast(cast(cast(2000-08-23 as date) as timestamp) + interval 4 weeks 2 days as date)))) && ((ss_store_sk#1910 = s_store_sk#1386) && (ss_item_sk#1905 = i_item_sk#1172))) && (((cast(i_current_price#1177 as decimal(7,2)) > cast(cast(50 as decimal(2,0)) as decimal(7,2))) && (ss_promo_sk#1911 = p_promo_sk#1254)) && (p_channel_tv#1265 = N)))\n                     :  :           +- Join Inner\n                     :  :              :- Join Inner\n                     :  :              :  :- Join Inner\n                     :  :              :  :  :- Join Inner\n                     :  :              :  :  :  :- Join LeftOuter, ((ss_item_sk#1905 = sr_item_sk#1705) && (ss_ticket_number#1912L = sr_ticket_number#1712L))\n                     :  :              :  :  :  :  :- SubqueryAlias store_sales\n                     :  :              :  :  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :  :              :  :  :  :  +- SubqueryAlias store_returns\n                     :  :              :  :  :  :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                     :  :              :  :  :  +- SubqueryAlias date_dim\n                     :  :              :  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :  :              :  :  +- SubqueryAlias store\n                     :  :              :  :     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n                     :  :              :  +- SubqueryAlias item\n                     :  :              :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :  :              +- SubqueryAlias promotion\n                     :  :                 +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n                     :  +- Project [catalog channel AS channel#36242, concat(catalog_page, catalog_page_id#36253) AS id#36243, sales#36254, returns#36255, profit#36256]\n                     :     +- SubqueryAlias csr\n                     :        +- Aggregate [cp_catalog_page_id#807], [cp_catalog_page_id#807 AS catalog_page_id#36253, sum(cs_ext_sales_price#1811) AS sales#36254, sum(coalesce(cast(cr_return_amount#2103 as decimal(12,2)), cast(0 as decimal(12,2)))) AS returns#36255, sum(CheckOverflow((promote_precision(cast(cs_net_profit#1821 as decimal(13,2))) - promote_precision(cast(coalesce(cast(cr_net_loss#2111 as decimal(12,2)), cast(0 as decimal(12,2))) as decimal(13,2)))), DecimalType(13,2))) AS profit#36256]\n                     :           +- Filter ((((cs_sold_date_sk#1822 = d_date_sk#1040) && ((d_date#1042 >= cast(2000-08-23 as date)) && (d_date#1042 <= cast(cast(cast(2000-08-23 as date) as timestamp) + interval 4 weeks 2 days as date)))) && ((cs_catalog_page_sk#1800 = cp_catalog_page_sk#806) && (cs_item_sk#1803 = i_item_sk#1172))) && (((cast(i_current_price#1177 as decimal(7,2)) > cast(cast(50 as decimal(2,0)) as decimal(7,2))) && (cs_promo_sk#1804 = p_promo_sk#1254)) && (p_channel_tv#1265 = N)))\n                     :              +- Join Inner\n                     :                 :- Join Inner\n                     :                 :  :- Join Inner\n                     :                 :  :  :- Join Inner\n                     :                 :  :  :  :- Join LeftOuter, ((cs_item_sk#1803 = cr_item_sk#2087) && (cs_order_number#1805L = cr_order_number#2101L))\n                     :                 :  :  :  :  :- SubqueryAlias catalog_sales\n                     :                 :  :  :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     :                 :  :  :  :  +- SubqueryAlias catalog_returns\n                     :                 :  :  :  :     +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n                     :                 :  :  :  +- SubqueryAlias date_dim\n                     :                 :  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                     :                 :  :  +- SubqueryAlias catalog_page\n                     :                 :  :     +- Relation[cp_catalog_page_sk#806,cp_catalog_page_id#807,cp_start_date_sk#808,cp_end_date_sk#809,cp_department#810,cp_catalog_number#811,cp_catalog_page_number#812,cp_description#813,cp_type#814] parquet\n                     :                 :  +- SubqueryAlias item\n                     :                 :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     :                 +- SubqueryAlias promotion\n                     :                    +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n                     +- Project [web channel AS channel#36244, concat(web_site, web_site_id#1649) AS id#36245, sales#36257, returns#36258, profit#36259]\n                        +- SubqueryAlias wsr\n                           +- Aggregate [web_site_id#1649], [web_site_id#1649, sum(ws_ext_sales_price#1777) AS sales#36257, sum(coalesce(cast(wr_return_amt#2131 as decimal(12,2)), cast(0 as decimal(12,2)))) AS returns#36258, sum(CheckOverflow((promote_precision(cast(ws_net_profit#1787 as decimal(13,2))) - promote_precision(cast(coalesce(cast(wr_net_loss#2139 as decimal(12,2)), cast(0 as decimal(12,2))) as decimal(13,2)))), DecimalType(13,2))) AS profit#36259]\n                              +- Filter ((((ws_sold_date_sk#1788 = d_date_sk#1040) && ((d_date#1042 >= cast(2000-08-23 as date)) && (d_date#1042 <= cast(cast(cast(2000-08-23 as date) as timestamp) + interval 4 weeks 2 days as date)))) && ((ws_web_site_sk#1767 = web_site_sk#1648) && (ws_item_sk#1757 = i_item_sk#1172))) && (((cast(i_current_price#1177 as decimal(7,2)) > cast(cast(50 as decimal(2,0)) as decimal(7,2))) && (ws_promo_sk#1770 = p_promo_sk#1254)) && (p_channel_tv#1265 = N)))\n                                 +- Join Inner\n                                    :- Join Inner\n                                    :  :- Join Inner\n                                    :  :  :- Join Inner\n                                    :  :  :  :- Join LeftOuter, ((ws_item_sk#1757 = wr_item_sk#2118) && (ws_order_number#1771L = wr_order_number#2129L))\n                                    :  :  :  :  :- SubqueryAlias web_sales\n                                    :  :  :  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                                    :  :  :  :  +- SubqueryAlias web_returns\n                                    :  :  :  :     +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n                                    :  :  :  +- SubqueryAlias date_dim\n                                    :  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                    :  :  +- SubqueryAlias web_site\n                                    :  :     +- Relation[web_site_sk#1648,web_site_id#1649,web_rec_start_date#1650,web_rec_end_date#1651,web_name#1652,web_open_date_sk#1653,web_close_date_sk#1654,web_class#1655,web_manager#1656,web_mkt_id#1657,web_mkt_class#1658,web_mkt_desc#1659,web_market_manager#1660,web_company_id#1661,web_company_name#1662,web_street_number#1663,web_street_name#1664,web_street_type#1665,web_suite_number#1666,web_city#1667,web_county#1668,web_state#1669,web_zip#1670,web_country#1671,... 2 more fields] parquet\n                                    :  +- SubqueryAlias item\n                                    :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                                    +- SubqueryAlias promotion\n                                       +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [channel#36275 ASC NULLS FIRST, id#36276 ASC NULLS FIRST], true\n      +- Aggregate [channel#36275, id#36276, spark_grouping_id#36272], [channel#36275, id#36276, sum(sales#36250) AS sales#36246, sum(returns#36251) AS returns#36247, sum(profit#36252) AS profit#36248]\n         +- Expand [List(sales#36250, returns#36251, profit#36252, channel#36273, id#36274, 0), List(sales#36250, returns#36251, profit#36252, channel#36273, null, 1), List(sales#36250, returns#36251, profit#36252, null, null, 3)], [sales#36250, returns#36251, profit#36252, channel#36275, id#36276, spark_grouping_id#36272]\n            +- Union\n               :- Aggregate [s_store_id#1387], [MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS sales#36250, sum(coalesce(cast(sr_return_amt#1714 as decimal(12,2)), 0.00)) AS returns#36251, sum(CheckOverflow((promote_precision(cast(ss_net_profit#1925 as decimal(13,2))) - promote_precision(cast(coalesce(cast(sr_net_loss#1722 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2))) AS profit#36252, store channel AS channel#36273, concat(store, s_store_id#1387) AS id#36274]\n               :  +- Project [ss_ext_sales_price#1918, ss_net_profit#1925, sr_return_amt#1714, sr_net_loss#1722, s_store_id#1387]\n               :     +- Join Inner, (ss_promo_sk#1911 = p_promo_sk#1254)\n               :        :- Project [ss_promo_sk#1911, ss_ext_sales_price#1918, ss_net_profit#1925, sr_return_amt#1714, sr_net_loss#1722, s_store_id#1387]\n               :        :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :        :     :- Project [ss_item_sk#1905, ss_promo_sk#1911, ss_ext_sales_price#1918, ss_net_profit#1925, sr_return_amt#1714, sr_net_loss#1722, s_store_id#1387]\n               :        :     :  +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n               :        :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_promo_sk#1911, ss_ext_sales_price#1918, ss_net_profit#1925, sr_return_amt#1714, sr_net_loss#1722]\n               :        :     :     :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n               :        :     :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_promo_sk#1911, ss_ext_sales_price#1918, ss_net_profit#1925, ss_sold_date_sk#1926, sr_return_amt#1714, sr_net_loss#1722]\n               :        :     :     :     :  +- Join LeftOuter, ((ss_item_sk#1905 = sr_item_sk#1705) && (ss_ticket_number#1912L = sr_ticket_number#1712L))\n               :        :     :     :     :     :- Project [ss_item_sk#1905, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_ext_sales_price#1918, ss_net_profit#1925, ss_sold_date_sk#1926]\n               :        :     :     :     :     :  +- Filter (((isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_store_sk#1910)) && isnotnull(ss_item_sk#1905)) && isnotnull(ss_promo_sk#1911))\n               :        :     :     :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :        :     :     :     :     +- Project [sr_item_sk#1705, sr_ticket_number#1712L, sr_return_amt#1714, sr_net_loss#1722]\n               :        :     :     :     :        +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :        :     :     :     +- Project [d_date_sk#1040]\n               :        :     :     :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11222)) && isnotnull(d_date_sk#1040))\n               :        :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :        :     :     +- Project [s_store_sk#1386, s_store_id#1387]\n               :        :     :        +- Filter isnotnull(s_store_sk#1386)\n               :        :     :           +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n               :        :     +- Project [i_item_sk#1172]\n               :        :        +- Filter ((isnotnull(i_current_price#1177) && (i_current_price#1177 > 50.00)) && isnotnull(i_item_sk#1172))\n               :        :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :        +- Project [p_promo_sk#1254]\n               :           +- Filter ((isnotnull(p_channel_tv#1265) && (p_channel_tv#1265 = N)) && isnotnull(p_promo_sk#1254))\n               :              +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n               :- Aggregate [cp_catalog_page_id#807], [MakeDecimal(sum(UnscaledValue(cs_ext_sales_price#1811)),17,2) AS sales#36254, sum(coalesce(cast(cr_return_amount#2103 as decimal(12,2)), 0.00)) AS returns#36255, sum(CheckOverflow((promote_precision(cast(cs_net_profit#1821 as decimal(13,2))) - promote_precision(cast(coalesce(cast(cr_net_loss#2111 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2))) AS profit#36256, catalog channel AS channel#36273, concat(catalog_page, cp_catalog_page_id#807) AS id#36274]\n               :  +- Project [cs_ext_sales_price#1811, cs_net_profit#1821, cr_return_amount#2103, cr_net_loss#2111, cp_catalog_page_id#807]\n               :     +- Join Inner, (cs_promo_sk#1804 = p_promo_sk#1254)\n               :        :- Project [cs_promo_sk#1804, cs_ext_sales_price#1811, cs_net_profit#1821, cr_return_amount#2103, cr_net_loss#2111, cp_catalog_page_id#807]\n               :        :  +- Join Inner, (cs_item_sk#1803 = i_item_sk#1172)\n               :        :     :- Project [cs_item_sk#1803, cs_promo_sk#1804, cs_ext_sales_price#1811, cs_net_profit#1821, cr_return_amount#2103, cr_net_loss#2111, cp_catalog_page_id#807]\n               :        :     :  +- Join Inner, (cs_catalog_page_sk#1800 = cp_catalog_page_sk#806)\n               :        :     :     :- Project [cs_catalog_page_sk#1800, cs_item_sk#1803, cs_promo_sk#1804, cs_ext_sales_price#1811, cs_net_profit#1821, cr_return_amount#2103, cr_net_loss#2111]\n               :        :     :     :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n               :        :     :     :     :- Project [cs_catalog_page_sk#1800, cs_item_sk#1803, cs_promo_sk#1804, cs_ext_sales_price#1811, cs_net_profit#1821, cs_sold_date_sk#1822, cr_return_amount#2103, cr_net_loss#2111]\n               :        :     :     :     :  +- Join LeftOuter, ((cs_item_sk#1803 = cr_item_sk#2087) && (cs_order_number#1805L = cr_order_number#2101L))\n               :        :     :     :     :     :- Project [cs_catalog_page_sk#1800, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_ext_sales_price#1811, cs_net_profit#1821, cs_sold_date_sk#1822]\n               :        :     :     :     :     :  +- Filter (((isnotnull(cs_sold_date_sk#1822) && isnotnull(cs_catalog_page_sk#1800)) && isnotnull(cs_item_sk#1803)) && isnotnull(cs_promo_sk#1804))\n               :        :     :     :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :        :     :     :     :     +- Project [cr_item_sk#2087, cr_order_number#2101L, cr_return_amount#2103, cr_net_loss#2111]\n               :        :     :     :     :        +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n               :        :     :     :     +- Project [d_date_sk#1040]\n               :        :     :     :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11222)) && isnotnull(d_date_sk#1040))\n               :        :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :        :     :     +- Project [cp_catalog_page_sk#806, cp_catalog_page_id#807]\n               :        :     :        +- Filter isnotnull(cp_catalog_page_sk#806)\n               :        :     :           +- Relation[cp_catalog_page_sk#806,cp_catalog_page_id#807,cp_start_date_sk#808,cp_end_date_sk#809,cp_department#810,cp_catalog_number#811,cp_catalog_page_number#812,cp_description#813,cp_type#814] parquet\n               :        :     +- Project [i_item_sk#1172]\n               :        :        +- Filter ((isnotnull(i_current_price#1177) && (i_current_price#1177 > 50.00)) && isnotnull(i_item_sk#1172))\n               :        :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :        +- Project [p_promo_sk#1254]\n               :           +- Filter ((isnotnull(p_channel_tv#1265) && (p_channel_tv#1265 = N)) && isnotnull(p_promo_sk#1254))\n               :              +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n               +- Aggregate [web_site_id#1649], [MakeDecimal(sum(UnscaledValue(ws_ext_sales_price#1777)),17,2) AS sales#36257, sum(coalesce(cast(wr_return_amt#2131 as decimal(12,2)), 0.00)) AS returns#36258, sum(CheckOverflow((promote_precision(cast(ws_net_profit#1787 as decimal(13,2))) - promote_precision(cast(coalesce(cast(wr_net_loss#2139 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2))) AS profit#36259, web channel AS channel#36273, concat(web_site, web_site_id#1649) AS id#36274]\n                  +- Project [ws_ext_sales_price#1777, ws_net_profit#1787, wr_return_amt#2131, wr_net_loss#2139, web_site_id#1649]\n                     +- Join Inner, (ws_promo_sk#1770 = p_promo_sk#1254)\n                        :- Project [ws_promo_sk#1770, ws_ext_sales_price#1777, ws_net_profit#1787, wr_return_amt#2131, wr_net_loss#2139, web_site_id#1649]\n                        :  +- Join Inner, (ws_item_sk#1757 = i_item_sk#1172)\n                        :     :- Project [ws_item_sk#1757, ws_promo_sk#1770, ws_ext_sales_price#1777, ws_net_profit#1787, wr_return_amt#2131, wr_net_loss#2139, web_site_id#1649]\n                        :     :  +- Join Inner, (ws_web_site_sk#1767 = web_site_sk#1648)\n                        :     :     :- Project [ws_item_sk#1757, ws_web_site_sk#1767, ws_promo_sk#1770, ws_ext_sales_price#1777, ws_net_profit#1787, wr_return_amt#2131, wr_net_loss#2139]\n                        :     :     :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                        :     :     :     :- Project [ws_item_sk#1757, ws_web_site_sk#1767, ws_promo_sk#1770, ws_ext_sales_price#1777, ws_net_profit#1787, ws_sold_date_sk#1788, wr_return_amt#2131, wr_net_loss#2139]\n                        :     :     :     :  +- Join LeftOuter, ((ws_item_sk#1757 = wr_item_sk#2118) && (ws_order_number#1771L = wr_order_number#2129L))\n                        :     :     :     :     :- Project [ws_item_sk#1757, ws_web_site_sk#1767, ws_promo_sk#1770, ws_order_number#1771L, ws_ext_sales_price#1777, ws_net_profit#1787, ws_sold_date_sk#1788]\n                        :     :     :     :     :  +- Filter (((isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_web_site_sk#1767)) && isnotnull(ws_item_sk#1757)) && isnotnull(ws_promo_sk#1770))\n                        :     :     :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        :     :     :     :     +- Project [wr_item_sk#2118, wr_order_number#2129L, wr_return_amt#2131, wr_net_loss#2139]\n                        :     :     :     :        +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n                        :     :     :     +- Project [d_date_sk#1040]\n                        :     :     :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11222)) && isnotnull(d_date_sk#1040))\n                        :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :     :     +- Project [web_site_sk#1648, web_site_id#1649]\n                        :     :        +- Filter isnotnull(web_site_sk#1648)\n                        :     :           +- Relation[web_site_sk#1648,web_site_id#1649,web_rec_start_date#1650,web_rec_end_date#1651,web_name#1652,web_open_date_sk#1653,web_close_date_sk#1654,web_class#1655,web_manager#1656,web_mkt_id#1657,web_mkt_class#1658,web_mkt_desc#1659,web_market_manager#1660,web_company_id#1661,web_company_name#1662,web_street_number#1663,web_street_name#1664,web_street_type#1665,web_suite_number#1666,web_city#1667,web_county#1668,web_state#1669,web_zip#1670,web_country#1671,... 2 more fields] parquet\n                        :     +- Project [i_item_sk#1172]\n                        :        +- Filter ((isnotnull(i_current_price#1177) && (i_current_price#1177 > 50.00)) && isnotnull(i_item_sk#1172))\n                        :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        +- Project [p_promo_sk#1254]\n                           +- Filter ((isnotnull(p_channel_tv#1265) && (p_channel_tv#1265 = N)) && isnotnull(p_promo_sk#1254))\n                              +- Relation[p_promo_sk#1254,p_promo_id#1255,p_start_date_sk#1256,p_end_date_sk#1257,p_item_sk#1258,p_cost#1259,p_response_target#1260,p_promo_name#1261,p_channel_dmail#1262,p_channel_email#1263,p_channel_catalog#1264,p_channel_tv#1265,p_channel_radio#1266,p_channel_press#1267,p_channel_event#1268,p_channel_demo#1269,p_channel_details#1270,p_purpose#1271,p_discount_active#1272] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[channel#36275 ASC NULLS FIRST,id#36276 ASC NULLS FIRST], output=[channel#36275,id#36276,sales#36246,returns#36247,profit#36248])\n+- *(32) HashAggregate(keys=[channel#36275, id#36276, spark_grouping_id#36272], functions=[sum(sales#36250), sum(returns#36251), sum(profit#36252)], output=[channel#36275, id#36276, sales#36246, returns#36247, profit#36248])\n   +- Exchange hashpartitioning(channel#36275, id#36276, spark_grouping_id#36272, 200)\n      +- *(31) HashAggregate(keys=[channel#36275, id#36276, spark_grouping_id#36272], functions=[partial_sum(sales#36250), partial_sum(returns#36251), partial_sum(profit#36252)], output=[channel#36275, id#36276, spark_grouping_id#36272, sum#36287, sum#36288, sum#36289])\n         +- *(31) Expand [List(sales#36250, returns#36251, profit#36252, channel#36273, id#36274, 0), List(sales#36250, returns#36251, profit#36252, channel#36273, null, 1), List(sales#36250, returns#36251, profit#36252, null, null, 3)], [sales#36250, returns#36251, profit#36252, channel#36275, id#36276, spark_grouping_id#36272]\n            +- Union\n               :- *(10) HashAggregate(keys=[s_store_id#1387], functions=[sum(UnscaledValue(ss_ext_sales_price#1918)), sum(coalesce(cast(sr_return_amt#1714 as decimal(12,2)), 0.00)), sum(CheckOverflow((promote_precision(cast(ss_net_profit#1925 as decimal(13,2))) - promote_precision(cast(coalesce(cast(sr_net_loss#1722 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2)))], output=[sales#36250, returns#36251, profit#36252, channel#36273, id#36274])\n               :  +- Exchange hashpartitioning(s_store_id#1387, 200)\n               :     +- *(9) HashAggregate(keys=[s_store_id#1387], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918)), partial_sum(coalesce(cast(sr_return_amt#1714 as decimal(12,2)), 0.00)), partial_sum(CheckOverflow((promote_precision(cast(ss_net_profit#1925 as decimal(13,2))) - promote_precision(cast(coalesce(cast(sr_net_loss#1722 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2)))], output=[s_store_id#1387, sum#36293L, sum#36294, sum#36295])\n               :        +- *(9) Project [ss_ext_sales_price#1918, ss_net_profit#1925, sr_return_amt#1714, sr_net_loss#1722, s_store_id#1387]\n               :           +- *(9) BroadcastHashJoin [ss_promo_sk#1911], [p_promo_sk#1254], Inner, BuildRight\n               :              :- *(9) Project [ss_promo_sk#1911, ss_ext_sales_price#1918, ss_net_profit#1925, sr_return_amt#1714, sr_net_loss#1722, s_store_id#1387]\n               :              :  +- *(9) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n               :              :     :- *(9) Project [ss_item_sk#1905, ss_promo_sk#1911, ss_ext_sales_price#1918, ss_net_profit#1925, sr_return_amt#1714, sr_net_loss#1722, s_store_id#1387]\n               :              :     :  +- *(9) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n               :              :     :     :- *(9) Project [ss_item_sk#1905, ss_store_sk#1910, ss_promo_sk#1911, ss_ext_sales_price#1918, ss_net_profit#1925, sr_return_amt#1714, sr_net_loss#1722]\n               :              :     :     :  +- *(9) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n               :              :     :     :     :- *(9) Project [ss_item_sk#1905, ss_store_sk#1910, ss_promo_sk#1911, ss_ext_sales_price#1918, ss_net_profit#1925, ss_sold_date_sk#1926, sr_return_amt#1714, sr_net_loss#1722]\n               :              :     :     :     :  +- SortMergeJoin [ss_item_sk#1905, ss_ticket_number#1912L], [sr_item_sk#1705, sr_ticket_number#1712L], LeftOuter\n               :              :     :     :     :     :- *(2) Sort [ss_item_sk#1905 ASC NULLS FIRST, ss_ticket_number#1912L ASC NULLS FIRST], false, 0\n               :              :     :     :     :     :  +- Exchange hashpartitioning(ss_item_sk#1905, ss_ticket_number#1912L, 200)\n               :              :     :     :     :     :     +- *(1) Project [ss_item_sk#1905, ss_store_sk#1910, ss_promo_sk#1911, ss_ticket_number#1912L, ss_ext_sales_price#1918, ss_net_profit#1925, ss_sold_date_sk#1926]\n               :              :     :     :     :     :        +- *(1) Filter ((isnotnull(ss_store_sk#1910) && isnotnull(ss_item_sk#1905)) && isnotnull(ss_promo_sk#1911))\n               :              :     :     :     :     :           +- *(1) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_ext_sales_price#1918,ss_net_profit#1925,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_item_sk), IsNotNull(ss_promo_sk)], ReadSchema: struct<ss_item_sk:int,ss_store_sk:int,ss_promo_sk:int,ss_ticket_number:bigint,ss_ext_sales_price:...\n               :              :     :     :     :     +- *(4) Sort [sr_item_sk#1705 ASC NULLS FIRST, sr_ticket_number#1712L ASC NULLS FIRST], false, 0\n               :              :     :     :     :        +- Exchange hashpartitioning(sr_item_sk#1705, sr_ticket_number#1712L, 200)\n               :              :     :     :     :           +- *(3) Project [sr_item_sk#1705, sr_ticket_number#1712L, sr_return_amt#1714, sr_net_loss#1722]\n               :              :     :     :     :              +- *(3) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_ticket_number#1712L,sr_return_amt#1714,sr_net_loss#1722,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns], PartitionCount: 2002, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint,sr_return_amt:decimal(7,2),sr_net_loss:decimal(7,2)>\n               :              :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :              :     :     :        +- *(5) Project [d_date_sk#1040]\n               :              :     :     :           +- *(5) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11192)) && (d_date#1042 <= 11222)) && isnotnull(d_date_sk#1040))\n               :              :     :     :              +- *(5) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2000-08-23), LessThanOrEqual(d_date,2000-09-22), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>\n               :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :              :     :        +- *(6) Project [s_store_sk#1386, s_store_id#1387]\n               :              :     :           +- *(6) Filter isnotnull(s_store_sk#1386)\n               :              :     :              +- *(6) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_id#1387] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_store_id:string>\n               :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :              :        +- *(7) Project [i_item_sk#1172]\n               :              :           +- *(7) Filter ((isnotnull(i_current_price#1177) && (i_current_price#1177 > 50.00)) && isnotnull(i_item_sk#1172))\n               :              :              +- *(7) FileScan parquet db_tpcds.item[i_item_sk#1172,i_current_price#1177] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThan(i_current_price,50.00), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_current_price:decimal(7,2)>\n               :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                 +- *(8) Project [p_promo_sk#1254]\n               :                    +- *(8) Filter ((isnotnull(p_channel_tv#1265) && (p_channel_tv#1265 = N)) && isnotnull(p_promo_sk#1254))\n               :                       +- *(8) FileScan parquet db_tpcds.promotion[p_promo_sk#1254,p_channel_tv#1265] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/promotion], PartitionFilters: [], PushedFilters: [IsNotNull(p_channel_tv), EqualTo(p_channel_tv,N), IsNotNull(p_promo_sk)], ReadSchema: struct<p_promo_sk:int,p_channel_tv:string>\n               :- *(20) HashAggregate(keys=[cp_catalog_page_id#807], functions=[sum(UnscaledValue(cs_ext_sales_price#1811)), sum(coalesce(cast(cr_return_amount#2103 as decimal(12,2)), 0.00)), sum(CheckOverflow((promote_precision(cast(cs_net_profit#1821 as decimal(13,2))) - promote_precision(cast(coalesce(cast(cr_net_loss#2111 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2)))], output=[sales#36254, returns#36255, profit#36256, channel#36273, id#36274])\n               :  +- Exchange hashpartitioning(cp_catalog_page_id#807, 200)\n               :     +- *(19) HashAggregate(keys=[cp_catalog_page_id#807], functions=[partial_sum(UnscaledValue(cs_ext_sales_price#1811)), partial_sum(coalesce(cast(cr_return_amount#2103 as decimal(12,2)), 0.00)), partial_sum(CheckOverflow((promote_precision(cast(cs_net_profit#1821 as decimal(13,2))) - promote_precision(cast(coalesce(cast(cr_net_loss#2111 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2)))], output=[cp_catalog_page_id#807, sum#36299L, sum#36300, sum#36301])\n               :        +- *(19) Project [cs_ext_sales_price#1811, cs_net_profit#1821, cr_return_amount#2103, cr_net_loss#2111, cp_catalog_page_id#807]\n               :           +- *(19) BroadcastHashJoin [cs_promo_sk#1804], [p_promo_sk#1254], Inner, BuildRight\n               :              :- *(19) Project [cs_promo_sk#1804, cs_ext_sales_price#1811, cs_net_profit#1821, cr_return_amount#2103, cr_net_loss#2111, cp_catalog_page_id#807]\n               :              :  +- *(19) BroadcastHashJoin [cs_item_sk#1803], [i_item_sk#1172], Inner, BuildRight\n               :              :     :- *(19) Project [cs_item_sk#1803, cs_promo_sk#1804, cs_ext_sales_price#1811, cs_net_profit#1821, cr_return_amount#2103, cr_net_loss#2111, cp_catalog_page_id#807]\n               :              :     :  +- *(19) BroadcastHashJoin [cs_catalog_page_sk#1800], [cp_catalog_page_sk#806], Inner, BuildRight\n               :              :     :     :- *(19) Project [cs_catalog_page_sk#1800, cs_item_sk#1803, cs_promo_sk#1804, cs_ext_sales_price#1811, cs_net_profit#1821, cr_return_amount#2103, cr_net_loss#2111]\n               :              :     :     :  +- *(19) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n               :              :     :     :     :- *(19) Project [cs_catalog_page_sk#1800, cs_item_sk#1803, cs_promo_sk#1804, cs_ext_sales_price#1811, cs_net_profit#1821, cs_sold_date_sk#1822, cr_return_amount#2103, cr_net_loss#2111]\n               :              :     :     :     :  +- SortMergeJoin [cs_item_sk#1803, cs_order_number#1805L], [cr_item_sk#2087, cr_order_number#2101L], LeftOuter\n               :              :     :     :     :     :- *(12) Sort [cs_item_sk#1803 ASC NULLS FIRST, cs_order_number#1805L ASC NULLS FIRST], false, 0\n               :              :     :     :     :     :  +- Exchange hashpartitioning(cs_item_sk#1803, cs_order_number#1805L, 200)\n               :              :     :     :     :     :     +- *(11) Project [cs_catalog_page_sk#1800, cs_item_sk#1803, cs_promo_sk#1804, cs_order_number#1805L, cs_ext_sales_price#1811, cs_net_profit#1821, cs_sold_date_sk#1822]\n               :              :     :     :     :     :        +- *(11) Filter ((isnotnull(cs_catalog_page_sk#1800) && isnotnull(cs_item_sk#1803)) && isnotnull(cs_promo_sk#1804))\n               :              :     :     :     :     :           +- *(11) FileScan parquet db_tpcds.catalog_sales[cs_catalog_page_sk#1800,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_ext_sales_price#1811,cs_net_profit#1821,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_catalog_page_sk), IsNotNull(cs_item_sk), IsNotNull(cs_promo_sk)], ReadSchema: struct<cs_catalog_page_sk:int,cs_item_sk:int,cs_promo_sk:int,cs_order_number:bigint,cs_ext_sales_...\n               :              :     :     :     :     +- *(14) Sort [cr_item_sk#2087 ASC NULLS FIRST, cr_order_number#2101L ASC NULLS FIRST], false, 0\n               :              :     :     :     :        +- Exchange hashpartitioning(cr_item_sk#2087, cr_order_number#2101L, 200)\n               :              :     :     :     :           +- *(13) Project [cr_item_sk#2087, cr_order_number#2101L, cr_return_amount#2103, cr_net_loss#2111]\n               :              :     :     :     :              +- *(13) FileScan parquet db_tpcds.catalog_returns[cr_item_sk#2087,cr_order_number#2101L,cr_return_amount#2103,cr_net_loss#2111,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns], PartitionCount: 2066, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<cr_item_sk:int,cr_order_number:bigint,cr_return_amount:decimal(7,2),cr_net_loss:decimal(7,2)>\n               :              :     :     :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :              :     :        +- *(16) Project [cp_catalog_page_sk#806, cp_catalog_page_id#807]\n               :              :     :           +- *(16) Filter isnotnull(cp_catalog_page_sk#806)\n               :              :     :              +- *(16) FileScan parquet db_tpcds.catalog_page[cp_catalog_page_sk#806,cp_catalog_page_id#807] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_page], PartitionFilters: [], PushedFilters: [IsNotNull(cp_catalog_page_sk)], ReadSchema: struct<cp_catalog_page_sk:int,cp_catalog_page_id:string>\n               :              :     +- ReusedExchange [i_item_sk#1172], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :              +- ReusedExchange [p_promo_sk#1254], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               +- *(30) HashAggregate(keys=[web_site_id#1649], functions=[sum(UnscaledValue(ws_ext_sales_price#1777)), sum(coalesce(cast(wr_return_amt#2131 as decimal(12,2)), 0.00)), sum(CheckOverflow((promote_precision(cast(ws_net_profit#1787 as decimal(13,2))) - promote_precision(cast(coalesce(cast(wr_net_loss#2139 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2)))], output=[sales#36257, returns#36258, profit#36259, channel#36273, id#36274])\n                  +- Exchange hashpartitioning(web_site_id#1649, 200)\n                     +- *(29) HashAggregate(keys=[web_site_id#1649], functions=[partial_sum(UnscaledValue(ws_ext_sales_price#1777)), partial_sum(coalesce(cast(wr_return_amt#2131 as decimal(12,2)), 0.00)), partial_sum(CheckOverflow((promote_precision(cast(ws_net_profit#1787 as decimal(13,2))) - promote_precision(cast(coalesce(cast(wr_net_loss#2139 as decimal(12,2)), 0.00) as decimal(13,2)))), DecimalType(13,2)))], output=[web_site_id#1649, sum#36305L, sum#36306, sum#36307])\n                        +- *(29) Project [ws_ext_sales_price#1777, ws_net_profit#1787, wr_return_amt#2131, wr_net_loss#2139, web_site_id#1649]\n                           +- *(29) BroadcastHashJoin [ws_promo_sk#1770], [p_promo_sk#1254], Inner, BuildRight\n                              :- *(29) Project [ws_promo_sk#1770, ws_ext_sales_price#1777, ws_net_profit#1787, wr_return_amt#2131, wr_net_loss#2139, web_site_id#1649]\n                              :  +- *(29) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n                              :     :- *(29) Project [ws_item_sk#1757, ws_promo_sk#1770, ws_ext_sales_price#1777, ws_net_profit#1787, wr_return_amt#2131, wr_net_loss#2139, web_site_id#1649]\n                              :     :  +- *(29) BroadcastHashJoin [ws_web_site_sk#1767], [web_site_sk#1648], Inner, BuildRight\n                              :     :     :- *(29) Project [ws_item_sk#1757, ws_web_site_sk#1767, ws_promo_sk#1770, ws_ext_sales_price#1777, ws_net_profit#1787, wr_return_amt#2131, wr_net_loss#2139]\n                              :     :     :  +- *(29) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                              :     :     :     :- *(29) Project [ws_item_sk#1757, ws_web_site_sk#1767, ws_promo_sk#1770, ws_ext_sales_price#1777, ws_net_profit#1787, ws_sold_date_sk#1788, wr_return_amt#2131, wr_net_loss#2139]\n                              :     :     :     :  +- SortMergeJoin [ws_item_sk#1757, ws_order_number#1771L], [wr_item_sk#2118, wr_order_number#2129L], LeftOuter\n                              :     :     :     :     :- *(22) Sort [ws_item_sk#1757 ASC NULLS FIRST, ws_order_number#1771L ASC NULLS FIRST], false, 0\n                              :     :     :     :     :  +- Exchange hashpartitioning(ws_item_sk#1757, ws_order_number#1771L, 200)\n                              :     :     :     :     :     +- *(21) Project [ws_item_sk#1757, ws_web_site_sk#1767, ws_promo_sk#1770, ws_order_number#1771L, ws_ext_sales_price#1777, ws_net_profit#1787, ws_sold_date_sk#1788]\n                              :     :     :     :     :        +- *(21) Filter ((isnotnull(ws_web_site_sk#1767) && isnotnull(ws_item_sk#1757)) && isnotnull(ws_promo_sk#1770))\n                              :     :     :     :     :           +- *(21) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_web_site_sk#1767,ws_promo_sk#1770,ws_order_number#1771L,ws_ext_sales_price#1777,ws_net_profit#1787,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_web_site_sk), IsNotNull(ws_item_sk), IsNotNull(ws_promo_sk)], ReadSchema: struct<ws_item_sk:int,ws_web_site_sk:int,ws_promo_sk:int,ws_order_number:bigint,ws_ext_sales_pric...\n                              :     :     :     :     +- *(24) Sort [wr_item_sk#2118 ASC NULLS FIRST, wr_order_number#2129L ASC NULLS FIRST], false, 0\n                              :     :     :     :        +- Exchange hashpartitioning(wr_item_sk#2118, wr_order_number#2129L, 200)\n                              :     :     :     :           +- *(23) Project [wr_item_sk#2118, wr_order_number#2129L, wr_return_amt#2131, wr_net_loss#2139]\n                              :     :     :     :              +- *(23) FileScan parquet db_tpcds.web_returns[wr_item_sk#2118,wr_order_number#2129L,wr_return_amt#2131,wr_net_loss#2139,wr_returned_date_sk#2140] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_returns], PartitionCount: 2110, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<wr_item_sk:int,wr_order_number:bigint,wr_return_amt:decimal(7,2),wr_net_loss:decimal(7,2)>\n                              :     :     :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :        +- *(26) Project [web_site_sk#1648, web_site_id#1649]\n                              :     :           +- *(26) Filter isnotnull(web_site_sk#1648)\n                              :     :              +- *(26) FileScan parquet db_tpcds.web_site[web_site_sk#1648,web_site_id#1649] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_site], PartitionFilters: [], PushedFilters: [IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:int,web_site_id:string>\n                              :     +- ReusedExchange [i_item_sk#1172], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              +- ReusedExchange [p_promo_sk#1254], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q81-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["customer_total_return","customer_address","customer"],"parsingTime":0.002661,"analysisTime":9.95E-4,"optimizationTime":571.855636,"planningTime":38.547111,"executionTime":8723.441529,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [customer_total_return]\n:  +- 'SubqueryAlias customer_total_return\n:     +- 'Aggregate ['cr_returning_customer_sk, 'ca_state], ['cr_returning_customer_sk AS ctr_customer_sk#36388, 'ca_state AS ctr_state#36389, 'sum('cr_return_amt_inc_tax) AS ctr_total_return#36390]\n:        +- 'Filter ((('cr_returned_date_sk = 'd_date_sk) && ('d_year = 2000)) && ('cr_returning_addr_sk = 'ca_address_sk))\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'UnresolvedRelation `catalog_returns`\n:              :  +- 'UnresolvedRelation `date_dim`\n:              +- 'UnresolvedRelation `customer_address`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['c_customer_id ASC NULLS FIRST, 'c_salutation ASC NULLS FIRST, 'c_first_name ASC NULLS FIRST, 'c_last_name ASC NULLS FIRST, 'ca_street_number ASC NULLS FIRST, 'ca_street_name ASC NULLS FIRST, 'ca_street_type ASC NULLS FIRST, 'ca_suite_number ASC NULLS FIRST, 'ca_city ASC NULLS FIRST, 'ca_county ASC NULLS FIRST, 'ca_state ASC NULLS FIRST, 'ca_zip ASC NULLS FIRST, 'ca_country ASC NULLS FIRST, 'ca_gmt_offset ASC NULLS FIRST, 'ca_location_type ASC NULLS FIRST, 'ctr_total_return ASC NULLS FIRST], true\n         +- 'Project ['c_customer_id, 'c_salutation, 'c_first_name, 'c_last_name, 'ca_street_number, 'ca_street_name, 'ca_street_type, 'ca_suite_number, 'ca_city, 'ca_county, 'ca_state, 'ca_zip, 'ca_country, 'ca_gmt_offset, 'ca_location_type, 'ctr_total_return]\n            +- 'Filter ((('ctr1.ctr_total_return > scalar-subquery#36387 []) && ('ca_address_sk = 'c_current_addr_sk)) && (('ca_state = GA) && ('ctr1.ctr_customer_sk = 'c_customer_sk)))\n               :  +- 'Project [unresolvedalias(('avg('ctr_total_return) * 1.2), None)]\n               :     +- 'Filter ('ctr1.ctr_state = 'ctr2.ctr_state)\n               :        +- 'SubqueryAlias ctr2\n               :           +- 'UnresolvedRelation `customer_total_return`\n               +- 'Join Inner\n                  :- 'Join Inner\n                  :  :- 'SubqueryAlias ctr1\n                  :  :  +- 'UnresolvedRelation `customer_total_return`\n                  :  +- 'UnresolvedRelation `customer_address`\n                  +- 'UnresolvedRelation `customer`\n\n== Analyzed Logical Plan ==\nc_customer_id: string, c_salutation: string, c_first_name: string, c_last_name: string, ca_street_number: string, ca_street_name: string, ca_street_type: string, ca_suite_number: string, ca_city: string, ca_county: string, ca_state: string, ca_zip: string, ca_country: string, ca_gmt_offset: decimal(5,2), ca_location_type: string, ctr_total_return: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [c_customer_id#861 ASC NULLS FIRST, c_salutation#867 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, c_last_name#869 ASC NULLS FIRST, ca_street_number#924 ASC NULLS FIRST, ca_street_name#925 ASC NULLS FIRST, ca_street_type#926 ASC NULLS FIRST, ca_suite_number#927 ASC NULLS FIRST, ca_city#928 ASC NULLS FIRST, ca_county#929 ASC NULLS FIRST, ca_state#930 ASC NULLS FIRST, ca_zip#931 ASC NULLS FIRST, ca_country#932 ASC NULLS FIRST, ca_gmt_offset#933 ASC NULLS FIRST, ca_location_type#934 ASC NULLS FIRST, ctr_total_return#36390 ASC NULLS FIRST], true\n      +- Project [c_customer_id#861, c_salutation#867, c_first_name#868, c_last_name#869, ca_street_number#924, ca_street_name#925, ca_street_type#926, ca_suite_number#927, ca_city#928, ca_county#929, ca_state#930, ca_zip#931, ca_country#932, ca_gmt_offset#933, ca_location_type#934, ctr_total_return#36390]\n         +- Filter (((cast(ctr_total_return#36390 as decimal(24,7)) > cast(scalar-subquery#36387 [ctr_state#36389] as decimal(24,7))) && (ca_address_sk#922 = c_current_addr_sk#864)) && ((ca_state#930 = GA) && (ctr_customer_sk#36388 = c_customer_sk#860)))\n            :  +- Aggregate [CheckOverflow((promote_precision(cast(avg(ctr_total_return#36390) as decimal(21,6))) * promote_precision(cast(1.2 as decimal(21,6)))), DecimalType(24,7)) AS (CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#36393]\n            :     +- Filter (outer(ctr_state#36389) = ctr_state#36389)\n            :        +- SubqueryAlias ctr2\n            :           +- SubqueryAlias customer_total_return\n            :              +- Aggregate [cr_returning_customer_sk#2092, ca_state#930], [cr_returning_customer_sk#2092 AS ctr_customer_sk#36388, ca_state#930 AS ctr_state#36389, sum(cr_return_amt_inc_tax#2105) AS ctr_total_return#36390]\n            :                 +- Filter (((cr_returned_date_sk#2112 = d_date_sk#1040) && (d_year#1046 = 2000)) && (cr_returning_addr_sk#2095 = ca_address_sk#922))\n            :                    +- Join Inner\n            :                       :- Join Inner\n            :                       :  :- SubqueryAlias catalog_returns\n            :                       :  :  +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n            :                       :  +- SubqueryAlias date_dim\n            :                       :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :                       +- SubqueryAlias customer_address\n            :                          +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias ctr1\n               :  :  +- SubqueryAlias customer_total_return\n               :  :     +- Aggregate [cr_returning_customer_sk#2092, ca_state#930], [cr_returning_customer_sk#2092 AS ctr_customer_sk#36388, ca_state#930 AS ctr_state#36389, sum(cr_return_amt_inc_tax#2105) AS ctr_total_return#36390]\n               :  :        +- Filter (((cr_returned_date_sk#2112 = d_date_sk#1040) && (d_year#1046 = 2000)) && (cr_returning_addr_sk#2095 = ca_address_sk#922))\n               :  :           +- Join Inner\n               :  :              :- Join Inner\n               :  :              :  :- SubqueryAlias catalog_returns\n               :  :              :  :  +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n               :  :              :  +- SubqueryAlias date_dim\n               :  :              :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :              +- SubqueryAlias customer_address\n               :  :                 +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               :  +- SubqueryAlias customer_address\n               :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- SubqueryAlias customer\n                  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [c_customer_id#861 ASC NULLS FIRST, c_salutation#867 ASC NULLS FIRST, c_first_name#868 ASC NULLS FIRST, c_last_name#869 ASC NULLS FIRST, ca_street_number#924 ASC NULLS FIRST, ca_street_name#925 ASC NULLS FIRST, ca_street_type#926 ASC NULLS FIRST, ca_suite_number#927 ASC NULLS FIRST, ca_city#928 ASC NULLS FIRST, ca_county#929 ASC NULLS FIRST, ca_state#930 ASC NULLS FIRST, ca_zip#931 ASC NULLS FIRST, ca_country#932 ASC NULLS FIRST, ca_gmt_offset#933 ASC NULLS FIRST, ca_location_type#934 ASC NULLS FIRST, ctr_total_return#36390 ASC NULLS FIRST], true\n      +- Project [c_customer_id#861, c_salutation#867, c_first_name#868, c_last_name#869, ca_street_number#924, ca_street_name#925, ca_street_type#926, ca_suite_number#927, ca_city#928, ca_county#929, ca_state#930, ca_zip#931, ca_country#932, ca_gmt_offset#933, ca_location_type#934, ctr_total_return#36390]\n         +- Join Inner, (ca_address_sk#922 = c_current_addr_sk#864)\n            :- Project [ctr_total_return#36390, c_customer_id#861, c_current_addr_sk#864, c_salutation#867, c_first_name#868, c_last_name#869]\n            :  +- Join Inner, (ctr_customer_sk#36388 = c_customer_sk#860)\n            :     :- Project [ctr_customer_sk#36388, ctr_total_return#36390]\n            :     :  +- Join Inner, ((cast(ctr_total_return#36390 as decimal(24,7)) > (CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#36393) && (ctr_state#36389 = ctr_state#36389#36410))\n            :     :     :- Filter isnotnull(ctr_total_return#36390)\n            :     :     :  +- Aggregate [cr_returning_customer_sk#2092, ca_state#930], [cr_returning_customer_sk#2092 AS ctr_customer_sk#36388, ca_state#930 AS ctr_state#36389, MakeDecimal(sum(UnscaledValue(cr_return_amt_inc_tax#2105)),17,2) AS ctr_total_return#36390]\n            :     :     :     +- Project [cr_returning_customer_sk#2092, cr_return_amt_inc_tax#2105, ca_state#930]\n            :     :     :        +- Join Inner, (cr_returning_addr_sk#2095 = ca_address_sk#922)\n            :     :     :           :- Project [cr_returning_customer_sk#2092, cr_returning_addr_sk#2095, cr_return_amt_inc_tax#2105]\n            :     :     :           :  +- Join Inner, (cr_returned_date_sk#2112 = d_date_sk#1040)\n            :     :     :           :     :- Project [cr_returning_customer_sk#2092, cr_returning_addr_sk#2095, cr_return_amt_inc_tax#2105, cr_returned_date_sk#2112]\n            :     :     :           :     :  +- Filter ((isnotnull(cr_returned_date_sk#2112) && isnotnull(cr_returning_addr_sk#2095)) && isnotnull(cr_returning_customer_sk#2092))\n            :     :     :           :     :     +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n            :     :     :           :     +- Project [d_date_sk#1040]\n            :     :     :           :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n            :     :     :           :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :     :           +- Project [ca_address_sk#922, ca_state#930]\n            :     :     :              +- Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_state#930))\n            :     :     :                 +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :     :     +- Filter isnotnull((CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#36393)\n            :     :        +- Aggregate [ctr_state#36389], [CheckOverflow((promote_precision(avg(ctr_total_return#36390)) * 1.200000), DecimalType(24,7)) AS (CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#36393, ctr_state#36389 AS ctr_state#36389#36410]\n            :     :           +- Aggregate [cr_returning_customer_sk#2092, ca_state#930], [ca_state#930 AS ctr_state#36389, MakeDecimal(sum(UnscaledValue(cr_return_amt_inc_tax#2105)),17,2) AS ctr_total_return#36390]\n            :     :              +- Project [cr_returning_customer_sk#2092, cr_return_amt_inc_tax#2105, ca_state#930]\n            :     :                 +- Join Inner, (cr_returning_addr_sk#2095 = ca_address_sk#922)\n            :     :                    :- Project [cr_returning_customer_sk#2092, cr_returning_addr_sk#2095, cr_return_amt_inc_tax#2105]\n            :     :                    :  +- Join Inner, (cr_returned_date_sk#2112 = d_date_sk#1040)\n            :     :                    :     :- Project [cr_returning_customer_sk#2092, cr_returning_addr_sk#2095, cr_return_amt_inc_tax#2105, cr_returned_date_sk#2112]\n            :     :                    :     :  +- Filter (isnotnull(cr_returned_date_sk#2112) && isnotnull(cr_returning_addr_sk#2095))\n            :     :                    :     :     +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n            :     :                    :     +- Project [d_date_sk#1040]\n            :     :                    :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n            :     :                    :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :                    +- Project [ca_address_sk#922, ca_state#930]\n            :     :                       +- Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_state#930))\n            :     :                          +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :     +- Project [c_customer_sk#860, c_customer_id#861, c_current_addr_sk#864, c_salutation#867, c_first_name#868, c_last_name#869]\n            :        +- Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n            :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            +- Project [ca_address_sk#922, ca_street_number#924, ca_street_name#925, ca_street_type#926, ca_suite_number#927, ca_city#928, ca_county#929, ca_state#930, ca_zip#931, ca_country#932, ca_gmt_offset#933, ca_location_type#934]\n               +- Filter ((isnotnull(ca_state#930) && (ca_state#930 = GA)) && isnotnull(ca_address_sk#922))\n                  +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[c_customer_id#861 ASC NULLS FIRST,c_salutation#867 ASC NULLS FIRST,c_first_name#868 ASC NULLS FIRST,c_last_name#869 ASC NULLS FIRST,ca_street_number#924 ASC NULLS FIRST,ca_street_name#925 ASC NULLS FIRST,ca_street_type#926 ASC NULLS FIRST,ca_suite_number#927 ASC NULLS FIRST,ca_city#928 ASC NULLS FIRST,ca_county#929 ASC NULLS FIRST,ca_state#930 ASC NULLS FIRST,ca_zip#931 ASC NULLS FIRST,ca_country#932 ASC NULLS FIRST,ca_gmt_offset#933 ASC NULLS FIRST,ca_location_type#934 ASC NULLS FIRST,ctr_total_return#36390 ASC NULLS FIRST], output=[c_customer_id#861,c_salutation#867,c_first_name#868,c_last_name#869,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934,ctr_total_return#36390])\n+- *(14) Project [c_customer_id#861, c_salutation#867, c_first_name#868, c_last_name#869, ca_street_number#924, ca_street_name#925, ca_street_type#926, ca_suite_number#927, ca_city#928, ca_county#929, ca_state#930, ca_zip#931, ca_country#932, ca_gmt_offset#933, ca_location_type#934, ctr_total_return#36390]\n   +- *(14) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n      :- *(14) Project [ctr_total_return#36390, c_customer_id#861, c_current_addr_sk#864, c_salutation#867, c_first_name#868, c_last_name#869]\n      :  +- *(14) BroadcastHashJoin [ctr_customer_sk#36388], [c_customer_sk#860], Inner, BuildRight\n      :     :- *(14) Project [ctr_customer_sk#36388, ctr_total_return#36390]\n      :     :  +- *(14) SortMergeJoin [ctr_state#36389], [ctr_state#36389#36410], Inner, (cast(ctr_total_return#36390 as decimal(24,7)) > (CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#36393)\n      :     :     :- *(5) Sort [ctr_state#36389 ASC NULLS FIRST], false, 0\n      :     :     :  +- Exchange hashpartitioning(ctr_state#36389, 200)\n      :     :     :     +- *(4) Filter isnotnull(ctr_total_return#36390)\n      :     :     :        +- *(4) HashAggregate(keys=[cr_returning_customer_sk#2092, ca_state#930], functions=[sum(UnscaledValue(cr_return_amt_inc_tax#2105))], output=[ctr_customer_sk#36388, ctr_state#36389, ctr_total_return#36390])\n      :     :     :           +- Exchange hashpartitioning(cr_returning_customer_sk#2092, ca_state#930, 200)\n      :     :     :              +- *(3) HashAggregate(keys=[cr_returning_customer_sk#2092, ca_state#930], functions=[partial_sum(UnscaledValue(cr_return_amt_inc_tax#2105))], output=[cr_returning_customer_sk#2092, ca_state#930, sum#36412L])\n      :     :     :                 +- *(3) Project [cr_returning_customer_sk#2092, cr_return_amt_inc_tax#2105, ca_state#930]\n      :     :     :                    +- *(3) BroadcastHashJoin [cr_returning_addr_sk#2095], [ca_address_sk#922], Inner, BuildRight\n      :     :     :                       :- *(3) Project [cr_returning_customer_sk#2092, cr_returning_addr_sk#2095, cr_return_amt_inc_tax#2105]\n      :     :     :                       :  +- *(3) BroadcastHashJoin [cr_returned_date_sk#2112], [d_date_sk#1040], Inner, BuildRight\n      :     :     :                       :     :- *(3) Project [cr_returning_customer_sk#2092, cr_returning_addr_sk#2095, cr_return_amt_inc_tax#2105, cr_returned_date_sk#2112]\n      :     :     :                       :     :  +- *(3) Filter (isnotnull(cr_returning_addr_sk#2095) && isnotnull(cr_returning_customer_sk#2092))\n      :     :     :                       :     :     +- *(3) FileScan parquet db_tpcds.catalog_returns[cr_returning_customer_sk#2092,cr_returning_addr_sk#2095,cr_return_amt_inc_tax#2105,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns/c..., PartitionCount: 2066, PartitionFilters: [isnotnull(cr_returned_date_sk#2112)], PushedFilters: [IsNotNull(cr_returning_addr_sk), IsNotNull(cr_returning_customer_sk)], ReadSchema: struct<cr_returning_customer_sk:int,cr_returning_addr_sk:int,cr_return_amt_inc_tax:decimal(7,2)>\n      :     :     :                       :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :     :                       :        +- *(1) Project [d_date_sk#1040]\n      :     :     :                       :           +- *(1) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n      :     :     :                       :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n      :     :     :                       +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :     :                          +- *(2) Project [ca_address_sk#922, ca_state#930]\n      :     :     :                             +- *(2) Filter (isnotnull(ca_address_sk#922) && isnotnull(ca_state#930))\n      :     :     :                                +- *(2) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_address_sk), IsNotNull(ca_state)], ReadSchema: struct<ca_address_sk:int,ca_state:string>\n      :     :     +- *(11) Sort [ctr_state#36389#36410 ASC NULLS FIRST], false, 0\n      :     :        +- Exchange hashpartitioning(ctr_state#36389#36410, 200)\n      :     :           +- *(10) Filter isnotnull((CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#36393)\n      :     :              +- *(10) HashAggregate(keys=[ctr_state#36389], functions=[avg(ctr_total_return#36390)], output=[(CAST(avg(ctr_total_return) AS DECIMAL(21,6)) * CAST(1.2 AS DECIMAL(21,6)))#36393, ctr_state#36389#36410])\n      :     :                 +- Exchange hashpartitioning(ctr_state#36389, 200)\n      :     :                    +- *(9) HashAggregate(keys=[ctr_state#36389], functions=[partial_avg(ctr_total_return#36390)], output=[ctr_state#36389, sum#36415, count#36416L])\n      :     :                       +- *(9) HashAggregate(keys=[cr_returning_customer_sk#2092, ca_state#930], functions=[sum(UnscaledValue(cr_return_amt_inc_tax#2105))], output=[ctr_state#36389, ctr_total_return#36390])\n      :     :                          +- Exchange hashpartitioning(cr_returning_customer_sk#2092, ca_state#930, 200)\n      :     :                             +- *(8) HashAggregate(keys=[cr_returning_customer_sk#2092, ca_state#930], functions=[partial_sum(UnscaledValue(cr_return_amt_inc_tax#2105))], output=[cr_returning_customer_sk#2092, ca_state#930, sum#36418L])\n      :     :                                +- *(8) Project [cr_returning_customer_sk#2092, cr_return_amt_inc_tax#2105, ca_state#930]\n      :     :                                   +- *(8) BroadcastHashJoin [cr_returning_addr_sk#2095], [ca_address_sk#922], Inner, BuildRight\n      :     :                                      :- *(8) Project [cr_returning_customer_sk#2092, cr_returning_addr_sk#2095, cr_return_amt_inc_tax#2105]\n      :     :                                      :  +- *(8) BroadcastHashJoin [cr_returned_date_sk#2112], [d_date_sk#1040], Inner, BuildRight\n      :     :                                      :     :- *(8) Project [cr_returning_customer_sk#2092, cr_returning_addr_sk#2095, cr_return_amt_inc_tax#2105, cr_returned_date_sk#2112]\n      :     :                                      :     :  +- *(8) Filter isnotnull(cr_returning_addr_sk#2095)\n      :     :                                      :     :     +- *(8) FileScan parquet db_tpcds.catalog_returns[cr_returning_customer_sk#2092,cr_returning_addr_sk#2095,cr_return_amt_inc_tax#2105,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns/c..., PartitionCount: 2066, PartitionFilters: [isnotnull(cr_returned_date_sk#2112)], PushedFilters: [IsNotNull(cr_returning_addr_sk)], ReadSchema: struct<cr_returning_customer_sk:int,cr_returning_addr_sk:int,cr_return_amt_inc_tax:decimal(7,2)>\n      :     :                                      :     +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                                      +- ReusedExchange [ca_address_sk#922, ca_state#930], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :        +- *(12) Project [c_customer_sk#860, c_customer_id#861, c_current_addr_sk#864, c_salutation#867, c_first_name#868, c_last_name#869]\n      :           +- *(12) Filter (isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864))\n      :              +- *(12) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_customer_id#861,c_current_addr_sk#864,c_salutation#867,c_first_name#868,c_last_name#869] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk)], ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_current_addr_sk:int,c_salutation:string,c_first_n...\n      +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n         +- *(13) Project [ca_address_sk#922, ca_street_number#924, ca_street_name#925, ca_street_type#926, ca_suite_number#927, ca_city#928, ca_county#929, ca_state#930, ca_zip#931, ca_country#932, ca_gmt_offset#933, ca_location_type#934]\n            +- *(13) Filter ((isnotnull(ca_state#930) && (ca_state#930 = GA)) && isnotnull(ca_address_sk#922))\n               +- *(13) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_state), EqualTo(ca_state,GA), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_street_number:string,ca_street_name:string,ca_street_type:string,ca_s..."},{"name":"q82-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["item","inventory","date_dim","store_sales"],"parsingTime":0.002161,"analysisTime":0.001183,"optimizationTime":84.123091,"planningTime":261.524319,"executionTime":3252.636432,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['i_item_id ASC NULLS FIRST], true\n      +- 'Aggregate ['i_item_id, 'i_item_desc, 'i_current_price], ['i_item_id, 'i_item_desc, 'i_current_price]\n         +- 'Filter ((((('i_current_price >= 62) && ('i_current_price <= (62 + 30))) && ('inv_item_sk = 'i_item_sk)) && (('d_date_sk = 'inv_date_sk) && (('d_date >= cast(2000-05-25 as date)) && ('d_date <= (cast(2000-05-25 as date) + interval 8 weeks 4 days))))) && (('i_manufact_id IN (129,270,821,423) && (('inv_quantity_on_hand >= 100) && ('inv_quantity_on_hand <= 500))) && ('ss_item_sk = 'i_item_sk)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'UnresolvedRelation `item`\n               :  :  +- 'UnresolvedRelation `inventory`\n               :  +- 'UnresolvedRelation `date_dim`\n               +- 'UnresolvedRelation `store_sales`\n\n== Analyzed Logical Plan ==\ni_item_id: string, i_item_desc: string, i_current_price: decimal(7,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#1173 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173, i_item_desc#1176, i_current_price#1177], [i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n         +- Filter (((((cast(i_current_price#1177 as decimal(7,2)) >= cast(cast(62 as decimal(2,0)) as decimal(7,2))) && (cast(i_current_price#1177 as decimal(12,2)) <= cast(cast((62 + 30) as decimal(10,0)) as decimal(12,2)))) && (inv_item_sk#2865 = i_item_sk#1172)) && ((d_date_sk#1040 = inv_date_sk#2868) && ((d_date#1042 >= cast(2000-05-25 as date)) && (d_date#1042 <= cast(cast(cast(2000-05-25 as date) as timestamp) + interval 8 weeks 4 days as date))))) && ((i_manufact_id#1185 IN (129,270,821,423) && ((inv_quantity_on_hand#2867 >= 100) && (inv_quantity_on_hand#2867 <= 500))) && (ss_item_sk#1905 = i_item_sk#1172)))\n            +- Join Inner\n               :- Join Inner\n               :  :- Join Inner\n               :  :  :- SubqueryAlias item\n               :  :  :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  :  +- SubqueryAlias inventory\n               :  :     +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n               :  +- SubqueryAlias date_dim\n               :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- SubqueryAlias store_sales\n                  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [i_item_id#1173 ASC NULLS FIRST], true\n      +- Aggregate [i_item_id#1173, i_item_desc#1176, i_current_price#1177], [i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n         +- Project [i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n            +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n               :- Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n               :  +- Join Inner, (d_date_sk#1040 = inv_date_sk#2868)\n               :     :- Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177, inv_date_sk#2868]\n               :     :  +- Join Inner, (inv_item_sk#2865 = i_item_sk#1172)\n               :     :     :- Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n               :     :     :  +- Filter ((((isnotnull(i_current_price#1177) && (i_current_price#1177 >= 62.00)) && (cast(i_current_price#1177 as decimal(12,2)) <= 92.00)) && i_manufact_id#1185 IN (129,270,821,423)) && isnotnull(i_item_sk#1172))\n               :     :     :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :     :     +- Project [inv_item_sk#2865, inv_date_sk#2868]\n               :     :        +- Filter ((((isnotnull(inv_quantity_on_hand#2867) && (inv_quantity_on_hand#2867 >= 100)) && (inv_quantity_on_hand#2867 <= 500)) && isnotnull(inv_item_sk#2865)) && isnotnull(inv_date_sk#2868))\n               :     :           +- Relation[inv_item_sk#2865,inv_warehouse_sk#2866,inv_quantity_on_hand#2867,inv_date_sk#2868] parquet\n               :     +- Project [d_date_sk#1040]\n               :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11102)) && (d_date#1042 <= 11162)) && isnotnull(d_date_sk#1040))\n               :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- Project [ss_item_sk#1905]\n                  +- Filter isnotnull(ss_item_sk#1905)\n                     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[i_item_id#1173 ASC NULLS FIRST], output=[i_item_id#1173,i_item_desc#1176,i_current_price#1177])\n+- *(8) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, i_current_price#1177], functions=[], output=[i_item_id#1173, i_item_desc#1176, i_current_price#1177])\n   +- Exchange hashpartitioning(i_item_id#1173, i_item_desc#1176, i_current_price#1177, 200)\n      +- *(7) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, i_current_price#1177], functions=[], output=[i_item_id#1173, i_item_desc#1176, i_current_price#1177])\n         +- *(7) Project [i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n            +- *(7) SortMergeJoin [i_item_sk#1172], [ss_item_sk#1905], Inner\n               :- *(4) Sort [i_item_sk#1172 ASC NULLS FIRST], false, 0\n               :  +- Exchange hashpartitioning(i_item_sk#1172, 200)\n               :     +- *(3) Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n               :        +- *(3) BroadcastHashJoin [inv_date_sk#2868], [d_date_sk#1040], Inner, BuildRight\n               :           :- *(3) Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177, inv_date_sk#2868]\n               :           :  +- *(3) BroadcastHashJoin [i_item_sk#1172], [inv_item_sk#2865], Inner, BuildLeft\n               :           :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :           :     :  +- *(1) Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177]\n               :           :     :     +- *(1) Filter ((((isnotnull(i_current_price#1177) && (i_current_price#1177 >= 62.00)) && (cast(i_current_price#1177 as decimal(12,2)) <= 92.00)) && i_manufact_id#1185 IN (129,270,821,423)) && isnotnull(i_item_sk#1172))\n               :           :     :        +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173,i_item_desc#1176,i_current_price#1177,i_manufact_id#1185] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_current_price), GreaterThanOrEqual(i_current_price,62.00), In(i_manufact_id, [129,27..., ReadSchema: struct<i_item_sk:int,i_item_id:string,i_item_desc:string,i_current_price:decimal(7,2),i_manufact_...\n               :           :     +- *(3) Project [inv_item_sk#2865, inv_date_sk#2868]\n               :           :        +- *(3) Filter (((isnotnull(inv_quantity_on_hand#2867) && (inv_quantity_on_hand#2867 >= 100)) && (inv_quantity_on_hand#2867 <= 500)) && isnotnull(inv_item_sk#2865))\n               :           :           +- *(3) FileScan parquet db_tpcds.inventory[inv_item_sk#2865,inv_quantity_on_hand#2867,inv_date_sk#2868] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/inventory/inv_dat..., PartitionCount: 261, PartitionFilters: [isnotnull(inv_date_sk#2868)], PushedFilters: [IsNotNull(inv_quantity_on_hand), GreaterThanOrEqual(inv_quantity_on_hand,100), LessThanOrEqual(i..., ReadSchema: struct<inv_item_sk:int,inv_quantity_on_hand:int>\n               :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :              +- *(2) Project [d_date_sk#1040]\n               :                 +- *(2) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 11102)) && (d_date#1042 <= 11162)) && isnotnull(d_date_sk#1040))\n               :                    +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2000-05-25), LessThanOrEqual(d_date,2000-07-24), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>\n               +- *(6) Sort [ss_item_sk#1905 ASC NULLS FIRST], false, 0\n                  +- Exchange hashpartitioning(ss_item_sk#1905, 200)\n                     +- *(5) Project [ss_item_sk#1905]\n                        +- *(5) Filter isnotnull(ss_item_sk#1905)\n                           +- *(5) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int>"},{"name":"q83-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["sr_items","cr_items","wr_items"],"parsingTime":0.00185,"analysisTime":0.001216,"optimizationTime":804.678612,"planningTime":68.399907,"executionTime":8514.023607,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [sr_items, cr_items, wr_items]\n:  :- 'SubqueryAlias sr_items\n:  :  +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#36501, 'sum('sr_return_quantity) AS sr_item_qty#36502]\n:  :     +- 'Filter ((('sr_item_sk = 'i_item_sk) && 'd_date IN (list#36504 [])) && ('sr_returned_date_sk = 'd_date_sk))\n:  :        :  +- 'Project ['d_date]\n:  :        :     +- 'Filter 'd_week_seq IN (list#36503 [])\n:  :        :        :  +- 'Project ['d_week_seq]\n:  :        :        :     +- 'Filter 'd_date IN (cast(2000-06-30 as date),cast(2000-09-27 as date),cast(2000-11-17 as date))\n:  :        :        :        +- 'UnresolvedRelation `date_dim`\n:  :        :        +- 'UnresolvedRelation `date_dim`\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'UnresolvedRelation `store_returns`\n:  :           :  +- 'UnresolvedRelation `item`\n:  :           +- 'UnresolvedRelation `date_dim`\n:  :- 'SubqueryAlias cr_items\n:  :  +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#36505, 'sum('cr_return_quantity) AS cr_item_qty#36506]\n:  :     +- 'Filter ((('cr_item_sk = 'i_item_sk) && 'd_date IN (list#36508 [])) && ('cr_returned_date_sk = 'd_date_sk))\n:  :        :  +- 'Project ['d_date]\n:  :        :     +- 'Filter 'd_week_seq IN (list#36507 [])\n:  :        :        :  +- 'Project ['d_week_seq]\n:  :        :        :     +- 'Filter 'd_date IN (cast(2000-06-30 as date),cast(2000-09-27 as date),cast(2000-11-17 as date))\n:  :        :        :        +- 'UnresolvedRelation `date_dim`\n:  :        :        +- 'UnresolvedRelation `date_dim`\n:  :        +- 'Join Inner\n:  :           :- 'Join Inner\n:  :           :  :- 'UnresolvedRelation `catalog_returns`\n:  :           :  +- 'UnresolvedRelation `item`\n:  :           +- 'UnresolvedRelation `date_dim`\n:  +- 'SubqueryAlias wr_items\n:     +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#36509, 'sum('wr_return_quantity) AS wr_item_qty#36510]\n:        +- 'Filter ((('wr_item_sk = 'i_item_sk) && 'd_date IN (list#36512 [])) && ('wr_returned_date_sk = 'd_date_sk))\n:           :  +- 'Project ['d_date]\n:           :     +- 'Filter 'd_week_seq IN (list#36511 [])\n:           :        :  +- 'Project ['d_week_seq]\n:           :        :     +- 'Filter 'd_date IN (cast(2000-06-30 as date),cast(2000-09-27 as date),cast(2000-11-17 as date))\n:           :        :        +- 'UnresolvedRelation `date_dim`\n:           :        +- 'UnresolvedRelation `date_dim`\n:           +- 'Join Inner\n:              :- 'Join Inner\n:              :  :- 'UnresolvedRelation `web_returns`\n:              :  +- 'UnresolvedRelation `item`\n:              +- 'UnresolvedRelation `date_dim`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['sr_items.item_id ASC NULLS FIRST, 'sr_item_qty ASC NULLS FIRST], true\n         +- 'Project ['sr_items.item_id, 'sr_item_qty, ((('sr_item_qty / (('sr_item_qty + 'cr_item_qty) + 'wr_item_qty)) / 3.0) * 100) AS sr_dev#36497, 'cr_item_qty, ((('cr_item_qty / (('sr_item_qty + 'cr_item_qty) + 'wr_item_qty)) / 3.0) * 100) AS cr_dev#36498, 'wr_item_qty, ((('wr_item_qty / (('sr_item_qty + 'cr_item_qty) + 'wr_item_qty)) / 3.0) * 100) AS wr_dev#36499, ((('sr_item_qty + 'cr_item_qty) + 'wr_item_qty) / 3.0) AS average#36500]\n            +- 'Filter (('sr_items.item_id = 'cr_items.item_id) && ('sr_items.item_id = 'wr_items.item_id))\n               +- 'Join Inner\n                  :- 'Join Inner\n                  :  :- 'UnresolvedRelation `sr_items`\n                  :  +- 'UnresolvedRelation `cr_items`\n                  +- 'UnresolvedRelation `wr_items`\n\n== Analyzed Logical Plan ==\nitem_id: string, sr_item_qty: bigint, sr_dev: double, cr_item_qty: bigint, cr_dev: double, wr_item_qty: bigint, wr_dev: double, average: decimal(27,6)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [item_id#36501 ASC NULLS FIRST, sr_item_qty#36502L ASC NULLS FIRST], true\n      +- Project [item_id#36501, sr_item_qty#36502L, (((cast(sr_item_qty#36502L as double) / cast(((sr_item_qty#36502L + cr_item_qty#36506L) + wr_item_qty#36510L) as double)) / cast(3.0 as double)) * cast(100 as double)) AS sr_dev#36497, cr_item_qty#36506L, (((cast(cr_item_qty#36506L as double) / cast(((sr_item_qty#36502L + cr_item_qty#36506L) + wr_item_qty#36510L) as double)) / cast(3.0 as double)) * cast(100 as double)) AS cr_dev#36498, wr_item_qty#36510L, (((cast(wr_item_qty#36510L as double) / cast(((sr_item_qty#36502L + cr_item_qty#36506L) + wr_item_qty#36510L) as double)) / cast(3.0 as double)) * cast(100 as double)) AS wr_dev#36499, CheckOverflow((promote_precision(cast(cast(((sr_item_qty#36502L + cr_item_qty#36506L) + wr_item_qty#36510L) as decimal(20,0)) as decimal(21,1))) / promote_precision(cast(3.0 as decimal(21,1)))), DecimalType(27,6)) AS average#36500]\n         +- Filter ((item_id#36501 = item_id#36505) && (item_id#36501 = item_id#36509))\n            +- Join Inner\n               :- Join Inner\n               :  :- SubqueryAlias sr_items\n               :  :  +- Aggregate [i_item_id#1173], [i_item_id#1173 AS item_id#36501, sum(cast(sr_return_quantity#1713 as bigint)) AS sr_item_qty#36502L]\n               :  :     +- Filter (((sr_item_sk#1705 = i_item_sk#1172) && d_date#1042 IN (list#36504 [])) && (sr_returned_date_sk#1723 = d_date_sk#1040))\n               :  :        :  +- Project [d_date#1042]\n               :  :        :     +- Filter d_week_seq#1044 IN (list#36503 [])\n               :  :        :        :  +- Project [d_week_seq#1044]\n               :  :        :        :     +- Filter d_date#1042 IN (cast(2000-06-30 as date),cast(2000-09-27 as date),cast(2000-11-17 as date))\n               :  :        :        :        +- SubqueryAlias date_dim\n               :  :        :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :        :        +- SubqueryAlias date_dim\n               :  :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  :        +- Join Inner\n               :  :           :- Join Inner\n               :  :           :  :- SubqueryAlias store_returns\n               :  :           :  :  +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               :  :           :  +- SubqueryAlias item\n               :  :           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :  :           +- SubqueryAlias date_dim\n               :  :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :  +- SubqueryAlias cr_items\n               :     +- Aggregate [i_item_id#1173], [i_item_id#1173 AS item_id#36505, sum(cast(cr_return_quantity#2102 as bigint)) AS cr_item_qty#36506L]\n               :        +- Filter (((cr_item_sk#2087 = i_item_sk#1172) && d_date#1042 IN (list#36508 [])) && (cr_returned_date_sk#2112 = d_date_sk#1040))\n               :           :  +- Project [d_date#1042]\n               :           :     +- Filter d_week_seq#1044 IN (list#36507 [])\n               :           :        :  +- Project [d_week_seq#1044]\n               :           :        :     +- Filter d_date#1042 IN (cast(2000-06-30 as date),cast(2000-09-27 as date),cast(2000-11-17 as date))\n               :           :        :        +- SubqueryAlias date_dim\n               :           :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :           :        +- SubqueryAlias date_dim\n               :           :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :           +- Join Inner\n               :              :- Join Inner\n               :              :  :- SubqueryAlias catalog_returns\n               :              :  :  +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n               :              :  +- SubqueryAlias item\n               :              :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :              +- SubqueryAlias date_dim\n               :                 +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- SubqueryAlias wr_items\n                  +- Aggregate [i_item_id#1173], [i_item_id#1173 AS item_id#36509, sum(cast(wr_return_quantity#2130 as bigint)) AS wr_item_qty#36510L]\n                     +- Filter (((wr_item_sk#2118 = i_item_sk#1172) && d_date#1042 IN (list#36512 [])) && (wr_returned_date_sk#2140 = d_date_sk#1040))\n                        :  +- Project [d_date#1042]\n                        :     +- Filter d_week_seq#1044 IN (list#36511 [])\n                        :        :  +- Project [d_week_seq#1044]\n                        :        :     +- Filter d_date#1042 IN (cast(2000-06-30 as date),cast(2000-09-27 as date),cast(2000-11-17 as date))\n                        :        :        +- SubqueryAlias date_dim\n                        :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        :        +- SubqueryAlias date_dim\n                        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Join Inner\n                           :- Join Inner\n                           :  :- SubqueryAlias web_returns\n                           :  :  +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n                           :  +- SubqueryAlias item\n                           :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                           +- SubqueryAlias date_dim\n                              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [item_id#36501 ASC NULLS FIRST, sr_item_qty#36502L ASC NULLS FIRST], true\n      +- Project [item_id#36501, sr_item_qty#36502L, (((cast(sr_item_qty#36502L as double) / cast(((sr_item_qty#36502L + cr_item_qty#36506L) + wr_item_qty#36510L) as double)) / 3.0) * 100.0) AS sr_dev#36497, cr_item_qty#36506L, (((cast(cr_item_qty#36506L as double) / cast(((sr_item_qty#36502L + cr_item_qty#36506L) + wr_item_qty#36510L) as double)) / 3.0) * 100.0) AS cr_dev#36498, wr_item_qty#36510L, (((cast(wr_item_qty#36510L as double) / cast(((sr_item_qty#36502L + cr_item_qty#36506L) + wr_item_qty#36510L) as double)) / 3.0) * 100.0) AS wr_dev#36499, CheckOverflow((promote_precision(cast(cast(((sr_item_qty#36502L + cr_item_qty#36506L) + wr_item_qty#36510L) as decimal(20,0)) as decimal(21,1))) / 3.0), DecimalType(27,6)) AS average#36500]\n         +- Join Inner, (item_id#36501 = item_id#36509)\n            :- Project [item_id#36501, sr_item_qty#36502L, cr_item_qty#36506L]\n            :  +- Join Inner, (item_id#36501 = item_id#36505)\n            :     :- Aggregate [i_item_id#1173], [i_item_id#1173 AS item_id#36501, sum(cast(sr_return_quantity#1713 as bigint)) AS sr_item_qty#36502L]\n            :     :  +- Project [sr_return_quantity#1713, i_item_id#1173]\n            :     :     +- Join Inner, (sr_returned_date_sk#1723 = d_date_sk#1040)\n            :     :        :- Project [sr_return_quantity#1713, sr_returned_date_sk#1723, i_item_id#1173]\n            :     :        :  +- Join Inner, (sr_item_sk#1705 = i_item_sk#1172)\n            :     :        :     :- Project [sr_item_sk#1705, sr_return_quantity#1713, sr_returned_date_sk#1723]\n            :     :        :     :  +- Filter (isnotnull(sr_item_sk#1705) && isnotnull(sr_returned_date_sk#1723))\n            :     :        :     :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n            :     :        :     +- Project [i_item_sk#1172, i_item_id#1173]\n            :     :        :        +- Filter (isnotnull(i_item_sk#1172) && isnotnull(i_item_id#1173))\n            :     :        :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :     :        +- Project [d_date_sk#1040]\n            :     :           +- Join LeftSemi, (d_date#1042 = d_date#1042#36524)\n            :     :              :- Project [d_date_sk#1040, d_date#1042]\n            :     :              :  +- Filter isnotnull(d_date_sk#1040)\n            :     :              :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :              +- Project [d_date#1042 AS d_date#1042#36524]\n            :     :                 +- Join LeftSemi, (d_week_seq#1044 = d_week_seq#1044#36527)\n            :     :                    :- Project [d_date#1042, d_week_seq#1044]\n            :     :                    :  +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     :                    +- Project [d_week_seq#1044 AS d_week_seq#1044#36527]\n            :     :                       +- Filter d_date#1042 IN (11138,11227,11278)\n            :     :                          +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :     +- Aggregate [i_item_id#1173], [i_item_id#1173 AS item_id#36505, sum(cast(cr_return_quantity#2102 as bigint)) AS cr_item_qty#36506L]\n            :        +- Project [cr_return_quantity#2102, i_item_id#1173]\n            :           +- Join Inner, (cr_returned_date_sk#2112 = d_date_sk#1040)\n            :              :- Project [cr_return_quantity#2102, cr_returned_date_sk#2112, i_item_id#1173]\n            :              :  +- Join Inner, (cr_item_sk#2087 = i_item_sk#1172)\n            :              :     :- Project [cr_item_sk#2087, cr_return_quantity#2102, cr_returned_date_sk#2112]\n            :              :     :  +- Filter (isnotnull(cr_item_sk#2087) && isnotnull(cr_returned_date_sk#2112))\n            :              :     :     +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n            :              :     +- Project [i_item_sk#1172, i_item_id#1173]\n            :              :        +- Filter (isnotnull(i_item_sk#1172) && isnotnull(i_item_id#1173))\n            :              :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n            :              +- Project [d_date_sk#1040]\n            :                 +- Join LeftSemi, (d_date#1042 = d_date#1042#36525)\n            :                    :- Project [d_date_sk#1040, d_date#1042]\n            :                    :  +- Filter isnotnull(d_date_sk#1040)\n            :                    :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :                    +- Project [d_date#1042 AS d_date#1042#36525]\n            :                       +- Join LeftSemi, (d_week_seq#1044 = d_week_seq#1044#36528)\n            :                          :- Project [d_date#1042, d_week_seq#1044]\n            :                          :  +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :                          +- Project [d_week_seq#1044 AS d_week_seq#1044#36528]\n            :                             +- Filter d_date#1042 IN (11138,11227,11278)\n            :                                +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Aggregate [i_item_id#1173], [i_item_id#1173 AS item_id#36509, sum(cast(wr_return_quantity#2130 as bigint)) AS wr_item_qty#36510L]\n               +- Project [wr_return_quantity#2130, i_item_id#1173]\n                  +- Join Inner, (wr_returned_date_sk#2140 = d_date_sk#1040)\n                     :- Project [wr_return_quantity#2130, wr_returned_date_sk#2140, i_item_id#1173]\n                     :  +- Join Inner, (wr_item_sk#2118 = i_item_sk#1172)\n                     :     :- Project [wr_item_sk#2118, wr_return_quantity#2130, wr_returned_date_sk#2140]\n                     :     :  +- Filter (isnotnull(wr_item_sk#2118) && isnotnull(wr_returned_date_sk#2140))\n                     :     :     +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n                     :     +- Project [i_item_sk#1172, i_item_id#1173]\n                     :        +- Filter (isnotnull(i_item_sk#1172) && isnotnull(i_item_id#1173))\n                     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     +- Project [d_date_sk#1040]\n                        +- Join LeftSemi, (d_date#1042 = d_date#1042#36526)\n                           :- Project [d_date_sk#1040, d_date#1042]\n                           :  +- Filter isnotnull(d_date_sk#1040)\n                           :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                           +- Project [d_date#1042 AS d_date#1042#36526]\n                              +- Join LeftSemi, (d_week_seq#1044 = d_week_seq#1044#36529)\n                                 :- Project [d_date#1042, d_week_seq#1044]\n                                 :  +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                 +- Project [d_week_seq#1044 AS d_week_seq#1044#36529]\n                                    +- Filter d_date#1042 IN (11138,11227,11278)\n                                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[item_id#36501 ASC NULLS FIRST,sr_item_qty#36502L ASC NULLS FIRST], output=[item_id#36501,sr_item_qty#36502L,sr_dev#36497,cr_item_qty#36506L,cr_dev#36498,wr_item_qty#36510L,wr_dev#36499,average#36500])\n+- *(23) Project [item_id#36501, sr_item_qty#36502L, (((cast(sr_item_qty#36502L as double) / cast(((sr_item_qty#36502L + cr_item_qty#36506L) + wr_item_qty#36510L) as double)) / 3.0) * 100.0) AS sr_dev#36497, cr_item_qty#36506L, (((cast(cr_item_qty#36506L as double) / cast(((sr_item_qty#36502L + cr_item_qty#36506L) + wr_item_qty#36510L) as double)) / 3.0) * 100.0) AS cr_dev#36498, wr_item_qty#36510L, (((cast(wr_item_qty#36510L as double) / cast(((sr_item_qty#36502L + cr_item_qty#36506L) + wr_item_qty#36510L) as double)) / 3.0) * 100.0) AS wr_dev#36499, CheckOverflow((promote_precision(cast(cast(((sr_item_qty#36502L + cr_item_qty#36506L) + wr_item_qty#36510L) as decimal(20,0)) as decimal(21,1))) / 3.0), DecimalType(27,6)) AS average#36500]\n   +- *(23) SortMergeJoin [item_id#36501], [item_id#36509], Inner\n      :- *(15) Project [item_id#36501, sr_item_qty#36502L, cr_item_qty#36506L]\n      :  +- *(15) SortMergeJoin [item_id#36501], [item_id#36505], Inner\n      :     :- *(7) Sort [item_id#36501 ASC NULLS FIRST], false, 0\n      :     :  +- Exchange hashpartitioning(item_id#36501, 200)\n      :     :     +- *(6) HashAggregate(keys=[i_item_id#1173], functions=[sum(cast(sr_return_quantity#1713 as bigint))], output=[item_id#36501, sr_item_qty#36502L])\n      :     :        +- Exchange hashpartitioning(i_item_id#1173, 200)\n      :     :           +- *(5) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(cast(sr_return_quantity#1713 as bigint))], output=[i_item_id#1173, sum#36531L])\n      :     :              +- *(5) Project [sr_return_quantity#1713, i_item_id#1173]\n      :     :                 +- *(5) BroadcastHashJoin [sr_returned_date_sk#1723], [d_date_sk#1040], Inner, BuildRight\n      :     :                    :- *(5) Project [sr_return_quantity#1713, sr_returned_date_sk#1723, i_item_id#1173]\n      :     :                    :  +- *(5) BroadcastHashJoin [sr_item_sk#1705], [i_item_sk#1172], Inner, BuildRight\n      :     :                    :     :- *(5) Project [sr_item_sk#1705, sr_return_quantity#1713, sr_returned_date_sk#1723]\n      :     :                    :     :  +- *(5) Filter isnotnull(sr_item_sk#1705)\n      :     :                    :     :     +- *(5) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_return_quantity#1713,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns/sr_..., PartitionCount: 2001, PartitionFilters: [isnotnull(sr_returned_date_sk#1723)], PushedFilters: [IsNotNull(sr_item_sk)], ReadSchema: struct<sr_item_sk:int,sr_return_quantity:int>\n      :     :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                    :        +- *(1) Project [i_item_sk#1172, i_item_id#1173]\n      :     :                    :           +- *(1) Filter (isnotnull(i_item_sk#1172) && isnotnull(i_item_id#1173))\n      :     :                    :              +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_item_id)], ReadSchema: struct<i_item_sk:int,i_item_id:string>\n      :     :                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                       +- *(4) Project [d_date_sk#1040]\n      :     :                          +- *(4) BroadcastHashJoin [d_date#1042], [d_date#1042#36524], LeftSemi, BuildRight\n      :     :                             :- *(4) Project [d_date_sk#1040, d_date#1042]\n      :     :                             :  +- *(4) Filter isnotnull(d_date_sk#1040)\n      :     :                             :     +- *(4) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_date:date>\n      :     :                             +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]))\n      :     :                                +- *(3) Project [d_date#1042 AS d_date#1042#36524]\n      :     :                                   +- *(3) BroadcastHashJoin [d_week_seq#1044], [d_week_seq#1044#36527], LeftSemi, BuildRight\n      :     :                                      :- *(3) FileScan parquet db_tpcds.date_dim[d_date#1042,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>\n      :     :                                      +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :     :                                         +- *(2) Project [d_week_seq#1044 AS d_week_seq#1044#36527]\n      :     :                                            +- *(2) Filter d_date#1042 IN (11138,11227,11278)\n      :     :                                               +- *(2) FileScan parquet db_tpcds.date_dim[d_date#1042,d_week_seq#1044] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [In(d_date, [2000-06-30,2000-09-27,2000-11-17])], ReadSchema: struct<d_date:date,d_week_seq:int>\n      :     +- *(14) Sort [item_id#36505 ASC NULLS FIRST], false, 0\n      :        +- Exchange hashpartitioning(item_id#36505, 200)\n      :           +- *(13) HashAggregate(keys=[i_item_id#1173], functions=[sum(cast(cr_return_quantity#2102 as bigint))], output=[item_id#36505, cr_item_qty#36506L])\n      :              +- Exchange hashpartitioning(i_item_id#1173, 200)\n      :                 +- *(12) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(cast(cr_return_quantity#2102 as bigint))], output=[i_item_id#1173, sum#36533L])\n      :                    +- *(12) Project [cr_return_quantity#2102, i_item_id#1173]\n      :                       +- *(12) BroadcastHashJoin [cr_returned_date_sk#2112], [d_date_sk#1040], Inner, BuildRight\n      :                          :- *(12) Project [cr_return_quantity#2102, cr_returned_date_sk#2112, i_item_id#1173]\n      :                          :  +- *(12) BroadcastHashJoin [cr_item_sk#2087], [i_item_sk#1172], Inner, BuildRight\n      :                          :     :- *(12) Project [cr_item_sk#2087, cr_return_quantity#2102, cr_returned_date_sk#2112]\n      :                          :     :  +- *(12) Filter isnotnull(cr_item_sk#2087)\n      :                          :     :     +- *(12) FileScan parquet db_tpcds.catalog_returns[cr_item_sk#2087,cr_return_quantity#2102,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns/c..., PartitionCount: 2066, PartitionFilters: [isnotnull(cr_returned_date_sk#2112)], PushedFilters: [IsNotNull(cr_item_sk)], ReadSchema: struct<cr_item_sk:int,cr_return_quantity:int>\n      :                          :     +- ReusedExchange [i_item_sk#1172, i_item_id#1173], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                          +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      +- *(22) Sort [item_id#36509 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(item_id#36509, 200)\n            +- *(21) HashAggregate(keys=[i_item_id#1173], functions=[sum(cast(wr_return_quantity#2130 as bigint))], output=[item_id#36509, wr_item_qty#36510L])\n               +- Exchange hashpartitioning(i_item_id#1173, 200)\n                  +- *(20) HashAggregate(keys=[i_item_id#1173], functions=[partial_sum(cast(wr_return_quantity#2130 as bigint))], output=[i_item_id#1173, sum#36535L])\n                     +- *(20) Project [wr_return_quantity#2130, i_item_id#1173]\n                        +- *(20) BroadcastHashJoin [wr_returned_date_sk#2140], [d_date_sk#1040], Inner, BuildRight\n                           :- *(20) Project [wr_return_quantity#2130, wr_returned_date_sk#2140, i_item_id#1173]\n                           :  +- *(20) BroadcastHashJoin [wr_item_sk#2118], [i_item_sk#1172], Inner, BuildRight\n                           :     :- *(20) Project [wr_item_sk#2118, wr_return_quantity#2130, wr_returned_date_sk#2140]\n                           :     :  +- *(20) Filter isnotnull(wr_item_sk#2118)\n                           :     :     +- *(20) FileScan parquet db_tpcds.web_returns[wr_item_sk#2118,wr_return_quantity#2130,wr_returned_date_sk#2140] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_returns/wr_re..., PartitionCount: 2109, PartitionFilters: [isnotnull(wr_returned_date_sk#2140)], PushedFilters: [IsNotNull(wr_item_sk)], ReadSchema: struct<wr_item_sk:int,wr_return_quantity:int>\n                           :     +- ReusedExchange [i_item_sk#1172, i_item_id#1173], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                           +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q84-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["customer","customer_address","customer_demographics","household_demographics","income_band","store_returns"],"parsingTime":0.002401,"analysisTime":0.001342,"optimizationTime":52.48433,"planningTime":207.718064,"executionTime":3495.531553,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['c_customer_id ASC NULLS FIRST], true\n      +- 'Project ['c_customer_id AS customer_id#36571, (('coalesce('c_last_name, ) + , ) + 'coalesce('c_first_name, )) AS customername#36572]\n         +- 'Filter (((('ca_city = Edgewood) && ('c_current_addr_sk = 'ca_address_sk)) && (('ib_lower_bound >= 38128) && ('ib_upper_bound <= (38128 + 50000)))) && ((('ib_income_band_sk = 'hd_income_band_sk) && ('cd_demo_sk = 'c_current_cdemo_sk)) && (('hd_demo_sk = 'c_current_hdemo_sk) && ('sr_cdemo_sk = 'cd_demo_sk))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'Join Inner\n               :  :  :  :  :- 'UnresolvedRelation `customer`\n               :  :  :  :  +- 'UnresolvedRelation `customer_address`\n               :  :  :  +- 'UnresolvedRelation `customer_demographics`\n               :  :  +- 'UnresolvedRelation `household_demographics`\n               :  +- 'UnresolvedRelation `income_band`\n               +- 'UnresolvedRelation `store_returns`\n\n== Analyzed Logical Plan ==\ncustomer_id: string, customername: double\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [customer_id#36571, customername#36572]\n      +- Sort [c_customer_id#861 ASC NULLS FIRST], true\n         +- Project [c_customer_id#861 AS customer_id#36571, ((cast(coalesce(c_last_name#869, ) as double) + cast(,  as double)) + cast(coalesce(c_first_name#868, ) as double)) AS customername#36572, c_customer_id#861]\n            +- Filter ((((ca_city#928 = Edgewood) && (c_current_addr_sk#864 = ca_address_sk#922)) && ((ib_lower_bound#1123 >= 38128) && (ib_upper_bound#1124 <= (38128 + 50000)))) && (((ib_income_band_sk#1122 = hd_income_band_sk#1107) && (cd_demo_sk#966 = c_current_cdemo_sk#862)) && ((hd_demo_sk#1106 = c_current_hdemo_sk#863) && (sr_cdemo_sk#1707 = cd_demo_sk#966))))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- Join Inner\n                  :  :  :  :- Join Inner\n                  :  :  :  :  :- SubqueryAlias customer\n                  :  :  :  :  :  +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n                  :  :  :  :  +- SubqueryAlias customer_address\n                  :  :  :  :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  :  :  :  +- SubqueryAlias customer_demographics\n                  :  :  :     +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n                  :  :  +- SubqueryAlias household_demographics\n                  :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n                  :  +- SubqueryAlias income_band\n                  :     +- Relation[ib_income_band_sk#1122,ib_lower_bound#1123,ib_upper_bound#1124] parquet\n                  +- SubqueryAlias store_returns\n                     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [customer_id#36571, null AS customername#36572]\n      +- Sort [c_customer_id#861 ASC NULLS FIRST], true\n         +- Project [c_customer_id#861 AS customer_id#36571, c_customer_id#861]\n            +- Join Inner, (sr_cdemo_sk#1707 = cd_demo_sk#966)\n               :- Project [c_customer_id#861, cd_demo_sk#966]\n               :  +- Join Inner, (ib_income_band_sk#1122 = hd_income_band_sk#1107)\n               :     :- Project [c_customer_id#861, cd_demo_sk#966, hd_income_band_sk#1107]\n               :     :  +- Join Inner, (hd_demo_sk#1106 = c_current_hdemo_sk#863)\n               :     :     :- Project [c_customer_id#861, c_current_hdemo_sk#863, cd_demo_sk#966]\n               :     :     :  +- Join Inner, (cd_demo_sk#966 = c_current_cdemo_sk#862)\n               :     :     :     :- Project [c_customer_id#861, c_current_cdemo_sk#862, c_current_hdemo_sk#863]\n               :     :     :     :  +- Join Inner, (c_current_addr_sk#864 = ca_address_sk#922)\n               :     :     :     :     :- Project [c_customer_id#861, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864]\n               :     :     :     :     :  +- Filter ((isnotnull(c_current_addr_sk#864) && isnotnull(c_current_cdemo_sk#862)) && isnotnull(c_current_hdemo_sk#863))\n               :     :     :     :     :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n               :     :     :     :     +- Project [ca_address_sk#922]\n               :     :     :     :        +- Filter ((isnotnull(ca_city#928) && (ca_city#928 = Edgewood)) && isnotnull(ca_address_sk#922))\n               :     :     :     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               :     :     :     +- Project [cd_demo_sk#966]\n               :     :     :        +- Filter isnotnull(cd_demo_sk#966)\n               :     :     :           +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n               :     :     +- Project [hd_demo_sk#1106, hd_income_band_sk#1107]\n               :     :        +- Filter (isnotnull(hd_demo_sk#1106) && isnotnull(hd_income_band_sk#1107))\n               :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n               :     +- Project [ib_income_band_sk#1122]\n               :        +- Filter ((((isnotnull(ib_lower_bound#1123) && isnotnull(ib_upper_bound#1124)) && (ib_lower_bound#1123 >= 38128)) && (ib_upper_bound#1124 <= 88128)) && isnotnull(ib_income_band_sk#1122))\n               :           +- Relation[ib_income_band_sk#1122,ib_lower_bound#1123,ib_upper_bound#1124] parquet\n               +- Project [sr_cdemo_sk#1707]\n                  +- Filter isnotnull(sr_cdemo_sk#1707)\n                     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[c_customer_id#861 ASC NULLS FIRST], output=[customer_id#36571,customername#36572])\n+- *(9) Project [c_customer_id#861 AS customer_id#36571, c_customer_id#861]\n   +- *(9) SortMergeJoin [cd_demo_sk#966], [sr_cdemo_sk#1707], Inner\n      :- *(6) Sort [cd_demo_sk#966 ASC NULLS FIRST], false, 0\n      :  +- Exchange hashpartitioning(cd_demo_sk#966, 200)\n      :     +- *(5) Project [c_customer_id#861, cd_demo_sk#966]\n      :        +- *(5) BroadcastHashJoin [hd_income_band_sk#1107], [ib_income_band_sk#1122], Inner, BuildRight\n      :           :- *(5) Project [c_customer_id#861, cd_demo_sk#966, hd_income_band_sk#1107]\n      :           :  +- *(5) BroadcastHashJoin [c_current_hdemo_sk#863], [hd_demo_sk#1106], Inner, BuildRight\n      :           :     :- *(5) Project [c_customer_id#861, c_current_hdemo_sk#863, cd_demo_sk#966]\n      :           :     :  +- *(5) BroadcastHashJoin [c_current_cdemo_sk#862], [cd_demo_sk#966], Inner, BuildRight\n      :           :     :     :- *(5) Project [c_customer_id#861, c_current_cdemo_sk#862, c_current_hdemo_sk#863]\n      :           :     :     :  +- *(5) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n      :           :     :     :     :- *(5) Project [c_customer_id#861, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864]\n      :           :     :     :     :  +- *(5) Filter ((isnotnull(c_current_addr_sk#864) && isnotnull(c_current_cdemo_sk#862)) && isnotnull(c_current_hdemo_sk#863))\n      :           :     :     :     :     +- *(5) FileScan parquet db_tpcds.customer[c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_current_addr_sk), IsNotNull(c_current_cdemo_sk), IsNotNull(c_current_hdemo_sk)], ReadSchema: struct<c_customer_id:string,c_current_cdemo_sk:int,c_current_hdemo_sk:int,c_current_addr_sk:int>\n      :           :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :           :     :     :        +- *(1) Project [ca_address_sk#922]\n      :           :     :     :           +- *(1) Filter ((isnotnull(ca_city#928) && (ca_city#928 = Edgewood)) && isnotnull(ca_address_sk#922))\n      :           :     :     :              +- *(1) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_city#928] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_city), EqualTo(ca_city,Edgewood), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_city:string>\n      :           :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :           :     :        +- *(2) Project [cd_demo_sk#966]\n      :           :     :           +- *(2) Filter isnotnull(cd_demo_sk#966)\n      :           :     :              +- *(2) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:int>\n      :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :           :        +- *(3) Project [hd_demo_sk#1106, hd_income_band_sk#1107]\n      :           :           +- *(3) Filter (isnotnull(hd_demo_sk#1106) && isnotnull(hd_income_band_sk#1107))\n      :           :              +- *(3) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_income_band_sk#1107] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(hd_demo_sk), IsNotNull(hd_income_band_sk)], ReadSchema: struct<hd_demo_sk:int,hd_income_band_sk:int>\n      :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :              +- *(4) Project [ib_income_band_sk#1122]\n      :                 +- *(4) Filter ((((isnotnull(ib_lower_bound#1123) && isnotnull(ib_upper_bound#1124)) && (ib_lower_bound#1123 >= 38128)) && (ib_upper_bound#1124 <= 88128)) && isnotnull(ib_income_band_sk#1122))\n      :                    +- *(4) FileScan parquet db_tpcds.income_band[ib_income_band_sk#1122,ib_lower_bound#1123,ib_upper_bound#1124] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/income_band], PartitionFilters: [], PushedFilters: [IsNotNull(ib_lower_bound), IsNotNull(ib_upper_bound), GreaterThanOrEqual(ib_lower_bound,38128), ..., ReadSchema: struct<ib_income_band_sk:int,ib_lower_bound:int,ib_upper_bound:int>\n      +- *(8) Sort [sr_cdemo_sk#1707 ASC NULLS FIRST], false, 0\n         +- Exchange hashpartitioning(sr_cdemo_sk#1707, 200)\n            +- *(7) Project [sr_cdemo_sk#1707]\n               +- *(7) Filter isnotnull(sr_cdemo_sk#1707)\n                  +- *(7) FileScan parquet db_tpcds.store_returns[sr_cdemo_sk#1707,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns], PartitionCount: 2002, PartitionFilters: [], PushedFilters: [IsNotNull(sr_cdemo_sk)], ReadSchema: struct<sr_cdemo_sk:int>"},{"name":"q85-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin"],"tables":["web_sales","web_returns","web_page","customer_demographics","customer_demographics","customer_address","date_dim","reason"],"parsingTime":0.001552,"analysisTime":0.001667,"optimizationTime":430.766047,"planningTime":246.977584,"executionTime":9619.16181,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['substr('r_reason_desc, 1, 20) ASC NULLS FIRST, 'avg('ws_quantity) ASC NULLS FIRST, 'avg('wr_refunded_cash) ASC NULLS FIRST, 'avg('wr_fee) ASC NULLS FIRST], true\n      +- 'Aggregate ['r_reason_desc], [unresolvedalias('substr('r_reason_desc, 1, 20), None), unresolvedalias('avg('ws_quantity), None), unresolvedalias('avg('wr_refunded_cash), None), unresolvedalias('avg('wr_fee), None)]\n         +- 'Filter ((((('ws_web_page_sk = 'wp_web_page_sk) && ('ws_item_sk = 'wr_item_sk)) && ('ws_order_number = 'wr_order_number)) && ((('ws_sold_date_sk = 'd_date_sk) && ('d_year = 2000)) && ('cd1.cd_demo_sk = 'wr_refunded_cdemo_sk))) && (((('cd2.cd_demo_sk = 'wr_returning_cdemo_sk) && ('ca_address_sk = 'wr_refunded_addr_sk)) && ('r_reason_sk = 'wr_reason_sk)) && ((((((('cd1.cd_marital_status = M) && ('cd1.cd_marital_status = 'cd2.cd_marital_status)) && ('cd1.cd_education_status = Advanced Degree)) && (('cd1.cd_education_status = 'cd2.cd_education_status) && (('ws_sales_price >= 100.00) && ('ws_sales_price <= 150.00)))) || (((('cd1.cd_marital_status = S) && ('cd1.cd_marital_status = 'cd2.cd_marital_status)) && ('cd1.cd_education_status = College)) && (('cd1.cd_education_status = 'cd2.cd_education_status) && (('ws_sales_price >= 50.00) && ('ws_sales_price <= 100.00))))) || (((('cd1.cd_marital_status = W) && ('cd1.cd_marital_status = 'cd2.cd_marital_status)) && ('cd1.cd_education_status = 2 yr Degree)) && (('cd1.cd_education_status = 'cd2.cd_education_status) && (('ws_sales_price >= 150.00) && ('ws_sales_price <= 200.00))))) && ((((('ca_country = United States) && 'ca_state IN (IN,OH,NJ)) && (('ws_net_profit >= 100) && ('ws_net_profit <= 200))) || ((('ca_country = United States) && 'ca_state IN (WI,CT,KY)) && (('ws_net_profit >= 150) && ('ws_net_profit <= 300)))) || ((('ca_country = United States) && 'ca_state IN (LA,IA,AR)) && (('ws_net_profit >= 50) && ('ws_net_profit <= 250)))))))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'Join Inner\n               :  :  :  :  :- 'Join Inner\n               :  :  :  :  :  :- 'Join Inner\n               :  :  :  :  :  :  :- 'UnresolvedRelation `web_sales`\n               :  :  :  :  :  :  +- 'UnresolvedRelation `web_returns`\n               :  :  :  :  :  +- 'UnresolvedRelation `web_page`\n               :  :  :  :  +- 'SubqueryAlias cd1\n               :  :  :  :     +- 'UnresolvedRelation `customer_demographics`\n               :  :  :  +- 'SubqueryAlias cd2\n               :  :  :     +- 'UnresolvedRelation `customer_demographics`\n               :  :  +- 'UnresolvedRelation `customer_address`\n               :  +- 'UnresolvedRelation `date_dim`\n               +- 'UnresolvedRelation `reason`\n\n== Analyzed Logical Plan ==\nsubstring(r_reason_desc, 1, 20): string, avg(ws_quantity): double, avg(wr_refunded_cash): decimal(11,6), avg(wr_fee): decimal(11,6)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [substring(r_reason_desc, 1, 20)#36631, avg(ws_quantity)#36632, avg(wr_refunded_cash)#36633, avg(wr_fee)#36634]\n      +- Sort [substring(r_reason_desc, 1, 20)#36631 ASC NULLS FIRST, aggOrder#36636 ASC NULLS FIRST, avg(wr_refunded_cash)#36633 ASC NULLS FIRST, avg(wr_fee)#36634 ASC NULLS FIRST], true\n         +- Aggregate [r_reason_desc#1300], [substring(r_reason_desc#1300, 1, 20) AS substring(r_reason_desc, 1, 20)#36631, avg(cast(ws_quantity#1772 as bigint)) AS avg(ws_quantity)#36632, avg(wr_refunded_cash#2136) AS avg(wr_refunded_cash)#36633, avg(wr_fee#2134) AS avg(wr_fee)#36634, avg(cast(ws_quantity#1772 as bigint)) AS aggOrder#36636]\n            +- Filter (((((ws_web_page_sk#1766 = wp_web_page_sk#1568) && (ws_item_sk#1757 = wr_item_sk#2118)) && (ws_order_number#1771L = wr_order_number#2129L)) && (((ws_sold_date_sk#1788 = d_date_sk#1040) && (d_year#1046 = 2000)) && (cd_demo_sk#966 = wr_refunded_cdemo_sk#2120))) && ((((cd_demo_sk#36619 = wr_returning_cdemo_sk#2124) && (ca_address_sk#922 = wr_refunded_addr_sk#2122)) && (r_reason_sk#1298 = wr_reason_sk#2128)) && (((((((cd_marital_status#968 = M) && (cd_marital_status#968 = cd_marital_status#36621)) && (cd_education_status#969 = Advanced Degree)) && ((cd_education_status#969 = cd_education_status#36622) && ((cast(ws_sales_price#1775 as decimal(7,2)) >= cast(100.00 as decimal(7,2))) && (cast(ws_sales_price#1775 as decimal(7,2)) <= cast(150.00 as decimal(7,2)))))) || ((((cd_marital_status#968 = S) && (cd_marital_status#968 = cd_marital_status#36621)) && (cd_education_status#969 = College)) && ((cd_education_status#969 = cd_education_status#36622) && ((cast(ws_sales_price#1775 as decimal(7,2)) >= cast(50.00 as decimal(7,2))) && (cast(ws_sales_price#1775 as decimal(7,2)) <= cast(100.00 as decimal(7,2))))))) || ((((cd_marital_status#968 = W) && (cd_marital_status#968 = cd_marital_status#36621)) && (cd_education_status#969 = 2 yr Degree)) && ((cd_education_status#969 = cd_education_status#36622) && ((cast(ws_sales_price#1775 as decimal(7,2)) >= cast(150.00 as decimal(7,2))) && (cast(ws_sales_price#1775 as decimal(7,2)) <= cast(200.00 as decimal(7,2))))))) && (((((ca_country#932 = United States) && ca_state#930 IN (IN,OH,NJ)) && ((cast(ws_net_profit#1787 as decimal(7,2)) >= cast(cast(100 as decimal(3,0)) as decimal(7,2))) && (cast(ws_net_profit#1787 as decimal(7,2)) <= cast(cast(200 as decimal(3,0)) as decimal(7,2))))) || (((ca_country#932 = United States) && ca_state#930 IN (WI,CT,KY)) && ((cast(ws_net_profit#1787 as decimal(7,2)) >= cast(cast(150 as decimal(3,0)) as decimal(7,2))) && (cast(ws_net_profit#1787 as decimal(7,2)) <= cast(cast(300 as decimal(3,0)) as decimal(7,2)))))) || (((ca_country#932 = United States) && ca_state#930 IN (LA,IA,AR)) && ((cast(ws_net_profit#1787 as decimal(7,2)) >= cast(cast(50 as decimal(2,0)) as decimal(7,2))) && (cast(ws_net_profit#1787 as decimal(7,2)) <= cast(cast(250 as decimal(3,0)) as decimal(7,2)))))))))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- Join Inner\n                  :  :  :  :- Join Inner\n                  :  :  :  :  :- Join Inner\n                  :  :  :  :  :  :- Join Inner\n                  :  :  :  :  :  :  :- SubqueryAlias web_sales\n                  :  :  :  :  :  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :  :  :  :  :  :  +- SubqueryAlias web_returns\n                  :  :  :  :  :  :     +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n                  :  :  :  :  :  +- SubqueryAlias web_page\n                  :  :  :  :  :     +- Relation[wp_web_page_sk#1568,wp_web_page_id#1569,wp_rec_start_date#1570,wp_rec_end_date#1571,wp_creation_date_sk#1572,wp_access_date_sk#1573,wp_autogen_flag#1574,wp_customer_sk#1575,wp_url#1576,wp_type#1577,wp_char_count#1578,wp_link_count#1579,wp_image_count#1580,wp_max_ad_count#1581] parquet\n                  :  :  :  :  +- SubqueryAlias cd1\n                  :  :  :  :     +- SubqueryAlias customer_demographics\n                  :  :  :  :        +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n                  :  :  :  +- SubqueryAlias cd2\n                  :  :  :     +- SubqueryAlias customer_demographics\n                  :  :  :        +- Relation[cd_demo_sk#36619,cd_gender#36620,cd_marital_status#36621,cd_education_status#36622,cd_purchase_estimate#36623,cd_credit_rating#36624,cd_dep_count#36625,cd_dep_employed_count#36626,cd_dep_college_count#36627] parquet\n                  :  :  +- SubqueryAlias customer_address\n                  :  :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  :  +- SubqueryAlias date_dim\n                  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  +- SubqueryAlias reason\n                     +- Relation[r_reason_sk#1298,r_reason_id#1299,r_reason_desc#1300] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [substring(r_reason_desc, 1, 20)#36631, avg(ws_quantity)#36632, avg(wr_refunded_cash)#36633, avg(wr_fee)#36634]\n      +- Sort [substring(r_reason_desc, 1, 20)#36631 ASC NULLS FIRST, aggOrder#36636 ASC NULLS FIRST, avg(wr_refunded_cash)#36633 ASC NULLS FIRST, avg(wr_fee)#36634 ASC NULLS FIRST], true\n         +- Aggregate [r_reason_desc#1300], [substring(r_reason_desc#1300, 1, 20) AS substring(r_reason_desc, 1, 20)#36631, avg(cast(ws_quantity#1772 as bigint)) AS avg(ws_quantity)#36632, cast((avg(UnscaledValue(wr_refunded_cash#2136)) / 100.0) as decimal(11,6)) AS avg(wr_refunded_cash)#36633, cast((avg(UnscaledValue(wr_fee#2134)) / 100.0) as decimal(11,6)) AS avg(wr_fee)#36634, avg(cast(ws_quantity#1772 as bigint)) AS aggOrder#36636]\n            +- Project [ws_quantity#1772, wr_fee#2134, wr_refunded_cash#2136, r_reason_desc#1300]\n               +- Join Inner, (r_reason_sk#1298 = wr_reason_sk#2128)\n                  :- Project [ws_quantity#1772, wr_reason_sk#2128, wr_fee#2134, wr_refunded_cash#2136]\n                  :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#1040)\n                  :     :- Project [ws_quantity#1772, ws_sold_date_sk#1788, wr_reason_sk#2128, wr_fee#2134, wr_refunded_cash#2136]\n                  :     :  +- Join Inner, ((ca_address_sk#922 = wr_refunded_addr_sk#2122) && ((((ca_state#930 IN (IN,OH,NJ) && (ws_net_profit#1787 >= 100.00)) && (ws_net_profit#1787 <= 200.00)) || ((ca_state#930 IN (WI,CT,KY) && (ws_net_profit#1787 >= 150.00)) && (ws_net_profit#1787 <= 300.00))) || ((ca_state#930 IN (LA,IA,AR) && (ws_net_profit#1787 >= 50.00)) && (ws_net_profit#1787 <= 250.00))))\n                  :     :     :- Project [ws_quantity#1772, ws_net_profit#1787, ws_sold_date_sk#1788, wr_refunded_addr_sk#2122, wr_reason_sk#2128, wr_fee#2134, wr_refunded_cash#2136]\n                  :     :     :  +- Join Inner, (((cd_demo_sk#36619 = wr_returning_cdemo_sk#2124) && (cd_marital_status#968 = cd_marital_status#36621)) && (cd_education_status#969 = cd_education_status#36622))\n                  :     :     :     :- Project [ws_quantity#1772, ws_net_profit#1787, ws_sold_date_sk#1788, wr_refunded_addr_sk#2122, wr_returning_cdemo_sk#2124, wr_reason_sk#2128, wr_fee#2134, wr_refunded_cash#2136, cd_marital_status#968, cd_education_status#969]\n                  :     :     :     :  +- Join Inner, (((((((cd_marital_status#968 = M) && (cd_education_status#969 = Advanced Degree)) && (ws_sales_price#1775 >= 100.00)) && (ws_sales_price#1775 <= 150.00)) || ((((cd_marital_status#968 = S) && (cd_education_status#969 = College)) && (ws_sales_price#1775 >= 50.00)) && (ws_sales_price#1775 <= 100.00))) || ((((cd_marital_status#968 = W) && (cd_education_status#969 = 2 yr Degree)) && (ws_sales_price#1775 >= 150.00)) && (ws_sales_price#1775 <= 200.00))) && (cd_demo_sk#966 = wr_refunded_cdemo_sk#2120))\n                  :     :     :     :     :- Project [ws_quantity#1772, ws_sales_price#1775, ws_net_profit#1787, ws_sold_date_sk#1788, wr_refunded_cdemo_sk#2120, wr_refunded_addr_sk#2122, wr_returning_cdemo_sk#2124, wr_reason_sk#2128, wr_fee#2134, wr_refunded_cash#2136]\n                  :     :     :     :     :  +- Join Inner, (ws_web_page_sk#1766 = wp_web_page_sk#1568)\n                  :     :     :     :     :     :- Project [ws_web_page_sk#1766, ws_quantity#1772, ws_sales_price#1775, ws_net_profit#1787, ws_sold_date_sk#1788, wr_refunded_cdemo_sk#2120, wr_refunded_addr_sk#2122, wr_returning_cdemo_sk#2124, wr_reason_sk#2128, wr_fee#2134, wr_refunded_cash#2136]\n                  :     :     :     :     :     :  +- Join Inner, ((ws_item_sk#1757 = wr_item_sk#2118) && (ws_order_number#1771L = wr_order_number#2129L))\n                  :     :     :     :     :     :     :- Project [ws_item_sk#1757, ws_web_page_sk#1766, ws_order_number#1771L, ws_quantity#1772, ws_sales_price#1775, ws_net_profit#1787, ws_sold_date_sk#1788]\n                  :     :     :     :     :     :     :  +- Filter (((isnotnull(ws_item_sk#1757) && isnotnull(ws_order_number#1771L)) && isnotnull(ws_web_page_sk#1766)) && isnotnull(ws_sold_date_sk#1788))\n                  :     :     :     :     :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :     :     :     :     :     :     +- Project [wr_item_sk#2118, wr_refunded_cdemo_sk#2120, wr_refunded_addr_sk#2122, wr_returning_cdemo_sk#2124, wr_reason_sk#2128, wr_order_number#2129L, wr_fee#2134, wr_refunded_cash#2136]\n                  :     :     :     :     :     :        +- Filter (((((isnotnull(wr_item_sk#2118) && isnotnull(wr_order_number#2129L)) && isnotnull(wr_refunded_cdemo_sk#2120)) && isnotnull(wr_returning_cdemo_sk#2124)) && isnotnull(wr_refunded_addr_sk#2122)) && isnotnull(wr_reason_sk#2128))\n                  :     :     :     :     :     :           +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n                  :     :     :     :     :     +- Project [wp_web_page_sk#1568]\n                  :     :     :     :     :        +- Filter isnotnull(wp_web_page_sk#1568)\n                  :     :     :     :     :           +- Relation[wp_web_page_sk#1568,wp_web_page_id#1569,wp_rec_start_date#1570,wp_rec_end_date#1571,wp_creation_date_sk#1572,wp_access_date_sk#1573,wp_autogen_flag#1574,wp_customer_sk#1575,wp_url#1576,wp_type#1577,wp_char_count#1578,wp_link_count#1579,wp_image_count#1580,wp_max_ad_count#1581] parquet\n                  :     :     :     :     +- Project [cd_demo_sk#966, cd_marital_status#968, cd_education_status#969]\n                  :     :     :     :        +- Filter ((isnotnull(cd_demo_sk#966) && isnotnull(cd_marital_status#968)) && isnotnull(cd_education_status#969))\n                  :     :     :     :           +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n                  :     :     :     +- Project [cd_demo_sk#36619, cd_marital_status#36621, cd_education_status#36622]\n                  :     :     :        +- Filter ((isnotnull(cd_education_status#36622) && isnotnull(cd_marital_status#36621)) && isnotnull(cd_demo_sk#36619))\n                  :     :     :           +- Relation[cd_demo_sk#36619,cd_gender#36620,cd_marital_status#36621,cd_education_status#36622,cd_purchase_estimate#36623,cd_credit_rating#36624,cd_dep_count#36625,cd_dep_employed_count#36626,cd_dep_college_count#36627] parquet\n                  :     :     +- Project [ca_address_sk#922, ca_state#930]\n                  :     :        +- Filter ((isnotnull(ca_country#932) && (ca_country#932 = United States)) && isnotnull(ca_address_sk#922))\n                  :     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  :     +- Project [d_date_sk#1040]\n                  :        +- Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n                  :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  +- Project [r_reason_sk#1298, r_reason_desc#1300]\n                     +- Filter isnotnull(r_reason_sk#1298)\n                        +- Relation[r_reason_sk#1298,r_reason_id#1299,r_reason_desc#1300] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[substring(r_reason_desc, 1, 20)#36631 ASC NULLS FIRST,aggOrder#36636 ASC NULLS FIRST,avg(wr_refunded_cash)#36633 ASC NULLS FIRST,avg(wr_fee)#36634 ASC NULLS FIRST], output=[substring(r_reason_desc, 1, 20)#36631,avg(ws_quantity)#36632,avg(wr_refunded_cash)#36633,avg(wr_fee)#36634])\n+- *(12) HashAggregate(keys=[r_reason_desc#1300], functions=[avg(cast(ws_quantity#1772 as bigint)), avg(UnscaledValue(wr_refunded_cash#2136)), avg(UnscaledValue(wr_fee#2134))], output=[substring(r_reason_desc, 1, 20)#36631, avg(ws_quantity)#36632, avg(wr_refunded_cash)#36633, avg(wr_fee)#36634, aggOrder#36636])\n   +- Exchange hashpartitioning(r_reason_desc#1300, 200)\n      +- *(11) HashAggregate(keys=[r_reason_desc#1300], functions=[partial_avg(cast(ws_quantity#1772 as bigint)), partial_avg(UnscaledValue(wr_refunded_cash#2136)), partial_avg(UnscaledValue(wr_fee#2134))], output=[r_reason_desc#1300, sum#36652, count#36653L, sum#36654, count#36655L, sum#36656, count#36657L])\n         +- *(11) Project [ws_quantity#1772, wr_fee#2134, wr_refunded_cash#2136, r_reason_desc#1300]\n            +- *(11) BroadcastHashJoin [wr_reason_sk#2128], [r_reason_sk#1298], Inner, BuildRight\n               :- *(11) Project [ws_quantity#1772, wr_reason_sk#2128, wr_fee#2134, wr_refunded_cash#2136]\n               :  +- *(11) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n               :     :- *(11) Project [ws_quantity#1772, ws_sold_date_sk#1788, wr_reason_sk#2128, wr_fee#2134, wr_refunded_cash#2136]\n               :     :  +- *(11) BroadcastHashJoin [wr_refunded_addr_sk#2122], [ca_address_sk#922], Inner, BuildRight, ((((ca_state#930 IN (IN,OH,NJ) && (ws_net_profit#1787 >= 100.00)) && (ws_net_profit#1787 <= 200.00)) || ((ca_state#930 IN (WI,CT,KY) && (ws_net_profit#1787 >= 150.00)) && (ws_net_profit#1787 <= 300.00))) || ((ca_state#930 IN (LA,IA,AR) && (ws_net_profit#1787 >= 50.00)) && (ws_net_profit#1787 <= 250.00)))\n               :     :     :- *(11) Project [ws_quantity#1772, ws_net_profit#1787, ws_sold_date_sk#1788, wr_refunded_addr_sk#2122, wr_reason_sk#2128, wr_fee#2134, wr_refunded_cash#2136]\n               :     :     :  +- *(11) BroadcastHashJoin [wr_returning_cdemo_sk#2124, cd_marital_status#968, cd_education_status#969], [cd_demo_sk#36619, cd_marital_status#36621, cd_education_status#36622], Inner, BuildRight\n               :     :     :     :- *(11) Project [ws_quantity#1772, ws_net_profit#1787, ws_sold_date_sk#1788, wr_refunded_addr_sk#2122, wr_returning_cdemo_sk#2124, wr_reason_sk#2128, wr_fee#2134, wr_refunded_cash#2136, cd_marital_status#968, cd_education_status#969]\n               :     :     :     :  +- *(11) BroadcastHashJoin [wr_refunded_cdemo_sk#2120], [cd_demo_sk#966], Inner, BuildRight, ((((((cd_marital_status#968 = M) && (cd_education_status#969 = Advanced Degree)) && (ws_sales_price#1775 >= 100.00)) && (ws_sales_price#1775 <= 150.00)) || ((((cd_marital_status#968 = S) && (cd_education_status#969 = College)) && (ws_sales_price#1775 >= 50.00)) && (ws_sales_price#1775 <= 100.00))) || ((((cd_marital_status#968 = W) && (cd_education_status#969 = 2 yr Degree)) && (ws_sales_price#1775 >= 150.00)) && (ws_sales_price#1775 <= 200.00)))\n               :     :     :     :     :- *(11) Project [ws_quantity#1772, ws_sales_price#1775, ws_net_profit#1787, ws_sold_date_sk#1788, wr_refunded_cdemo_sk#2120, wr_refunded_addr_sk#2122, wr_returning_cdemo_sk#2124, wr_reason_sk#2128, wr_fee#2134, wr_refunded_cash#2136]\n               :     :     :     :     :  +- *(11) BroadcastHashJoin [ws_web_page_sk#1766], [wp_web_page_sk#1568], Inner, BuildRight\n               :     :     :     :     :     :- *(11) Project [ws_web_page_sk#1766, ws_quantity#1772, ws_sales_price#1775, ws_net_profit#1787, ws_sold_date_sk#1788, wr_refunded_cdemo_sk#2120, wr_refunded_addr_sk#2122, wr_returning_cdemo_sk#2124, wr_reason_sk#2128, wr_fee#2134, wr_refunded_cash#2136]\n               :     :     :     :     :     :  +- *(11) SortMergeJoin [ws_item_sk#1757, ws_order_number#1771L], [wr_item_sk#2118, wr_order_number#2129L], Inner\n               :     :     :     :     :     :     :- *(2) Sort [ws_item_sk#1757 ASC NULLS FIRST, ws_order_number#1771L ASC NULLS FIRST], false, 0\n               :     :     :     :     :     :     :  +- Exchange hashpartitioning(ws_item_sk#1757, ws_order_number#1771L, 200)\n               :     :     :     :     :     :     :     +- *(1) Project [ws_item_sk#1757, ws_web_page_sk#1766, ws_order_number#1771L, ws_quantity#1772, ws_sales_price#1775, ws_net_profit#1787, ws_sold_date_sk#1788]\n               :     :     :     :     :     :     :        +- *(1) Filter ((isnotnull(ws_item_sk#1757) && isnotnull(ws_order_number#1771L)) && isnotnull(ws_web_page_sk#1766))\n               :     :     :     :     :     :     :           +- *(1) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_web_page_sk#1766,ws_order_number#1771L,ws_quantity#1772,ws_sales_price#1775,ws_net_profit#1787,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_order_number), IsNotNull(ws_web_page_sk)], ReadSchema: struct<ws_item_sk:int,ws_web_page_sk:int,ws_order_number:bigint,ws_quantity:int,ws_sales_price:de...\n               :     :     :     :     :     :     +- *(4) Sort [wr_item_sk#2118 ASC NULLS FIRST, wr_order_number#2129L ASC NULLS FIRST], false, 0\n               :     :     :     :     :     :        +- Exchange hashpartitioning(wr_item_sk#2118, wr_order_number#2129L, 200)\n               :     :     :     :     :     :           +- *(3) Project [wr_item_sk#2118, wr_refunded_cdemo_sk#2120, wr_refunded_addr_sk#2122, wr_returning_cdemo_sk#2124, wr_reason_sk#2128, wr_order_number#2129L, wr_fee#2134, wr_refunded_cash#2136]\n               :     :     :     :     :     :              +- *(3) Filter (((((isnotnull(wr_item_sk#2118) && isnotnull(wr_order_number#2129L)) && isnotnull(wr_refunded_cdemo_sk#2120)) && isnotnull(wr_returning_cdemo_sk#2124)) && isnotnull(wr_refunded_addr_sk#2122)) && isnotnull(wr_reason_sk#2128))\n               :     :     :     :     :     :                 +- *(3) FileScan parquet db_tpcds.web_returns[wr_item_sk#2118,wr_refunded_cdemo_sk#2120,wr_refunded_addr_sk#2122,wr_returning_cdemo_sk#2124,wr_reason_sk#2128,wr_order_number#2129L,wr_fee#2134,wr_refunded_cash#2136,wr_returned_date_sk#2140] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_returns], PartitionCount: 2110, PartitionFilters: [], PushedFilters: [IsNotNull(wr_item_sk), IsNotNull(wr_order_number), IsNotNull(wr_refunded_cdemo_sk), IsNotNull(wr..., ReadSchema: struct<wr_item_sk:int,wr_refunded_cdemo_sk:int,wr_refunded_addr_sk:int,wr_returning_cdemo_sk:int,...\n               :     :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :     :     :        +- *(5) Project [wp_web_page_sk#1568]\n               :     :     :     :     :           +- *(5) Filter isnotnull(wp_web_page_sk#1568)\n               :     :     :     :     :              +- *(5) FileScan parquet db_tpcds.web_page[wp_web_page_sk#1568] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_page], PartitionFilters: [], PushedFilters: [IsNotNull(wp_web_page_sk)], ReadSchema: struct<wp_web_page_sk:int>\n               :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :     :        +- *(6) Project [cd_demo_sk#966, cd_marital_status#968, cd_education_status#969]\n               :     :     :     :           +- *(6) Filter ((isnotnull(cd_demo_sk#966) && isnotnull(cd_marital_status#968)) && isnotnull(cd_education_status#969))\n               :     :     :     :              +- *(6) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_marital_status#968,cd_education_status#969] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_demo_sk), IsNotNull(cd_marital_status), IsNotNull(cd_education_status)], ReadSchema: struct<cd_demo_sk:int,cd_marital_status:string,cd_education_status:string>\n               :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, int, true], input[1, string, true], input[2, string, true]))\n               :     :     :        +- *(7) Project [cd_demo_sk#36619, cd_marital_status#36621, cd_education_status#36622]\n               :     :     :           +- *(7) Filter ((isnotnull(cd_education_status#36622) && isnotnull(cd_marital_status#36621)) && isnotnull(cd_demo_sk#36619))\n               :     :     :              +- *(7) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#36619,cd_marital_status#36621,cd_education_status#36622] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(cd_education_status), IsNotNull(cd_marital_status), IsNotNull(cd_demo_sk)], ReadSchema: struct<cd_demo_sk:int,cd_marital_status:string,cd_education_status:string>\n               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(8) Project [ca_address_sk#922, ca_state#930]\n               :     :           +- *(8) Filter ((isnotnull(ca_country#932) && (ca_country#932 = United States)) && isnotnull(ca_address_sk#922))\n               :     :              +- *(8) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930,ca_country#932] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_country), EqualTo(ca_country,United States), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string,ca_country:string>\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(9) Project [d_date_sk#1040]\n               :           +- *(9) Filter ((isnotnull(d_year#1046) && (d_year#1046 = 2000)) && isnotnull(d_date_sk#1040))\n               :              +- *(9) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2000), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(10) Project [r_reason_sk#1298, r_reason_desc#1300]\n                     +- *(10) Filter isnotnull(r_reason_sk#1298)\n                        +- *(10) FileScan parquet db_tpcds.reason[r_reason_sk#1298,r_reason_desc#1300] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/reason], PartitionFilters: [], PushedFilters: [IsNotNull(r_reason_sk)], ReadSchema: struct<r_reason_sk:int,r_reason_desc:string>"},{"name":"q86-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin"],"tables":["web_sales","date_dim","item"],"parsingTime":0.0022,"analysisTime":0.00127,"optimizationTime":229.641569,"planningTime":10.111865,"executionTime":3354.974203,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['lochierarchy DESC NULLS LAST, CASE WHEN ('lochierarchy = 0) THEN 'i_category END ASC NULLS FIRST, 'rank_within_parent ASC NULLS FIRST], true\n      +- 'Aggregate ['rollup('i_category, 'i_class)], ['sum('ws_net_paid) AS total_sum#36729, 'i_category, 'i_class, ('grouping('i_category) + 'grouping('i_class)) AS lochierarchy#36730, 'rank() windowspecdefinition(('grouping('i_category) + 'grouping('i_class)), CASE WHEN ('grouping('i_class) = 0) THEN 'i_category END, 'sum('ws_net_paid) DESC NULLS LAST, unspecifiedframe$()) AS rank_within_parent#36731]\n         +- 'Filter (((('d1.d_month_seq >= 1200) && ('d1.d_month_seq <= (1200 + 11))) && ('d1.d_date_sk = 'ws_sold_date_sk)) && ('i_item_sk = 'ws_item_sk))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'UnresolvedRelation `web_sales`\n               :  +- 'SubqueryAlias d1\n               :     +- 'UnresolvedRelation `date_dim`\n               +- 'UnresolvedRelation `item`\n\n== Analyzed Logical Plan ==\ntotal_sum: decimal(17,2), i_category: string, i_class: string, lochierarchy: tinyint, rank_within_parent: int\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [lochierarchy#36730 DESC NULLS LAST, CASE WHEN (cast(lochierarchy#36730 as int) = 0) THEN i_category#36739 END ASC NULLS FIRST, rank_within_parent#36731 ASC NULLS FIRST], true\n      +- Project [total_sum#36729, i_category#36739, i_class#36740, lochierarchy#36730, rank_within_parent#36731]\n         +- Project [total_sum#36729, i_category#36739, i_class#36740, lochierarchy#36730, _w0#36749, _w1#36753, _w2#36754, _w3#36755, rank_within_parent#36731, rank_within_parent#36731]\n            +- Window [rank(_w3#36755) windowspecdefinition(_w1#36753, _w2#36754, _w3#36755 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#36731], [_w1#36753, _w2#36754], [_w3#36755 DESC NULLS LAST]\n               +- Aggregate [i_category#36739, i_class#36740, spark_grouping_id#36736], [sum(ws_net_paid#1783) AS total_sum#36729, i_category#36739, i_class#36740, (cast((shiftright(spark_grouping_id#36736, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#36736, 0) & 1) as tinyint)) AS lochierarchy#36730, sum(ws_net_paid#1783) AS _w0#36749, (cast((shiftright(spark_grouping_id#36736, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#36736, 0) & 1) as tinyint)) AS _w1#36753, CASE WHEN (cast(cast((shiftright(spark_grouping_id#36736, 0) & 1) as tinyint) as int) = 0) THEN i_category#36739 END AS _w2#36754, sum(ws_net_paid#1783) AS _w3#36755]\n                  +- Expand [List(ws_sold_time_sk#1755, ws_ship_date_sk#1756, ws_item_sk#1757, ws_bill_customer_sk#1758, ws_bill_cdemo_sk#1759, ws_bill_hdemo_sk#1760, ws_bill_addr_sk#1761, ws_ship_customer_sk#1762, ws_ship_cdemo_sk#1763, ws_ship_hdemo_sk#1764, ws_ship_addr_sk#1765, ws_web_page_sk#1766, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_promo_sk#1770, ws_order_number#1771L, ws_quantity#1772, ws_wholesale_cost#1773, ws_list_price#1774, ws_sales_price#1775, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, ws_ext_tax#1780, ws_coupon_amt#1781, ws_ext_ship_cost#1782, ws_net_paid#1783, ws_net_paid_inc_tax#1784, ws_net_paid_inc_ship#1785, ws_net_paid_inc_ship_tax#1786, ws_net_profit#1787, ws_sold_date_sk#1788, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_category#36737, i_class#36738, 0), List(ws_sold_time_sk#1755, ws_ship_date_sk#1756, ws_item_sk#1757, ws_bill_customer_sk#1758, ws_bill_cdemo_sk#1759, ws_bill_hdemo_sk#1760, ws_bill_addr_sk#1761, ws_ship_customer_sk#1762, ws_ship_cdemo_sk#1763, ws_ship_hdemo_sk#1764, ws_ship_addr_sk#1765, ws_web_page_sk#1766, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_promo_sk#1770, ws_order_number#1771L, ws_quantity#1772, ws_wholesale_cost#1773, ws_list_price#1774, ws_sales_price#1775, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, ws_ext_tax#1780, ws_coupon_amt#1781, ws_ext_ship_cost#1782, ws_net_paid#1783, ws_net_paid_inc_tax#1784, ws_net_paid_inc_ship#1785, ws_net_paid_inc_ship_tax#1786, ws_net_profit#1787, ws_sold_date_sk#1788, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, i_category#36737, null, 1), List(ws_sold_time_sk#1755, ws_ship_date_sk#1756, ws_item_sk#1757, ws_bill_customer_sk#1758, ws_bill_cdemo_sk#1759, ws_bill_hdemo_sk#1760, ws_bill_addr_sk#1761, ws_ship_customer_sk#1762, ws_ship_cdemo_sk#1763, ws_ship_hdemo_sk#1764, ws_ship_addr_sk#1765, ws_web_page_sk#1766, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_promo_sk#1770, ws_order_number#1771L, ws_quantity#1772, ws_wholesale_cost#1773, ws_list_price#1774, ws_sales_price#1775, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ws_ext_list_price#1779, ws_ext_tax#1780, ws_coupon_amt#1781, ws_ext_ship_cost#1782, ws_net_paid#1783, ws_net_paid_inc_tax#1784, ws_net_paid_inc_ship#1785, ws_net_paid_inc_ship_tax#1786, ws_net_profit#1787, ws_sold_date_sk#1788, d_date_sk#1040, d_date_id#1041, d_date#1042, d_month_seq#1043, d_week_seq#1044, d_quarter_seq#1045, d_year#1046, d_dow#1047, d_moy#1048, d_dom#1049, d_qoy#1050, d_fy_year#1051, d_fy_quarter_seq#1052, d_fy_week_seq#1053, d_day_name#1054, d_quarter_name#1055, d_holiday#1056, d_weekend#1057, d_following_holiday#1058, d_first_dom#1059, d_last_dom#1060, d_same_day_ly#1061, d_same_day_lq#1062, d_current_day#1063, d_current_week#1064, d_current_month#1065, d_current_quarter#1066, d_current_year#1067, i_item_sk#1172, i_item_id#1173, i_rec_start_date#1174, i_rec_end_date#1175, i_item_desc#1176, i_current_price#1177, i_wholesale_cost#1178, i_brand_id#1179, i_brand#1180, i_class_id#1181, i_class#1182, i_category_id#1183, i_category#1184, i_manufact_id#1185, i_manufact#1186, i_size#1187, i_formulation#1188, i_color#1189, i_units#1190, i_container#1191, i_manager_id#1192, i_product_name#1193, null, null, 3)], [ws_sold_time_sk#1755, ws_ship_date_sk#1756, ws_item_sk#1757, ws_bill_customer_sk#1758, ws_bill_cdemo_sk#1759, ws_bill_hdemo_sk#1760, ws_bill_addr_sk#1761, ws_ship_customer_sk#1762, ws_ship_cdemo_sk#1763, ws_ship_hdemo_sk#1764, ws_ship_addr_sk#1765, ws_web_page_sk#1766, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_promo_sk#1770, ws_order_number#1771L, ws_quantity#1772, ws_wholesale_cost#1773, ws_list_price#1774, ws_sales_price#1775, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ... 63 more fields]\n                     +- Project [ws_sold_time_sk#1755, ws_ship_date_sk#1756, ws_item_sk#1757, ws_bill_customer_sk#1758, ws_bill_cdemo_sk#1759, ws_bill_hdemo_sk#1760, ws_bill_addr_sk#1761, ws_ship_customer_sk#1762, ws_ship_cdemo_sk#1763, ws_ship_hdemo_sk#1764, ws_ship_addr_sk#1765, ws_web_page_sk#1766, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_promo_sk#1770, ws_order_number#1771L, ws_quantity#1772, ws_wholesale_cost#1773, ws_list_price#1774, ws_sales_price#1775, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ... 62 more fields]\n                        +- Filter ((((d_month_seq#1043 >= 1200) && (d_month_seq#1043 <= (1200 + 11))) && (d_date_sk#1040 = ws_sold_date_sk#1788)) && (i_item_sk#1172 = ws_item_sk#1757))\n                           +- Join Inner\n                              :- Join Inner\n                              :  :- SubqueryAlias web_sales\n                              :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                              :  +- SubqueryAlias d1\n                              :     +- SubqueryAlias date_dim\n                              :        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                              +- SubqueryAlias item\n                                 +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [lochierarchy#36730 DESC NULLS LAST, CASE WHEN (cast(lochierarchy#36730 as int) = 0) THEN i_category#36739 END ASC NULLS FIRST, rank_within_parent#36731 ASC NULLS FIRST], true\n      +- Project [total_sum#36729, i_category#36739, i_class#36740, lochierarchy#36730, rank_within_parent#36731]\n         +- Window [rank(_w3#36755) windowspecdefinition(_w1#36753, _w2#36754, _w3#36755 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#36731], [_w1#36753, _w2#36754], [_w3#36755 DESC NULLS LAST]\n            +- Aggregate [i_category#36739, i_class#36740, spark_grouping_id#36736], [MakeDecimal(sum(UnscaledValue(ws_net_paid#1783)),17,2) AS total_sum#36729, i_category#36739, i_class#36740, (cast((shiftright(spark_grouping_id#36736, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#36736, 0) & 1) as tinyint)) AS lochierarchy#36730, (cast((shiftright(spark_grouping_id#36736, 1) & 1) as tinyint) + cast((shiftright(spark_grouping_id#36736, 0) & 1) as tinyint)) AS _w1#36753, CASE WHEN (cast(cast((shiftright(spark_grouping_id#36736, 0) & 1) as tinyint) as int) = 0) THEN i_category#36739 END AS _w2#36754, MakeDecimal(sum(UnscaledValue(ws_net_paid#1783)),17,2) AS _w3#36755]\n               +- Expand [List(ws_net_paid#1783, i_category#1184, i_class#1182, 0), List(ws_net_paid#1783, i_category#1184, null, 1), List(ws_net_paid#1783, null, null, 3)], [ws_net_paid#1783, i_category#36739, i_class#36740, spark_grouping_id#36736]\n                  +- Project [ws_net_paid#1783, i_category#1184, i_class#1182]\n                     +- Join Inner, (i_item_sk#1172 = ws_item_sk#1757)\n                        :- Project [ws_item_sk#1757, ws_net_paid#1783]\n                        :  +- Join Inner, (d_date_sk#1040 = ws_sold_date_sk#1788)\n                        :     :- Project [ws_item_sk#1757, ws_net_paid#1783, ws_sold_date_sk#1788]\n                        :     :  +- Filter (isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_item_sk#1757))\n                        :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        :     +- Project [d_date_sk#1040]\n                        :        +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Project [i_item_sk#1172, i_class#1182, i_category#1184]\n                           +- Filter isnotnull(i_item_sk#1172)\n                              +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[lochierarchy#36730 DESC NULLS LAST,CASE WHEN (cast(lochierarchy#36730 as int) = 0) THEN i_category#36739 END ASC NULLS FIRST,rank_within_parent#36731 ASC NULLS FIRST], output=[total_sum#36729,i_category#36739,i_class#36740,lochierarchy#36730,rank_within_parent#36731])\n+- *(6) Project [total_sum#36729, i_category#36739, i_class#36740, lochierarchy#36730, rank_within_parent#36731]\n   +- Window [rank(_w3#36755) windowspecdefinition(_w1#36753, _w2#36754, _w3#36755 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#36731], [_w1#36753, _w2#36754], [_w3#36755 DESC NULLS LAST]\n      +- *(5) Sort [_w1#36753 ASC NULLS FIRST, _w2#36754 ASC NULLS FIRST, _w3#36755 DESC NULLS LAST], false, 0\n         +- Exchange hashpartitioning(_w1#36753, _w2#36754, 200)\n            +- *(4) HashAggregate(keys=[i_category#36739, i_class#36740, spark_grouping_id#36736], functions=[sum(UnscaledValue(ws_net_paid#1783))], output=[total_sum#36729, i_category#36739, i_class#36740, lochierarchy#36730, _w1#36753, _w2#36754, _w3#36755])\n               +- Exchange hashpartitioning(i_category#36739, i_class#36740, spark_grouping_id#36736, 200)\n                  +- *(3) HashAggregate(keys=[i_category#36739, i_class#36740, spark_grouping_id#36736], functions=[partial_sum(UnscaledValue(ws_net_paid#1783))], output=[i_category#36739, i_class#36740, spark_grouping_id#36736, sum#36771L])\n                     +- *(3) Expand [List(ws_net_paid#1783, i_category#1184, i_class#1182, 0), List(ws_net_paid#1783, i_category#1184, null, 1), List(ws_net_paid#1783, null, null, 3)], [ws_net_paid#1783, i_category#36739, i_class#36740, spark_grouping_id#36736]\n                        +- *(3) Project [ws_net_paid#1783, i_category#1184, i_class#1182]\n                           +- *(3) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n                              :- *(3) Project [ws_item_sk#1757, ws_net_paid#1783]\n                              :  +- *(3) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n                              :     :- *(3) Project [ws_item_sk#1757, ws_net_paid#1783, ws_sold_date_sk#1788]\n                              :     :  +- *(3) Filter isnotnull(ws_item_sk#1757)\n                              :     :     +- *(3) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_net_paid#1783,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_net_paid:decimal(7,2)>\n                              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :        +- *(1) Project [d_date_sk#1040]\n                              :           +- *(1) Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                              :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_month_seq#1043] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>\n                              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 +- *(2) Project [i_item_sk#1172, i_class#1182, i_category#1184]\n                                    +- *(2) Filter isnotnull(i_item_sk#1172)\n                                       +- *(2) FileScan parquet db_tpcds.item[i_item_sk#1172,i_class#1182,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_class:string,i_category:string>"},{"name":"q87-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","date_dim","customer","catalog_sales","date_dim","customer","web_sales","date_dim","customer"],"parsingTime":0.002845,"analysisTime":0.001131,"optimizationTime":643.286681,"planningTime":61.270204,"executionTime":12253.822626,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'Project [unresolvedalias('count(1), None)]\n+- 'SubqueryAlias cool_cust\n   +- 'Except\n      :- 'Except\n      :  :- 'Distinct\n      :  :  +- 'Project ['c_last_name, 'c_first_name, 'd_date]\n      :  :     +- 'Filter ((('store_sales.ss_sold_date_sk = 'date_dim.d_date_sk) && ('store_sales.ss_customer_sk = 'customer.c_customer_sk)) && (('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11))))\n      :  :        +- 'Join Inner\n      :  :           :- 'Join Inner\n      :  :           :  :- 'UnresolvedRelation `store_sales`\n      :  :           :  +- 'UnresolvedRelation `date_dim`\n      :  :           +- 'UnresolvedRelation `customer`\n      :  +- 'Distinct\n      :     +- 'Project ['c_last_name, 'c_first_name, 'd_date]\n      :        +- 'Filter ((('catalog_sales.cs_sold_date_sk = 'date_dim.d_date_sk) && ('catalog_sales.cs_bill_customer_sk = 'customer.c_customer_sk)) && (('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11))))\n      :           +- 'Join Inner\n      :              :- 'Join Inner\n      :              :  :- 'UnresolvedRelation `catalog_sales`\n      :              :  +- 'UnresolvedRelation `date_dim`\n      :              +- 'UnresolvedRelation `customer`\n      +- 'Distinct\n         +- 'Project ['c_last_name, 'c_first_name, 'd_date]\n            +- 'Filter ((('web_sales.ws_sold_date_sk = 'date_dim.d_date_sk) && ('web_sales.ws_bill_customer_sk = 'customer.c_customer_sk)) && (('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11))))\n               +- 'Join Inner\n                  :- 'Join Inner\n                  :  :- 'UnresolvedRelation `web_sales`\n                  :  +- 'UnresolvedRelation `date_dim`\n                  +- 'UnresolvedRelation `customer`\n\n== Analyzed Logical Plan ==\ncount(1): bigint\nAggregate [count(1) AS count(1)#37076L]\n+- SubqueryAlias cool_cust\n   +- Except\n      :- Project [c_last_name#869, c_first_name#868, d_date#1042]\n      :  +- Except\n      :     :- Project [c_last_name#869, c_first_name#868, d_date#1042]\n      :     :  +- Distinct\n      :     :     +- Project [c_last_name#869, c_first_name#868, d_date#1042]\n      :     :        +- Filter (((ss_sold_date_sk#1926 = d_date_sk#1040) && (ss_customer_sk#1906 = c_customer_sk#860)) && ((d_month_seq#1043 >= 1200) && (d_month_seq#1043 <= (1200 + 11))))\n      :     :           +- Join Inner\n      :     :              :- Join Inner\n      :     :              :  :- SubqueryAlias store_sales\n      :     :              :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :     :              :  +- SubqueryAlias date_dim\n      :     :              :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n      :     :              +- SubqueryAlias customer\n      :     :                 +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n      :     +- Project [c_last_name#37003, c_first_name#37002, d_date#36950]\n      :        +- Distinct\n      :           +- Project [c_last_name#37003, c_first_name#37002, d_date#36950]\n      :              +- Filter (((cs_sold_date_sk#1822 = d_date_sk#36948) && (cs_bill_customer_sk#1791 = c_customer_sk#36994)) && ((d_month_seq#36951 >= 1200) && (d_month_seq#36951 <= (1200 + 11))))\n      :                 +- Join Inner\n      :                    :- Join Inner\n      :                    :  :- SubqueryAlias catalog_sales\n      :                    :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n      :                    :  +- SubqueryAlias date_dim\n      :                    :     +- Relation[d_date_sk#36948,d_date_id#36949,d_date#36950,d_month_seq#36951,d_week_seq#36952,d_quarter_seq#36953,d_year#36954,d_dow#36955,d_moy#36956,d_dom#36957,d_qoy#36958,d_fy_year#36959,d_fy_quarter_seq#36960,d_fy_week_seq#36961,d_day_name#36962,d_quarter_name#36963,d_holiday#36964,d_weekend#36965,d_following_holiday#36966,d_first_dom#36967,d_last_dom#36968,d_same_day_ly#36969,d_same_day_lq#36970,d_current_day#36971,... 4 more fields] parquet\n      :                    +- SubqueryAlias customer\n      :                       +- Relation[c_customer_sk#36994,c_customer_id#36995,c_current_cdemo_sk#36996,c_current_hdemo_sk#36997,c_current_addr_sk#36998,c_first_shipto_date_sk#36999,c_first_sales_date_sk#37000,c_salutation#37001,c_first_name#37002,c_last_name#37003,c_preferred_cust_flag#37004,c_birth_day#37005,c_birth_month#37006,c_birth_year#37007,c_birth_country#37008,c_login#37009,c_email_address#37010,c_last_review_date#37011] parquet\n      +- Project [c_last_name#37067, c_first_name#37066, d_date#37014]\n         +- Distinct\n            +- Project [c_last_name#37067, c_first_name#37066, d_date#37014]\n               +- Filter (((ws_sold_date_sk#1788 = d_date_sk#37012) && (ws_bill_customer_sk#1758 = c_customer_sk#37058)) && ((d_month_seq#37015 >= 1200) && (d_month_seq#37015 <= (1200 + 11))))\n                  +- Join Inner\n                     :- Join Inner\n                     :  :- SubqueryAlias web_sales\n                     :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :  +- SubqueryAlias date_dim\n                     :     +- Relation[d_date_sk#37012,d_date_id#37013,d_date#37014,d_month_seq#37015,d_week_seq#37016,d_quarter_seq#37017,d_year#37018,d_dow#37019,d_moy#37020,d_dom#37021,d_qoy#37022,d_fy_year#37023,d_fy_quarter_seq#37024,d_fy_week_seq#37025,d_day_name#37026,d_quarter_name#37027,d_holiday#37028,d_weekend#37029,d_following_holiday#37030,d_first_dom#37031,d_last_dom#37032,d_same_day_ly#37033,d_same_day_lq#37034,d_current_day#37035,... 4 more fields] parquet\n                     +- SubqueryAlias customer\n                        +- Relation[c_customer_sk#37058,c_customer_id#37059,c_current_cdemo_sk#37060,c_current_hdemo_sk#37061,c_current_addr_sk#37062,c_first_shipto_date_sk#37063,c_first_sales_date_sk#37064,c_salutation#37065,c_first_name#37066,c_last_name#37067,c_preferred_cust_flag#37068,c_birth_day#37069,c_birth_month#37070,c_birth_year#37071,c_birth_country#37072,c_login#37073,c_email_address#37074,c_last_review_date#37075] parquet\n\n== Optimized Logical Plan ==\nAggregate [count(1) AS count(1)#37076L]\n+- Aggregate [c_last_name#869, c_first_name#868, d_date#1042]\n   +- Join LeftAnti, (((c_last_name#869 <=> c_last_name#37067) && (c_first_name#868 <=> c_first_name#37066)) && (d_date#1042 <=> d_date#37014))\n      :- Aggregate [c_last_name#869, c_first_name#868, d_date#1042], [c_last_name#869, c_first_name#868, d_date#1042]\n      :  +- Join LeftAnti, (((c_last_name#869 <=> c_last_name#37003) && (c_first_name#868 <=> c_first_name#37002)) && (d_date#1042 <=> d_date#36950))\n      :     :- Aggregate [c_last_name#869, c_first_name#868, d_date#1042], [c_last_name#869, c_first_name#868, d_date#1042]\n      :     :  +- Project [c_last_name#869, c_first_name#868, d_date#1042]\n      :     :     +- Join Inner, (ss_customer_sk#1906 = c_customer_sk#860)\n      :     :        :- Project [ss_customer_sk#1906, d_date#1042]\n      :     :        :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n      :     :        :     :- Project [ss_customer_sk#1906, ss_sold_date_sk#1926]\n      :     :        :     :  +- Filter (isnotnull(ss_sold_date_sk#1926) && isnotnull(ss_customer_sk#1906))\n      :     :        :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n      :     :        :     +- Project [d_date_sk#1040, d_date#1042]\n      :     :        :        +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n      :     :        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n      :     :        +- Project [c_customer_sk#860, c_first_name#868, c_last_name#869]\n      :     :           +- Filter isnotnull(c_customer_sk#860)\n      :     :              +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n      :     +- Aggregate [c_last_name#37003, c_first_name#37002, d_date#36950], [c_last_name#37003, c_first_name#37002, d_date#36950]\n      :        +- Project [c_last_name#37003, c_first_name#37002, d_date#36950]\n      :           +- Join Inner, (cs_bill_customer_sk#1791 = c_customer_sk#36994)\n      :              :- Project [cs_bill_customer_sk#1791, d_date#36950]\n      :              :  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#36948)\n      :              :     :- Project [cs_bill_customer_sk#1791, cs_sold_date_sk#1822]\n      :              :     :  +- Filter (isnotnull(cs_sold_date_sk#1822) && isnotnull(cs_bill_customer_sk#1791))\n      :              :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n      :              :     +- Project [d_date_sk#36948, d_date#36950]\n      :              :        +- Filter (((isnotnull(d_month_seq#36951) && (d_month_seq#36951 >= 1200)) && (d_month_seq#36951 <= 1211)) && isnotnull(d_date_sk#36948))\n      :              :           +- Relation[d_date_sk#36948,d_date_id#36949,d_date#36950,d_month_seq#36951,d_week_seq#36952,d_quarter_seq#36953,d_year#36954,d_dow#36955,d_moy#36956,d_dom#36957,d_qoy#36958,d_fy_year#36959,d_fy_quarter_seq#36960,d_fy_week_seq#36961,d_day_name#36962,d_quarter_name#36963,d_holiday#36964,d_weekend#36965,d_following_holiday#36966,d_first_dom#36967,d_last_dom#36968,d_same_day_ly#36969,d_same_day_lq#36970,d_current_day#36971,... 4 more fields] parquet\n      :              +- Project [c_customer_sk#36994, c_first_name#37002, c_last_name#37003]\n      :                 +- Filter isnotnull(c_customer_sk#36994)\n      :                    +- Relation[c_customer_sk#36994,c_customer_id#36995,c_current_cdemo_sk#36996,c_current_hdemo_sk#36997,c_current_addr_sk#36998,c_first_shipto_date_sk#36999,c_first_sales_date_sk#37000,c_salutation#37001,c_first_name#37002,c_last_name#37003,c_preferred_cust_flag#37004,c_birth_day#37005,c_birth_month#37006,c_birth_year#37007,c_birth_country#37008,c_login#37009,c_email_address#37010,c_last_review_date#37011] parquet\n      +- Aggregate [c_last_name#37067, c_first_name#37066, d_date#37014], [c_last_name#37067, c_first_name#37066, d_date#37014]\n         +- Project [c_last_name#37067, c_first_name#37066, d_date#37014]\n            +- Join Inner, (ws_bill_customer_sk#1758 = c_customer_sk#37058)\n               :- Project [ws_bill_customer_sk#1758, d_date#37014]\n               :  +- Join Inner, (ws_sold_date_sk#1788 = d_date_sk#37012)\n               :     :- Project [ws_bill_customer_sk#1758, ws_sold_date_sk#1788]\n               :     :  +- Filter (isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_bill_customer_sk#1758))\n               :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     +- Project [d_date_sk#37012, d_date#37014]\n               :        +- Filter (((isnotnull(d_month_seq#37015) && (d_month_seq#37015 >= 1200)) && (d_month_seq#37015 <= 1211)) && isnotnull(d_date_sk#37012))\n               :           +- Relation[d_date_sk#37012,d_date_id#37013,d_date#37014,d_month_seq#37015,d_week_seq#37016,d_quarter_seq#37017,d_year#37018,d_dow#37019,d_moy#37020,d_dom#37021,d_qoy#37022,d_fy_year#37023,d_fy_quarter_seq#37024,d_fy_week_seq#37025,d_day_name#37026,d_quarter_name#37027,d_holiday#37028,d_weekend#37029,d_following_holiday#37030,d_first_dom#37031,d_last_dom#37032,d_same_day_ly#37033,d_same_day_lq#37034,d_current_day#37035,... 4 more fields] parquet\n               +- Project [c_customer_sk#37058, c_first_name#37066, c_last_name#37067]\n                  +- Filter isnotnull(c_customer_sk#37058)\n                     +- Relation[c_customer_sk#37058,c_customer_id#37059,c_current_cdemo_sk#37060,c_current_hdemo_sk#37061,c_current_addr_sk#37062,c_first_shipto_date_sk#37063,c_first_sales_date_sk#37064,c_salutation#37065,c_first_name#37066,c_last_name#37067,c_preferred_cust_flag#37068,c_birth_day#37069,c_birth_month#37070,c_birth_year#37071,c_birth_country#37072,c_login#37073,c_email_address#37074,c_last_review_date#37075] parquet\n\n== Physical Plan ==\n*(21) HashAggregate(keys=[], functions=[count(1)], output=[count(1)#37076L])\n+- Exchange SinglePartition\n   +- *(20) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#37079L])\n      +- *(20) HashAggregate(keys=[c_last_name#869, c_first_name#868, d_date#1042], functions=[], output=[])\n         +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, d_date#1042, 200)\n            +- *(19) HashAggregate(keys=[c_last_name#869, c_first_name#868, d_date#1042], functions=[], output=[c_last_name#869, c_first_name#868, d_date#1042])\n               +- SortMergeJoin [coalesce(c_last_name#869, ), coalesce(c_first_name#868, ), coalesce(d_date#1042, 0)], [coalesce(c_last_name#37067, ), coalesce(c_first_name#37066, ), coalesce(d_date#37014, 0)], LeftAnti, (((c_last_name#869 <=> c_last_name#37067) && (c_first_name#868 <=> c_first_name#37066)) && (d_date#1042 <=> d_date#37014))\n                  :- *(13) Sort [coalesce(c_last_name#869, ) ASC NULLS FIRST, coalesce(c_first_name#868, ) ASC NULLS FIRST, coalesce(d_date#1042, 0) ASC NULLS FIRST], false, 0\n                  :  +- Exchange hashpartitioning(coalesce(c_last_name#869, ), coalesce(c_first_name#868, ), coalesce(d_date#1042, 0), 200)\n                  :     +- *(12) HashAggregate(keys=[c_last_name#869, c_first_name#868, d_date#1042], functions=[], output=[c_last_name#869, c_first_name#868, d_date#1042])\n                  :        +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, d_date#1042, 200)\n                  :           +- *(11) HashAggregate(keys=[c_last_name#869, c_first_name#868, d_date#1042], functions=[], output=[c_last_name#869, c_first_name#868, d_date#1042])\n                  :              +- SortMergeJoin [coalesce(c_last_name#869, ), coalesce(c_first_name#868, ), coalesce(d_date#1042, 0)], [coalesce(c_last_name#37003, ), coalesce(c_first_name#37002, ), coalesce(d_date#36950, 0)], LeftAnti, (((c_last_name#869 <=> c_last_name#37003) && (c_first_name#868 <=> c_first_name#37002)) && (d_date#1042 <=> d_date#36950))\n                  :                 :- *(5) Sort [coalesce(c_last_name#869, ) ASC NULLS FIRST, coalesce(c_first_name#868, ) ASC NULLS FIRST, coalesce(d_date#1042, 0) ASC NULLS FIRST], false, 0\n                  :                 :  +- Exchange hashpartitioning(coalesce(c_last_name#869, ), coalesce(c_first_name#868, ), coalesce(d_date#1042, 0), 200)\n                  :                 :     +- *(4) HashAggregate(keys=[c_last_name#869, c_first_name#868, d_date#1042], functions=[], output=[c_last_name#869, c_first_name#868, d_date#1042])\n                  :                 :        +- Exchange hashpartitioning(c_last_name#869, c_first_name#868, d_date#1042, 200)\n                  :                 :           +- *(3) HashAggregate(keys=[c_last_name#869, c_first_name#868, d_date#1042], functions=[], output=[c_last_name#869, c_first_name#868, d_date#1042])\n                  :                 :              +- *(3) Project [c_last_name#869, c_first_name#868, d_date#1042]\n                  :                 :                 +- *(3) BroadcastHashJoin [ss_customer_sk#1906], [c_customer_sk#860], Inner, BuildRight\n                  :                 :                    :- *(3) Project [ss_customer_sk#1906, d_date#1042]\n                  :                 :                    :  +- *(3) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                  :                 :                    :     :- *(3) Project [ss_customer_sk#1906, ss_sold_date_sk#1926]\n                  :                 :                    :     :  +- *(3) Filter isnotnull(ss_customer_sk#1906)\n                  :                 :                    :     :     +- *(3) FileScan parquet db_tpcds.store_sales[ss_customer_sk#1906,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int>\n                  :                 :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :                 :                    :        +- *(1) Project [d_date_sk#1040, d_date#1042]\n                  :                 :                    :           +- *(1) Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                  :                 :                    :              +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042,d_month_seq#1043] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_date:date,d_month_seq:int>\n                  :                 :                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :                 :                       +- *(2) Project [c_customer_sk#860, c_first_name#868, c_last_name#869]\n                  :                 :                          +- *(2) Filter isnotnull(c_customer_sk#860)\n                  :                 :                             +- *(2) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_first_name#868,c_last_name#869] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int,c_first_name:string,c_last_name:string>\n                  :                 +- *(10) Sort [coalesce(c_last_name#37003, ) ASC NULLS FIRST, coalesce(c_first_name#37002, ) ASC NULLS FIRST, coalesce(d_date#36950, 0) ASC NULLS FIRST], false, 0\n                  :                    +- Exchange hashpartitioning(coalesce(c_last_name#37003, ), coalesce(c_first_name#37002, ), coalesce(d_date#36950, 0), 200)\n                  :                       +- *(9) HashAggregate(keys=[c_last_name#37003, c_first_name#37002, d_date#36950], functions=[], output=[c_last_name#37003, c_first_name#37002, d_date#36950])\n                  :                          +- Exchange hashpartitioning(c_last_name#37003, c_first_name#37002, d_date#36950, 200)\n                  :                             +- *(8) HashAggregate(keys=[c_last_name#37003, c_first_name#37002, d_date#36950], functions=[], output=[c_last_name#37003, c_first_name#37002, d_date#36950])\n                  :                                +- *(8) Project [c_last_name#37003, c_first_name#37002, d_date#36950]\n                  :                                   +- *(8) BroadcastHashJoin [cs_bill_customer_sk#1791], [c_customer_sk#36994], Inner, BuildRight\n                  :                                      :- *(8) Project [cs_bill_customer_sk#1791, d_date#36950]\n                  :                                      :  +- *(8) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#36948], Inner, BuildRight\n                  :                                      :     :- *(8) Project [cs_bill_customer_sk#1791, cs_sold_date_sk#1822]\n                  :                                      :     :  +- *(8) Filter isnotnull(cs_bill_customer_sk#1791)\n                  :                                      :     :     +- *(8) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [IsNotNull(cs_bill_customer_sk)], ReadSchema: struct<cs_bill_customer_sk:int>\n                  :                                      :     +- ReusedExchange [d_date_sk#36948, d_date#36950], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :                                      +- ReusedExchange [c_customer_sk#36994, c_first_name#37002, c_last_name#37003], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(18) Sort [coalesce(c_last_name#37067, ) ASC NULLS FIRST, coalesce(c_first_name#37066, ) ASC NULLS FIRST, coalesce(d_date#37014, 0) ASC NULLS FIRST], false, 0\n                     +- Exchange hashpartitioning(coalesce(c_last_name#37067, ), coalesce(c_first_name#37066, ), coalesce(d_date#37014, 0), 200)\n                        +- *(17) HashAggregate(keys=[c_last_name#37067, c_first_name#37066, d_date#37014], functions=[], output=[c_last_name#37067, c_first_name#37066, d_date#37014])\n                           +- Exchange hashpartitioning(c_last_name#37067, c_first_name#37066, d_date#37014, 200)\n                              +- *(16) HashAggregate(keys=[c_last_name#37067, c_first_name#37066, d_date#37014], functions=[], output=[c_last_name#37067, c_first_name#37066, d_date#37014])\n                                 +- *(16) Project [c_last_name#37067, c_first_name#37066, d_date#37014]\n                                    +- *(16) BroadcastHashJoin [ws_bill_customer_sk#1758], [c_customer_sk#37058], Inner, BuildRight\n                                       :- *(16) Project [ws_bill_customer_sk#1758, d_date#37014]\n                                       :  +- *(16) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#37012], Inner, BuildRight\n                                       :     :- *(16) Project [ws_bill_customer_sk#1758, ws_sold_date_sk#1788]\n                                       :     :  +- *(16) Filter isnotnull(ws_bill_customer_sk#1758)\n                                       :     :     +- *(16) FileScan parquet db_tpcds.web_sales[ws_bill_customer_sk#1758,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_bill_customer_sk)], ReadSchema: struct<ws_bill_customer_sk:int>\n                                       :     +- ReusedExchange [d_date_sk#37012, d_date#37014], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                       +- ReusedExchange [c_customer_sk#37058, c_first_name#37066, c_last_name#37067], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q88-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastNestedLoopJoin","BroadcastNestedLoopJoin","BroadcastNestedLoopJoin","BroadcastNestedLoopJoin","BroadcastNestedLoopJoin","BroadcastNestedLoopJoin","BroadcastNestedLoopJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","household_demographics","time_dim","store","store_sales","household_demographics","time_dim","store","store_sales","household_demographics","time_dim","store","store_sales","household_demographics","time_dim","store","store_sales","household_demographics","time_dim","store","store_sales","household_demographics","time_dim","store","store_sales","household_demographics","time_dim","store","store_sales","household_demographics","time_dim","store"],"parsingTime":0.002002,"analysisTime":0.001186,"optimizationTime":264.879434,"planningTime":4198.932654,"executionTime":8396.851928,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'Project [*]\n+- 'Join Cross\n   :- 'Join Cross\n   :  :- 'Join Cross\n   :  :  :- 'Join Cross\n   :  :  :  :- 'Join Cross\n   :  :  :  :  :- 'Join Cross\n   :  :  :  :  :  :- 'Join Cross\n   :  :  :  :  :  :  :- 'SubqueryAlias s1\n   :  :  :  :  :  :  :  +- 'Project ['count(1) AS h8_30_to_9#37252]\n   :  :  :  :  :  :  :     +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) && ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) && (('ss_store_sk = 's_store_sk) && ('time_dim.t_hour = 8))) && ((('time_dim.t_minute >= 30) && (((('household_demographics.hd_dep_count = 4) && ('household_demographics.hd_vehicle_count <= (4 + 2))) || (('household_demographics.hd_dep_count = 2) && ('household_demographics.hd_vehicle_count <= (2 + 2)))) || (('household_demographics.hd_dep_count = 0) && ('household_demographics.hd_vehicle_count <= (0 + 2))))) && ('store.s_store_name = ese)))\n   :  :  :  :  :  :  :        +- 'Join Inner\n   :  :  :  :  :  :  :           :- 'Join Inner\n   :  :  :  :  :  :  :           :  :- 'Join Inner\n   :  :  :  :  :  :  :           :  :  :- 'UnresolvedRelation `store_sales`\n   :  :  :  :  :  :  :           :  :  +- 'UnresolvedRelation `household_demographics`\n   :  :  :  :  :  :  :           :  +- 'UnresolvedRelation `time_dim`\n   :  :  :  :  :  :  :           +- 'UnresolvedRelation `store`\n   :  :  :  :  :  :  +- 'SubqueryAlias s2\n   :  :  :  :  :  :     +- 'Project ['count(1) AS h9_to_9_30#37253]\n   :  :  :  :  :  :        +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) && ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) && (('ss_store_sk = 's_store_sk) && ('time_dim.t_hour = 9))) && ((('time_dim.t_minute < 30) && (((('household_demographics.hd_dep_count = 4) && ('household_demographics.hd_vehicle_count <= (4 + 2))) || (('household_demographics.hd_dep_count = 2) && ('household_demographics.hd_vehicle_count <= (2 + 2)))) || (('household_demographics.hd_dep_count = 0) && ('household_demographics.hd_vehicle_count <= (0 + 2))))) && ('store.s_store_name = ese)))\n   :  :  :  :  :  :           +- 'Join Inner\n   :  :  :  :  :  :              :- 'Join Inner\n   :  :  :  :  :  :              :  :- 'Join Inner\n   :  :  :  :  :  :              :  :  :- 'UnresolvedRelation `store_sales`\n   :  :  :  :  :  :              :  :  +- 'UnresolvedRelation `household_demographics`\n   :  :  :  :  :  :              :  +- 'UnresolvedRelation `time_dim`\n   :  :  :  :  :  :              +- 'UnresolvedRelation `store`\n   :  :  :  :  :  +- 'SubqueryAlias s3\n   :  :  :  :  :     +- 'Project ['count(1) AS h9_30_to_10#37254]\n   :  :  :  :  :        +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) && ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) && (('ss_store_sk = 's_store_sk) && ('time_dim.t_hour = 9))) && ((('time_dim.t_minute >= 30) && (((('household_demographics.hd_dep_count = 4) && ('household_demographics.hd_vehicle_count <= (4 + 2))) || (('household_demographics.hd_dep_count = 2) && ('household_demographics.hd_vehicle_count <= (2 + 2)))) || (('household_demographics.hd_dep_count = 0) && ('household_demographics.hd_vehicle_count <= (0 + 2))))) && ('store.s_store_name = ese)))\n   :  :  :  :  :           +- 'Join Inner\n   :  :  :  :  :              :- 'Join Inner\n   :  :  :  :  :              :  :- 'Join Inner\n   :  :  :  :  :              :  :  :- 'UnresolvedRelation `store_sales`\n   :  :  :  :  :              :  :  +- 'UnresolvedRelation `household_demographics`\n   :  :  :  :  :              :  +- 'UnresolvedRelation `time_dim`\n   :  :  :  :  :              +- 'UnresolvedRelation `store`\n   :  :  :  :  +- 'SubqueryAlias s4\n   :  :  :  :     +- 'Project ['count(1) AS h10_to_10_30#37255]\n   :  :  :  :        +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) && ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) && (('ss_store_sk = 's_store_sk) && ('time_dim.t_hour = 10))) && ((('time_dim.t_minute < 30) && (((('household_demographics.hd_dep_count = 4) && ('household_demographics.hd_vehicle_count <= (4 + 2))) || (('household_demographics.hd_dep_count = 2) && ('household_demographics.hd_vehicle_count <= (2 + 2)))) || (('household_demographics.hd_dep_count = 0) && ('household_demographics.hd_vehicle_count <= (0 + 2))))) && ('store.s_store_name = ese)))\n   :  :  :  :           +- 'Join Inner\n   :  :  :  :              :- 'Join Inner\n   :  :  :  :              :  :- 'Join Inner\n   :  :  :  :              :  :  :- 'UnresolvedRelation `store_sales`\n   :  :  :  :              :  :  +- 'UnresolvedRelation `household_demographics`\n   :  :  :  :              :  +- 'UnresolvedRelation `time_dim`\n   :  :  :  :              +- 'UnresolvedRelation `store`\n   :  :  :  +- 'SubqueryAlias s5\n   :  :  :     +- 'Project ['count(1) AS h10_30_to_11#37256]\n   :  :  :        +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) && ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) && (('ss_store_sk = 's_store_sk) && ('time_dim.t_hour = 10))) && ((('time_dim.t_minute >= 30) && (((('household_demographics.hd_dep_count = 4) && ('household_demographics.hd_vehicle_count <= (4 + 2))) || (('household_demographics.hd_dep_count = 2) && ('household_demographics.hd_vehicle_count <= (2 + 2)))) || (('household_demographics.hd_dep_count = 0) && ('household_demographics.hd_vehicle_count <= (0 + 2))))) && ('store.s_store_name = ese)))\n   :  :  :           +- 'Join Inner\n   :  :  :              :- 'Join Inner\n   :  :  :              :  :- 'Join Inner\n   :  :  :              :  :  :- 'UnresolvedRelation `store_sales`\n   :  :  :              :  :  +- 'UnresolvedRelation `household_demographics`\n   :  :  :              :  +- 'UnresolvedRelation `time_dim`\n   :  :  :              +- 'UnresolvedRelation `store`\n   :  :  +- 'SubqueryAlias s6\n   :  :     +- 'Project ['count(1) AS h11_to_11_30#37257]\n   :  :        +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) && ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) && (('ss_store_sk = 's_store_sk) && ('time_dim.t_hour = 11))) && ((('time_dim.t_minute < 30) && (((('household_demographics.hd_dep_count = 4) && ('household_demographics.hd_vehicle_count <= (4 + 2))) || (('household_demographics.hd_dep_count = 2) && ('household_demographics.hd_vehicle_count <= (2 + 2)))) || (('household_demographics.hd_dep_count = 0) && ('household_demographics.hd_vehicle_count <= (0 + 2))))) && ('store.s_store_name = ese)))\n   :  :           +- 'Join Inner\n   :  :              :- 'Join Inner\n   :  :              :  :- 'Join Inner\n   :  :              :  :  :- 'UnresolvedRelation `store_sales`\n   :  :              :  :  +- 'UnresolvedRelation `household_demographics`\n   :  :              :  +- 'UnresolvedRelation `time_dim`\n   :  :              +- 'UnresolvedRelation `store`\n   :  +- 'SubqueryAlias s7\n   :     +- 'Project ['count(1) AS h11_30_to_12#37258]\n   :        +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) && ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) && (('ss_store_sk = 's_store_sk) && ('time_dim.t_hour = 11))) && ((('time_dim.t_minute >= 30) && (((('household_demographics.hd_dep_count = 4) && ('household_demographics.hd_vehicle_count <= (4 + 2))) || (('household_demographics.hd_dep_count = 2) && ('household_demographics.hd_vehicle_count <= (2 + 2)))) || (('household_demographics.hd_dep_count = 0) && ('household_demographics.hd_vehicle_count <= (0 + 2))))) && ('store.s_store_name = ese)))\n   :           +- 'Join Inner\n   :              :- 'Join Inner\n   :              :  :- 'Join Inner\n   :              :  :  :- 'UnresolvedRelation `store_sales`\n   :              :  :  +- 'UnresolvedRelation `household_demographics`\n   :              :  +- 'UnresolvedRelation `time_dim`\n   :              +- 'UnresolvedRelation `store`\n   +- 'SubqueryAlias s8\n      +- 'Project ['count(1) AS h12_to_12_30#37259]\n         +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) && ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) && (('ss_store_sk = 's_store_sk) && ('time_dim.t_hour = 12))) && ((('time_dim.t_minute < 30) && (((('household_demographics.hd_dep_count = 4) && ('household_demographics.hd_vehicle_count <= (4 + 2))) || (('household_demographics.hd_dep_count = 2) && ('household_demographics.hd_vehicle_count <= (2 + 2)))) || (('household_demographics.hd_dep_count = 0) && ('household_demographics.hd_vehicle_count <= (0 + 2))))) && ('store.s_store_name = ese)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'UnresolvedRelation `store_sales`\n               :  :  +- 'UnresolvedRelation `household_demographics`\n               :  +- 'UnresolvedRelation `time_dim`\n               +- 'UnresolvedRelation `store`\n\n== Analyzed Logical Plan ==\nh8_30_to_9: bigint, h9_to_9_30: bigint, h9_30_to_10: bigint, h10_to_10_30: bigint, h10_30_to_11: bigint, h11_to_11_30: bigint, h11_30_to_12: bigint, h12_to_12_30: bigint\nProject [h8_30_to_9#37252L, h9_to_9_30#37253L, h9_30_to_10#37254L, h10_to_10_30#37255L, h10_30_to_11#37256L, h11_to_11_30#37257L, h11_30_to_12#37258L, h12_to_12_30#37259L]\n+- Join Cross\n   :- Join Cross\n   :  :- Join Cross\n   :  :  :- Join Cross\n   :  :  :  :- Join Cross\n   :  :  :  :  :- Join Cross\n   :  :  :  :  :  :- Join Cross\n   :  :  :  :  :  :  :- SubqueryAlias s1\n   :  :  :  :  :  :  :  +- Aggregate [count(1) AS h8_30_to_9#37252L]\n   :  :  :  :  :  :  :     +- Filter ((((ss_sold_time_sk#1904 = t_time_sk#1464) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && ((ss_store_sk#1910 = s_store_sk#1386) && (t_hour#1467 = 8))) && (((t_minute#1468 >= 30) && ((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= (4 + 2))) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= (2 + 2)))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= (0 + 2))))) && (s_store_name#1391 = ese)))\n   :  :  :  :  :  :  :        +- Join Inner\n   :  :  :  :  :  :  :           :- Join Inner\n   :  :  :  :  :  :  :           :  :- Join Inner\n   :  :  :  :  :  :  :           :  :  :- SubqueryAlias store_sales\n   :  :  :  :  :  :  :           :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n   :  :  :  :  :  :  :           :  :  +- SubqueryAlias household_demographics\n   :  :  :  :  :  :  :           :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n   :  :  :  :  :  :  :           :  +- SubqueryAlias time_dim\n   :  :  :  :  :  :  :           :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n   :  :  :  :  :  :  :           +- SubqueryAlias store\n   :  :  :  :  :  :  :              +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n   :  :  :  :  :  :  +- SubqueryAlias s2\n   :  :  :  :  :  :     +- Aggregate [count(1) AS h9_to_9_30#37253L]\n   :  :  :  :  :  :        +- Filter ((((ss_sold_time_sk#1904 = t_time_sk#1464) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && ((ss_store_sk#1910 = s_store_sk#1386) && (t_hour#1467 = 9))) && (((t_minute#1468 < 30) && ((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= (4 + 2))) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= (2 + 2)))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= (0 + 2))))) && (s_store_name#1391 = ese)))\n   :  :  :  :  :  :           +- Join Inner\n   :  :  :  :  :  :              :- Join Inner\n   :  :  :  :  :  :              :  :- Join Inner\n   :  :  :  :  :  :              :  :  :- SubqueryAlias store_sales\n   :  :  :  :  :  :              :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n   :  :  :  :  :  :              :  :  +- SubqueryAlias household_demographics\n   :  :  :  :  :  :              :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n   :  :  :  :  :  :              :  +- SubqueryAlias time_dim\n   :  :  :  :  :  :              :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n   :  :  :  :  :  :              +- SubqueryAlias store\n   :  :  :  :  :  :                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n   :  :  :  :  :  +- SubqueryAlias s3\n   :  :  :  :  :     +- Aggregate [count(1) AS h9_30_to_10#37254L]\n   :  :  :  :  :        +- Filter ((((ss_sold_time_sk#1904 = t_time_sk#1464) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && ((ss_store_sk#1910 = s_store_sk#1386) && (t_hour#1467 = 9))) && (((t_minute#1468 >= 30) && ((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= (4 + 2))) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= (2 + 2)))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= (0 + 2))))) && (s_store_name#1391 = ese)))\n   :  :  :  :  :           +- Join Inner\n   :  :  :  :  :              :- Join Inner\n   :  :  :  :  :              :  :- Join Inner\n   :  :  :  :  :              :  :  :- SubqueryAlias store_sales\n   :  :  :  :  :              :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n   :  :  :  :  :              :  :  +- SubqueryAlias household_demographics\n   :  :  :  :  :              :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n   :  :  :  :  :              :  +- SubqueryAlias time_dim\n   :  :  :  :  :              :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n   :  :  :  :  :              +- SubqueryAlias store\n   :  :  :  :  :                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n   :  :  :  :  +- SubqueryAlias s4\n   :  :  :  :     +- Aggregate [count(1) AS h10_to_10_30#37255L]\n   :  :  :  :        +- Filter ((((ss_sold_time_sk#1904 = t_time_sk#1464) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && ((ss_store_sk#1910 = s_store_sk#1386) && (t_hour#1467 = 10))) && (((t_minute#1468 < 30) && ((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= (4 + 2))) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= (2 + 2)))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= (0 + 2))))) && (s_store_name#1391 = ese)))\n   :  :  :  :           +- Join Inner\n   :  :  :  :              :- Join Inner\n   :  :  :  :              :  :- Join Inner\n   :  :  :  :              :  :  :- SubqueryAlias store_sales\n   :  :  :  :              :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n   :  :  :  :              :  :  +- SubqueryAlias household_demographics\n   :  :  :  :              :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n   :  :  :  :              :  +- SubqueryAlias time_dim\n   :  :  :  :              :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n   :  :  :  :              +- SubqueryAlias store\n   :  :  :  :                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n   :  :  :  +- SubqueryAlias s5\n   :  :  :     +- Aggregate [count(1) AS h10_30_to_11#37256L]\n   :  :  :        +- Filter ((((ss_sold_time_sk#1904 = t_time_sk#1464) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && ((ss_store_sk#1910 = s_store_sk#1386) && (t_hour#1467 = 10))) && (((t_minute#1468 >= 30) && ((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= (4 + 2))) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= (2 + 2)))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= (0 + 2))))) && (s_store_name#1391 = ese)))\n   :  :  :           +- Join Inner\n   :  :  :              :- Join Inner\n   :  :  :              :  :- Join Inner\n   :  :  :              :  :  :- SubqueryAlias store_sales\n   :  :  :              :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n   :  :  :              :  :  +- SubqueryAlias household_demographics\n   :  :  :              :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n   :  :  :              :  +- SubqueryAlias time_dim\n   :  :  :              :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n   :  :  :              +- SubqueryAlias store\n   :  :  :                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n   :  :  +- SubqueryAlias s6\n   :  :     +- Aggregate [count(1) AS h11_to_11_30#37257L]\n   :  :        +- Filter ((((ss_sold_time_sk#1904 = t_time_sk#1464) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && ((ss_store_sk#1910 = s_store_sk#1386) && (t_hour#1467 = 11))) && (((t_minute#1468 < 30) && ((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= (4 + 2))) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= (2 + 2)))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= (0 + 2))))) && (s_store_name#1391 = ese)))\n   :  :           +- Join Inner\n   :  :              :- Join Inner\n   :  :              :  :- Join Inner\n   :  :              :  :  :- SubqueryAlias store_sales\n   :  :              :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n   :  :              :  :  +- SubqueryAlias household_demographics\n   :  :              :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n   :  :              :  +- SubqueryAlias time_dim\n   :  :              :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n   :  :              +- SubqueryAlias store\n   :  :                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n   :  +- SubqueryAlias s7\n   :     +- Aggregate [count(1) AS h11_30_to_12#37258L]\n   :        +- Filter ((((ss_sold_time_sk#1904 = t_time_sk#1464) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && ((ss_store_sk#1910 = s_store_sk#1386) && (t_hour#1467 = 11))) && (((t_minute#1468 >= 30) && ((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= (4 + 2))) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= (2 + 2)))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= (0 + 2))))) && (s_store_name#1391 = ese)))\n   :           +- Join Inner\n   :              :- Join Inner\n   :              :  :- Join Inner\n   :              :  :  :- SubqueryAlias store_sales\n   :              :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n   :              :  :  +- SubqueryAlias household_demographics\n   :              :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n   :              :  +- SubqueryAlias time_dim\n   :              :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n   :              +- SubqueryAlias store\n   :                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n   +- SubqueryAlias s8\n      +- Aggregate [count(1) AS h12_to_12_30#37259L]\n         +- Filter ((((ss_sold_time_sk#1904 = t_time_sk#1464) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && ((ss_store_sk#1910 = s_store_sk#1386) && (t_hour#1467 = 12))) && (((t_minute#1468 < 30) && ((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= (4 + 2))) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= (2 + 2)))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= (0 + 2))))) && (s_store_name#1391 = ese)))\n            +- Join Inner\n               :- Join Inner\n               :  :- Join Inner\n               :  :  :- SubqueryAlias store_sales\n               :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :  :  +- SubqueryAlias household_demographics\n               :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n               :  +- SubqueryAlias time_dim\n               :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n               +- SubqueryAlias store\n                  +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Optimized Logical Plan ==\nJoin Cross\n:- Join Cross\n:  :- Join Cross\n:  :  :- Join Cross\n:  :  :  :- Join Cross\n:  :  :  :  :- Join Cross\n:  :  :  :  :  :- Join Cross\n:  :  :  :  :  :  :- Aggregate [count(1) AS h8_30_to_9#37252L]\n:  :  :  :  :  :  :  +- Project\n:  :  :  :  :  :  :     +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n:  :  :  :  :  :  :        :- Project [ss_store_sk#1910]\n:  :  :  :  :  :  :        :  +- Join Inner, (ss_sold_time_sk#1904 = t_time_sk#1464)\n:  :  :  :  :  :  :        :     :- Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:  :  :  :  :  :  :        :     :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n:  :  :  :  :  :  :        :     :     :- Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:  :  :  :  :  :  :        :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:  :  :  :  :  :  :        :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :  :  :  :  :  :        :     :     +- Project [hd_demo_sk#1106]\n:  :  :  :  :  :  :        :     :        +- Filter (((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= 6)) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= 4))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= 2))) && isnotnull(hd_demo_sk#1106))\n:  :  :  :  :  :  :        :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n:  :  :  :  :  :  :        :     +- Project [t_time_sk#1464]\n:  :  :  :  :  :  :        :        +- Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 8)) && (t_minute#1468 >= 30)) && isnotnull(t_time_sk#1464))\n:  :  :  :  :  :  :        :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n:  :  :  :  :  :  :        +- Project [s_store_sk#1386]\n:  :  :  :  :  :  :           +- Filter ((isnotnull(s_store_name#1391) && (s_store_name#1391 = ese)) && isnotnull(s_store_sk#1386))\n:  :  :  :  :  :  :              +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n:  :  :  :  :  :  +- Aggregate [count(1) AS h9_to_9_30#37253L]\n:  :  :  :  :  :     +- Project\n:  :  :  :  :  :        +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n:  :  :  :  :  :           :- Project [ss_store_sk#1910]\n:  :  :  :  :  :           :  +- Join Inner, (ss_sold_time_sk#1904 = t_time_sk#1464)\n:  :  :  :  :  :           :     :- Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:  :  :  :  :  :           :     :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n:  :  :  :  :  :           :     :     :- Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:  :  :  :  :  :           :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:  :  :  :  :  :           :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :  :  :  :  :           :     :     +- Project [hd_demo_sk#1106]\n:  :  :  :  :  :           :     :        +- Filter (((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= 6)) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= 4))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= 2))) && isnotnull(hd_demo_sk#1106))\n:  :  :  :  :  :           :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n:  :  :  :  :  :           :     +- Project [t_time_sk#1464]\n:  :  :  :  :  :           :        +- Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 9)) && (t_minute#1468 < 30)) && isnotnull(t_time_sk#1464))\n:  :  :  :  :  :           :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n:  :  :  :  :  :           +- Project [s_store_sk#1386]\n:  :  :  :  :  :              +- Filter ((isnotnull(s_store_name#1391) && (s_store_name#1391 = ese)) && isnotnull(s_store_sk#1386))\n:  :  :  :  :  :                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n:  :  :  :  :  +- Aggregate [count(1) AS h9_30_to_10#37254L]\n:  :  :  :  :     +- Project\n:  :  :  :  :        +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n:  :  :  :  :           :- Project [ss_store_sk#1910]\n:  :  :  :  :           :  +- Join Inner, (ss_sold_time_sk#1904 = t_time_sk#1464)\n:  :  :  :  :           :     :- Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:  :  :  :  :           :     :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n:  :  :  :  :           :     :     :- Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:  :  :  :  :           :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:  :  :  :  :           :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :  :  :  :           :     :     +- Project [hd_demo_sk#1106]\n:  :  :  :  :           :     :        +- Filter (((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= 6)) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= 4))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= 2))) && isnotnull(hd_demo_sk#1106))\n:  :  :  :  :           :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n:  :  :  :  :           :     +- Project [t_time_sk#1464]\n:  :  :  :  :           :        +- Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 9)) && (t_minute#1468 >= 30)) && isnotnull(t_time_sk#1464))\n:  :  :  :  :           :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n:  :  :  :  :           +- Project [s_store_sk#1386]\n:  :  :  :  :              +- Filter ((isnotnull(s_store_name#1391) && (s_store_name#1391 = ese)) && isnotnull(s_store_sk#1386))\n:  :  :  :  :                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n:  :  :  :  +- Aggregate [count(1) AS h10_to_10_30#37255L]\n:  :  :  :     +- Project\n:  :  :  :        +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n:  :  :  :           :- Project [ss_store_sk#1910]\n:  :  :  :           :  +- Join Inner, (ss_sold_time_sk#1904 = t_time_sk#1464)\n:  :  :  :           :     :- Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:  :  :  :           :     :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n:  :  :  :           :     :     :- Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:  :  :  :           :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:  :  :  :           :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :  :  :           :     :     +- Project [hd_demo_sk#1106]\n:  :  :  :           :     :        +- Filter (((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= 6)) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= 4))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= 2))) && isnotnull(hd_demo_sk#1106))\n:  :  :  :           :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n:  :  :  :           :     +- Project [t_time_sk#1464]\n:  :  :  :           :        +- Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 10)) && (t_minute#1468 < 30)) && isnotnull(t_time_sk#1464))\n:  :  :  :           :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n:  :  :  :           +- Project [s_store_sk#1386]\n:  :  :  :              +- Filter ((isnotnull(s_store_name#1391) && (s_store_name#1391 = ese)) && isnotnull(s_store_sk#1386))\n:  :  :  :                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n:  :  :  +- Aggregate [count(1) AS h10_30_to_11#37256L]\n:  :  :     +- Project\n:  :  :        +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n:  :  :           :- Project [ss_store_sk#1910]\n:  :  :           :  +- Join Inner, (ss_sold_time_sk#1904 = t_time_sk#1464)\n:  :  :           :     :- Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:  :  :           :     :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n:  :  :           :     :     :- Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:  :  :           :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:  :  :           :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :  :           :     :     +- Project [hd_demo_sk#1106]\n:  :  :           :     :        +- Filter (((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= 6)) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= 4))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= 2))) && isnotnull(hd_demo_sk#1106))\n:  :  :           :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n:  :  :           :     +- Project [t_time_sk#1464]\n:  :  :           :        +- Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 10)) && (t_minute#1468 >= 30)) && isnotnull(t_time_sk#1464))\n:  :  :           :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n:  :  :           +- Project [s_store_sk#1386]\n:  :  :              +- Filter ((isnotnull(s_store_name#1391) && (s_store_name#1391 = ese)) && isnotnull(s_store_sk#1386))\n:  :  :                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n:  :  +- Aggregate [count(1) AS h11_to_11_30#37257L]\n:  :     +- Project\n:  :        +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n:  :           :- Project [ss_store_sk#1910]\n:  :           :  +- Join Inner, (ss_sold_time_sk#1904 = t_time_sk#1464)\n:  :           :     :- Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:  :           :     :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n:  :           :     :     :- Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:  :           :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:  :           :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:  :           :     :     +- Project [hd_demo_sk#1106]\n:  :           :     :        +- Filter (((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= 6)) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= 4))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= 2))) && isnotnull(hd_demo_sk#1106))\n:  :           :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n:  :           :     +- Project [t_time_sk#1464]\n:  :           :        +- Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 11)) && (t_minute#1468 < 30)) && isnotnull(t_time_sk#1464))\n:  :           :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n:  :           +- Project [s_store_sk#1386]\n:  :              +- Filter ((isnotnull(s_store_name#1391) && (s_store_name#1391 = ese)) && isnotnull(s_store_sk#1386))\n:  :                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n:  +- Aggregate [count(1) AS h11_30_to_12#37258L]\n:     +- Project\n:        +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n:           :- Project [ss_store_sk#1910]\n:           :  +- Join Inner, (ss_sold_time_sk#1904 = t_time_sk#1464)\n:           :     :- Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:           :     :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n:           :     :     :- Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:           :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:           :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n:           :     :     +- Project [hd_demo_sk#1106]\n:           :     :        +- Filter (((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= 6)) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= 4))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= 2))) && isnotnull(hd_demo_sk#1106))\n:           :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n:           :     +- Project [t_time_sk#1464]\n:           :        +- Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 11)) && (t_minute#1468 >= 30)) && isnotnull(t_time_sk#1464))\n:           :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n:           +- Project [s_store_sk#1386]\n:              +- Filter ((isnotnull(s_store_name#1391) && (s_store_name#1391 = ese)) && isnotnull(s_store_sk#1386))\n:                 +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n+- Aggregate [count(1) AS h12_to_12_30#37259L]\n   +- Project\n      +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n         :- Project [ss_store_sk#1910]\n         :  +- Join Inner, (ss_sold_time_sk#1904 = t_time_sk#1464)\n         :     :- Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n         :     :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n         :     :     :- Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n         :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n         :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :     :     +- Project [hd_demo_sk#1106]\n         :     :        +- Filter (((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= 6)) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= 4))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= 2))) && isnotnull(hd_demo_sk#1106))\n         :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n         :     +- Project [t_time_sk#1464]\n         :        +- Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 12)) && (t_minute#1468 < 30)) && isnotnull(t_time_sk#1464))\n         :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n         +- Project [s_store_sk#1386]\n            +- Filter ((isnotnull(s_store_name#1391) && (s_store_name#1391 = ese)) && isnotnull(s_store_sk#1386))\n               +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Physical Plan ==\nBroadcastNestedLoopJoin BuildRight, Cross\n:- BroadcastNestedLoopJoin BuildRight, Cross\n:  :- BroadcastNestedLoopJoin BuildRight, Cross\n:  :  :- BroadcastNestedLoopJoin BuildRight, Cross\n:  :  :  :- BroadcastNestedLoopJoin BuildRight, Cross\n:  :  :  :  :- BroadcastNestedLoopJoin BuildRight, Cross\n:  :  :  :  :  :- BroadcastNestedLoopJoin BuildRight, Cross\n:  :  :  :  :  :  :- *(5) HashAggregate(keys=[], functions=[count(1)], output=[h8_30_to_9#37252L])\n:  :  :  :  :  :  :  +- Exchange SinglePartition\n:  :  :  :  :  :  :     +- *(4) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#37277L])\n:  :  :  :  :  :  :        +- *(4) Project\n:  :  :  :  :  :  :           +- *(4) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n:  :  :  :  :  :  :              :- *(4) Project [ss_store_sk#1910]\n:  :  :  :  :  :  :              :  +- *(4) BroadcastHashJoin [ss_sold_time_sk#1904], [t_time_sk#1464], Inner, BuildRight\n:  :  :  :  :  :  :              :     :- *(4) Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:  :  :  :  :  :  :              :     :  +- *(4) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n:  :  :  :  :  :  :              :     :     :- *(4) Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:  :  :  :  :  :  :              :     :     :  +- *(4) Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:  :  :  :  :  :  :              :     :     :     +- *(4) FileScan parquet db_tpcds.store_sales[ss_sold_time_sk#1904,ss_hdemo_sk#1908,ss_store_sk#1910,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:int,ss_hdemo_sk:int,ss_store_sk:int>\n:  :  :  :  :  :  :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :  :  :  :  :              :     :        +- *(1) Project [hd_demo_sk#1106]\n:  :  :  :  :  :  :              :     :           +- *(1) Filter (((((hd_dep_count#1109 = 4) && (hd_vehicle_count#1110 <= 6)) || ((hd_dep_count#1109 = 2) && (hd_vehicle_count#1110 <= 4))) || ((hd_dep_count#1109 = 0) && (hd_vehicle_count#1110 <= 2))) && isnotnull(hd_demo_sk#1106))\n:  :  :  :  :  :  :              :     :              +- *(1) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_dep_count#1109,hd_vehicle_count#1110] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [Or(Or(And(EqualTo(hd_dep_count,4),LessThanOrEqual(hd_vehicle_count,6)),And(EqualTo(hd_dep_count,..., ReadSchema: struct<hd_demo_sk:int,hd_dep_count:int,hd_vehicle_count:int>\n:  :  :  :  :  :  :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :  :  :  :  :              :        +- *(2) Project [t_time_sk#1464]\n:  :  :  :  :  :  :              :           +- *(2) Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 8)) && (t_minute#1468 >= 30)) && isnotnull(t_time_sk#1464))\n:  :  :  :  :  :  :              :              +- *(2) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_hour#1467,t_minute#1468] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,8), GreaterThanOrEqual(t_minute,30), IsNo..., ReadSchema: struct<t_time_sk:int,t_hour:int,t_minute:int>\n:  :  :  :  :  :  :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :  :  :  :  :                 +- *(3) Project [s_store_sk#1386]\n:  :  :  :  :  :  :                    +- *(3) Filter ((isnotnull(s_store_name#1391) && (s_store_name#1391 = ese)) && isnotnull(s_store_sk#1386))\n:  :  :  :  :  :  :                       +- *(3) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_name#1391] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_name), EqualTo(s_store_name,ese), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_store_name:string>\n:  :  :  :  :  :  +- BroadcastExchange IdentityBroadcastMode\n:  :  :  :  :  :     +- *(10) HashAggregate(keys=[], functions=[count(1)], output=[h9_to_9_30#37253L])\n:  :  :  :  :  :        +- Exchange SinglePartition\n:  :  :  :  :  :           +- *(9) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#37279L])\n:  :  :  :  :  :              +- *(9) Project\n:  :  :  :  :  :                 +- *(9) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n:  :  :  :  :  :                    :- *(9) Project [ss_store_sk#1910]\n:  :  :  :  :  :                    :  +- *(9) BroadcastHashJoin [ss_sold_time_sk#1904], [t_time_sk#1464], Inner, BuildRight\n:  :  :  :  :  :                    :     :- *(9) Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:  :  :  :  :  :                    :     :  +- *(9) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n:  :  :  :  :  :                    :     :     :- *(9) Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:  :  :  :  :  :                    :     :     :  +- *(9) Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:  :  :  :  :  :                    :     :     :     +- *(9) FileScan parquet db_tpcds.store_sales[ss_sold_time_sk#1904,ss_hdemo_sk#1908,ss_store_sk#1910,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:int,ss_hdemo_sk:int,ss_store_sk:int>\n:  :  :  :  :  :                    :     :     +- ReusedExchange [hd_demo_sk#1106], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :  :  :  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :  :  :  :                    :        +- *(7) Project [t_time_sk#1464]\n:  :  :  :  :  :                    :           +- *(7) Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 9)) && (t_minute#1468 < 30)) && isnotnull(t_time_sk#1464))\n:  :  :  :  :  :                    :              +- *(7) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_hour#1467,t_minute#1468] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,9), LessThan(t_minute,30), IsNotNull(t_ti..., ReadSchema: struct<t_time_sk:int,t_hour:int,t_minute:int>\n:  :  :  :  :  :                    +- ReusedExchange [s_store_sk#1386], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :  :  :  +- BroadcastExchange IdentityBroadcastMode\n:  :  :  :  :     +- *(15) HashAggregate(keys=[], functions=[count(1)], output=[h9_30_to_10#37254L])\n:  :  :  :  :        +- Exchange SinglePartition\n:  :  :  :  :           +- *(14) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#37281L])\n:  :  :  :  :              +- *(14) Project\n:  :  :  :  :                 +- *(14) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n:  :  :  :  :                    :- *(14) Project [ss_store_sk#1910]\n:  :  :  :  :                    :  +- *(14) BroadcastHashJoin [ss_sold_time_sk#1904], [t_time_sk#1464], Inner, BuildRight\n:  :  :  :  :                    :     :- *(14) Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:  :  :  :  :                    :     :  +- *(14) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n:  :  :  :  :                    :     :     :- *(14) Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:  :  :  :  :                    :     :     :  +- *(14) Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:  :  :  :  :                    :     :     :     +- *(14) FileScan parquet db_tpcds.store_sales[ss_sold_time_sk#1904,ss_hdemo_sk#1908,ss_store_sk#1910,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:int,ss_hdemo_sk:int,ss_store_sk:int>\n:  :  :  :  :                    :     :     +- ReusedExchange [hd_demo_sk#1106], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :  :  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :  :  :                    :        +- *(12) Project [t_time_sk#1464]\n:  :  :  :  :                    :           +- *(12) Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 9)) && (t_minute#1468 >= 30)) && isnotnull(t_time_sk#1464))\n:  :  :  :  :                    :              +- *(12) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_hour#1467,t_minute#1468] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,9), GreaterThanOrEqual(t_minute,30), IsNo..., ReadSchema: struct<t_time_sk:int,t_hour:int,t_minute:int>\n:  :  :  :  :                    +- ReusedExchange [s_store_sk#1386], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :  :  +- BroadcastExchange IdentityBroadcastMode\n:  :  :  :     +- *(20) HashAggregate(keys=[], functions=[count(1)], output=[h10_to_10_30#37255L])\n:  :  :  :        +- Exchange SinglePartition\n:  :  :  :           +- *(19) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#37283L])\n:  :  :  :              +- *(19) Project\n:  :  :  :                 +- *(19) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n:  :  :  :                    :- *(19) Project [ss_store_sk#1910]\n:  :  :  :                    :  +- *(19) BroadcastHashJoin [ss_sold_time_sk#1904], [t_time_sk#1464], Inner, BuildRight\n:  :  :  :                    :     :- *(19) Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:  :  :  :                    :     :  +- *(19) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n:  :  :  :                    :     :     :- *(19) Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:  :  :  :                    :     :     :  +- *(19) Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:  :  :  :                    :     :     :     +- *(19) FileScan parquet db_tpcds.store_sales[ss_sold_time_sk#1904,ss_hdemo_sk#1908,ss_store_sk#1910,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:int,ss_hdemo_sk:int,ss_store_sk:int>\n:  :  :  :                    :     :     +- ReusedExchange [hd_demo_sk#1106], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :  :                    :        +- *(17) Project [t_time_sk#1464]\n:  :  :  :                    :           +- *(17) Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 10)) && (t_minute#1468 < 30)) && isnotnull(t_time_sk#1464))\n:  :  :  :                    :              +- *(17) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_hour#1467,t_minute#1468] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,10), LessThan(t_minute,30), IsNotNull(t_t..., ReadSchema: struct<t_time_sk:int,t_hour:int,t_minute:int>\n:  :  :  :                    +- ReusedExchange [s_store_sk#1386], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :  +- BroadcastExchange IdentityBroadcastMode\n:  :  :     +- *(25) HashAggregate(keys=[], functions=[count(1)], output=[h10_30_to_11#37256L])\n:  :  :        +- Exchange SinglePartition\n:  :  :           +- *(24) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#37285L])\n:  :  :              +- *(24) Project\n:  :  :                 +- *(24) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n:  :  :                    :- *(24) Project [ss_store_sk#1910]\n:  :  :                    :  +- *(24) BroadcastHashJoin [ss_sold_time_sk#1904], [t_time_sk#1464], Inner, BuildRight\n:  :  :                    :     :- *(24) Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:  :  :                    :     :  +- *(24) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n:  :  :                    :     :     :- *(24) Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:  :  :                    :     :     :  +- *(24) Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:  :  :                    :     :     :     +- *(24) FileScan parquet db_tpcds.store_sales[ss_sold_time_sk#1904,ss_hdemo_sk#1908,ss_store_sk#1910,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:int,ss_hdemo_sk:int,ss_store_sk:int>\n:  :  :                    :     :     +- ReusedExchange [hd_demo_sk#1106], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  :                    :        +- *(22) Project [t_time_sk#1464]\n:  :  :                    :           +- *(22) Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 10)) && (t_minute#1468 >= 30)) && isnotnull(t_time_sk#1464))\n:  :  :                    :              +- *(22) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_hour#1467,t_minute#1468] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,10), GreaterThanOrEqual(t_minute,30), IsN..., ReadSchema: struct<t_time_sk:int,t_hour:int,t_minute:int>\n:  :  :                    +- ReusedExchange [s_store_sk#1386], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :  +- BroadcastExchange IdentityBroadcastMode\n:  :     +- *(30) HashAggregate(keys=[], functions=[count(1)], output=[h11_to_11_30#37257L])\n:  :        +- Exchange SinglePartition\n:  :           +- *(29) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#37287L])\n:  :              +- *(29) Project\n:  :                 +- *(29) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n:  :                    :- *(29) Project [ss_store_sk#1910]\n:  :                    :  +- *(29) BroadcastHashJoin [ss_sold_time_sk#1904], [t_time_sk#1464], Inner, BuildRight\n:  :                    :     :- *(29) Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:  :                    :     :  +- *(29) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n:  :                    :     :     :- *(29) Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:  :                    :     :     :  +- *(29) Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:  :                    :     :     :     +- *(29) FileScan parquet db_tpcds.store_sales[ss_sold_time_sk#1904,ss_hdemo_sk#1908,ss_store_sk#1910,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:int,ss_hdemo_sk:int,ss_store_sk:int>\n:  :                    :     :     +- ReusedExchange [hd_demo_sk#1106], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  :                    :        +- *(27) Project [t_time_sk#1464]\n:  :                    :           +- *(27) Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 11)) && (t_minute#1468 < 30)) && isnotnull(t_time_sk#1464))\n:  :                    :              +- *(27) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_hour#1467,t_minute#1468] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,11), LessThan(t_minute,30), IsNotNull(t_t..., ReadSchema: struct<t_time_sk:int,t_hour:int,t_minute:int>\n:  :                    +- ReusedExchange [s_store_sk#1386], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:  +- BroadcastExchange IdentityBroadcastMode\n:     +- *(35) HashAggregate(keys=[], functions=[count(1)], output=[h11_30_to_12#37258L])\n:        +- Exchange SinglePartition\n:           +- *(34) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#37289L])\n:              +- *(34) Project\n:                 +- *(34) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n:                    :- *(34) Project [ss_store_sk#1910]\n:                    :  +- *(34) BroadcastHashJoin [ss_sold_time_sk#1904], [t_time_sk#1464], Inner, BuildRight\n:                    :     :- *(34) Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n:                    :     :  +- *(34) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n:                    :     :     :- *(34) Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n:                    :     :     :  +- *(34) Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n:                    :     :     :     +- *(34) FileScan parquet db_tpcds.store_sales[ss_sold_time_sk#1904,ss_hdemo_sk#1908,ss_store_sk#1910,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:int,ss_hdemo_sk:int,ss_store_sk:int>\n:                    :     :     +- ReusedExchange [hd_demo_sk#1106], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:                    :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n:                    :        +- *(32) Project [t_time_sk#1464]\n:                    :           +- *(32) Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 11)) && (t_minute#1468 >= 30)) && isnotnull(t_time_sk#1464))\n:                    :              +- *(32) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_hour#1467,t_minute#1468] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,11), GreaterThanOrEqual(t_minute,30), IsN..., ReadSchema: struct<t_time_sk:int,t_hour:int,t_minute:int>\n:                    +- ReusedExchange [s_store_sk#1386], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n+- BroadcastExchange IdentityBroadcastMode\n   +- *(40) HashAggregate(keys=[], functions=[count(1)], output=[h12_to_12_30#37259L])\n      +- Exchange SinglePartition\n         +- *(39) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#37291L])\n            +- *(39) Project\n               +- *(39) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                  :- *(39) Project [ss_store_sk#1910]\n                  :  +- *(39) BroadcastHashJoin [ss_sold_time_sk#1904], [t_time_sk#1464], Inner, BuildRight\n                  :     :- *(39) Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n                  :     :  +- *(39) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n                  :     :     :- *(39) Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n                  :     :     :  +- *(39) Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n                  :     :     :     +- *(39) FileScan parquet db_tpcds.store_sales[ss_sold_time_sk#1904,ss_hdemo_sk#1908,ss_store_sk#1910,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:int,ss_hdemo_sk:int,ss_store_sk:int>\n                  :     :     +- ReusedExchange [hd_demo_sk#1106], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :        +- *(37) Project [t_time_sk#1464]\n                  :           +- *(37) Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 12)) && (t_minute#1468 < 30)) && isnotnull(t_time_sk#1464))\n                  :              +- *(37) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_hour#1467,t_minute#1468] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,12), LessThan(t_minute,30), IsNotNull(t_t..., ReadSchema: struct<t_time_sk:int,t_hour:int,t_minute:int>\n                  +- ReusedExchange [s_store_sk#1386], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q89-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["item","store_sales","date_dim","store"],"parsingTime":0.002332,"analysisTime":0.0015,"optimizationTime":286.134594,"planningTime":11.926098,"executionTime":4174.011358,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort [('sum_sales - 'avg_monthly_sales) ASC NULLS FIRST, 's_store_name ASC NULLS FIRST], true\n      +- 'Project [*]\n         +- 'Filter (CASE WHEN NOT ('avg_monthly_sales = 0) THEN ('abs(('sum_sales - 'avg_monthly_sales)) / 'avg_monthly_sales) ELSE null END > 0.1)\n            +- 'SubqueryAlias tmp1\n               +- 'Aggregate ['i_category, 'i_class, 'i_brand, 's_store_name, 's_company_name, 'd_moy], ['i_category, 'i_class, 'i_brand, 's_store_name, 's_company_name, 'd_moy, 'sum('ss_sales_price) AS sum_sales#37333, 'avg('sum('ss_sales_price)) windowspecdefinition('i_category, 'i_brand, 's_store_name, 's_company_name, unspecifiedframe$()) AS avg_monthly_sales#37334]\n                  +- 'Filter (((('ss_item_sk = 'i_item_sk) && ('ss_sold_date_sk = 'd_date_sk)) && ('ss_store_sk = 's_store_sk)) && ('d_year IN (1999) && (('i_category IN (Books,Electronics,Sports) && 'i_class IN (computers,stereo,football)) || ('i_category IN (Men,Jewelry,Women) && 'i_class IN (shirts,birdal,dresses)))))\n                     +- 'Join Inner\n                        :- 'Join Inner\n                        :  :- 'Join Inner\n                        :  :  :- 'UnresolvedRelation `item`\n                        :  :  +- 'UnresolvedRelation `store_sales`\n                        :  +- 'UnresolvedRelation `date_dim`\n                        +- 'UnresolvedRelation `store`\n\n== Analyzed Logical Plan ==\ni_category: string, i_class: string, i_brand: string, s_store_name: string, s_company_name: string, d_moy: int, sum_sales: decimal(17,2), avg_monthly_sales: decimal(21,6)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [CheckOverflow((promote_precision(cast(sum_sales#37333 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#37334 as decimal(22,6)))), DecimalType(22,6)) ASC NULLS FIRST, s_store_name#1391 ASC NULLS FIRST], true\n      +- Project [i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048, sum_sales#37333, avg_monthly_sales#37334]\n         +- Filter (cast(CASE WHEN NOT (cast(avg_monthly_sales#37334 as decimal(21,6)) = cast(cast(0 as decimal(1,0)) as decimal(21,6))) THEN CheckOverflow((promote_precision(cast(abs(CheckOverflow((promote_precision(cast(sum_sales#37333 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#37334 as decimal(22,6)))), DecimalType(22,6))) as decimal(22,6))) / promote_precision(cast(avg_monthly_sales#37334 as decimal(22,6)))), DecimalType(38,16)) ELSE cast(null as decimal(38,16)) END as decimal(38,16)) > cast(0.1 as decimal(38,16)))\n            +- SubqueryAlias tmp1\n               +- Project [i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048, sum_sales#37333, avg_monthly_sales#37334]\n                  +- Project [i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048, sum_sales#37333, _w0#37338, avg_monthly_sales#37334, avg_monthly_sales#37334]\n                     +- Window [avg(_w0#37338) windowspecdefinition(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#37334], [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403]\n                        +- Aggregate [i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048], [i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048, sum(ss_sales_price#1916) AS sum_sales#37333, sum(ss_sales_price#1916) AS _w0#37338]\n                           +- Filter ((((ss_item_sk#1905 = i_item_sk#1172) && (ss_sold_date_sk#1926 = d_date_sk#1040)) && (ss_store_sk#1910 = s_store_sk#1386)) && (d_year#1046 IN (1999) && ((i_category#1184 IN (Books,Electronics,Sports) && i_class#1182 IN (computers,stereo,football)) || (i_category#1184 IN (Men,Jewelry,Women) && i_class#1182 IN (shirts,birdal,dresses)))))\n                              +- Join Inner\n                                 :- Join Inner\n                                 :  :- Join Inner\n                                 :  :  :- SubqueryAlias item\n                                 :  :  :  +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                                 :  :  +- SubqueryAlias store_sales\n                                 :  :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                                 :  +- SubqueryAlias date_dim\n                                 :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                                 +- SubqueryAlias store\n                                    +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [CheckOverflow((promote_precision(cast(sum_sales#37333 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#37334 as decimal(22,6)))), DecimalType(22,6)) ASC NULLS FIRST, s_store_name#1391 ASC NULLS FIRST], true\n      +- Project [i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048, sum_sales#37333, avg_monthly_sales#37334]\n         +- Filter (CASE WHEN NOT (avg_monthly_sales#37334 = 0.000000) THEN CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#37333 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#37334 as decimal(22,6)))), DecimalType(22,6)))) / promote_precision(cast(avg_monthly_sales#37334 as decimal(22,6)))), DecimalType(38,16)) ELSE null END > 0.1000000000000000)\n            +- Window [avg(_w0#37338) windowspecdefinition(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#37334], [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403]\n               +- Aggregate [i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048], [i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS sum_sales#37333, MakeDecimal(sum(UnscaledValue(ss_sales_price#1916)),17,2) AS _w0#37338]\n                  +- Project [i_brand#1180, i_class#1182, i_category#1184, ss_sales_price#1916, d_moy#1048, s_store_name#1391, s_company_name#1403]\n                     +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n                        :- Project [i_brand#1180, i_class#1182, i_category#1184, ss_store_sk#1910, ss_sales_price#1916, d_moy#1048]\n                        :  +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                        :     :- Project [i_brand#1180, i_class#1182, i_category#1184, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                        :     :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                        :     :     :- Project [i_item_sk#1172, i_brand#1180, i_class#1182, i_category#1184]\n                        :     :     :  +- Filter (((i_category#1184 IN (Books,Electronics,Sports) && i_class#1182 IN (computers,stereo,football)) || (i_category#1184 IN (Men,Jewelry,Women) && i_class#1182 IN (shirts,birdal,dresses))) && isnotnull(i_item_sk#1172))\n                        :     :     :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                        :     :     +- Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                        :     :        +- Filter ((isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926)) && isnotnull(ss_store_sk#1910))\n                        :     :           +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                        :     +- Project [d_date_sk#1040, d_moy#1048]\n                        :        +- Filter (d_year#1046 IN (1999) && isnotnull(d_date_sk#1040))\n                        :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                        +- Project [s_store_sk#1386, s_store_name#1391, s_company_name#1403]\n                           +- Filter isnotnull(s_store_sk#1386)\n                              +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[CheckOverflow((promote_precision(cast(sum_sales#37333 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#37334 as decimal(22,6)))), DecimalType(22,6)) ASC NULLS FIRST,s_store_name#1391 ASC NULLS FIRST], output=[i_category#1184,i_class#1182,i_brand#1180,s_store_name#1391,s_company_name#1403,d_moy#1048,sum_sales#37333,avg_monthly_sales#37334])\n+- *(7) Project [i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048, sum_sales#37333, avg_monthly_sales#37334]\n   +- *(7) Filter (CASE WHEN NOT (avg_monthly_sales#37334 = 0.000000) THEN CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#37333 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#37334 as decimal(22,6)))), DecimalType(22,6)))) / promote_precision(cast(avg_monthly_sales#37334 as decimal(22,6)))), DecimalType(38,16)) ELSE null END > 0.1000000000000000)\n      +- Window [avg(_w0#37338) windowspecdefinition(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#37334], [i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403]\n         +- *(6) Sort [i_category#1184 ASC NULLS FIRST, i_brand#1180 ASC NULLS FIRST, s_store_name#1391 ASC NULLS FIRST, s_company_name#1403 ASC NULLS FIRST], false, 0\n            +- Exchange hashpartitioning(i_category#1184, i_brand#1180, s_store_name#1391, s_company_name#1403, 200)\n               +- *(5) HashAggregate(keys=[i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048], functions=[sum(UnscaledValue(ss_sales_price#1916))], output=[i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048, sum_sales#37333, _w0#37338])\n                  +- Exchange hashpartitioning(i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048, 200)\n                     +- *(4) HashAggregate(keys=[i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048], functions=[partial_sum(UnscaledValue(ss_sales_price#1916))], output=[i_category#1184, i_class#1182, i_brand#1180, s_store_name#1391, s_company_name#1403, d_moy#1048, sum#37348L])\n                        +- *(4) Project [i_brand#1180, i_class#1182, i_category#1184, ss_sales_price#1916, d_moy#1048, s_store_name#1391, s_company_name#1403]\n                           +- *(4) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n                              :- *(4) Project [i_brand#1180, i_class#1182, i_category#1184, ss_store_sk#1910, ss_sales_price#1916, d_moy#1048]\n                              :  +- *(4) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                              :     :- *(4) Project [i_brand#1180, i_class#1182, i_category#1184, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                              :     :  +- *(4) BroadcastHashJoin [i_item_sk#1172], [ss_item_sk#1905], Inner, BuildLeft\n                              :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :     :     :  +- *(1) Project [i_item_sk#1172, i_brand#1180, i_class#1182, i_category#1184]\n                              :     :     :     +- *(1) Filter (((i_category#1184 IN (Books,Electronics,Sports) && i_class#1182 IN (computers,stereo,football)) || (i_category#1184 IN (Men,Jewelry,Women) && i_class#1182 IN (shirts,birdal,dresses))) && isnotnull(i_item_sk#1172))\n                              :     :     :        +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_brand#1180,i_class#1182,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [Or(And(In(i_category, [Books,Electronics,Sports]),In(i_class, [computers,stereo,football])),And(..., ReadSchema: struct<i_item_sk:int,i_brand:string,i_class:string,i_category:string>\n                              :     :     +- *(4) Project [ss_item_sk#1905, ss_store_sk#1910, ss_sales_price#1916, ss_sold_date_sk#1926]\n                              :     :        +- *(4) Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_store_sk#1910))\n                              :     :           +- *(4) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_store_sk#1910,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>\n                              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                              :        +- *(2) Project [d_date_sk#1040, d_moy#1048]\n                              :           +- *(2) Filter (d_year#1046 IN (1999) && isnotnull(d_date_sk#1040))\n                              :              +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [In(d_year, [1999]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n                              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 +- *(3) Project [s_store_sk#1386, s_store_name#1391, s_company_name#1403]\n                                    +- *(3) Filter isnotnull(s_store_sk#1386)\n                                       +- *(3) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_name#1391,s_company_name#1403] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>"},{"name":"q90-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastNestedLoopJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["web_sales","household_demographics","time_dim","web_page","web_sales","household_demographics","time_dim","web_page"],"parsingTime":0.002345,"analysisTime":0.001083,"optimizationTime":63.483627,"planningTime":850.459848,"executionTime":2009.353919,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['am_pm_ratio ASC NULLS FIRST], true\n      +- 'Project [(cast('amc as decimal(15,4)) / cast('pmc as decimal(15,4))) AS am_pm_ratio#37776]\n         +- 'Join Cross\n            :- 'SubqueryAlias at\n            :  +- 'Project ['count(1) AS amc#37774]\n            :     +- 'Filter (((('ws_sold_time_sk = 'time_dim.t_time_sk) && ('ws_ship_hdemo_sk = 'household_demographics.hd_demo_sk)) && ('ws_web_page_sk = 'web_page.wp_web_page_sk)) && (((('time_dim.t_hour >= 8) && ('time_dim.t_hour <= (8 + 1))) && ('household_demographics.hd_dep_count = 6)) && (('web_page.wp_char_count >= 5000) && ('web_page.wp_char_count <= 5200))))\n            :        +- 'Join Inner\n            :           :- 'Join Inner\n            :           :  :- 'Join Inner\n            :           :  :  :- 'UnresolvedRelation `web_sales`\n            :           :  :  +- 'UnresolvedRelation `household_demographics`\n            :           :  +- 'UnresolvedRelation `time_dim`\n            :           +- 'UnresolvedRelation `web_page`\n            +- 'SubqueryAlias pt\n               +- 'Project ['count(1) AS pmc#37775]\n                  +- 'Filter (((('ws_sold_time_sk = 'time_dim.t_time_sk) && ('ws_ship_hdemo_sk = 'household_demographics.hd_demo_sk)) && ('ws_web_page_sk = 'web_page.wp_web_page_sk)) && (((('time_dim.t_hour >= 19) && ('time_dim.t_hour <= (19 + 1))) && ('household_demographics.hd_dep_count = 6)) && (('web_page.wp_char_count >= 5000) && ('web_page.wp_char_count <= 5200))))\n                     +- 'Join Inner\n                        :- 'Join Inner\n                        :  :- 'Join Inner\n                        :  :  :- 'UnresolvedRelation `web_sales`\n                        :  :  +- 'UnresolvedRelation `household_demographics`\n                        :  +- 'UnresolvedRelation `time_dim`\n                        +- 'UnresolvedRelation `web_page`\n\n== Analyzed Logical Plan ==\nam_pm_ratio: decimal(35,20)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [am_pm_ratio#37776 ASC NULLS FIRST], true\n      +- Project [CheckOverflow((promote_precision(cast(cast(amc#37774L as decimal(15,4)) as decimal(15,4))) / promote_precision(cast(cast(pmc#37775L as decimal(15,4)) as decimal(15,4)))), DecimalType(35,20)) AS am_pm_ratio#37776]\n         +- Join Cross\n            :- SubqueryAlias at\n            :  +- Aggregate [count(1) AS amc#37774L]\n            :     +- Filter ((((ws_sold_time_sk#1755 = t_time_sk#1464) && (ws_ship_hdemo_sk#1764 = hd_demo_sk#1106)) && (ws_web_page_sk#1766 = wp_web_page_sk#1568)) && ((((t_hour#1467 >= 8) && (t_hour#1467 <= (8 + 1))) && (hd_dep_count#1109 = 6)) && ((wp_char_count#1578 >= 5000) && (wp_char_count#1578 <= 5200))))\n            :        +- Join Inner\n            :           :- Join Inner\n            :           :  :- Join Inner\n            :           :  :  :- SubqueryAlias web_sales\n            :           :  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :           :  :  +- SubqueryAlias household_demographics\n            :           :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n            :           :  +- SubqueryAlias time_dim\n            :           :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n            :           +- SubqueryAlias web_page\n            :              +- Relation[wp_web_page_sk#1568,wp_web_page_id#1569,wp_rec_start_date#1570,wp_rec_end_date#1571,wp_creation_date_sk#1572,wp_access_date_sk#1573,wp_autogen_flag#1574,wp_customer_sk#1575,wp_url#1576,wp_type#1577,wp_char_count#1578,wp_link_count#1579,wp_image_count#1580,wp_max_ad_count#1581] parquet\n            +- SubqueryAlias pt\n               +- Aggregate [count(1) AS pmc#37775L]\n                  +- Filter ((((ws_sold_time_sk#1755 = t_time_sk#1464) && (ws_ship_hdemo_sk#1764 = hd_demo_sk#1106)) && (ws_web_page_sk#1766 = wp_web_page_sk#1568)) && ((((t_hour#1467 >= 19) && (t_hour#1467 <= (19 + 1))) && (hd_dep_count#1109 = 6)) && ((wp_char_count#1578 >= 5000) && (wp_char_count#1578 <= 5200))))\n                     +- Join Inner\n                        :- Join Inner\n                        :  :- Join Inner\n                        :  :  :- SubqueryAlias web_sales\n                        :  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                        :  :  +- SubqueryAlias household_demographics\n                        :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n                        :  +- SubqueryAlias time_dim\n                        :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n                        +- SubqueryAlias web_page\n                           +- Relation[wp_web_page_sk#1568,wp_web_page_id#1569,wp_rec_start_date#1570,wp_rec_end_date#1571,wp_creation_date_sk#1572,wp_access_date_sk#1573,wp_autogen_flag#1574,wp_customer_sk#1575,wp_url#1576,wp_type#1577,wp_char_count#1578,wp_link_count#1579,wp_image_count#1580,wp_max_ad_count#1581] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [am_pm_ratio#37776 ASC NULLS FIRST], true\n      +- Project [CheckOverflow((promote_precision(cast(amc#37774L as decimal(15,4))) / promote_precision(cast(pmc#37775L as decimal(15,4)))), DecimalType(35,20)) AS am_pm_ratio#37776]\n         +- Join Cross\n            :- Aggregate [count(1) AS amc#37774L]\n            :  +- Project\n            :     +- Join Inner, (ws_web_page_sk#1766 = wp_web_page_sk#1568)\n            :        :- Project [ws_web_page_sk#1766]\n            :        :  +- Join Inner, (ws_sold_time_sk#1755 = t_time_sk#1464)\n            :        :     :- Project [ws_sold_time_sk#1755, ws_web_page_sk#1766]\n            :        :     :  +- Join Inner, (ws_ship_hdemo_sk#1764 = hd_demo_sk#1106)\n            :        :     :     :- Project [ws_sold_time_sk#1755, ws_ship_hdemo_sk#1764, ws_web_page_sk#1766]\n            :        :     :     :  +- Filter ((isnotnull(ws_ship_hdemo_sk#1764) && isnotnull(ws_sold_time_sk#1755)) && isnotnull(ws_web_page_sk#1766))\n            :        :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n            :        :     :     +- Project [hd_demo_sk#1106]\n            :        :     :        +- Filter ((isnotnull(hd_dep_count#1109) && (hd_dep_count#1109 = 6)) && isnotnull(hd_demo_sk#1106))\n            :        :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n            :        :     +- Project [t_time_sk#1464]\n            :        :        +- Filter (((isnotnull(t_hour#1467) && (t_hour#1467 >= 8)) && (t_hour#1467 <= 9)) && isnotnull(t_time_sk#1464))\n            :        :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n            :        +- Project [wp_web_page_sk#1568]\n            :           +- Filter (((isnotnull(wp_char_count#1578) && (wp_char_count#1578 >= 5000)) && (wp_char_count#1578 <= 5200)) && isnotnull(wp_web_page_sk#1568))\n            :              +- Relation[wp_web_page_sk#1568,wp_web_page_id#1569,wp_rec_start_date#1570,wp_rec_end_date#1571,wp_creation_date_sk#1572,wp_access_date_sk#1573,wp_autogen_flag#1574,wp_customer_sk#1575,wp_url#1576,wp_type#1577,wp_char_count#1578,wp_link_count#1579,wp_image_count#1580,wp_max_ad_count#1581] parquet\n            +- Aggregate [count(1) AS pmc#37775L]\n               +- Project\n                  +- Join Inner, (ws_web_page_sk#1766 = wp_web_page_sk#1568)\n                     :- Project [ws_web_page_sk#1766]\n                     :  +- Join Inner, (ws_sold_time_sk#1755 = t_time_sk#1464)\n                     :     :- Project [ws_sold_time_sk#1755, ws_web_page_sk#1766]\n                     :     :  +- Join Inner, (ws_ship_hdemo_sk#1764 = hd_demo_sk#1106)\n                     :     :     :- Project [ws_sold_time_sk#1755, ws_ship_hdemo_sk#1764, ws_web_page_sk#1766]\n                     :     :     :  +- Filter ((isnotnull(ws_ship_hdemo_sk#1764) && isnotnull(ws_sold_time_sk#1755)) && isnotnull(ws_web_page_sk#1766))\n                     :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                     :     :     +- Project [hd_demo_sk#1106]\n                     :     :        +- Filter ((isnotnull(hd_dep_count#1109) && (hd_dep_count#1109 = 6)) && isnotnull(hd_demo_sk#1106))\n                     :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n                     :     +- Project [t_time_sk#1464]\n                     :        +- Filter (((isnotnull(t_hour#1467) && (t_hour#1467 >= 19)) && (t_hour#1467 <= 20)) && isnotnull(t_time_sk#1464))\n                     :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n                     +- Project [wp_web_page_sk#1568]\n                        +- Filter (((isnotnull(wp_char_count#1578) && (wp_char_count#1578 >= 5000)) && (wp_char_count#1578 <= 5200)) && isnotnull(wp_web_page_sk#1568))\n                           +- Relation[wp_web_page_sk#1568,wp_web_page_id#1569,wp_rec_start_date#1570,wp_rec_end_date#1571,wp_creation_date_sk#1572,wp_access_date_sk#1573,wp_autogen_flag#1574,wp_customer_sk#1575,wp_url#1576,wp_type#1577,wp_char_count#1578,wp_link_count#1579,wp_image_count#1580,wp_max_ad_count#1581] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[am_pm_ratio#37776 ASC NULLS FIRST], output=[am_pm_ratio#37776])\n+- *(11) Project [CheckOverflow((promote_precision(cast(amc#37774L as decimal(15,4))) / promote_precision(cast(pmc#37775L as decimal(15,4)))), DecimalType(35,20)) AS am_pm_ratio#37776]\n   +- BroadcastNestedLoopJoin BuildRight, Cross\n      :- *(5) HashAggregate(keys=[], functions=[count(1)], output=[amc#37774L])\n      :  +- Exchange SinglePartition\n      :     +- *(4) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#37781L])\n      :        +- *(4) Project\n      :           +- *(4) BroadcastHashJoin [ws_web_page_sk#1766], [wp_web_page_sk#1568], Inner, BuildRight\n      :              :- *(4) Project [ws_web_page_sk#1766]\n      :              :  +- *(4) BroadcastHashJoin [ws_sold_time_sk#1755], [t_time_sk#1464], Inner, BuildRight\n      :              :     :- *(4) Project [ws_sold_time_sk#1755, ws_web_page_sk#1766]\n      :              :     :  +- *(4) BroadcastHashJoin [ws_ship_hdemo_sk#1764], [hd_demo_sk#1106], Inner, BuildRight\n      :              :     :     :- *(4) Project [ws_sold_time_sk#1755, ws_ship_hdemo_sk#1764, ws_web_page_sk#1766]\n      :              :     :     :  +- *(4) Filter ((isnotnull(ws_ship_hdemo_sk#1764) && isnotnull(ws_sold_time_sk#1755)) && isnotnull(ws_web_page_sk#1766))\n      :              :     :     :     +- *(4) FileScan parquet db_tpcds.web_sales[ws_sold_time_sk#1755,ws_ship_hdemo_sk#1764,ws_web_page_sk#1766,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ws_ship_hdemo_sk), IsNotNull(ws_sold_time_sk), IsNotNull(ws_web_page_sk)], ReadSchema: struct<ws_sold_time_sk:int,ws_ship_hdemo_sk:int,ws_web_page_sk:int>\n      :              :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :              :     :        +- *(1) Project [hd_demo_sk#1106]\n      :              :     :           +- *(1) Filter ((isnotnull(hd_dep_count#1109) && (hd_dep_count#1109 = 6)) && isnotnull(hd_demo_sk#1106))\n      :              :     :              +- *(1) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_dep_count#1109] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(hd_dep_count), EqualTo(hd_dep_count,6), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:int,hd_dep_count:int>\n      :              :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :              :        +- *(2) Project [t_time_sk#1464]\n      :              :           +- *(2) Filter (((isnotnull(t_hour#1467) && (t_hour#1467 >= 8)) && (t_hour#1467 <= 9)) && isnotnull(t_time_sk#1464))\n      :              :              +- *(2) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_hour#1467] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), GreaterThanOrEqual(t_hour,8), LessThanOrEqual(t_hour,9), IsNotNull(t_time_sk)], ReadSchema: struct<t_time_sk:int,t_hour:int>\n      :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n      :                 +- *(3) Project [wp_web_page_sk#1568]\n      :                    +- *(3) Filter (((isnotnull(wp_char_count#1578) && (wp_char_count#1578 >= 5000)) && (wp_char_count#1578 <= 5200)) && isnotnull(wp_web_page_sk#1568))\n      :                       +- *(3) FileScan parquet db_tpcds.web_page[wp_web_page_sk#1568,wp_char_count#1578] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_page], PartitionFilters: [], PushedFilters: [IsNotNull(wp_char_count), GreaterThanOrEqual(wp_char_count,5000), LessThanOrEqual(wp_char_count,..., ReadSchema: struct<wp_web_page_sk:int,wp_char_count:int>\n      +- BroadcastExchange IdentityBroadcastMode\n         +- *(10) HashAggregate(keys=[], functions=[count(1)], output=[pmc#37775L])\n            +- Exchange SinglePartition\n               +- *(9) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#37783L])\n                  +- *(9) Project\n                     +- *(9) BroadcastHashJoin [ws_web_page_sk#1766], [wp_web_page_sk#1568], Inner, BuildRight\n                        :- *(9) Project [ws_web_page_sk#1766]\n                        :  +- *(9) BroadcastHashJoin [ws_sold_time_sk#1755], [t_time_sk#1464], Inner, BuildRight\n                        :     :- *(9) Project [ws_sold_time_sk#1755, ws_web_page_sk#1766]\n                        :     :  +- *(9) BroadcastHashJoin [ws_ship_hdemo_sk#1764], [hd_demo_sk#1106], Inner, BuildRight\n                        :     :     :- *(9) Project [ws_sold_time_sk#1755, ws_ship_hdemo_sk#1764, ws_web_page_sk#1766]\n                        :     :     :  +- *(9) Filter ((isnotnull(ws_ship_hdemo_sk#1764) && isnotnull(ws_sold_time_sk#1755)) && isnotnull(ws_web_page_sk#1766))\n                        :     :     :     +- *(9) FileScan parquet db_tpcds.web_sales[ws_sold_time_sk#1755,ws_ship_hdemo_sk#1764,ws_web_page_sk#1766,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ws_ship_hdemo_sk), IsNotNull(ws_sold_time_sk), IsNotNull(ws_web_page_sk)], ReadSchema: struct<ws_sold_time_sk:int,ws_ship_hdemo_sk:int,ws_web_page_sk:int>\n                        :     :     +- ReusedExchange [hd_demo_sk#1106], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        :        +- *(7) Project [t_time_sk#1464]\n                        :           +- *(7) Filter (((isnotnull(t_hour#1467) && (t_hour#1467 >= 19)) && (t_hour#1467 <= 20)) && isnotnull(t_time_sk#1464))\n                        :              +- *(7) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_hour#1467] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), GreaterThanOrEqual(t_hour,19), LessThanOrEqual(t_hour,20), IsNotNull(t_time_sk)], ReadSchema: struct<t_time_sk:int,t_hour:int>\n                        +- ReusedExchange [wp_web_page_sk#1568], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q91-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["call_center","catalog_returns","date_dim","customer","customer_address","customer_demographics","household_demographics"],"parsingTime":0.002102,"analysisTime":0.00122,"optimizationTime":326.17766,"planningTime":14.164341,"executionTime":2695.93871,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'Sort ['sum('cr_net_loss) DESC NULLS LAST], true\n+- 'Aggregate ['cc_call_center_id, 'cc_name, 'cc_manager, 'cd_marital_status, 'cd_education_status], ['cc_call_center_id AS Call_Center#37804, 'cc_name AS Call_Center_Name#37805, 'cc_manager AS Manager#37806, 'sum('cr_net_loss) AS Returns_Loss#37807]\n   +- 'Filter ((((('cr_call_center_sk = 'cc_call_center_sk) && ('cr_returned_date_sk = 'd_date_sk)) && ('cr_returning_customer_sk = 'c_customer_sk)) && ((('cd_demo_sk = 'c_current_cdemo_sk) && ('hd_demo_sk = 'c_current_hdemo_sk)) && ('ca_address_sk = 'c_current_addr_sk))) && (((('d_year = 1998) && ('d_moy = 11)) && ((('cd_marital_status = M) && ('cd_education_status = Unknown)) || (('cd_marital_status = W) && ('cd_education_status = Advanced Degree)))) && ('hd_buy_potential LIKE Unknown% && ('ca_gmt_offset = -7))))\n      +- 'Join Inner\n         :- 'Join Inner\n         :  :- 'Join Inner\n         :  :  :- 'Join Inner\n         :  :  :  :- 'Join Inner\n         :  :  :  :  :- 'Join Inner\n         :  :  :  :  :  :- 'UnresolvedRelation `call_center`\n         :  :  :  :  :  +- 'UnresolvedRelation `catalog_returns`\n         :  :  :  :  +- 'UnresolvedRelation `date_dim`\n         :  :  :  +- 'UnresolvedRelation `customer`\n         :  :  +- 'UnresolvedRelation `customer_address`\n         :  +- 'UnresolvedRelation `customer_demographics`\n         +- 'UnresolvedRelation `household_demographics`\n\n== Analyzed Logical Plan ==\nCall_Center: string, Call_Center_Name: string, Manager: string, Returns_Loss: decimal(17,2)\nProject [Call_Center#37804, Call_Center_Name#37805, Manager#37806, Returns_Loss#37807]\n+- Sort [Returns_Loss#37807 DESC NULLS LAST], true\n   +- Aggregate [cc_call_center_id#727, cc_name#732, cc_manager#737, cd_marital_status#968, cd_education_status#969], [cc_call_center_id#727 AS Call_Center#37804, cc_name#732 AS Call_Center_Name#37805, cc_manager#737 AS Manager#37806, sum(cr_net_loss#2111) AS Returns_Loss#37807]\n      +- Filter (((((cr_call_center_sk#2096 = cc_call_center_sk#726) && (cr_returned_date_sk#2112 = d_date_sk#1040)) && (cr_returning_customer_sk#2092 = c_customer_sk#860)) && (((cd_demo_sk#966 = c_current_cdemo_sk#862) && (hd_demo_sk#1106 = c_current_hdemo_sk#863)) && (ca_address_sk#922 = c_current_addr_sk#864))) && ((((d_year#1046 = 1998) && (d_moy#1048 = 11)) && (((cd_marital_status#968 = M) && (cd_education_status#969 = Unknown)) || ((cd_marital_status#968 = W) && (cd_education_status#969 = Advanced Degree)))) && (hd_buy_potential#1108 LIKE Unknown% && (cast(ca_gmt_offset#933 as decimal(5,2)) = cast(cast(-7 as decimal(1,0)) as decimal(5,2))))))\n         +- Join Inner\n            :- Join Inner\n            :  :- Join Inner\n            :  :  :- Join Inner\n            :  :  :  :- Join Inner\n            :  :  :  :  :- Join Inner\n            :  :  :  :  :  :- SubqueryAlias call_center\n            :  :  :  :  :  :  +- Relation[cc_call_center_sk#726,cc_call_center_id#727,cc_rec_start_date#728,cc_rec_end_date#729,cc_closed_date_sk#730,cc_open_date_sk#731,cc_name#732,cc_class#733,cc_employees#734,cc_sq_ft#735,cc_hours#736,cc_manager#737,cc_mkt_id#738,cc_mkt_class#739,cc_mkt_desc#740,cc_market_manager#741,cc_division#742,cc_division_name#743,cc_company#744,cc_company_name#745,cc_street_number#746,cc_street_name#747,cc_street_type#748,cc_suite_number#749,... 7 more fields] parquet\n            :  :  :  :  :  +- SubqueryAlias catalog_returns\n            :  :  :  :  :     +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n            :  :  :  :  +- SubqueryAlias date_dim\n            :  :  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            :  :  :  +- SubqueryAlias customer\n            :  :  :     +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n            :  :  +- SubqueryAlias customer_address\n            :  :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n            :  +- SubqueryAlias customer_demographics\n            :     +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n            +- SubqueryAlias household_demographics\n               +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n\n== Optimized Logical Plan ==\nSort [Returns_Loss#37807 DESC NULLS LAST], true\n+- Aggregate [cc_call_center_id#727, cc_name#732, cc_manager#737, cd_marital_status#968, cd_education_status#969], [cc_call_center_id#727 AS Call_Center#37804, cc_name#732 AS Call_Center_Name#37805, cc_manager#737 AS Manager#37806, MakeDecimal(sum(UnscaledValue(cr_net_loss#2111)),17,2) AS Returns_Loss#37807]\n   +- Project [cc_call_center_id#727, cc_name#732, cc_manager#737, cr_net_loss#2111, cd_marital_status#968, cd_education_status#969]\n      +- Join Inner, (hd_demo_sk#1106 = c_current_hdemo_sk#863)\n         :- Project [cc_call_center_id#727, cc_name#732, cc_manager#737, cr_net_loss#2111, c_current_hdemo_sk#863, cd_marital_status#968, cd_education_status#969]\n         :  +- Join Inner, (cd_demo_sk#966 = c_current_cdemo_sk#862)\n         :     :- Project [cc_call_center_id#727, cc_name#732, cc_manager#737, cr_net_loss#2111, c_current_cdemo_sk#862, c_current_hdemo_sk#863]\n         :     :  +- Join Inner, (ca_address_sk#922 = c_current_addr_sk#864)\n         :     :     :- Project [cc_call_center_id#727, cc_name#732, cc_manager#737, cr_net_loss#2111, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864]\n         :     :     :  +- Join Inner, (cr_returning_customer_sk#2092 = c_customer_sk#860)\n         :     :     :     :- Project [cc_call_center_id#727, cc_name#732, cc_manager#737, cr_returning_customer_sk#2092, cr_net_loss#2111]\n         :     :     :     :  +- Join Inner, (cr_returned_date_sk#2112 = d_date_sk#1040)\n         :     :     :     :     :- Project [cc_call_center_id#727, cc_name#732, cc_manager#737, cr_returning_customer_sk#2092, cr_net_loss#2111, cr_returned_date_sk#2112]\n         :     :     :     :     :  +- Join Inner, (cr_call_center_sk#2096 = cc_call_center_sk#726)\n         :     :     :     :     :     :- Project [cc_call_center_sk#726, cc_call_center_id#727, cc_name#732, cc_manager#737]\n         :     :     :     :     :     :  +- Filter isnotnull(cc_call_center_sk#726)\n         :     :     :     :     :     :     +- Relation[cc_call_center_sk#726,cc_call_center_id#727,cc_rec_start_date#728,cc_rec_end_date#729,cc_closed_date_sk#730,cc_open_date_sk#731,cc_name#732,cc_class#733,cc_employees#734,cc_sq_ft#735,cc_hours#736,cc_manager#737,cc_mkt_id#738,cc_mkt_class#739,cc_mkt_desc#740,cc_market_manager#741,cc_division#742,cc_division_name#743,cc_company#744,cc_company_name#745,cc_street_number#746,cc_street_name#747,cc_street_type#748,cc_suite_number#749,... 7 more fields] parquet\n         :     :     :     :     :     +- Project [cr_returning_customer_sk#2092, cr_call_center_sk#2096, cr_net_loss#2111, cr_returned_date_sk#2112]\n         :     :     :     :     :        +- Filter ((isnotnull(cr_call_center_sk#2096) && isnotnull(cr_returned_date_sk#2112)) && isnotnull(cr_returning_customer_sk#2092))\n         :     :     :     :     :           +- Relation[cr_returned_time_sk#2086,cr_item_sk#2087,cr_refunded_customer_sk#2088,cr_refunded_cdemo_sk#2089,cr_refunded_hdemo_sk#2090,cr_refunded_addr_sk#2091,cr_returning_customer_sk#2092,cr_returning_cdemo_sk#2093,cr_returning_hdemo_sk#2094,cr_returning_addr_sk#2095,cr_call_center_sk#2096,cr_catalog_page_sk#2097,cr_ship_mode_sk#2098,cr_warehouse_sk#2099,cr_reason_sk#2100,cr_order_number#2101L,cr_return_quantity#2102,cr_return_amount#2103,cr_return_tax#2104,cr_return_amt_inc_tax#2105,cr_fee#2106,cr_return_ship_cost#2107,cr_refunded_cash#2108,cr_reversed_charge#2109,... 3 more fields] parquet\n         :     :     :     :     +- Project [d_date_sk#1040]\n         :     :     :     :        +- Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 11)) && isnotnull(d_date_sk#1040))\n         :     :     :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         :     :     :     +- Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864]\n         :     :     :        +- Filter (((isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864)) && isnotnull(c_current_cdemo_sk#862)) && isnotnull(c_current_hdemo_sk#863))\n         :     :     :           +- Relation[c_customer_sk#860,c_customer_id#861,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864,c_first_shipto_date_sk#865,c_first_sales_date_sk#866,c_salutation#867,c_first_name#868,c_last_name#869,c_preferred_cust_flag#870,c_birth_day#871,c_birth_month#872,c_birth_year#873,c_birth_country#874,c_login#875,c_email_address#876,c_last_review_date#877] parquet\n         :     :     +- Project [ca_address_sk#922]\n         :     :        +- Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -7.00)) && isnotnull(ca_address_sk#922))\n         :     :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n         :     +- Project [cd_demo_sk#966, cd_marital_status#968, cd_education_status#969]\n         :        +- Filter ((((cd_marital_status#968 = M) && (cd_education_status#969 = Unknown)) || ((cd_marital_status#968 = W) && (cd_education_status#969 = Advanced Degree))) && isnotnull(cd_demo_sk#966))\n         :           +- Relation[cd_demo_sk#966,cd_gender#967,cd_marital_status#968,cd_education_status#969,cd_purchase_estimate#970,cd_credit_rating#971,cd_dep_count#972,cd_dep_employed_count#973,cd_dep_college_count#974] parquet\n         +- Project [hd_demo_sk#1106]\n            +- Filter ((isnotnull(hd_buy_potential#1108) && StartsWith(hd_buy_potential#1108, Unknown)) && isnotnull(hd_demo_sk#1106))\n               +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n\n== Physical Plan ==\n*(9) Sort [Returns_Loss#37807 DESC NULLS LAST], true, 0\n+- Exchange rangepartitioning(Returns_Loss#37807 DESC NULLS LAST, 200)\n   +- *(8) HashAggregate(keys=[cc_call_center_id#727, cc_name#732, cc_manager#737, cd_marital_status#968, cd_education_status#969], functions=[sum(UnscaledValue(cr_net_loss#2111))], output=[Call_Center#37804, Call_Center_Name#37805, Manager#37806, Returns_Loss#37807])\n      +- Exchange hashpartitioning(cc_call_center_id#727, cc_name#732, cc_manager#737, cd_marital_status#968, cd_education_status#969, 200)\n         +- *(7) HashAggregate(keys=[cc_call_center_id#727, cc_name#732, cc_manager#737, cd_marital_status#968, cd_education_status#969], functions=[partial_sum(UnscaledValue(cr_net_loss#2111))], output=[cc_call_center_id#727, cc_name#732, cc_manager#737, cd_marital_status#968, cd_education_status#969, sum#37816L])\n            +- *(7) Project [cc_call_center_id#727, cc_name#732, cc_manager#737, cr_net_loss#2111, cd_marital_status#968, cd_education_status#969]\n               +- *(7) BroadcastHashJoin [c_current_hdemo_sk#863], [hd_demo_sk#1106], Inner, BuildRight\n                  :- *(7) Project [cc_call_center_id#727, cc_name#732, cc_manager#737, cr_net_loss#2111, c_current_hdemo_sk#863, cd_marital_status#968, cd_education_status#969]\n                  :  +- *(7) BroadcastHashJoin [c_current_cdemo_sk#862], [cd_demo_sk#966], Inner, BuildRight\n                  :     :- *(7) Project [cc_call_center_id#727, cc_name#732, cc_manager#737, cr_net_loss#2111, c_current_cdemo_sk#862, c_current_hdemo_sk#863]\n                  :     :  +- *(7) BroadcastHashJoin [c_current_addr_sk#864], [ca_address_sk#922], Inner, BuildRight\n                  :     :     :- *(7) Project [cc_call_center_id#727, cc_name#732, cc_manager#737, cr_net_loss#2111, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864]\n                  :     :     :  +- *(7) BroadcastHashJoin [cr_returning_customer_sk#2092], [c_customer_sk#860], Inner, BuildRight\n                  :     :     :     :- *(7) Project [cc_call_center_id#727, cc_name#732, cc_manager#737, cr_returning_customer_sk#2092, cr_net_loss#2111]\n                  :     :     :     :  +- *(7) BroadcastHashJoin [cr_returned_date_sk#2112], [d_date_sk#1040], Inner, BuildRight\n                  :     :     :     :     :- *(7) Project [cc_call_center_id#727, cc_name#732, cc_manager#737, cr_returning_customer_sk#2092, cr_net_loss#2111, cr_returned_date_sk#2112]\n                  :     :     :     :     :  +- *(7) BroadcastHashJoin [cc_call_center_sk#726], [cr_call_center_sk#2096], Inner, BuildLeft\n                  :     :     :     :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :     :     :     :     :  +- *(1) Project [cc_call_center_sk#726, cc_call_center_id#727, cc_name#732, cc_manager#737]\n                  :     :     :     :     :     :     +- *(1) Filter isnotnull(cc_call_center_sk#726)\n                  :     :     :     :     :     :        +- *(1) FileScan parquet db_tpcds.call_center[cc_call_center_sk#726,cc_call_center_id#727,cc_name#732,cc_manager#737] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/call_center], PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk)], ReadSchema: struct<cc_call_center_sk:int,cc_call_center_id:string,cc_name:string,cc_manager:string>\n                  :     :     :     :     :     +- *(7) Project [cr_returning_customer_sk#2092, cr_call_center_sk#2096, cr_net_loss#2111, cr_returned_date_sk#2112]\n                  :     :     :     :     :        +- *(7) Filter (isnotnull(cr_call_center_sk#2096) && isnotnull(cr_returning_customer_sk#2092))\n                  :     :     :     :     :           +- *(7) FileScan parquet db_tpcds.catalog_returns[cr_returning_customer_sk#2092,cr_call_center_sk#2096,cr_net_loss#2111,cr_returned_date_sk#2112] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_returns/c..., PartitionCount: 2066, PartitionFilters: [isnotnull(cr_returned_date_sk#2112)], PushedFilters: [IsNotNull(cr_call_center_sk), IsNotNull(cr_returning_customer_sk)], ReadSchema: struct<cr_returning_customer_sk:int,cr_call_center_sk:int,cr_net_loss:decimal(7,2)>\n                  :     :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :     :     :        +- *(2) Project [d_date_sk#1040]\n                  :     :     :     :           +- *(2) Filter ((((isnotnull(d_year#1046) && isnotnull(d_moy#1048)) && (d_year#1046 = 1998)) && (d_moy#1048 = 11)) && isnotnull(d_date_sk#1040))\n                  :     :     :     :              +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_year#1046,d_moy#1048] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,1998), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>\n                  :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :     :        +- *(3) Project [c_customer_sk#860, c_current_cdemo_sk#862, c_current_hdemo_sk#863, c_current_addr_sk#864]\n                  :     :     :           +- *(3) Filter (((isnotnull(c_customer_sk#860) && isnotnull(c_current_addr_sk#864)) && isnotnull(c_current_cdemo_sk#862)) && isnotnull(c_current_hdemo_sk#863))\n                  :     :     :              +- *(3) FileScan parquet db_tpcds.customer[c_customer_sk#860,c_current_cdemo_sk#862,c_current_hdemo_sk#863,c_current_addr_sk#864] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk), IsNotNull(c_current_addr_sk), IsNotNull(c_current_cdemo_sk), IsNotNull..., ReadSchema: struct<c_customer_sk:int,c_current_cdemo_sk:int,c_current_hdemo_sk:int,c_current_addr_sk:int>\n                  :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :     :        +- *(4) Project [ca_address_sk#922]\n                  :     :           +- *(4) Filter ((isnotnull(ca_gmt_offset#933) && (ca_gmt_offset#933 = -7.00)) && isnotnull(ca_address_sk#922))\n                  :     :              +- *(4) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_gmt_offset#933] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_gmt_offset), EqualTo(ca_gmt_offset,-7.00), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_gmt_offset:decimal(5,2)>\n                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :        +- *(5) Project [cd_demo_sk#966, cd_marital_status#968, cd_education_status#969]\n                  :           +- *(5) Filter ((((cd_marital_status#968 = M) && (cd_education_status#969 = Unknown)) || ((cd_marital_status#968 = W) && (cd_education_status#969 = Advanced Degree))) && isnotnull(cd_demo_sk#966))\n                  :              +- *(5) FileScan parquet db_tpcds.customer_demographics[cd_demo_sk#966,cd_marital_status#968,cd_education_status#969] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_demographics], PartitionFilters: [], PushedFilters: [Or(And(EqualTo(cd_marital_status,M),EqualTo(cd_education_status,Unknown)),And(EqualTo(cd_marital..., ReadSchema: struct<cd_demo_sk:int,cd_marital_status:string,cd_education_status:string>\n                  +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     +- *(6) Project [hd_demo_sk#1106]\n                        +- *(6) Filter ((isnotnull(hd_buy_potential#1108) && StartsWith(hd_buy_potential#1108, Unknown)) && isnotnull(hd_demo_sk#1106))\n                           +- *(6) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_buy_potential#1108] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(hd_buy_potential), StringStartsWith(hd_buy_potential,Unknown), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:int,hd_buy_potential:string>"},{"name":"q92-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["web_sales","item","date_dim"],"parsingTime":0.001438,"analysisTime":9.04E-4,"optimizationTime":526.00125,"planningTime":19.443377,"executionTime":3826.509359,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['sum('ws_ext_discount_amt) ASC NULLS FIRST], true\n      +- 'Project ['sum('ws_ext_discount_amt) AS Excess Discount Amount#37844]\n         +- 'Filter (((('i_manufact_id = 350) && ('i_item_sk = 'ws_item_sk)) && (('d_date >= cast(2000-01-27 as date)) && ('d_date <= (cast(2000-01-27 as date) + interval 12 weeks 6 days)))) && (('d_date_sk = 'ws_sold_date_sk) && ('ws_ext_discount_amt > scalar-subquery#37845 [])))\n            :  +- 'Project [unresolvedalias((1.3 * 'avg('ws_ext_discount_amt)), None)]\n            :     +- 'Filter ((('ws_item_sk = 'i_item_sk) && (('d_date >= cast(2000-01-27 as date)) && ('d_date <= (cast(2000-01-27 as date) + interval 12 weeks 6 days)))) && ('d_date_sk = 'ws_sold_date_sk))\n            :        +- 'Join Inner\n            :           :- 'UnresolvedRelation `web_sales`\n            :           +- 'UnresolvedRelation `date_dim`\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'UnresolvedRelation `web_sales`\n               :  +- 'UnresolvedRelation `item`\n               +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nExcess Discount Amount: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [Excess Discount Amount#37844]\n      +- Sort [Excess Discount Amount#37844 ASC NULLS FIRST], true\n         +- Aggregate [sum(ws_ext_discount_amt#1776) AS Excess Discount Amount#37844]\n            +- Filter ((((i_manufact_id#1185 = 350) && (i_item_sk#1172 = ws_item_sk#1757)) && ((d_date#1042 >= cast(2000-01-27 as date)) && (d_date#1042 <= cast(cast(cast(2000-01-27 as date) as timestamp) + interval 12 weeks 6 days as date)))) && ((d_date_sk#1040 = ws_sold_date_sk#1788) && (cast(ws_ext_discount_amt#1776 as decimal(14,7)) > cast(scalar-subquery#37845 [i_item_sk#1172] as decimal(14,7)))))\n               :  +- Aggregate [CheckOverflow((promote_precision(cast(1.3 as decimal(11,6))) * promote_precision(cast(avg(ws_ext_discount_amt#1776) as decimal(11,6)))), DecimalType(14,7)) AS (CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(ws_ext_discount_amt) AS DECIMAL(11,6)))#37847]\n               :     +- Filter (((ws_item_sk#1757 = outer(i_item_sk#1172)) && ((d_date#1042 >= cast(2000-01-27 as date)) && (d_date#1042 <= cast(cast(cast(2000-01-27 as date) as timestamp) + interval 12 weeks 6 days as date)))) && (d_date_sk#1040 = ws_sold_date_sk#1788))\n               :        +- Join Inner\n               :           :- SubqueryAlias web_sales\n               :           :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :           +- SubqueryAlias date_dim\n               :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- Join Inner\n                  :- Join Inner\n                  :  :- SubqueryAlias web_sales\n                  :  :  +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :  +- SubqueryAlias item\n                  :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  +- SubqueryAlias date_dim\n                     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [Excess Discount Amount#37844 ASC NULLS FIRST], true\n      +- Aggregate [MakeDecimal(sum(UnscaledValue(ws_ext_discount_amt#1776)),17,2) AS Excess Discount Amount#37844]\n         +- Project [ws_ext_discount_amt#1776]\n            +- Join Inner, (d_date_sk#1040 = ws_sold_date_sk#1788)\n               :- Project [ws_ext_discount_amt#1776, ws_sold_date_sk#1788]\n               :  +- Join Inner, ((cast(ws_ext_discount_amt#1776 as decimal(14,7)) > (CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(ws_ext_discount_amt) AS DECIMAL(11,6)))#37847) && (ws_item_sk#1757#37852 = i_item_sk#1172))\n               :     :- Project [ws_ext_discount_amt#1776, ws_sold_date_sk#1788, i_item_sk#1172]\n               :     :  +- Join Inner, (i_item_sk#1172 = ws_item_sk#1757)\n               :     :     :- Project [ws_item_sk#1757, ws_ext_discount_amt#1776, ws_sold_date_sk#1788]\n               :     :     :  +- Filter ((isnotnull(ws_item_sk#1757) && isnotnull(ws_ext_discount_amt#1776)) && isnotnull(ws_sold_date_sk#1788))\n               :     :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :     +- Project [i_item_sk#1172]\n               :     :        +- Filter ((isnotnull(i_manufact_id#1185) && (i_manufact_id#1185 = 350)) && isnotnull(i_item_sk#1172))\n               :     :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n               :     +- Filter isnotnull((CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(ws_ext_discount_amt) AS DECIMAL(11,6)))#37847)\n               :        +- Aggregate [ws_item_sk#1757], [CheckOverflow((1.300000 * promote_precision(cast((avg(UnscaledValue(ws_ext_discount_amt#1776)) / 100.0) as decimal(11,6)))), DecimalType(14,7)) AS (CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(ws_ext_discount_amt) AS DECIMAL(11,6)))#37847, ws_item_sk#1757 AS ws_item_sk#1757#37852]\n               :           +- Project [ws_item_sk#1757, ws_ext_discount_amt#1776]\n               :              +- Join Inner, (d_date_sk#1040 = ws_sold_date_sk#1788)\n               :                 :- Project [ws_item_sk#1757, ws_ext_discount_amt#1776, ws_sold_date_sk#1788]\n               :                 :  +- Filter (isnotnull(ws_sold_date_sk#1788) && isnotnull(ws_item_sk#1757))\n               :                 :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :                 +- Project [d_date_sk#1040]\n               :                    +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10983)) && (d_date#1042 <= 11073)) && isnotnull(d_date_sk#1040))\n               :                       +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               +- Project [d_date_sk#1040]\n                  +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10983)) && (d_date#1042 <= 11073)) && isnotnull(d_date_sk#1040))\n                     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[Excess Discount Amount#37844 ASC NULLS FIRST], output=[Excess Discount Amount#37844])\n+- *(10) HashAggregate(keys=[], functions=[sum(UnscaledValue(ws_ext_discount_amt#1776))], output=[Excess Discount Amount#37844])\n   +- Exchange SinglePartition\n      +- *(9) HashAggregate(keys=[], functions=[partial_sum(UnscaledValue(ws_ext_discount_amt#1776))], output=[sum#37854L])\n         +- *(9) Project [ws_ext_discount_amt#1776]\n            +- *(9) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n               :- *(9) Project [ws_ext_discount_amt#1776, ws_sold_date_sk#1788]\n               :  +- *(9) SortMergeJoin [i_item_sk#1172], [ws_item_sk#1757#37852], Inner, (cast(ws_ext_discount_amt#1776 as decimal(14,7)) > (CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(ws_ext_discount_amt) AS DECIMAL(11,6)))#37847)\n               :     :- *(3) Sort [i_item_sk#1172 ASC NULLS FIRST], false, 0\n               :     :  +- Exchange hashpartitioning(i_item_sk#1172, 200)\n               :     :     +- *(2) Project [ws_ext_discount_amt#1776, ws_sold_date_sk#1788, i_item_sk#1172]\n               :     :        +- *(2) BroadcastHashJoin [ws_item_sk#1757], [i_item_sk#1172], Inner, BuildRight\n               :     :           :- *(2) Project [ws_item_sk#1757, ws_ext_discount_amt#1776, ws_sold_date_sk#1788]\n               :     :           :  +- *(2) Filter (isnotnull(ws_item_sk#1757) && isnotnull(ws_ext_discount_amt#1776))\n               :     :           :     +- *(2) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_ext_discount_amt#1776,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk), IsNotNull(ws_ext_discount_amt)], ReadSchema: struct<ws_item_sk:int,ws_ext_discount_amt:decimal(7,2)>\n               :     :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :              +- *(1) Project [i_item_sk#1172]\n               :     :                 +- *(1) Filter ((isnotnull(i_manufact_id#1185) && (i_manufact_id#1185 = 350)) && isnotnull(i_item_sk#1172))\n               :     :                    +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_manufact_id#1185] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [IsNotNull(i_manufact_id), EqualTo(i_manufact_id,350), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_manufact_id:int>\n               :     +- *(7) Sort [ws_item_sk#1757#37852 ASC NULLS FIRST], false, 0\n               :        +- Exchange hashpartitioning(ws_item_sk#1757#37852, 200)\n               :           +- *(6) Filter isnotnull((CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(ws_ext_discount_amt) AS DECIMAL(11,6)))#37847)\n               :              +- *(6) HashAggregate(keys=[ws_item_sk#1757], functions=[avg(UnscaledValue(ws_ext_discount_amt#1776))], output=[(CAST(1.3 AS DECIMAL(11,6)) * CAST(avg(ws_ext_discount_amt) AS DECIMAL(11,6)))#37847, ws_item_sk#1757#37852])\n               :                 +- Exchange hashpartitioning(ws_item_sk#1757, 200)\n               :                    +- *(5) HashAggregate(keys=[ws_item_sk#1757], functions=[partial_avg(UnscaledValue(ws_ext_discount_amt#1776))], output=[ws_item_sk#1757, sum#37857, count#37858L])\n               :                       +- *(5) Project [ws_item_sk#1757, ws_ext_discount_amt#1776]\n               :                          +- *(5) BroadcastHashJoin [ws_sold_date_sk#1788], [d_date_sk#1040], Inner, BuildRight\n               :                             :- *(5) Project [ws_item_sk#1757, ws_ext_discount_amt#1776, ws_sold_date_sk#1788]\n               :                             :  +- *(5) Filter isnotnull(ws_item_sk#1757)\n               :                             :     +- *(5) FileScan parquet db_tpcds.web_sales[ws_item_sk#1757,ws_ext_discount_amt#1776,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales/ws_sold..., PartitionCount: 1823, PartitionFilters: [isnotnull(ws_sold_date_sk#1788)], PushedFilters: [IsNotNull(ws_item_sk)], ReadSchema: struct<ws_item_sk:int,ws_ext_discount_amt:decimal(7,2)>\n               :                             +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :                                +- *(4) Project [d_date_sk#1040]\n               :                                   +- *(4) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10983)) && (d_date#1042 <= 11073)) && isnotnull(d_date_sk#1040))\n               :                                      +- *(4) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,2000-01-27), LessThanOrEqual(d_date,2000-04-26), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>\n               +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q93-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","SortMergeJoin"],"tables":["store_sales","store_returns","reason"],"parsingTime":0.002924,"analysisTime":0.001491,"optimizationTime":16.937246,"planningTime":422.16539,"executionTime":6919.782635,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['sumsales ASC NULLS FIRST, 'ss_customer_sk ASC NULLS FIRST], true\n      +- 'Aggregate ['ss_customer_sk], ['ss_customer_sk, 'sum('act_sales) AS sumsales#37878]\n         +- 'SubqueryAlias t\n            +- 'Project ['ss_item_sk, 'ss_ticket_number, 'ss_customer_sk, CASE WHEN isnotnull('sr_return_quantity) THEN (('ss_quantity - 'sr_return_quantity) * 'ss_sales_price) ELSE ('ss_quantity * 'ss_sales_price) END AS act_sales#37877]\n               +- 'Filter (('sr_reason_sk = 'r_reason_sk) && ('r_reason_desc = reason 28))\n                  +- 'Join Inner\n                     :- 'Join LeftOuter, (('sr_item_sk = 'ss_item_sk) && ('sr_ticket_number = 'ss_ticket_number))\n                     :  :- 'UnresolvedRelation `store_sales`\n                     :  +- 'UnresolvedRelation `store_returns`\n                     +- 'UnresolvedRelation `reason`\n\n== Analyzed Logical Plan ==\nss_customer_sk: int, sumsales: decimal(28,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [sumsales#37878 ASC NULLS FIRST, ss_customer_sk#1906 ASC NULLS FIRST], true\n      +- Aggregate [ss_customer_sk#1906], [ss_customer_sk#1906, sum(act_sales#37877) AS sumsales#37878]\n         +- SubqueryAlias t\n            +- Project [ss_item_sk#1905, ss_ticket_number#1912L, ss_customer_sk#1906, CASE WHEN isnotnull(sr_return_quantity#1713) THEN CheckOverflow((promote_precision(cast(cast((ss_quantity#1913 - sr_return_quantity#1713) as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)) ELSE CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)) END AS act_sales#37877]\n               +- Filter ((sr_reason_sk#1711 = r_reason_sk#1298) && (r_reason_desc#1300 = reason 28))\n                  +- Join Inner\n                     :- Join LeftOuter, ((sr_item_sk#1705 = ss_item_sk#1905) && (sr_ticket_number#1712L = ss_ticket_number#1912L))\n                     :  :- SubqueryAlias store_sales\n                     :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :  +- SubqueryAlias store_returns\n                     :     +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n                     +- SubqueryAlias reason\n                        +- Relation[r_reason_sk#1298,r_reason_id#1299,r_reason_desc#1300] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [sumsales#37878 ASC NULLS FIRST, ss_customer_sk#1906 ASC NULLS FIRST], true\n      +- Aggregate [ss_customer_sk#1906], [ss_customer_sk#1906, sum(act_sales#37877) AS sumsales#37878]\n         +- Project [ss_customer_sk#1906, CASE WHEN isnotnull(sr_return_quantity#1713) THEN CheckOverflow((promote_precision(cast(cast((ss_quantity#1913 - sr_return_quantity#1713) as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)) ELSE CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)) END AS act_sales#37877]\n            +- Join Inner, (sr_reason_sk#1711 = r_reason_sk#1298)\n               :- Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916, sr_reason_sk#1711, sr_return_quantity#1713]\n               :  +- Join Inner, ((sr_item_sk#1705 = ss_item_sk#1905) && (sr_ticket_number#1712L = ss_ticket_number#1912L))\n               :     :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_ticket_number#1912L, ss_quantity#1913, ss_sales_price#1916]\n               :     :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     +- Project [sr_item_sk#1705, sr_reason_sk#1711, sr_ticket_number#1712L, sr_return_quantity#1713]\n               :        +- Filter isnotnull(sr_reason_sk#1711)\n               :           +- Relation[sr_return_time_sk#1704,sr_item_sk#1705,sr_customer_sk#1706,sr_cdemo_sk#1707,sr_hdemo_sk#1708,sr_addr_sk#1709,sr_store_sk#1710,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_return_amt#1714,sr_return_tax#1715,sr_return_amt_inc_tax#1716,sr_fee#1717,sr_return_ship_cost#1718,sr_refunded_cash#1719,sr_reversed_charge#1720,sr_store_credit#1721,sr_net_loss#1722,sr_returned_date_sk#1723] parquet\n               +- Project [r_reason_sk#1298]\n                  +- Filter ((isnotnull(r_reason_desc#1300) && (r_reason_desc#1300 = reason 28)) && isnotnull(r_reason_sk#1298))\n                     +- Relation[r_reason_sk#1298,r_reason_id#1299,r_reason_desc#1300] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[sumsales#37878 ASC NULLS FIRST,ss_customer_sk#1906 ASC NULLS FIRST], output=[ss_customer_sk#1906,sumsales#37878])\n+- *(7) HashAggregate(keys=[ss_customer_sk#1906], functions=[sum(act_sales#37877)], output=[ss_customer_sk#1906, sumsales#37878])\n   +- Exchange hashpartitioning(ss_customer_sk#1906, 200)\n      +- *(6) HashAggregate(keys=[ss_customer_sk#1906], functions=[partial_sum(act_sales#37877)], output=[ss_customer_sk#1906, sum#37885])\n         +- *(6) Project [ss_customer_sk#1906, CASE WHEN isnotnull(sr_return_quantity#1713) THEN CheckOverflow((promote_precision(cast(cast((ss_quantity#1913 - sr_return_quantity#1713) as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)) ELSE CheckOverflow((promote_precision(cast(cast(ss_quantity#1913 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#1916 as decimal(12,2)))), DecimalType(18,2)) END AS act_sales#37877]\n            +- *(6) BroadcastHashJoin [sr_reason_sk#1711], [r_reason_sk#1298], Inner, BuildRight\n               :- *(6) Project [ss_customer_sk#1906, ss_quantity#1913, ss_sales_price#1916, sr_reason_sk#1711, sr_return_quantity#1713]\n               :  +- *(6) SortMergeJoin [ss_item_sk#1905, ss_ticket_number#1912L], [sr_item_sk#1705, sr_ticket_number#1712L], Inner\n               :     :- *(2) Sort [ss_item_sk#1905 ASC NULLS FIRST, ss_ticket_number#1912L ASC NULLS FIRST], false, 0\n               :     :  +- Exchange hashpartitioning(ss_item_sk#1905, ss_ticket_number#1912L, 200)\n               :     :     +- *(1) Project [ss_item_sk#1905, ss_customer_sk#1906, ss_ticket_number#1912L, ss_quantity#1913, ss_sales_price#1916]\n               :     :        +- *(1) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_ticket_number#1912L,ss_quantity#1913,ss_sales_price#1916,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int,ss_ticket_number:bigint,ss_quantity:int,ss_sales_price:d...\n               :     +- *(4) Sort [sr_item_sk#1705 ASC NULLS FIRST, sr_ticket_number#1712L ASC NULLS FIRST], false, 0\n               :        +- Exchange hashpartitioning(sr_item_sk#1705, sr_ticket_number#1712L, 200)\n               :           +- *(3) Project [sr_item_sk#1705, sr_reason_sk#1711, sr_ticket_number#1712L, sr_return_quantity#1713]\n               :              +- *(3) Filter isnotnull(sr_reason_sk#1711)\n               :                 +- *(3) FileScan parquet db_tpcds.store_returns[sr_item_sk#1705,sr_reason_sk#1711,sr_ticket_number#1712L,sr_return_quantity#1713,sr_returned_date_sk#1723] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_returns], PartitionCount: 2002, PartitionFilters: [], PushedFilters: [IsNotNull(sr_reason_sk)], ReadSchema: struct<sr_item_sk:int,sr_reason_sk:int,sr_ticket_number:bigint,sr_return_quantity:int>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(5) Project [r_reason_sk#1298]\n                     +- *(5) Filter ((isnotnull(r_reason_desc#1300) && (r_reason_desc#1300 = reason 28)) && isnotnull(r_reason_sk#1298))\n                        +- *(5) FileScan parquet db_tpcds.reason[r_reason_sk#1298,r_reason_desc#1300] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/reason], PartitionFilters: [], PushedFilters: [IsNotNull(r_reason_desc), EqualTo(r_reason_desc,reason 28), IsNotNull(r_reason_sk)], ReadSchema: struct<r_reason_sk:int,r_reason_desc:string>"},{"name":"q94-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","SortMergeJoin"],"tables":["web_sales","date_dim","customer_address","web_site"],"parsingTime":0.001516,"analysisTime":0.001006,"optimizationTime":61.561705,"planningTime":649.381785,"executionTime":9343.907127,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['count('ws_order_number) ASC NULLS FIRST], true\n      +- 'Project ['count('ws_order_number) AS order count#37949, 'sum('ws_ext_ship_cost) AS total shipping cost#37950, 'sum('ws_net_profit) AS total net profit#37951]\n         +- 'Filter ((((('d_date >= cast(1999-02-01 as date)) && ('d_date <= (cast(1999-02-01 as date) + interval 8 weeks 4 days))) && ('ws1.ws_ship_date_sk = 'd_date_sk)) && (('ws1.ws_ship_addr_sk = 'ca_address_sk) && ('ca_state = IL))) && ((('ws1.ws_web_site_sk = 'web_site_sk) && ('web_company_name = pri)) && (exists#37952 [] && NOT exists#37953 [])))\n            :  :- 'Project [*]\n            :  :  +- 'Filter (('ws1.ws_order_number = 'ws2.ws_order_number) && NOT ('ws1.ws_warehouse_sk = 'ws2.ws_warehouse_sk))\n            :  :     +- 'SubqueryAlias ws2\n            :  :        +- 'UnresolvedRelation `web_sales`\n            :  +- 'Project [*]\n            :     +- 'Filter ('ws1.ws_order_number = 'wr1.wr_order_number)\n            :        +- 'SubqueryAlias wr1\n            :           +- 'UnresolvedRelation `web_returns`\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'SubqueryAlias ws1\n               :  :  :  +- 'UnresolvedRelation `web_sales`\n               :  :  +- 'UnresolvedRelation `date_dim`\n               :  +- 'UnresolvedRelation `customer_address`\n               +- 'UnresolvedRelation `web_site`\n\n== Analyzed Logical Plan ==\norder count: bigint, total shipping cost: decimal(17,2), total net profit: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [order count#37949L, total shipping cost#37950, total net profit#37951]\n      +- Sort [order count#37949L ASC NULLS FIRST], true\n         +- Aggregate [count(distinct ws_order_number#1771L) AS order count#37949L, sum(ws_ext_ship_cost#1782) AS total shipping cost#37950, sum(ws_net_profit#1787) AS total net profit#37951]\n            +- Filter (((((d_date#1042 >= cast(1999-02-01 as date)) && (d_date#1042 <= cast(cast(cast(1999-02-01 as date) as timestamp) + interval 8 weeks 4 days as date))) && (ws_ship_date_sk#1756 = d_date_sk#1040)) && ((ws_ship_addr_sk#1765 = ca_address_sk#922) && (ca_state#930 = IL))) && (((ws_web_site_sk#1767 = web_site_sk#1648) && (web_company_name#1662 = pri)) && (exists#37952 [ws_order_number#1771L && ws_warehouse_sk#1769] && NOT exists#37953 [ws_order_number#1771L])))\n               :  :- Project [ws_sold_time_sk#1755, ws_ship_date_sk#1756, ws_item_sk#1757, ws_bill_customer_sk#1758, ws_bill_cdemo_sk#1759, ws_bill_hdemo_sk#1760, ws_bill_addr_sk#1761, ws_ship_customer_sk#1762, ws_ship_cdemo_sk#1763, ws_ship_hdemo_sk#1764, ws_ship_addr_sk#1765, ws_web_page_sk#1766, ws_web_site_sk#1767, ws_ship_mode_sk#1768, ws_warehouse_sk#1769, ws_promo_sk#1770, ws_order_number#1771L, ws_quantity#1772, ws_wholesale_cost#1773, ws_list_price#1774, ws_sales_price#1775, ws_ext_discount_amt#1776, ws_ext_sales_price#1777, ws_ext_wholesale_cost#1778, ... 10 more fields]\n               :  :  +- Filter ((outer(ws_order_number#1771L) = ws_order_number#1771L) && NOT (outer(ws_warehouse_sk#1769) = ws_warehouse_sk#1769))\n               :  :     +- SubqueryAlias ws2\n               :  :        +- SubqueryAlias web_sales\n               :  :           +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :  +- Project [wr_returned_time_sk#2117, wr_item_sk#2118, wr_refunded_customer_sk#2119, wr_refunded_cdemo_sk#2120, wr_refunded_hdemo_sk#2121, wr_refunded_addr_sk#2122, wr_returning_customer_sk#2123, wr_returning_cdemo_sk#2124, wr_returning_hdemo_sk#2125, wr_returning_addr_sk#2126, wr_web_page_sk#2127, wr_reason_sk#2128, wr_order_number#2129L, wr_return_quantity#2130, wr_return_amt#2131, wr_return_tax#2132, wr_return_amt_inc_tax#2133, wr_fee#2134, wr_return_ship_cost#2135, wr_refunded_cash#2136, wr_reversed_charge#2137, wr_account_credit#2138, wr_net_loss#2139, wr_returned_date_sk#2140]\n               :     +- Filter (outer(ws_order_number#1771L) = wr_order_number#2129L)\n               :        +- SubqueryAlias wr1\n               :           +- SubqueryAlias web_returns\n               :              +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- SubqueryAlias ws1\n                  :  :  :  +- SubqueryAlias web_sales\n                  :  :  :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :  :  +- SubqueryAlias date_dim\n                  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :  +- SubqueryAlias customer_address\n                  :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  +- SubqueryAlias web_site\n                     +- Relation[web_site_sk#1648,web_site_id#1649,web_rec_start_date#1650,web_rec_end_date#1651,web_name#1652,web_open_date_sk#1653,web_close_date_sk#1654,web_class#1655,web_manager#1656,web_mkt_id#1657,web_mkt_class#1658,web_mkt_desc#1659,web_market_manager#1660,web_company_id#1661,web_company_name#1662,web_street_number#1663,web_street_name#1664,web_street_type#1665,web_suite_number#1666,web_city#1667,web_county#1668,web_state#1669,web_zip#1670,web_country#1671,... 2 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [order count#37949L ASC NULLS FIRST], true\n      +- Aggregate [count(distinct ws_order_number#1771L) AS order count#37949L, MakeDecimal(sum(UnscaledValue(ws_ext_ship_cost#1782)),17,2) AS total shipping cost#37950, MakeDecimal(sum(UnscaledValue(ws_net_profit#1787)),17,2) AS total net profit#37951]\n         +- Project [ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n            +- Join Inner, (ws_web_site_sk#1767 = web_site_sk#1648)\n               :- Project [ws_web_site_sk#1767, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n               :  +- Join Inner, (ws_ship_addr_sk#1765 = ca_address_sk#922)\n               :     :- Project [ws_ship_addr_sk#1765, ws_web_site_sk#1767, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n               :     :  +- Join Inner, (ws_ship_date_sk#1756 = d_date_sk#1040)\n               :     :     :- Join LeftAnti, (ws_order_number#1771L = wr_order_number#2129L)\n               :     :     :  :- Project [ws_ship_date_sk#1756, ws_ship_addr_sk#1765, ws_web_site_sk#1767, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n               :     :     :  :  +- Join LeftSemi, ((ws_order_number#1771L = ws_order_number#1771L#37963L) && NOT (ws_warehouse_sk#1769 = ws_warehouse_sk#1769#37972))\n               :     :     :  :     :- Project [ws_ship_date_sk#1756, ws_ship_addr_sk#1765, ws_web_site_sk#1767, ws_warehouse_sk#1769, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n               :     :     :  :     :  +- Filter ((isnotnull(ws_ship_date_sk#1756) && isnotnull(ws_ship_addr_sk#1765)) && isnotnull(ws_web_site_sk#1767))\n               :     :     :  :     :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :     :  :     +- Project [ws_warehouse_sk#1769 AS ws_warehouse_sk#1769#37972, ws_order_number#1771L AS ws_order_number#1771L#37963L]\n               :     :     :  :        +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :     :  +- Project [wr_order_number#2129L]\n               :     :     :     +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n               :     :     +- Project [d_date_sk#1040]\n               :     :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10623)) && (d_date#1042 <= 10683)) && isnotnull(d_date_sk#1040))\n               :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [ca_address_sk#922]\n               :        +- Filter ((isnotnull(ca_state#930) && (ca_state#930 = IL)) && isnotnull(ca_address_sk#922))\n               :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- Project [web_site_sk#1648]\n                  +- Filter ((isnotnull(web_company_name#1662) && (web_company_name#1662 = pri)) && isnotnull(web_site_sk#1648))\n                     +- Relation[web_site_sk#1648,web_site_id#1649,web_rec_start_date#1650,web_rec_end_date#1651,web_name#1652,web_open_date_sk#1653,web_close_date_sk#1654,web_class#1655,web_manager#1656,web_mkt_id#1657,web_mkt_class#1658,web_mkt_desc#1659,web_market_manager#1660,web_company_id#1661,web_company_name#1662,web_street_number#1663,web_street_name#1664,web_street_type#1665,web_suite_number#1666,web_city#1667,web_county#1668,web_state#1669,web_zip#1670,web_country#1671,... 2 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[order count#37949L ASC NULLS FIRST], output=[order count#37949L,total shipping cost#37950,total net profit#37951])\n+- *(12) HashAggregate(keys=[], functions=[sum(UnscaledValue(ws_ext_ship_cost#1782)), sum(UnscaledValue(ws_net_profit#1787)), count(distinct ws_order_number#1771L)], output=[order count#37949L, total shipping cost#37950, total net profit#37951])\n   +- Exchange SinglePartition\n      +- *(11) HashAggregate(keys=[], functions=[merge_sum(UnscaledValue(ws_ext_ship_cost#1782)), merge_sum(UnscaledValue(ws_net_profit#1787)), partial_count(distinct ws_order_number#1771L)], output=[sum#37997L, sum#37999L, count#38002L])\n         +- *(11) HashAggregate(keys=[ws_order_number#1771L], functions=[merge_sum(UnscaledValue(ws_ext_ship_cost#1782)), merge_sum(UnscaledValue(ws_net_profit#1787))], output=[ws_order_number#1771L, sum#37997L, sum#37999L])\n            +- *(11) HashAggregate(keys=[ws_order_number#1771L], functions=[partial_sum(UnscaledValue(ws_ext_ship_cost#1782)), partial_sum(UnscaledValue(ws_net_profit#1787))], output=[ws_order_number#1771L, sum#37997L, sum#37999L])\n               +- *(11) Project [ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n                  +- *(11) BroadcastHashJoin [ws_web_site_sk#1767], [web_site_sk#1648], Inner, BuildRight\n                     :- *(11) Project [ws_web_site_sk#1767, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n                     :  +- *(11) BroadcastHashJoin [ws_ship_addr_sk#1765], [ca_address_sk#922], Inner, BuildRight\n                     :     :- *(11) Project [ws_ship_addr_sk#1765, ws_web_site_sk#1767, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n                     :     :  +- *(11) BroadcastHashJoin [ws_ship_date_sk#1756], [d_date_sk#1040], Inner, BuildRight\n                     :     :     :- SortMergeJoin [ws_order_number#1771L], [wr_order_number#2129L], LeftAnti\n                     :     :     :  :- *(5) Project [ws_ship_date_sk#1756, ws_ship_addr_sk#1765, ws_web_site_sk#1767, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n                     :     :     :  :  +- SortMergeJoin [ws_order_number#1771L], [ws_order_number#1771L#37963L], LeftSemi, NOT (ws_warehouse_sk#1769 = ws_warehouse_sk#1769#37972)\n                     :     :     :  :     :- *(2) Sort [ws_order_number#1771L ASC NULLS FIRST], false, 0\n                     :     :     :  :     :  +- Exchange hashpartitioning(ws_order_number#1771L, 200)\n                     :     :     :  :     :     +- *(1) Project [ws_ship_date_sk#1756, ws_ship_addr_sk#1765, ws_web_site_sk#1767, ws_warehouse_sk#1769, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n                     :     :     :  :     :        +- *(1) Filter ((isnotnull(ws_ship_date_sk#1756) && isnotnull(ws_ship_addr_sk#1765)) && isnotnull(ws_web_site_sk#1767))\n                     :     :     :  :     :           +- *(1) FileScan parquet db_tpcds.web_sales[ws_ship_date_sk#1756,ws_ship_addr_sk#1765,ws_web_site_sk#1767,ws_warehouse_sk#1769,ws_order_number#1771L,ws_ext_ship_cost#1782,ws_net_profit#1787,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ws_ship_date_sk), IsNotNull(ws_ship_addr_sk), IsNotNull(ws_web_site_sk)], ReadSchema: struct<ws_ship_date_sk:int,ws_ship_addr_sk:int,ws_web_site_sk:int,ws_warehouse_sk:int,ws_order_nu...\n                     :     :     :  :     +- *(4) Sort [ws_order_number#1771L#37963L ASC NULLS FIRST], false, 0\n                     :     :     :  :        +- Exchange hashpartitioning(ws_order_number#1771L#37963L, 200)\n                     :     :     :  :           +- *(3) Project [ws_warehouse_sk#1769 AS ws_warehouse_sk#1769#37972, ws_order_number#1771L AS ws_order_number#1771L#37963L]\n                     :     :     :  :              +- *(3) FileScan parquet db_tpcds.web_sales[ws_warehouse_sk#1769,ws_order_number#1771L,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<ws_warehouse_sk:int,ws_order_number:bigint>\n                     :     :     :  +- *(7) Sort [wr_order_number#2129L ASC NULLS FIRST], false, 0\n                     :     :     :     +- Exchange hashpartitioning(wr_order_number#2129L, 200)\n                     :     :     :        +- *(6) Project [wr_order_number#2129L]\n                     :     :     :           +- *(6) FileScan parquet db_tpcds.web_returns[wr_order_number#2129L,wr_returned_date_sk#2140] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_returns], PartitionCount: 2110, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<wr_order_number:bigint>\n                     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :     :        +- *(8) Project [d_date_sk#1040]\n                     :     :           +- *(8) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10623)) && (d_date#1042 <= 10683)) && isnotnull(d_date_sk#1040))\n                     :     :              +- *(8) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1999-02-01), LessThanOrEqual(d_date,1999-04-02), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>\n                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :        +- *(9) Project [ca_address_sk#922]\n                     :           +- *(9) Filter ((isnotnull(ca_state#930) && (ca_state#930 = IL)) && isnotnull(ca_address_sk#922))\n                     :              +- *(9) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_state), EqualTo(ca_state,IL), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string>\n                     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        +- *(10) Project [web_site_sk#1648]\n                           +- *(10) Filter ((isnotnull(web_company_name#1662) && (web_company_name#1662 = pri)) && isnotnull(web_site_sk#1648))\n                              +- *(10) FileScan parquet db_tpcds.web_site[web_site_sk#1648,web_company_name#1662] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_site], PartitionFilters: [], PushedFilters: [IsNotNull(web_company_name), EqualTo(web_company_name,pri), IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:int,web_company_name:string>"},{"name":"q95-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","SortMergeJoin","SortMergeJoin","SortMergeJoin","SortMergeJoin","SortMergeJoin"],"tables":["web_sales","date_dim","customer_address","web_site"],"parsingTime":0.001553,"analysisTime":9.41E-4,"optimizationTime":80.843207,"planningTime":2377.219505,"executionTime":12583.280069,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ws_wh]\n:  +- 'SubqueryAlias ws_wh\n:     +- 'Project ['ws1.ws_order_number, 'ws1.ws_warehouse_sk AS wh1#38081, 'ws2.ws_warehouse_sk AS wh2#38082]\n:        +- 'Filter (('ws1.ws_order_number = 'ws2.ws_order_number) && NOT ('ws1.ws_warehouse_sk = 'ws2.ws_warehouse_sk))\n:           +- 'Join Inner\n:              :- 'SubqueryAlias ws1\n:              :  +- 'UnresolvedRelation `web_sales`\n:              +- 'SubqueryAlias ws2\n:                 +- 'UnresolvedRelation `web_sales`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Sort ['count('ws_order_number) ASC NULLS FIRST], true\n         +- 'Project ['count('ws_order_number) AS order count#38076, 'sum('ws_ext_ship_cost) AS total shipping cost#38077, 'sum('ws_net_profit) AS total net profit#38078]\n            +- 'Filter ((((('d_date >= cast(1999-02-01 as date)) && ('d_date <= (cast(1999-02-01 as date) + interval 8 weeks 4 days))) && ('ws1.ws_ship_date_sk = 'd_date_sk)) && (('ws1.ws_ship_addr_sk = 'ca_address_sk) && ('ca_state = IL))) && ((('ws1.ws_web_site_sk = 'web_site_sk) && ('web_company_name = pri)) && ('ws1.ws_order_number IN (list#38079 []) && 'ws1.ws_order_number IN (list#38080 []))))\n               :  :- 'Project ['ws_order_number]\n               :  :  +- 'UnresolvedRelation `ws_wh`\n               :  +- 'Project ['wr_order_number]\n               :     +- 'Filter ('wr_order_number = 'ws_wh.ws_order_number)\n               :        +- 'Join Inner\n               :           :- 'UnresolvedRelation `web_returns`\n               :           +- 'UnresolvedRelation `ws_wh`\n               +- 'Join Inner\n                  :- 'Join Inner\n                  :  :- 'Join Inner\n                  :  :  :- 'SubqueryAlias ws1\n                  :  :  :  +- 'UnresolvedRelation `web_sales`\n                  :  :  +- 'UnresolvedRelation `date_dim`\n                  :  +- 'UnresolvedRelation `customer_address`\n                  +- 'UnresolvedRelation `web_site`\n\n== Analyzed Logical Plan ==\norder count: bigint, total shipping cost: decimal(17,2), total net profit: decimal(17,2)\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [order count#38076L, total shipping cost#38077, total net profit#38078]\n      +- Sort [order count#38076L ASC NULLS FIRST], true\n         +- Aggregate [count(distinct ws_order_number#1771L) AS order count#38076L, sum(ws_ext_ship_cost#1782) AS total shipping cost#38077, sum(ws_net_profit#1787) AS total net profit#38078]\n            +- Filter (((((d_date#1042 >= cast(1999-02-01 as date)) && (d_date#1042 <= cast(cast(cast(1999-02-01 as date) as timestamp) + interval 8 weeks 4 days as date))) && (ws_ship_date_sk#1756 = d_date_sk#1040)) && ((ws_ship_addr_sk#1765 = ca_address_sk#922) && (ca_state#930 = IL))) && (((ws_web_site_sk#1767 = web_site_sk#1648) && (web_company_name#1662 = pri)) && (ws_order_number#1771L IN (list#38079 []) && ws_order_number#1771L IN (list#38080 []))))\n               :  :- Project [ws_order_number#1771L]\n               :  :  +- SubqueryAlias ws_wh\n               :  :     +- Project [ws_order_number#1771L, ws_warehouse_sk#1769 AS wh1#38081, ws_warehouse_sk#38097 AS wh2#38082]\n               :  :        +- Filter ((ws_order_number#1771L = ws_order_number#38099L) && NOT (ws_warehouse_sk#1769 = ws_warehouse_sk#38097))\n               :  :           +- Join Inner\n               :  :              :- SubqueryAlias ws1\n               :  :              :  +- SubqueryAlias web_sales\n               :  :              :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :  :              +- SubqueryAlias ws2\n               :  :                 +- SubqueryAlias web_sales\n               :  :                    +- Relation[ws_sold_time_sk#38083,ws_ship_date_sk#38084,ws_item_sk#38085,ws_bill_customer_sk#38086,ws_bill_cdemo_sk#38087,ws_bill_hdemo_sk#38088,ws_bill_addr_sk#38089,ws_ship_customer_sk#38090,ws_ship_cdemo_sk#38091,ws_ship_hdemo_sk#38092,ws_ship_addr_sk#38093,ws_web_page_sk#38094,ws_web_site_sk#38095,ws_ship_mode_sk#38096,ws_warehouse_sk#38097,ws_promo_sk#38098,ws_order_number#38099L,ws_quantity#38100,ws_wholesale_cost#38101,ws_list_price#38102,ws_sales_price#38103,ws_ext_discount_amt#38104,ws_ext_sales_price#38105,ws_ext_wholesale_cost#38106,... 10 more fields] parquet\n               :  +- Project [wr_order_number#2129L]\n               :     +- Filter (wr_order_number#2129L = ws_order_number#1771L)\n               :        +- Join Inner\n               :           :- SubqueryAlias web_returns\n               :           :  +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n               :           +- SubqueryAlias ws_wh\n               :              +- Project [ws_order_number#1771L, ws_warehouse_sk#1769 AS wh1#38081, ws_warehouse_sk#38097 AS wh2#38082]\n               :                 +- Filter ((ws_order_number#1771L = ws_order_number#38099L) && NOT (ws_warehouse_sk#1769 = ws_warehouse_sk#38097))\n               :                    +- Join Inner\n               :                       :- SubqueryAlias ws1\n               :                       :  +- SubqueryAlias web_sales\n               :                       :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :                       +- SubqueryAlias ws2\n               :                          +- SubqueryAlias web_sales\n               :                             +- Relation[ws_sold_time_sk#38083,ws_ship_date_sk#38084,ws_item_sk#38085,ws_bill_customer_sk#38086,ws_bill_cdemo_sk#38087,ws_bill_hdemo_sk#38088,ws_bill_addr_sk#38089,ws_ship_customer_sk#38090,ws_ship_cdemo_sk#38091,ws_ship_hdemo_sk#38092,ws_ship_addr_sk#38093,ws_web_page_sk#38094,ws_web_site_sk#38095,ws_ship_mode_sk#38096,ws_warehouse_sk#38097,ws_promo_sk#38098,ws_order_number#38099L,ws_quantity#38100,ws_wholesale_cost#38101,ws_list_price#38102,ws_sales_price#38103,ws_ext_discount_amt#38104,ws_ext_sales_price#38105,ws_ext_wholesale_cost#38106,... 10 more fields] parquet\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- SubqueryAlias ws1\n                  :  :  :  +- SubqueryAlias web_sales\n                  :  :  :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n                  :  :  +- SubqueryAlias date_dim\n                  :  :     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n                  :  +- SubqueryAlias customer_address\n                  :     +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n                  +- SubqueryAlias web_site\n                     +- Relation[web_site_sk#1648,web_site_id#1649,web_rec_start_date#1650,web_rec_end_date#1651,web_name#1652,web_open_date_sk#1653,web_close_date_sk#1654,web_class#1655,web_manager#1656,web_mkt_id#1657,web_mkt_class#1658,web_mkt_desc#1659,web_market_manager#1660,web_company_id#1661,web_company_name#1662,web_street_number#1663,web_street_name#1664,web_street_type#1665,web_suite_number#1666,web_city#1667,web_county#1668,web_state#1669,web_zip#1670,web_country#1671,... 2 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [order count#38076L ASC NULLS FIRST], true\n      +- Aggregate [count(distinct ws_order_number#1771L) AS order count#38076L, MakeDecimal(sum(UnscaledValue(ws_ext_ship_cost#1782)),17,2) AS total shipping cost#38077, MakeDecimal(sum(UnscaledValue(ws_net_profit#1787)),17,2) AS total net profit#38078]\n         +- Project [ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n            +- Join Inner, (ws_web_site_sk#1767 = web_site_sk#1648)\n               :- Project [ws_web_site_sk#1767, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n               :  +- Join Inner, (ws_ship_addr_sk#1765 = ca_address_sk#922)\n               :     :- Project [ws_ship_addr_sk#1765, ws_web_site_sk#1767, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n               :     :  +- Join Inner, (ws_ship_date_sk#1756 = d_date_sk#1040)\n               :     :     :- Join LeftSemi, (ws_order_number#1771L = wr_order_number#2129L)\n               :     :     :  :- Join LeftSemi, (ws_order_number#1771L = ws_order_number#1771L#38125L)\n               :     :     :  :  :- Project [ws_ship_date_sk#1756, ws_ship_addr_sk#1765, ws_web_site_sk#1767, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n               :     :     :  :  :  +- Filter ((isnotnull(ws_ship_date_sk#1756) && isnotnull(ws_ship_addr_sk#1765)) && isnotnull(ws_web_site_sk#1767))\n               :     :     :  :  :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :     :  :  +- Project [ws_order_number#1771L AS ws_order_number#1771L#38125L]\n               :     :     :  :     +- Join Inner, ((ws_order_number#1771L = ws_order_number#38099L) && NOT (ws_warehouse_sk#1769 = ws_warehouse_sk#38097))\n               :     :     :  :        :- Project [ws_warehouse_sk#1769, ws_order_number#1771L]\n               :     :     :  :        :  +- Filter (isnotnull(ws_order_number#1771L) && isnotnull(ws_warehouse_sk#1769))\n               :     :     :  :        :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :     :  :        +- Project [ws_warehouse_sk#38097, ws_order_number#38099L]\n               :     :     :  :           +- Filter (isnotnull(ws_order_number#38099L) && isnotnull(ws_warehouse_sk#38097))\n               :     :     :  :              +- Relation[ws_sold_time_sk#38083,ws_ship_date_sk#38084,ws_item_sk#38085,ws_bill_customer_sk#38086,ws_bill_cdemo_sk#38087,ws_bill_hdemo_sk#38088,ws_bill_addr_sk#38089,ws_ship_customer_sk#38090,ws_ship_cdemo_sk#38091,ws_ship_hdemo_sk#38092,ws_ship_addr_sk#38093,ws_web_page_sk#38094,ws_web_site_sk#38095,ws_ship_mode_sk#38096,ws_warehouse_sk#38097,ws_promo_sk#38098,ws_order_number#38099L,ws_quantity#38100,ws_wholesale_cost#38101,ws_list_price#38102,ws_sales_price#38103,ws_ext_discount_amt#38104,ws_ext_sales_price#38105,ws_ext_wholesale_cost#38106,... 10 more fields] parquet\n               :     :     :  +- Project [wr_order_number#2129L]\n               :     :     :     +- Join Inner, (wr_order_number#2129L = ws_order_number#1771L)\n               :     :     :        :- Project [wr_order_number#2129L]\n               :     :     :        :  +- Filter isnotnull(wr_order_number#2129L)\n               :     :     :        :     +- Relation[wr_returned_time_sk#2117,wr_item_sk#2118,wr_refunded_customer_sk#2119,wr_refunded_cdemo_sk#2120,wr_refunded_hdemo_sk#2121,wr_refunded_addr_sk#2122,wr_returning_customer_sk#2123,wr_returning_cdemo_sk#2124,wr_returning_hdemo_sk#2125,wr_returning_addr_sk#2126,wr_web_page_sk#2127,wr_reason_sk#2128,wr_order_number#2129L,wr_return_quantity#2130,wr_return_amt#2131,wr_return_tax#2132,wr_return_amt_inc_tax#2133,wr_fee#2134,wr_return_ship_cost#2135,wr_refunded_cash#2136,wr_reversed_charge#2137,wr_account_credit#2138,wr_net_loss#2139,wr_returned_date_sk#2140] parquet\n               :     :     :        +- Project [ws_order_number#1771L]\n               :     :     :           +- Join Inner, ((ws_order_number#1771L = ws_order_number#38099L) && NOT (ws_warehouse_sk#1769 = ws_warehouse_sk#38097))\n               :     :     :              :- Project [ws_warehouse_sk#1769, ws_order_number#1771L]\n               :     :     :              :  +- Filter (isnotnull(ws_order_number#1771L) && isnotnull(ws_warehouse_sk#1769))\n               :     :     :              :     +- Relation[ws_sold_time_sk#1755,ws_ship_date_sk#1756,ws_item_sk#1757,ws_bill_customer_sk#1758,ws_bill_cdemo_sk#1759,ws_bill_hdemo_sk#1760,ws_bill_addr_sk#1761,ws_ship_customer_sk#1762,ws_ship_cdemo_sk#1763,ws_ship_hdemo_sk#1764,ws_ship_addr_sk#1765,ws_web_page_sk#1766,ws_web_site_sk#1767,ws_ship_mode_sk#1768,ws_warehouse_sk#1769,ws_promo_sk#1770,ws_order_number#1771L,ws_quantity#1772,ws_wholesale_cost#1773,ws_list_price#1774,ws_sales_price#1775,ws_ext_discount_amt#1776,ws_ext_sales_price#1777,ws_ext_wholesale_cost#1778,... 10 more fields] parquet\n               :     :     :              +- Project [ws_warehouse_sk#38097, ws_order_number#38099L]\n               :     :     :                 +- Filter (isnotnull(ws_order_number#38099L) && isnotnull(ws_warehouse_sk#38097))\n               :     :     :                    +- Relation[ws_sold_time_sk#38083,ws_ship_date_sk#38084,ws_item_sk#38085,ws_bill_customer_sk#38086,ws_bill_cdemo_sk#38087,ws_bill_hdemo_sk#38088,ws_bill_addr_sk#38089,ws_ship_customer_sk#38090,ws_ship_cdemo_sk#38091,ws_ship_hdemo_sk#38092,ws_ship_addr_sk#38093,ws_web_page_sk#38094,ws_web_site_sk#38095,ws_ship_mode_sk#38096,ws_warehouse_sk#38097,ws_promo_sk#38098,ws_order_number#38099L,ws_quantity#38100,ws_wholesale_cost#38101,ws_list_price#38102,ws_sales_price#38103,ws_ext_discount_amt#38104,ws_ext_sales_price#38105,ws_ext_wholesale_cost#38106,... 10 more fields] parquet\n               :     :     +- Project [d_date_sk#1040]\n               :     :        +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10623)) && (d_date#1042 <= 10683)) && isnotnull(d_date_sk#1040))\n               :     :           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n               :     +- Project [ca_address_sk#922]\n               :        +- Filter ((isnotnull(ca_state#930) && (ca_state#930 = IL)) && isnotnull(ca_address_sk#922))\n               :           +- Relation[ca_address_sk#922,ca_address_id#923,ca_street_number#924,ca_street_name#925,ca_street_type#926,ca_suite_number#927,ca_city#928,ca_county#929,ca_state#930,ca_zip#931,ca_country#932,ca_gmt_offset#933,ca_location_type#934] parquet\n               +- Project [web_site_sk#1648]\n                  +- Filter ((isnotnull(web_company_name#1662) && (web_company_name#1662 = pri)) && isnotnull(web_site_sk#1648))\n                     +- Relation[web_site_sk#1648,web_site_id#1649,web_rec_start_date#1650,web_rec_end_date#1651,web_name#1652,web_open_date_sk#1653,web_close_date_sk#1654,web_class#1655,web_manager#1656,web_mkt_id#1657,web_mkt_class#1658,web_mkt_desc#1659,web_market_manager#1660,web_company_id#1661,web_company_name#1662,web_street_number#1663,web_street_name#1664,web_street_type#1665,web_suite_number#1666,web_city#1667,web_county#1668,web_state#1669,web_zip#1670,web_country#1671,... 2 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[order count#38076L ASC NULLS FIRST], output=[order count#38076L,total shipping cost#38077,total net profit#38078])\n+- *(21) HashAggregate(keys=[], functions=[sum(UnscaledValue(ws_ext_ship_cost#1782)), sum(UnscaledValue(ws_net_profit#1787)), count(distinct ws_order_number#1771L)], output=[order count#38076L, total shipping cost#38077, total net profit#38078])\n   +- Exchange SinglePartition\n      +- *(20) HashAggregate(keys=[], functions=[merge_sum(UnscaledValue(ws_ext_ship_cost#1782)), merge_sum(UnscaledValue(ws_net_profit#1787)), partial_count(distinct ws_order_number#1771L)], output=[sum#38127L, sum#38129L, count#38132L])\n         +- *(20) HashAggregate(keys=[ws_order_number#1771L], functions=[merge_sum(UnscaledValue(ws_ext_ship_cost#1782)), merge_sum(UnscaledValue(ws_net_profit#1787))], output=[ws_order_number#1771L, sum#38127L, sum#38129L])\n            +- *(20) HashAggregate(keys=[ws_order_number#1771L], functions=[partial_sum(UnscaledValue(ws_ext_ship_cost#1782)), partial_sum(UnscaledValue(ws_net_profit#1787))], output=[ws_order_number#1771L, sum#38127L, sum#38129L])\n               +- *(20) Project [ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n                  +- *(20) BroadcastHashJoin [ws_web_site_sk#1767], [web_site_sk#1648], Inner, BuildRight\n                     :- *(20) Project [ws_web_site_sk#1767, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n                     :  +- *(20) BroadcastHashJoin [ws_ship_addr_sk#1765], [ca_address_sk#922], Inner, BuildRight\n                     :     :- *(20) Project [ws_ship_addr_sk#1765, ws_web_site_sk#1767, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n                     :     :  +- *(20) BroadcastHashJoin [ws_ship_date_sk#1756], [d_date_sk#1040], Inner, BuildRight\n                     :     :     :- SortMergeJoin [ws_order_number#1771L], [wr_order_number#2129L], LeftSemi\n                     :     :     :  :- SortMergeJoin [ws_order_number#1771L], [ws_order_number#1771L#38125L], LeftSemi\n                     :     :     :  :  :- *(2) Sort [ws_order_number#1771L ASC NULLS FIRST], false, 0\n                     :     :     :  :  :  +- Exchange hashpartitioning(ws_order_number#1771L, 200)\n                     :     :     :  :  :     +- *(1) Project [ws_ship_date_sk#1756, ws_ship_addr_sk#1765, ws_web_site_sk#1767, ws_order_number#1771L, ws_ext_ship_cost#1782, ws_net_profit#1787]\n                     :     :     :  :  :        +- *(1) Filter ((isnotnull(ws_ship_date_sk#1756) && isnotnull(ws_ship_addr_sk#1765)) && isnotnull(ws_web_site_sk#1767))\n                     :     :     :  :  :           +- *(1) FileScan parquet db_tpcds.web_sales[ws_ship_date_sk#1756,ws_ship_addr_sk#1765,ws_web_site_sk#1767,ws_order_number#1771L,ws_ext_ship_cost#1782,ws_net_profit#1787,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ws_ship_date_sk), IsNotNull(ws_ship_addr_sk), IsNotNull(ws_web_site_sk)], ReadSchema: struct<ws_ship_date_sk:int,ws_ship_addr_sk:int,ws_web_site_sk:int,ws_order_number:bigint,ws_ext_s...\n                     :     :     :  :  +- *(8) Sort [ws_order_number#1771L#38125L ASC NULLS FIRST], false, 0\n                     :     :     :  :     +- Exchange hashpartitioning(ws_order_number#1771L#38125L, 200)\n                     :     :     :  :        +- *(7) Project [ws_order_number#1771L AS ws_order_number#1771L#38125L]\n                     :     :     :  :           +- *(7) SortMergeJoin [ws_order_number#1771L], [ws_order_number#38099L], Inner, NOT (ws_warehouse_sk#1769 = ws_warehouse_sk#38097)\n                     :     :     :  :              :- *(4) Sort [ws_order_number#1771L ASC NULLS FIRST], false, 0\n                     :     :     :  :              :  +- Exchange hashpartitioning(ws_order_number#1771L, 200)\n                     :     :     :  :              :     +- *(3) Project [ws_warehouse_sk#1769, ws_order_number#1771L]\n                     :     :     :  :              :        +- *(3) Filter (isnotnull(ws_order_number#1771L) && isnotnull(ws_warehouse_sk#1769))\n                     :     :     :  :              :           +- *(3) FileScan parquet db_tpcds.web_sales[ws_warehouse_sk#1769,ws_order_number#1771L,ws_sold_date_sk#1788] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ws_order_number), IsNotNull(ws_warehouse_sk)], ReadSchema: struct<ws_warehouse_sk:int,ws_order_number:bigint>\n                     :     :     :  :              +- *(6) Sort [ws_order_number#38099L ASC NULLS FIRST], false, 0\n                     :     :     :  :                 +- ReusedExchange [ws_warehouse_sk#38097, ws_order_number#38099L], Exchange hashpartitioning(ws_order_number#1771L, 200)\n                     :     :     :  +- *(16) Project [wr_order_number#2129L]\n                     :     :     :     +- *(16) SortMergeJoin [wr_order_number#2129L], [ws_order_number#1771L], Inner\n                     :     :     :        :- *(10) Sort [wr_order_number#2129L ASC NULLS FIRST], false, 0\n                     :     :     :        :  +- Exchange hashpartitioning(wr_order_number#2129L, 200)\n                     :     :     :        :     +- *(9) Project [wr_order_number#2129L]\n                     :     :     :        :        +- *(9) Filter isnotnull(wr_order_number#2129L)\n                     :     :     :        :           +- *(9) FileScan parquet db_tpcds.web_returns[wr_order_number#2129L,wr_returned_date_sk#2140] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_returns], PartitionCount: 2110, PartitionFilters: [], PushedFilters: [IsNotNull(wr_order_number)], ReadSchema: struct<wr_order_number:bigint>\n                     :     :     :        +- *(15) Project [ws_order_number#1771L]\n                     :     :     :           +- *(15) SortMergeJoin [ws_order_number#1771L], [ws_order_number#38099L], Inner, NOT (ws_warehouse_sk#1769 = ws_warehouse_sk#38097)\n                     :     :     :              :- *(12) Sort [ws_order_number#1771L ASC NULLS FIRST], false, 0\n                     :     :     :              :  +- ReusedExchange [ws_warehouse_sk#1769, ws_order_number#1771L], Exchange hashpartitioning(ws_order_number#1771L, 200)\n                     :     :     :              +- *(14) Sort [ws_order_number#38099L ASC NULLS FIRST], false, 0\n                     :     :     :                 +- ReusedExchange [ws_warehouse_sk#38097, ws_order_number#38099L], Exchange hashpartitioning(ws_order_number#1771L, 200)\n                     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :     :        +- *(17) Project [d_date_sk#1040]\n                     :     :           +- *(17) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10623)) && (d_date#1042 <= 10683)) && isnotnull(d_date_sk#1040))\n                     :     :              +- *(17) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1999-02-01), LessThanOrEqual(d_date,1999-04-02), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>\n                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                     :        +- *(18) Project [ca_address_sk#922]\n                     :           +- *(18) Filter ((isnotnull(ca_state#930) && (ca_state#930 = IL)) && isnotnull(ca_address_sk#922))\n                     :              +- *(18) FileScan parquet db_tpcds.customer_address[ca_address_sk#922,ca_state#930] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/customer_address], PartitionFilters: [], PushedFilters: [IsNotNull(ca_state), EqualTo(ca_state,IL), IsNotNull(ca_address_sk)], ReadSchema: struct<ca_address_sk:int,ca_state:string>\n                     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                        +- *(19) Project [web_site_sk#1648]\n                           +- *(19) Filter ((isnotnull(web_company_name#1662) && (web_company_name#1662 = pri)) && isnotnull(web_site_sk#1648))\n                              +- *(19) FileScan parquet db_tpcds.web_site[web_site_sk#1648,web_company_name#1662] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/web_site], PartitionFilters: [], PushedFilters: [IsNotNull(web_company_name), EqualTo(web_company_name,pri), IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:int,web_company_name:string>"},{"name":"q96-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","household_demographics","time_dim","store"],"parsingTime":0.00208,"analysisTime":0.001202,"optimizationTime":34.274082,"planningTime":252.049587,"executionTime":1102.62422,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['count(1) ASC NULLS FIRST], true\n      +- 'Project [unresolvedalias('count(1), None)]\n         +- 'Filter (((('ss_sold_time_sk = 'time_dim.t_time_sk) && ('ss_hdemo_sk = 'household_demographics.hd_demo_sk)) && (('ss_store_sk = 's_store_sk) && ('time_dim.t_hour = 20))) && ((('time_dim.t_minute >= 30) && ('household_demographics.hd_dep_count = 7)) && ('store.s_store_name = ese)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'UnresolvedRelation `store_sales`\n               :  :  +- 'UnresolvedRelation `household_demographics`\n               :  +- 'UnresolvedRelation `time_dim`\n               +- 'UnresolvedRelation `store`\n\n== Analyzed Logical Plan ==\ncount(1): bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [count(1)#38193L]\n      +- Sort [count(1)#38193L ASC NULLS FIRST], true\n         +- Aggregate [count(1) AS count(1)#38193L]\n            +- Filter ((((ss_sold_time_sk#1904 = t_time_sk#1464) && (ss_hdemo_sk#1908 = hd_demo_sk#1106)) && ((ss_store_sk#1910 = s_store_sk#1386) && (t_hour#1467 = 20))) && (((t_minute#1468 >= 30) && (hd_dep_count#1109 = 7)) && (s_store_name#1391 = ese)))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- SubqueryAlias store_sales\n                  :  :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :  :  +- SubqueryAlias household_demographics\n                  :  :     +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n                  :  +- SubqueryAlias time_dim\n                  :     +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n                  +- SubqueryAlias store\n                     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [count(1)#38193L ASC NULLS FIRST], true\n      +- Aggregate [count(1) AS count(1)#38193L]\n         +- Project\n            +- Join Inner, (ss_store_sk#1910 = s_store_sk#1386)\n               :- Project [ss_store_sk#1910]\n               :  +- Join Inner, (ss_sold_time_sk#1904 = t_time_sk#1464)\n               :     :- Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n               :     :  +- Join Inner, (ss_hdemo_sk#1908 = hd_demo_sk#1106)\n               :     :     :- Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n               :     :     :  +- Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n               :     :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n               :     :     +- Project [hd_demo_sk#1106]\n               :     :        +- Filter ((isnotnull(hd_dep_count#1109) && (hd_dep_count#1109 = 7)) && isnotnull(hd_demo_sk#1106))\n               :     :           +- Relation[hd_demo_sk#1106,hd_income_band_sk#1107,hd_buy_potential#1108,hd_dep_count#1109,hd_vehicle_count#1110] parquet\n               :     +- Project [t_time_sk#1464]\n               :        +- Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 20)) && (t_minute#1468 >= 30)) && isnotnull(t_time_sk#1464))\n               :           +- Relation[t_time_sk#1464,t_time_id#1465,t_time#1466,t_hour#1467,t_minute#1468,t_second#1469,t_am_pm#1470,t_shift#1471,t_sub_shift#1472,t_meal_time#1473] parquet\n               +- Project [s_store_sk#1386]\n                  +- Filter ((isnotnull(s_store_name#1391) && (s_store_name#1391 = ese)) && isnotnull(s_store_sk#1386))\n                     +- Relation[s_store_sk#1386,s_store_id#1387,s_rec_start_date#1388,s_rec_end_date#1389,s_closed_date_sk#1390,s_store_name#1391,s_number_employees#1392,s_floor_space#1393,s_hours#1394,s_manager#1395,s_market_id#1396,s_geography_class#1397,s_market_desc#1398,s_market_manager#1399,s_division_id#1400,s_division_name#1401,s_company_id#1402,s_company_name#1403,s_street_number#1404,s_street_name#1405,s_street_type#1406,s_suite_number#1407,s_city#1408,s_county#1409,... 5 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[count(1)#38193L ASC NULLS FIRST], output=[count(1)#38193L])\n+- *(5) HashAggregate(keys=[], functions=[count(1)], output=[count(1)#38193L])\n   +- Exchange SinglePartition\n      +- *(4) HashAggregate(keys=[], functions=[partial_count(1)], output=[count#38197L])\n         +- *(4) Project\n            +- *(4) BroadcastHashJoin [ss_store_sk#1910], [s_store_sk#1386], Inner, BuildRight\n               :- *(4) Project [ss_store_sk#1910]\n               :  +- *(4) BroadcastHashJoin [ss_sold_time_sk#1904], [t_time_sk#1464], Inner, BuildRight\n               :     :- *(4) Project [ss_sold_time_sk#1904, ss_store_sk#1910]\n               :     :  +- *(4) BroadcastHashJoin [ss_hdemo_sk#1908], [hd_demo_sk#1106], Inner, BuildRight\n               :     :     :- *(4) Project [ss_sold_time_sk#1904, ss_hdemo_sk#1908, ss_store_sk#1910]\n               :     :     :  +- *(4) Filter ((isnotnull(ss_hdemo_sk#1908) && isnotnull(ss_sold_time_sk#1904)) && isnotnull(ss_store_sk#1910))\n               :     :     :     +- *(4) FileScan parquet db_tpcds.store_sales[ss_sold_time_sk#1904,ss_hdemo_sk#1908,ss_store_sk#1910,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_time_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_time_sk:int,ss_hdemo_sk:int,ss_store_sk:int>\n               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(1) Project [hd_demo_sk#1106]\n               :     :           +- *(1) Filter ((isnotnull(hd_dep_count#1109) && (hd_dep_count#1109 = 7)) && isnotnull(hd_demo_sk#1106))\n               :     :              +- *(1) FileScan parquet db_tpcds.household_demographics[hd_demo_sk#1106,hd_dep_count#1109] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/household_demographics], PartitionFilters: [], PushedFilters: [IsNotNull(hd_dep_count), EqualTo(hd_dep_count,7), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:int,hd_dep_count:int>\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(2) Project [t_time_sk#1464]\n               :           +- *(2) Filter ((((isnotnull(t_hour#1467) && isnotnull(t_minute#1468)) && (t_hour#1467 = 20)) && (t_minute#1468 >= 30)) && isnotnull(t_time_sk#1464))\n               :              +- *(2) FileScan parquet db_tpcds.time_dim[t_time_sk#1464,t_hour#1467,t_minute#1468] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/time_dim], PartitionFilters: [], PushedFilters: [IsNotNull(t_hour), IsNotNull(t_minute), EqualTo(t_hour,20), GreaterThanOrEqual(t_minute,30), IsN..., ReadSchema: struct<t_time_sk:int,t_hour:int,t_minute:int>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(3) Project [s_store_sk#1386]\n                     +- *(3) Filter ((isnotnull(s_store_name#1391) && (s_store_name#1391 = ese)) && isnotnull(s_store_sk#1386))\n                        +- *(3) FileScan parquet db_tpcds.store[s_store_sk#1386,s_store_name#1391] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_name), EqualTo(s_store_name,ese), IsNotNull(s_store_sk)], ReadSchema: struct<s_store_sk:int,s_store_name:string>"},{"name":"q97-v2.4","mode":"collect","parameters":{},"joinTypes":["SortMergeJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["ssci","csci"],"parsingTime":0.002662,"analysisTime":0.001222,"optimizationTime":427.216021,"planningTime":30.401049,"executionTime":5971.108563,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\nCTE [ssci, csci]\n:  :- 'SubqueryAlias ssci\n:  :  +- 'Aggregate ['ss_customer_sk, 'ss_item_sk], ['ss_customer_sk AS customer_sk#38226, 'ss_item_sk AS item_sk#38227]\n:  :     +- 'Filter (('ss_sold_date_sk = 'd_date_sk) && (('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11))))\n:  :        +- 'Join Inner\n:  :           :- 'UnresolvedRelation `store_sales`\n:  :           +- 'UnresolvedRelation `date_dim`\n:  +- 'SubqueryAlias csci\n:     +- 'Aggregate ['cs_bill_customer_sk, 'cs_item_sk], ['cs_bill_customer_sk AS customer_sk#38228, 'cs_item_sk AS item_sk#38229]\n:        +- 'Filter (('cs_sold_date_sk = 'd_date_sk) && (('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11))))\n:           +- 'Join Inner\n:              :- 'UnresolvedRelation `catalog_sales`\n:              +- 'UnresolvedRelation `date_dim`\n+- 'GlobalLimit 100\n   +- 'LocalLimit 100\n      +- 'Project ['sum(CASE WHEN (isnotnull('ssci.customer_sk) && isnull('csci.customer_sk)) THEN 1 ELSE 0 END) AS store_only#38223, 'sum(CASE WHEN (isnull('ssci.customer_sk) && isnotnull('csci.customer_sk)) THEN 1 ELSE 0 END) AS catalog_only#38224, 'sum(CASE WHEN (isnotnull('ssci.customer_sk) && isnotnull('csci.customer_sk)) THEN 1 ELSE 0 END) AS store_and_catalog#38225]\n         +- 'Join FullOuter, (('ssci.customer_sk = 'csci.customer_sk) && ('ssci.item_sk = 'csci.item_sk))\n            :- 'UnresolvedRelation `ssci`\n            +- 'UnresolvedRelation `csci`\n\n== Analyzed Logical Plan ==\nstore_only: bigint, catalog_only: bigint, store_and_catalog: bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Aggregate [sum(cast(CASE WHEN (isnotnull(customer_sk#38226) && isnull(customer_sk#38228)) THEN 1 ELSE 0 END as bigint)) AS store_only#38223L, sum(cast(CASE WHEN (isnull(customer_sk#38226) && isnotnull(customer_sk#38228)) THEN 1 ELSE 0 END as bigint)) AS catalog_only#38224L, sum(cast(CASE WHEN (isnotnull(customer_sk#38226) && isnotnull(customer_sk#38228)) THEN 1 ELSE 0 END as bigint)) AS store_and_catalog#38225L]\n      +- Join FullOuter, ((customer_sk#38226 = customer_sk#38228) && (item_sk#38227 = item_sk#38229))\n         :- SubqueryAlias ssci\n         :  +- Aggregate [ss_customer_sk#1906, ss_item_sk#1905], [ss_customer_sk#1906 AS customer_sk#38226, ss_item_sk#1905 AS item_sk#38227]\n         :     +- Filter ((ss_sold_date_sk#1926 = d_date_sk#1040) && ((d_month_seq#1043 >= 1200) && (d_month_seq#1043 <= (1200 + 11))))\n         :        +- Join Inner\n         :           :- SubqueryAlias store_sales\n         :           :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n         :           +- SubqueryAlias date_dim\n         :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n         +- SubqueryAlias csci\n            +- Aggregate [cs_bill_customer_sk#1791, cs_item_sk#1803], [cs_bill_customer_sk#1791 AS customer_sk#38228, cs_item_sk#1803 AS item_sk#38229]\n               +- Filter ((cs_sold_date_sk#1822 = d_date_sk#1040) && ((d_month_seq#1043 >= 1200) && (d_month_seq#1043 <= (1200 + 11))))\n                  +- Join Inner\n                     :- SubqueryAlias catalog_sales\n                     :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     +- SubqueryAlias date_dim\n                        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Aggregate [sum(cast(CASE WHEN (isnotnull(customer_sk#38226) && isnull(customer_sk#38228)) THEN 1 ELSE 0 END as bigint)) AS store_only#38223L, sum(cast(CASE WHEN (isnull(customer_sk#38226) && isnotnull(customer_sk#38228)) THEN 1 ELSE 0 END as bigint)) AS catalog_only#38224L, sum(cast(CASE WHEN (isnotnull(customer_sk#38226) && isnotnull(customer_sk#38228)) THEN 1 ELSE 0 END as bigint)) AS store_and_catalog#38225L]\n      +- Project [customer_sk#38226, customer_sk#38228]\n         +- Join FullOuter, ((customer_sk#38226 = customer_sk#38228) && (item_sk#38227 = item_sk#38229))\n            :- Aggregate [ss_customer_sk#1906, ss_item_sk#1905], [ss_customer_sk#1906 AS customer_sk#38226, ss_item_sk#1905 AS item_sk#38227]\n            :  +- Project [ss_item_sk#1905, ss_customer_sk#1906]\n            :     +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n            :        :- Project [ss_item_sk#1905, ss_customer_sk#1906, ss_sold_date_sk#1926]\n            :        :  +- Filter isnotnull(ss_sold_date_sk#1926)\n            :        :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n            :        +- Project [d_date_sk#1040]\n            :           +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n            :              +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n            +- Aggregate [cs_bill_customer_sk#1791, cs_item_sk#1803], [cs_bill_customer_sk#1791 AS customer_sk#38228, cs_item_sk#1803 AS item_sk#38229]\n               +- Project [cs_bill_customer_sk#1791, cs_item_sk#1803]\n                  +- Join Inner, (cs_sold_date_sk#1822 = d_date_sk#1040)\n                     :- Project [cs_bill_customer_sk#1791, cs_item_sk#1803, cs_sold_date_sk#1822]\n                     :  +- Filter isnotnull(cs_sold_date_sk#1822)\n                     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                     +- Project [d_date_sk#1040]\n                        +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                           +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nCollectLimit 100\n+- *(10) LocalLimit 100\n   +- *(10) HashAggregate(keys=[], functions=[sum(cast(CASE WHEN (isnotnull(customer_sk#38226) && isnull(customer_sk#38228)) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN (isnull(customer_sk#38226) && isnotnull(customer_sk#38228)) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN (isnotnull(customer_sk#38226) && isnotnull(customer_sk#38228)) THEN 1 ELSE 0 END as bigint))], output=[store_only#38223L, catalog_only#38224L, store_and_catalog#38225L])\n      +- Exchange SinglePartition\n         +- *(9) HashAggregate(keys=[], functions=[partial_sum(cast(CASE WHEN (isnotnull(customer_sk#38226) && isnull(customer_sk#38228)) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN (isnull(customer_sk#38226) && isnotnull(customer_sk#38228)) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN (isnotnull(customer_sk#38226) && isnotnull(customer_sk#38228)) THEN 1 ELSE 0 END as bigint))], output=[sum#38239L, sum#38240L, sum#38241L])\n            +- *(9) Project [customer_sk#38226, customer_sk#38228]\n               +- SortMergeJoin [customer_sk#38226, item_sk#38227], [customer_sk#38228, item_sk#38229], FullOuter\n                  :- *(4) Sort [customer_sk#38226 ASC NULLS FIRST, item_sk#38227 ASC NULLS FIRST], false, 0\n                  :  +- Exchange hashpartitioning(customer_sk#38226, item_sk#38227, 200)\n                  :     +- *(3) HashAggregate(keys=[ss_customer_sk#1906, ss_item_sk#1905], functions=[], output=[customer_sk#38226, item_sk#38227])\n                  :        +- Exchange hashpartitioning(ss_customer_sk#1906, ss_item_sk#1905, 200)\n                  :           +- *(2) HashAggregate(keys=[ss_customer_sk#1906, ss_item_sk#1905], functions=[], output=[ss_customer_sk#1906, ss_item_sk#1905])\n                  :              +- *(2) Project [ss_item_sk#1905, ss_customer_sk#1906]\n                  :                 +- *(2) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                  :                    :- *(2) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_customer_sk#1906,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [], ReadSchema: struct<ss_item_sk:int,ss_customer_sk:int>\n                  :                    +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  :                       +- *(1) Project [d_date_sk#1040]\n                  :                          +- *(1) Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                  :                             +- *(1) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_month_seq#1043] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>\n                  +- *(8) Sort [customer_sk#38228 ASC NULLS FIRST, item_sk#38229 ASC NULLS FIRST], false, 0\n                     +- Exchange hashpartitioning(customer_sk#38228, item_sk#38229, 200)\n                        +- *(7) HashAggregate(keys=[cs_bill_customer_sk#1791, cs_item_sk#1803], functions=[], output=[customer_sk#38228, item_sk#38229])\n                           +- Exchange hashpartitioning(cs_bill_customer_sk#1791, cs_item_sk#1803, 200)\n                              +- *(6) HashAggregate(keys=[cs_bill_customer_sk#1791, cs_item_sk#1803], functions=[], output=[cs_bill_customer_sk#1791, cs_item_sk#1803])\n                                 +- *(6) Project [cs_bill_customer_sk#1791, cs_item_sk#1803]\n                                    +- *(6) BroadcastHashJoin [cs_sold_date_sk#1822], [d_date_sk#1040], Inner, BuildRight\n                                       :- *(6) FileScan parquet db_tpcds.catalog_sales[cs_bill_customer_sk#1791,cs_item_sk#1803,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales/cs_..., PartitionCount: 1830, PartitionFilters: [isnotnull(cs_sold_date_sk#1822)], PushedFilters: [], ReadSchema: struct<cs_bill_customer_sk:int,cs_item_sk:int>\n                                       +- ReusedExchange [d_date_sk#1040], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))"},{"name":"q98-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin"],"tables":["store_sales","item","date_dim"],"parsingTime":0.00187,"analysisTime":0.001094,"optimizationTime":259.514848,"planningTime":13.129159,"executionTime":4538.493537,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'Sort ['i_category ASC NULLS FIRST, 'i_class ASC NULLS FIRST, 'i_item_id ASC NULLS FIRST, 'i_item_desc ASC NULLS FIRST, 'revenueratio ASC NULLS FIRST], true\n+- 'Aggregate ['i_item_id, 'i_item_desc, 'i_category, 'i_class, 'i_current_price], ['i_item_desc, 'i_category, 'i_class, 'i_current_price, 'sum('ss_ext_sales_price) AS itemrevenue#38273, (('sum('ss_ext_sales_price) * 100) / 'sum('sum('ss_ext_sales_price)) windowspecdefinition('i_class, unspecifiedframe$())) AS revenueratio#38274]\n   +- 'Filter ((('ss_item_sk = 'i_item_sk) && 'i_category IN (Sports,Books,Home)) && (('ss_sold_date_sk = 'd_date_sk) && (('d_date >= cast(1999-02-22 as date)) && ('d_date <= (cast(1999-02-22 as date) + interval 4 weeks 2 days)))))\n      +- 'Join Inner\n         :- 'Join Inner\n         :  :- 'UnresolvedRelation `store_sales`\n         :  +- 'UnresolvedRelation `item`\n         +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\ni_item_desc: string, i_category: string, i_class: string, i_current_price: decimal(7,2), itemrevenue: decimal(17,2), revenueratio: decimal(38,17)\nProject [i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#38273, revenueratio#38274]\n+- Sort [i_category#1184 ASC NULLS FIRST, i_class#1182 ASC NULLS FIRST, i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, revenueratio#38274 ASC NULLS FIRST], true\n   +- Project [i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#38273, revenueratio#38274, i_item_id#1173]\n      +- Project [i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#38273, _w0#38279, _w1#38280, _we0#38281, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(_w0#38279 as decimal(17,2))) * promote_precision(cast(cast(100 as decimal(3,0)) as decimal(17,2)))), DecimalType(21,2)) as decimal(27,2))) / promote_precision(cast(_we0#38281 as decimal(27,2)))), DecimalType(38,17)) AS revenueratio#38274, i_item_id#1173]\n         +- Window [sum(_w1#38280) windowspecdefinition(i_class#1182, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#38281], [i_class#1182]\n            +- Aggregate [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177], [i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, sum(ss_ext_sales_price#1918) AS itemrevenue#38273, sum(ss_ext_sales_price#1918) AS _w0#38279, sum(ss_ext_sales_price#1918) AS _w1#38280, i_item_id#1173]\n               +- Filter (((ss_item_sk#1905 = i_item_sk#1172) && i_category#1184 IN (Sports,Books,Home)) && ((ss_sold_date_sk#1926 = d_date_sk#1040) && ((d_date#1042 >= cast(1999-02-22 as date)) && (d_date#1042 <= cast(cast(cast(1999-02-22 as date) as timestamp) + interval 4 weeks 2 days as date)))))\n                  +- Join Inner\n                     :- Join Inner\n                     :  :- SubqueryAlias store_sales\n                     :  :  +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                     :  +- SubqueryAlias item\n                     :     +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                     +- SubqueryAlias date_dim\n                        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nProject [i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#38273, revenueratio#38274]\n+- Sort [i_category#1184 ASC NULLS FIRST, i_class#1182 ASC NULLS FIRST, i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, revenueratio#38274 ASC NULLS FIRST], true\n   +- Project [i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#38273, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(_w0#38279) * 100.00), DecimalType(21,2)) as decimal(27,2))) / promote_precision(_we0#38281)), DecimalType(38,17)) AS revenueratio#38274, i_item_id#1173]\n      +- Window [sum(_w1#38280) windowspecdefinition(i_class#1182, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#38281], [i_class#1182]\n         +- Aggregate [i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177], [i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS itemrevenue#38273, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS _w0#38279, MakeDecimal(sum(UnscaledValue(ss_ext_sales_price#1918)),17,2) AS _w1#38280, i_item_id#1173]\n            +- Project [ss_ext_sales_price#1918, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n               +- Join Inner, (ss_sold_date_sk#1926 = d_date_sk#1040)\n                  :- Project [ss_ext_sales_price#1918, ss_sold_date_sk#1926, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                  :  +- Join Inner, (ss_item_sk#1905 = i_item_sk#1172)\n                  :     :- Project [ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                  :     :  +- Filter (isnotnull(ss_item_sk#1905) && isnotnull(ss_sold_date_sk#1926))\n                  :     :     +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n                  :     +- Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                  :        +- Filter (i_category#1184 IN (Sports,Books,Home) && isnotnull(i_item_sk#1172))\n                  :           +- Relation[i_item_sk#1172,i_item_id#1173,i_rec_start_date#1174,i_rec_end_date#1175,i_item_desc#1176,i_current_price#1177,i_wholesale_cost#1178,i_brand_id#1179,i_brand#1180,i_class_id#1181,i_class#1182,i_category_id#1183,i_category#1184,i_manufact_id#1185,i_manufact#1186,i_size#1187,i_formulation#1188,i_color#1189,i_units#1190,i_container#1191,i_manager_id#1192,i_product_name#1193] parquet\n                  +- Project [d_date_sk#1040]\n                     +- Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10644)) && (d_date#1042 <= 10674)) && isnotnull(d_date_sk#1040))\n                        +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\n*(7) Project [i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#38273, revenueratio#38274]\n+- *(7) Sort [i_category#1184 ASC NULLS FIRST, i_class#1182 ASC NULLS FIRST, i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, revenueratio#38274 ASC NULLS FIRST], true, 0\n   +- Exchange rangepartitioning(i_category#1184 ASC NULLS FIRST, i_class#1182 ASC NULLS FIRST, i_item_id#1173 ASC NULLS FIRST, i_item_desc#1176 ASC NULLS FIRST, revenueratio#38274 ASC NULLS FIRST, 200)\n      +- *(6) Project [i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#38273, CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(_w0#38279) * 100.00), DecimalType(21,2)) as decimal(27,2))) / promote_precision(_we0#38281)), DecimalType(38,17)) AS revenueratio#38274, i_item_id#1173]\n         +- Window [sum(_w1#38280) windowspecdefinition(i_class#1182, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS _we0#38281], [i_class#1182]\n            +- *(5) Sort [i_class#1182 ASC NULLS FIRST], false, 0\n               +- Exchange hashpartitioning(i_class#1182, 200)\n                  +- *(4) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177], functions=[sum(UnscaledValue(ss_ext_sales_price#1918))], output=[i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, itemrevenue#38273, _w0#38279, _w1#38280, i_item_id#1173])\n                     +- Exchange hashpartitioning(i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, 200)\n                        +- *(3) HashAggregate(keys=[i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177], functions=[partial_sum(UnscaledValue(ss_ext_sales_price#1918))], output=[i_item_id#1173, i_item_desc#1176, i_category#1184, i_class#1182, i_current_price#1177, sum#38289L])\n                           +- *(3) Project [ss_ext_sales_price#1918, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                              +- *(3) BroadcastHashJoin [ss_sold_date_sk#1926], [d_date_sk#1040], Inner, BuildRight\n                                 :- *(3) Project [ss_ext_sales_price#1918, ss_sold_date_sk#1926, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                                 :  +- *(3) BroadcastHashJoin [ss_item_sk#1905], [i_item_sk#1172], Inner, BuildRight\n                                 :     :- *(3) Project [ss_item_sk#1905, ss_ext_sales_price#1918, ss_sold_date_sk#1926]\n                                 :     :  +- *(3) Filter isnotnull(ss_item_sk#1905)\n                                 :     :     +- *(3) FileScan parquet db_tpcds.store_sales[ss_item_sk#1905,ss_ext_sales_price#1918,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: PrunedInMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales/ss_so..., PartitionCount: 1823, PartitionFilters: [isnotnull(ss_sold_date_sk#1926)], PushedFilters: [IsNotNull(ss_item_sk)], ReadSchema: struct<ss_item_sk:int,ss_ext_sales_price:decimal(7,2)>\n                                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                 :        +- *(1) Project [i_item_sk#1172, i_item_id#1173, i_item_desc#1176, i_current_price#1177, i_class#1182, i_category#1184]\n                                 :           +- *(1) Filter (i_category#1184 IN (Sports,Books,Home) && isnotnull(i_item_sk#1172))\n                                 :              +- *(1) FileScan parquet db_tpcds.item[i_item_sk#1172,i_item_id#1173,i_item_desc#1176,i_current_price#1177,i_class#1182,i_category#1184] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/item], PartitionFilters: [], PushedFilters: [In(i_category, [Sports,Books,Home]), IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_id:string,i_item_desc:string,i_current_price:decimal(7,2),i_class:str...\n                                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                                    +- *(2) Project [d_date_sk#1040]\n                                       +- *(2) Filter (((isnotnull(d_date#1042) && (d_date#1042 >= 10644)) && (d_date#1042 <= 10674)) && isnotnull(d_date_sk#1040))\n                                          +- *(2) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_date#1042] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date), GreaterThanOrEqual(d_date,1999-02-22), LessThanOrEqual(d_date,1999-03-24), Is..., ReadSchema: struct<d_date_sk:int,d_date:date>"},{"name":"q99-v2.4","mode":"collect","parameters":{},"joinTypes":["BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin","BroadcastHashJoin"],"tables":["catalog_sales","warehouse","ship_mode","call_center","date_dim"],"parsingTime":0.0021,"analysisTime":0.001343,"optimizationTime":63.38272,"planningTime":210.187248,"executionTime":2549.942103,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'GlobalLimit 100\n+- 'LocalLimit 100\n   +- 'Sort ['substr('w_warehouse_name, 1, 20) ASC NULLS FIRST, 'sm_type ASC NULLS FIRST, 'cc_name ASC NULLS FIRST], true\n      +- 'Aggregate ['substr('w_warehouse_name, 1, 20), 'sm_type, 'cc_name], [unresolvedalias('substr('w_warehouse_name, 1, 20), None), 'sm_type, 'cc_name, 'sum(CASE WHEN (('cs_ship_date_sk - 'cs_sold_date_sk) <= 30) THEN 1 ELSE 0 END) AS 30 days#38739, 'sum(CASE WHEN ((('cs_ship_date_sk - 'cs_sold_date_sk) > 30) && (('cs_ship_date_sk - 'cs_sold_date_sk) <= 60)) THEN 1 ELSE 0 END) AS 31-60 days#38740, 'sum(CASE WHEN ((('cs_ship_date_sk - 'cs_sold_date_sk) > 60) && (('cs_ship_date_sk - 'cs_sold_date_sk) <= 90)) THEN 1 ELSE 0 END) AS 61-90 days#38741, 'sum(CASE WHEN ((('cs_ship_date_sk - 'cs_sold_date_sk) > 90) && (('cs_ship_date_sk - 'cs_sold_date_sk) <= 120)) THEN 1 ELSE 0 END) AS 91-120 days#38742, 'sum(CASE WHEN (('cs_ship_date_sk - 'cs_sold_date_sk) > 120) THEN 1 ELSE 0 END) AS >120 days#38743]\n         +- 'Filter ((((('d_month_seq >= 1200) && ('d_month_seq <= (1200 + 11))) && ('cs_ship_date_sk = 'd_date_sk)) && ('cs_warehouse_sk = 'w_warehouse_sk)) && (('cs_ship_mode_sk = 'sm_ship_mode_sk) && ('cs_call_center_sk = 'cc_call_center_sk)))\n            +- 'Join Inner\n               :- 'Join Inner\n               :  :- 'Join Inner\n               :  :  :- 'Join Inner\n               :  :  :  :- 'UnresolvedRelation `catalog_sales`\n               :  :  :  +- 'UnresolvedRelation `warehouse`\n               :  :  +- 'UnresolvedRelation `ship_mode`\n               :  +- 'UnresolvedRelation `call_center`\n               +- 'UnresolvedRelation `date_dim`\n\n== Analyzed Logical Plan ==\nsubstring(w_warehouse_name, 1, 20): string, sm_type: string, cc_name: string, 30 days: bigint, 31-60 days: bigint, 61-90 days: bigint, 91-120 days: bigint, >120 days: bigint\nGlobalLimit 100\n+- LocalLimit 100\n   +- Project [substring(w_warehouse_name, 1, 20)#38749, sm_type#1318, cc_name#732, 30 days#38739L, 31-60 days#38740L, 61-90 days#38741L, 91-120 days#38742L, >120 days#38743L]\n      +- Sort [substring(w_warehouse_name, 1, 20)#38749 ASC NULLS FIRST, sm_type#1318 ASC NULLS FIRST, cc_name#732 ASC NULLS FIRST], true\n         +- Aggregate [substring(w_warehouse_name#1514, 1, 20), sm_type#1318, cc_name#732], [substring(w_warehouse_name#1514, 1, 20) AS substring(w_warehouse_name, 1, 20)#38749, sm_type#1318, cc_name#732, sum(cast(CASE WHEN ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 30) THEN 1 ELSE 0 END as bigint)) AS 30 days#38739L, sum(cast(CASE WHEN (((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 30) && ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 60)) THEN 1 ELSE 0 END as bigint)) AS 31-60 days#38740L, sum(cast(CASE WHEN (((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 60) && ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 90)) THEN 1 ELSE 0 END as bigint)) AS 61-90 days#38741L, sum(cast(CASE WHEN (((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 90) && ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 120)) THEN 1 ELSE 0 END as bigint)) AS 91-120 days#38742L, sum(cast(CASE WHEN ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 120) THEN 1 ELSE 0 END as bigint)) AS >120 days#38743L]\n            +- Filter (((((d_month_seq#1043 >= 1200) && (d_month_seq#1043 <= (1200 + 11))) && (cs_ship_date_sk#1790 = d_date_sk#1040)) && (cs_warehouse_sk#1802 = w_warehouse_sk#1512)) && ((cs_ship_mode_sk#1801 = sm_ship_mode_sk#1316) && (cs_call_center_sk#1799 = cc_call_center_sk#726)))\n               +- Join Inner\n                  :- Join Inner\n                  :  :- Join Inner\n                  :  :  :- Join Inner\n                  :  :  :  :- SubqueryAlias catalog_sales\n                  :  :  :  :  +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n                  :  :  :  +- SubqueryAlias warehouse\n                  :  :  :     +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n                  :  :  +- SubqueryAlias ship_mode\n                  :  :     +- Relation[sm_ship_mode_sk#1316,sm_ship_mode_id#1317,sm_type#1318,sm_code#1319,sm_carrier#1320,sm_contract#1321] parquet\n                  :  +- SubqueryAlias call_center\n                  :     +- Relation[cc_call_center_sk#726,cc_call_center_id#727,cc_rec_start_date#728,cc_rec_end_date#729,cc_closed_date_sk#730,cc_open_date_sk#731,cc_name#732,cc_class#733,cc_employees#734,cc_sq_ft#735,cc_hours#736,cc_manager#737,cc_mkt_id#738,cc_mkt_class#739,cc_mkt_desc#740,cc_market_manager#741,cc_division#742,cc_division_name#743,cc_company#744,cc_company_name#745,cc_street_number#746,cc_street_name#747,cc_street_type#748,cc_suite_number#749,... 7 more fields] parquet\n                  +- SubqueryAlias date_dim\n                     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Optimized Logical Plan ==\nGlobalLimit 100\n+- LocalLimit 100\n   +- Sort [substring(w_warehouse_name, 1, 20)#38749 ASC NULLS FIRST, sm_type#1318 ASC NULLS FIRST, cc_name#732 ASC NULLS FIRST], true\n      +- Aggregate [substring(w_warehouse_name#1514, 1, 20), sm_type#1318, cc_name#732], [substring(w_warehouse_name#1514, 1, 20) AS substring(w_warehouse_name, 1, 20)#38749, sm_type#1318, cc_name#732, sum(cast(CASE WHEN ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 30) THEN 1 ELSE 0 END as bigint)) AS 30 days#38739L, sum(cast(CASE WHEN (((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 30) && ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 60)) THEN 1 ELSE 0 END as bigint)) AS 31-60 days#38740L, sum(cast(CASE WHEN (((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 60) && ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 90)) THEN 1 ELSE 0 END as bigint)) AS 61-90 days#38741L, sum(cast(CASE WHEN (((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 90) && ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 120)) THEN 1 ELSE 0 END as bigint)) AS 91-120 days#38742L, sum(cast(CASE WHEN ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 120) THEN 1 ELSE 0 END as bigint)) AS >120 days#38743L]\n         +- Project [cs_ship_date_sk#1790, cs_sold_date_sk#1822, w_warehouse_name#1514, sm_type#1318, cc_name#732]\n            +- Join Inner, (cs_ship_date_sk#1790 = d_date_sk#1040)\n               :- Project [cs_ship_date_sk#1790, cs_sold_date_sk#1822, w_warehouse_name#1514, sm_type#1318, cc_name#732]\n               :  +- Join Inner, (cs_call_center_sk#1799 = cc_call_center_sk#726)\n               :     :- Project [cs_ship_date_sk#1790, cs_call_center_sk#1799, cs_sold_date_sk#1822, w_warehouse_name#1514, sm_type#1318]\n               :     :  +- Join Inner, (cs_ship_mode_sk#1801 = sm_ship_mode_sk#1316)\n               :     :     :- Project [cs_ship_date_sk#1790, cs_call_center_sk#1799, cs_ship_mode_sk#1801, cs_sold_date_sk#1822, w_warehouse_name#1514]\n               :     :     :  +- Join Inner, (cs_warehouse_sk#1802 = w_warehouse_sk#1512)\n               :     :     :     :- Project [cs_ship_date_sk#1790, cs_call_center_sk#1799, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_sold_date_sk#1822]\n               :     :     :     :  +- Filter (((isnotnull(cs_warehouse_sk#1802) && isnotnull(cs_ship_mode_sk#1801)) && isnotnull(cs_call_center_sk#1799)) && isnotnull(cs_ship_date_sk#1790))\n               :     :     :     :     +- Relation[cs_sold_time_sk#1789,cs_ship_date_sk#1790,cs_bill_customer_sk#1791,cs_bill_cdemo_sk#1792,cs_bill_hdemo_sk#1793,cs_bill_addr_sk#1794,cs_ship_customer_sk#1795,cs_ship_cdemo_sk#1796,cs_ship_hdemo_sk#1797,cs_ship_addr_sk#1798,cs_call_center_sk#1799,cs_catalog_page_sk#1800,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_item_sk#1803,cs_promo_sk#1804,cs_order_number#1805L,cs_quantity#1806,cs_wholesale_cost#1807,cs_list_price#1808,cs_sales_price#1809,cs_ext_discount_amt#1810,cs_ext_sales_price#1811,cs_ext_wholesale_cost#1812,... 10 more fields] parquet\n               :     :     :     +- Project [w_warehouse_sk#1512, w_warehouse_name#1514]\n               :     :     :        +- Filter isnotnull(w_warehouse_sk#1512)\n               :     :     :           +- Relation[w_warehouse_sk#1512,w_warehouse_id#1513,w_warehouse_name#1514,w_warehouse_sq_ft#1515,w_street_number#1516,w_street_name#1517,w_street_type#1518,w_suite_number#1519,w_city#1520,w_county#1521,w_state#1522,w_zip#1523,w_country#1524,w_gmt_offset#1525] parquet\n               :     :     +- Project [sm_ship_mode_sk#1316, sm_type#1318]\n               :     :        +- Filter isnotnull(sm_ship_mode_sk#1316)\n               :     :           +- Relation[sm_ship_mode_sk#1316,sm_ship_mode_id#1317,sm_type#1318,sm_code#1319,sm_carrier#1320,sm_contract#1321] parquet\n               :     +- Project [cc_call_center_sk#726, cc_name#732]\n               :        +- Filter isnotnull(cc_call_center_sk#726)\n               :           +- Relation[cc_call_center_sk#726,cc_call_center_id#727,cc_rec_start_date#728,cc_rec_end_date#729,cc_closed_date_sk#730,cc_open_date_sk#731,cc_name#732,cc_class#733,cc_employees#734,cc_sq_ft#735,cc_hours#736,cc_manager#737,cc_mkt_id#738,cc_mkt_class#739,cc_mkt_desc#740,cc_market_manager#741,cc_division#742,cc_division_name#743,cc_company#744,cc_company_name#745,cc_street_number#746,cc_street_name#747,cc_street_type#748,cc_suite_number#749,... 7 more fields] parquet\n               +- Project [d_date_sk#1040]\n                  +- Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                     +- Relation[d_date_sk#1040,d_date_id#1041,d_date#1042,d_month_seq#1043,d_week_seq#1044,d_quarter_seq#1045,d_year#1046,d_dow#1047,d_moy#1048,d_dom#1049,d_qoy#1050,d_fy_year#1051,d_fy_quarter_seq#1052,d_fy_week_seq#1053,d_day_name#1054,d_quarter_name#1055,d_holiday#1056,d_weekend#1057,d_following_holiday#1058,d_first_dom#1059,d_last_dom#1060,d_same_day_ly#1061,d_same_day_lq#1062,d_current_day#1063,... 4 more fields] parquet\n\n== Physical Plan ==\nTakeOrderedAndProject(limit=100, orderBy=[substring(w_warehouse_name, 1, 20)#38749 ASC NULLS FIRST,sm_type#1318 ASC NULLS FIRST,cc_name#732 ASC NULLS FIRST], output=[substring(w_warehouse_name, 1, 20)#38749,sm_type#1318,cc_name#732,30 days#38739L,31-60 days#38740L,61-90 days#38741L,91-120 days#38742L,>120 days#38743L])\n+- *(6) HashAggregate(keys=[substring(w_warehouse_name#1514, 1, 20)#38761, sm_type#1318, cc_name#732], functions=[sum(cast(CASE WHEN ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 30) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN (((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 30) && ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 60)) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN (((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 60) && ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 90)) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN (((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 90) && ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 120)) THEN 1 ELSE 0 END as bigint)), sum(cast(CASE WHEN ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 120) THEN 1 ELSE 0 END as bigint))], output=[substring(w_warehouse_name, 1, 20)#38749, sm_type#1318, cc_name#732, 30 days#38739L, 31-60 days#38740L, 61-90 days#38741L, 91-120 days#38742L, >120 days#38743L])\n   +- Exchange hashpartitioning(substring(w_warehouse_name#1514, 1, 20)#38761, sm_type#1318, cc_name#732, 200)\n      +- *(5) HashAggregate(keys=[substring(w_warehouse_name#1514, 1, 20) AS substring(w_warehouse_name#1514, 1, 20)#38761, sm_type#1318, cc_name#732], functions=[partial_sum(cast(CASE WHEN ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 30) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN (((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 30) && ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 60)) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN (((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 60) && ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 90)) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN (((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 90) && ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) <= 120)) THEN 1 ELSE 0 END as bigint)), partial_sum(cast(CASE WHEN ((cs_ship_date_sk#1790 - cs_sold_date_sk#1822) > 120) THEN 1 ELSE 0 END as bigint))], output=[substring(w_warehouse_name#1514, 1, 20)#38761, sm_type#1318, cc_name#732, sum#38767L, sum#38768L, sum#38769L, sum#38770L, sum#38771L])\n         +- *(5) Project [cs_ship_date_sk#1790, cs_sold_date_sk#1822, w_warehouse_name#1514, sm_type#1318, cc_name#732]\n            +- *(5) BroadcastHashJoin [cs_ship_date_sk#1790], [d_date_sk#1040], Inner, BuildRight\n               :- *(5) Project [cs_ship_date_sk#1790, cs_sold_date_sk#1822, w_warehouse_name#1514, sm_type#1318, cc_name#732]\n               :  +- *(5) BroadcastHashJoin [cs_call_center_sk#1799], [cc_call_center_sk#726], Inner, BuildRight\n               :     :- *(5) Project [cs_ship_date_sk#1790, cs_call_center_sk#1799, cs_sold_date_sk#1822, w_warehouse_name#1514, sm_type#1318]\n               :     :  +- *(5) BroadcastHashJoin [cs_ship_mode_sk#1801], [sm_ship_mode_sk#1316], Inner, BuildRight\n               :     :     :- *(5) Project [cs_ship_date_sk#1790, cs_call_center_sk#1799, cs_ship_mode_sk#1801, cs_sold_date_sk#1822, w_warehouse_name#1514]\n               :     :     :  +- *(5) BroadcastHashJoin [cs_warehouse_sk#1802], [w_warehouse_sk#1512], Inner, BuildRight\n               :     :     :     :- *(5) Project [cs_ship_date_sk#1790, cs_call_center_sk#1799, cs_ship_mode_sk#1801, cs_warehouse_sk#1802, cs_sold_date_sk#1822]\n               :     :     :     :  +- *(5) Filter (((isnotnull(cs_warehouse_sk#1802) && isnotnull(cs_ship_mode_sk#1801)) && isnotnull(cs_call_center_sk#1799)) && isnotnull(cs_ship_date_sk#1790))\n               :     :     :     :     +- *(5) FileScan parquet db_tpcds.catalog_sales[cs_ship_date_sk#1790,cs_call_center_sk#1799,cs_ship_mode_sk#1801,cs_warehouse_sk#1802,cs_sold_date_sk#1822] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/catalog_sales], PartitionCount: 1831, PartitionFilters: [], PushedFilters: [IsNotNull(cs_warehouse_sk), IsNotNull(cs_ship_mode_sk), IsNotNull(cs_call_center_sk), IsNotNull(..., ReadSchema: struct<cs_ship_date_sk:int,cs_call_center_sk:int,cs_ship_mode_sk:int,cs_warehouse_sk:int>\n               :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :     :        +- *(1) Project [w_warehouse_sk#1512, w_warehouse_name#1514]\n               :     :     :           +- *(1) Filter isnotnull(w_warehouse_sk#1512)\n               :     :     :              +- *(1) FileScan parquet db_tpcds.warehouse[w_warehouse_sk#1512,w_warehouse_name#1514] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/warehouse], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>\n               :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :     :        +- *(2) Project [sm_ship_mode_sk#1316, sm_type#1318]\n               :     :           +- *(2) Filter isnotnull(sm_ship_mode_sk#1316)\n               :     :              +- *(2) FileScan parquet db_tpcds.ship_mode[sm_ship_mode_sk#1316,sm_type#1318] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/ship_mode], PartitionFilters: [], PushedFilters: [IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:int,sm_type:string>\n               :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n               :        +- *(3) Project [cc_call_center_sk#726, cc_name#732]\n               :           +- *(3) Filter isnotnull(cc_call_center_sk#726)\n               :              +- *(3) FileScan parquet db_tpcds.call_center[cc_call_center_sk#726,cc_name#732] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/call_center], PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk)], ReadSchema: struct<cc_call_center_sk:int,cc_name:string>\n               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n                  +- *(4) Project [d_date_sk#1040]\n                     +- *(4) Filter (((isnotnull(d_month_seq#1043) && (d_month_seq#1043 >= 1200)) && (d_month_seq#1043 <= 1211)) && isnotnull(d_date_sk#1040))\n                        +- *(4) FileScan parquet db_tpcds.date_dim[d_date_sk#1040,d_month_seq#1043] Batched: true, Format: Parquet, Location: InMemoryFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1200), LessThanOrEqual(d_month_seq,1211),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>"},{"name":"ss_max-v2.4","mode":"collect","parameters":{},"joinTypes":[],"tables":["store_sales"],"parsingTime":0.00217,"analysisTime":0.00108,"optimizationTime":5.467274,"planningTime":205.256246,"executionTime":2740.42401,"breakDown":[],"queryExecution":"== Parsed Logical Plan ==\n'Project ['count(1) AS total#38857, 'count('ss_sold_date_sk) AS not_null_total#38858, 'count('ss_sold_date_sk) AS unique_days#38859, 'max('ss_sold_date_sk) AS max_ss_sold_date_sk#38860, 'max('ss_sold_time_sk) AS max_ss_sold_time_sk#38861, 'max('ss_item_sk) AS max_ss_item_sk#38862, 'max('ss_customer_sk) AS max_ss_customer_sk#38863, 'max('ss_cdemo_sk) AS max_ss_cdemo_sk#38864, 'max('ss_hdemo_sk) AS max_ss_hdemo_sk#38865, 'max('ss_addr_sk) AS max_ss_addr_sk#38866, 'max('ss_store_sk) AS max_ss_store_sk#38867, 'max('ss_promo_sk) AS max_ss_promo_sk#38868]\n+- 'UnresolvedRelation `store_sales`\n\n== Analyzed Logical Plan ==\ntotal: bigint, not_null_total: bigint, unique_days: bigint, max_ss_sold_date_sk: int, max_ss_sold_time_sk: int, max_ss_item_sk: int, max_ss_customer_sk: int, max_ss_cdemo_sk: int, max_ss_hdemo_sk: int, max_ss_addr_sk: int, max_ss_store_sk: int, max_ss_promo_sk: int\nAggregate [count(1) AS total#38857L, count(ss_sold_date_sk#1926) AS not_null_total#38858L, count(distinct ss_sold_date_sk#1926) AS unique_days#38859L, max(ss_sold_date_sk#1926) AS max_ss_sold_date_sk#38860, max(ss_sold_time_sk#1904) AS max_ss_sold_time_sk#38861, max(ss_item_sk#1905) AS max_ss_item_sk#38862, max(ss_customer_sk#1906) AS max_ss_customer_sk#38863, max(ss_cdemo_sk#1907) AS max_ss_cdemo_sk#38864, max(ss_hdemo_sk#1908) AS max_ss_hdemo_sk#38865, max(ss_addr_sk#1909) AS max_ss_addr_sk#38866, max(ss_store_sk#1910) AS max_ss_store_sk#38867, max(ss_promo_sk#1911) AS max_ss_promo_sk#38868]\n+- SubqueryAlias store_sales\n   +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n\n== Optimized Logical Plan ==\nAggregate [count(1) AS total#38857L, count(ss_sold_date_sk#1926) AS not_null_total#38858L, count(distinct ss_sold_date_sk#1926) AS unique_days#38859L, max(ss_sold_date_sk#1926) AS max_ss_sold_date_sk#38860, max(ss_sold_time_sk#1904) AS max_ss_sold_time_sk#38861, max(ss_item_sk#1905) AS max_ss_item_sk#38862, max(ss_customer_sk#1906) AS max_ss_customer_sk#38863, max(ss_cdemo_sk#1907) AS max_ss_cdemo_sk#38864, max(ss_hdemo_sk#1908) AS max_ss_hdemo_sk#38865, max(ss_addr_sk#1909) AS max_ss_addr_sk#38866, max(ss_store_sk#1910) AS max_ss_store_sk#38867, max(ss_promo_sk#1911) AS max_ss_promo_sk#38868]\n+- Project [ss_sold_time_sk#1904, ss_item_sk#1905, ss_customer_sk#1906, ss_cdemo_sk#1907, ss_hdemo_sk#1908, ss_addr_sk#1909, ss_store_sk#1910, ss_promo_sk#1911, ss_sold_date_sk#1926]\n   +- Relation[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_ticket_number#1912L,ss_quantity#1913,ss_wholesale_cost#1914,ss_list_price#1915,ss_sales_price#1916,ss_ext_discount_amt#1917,ss_ext_sales_price#1918,ss_ext_wholesale_cost#1919,ss_ext_list_price#1920,ss_ext_tax#1921,ss_coupon_amt#1922,ss_net_paid#1923,ss_net_paid_inc_tax#1924,ss_net_profit#1925,ss_sold_date_sk#1926] parquet\n\n== Physical Plan ==\n*(3) HashAggregate(keys=[], functions=[count(1), count(ss_sold_date_sk#1926), max(ss_sold_date_sk#1926), max(ss_sold_time_sk#1904), max(ss_item_sk#1905), max(ss_customer_sk#1906), max(ss_cdemo_sk#1907), max(ss_hdemo_sk#1908), max(ss_addr_sk#1909), max(ss_store_sk#1910), max(ss_promo_sk#1911), count(distinct ss_sold_date_sk#1926)], output=[total#38857L, not_null_total#38858L, unique_days#38859L, max_ss_sold_date_sk#38860, max_ss_sold_time_sk#38861, max_ss_item_sk#38862, max_ss_customer_sk#38863, max_ss_cdemo_sk#38864, max_ss_hdemo_sk#38865, max_ss_addr_sk#38866, max_ss_store_sk#38867, max_ss_promo_sk#38868])\n+- Exchange SinglePartition\n   +- *(2) HashAggregate(keys=[], functions=[merge_count(1), merge_count(ss_sold_date_sk#1926), merge_max(ss_sold_date_sk#1926), merge_max(ss_sold_time_sk#1904), merge_max(ss_item_sk#1905), merge_max(ss_customer_sk#1906), merge_max(ss_cdemo_sk#1907), merge_max(ss_hdemo_sk#1908), merge_max(ss_addr_sk#1909), merge_max(ss_store_sk#1910), merge_max(ss_promo_sk#1911), partial_count(distinct ss_sold_date_sk#1926)], output=[count#38894L, count#38896L, max#38898, max#38900, max#38902, max#38904, max#38906, max#38908, max#38910, max#38912, max#38914, count#38917L])\n      +- *(2) HashAggregate(keys=[ss_sold_date_sk#1926], functions=[merge_count(1), merge_count(ss_sold_date_sk#1926), merge_max(ss_sold_date_sk#1926), merge_max(ss_sold_time_sk#1904), merge_max(ss_item_sk#1905), merge_max(ss_customer_sk#1906), merge_max(ss_cdemo_sk#1907), merge_max(ss_hdemo_sk#1908), merge_max(ss_addr_sk#1909), merge_max(ss_store_sk#1910), merge_max(ss_promo_sk#1911)], output=[ss_sold_date_sk#1926, count#38894L, count#38896L, max#38898, max#38900, max#38902, max#38904, max#38906, max#38908, max#38910, max#38912, max#38914])\n         +- Exchange hashpartitioning(ss_sold_date_sk#1926, 200)\n            +- *(1) HashAggregate(keys=[ss_sold_date_sk#1926], functions=[partial_count(1), partial_count(ss_sold_date_sk#1926), partial_max(ss_sold_date_sk#1926), partial_max(ss_sold_time_sk#1904), partial_max(ss_item_sk#1905), partial_max(ss_customer_sk#1906), partial_max(ss_cdemo_sk#1907), partial_max(ss_hdemo_sk#1908), partial_max(ss_addr_sk#1909), partial_max(ss_store_sk#1910), partial_max(ss_promo_sk#1911)], output=[ss_sold_date_sk#1926, count#38894L, count#38896L, max#38898, max#38900, max#38902, max#38904, max#38906, max#38908, max#38910, max#38912, max#38914])\n               +- *(1) FileScan parquet db_tpcds.store_sales[ss_sold_time_sk#1904,ss_item_sk#1905,ss_customer_sk#1906,ss_cdemo_sk#1907,ss_hdemo_sk#1908,ss_addr_sk#1909,ss_store_sk#1910,ss_promo_sk#1911,ss_sold_date_sk#1926] Batched: true, Format: Parquet, Location: CatalogFileIndex[file:/home/ycx/sparkimprovement/benchmark/tpcds/gendata/store_sales], PartitionCount: 1824, PartitionFilters: [], PushedFilters: [], ReadSchema: struct<ss_sold_time_sk:int,ss_item_sk:int,ss_customer_sk:int,ss_cdemo_sk:int,ss_hdemo_sk:int,ss_a..."}]}
